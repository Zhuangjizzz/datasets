# 1. FOUNDATIONS

## 1.1 Introduction

The field of electronics is one of the great success stories of the 20th century. From the crude spark-gap transmitters and "cat's-whisker" detectors at its beginning, the first halfcentury brought an era of vacuum-tube electronics that developed considerable sophistication and found ready application in areas such as communications, navigation, instrumentation, control, and computation. The latter halfcentury brought "solid-state" electronics - first as discrete transistors, then as magnificent arrays of them within "integrated circuits" (ICs) - in a flood of stunning advances that shows no sign of abating. Compact and inexpensive consumer products now routinely contain many millions of transistors in VLSI (very large-scale integration) chips, combined with elegant optoelectronics (displays, lasers, and so on); they can process sounds, images, and data, and (for example) permit wireless networking and shirt-pocket access to the pooled capabilities of the Internet. Perhaps as noteworthy is the pleasant trend toward increased performance per dollar. ${ }^{1}$ The cost of an electronic microcircuit routinely decreases to a fraction of its initial cost as the manufacturing process is perfected (see Figure 10.87 for an example). In fact, it is often the case that the panel controls and cabinet hardware of an instrument cost more than the electronics inside.

On reading of these exciting new developments in electronics, you may get the impression that you should be able to construct powerful, elegant, yet inexpensive, little gadgets to do almost any conceivable task - all you need to know is how all these miracle devices work. If you've had that feeling, this book is for you. In it we have attempted to convey the excitement and know-how of the subject of electronics.

In this chapter we begin the study of the laws, rules of thumb, and tricks that constitute the art of electronics as we see it. It is necessary to begin at the beginning - with talk of voltage, current, power, and the components that make up

[^0]electronic circuits. Because you can't touch, see, smell, or hear electricity, there will be a certain amount of abstraction (particularly in the first chapter), as well as some dependence on such visualizing instruments as oscilloscopes and voltmeters. In many ways the first chapter is also the most mathematical, in spite of our efforts to keep mathematics to a minimum in order to foster a good intuitive understanding of circuit design and behavior.

In this new edition we've included some intuition-aiding approximations that our students have found helpful. And, by introducing one or two "active" components ahead of their time, we're able to jump directly into some applications that are usually impossible in a traditional textbook "passive electronics" chapter; this will keep things interesting, and even exciting.

Once we have considered the foundations of electronics, we will quickly get into the active circuits (amplifiers, oscillators, logic circuits, etc.) that make electronics the exciting field it is. The reader with some background in electronics may wish to skip over this chapter, since it assumes no prior knowledge of electronics. Further generalizations at this time would be pointless, so let's just dive right in.

## 1.2 Voltage, current, and resistance

### 1.2.1 Voltage and current

There are two quantities that we like to keep track of in electronic circuits: voltage and current. These are usually changing with time; otherwise nothing interesting is happening.
Voltage (symbol $V$ or sometimes $E$ ). Officially, the voltage between two points is the cost in energy (work done) required to move a unit of positive charge from the more negative point (lower potential) to the more positive point (higher potential). Equivalently, it is the energy released when a unit charge moves "downhill" from the higher potential to the lower. ${ }^{2}$ Voltage is also called

[^1]potential difference or electromotive force (EMF). The unit of measure is the volt, with voltages usually expressed in volts $(\mathrm{V})$, kilovolts $\left(1 \mathrm{kV}=10^{3} \mathrm{~V}\right)$, millivolts $\left(1 \mathrm{mV}=10^{-3} \mathrm{~V}\right)$, or microvolts $\left(1 \mu \mathrm{~V}=10^{-6} \mathrm{~V}\right)$ (see the box on prefixes). A joule ( J ) of work is done in moving a coulomb ( C ) of charge through a potential difference of 1 V . (The coulomb is the unit of electric charge, and it equals the charge of approximately $6 \times 10^{18}$ electrons.) For reasons that will become clear later, the opportunities to talk about nanovolts ( $\left.1 \mathrm{nV}=10^{-9} \mathrm{~V}\right)$ and megavolts ( $1 \mathrm{MV}=10^{6} \mathrm{~V}$ ) are rare.
Current (symbol $I$ ). Current is the rate of flow of electric charge past a point. The unit of measure is the ampere, or amp, with currents usually expressed in amperes (A), milliamperes $\left(1 \mathrm{~mA}=10^{-3} \mathrm{~A}\right)$, microamperes $\left(1 \mu \mathrm{~A}=10^{-6} \mathrm{~A}\right)$, nanoamperes $\left(1 \mathrm{nA}=10^{-9} \mathrm{~A}\right)$, or occasionally picoamperes ( $\left.1 \mathrm{pA}=10^{-12} \mathrm{~A}\right)$. A current of 1 amp equals a flow of 1 coulomb of charge per second. By convention, current in a circuit is considered to flow from a more positive point to a more negative point, even though the actual electron flow is in the opposite direction.
Important: from these definitions you can see that currents flow through things, and voltages are applied (or appear) across things. So you've got to say it right: always refer to the voltage between two points or across two points in a circuit. Always refer to current through a device or connection in a circuit.

To say something like "the voltage through a resistor .." is nonsense. However, we do frequently speak of the voltage at a point in a circuit. This is always understood to mean the voltage between that point and "ground," a common point in the circuit that everyone seems to know about. Soon you will, too.

We generate voltages by doing work on charges in devices such as batteries (conversion of electrochemical energy), generators (conversion of mechanical energy by magnetic forces), solar cells (photovoltaic conversion of the energy of photons), etc. We get currents by placing voltages across things.

At this point you may well wonder how to "see" voltages and currents. The single most useful electronic instrument is the oscilloscope, which allows you to look at voltages (or occasionally currents) in a circuit as a function of time. ${ }^{3}$ We will deal with oscilloscopes, and also voltmeters, when we discuss signals shortly; for a preview see Appendix O, and the multimeter box later in this chapter.

[^2]In real circuits we connect things together with wires (metallic conductors), each of which has the same voltage on it everywhere (with respect to ground, say). ${ }^{4}$ We mention this now so that you will realize that an actual circuit doesn't have to look like its schematic diagram, because wires can be rearranged.

Here are some simple rules about voltage and current:

1. The sum of the currents into a point in a circuit equals the sum of the currents out (conservation of charge). This is sometimes called Kirchhoff's current law (KCL). Engineers like to refer to such a point as a node. It follows that, for a series circuit (a bunch of two-terminal things all connected end-to-end), the current is the same everywhere.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0035.jpg?height=221&width=473&top_left_y=836&top_left_x=1141)

Figure 1.1. Parallel connection.
2. Things hooked in parallel (Figure 1.1) have the same voltage across them. Restated, the sum of the "voltage drops" from $A$ to $B$ via one path through a circuit equals the sum by any other route, and is simply the voltage between $A$ and $B$. Another way to say it is that the sum of the voltage drops around any closed circuit is zero. This is Kirchhoff's voltage law (KVL).
3. The power (energy per unit time) consumed by a circuit device is

$$
\begin{equation*}
P=V I \tag{1.1}
\end{equation*}
$$

This is simply (energy/charge) $\times$ (charge/time). For $V$ in volts and $I$ in amps, $P$ comes out in watts. A watt is a joule per second ( $1 \mathrm{~W}=1 \mathrm{~J} / \mathrm{s}$ ). So, for example, the current flowing through a 60W lightbulb running on 120 V is 0.5 A .

Power goes into heat (usually), or sometimes mechanical work (motors), radiated energy (lamps, transmitters), or stored energy (batteries, capacitors, inductors). Managing the heat load in a complicated system (e.g., a large computer, in which many kilowatts of electrical energy are converted to heat, with the energetically insignificant byproduct of a few pages of computational results) can be a crucial part of the system design.

[^3]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0036.jpg?height=995&width=1596&top_left_y=204&top_left_x=248)

Figure 1.2. A selection of common resistor types. Top row, left to right (wirewound ceramic power resistors): 20W vitreous enamel with leads, 20 W with mounting studs, 30 W vitreous enamel, 5 W and 20 W with mounting studs. Middle row (wirewound power resistors): 1W, 3 W , and 5 W axial ceramic; $5 \mathrm{~W}, 10 \mathrm{~W}, 25 \mathrm{~W}$, and 50 W conduction-cooled ("Dale-type"). Bottom row: $2 \mathrm{~W}, 1 \mathrm{~W}, \frac{1}{2} \mathrm{~W}, \frac{1}{4} \mathrm{~W}$, and $\frac{1}{8} \mathrm{~W}$ carbon composition; surface-mount thick-film (2010, 1206, 0805, 0603, and 0402 sizes); surface-mount resistor array; 6-, 8-, and 10-pin single in-line package arrays; dual in-line package array. The resistor at bottom is the ubiquitous RN55D $\frac{1}{4} \mathrm{~W}, 1 \%$ metal-film type; and the pair of resistors above are Victoreen high-resistance types (glass, $2 \mathrm{G} \Omega$; ceramic, $5 \mathrm{G} \Omega$ ).

Soon, when we deal with periodically varying voltages and currents, we will have to generalize the simple equation $P=V I$ to deal with average power, but it's correct as a statement of instantaneous power just as it stands.

Incidentally, don't call current "amperage"; that's strictly bush league. ${ }^{5}$ The same caution will apply to the term "ohmage" ${ }^{6}$ when we get to resistance in the next section.

### 1.2.2 Relationship between voltage and current: resistors

This is a long and interesting story. It is the heart of electronics. Crudely speaking, the name of the game is to make and use gadgets that have interesting and useful $I$-versus$V$ characteristics. Resistors ( $I$ simply proportional to $V$ ),

[^4]capacitors ( $I$ proportional to rate of change of $V$ ), diodes (I flows in only one direction), thermistors (temperaturedependent resistor), photoresistors (light-dependent resistor), strain gauges (strain-dependent resistor), etc., are examples. Perhaps more interesting still are three-terminal devices, such as transistors, in which the current that can flow between a pair of terminals is controlled by the voltage applied to a third terminal. We will gradually get into some of these exotic devices; for now, we will start with the most mundane (and most widely used) circuit element, the resistor (Figure 1.3).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0036.jpg?height=55&width=187&top_left_y=2003&top_left_x=1376)

Figure 1.3. Resistor.

#### A. Resistance and resistors

It is an interesting fact that the current through a metallic conductor (or other partially conducting material) is proportional to the voltage across it. (In the case of wire

PREFIXES

| Multiple | Prefix | Symbol | Derivation |
| :--- | :--- | :---: | :--- |
| $10^{24}$ | yotta | Y | end-1 of Latin alphabet, hint of Greek iota |
| $10^{21}$ | zetta | Z | end of Latin alphabet, hint of Greek zeta |
| $10^{18}$ | exa | E | Greek hexa (six: power of 1000) |
| $10^{15}$ | peta | P | Greek penta (five: power of 1000) |
| $10^{12}$ | tera | T | Greek teras (monster) |
| $10^{9}$ | giga | G | Greek gigas (giant) |
| $10^{6}$ | mega | M | Greek megas (great) |
| $10^{3}$ | kilo | k | Greek khilioi (thousand) |
| $10^{-3}$ | milli | m | Latin milli (thousand) |
| $10^{-6}$ | micro | $\mu$ | Greek mikros (small) |
| $10^{-9}$ | nano | n | Greek nanos (dwarf) |
| $10^{-12}$ | pico | p | from Italian/Spanish piccolo/pico (small) |
| $10^{-15}$ | femto | f | Danish/Norwegian femten (fifteen) |
| $10^{-18}$ | atto | a | Danish/Norwegian atten (eighteen) |
| $10^{-21}$ | zepto | z | end of Latin alphabet, mirrors zetta |
| $10^{-24}$ | yocto | y | end-1 of Latin alphabet, mirrors yotta |

These prefixes are universally used to scale units in science and engineering. Their etymological derivations are a matter of some controversy and should not be considered historically reliable. When abbreviating a unit with a prefix, the symbol for the unit follows the prefix without space. Be careful about uppercase and lowercase letters (especially m and M ) in both prefix and unit: 1 mW
is a milliwatt, or one-thousandth of a watt; 1 MHz is a megahertz or 1 million hertz. In general, units are spelled with lowercase letters, even when they are derived from proper names. The unit name is not capitalized when it is spelled out and used with a prefix, only when abbreviated. Thus: hertz and kilohertz, but Hz and kHz; watt, milliwatt, and megawatt, but W, mW, and MW.
conductors used in circuits, we usually choose a thickenough gauge of wire so that these "voltage drops" will be negligible.) This is by no means a universal law for all objects. For instance, the current through a neon bulb is a highly nonlinear function of the applied voltage (it is zero up to a critical voltage, at which point it rises dramatically). The same goes for a variety of interesting special devices - diodes, transistors, lightbulbs, etc. (If you are interested in understanding why metallic conductors behave this way, read $\S \S 4.4-4.5$ in Purcell and Morin's splendid text Electricity and Magnetism).

A resistor is made out of some conducting stuff (carbon, or a thin metal or carbon film, or wire of poor conductivity), with a wire or contacts at each end. It is characterized by its resistance:

$$
\begin{equation*}
R=V / I \tag{1.2}
\end{equation*}
$$

$R$ is in ohms for $V$ in volts and $I$ in amps. This is known as Ohm's law. Typical resistors of the most frequently used type (metal-oxide film, metal film, or carbon film) come in
values from 1 ohm ( $1 \Omega$ ) to about 10 megohms (10M $\Omega$ ). Resistors are also characterized by how much power they can safely dissipate (the most commonly used ones are rated at $1 / 4$ or $1 / 8 \mathrm{~W}$ ), their physical size, ${ }^{7}$ and by other parameters such as tolerance (accuracy), temperature coefficient, noise, voltage coefficient (the extent to which $R$ depends on applied $V$ ), stability with time, inductance, etc. See the box on resistors, Chapter $1 x$, and Appendix C for further details. Figure 1.2 shows a collection of resistors, with most of the available morphologies represented.

Roughly speaking, resistors are used to convert a

[^5]
RESISTORS

Resistors are truly ubiquitous. There are almost as many types as there are applications. Resistors are used in amplifiers as loads for active devices, in bias networks, and as feedback elements. In combination with capacitors they establish time constants and act as filters. They are used to set operating currents and signal levels. Resistors are used in power circuits to reduce voltages by dissipating power, to measure currents, and to discharge capacitors after power is removed. They are used in precision circuits to establish currents, to provide accurate voltage ratios, and to set precise gain values. In logic circuits they act as bus and line terminators and as "pullup" and "pull-down" resistors. In high-voltage circuits they are used to measure voltages and to equalize leakage currents among diodes or capacitors connected in series. In radiofrequency (RF) circuits they set the bandwidth of resonant circuits, and they are even used as coil forms for inductors.

Resistors are available with resistances from $0.0002 \Omega$ through $10^{12} \Omega$, standard power ratings from $1 / 8$ watt through 250 watts, and accuracies from $0.005 \%$ through $20 \%$. Resistors can be made from metal films, metaloxide films, or carbon films; from carbon-composition or
ceramic-composition moldings; from metal foil or metal wire wound on a form; or from semiconductor elements similar to field-effect transistors (FETs). The most commonly used resistor type is formed from a carbon, metal, or oxide film, and comes in two widely used "packages": the cylindrical axial-lead type (typified by the generic RN55D $1 \% 1 / 4 \mathrm{~W}$ metal-film resistor), ${ }^{8}$ and the much smaller surface-mount "chip resistor." These common types come in $5 \%, 2 \%$, and $1 \%$ tolerances, in a standard set of values ranging from $1 \Omega$ to $10 \mathrm{M} \Omega$. The $1 \%$ types have 96 values per decade, whereas the $2 \%$ and $5 \%$ types have 48 and 24 values per decade (see Appendix C). Figure 1.2 illustrates most of the common resistor packages.

Resistors are so easy to use and well behaved that they're often taken for granted. They're not perfect, though, and you should be aware of some of their limitations so that you won't be surprised someday. The principal defects are variations in resistance with temperature, voltage, time, and humidity. Other defects relate to inductance (which may be serious at high frequencies), the development of thermal hot spots in power applications, or electrical noise generation in low-noise amplifiers. We treat these in the advanced Chapter $1 x$.
voltage to a current, and vice versa. This may sound awfully trite, but you will soon see what we mean.

#### B. Resistors in series and parallel

From the definition of $R$, some simple results follow:

1. The resistance of two resistors in series (Figure 1.4) is

$$
\begin{equation*}
R=R_{1}+R_{2} \tag{1.3}
\end{equation*}
$$

By putting resistors in series, you always get a larger resistor.
2. The resistance of two resistors in parallel (Figure 1.5) is

$$
\begin{equation*}
R=\frac{R_{1} R_{2}}{R_{1}+R_{2}} \quad \text { or } \quad R=\frac{1}{\frac{1}{R_{1}}+\frac{1}{R_{2}}} \tag{1.4}
\end{equation*}
$$

By putting resistors in parallel, you always get a smaller resistor. Resistance is measured in ohms $(\Omega)$, but in practice we frequently omit the $\Omega$ symbol when referring to resistors that are more than $1000 \Omega(1 \mathrm{k} \Omega)$. Thus, a $4.7 \mathrm{k} \Omega$ resistor is often referred to as a 4.7 k resistor, and a $1 \mathrm{M} \Omega$

[^6]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0038.jpg?height=68&width=353&top_left_y=1346&top_left_x=1293)

Figure 1.4. Resistors in series.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0038.jpg?height=154&width=345&top_left_y=1520&top_left_x=1297)

Figure 1.5. Resistors in parallel.
resistor as a 1 M resistor (or 1 meg ). ${ }^{9}$ If these preliminaries bore you, please have patience - we'll soon get to numerous amusing applications.
Exercise 1.1. You have a 5 k resistor and a 10 k resistor. What is their combined resistance (a) in series and (b) in parallel?
Exercise 1.2. If you place a 1 ohm resistor across a 12 volt car battery, how much power will it dissipate?

Exercise 1.3. Prove the formulas for series and parallel resistors.

[^7]Exercise 1.4. Show that several resistors in parallel have resistance

$$
\begin{equation*}
R=\frac{1}{\frac{1}{R_{1}}+\frac{1}{R_{2}}+\frac{1}{R_{3}}+\cdots} \tag{1.5}
\end{equation*}
$$

Beginners tend to get carried away with complicated algebra in designing or trying to understand electronics. Now is the time to begin learning intuition and shortcuts. Here are a couple of good tricks:

Shortcut \#1 A large resistor in series (parallel) with a small resistor has the resistance of the larger (smaller) one, roughly. So you can "trim" the value of a resistor up or down by connecting a second resistor in series or parallel: to trim up, choose an available resistor value below the target value, then add a (much smaller) series resistor to make up the difference; to trim down, choose an available resistor value above the target value, then connect a (much larger) resistor in parallel. For the latter you can approximate with proportions - to lower the value of a resistor by $1 \%$, say, put a resistor 100 times as large in parallel. ${ }^{10}$
Shortcut \#2 Suppose you want the resistance of 5k in parallel with 10 k . If you think of the 5 k as two 10 k 's in parallel, then the whole circuit is like three 10k's in parallel. Because the resistance of $n$ equal resistors in parallel is $1 / n$th the resistance of the individual resistors, the answer in this case is $10 \mathrm{k} / 3$, or 3.33 k . This trick is handy because it allows you to analyze circuits quickly in your head, without distractions. We want to encourage mental designing, or at least "back-of-the-envelope" designing, for idea brainstorming.

Some more home-grown philosophy: there is a tendency among beginners to want to compute resistor values and other circuit component values to many significant places, particularly with calculators and computers that readily oblige. There are two reasons you should try to avoid falling into this habit: (a) the components themselves are of finite precision (resistors typically have tolerances of $\pm 5 \%$ or $\pm 1 \%$; for capacitors it's typically $\pm 10 \%$ or $\pm 5 \%$; and the parameters that characterize transistors, say, frequently are known only to a factor of 2); (b) one mark of a good circuit design is insensitivity of the finished circuit to precise values of the components (there are exceptions, of course). You'll also learn circuit intuition more quickly if you get into the habit of doing approximate calculations in your head, rather than watching meaningless numbers pop up on a calculator display. We believe strongly that reliance on formulas and equations early in your electronic circuit

[^8]education is a fine way to prevent you from understanding what's really going on.

In trying to develop intuition about resistance, some people find it helpful to think about conductance, $G=1 / R$. The current through a device of conductance $G$ bridging a voltage $V$ is then given by $I=G V$ (Ohm's law). A small resistance is a large conductance, with correspondingly large current under the influence of an applied voltage. Viewed in this light, the formula for parallel resistors is obvious: when several resistors or conducting paths are connected across the same voltage, the total current is the sum of the individual currents. Therefore the net conductance is simply the sum of the individual conductances, $G=G_{1}+G_{2}+G_{3}+\cdots$, which is the same as the formula for parallel resistors derived earlier.

Engineers are fond of defining reciprocal units, and they have designated as the unit of conductance the siemens $(\mathrm{S}=1 / \Omega$ ), also known as the mho (that's ohm spelled backward, given the symbol $\mho$ ). Although the concept of conductance is helpful in developing intuition, it is not used widely; ${ }^{11}$ most people prefer to talk about resistance instead.

#### C. Power in resistors

The power dissipated by a resistor (or any other device) is $P=I V$. Using Ohm's law, you can get the equivalent forms $P=I^{2} R$ and $P=V^{2} / R$.
Exercise 1.5. Show that it is not possible to exceed the power rating of a $1 / 4$ watt resistor of resistance greater than 1 k , no matter how you connect it, in a circuit operating from a 15 volt battery.

Exercise 1.6. Optional exercise: New York City requires about $10^{10}$ watts of electrical power, at 115 volts ${ }^{12}$ (this is plausible: 10 million people averaging 1 kilowatt each). A heavy power cable might be an inch in diameter. Let's calculate what will happen if we try to supply the power through a cable 1 foot in diameter made of pure copper. Its resistance is $0.05 \mu \Omega\left(5 \times 10^{-8}\right.$ ohms) per foot. Calculate (a) the power lost per foot from " $I^{2} R$ losses," (b) the length of cable over which you will lose all $10^{10}$ watts, and (c) how hot the cable will get, if you know the physics involved ( $\sigma=6 \times 10^{-12} \mathrm{~W} / \mathrm{K}^{4} \mathrm{~cm}^{2}$ ). If you have done your computations correctly, the result should seem preposterous. What is the solution to this puzzle?
${ }^{11}$ Although the elegant Millman's theorem has its admirers: it says that the output voltage from a set of resistors (call them $R_{i}$ ) that are driven from a set of corresponding input voltages $\left(V_{i}\right)$ and connected together at the output is $V_{\text {out }}=\left(\sum V_{i} G_{i}\right) / \sum G_{i}$, where the $G_{i}$ are the conductances $\left(G_{i}=1 / R_{i}\right)$.
${ }^{12}$ Although the "official" line voltage is $120 \mathrm{~V} \pm 5 \%$, you'll sometimes see $110 \mathrm{~V}, 115 \mathrm{~V}$, or 117 V . This loose language is OK (and we use it in this book), because (a) the median voltage at the wall plug is 3 to 5 volts lower, when powering stuff; and (b) the minimum wall-plug voltage is 110 V . See ANSI standard C84.1.

#### D. Input and output

Nearly all electronic circuits accept some sort of applied input (usually a voltage) and produce some sort of corresponding output (which again is often a voltage). For example, an audio amplifier might produce a (varying) output voltage that is 100 times as large as a (similarly varying) input voltage. When describing such an amplifier, we imagine measuring the output voltage for a given applied input voltage. Engineers speak of the transfer function $\mathbf{H}$, the ratio of (measured) output divided by (applied) input; for the audio amplifier above, $\mathbf{H}$ is simply a constant $(\mathbf{H}=100)$. We'll get to amplifiers soon enough, in the next chapter. However, with only resistors we can already look at a very important circuit fragment, the voltage divider (which you might call a "de-amplifier").

### 1.2.3 Voltage dividers

We now come to the subject of the voltage divider, one of the most widespread electronic circuit fragments. Show us any real-life circuit and we'll show you half a dozen voltage dividers. To put it very simply, a voltage divider is a circuit that, given a certain voltage input, produces a predictable fraction of the input voltage as the output voltage. The simplest voltage divider is shown in Figure 1.6.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0040.jpg?height=274&width=555&top_left_y=1246&top_left_x=340)

Figure 1.6. Voltage divider. An applied voltage $V_{\text {in }}$ results in a (smaller) output voltage $V_{\text {out }}$.

An important word of explanation: when engineers draw a circuit like this, it's generally assumed that the $V_{\text {in }}$ on the left is a voltage that you are applying to the circuit, and that the $V_{\text {out }}$ on the right is the resulting output voltage (produced by the circuit) that you are measuring (or at least are interested in). You are supposed to know all this (a) because of the convention that signals generally flow from left to right, (b) from the suggestive names ("in," "out") of the signals, and (c) from familiarity with circuits like this. This may be confusing at first, but with time it becomes easy.

What is $V_{\text {out }}$ ? Well, the current (same everywhere, assuming no "load" on the output; i.e., nothing connected across the output) is

$$
I=\frac{V_{\text {in }}}{R_{1}+R_{2}}
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0040.jpg?height=603&width=542&top_left_y=206&top_left_x=1198)

Figure 1.7. An adjustable voltage divider can be made from a fixed and variable resistor, or from a potentiometer. In some contemporary circuits you'll find instead a long series chain of equal-value resistors, with an arrangement of electronic switches that lets you choose any one of the junctions as the output; this sounds much more complicated - but it has the advantage that you can adjust the voltage ratio electrically (rather than mechanically).
(We've used the definition of resistance and the series law.) Then, for $R_{2}$,

$$
\begin{equation*}
V_{\mathrm{out}}=I R_{2}=\frac{R_{2}}{R_{1}+R_{2}} V_{\mathrm{in}} \tag{1.6}
\end{equation*}
$$

Note that the output voltage is always less than (or equal to) the input voltage; that's why it's called a divider. You could get amplification (more output than input) if one of the resistances were negative. This isn't as crazy as it sounds; it is possible to make devices with negative "incremental" resistances (e.g., the component known as a tunnel diode) or even true negative resistances (e.g., the negativeimpedance converter that we will talk about later in the book, §6.2.4B). However, these applications are rather specialized and need not concern you now.

Voltage dividers are often used in circuits to generate a particular voltage from a larger fixed (or varying) voltage. For instance, if $V_{\text {in }}$ is a varying voltage and $R_{2}$ is an adjustable resistor (Figure 1.7A), you have a "volume control"; more simply, the combination $R_{1} R_{2}$ can be made from a single variable resistor, or potentiometer (Figure 1.7B). This and similar applications are common, and potentiometers come in a variety of styles, some of which are shown in Figure 1.8.

The humble voltage divider is even more useful, though, as a way of thinking about a circuit: the input voltage and upper resistance might represent the output of an amplifier, say, and the lower resistance might represent the input of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0041.jpg?height=897&width=1392&top_left_y=225&top_left_x=248)

Figure 1.8. Most of the common potentiometer styles are shown here. Top row, left to right (panel mount): power wirewound, "type AB" 2W carbon composition, 10-turn wirewound/plastic hybrid, ganged dual pot. Middle row (panel mount): optical encoder (continuous rotation, 128 cycles per turn), single-turn cermet, single-turn carbon, screw-adjust single-turn locking. Front row (board-mount trimmers): multiturn side-adjust (two styles), quad single-turn, $3 / 8^{\prime \prime}$ ( 9.5 mm ) square single-turn, $1 / 4^{\prime \prime}$ ( 6.4 mm ) square single-turn, $1 / 4^{\prime \prime}$ ( 6.4 mm ) round single-turn, 4 mm square single-turn surface mount, 4 mm square multiturn surface mount, $3 / 8^{\prime \prime}(9.5 \mathrm{~mm}$ ) square multiturn, quad nonvolatile 256-step integrated pot ( $\mathrm{E}^{2} \mathrm{POT}$ ) in 24-pin small-outline IC.
the following stage. In this case the voltage-divider equation tells you how much signal gets to the input of that last stage. This will all become clearer after you know about a remarkable fact (Thévenin's theorem) that will be discussed later. First, though, a short aside on voltage sources and current sources.

### 1.2.4 Voltage sources and current sources

A perfect voltage source is a two-terminal "black box" that maintains a fixed voltage drop across its terminals, regardless of load resistance. This means, for instance, that it must supply a current $I=V / R$ when a resistance $R$ is attached to its terminals. A real voltage source can supply only a finite maximum current, and in addition it generally behaves like a perfect voltage source with a small resistance in series. Obviously, the smaller this series resistance, the better. For example, a standard 9 volt alkaline battery behaves approximately like a perfect 9 volt voltage source in series with a $3 \Omega$ resistor, and it can provide a maximum
current (when shorted) of 3 amps (which, however, will kill the battery in a few minutes). A voltage source "likes" an open-circuit load and "hates" a short-circuit load, for obvious reasons. (The meaning of "open circuit" and "short circuit" sometimes confuse the beginner: an open circuit has nothing connected to it, whereas a short circuit is a piece of wire bridging the output.) The symbols used to indicate a voltage source are shown in Figure 1.9.

A perfect current source is a two-terminal black box that maintains a constant current through the external circuit, regardless of load resistance or applied voltage. To do this it must be capable of supplying any necessary voltage across its terminals. Real current sources (a muchneglected subject in most textbooks) have a limit to the voltage they can provide (called the output-voltage compliance, or just compliance), and in addition they do not provide absolutely constant output current. A current source "likes" a short-circuit load and "hates" an open-circuit load. The symbols used to indicate a current source are shown in Figure 1.10.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0042.jpg?height=261&width=822&top_left_y=209&top_left_x=209)

Figure 1.9. Voltage sources can be either steady (dc) or varying (ac).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0042.jpg?height=161&width=386&top_left_y=649&top_left_x=424)

Figure 1.10. Current-source symbols.

A battery is a real-life approximation to a voltage source (there is no analog for a current source). A standard D-size flashlight cell, for instance, has a terminal voltage of 1.5 V , an equivalent series resistance of about $0.25 \Omega$, and a total energy capacity of about 10,000 watt-seconds (its characteristics gradually deteriorate with use; at the end of its life, the voltage may be about 1.0 V , with an internal series resistance of several ohms). It is easy to construct voltage sources with far better characteristics, as you will learn when we come to the subject of feedback; this is a major topic of Chapter 9. Except in the important class of devices intended for portability, the use of batteries in electronic devices is rare.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0042.jpg?height=430&width=684&top_left_y=1466&top_left_x=278)

Figure 1.11. The Thévenin equivalent circuit.

### 1.2.5 Thévenin equivalent circuit

Thévenin's theorem states ${ }^{12}$ that any two-terminal network of resistors and voltage sources is equivalent to a single

[^9]resistor $R$ in series with a single voltage source $V$. This is remarkable. Any mess of batteries and resistors can be mimicked with one battery and one resistor (Figure 1.11). (Incidentally, there's another theorem, Norton's theorem, that says you can do the same thing with a current source in parallel with a resistor.)

How do you figure out the Thévenin equivalent $R_{\mathrm{Th}}$ and $V_{\mathrm{Th}}$ for a given circuit? Easy! $V_{\mathrm{Th}}$ is the open-circuit voltage of the Thévenin equivalent circuit; so if the two circuits behave identically, it must also be the open-circuit voltage of the given circuit (which you get by calculation, if you know what the circuit is, or by measurement, if you don't). Then you find $R_{\mathrm{Th}}$ by noting that the short-circuit current of the equivalent circuit is $V_{\mathrm{Th}} / R_{\mathrm{Th}}$. In other words,

$$
\begin{align*}
V_{\mathrm{Th}} & =V(\text { open circuit }), \\
R_{\mathrm{Th}} & =\frac{V(\text { open circuit })}{I(\text { short circuit })} . \tag{1.7}
\end{align*}
$$

Let's apply this method to the voltage divider, which must have a Thévenin equivalent:

1. The open-circuit voltage is

$$
V=V_{\text {in }} \frac{R_{2}}{R_{1}+R_{2}} .
$$

2. The short-circuit current is

$$
V_{\text {in }} / R_{1}
$$

So the Thévenin equivalent circuit is a voltage source,

$$
\begin{equation*}
V_{\mathrm{Th}}=V_{\mathrm{in}} \frac{R_{2}}{R_{1}+R_{2}}, \tag{1.8}
\end{equation*}
$$

in series with a resistor,

$$
\begin{equation*}
R_{\mathrm{Th}}=\frac{R_{1} R_{2}}{R_{1}+R_{2}} \tag{1.9}
\end{equation*}
$$

(It is not a coincidence that this happens to be the parallel resistance of $R_{1}$ and $R_{2}$. The reason will become clear later.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0042.jpg?height=248&width=547&top_left_y=1751&top_left_x=1196)

Figure 1.12. Thévenin equivalent of a voltage divider.
From this example it is easy to see that a voltage divider is not a very good battery, in the sense that its output voltage drops severely when a load is attached. As an example, consider Exercise 1.10. You now know everything you need to know to calculate exactly how much the output will

MULTIMETERS

There are numerous instruments that let you measure voltages and currents in a circuit. The oscilloscope is the most versatile; it lets you "see" voltages versus time at one or more points in a circuit. Logic probes and logic analyzers are special-purpose instruments for troubleshooting digital circuits. The simple multimeter provides a good way to measure voltage, current, and resistance, often with good precision; however, it responds slowly, and thus it cannot replace the oscilloscope where changing voltages are of interest. Multimeters are of two varieties: those that indicate measurements on a conventional scale with a moving pointer, and those that use a digital display.

The traditional (and now largely obsolete) VOM (volt-ohmmilliammeter) multimeter uses a meter movement that measures current (typically $50 \mu \mathrm{~A}$ full scale). (See a less-design-oriented electronics book for pretty pictures of the innards of meter movements; for our purposes, it suffices to say that it uses coils and magnets.) To measure voltage, the VOM puts a resistor in series with the basic movement. For instance, one kind of VOM will generate a 1 V (full-scale) range by putting a 20 k resistor in series with the standard $50 \mu \mathrm{~A}$ movement; higher voltage ranges use correspondingly larger resistors. Such a VOM is specified as $20,000 \Omega / \mathrm{V}$, meaning that it looks like a resistor whose value is 20 k multiplied by the full-scale voltage of the particular range selected. Full scale on any voltage range is $1 / 20,000 \mathrm{amps}$, or $50 \mu \mathrm{~A}$. It should be clear that one of these voltmeters disturbs a circuit less on a higher range, since it looks like a higher resistance (think of the voltmeter as the lower leg of a voltage divider, with the Thévenin resistance of the circuit you are measuring as the upper resistor). Ideally, a voltmeter should have infinite input resistance.

Most contemporary multimeters use electronic amplification and have an input resistance of $10 \mathrm{M} \Omega$ to $1000 \mathrm{M} \Omega$ when measuring voltage; they display their results digitally, and are known collectively as digital multimeters (DMMs). A word of caution: sometimes the input resistance of these meters is very high on the most sensitive ranges, dropping to a lower resistance for the higher ranges. For instance, you might typically have an input resistance of $10^{9} \Omega$ on the 0.2 V and 2 V ranges, and $10^{7} \Omega$ on all higher ranges. Read the specifications carefully! However, for most circuit measurements these high input resistances will produce negligible loading effects. In any case, it is easy to calculate how serious the effect is by using the voltage-divider equation. Typically, multimeters provide voltage ranges from a volt (or less) to a kilovolt (or more), full scale.

A multimeter usually includes current-measuring capability, with a
set of switchable ranges. Ideally, a current-measuring meter should have zero resistance ${ }^{13}$ in order not to disturb the circuit under test, since it must be put in series with the circuit. In practice, you tolerate a few tenths of a volt drop (sometimes called "voltage burden") with both VOMs and digital multimeters. For either kind of meter, selecting a current range puts a small resistor across the meter's input terminals, typically of resistance value to create a voltage drop of 0.1 V to 0.25 V for the chosen full-scale current; the voltage drop is then converted to a corresponding current indication. ${ }^{14}$ Typically, multimeters provide current ranges from $50 \mu \mathrm{~A}$ (or less) to an amp (or more), full scale.

Multimeters also have one or more batteries in them to power the resistance measurement. By supplying a small current and measuring the voltage drop, they measure resistance, with several ranges to cover values from $1 \Omega$ (or less) to $10 \mathrm{M} \Omega$ (or more).

Important: don't try to measure "the current of a voltage source," by sticking the meter across the wall plug; the same applies for ohms. This is a leading cause of blown-out meters.

Exercise 1.7. What will a $20,000 \Omega / \mathrm{V}$ meter read, on its 1 V scale, when attached to a 1 V source with an internal resistance of 10 k ? What will it read when attached to a $10 \mathrm{k}-10 \mathrm{k}$ voltage divider driven by a "stiff" (zero source resistance) 1 V source?

Exercise 1.8. A $50 \mu \mathrm{~A}$ meter movement has an internal resistance of 5 k . What shunt resistance is needed to convert it to a $0-1$ A meter? What series resistance will convert it to a $0-10 \mathrm{~V}$ meter?

Exercise 1.9. The very high internal resistance of digital multimeters, in their voltage-measuring ranges, can be used to measure extremely low currents (even though the DMM may not offer a low current range explicitly). Suppose, for example, you want to measure the small current that flows through a $1000 \mathrm{M} \Omega$ "leakage" resistance (that term is used to describe a small current that ideally should be absent entirely, for example through the insulation of an underground cable). You have available a standard DMM, whose 2 V dc range has $10 \mathrm{M} \Omega$ internal resistance, and you have available a dc source of +10 V . How can you use what you've got to measure accurately the leakage resistance?
drop for a given load resistance: use the Thévenin equivalent circuit, attach a load, and calculate the new output, noting that the new circuit is nothing but a voltage divider (Figure 1.12).

Exercise 1.10. For the circuit shown in Figure 1.12, with

[^10]$V_{\text {in }}=30 \mathrm{~V}$ and $R_{1}=R_{2}=10 \mathrm{k}$, find (a) the output voltage with no load attached (the open-circuit voltage); (b) the output voltage with a 10 k load (treat as a voltage divider, with $R_{2}$ and $R_{\text {load }}$ combined into a single resistor); (c) the Thévenin equivalent circuit; (d) the same as in part (b), but using the Thévenin equivalent circuit [again, you wind up with a voltage divider; the answer should agree with the result in part (b)]; (e) the power dissipated in each of the resistors.

#### A. Equivalent source resistance and circuit loading

As we have just seen, a voltage divider powered from some fixed voltage is equivalent to some smaller voltage source
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0044.jpg?height=389&width=797&top_left_y=219&top_left_x=221)

Figure 1.13. Voltage divider example.
in series with a resistor. For example, the output terminals of a $10 \mathrm{k}-10 \mathrm{k}$ voltage divider driven by a perfect 30 volt battery are precisely equivalent to a perfect 15 volt battery in series with a 5 k resistor (Figure 1.13). Attaching a load resistor causes the voltage divider's output to drop, owing to the finite source resistance (Thévenin equivalent resistance of the voltage divider output, viewed as a source of voltage). This is often undesirable. One solution to the problem of making a stiff voltage source ("stiff" is used in this context to describe something that doesn't bend under load) might be to use much smaller resistors in a voltage divider. Occasionally this brute-force approach is useful. However, it is usually best to construct a voltage source, or power supply, as it's commonly called, using active components like transistors or operational amplifiers, which we will treat in Chapters 2-4. In this way you can easily make a voltage source with internal (Thévenin equivalent) resistance as small as milliohms (thousandths of an ohm), without the large currents and dissipation of power characteristic of a low-resistance voltage divider delivering the same performance. In addition, with an active power supply it is easy to make the output voltage adjustable. These topics are treated extensively in Chapter 9.

The concept of equivalent internal resistance applies to all sorts of sources, not just batteries and voltage dividers. Signal sources (e.g., oscillators, amplifiers, and sensing devices) all have an equivalent internal resistance. Attaching a load whose resistance is less than or even comparable to the internal resistance will reduce the output considerably. This undesirable reduction of the open-circuit voltage (or signal) by the load is called "circuit loading." Therefore you should strive to make $R_{\text {load }} \gg R_{\text {internal }}$, because a high-resistance load has little attenuating effect on the source (Figure 1.14). ${ }^{15}$ We will see numerous circuit

[^11]examples in the chapters ahead. This high-resistance condition ideally characterizes measuring instruments such as voltmeters and oscilloscopes.

A word on language: you frequently hear things like "the resistance looking into the voltage divider" or "the output sees a load of so-and-so many ohms," as if circuits had eyes. It's OK (in fact, it's a rather good way of keeping straight which resistance you're talking about) to say what part of the circuit is doing the "looking." ${ }^{16}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0044.jpg?height=583&width=820&top_left_y=614&top_left_x=1059)

Figure 1.14. To minimize the attenuation of a signal source below its open-circuit voltage, keep the load resistance large compared with the output resistance.

#### B. Power transfer

Here is an interesting problem: what load resistance will result in maximum power being transferred to the load for a given source resistance? (The terms source resistance, internal resistance, and Thévenin equivalent resistance all mean the same thing.) It is easy to see that either $R_{\text {load }}=0$ or $R_{\text {load }}=\infty$ results in zero power transferred, because $R_{\text {load }}=0$ means that $V_{\text {load }}=0$ and $I_{\text {load }}=V_{\text {source }} / R_{\text {source }}$, so that $P_{\text {load }}=V_{\text {load }} I_{\text {load }}=0$. But $R_{\text {load }}=\infty$ means that $V_{\text {load }}=V_{\text {source }}$ and $I_{\text {load }}=0$, so that again $P_{\text {load }}=0$. There has to be a maximum in between.

Exercise 1.11. Show that $R_{\text {load }}=R_{\text {source }}$ maximizes the power in the load for a given source resistance. Note: skip this exercise if you don't know calculus, and take it on faith that the answer is true.

[^12]Lest this example leave the wrong impression, we would like to emphasize again that circuits are ordinarily designed so that the load resistance is much greater than the source resistance of the signal that drives the load.

### 1.2.6 Small-signal resistance

We often deal with electronic devices for which $I$ is not proportional to $V$; in such cases there's not much point in talking about resistance, since the ratio $V / I$ will depend on $V$, rather than being a nice constant, independent of $V$. For these devices it is sometimes useful to know instead the slope of the $V-I$ curve, in other words, the ratio of a small change in applied voltage to the resulting change in current through the device, $\Delta V / \Delta I$ (or $d V / d I$ ). This quantity has the units of resistance (ohms) and substitutes for resistance in many calculations. It is called the small-signal resistance, incremental resistance, or dynamic resistance.

#### A. Zener diodes

As an example, consider the zener diode, which has the $I-V$ curve shown in Figure 1.15. Zeners are used to create a constant voltage inside a circuit somewhere, simply done by providing them with a (roughly constant) current derived from a higher voltage within the circuit. ${ }^{17}$ For example, the zener diode in Figure 1.15 will convert an applied current in the range shown to a corresponding (but fractionally narrower) range of voltages. It is important to know how the resulting zener voltage will change with applied current; this is a measure of its "regulation" against changes in the driving current provided to it. Included in the specifications of a zener will be its dynamic resistance, given at a certain current. For example, a zener might have a dynamic resistance of $10 \Omega$ at 10 mA , at its specified zener voltage of 5 V . Using the definition of dynamic resistance, we find that a $10 \%$ change in applied current will therefore result in a change in voltage of

$$
\Delta V=R_{\mathrm{dyn}} \Delta I=10 \times 0.1 \times 0.01=10 \mathrm{mV}
$$

or

$$
\Delta V / V=0.002=0.2 \%
$$

thus demonstrating good voltage-regulating ability. In this sort of application you frequently get the zener current
${ }^{17}$ Zeners belong to the more general class of diodes and rectifiers, important devices that we'll see later in the chapter (\$1.6), and indeed throughout the book. The ideal diode (or rectifier) acts as a perfect conductor for current flow in one direction, and a perfect insulator for current flow in the reverse direction; it is a "one-way valve" for current.
through a resistor from a higher voltage available somewhere in the circuit, as in Figure 1.16.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0045.jpg?height=809&width=661&top_left_y=325&top_left_x=1047)

Figure 1.15. I-V curves: A. Resistor (linear). B. Zener diode (nonlinear).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0045.jpg?height=151&width=263&top_left_y=1307&top_left_x=1246)

Figure 1.16. Zener regulator.
Then,

$$
I=\frac{V_{\text {in }}-V_{\text {out }}}{R}
$$

and

$$
\Delta I=\frac{\Delta V_{\mathrm{in}}-\Delta V_{\mathrm{out}}}{R}
$$

so

$$
\Delta V_{\mathrm{out}}=R_{\mathrm{dyn}} \Delta I=\frac{R_{\mathrm{dyn}}}{R}\left(\Delta V_{\mathrm{in}}-\Delta V_{\mathrm{out}}\right)
$$

and finally

$$
\Delta V_{\mathrm{out}}=\frac{R_{\mathrm{dyn}}}{R+R_{\mathrm{dyn}}} \Delta V_{\mathrm{in}}
$$

Aha - the voltage-divider equation, again! Thus, for changes in voltage, the circuit behaves like a voltage divider, with the zener replaced by a resistor equal to its dynamic resistance at the operating current. This is the
utility of incremental resistance. For instance, suppose in the preceding circuit we have an input voltage ranging between 15 and 20 V , and we use a 1 N 4733 ( 5.1 V , 1 W zener diode) in order to generate a stable 5.1 V power supply. We choose $R=300 \Omega$, for a maximum zener current of 50 mA : $(20 \mathrm{~V}-5.1 \mathrm{~V}) / 300 \Omega$. We can now estimate the output-voltage regulation (variation in output voltage), knowing that this particular zener has a specified maximum dynamic resistance of $7.0 \Omega$ at 50 mA . The zener current varies from 50 mA to 33 mA over the input-voltage range; this 17 mA change in current then produces a voltage change at the output of $\Delta V=R_{\mathrm{dyn}} \Delta I$, or 0.12 V .

It's a useful fact, when dealing with zener diodes, that the dynamic resistance of a zener diode varies roughly in inverse proportion to current. It's worth knowing, also, that there are ICs designed to substitute for zener diodes; these "two-terminal voltage references" have superior performance - much lower dynamic resistance (less than $1 \Omega$, even at currents as small as 0.1 mA ; that's a thousand times better than the zener we just used), and excellent temperature stability (better than $0.01 \% / \mathrm{C}$ ). We will see more of zeners and voltage references in $\S \S 2.2 .4$ and 9.10.

In real life, a zener will provide better regulation if driven by a current source, which has, by definition, $R_{\text {incr }}=\infty$ (the same current, regardless of voltage). But current sources are more complex, and therefore in practice we often resort to the humble resistor. When thinking about zeners, it's worth remembering that low-voltage units (e.g., 3.3 V ) behave rather poorly, in terms of constancy of voltage versus current (Figure 1.17); if you think you need a low voltage zener, use a two-terminal reference instead (§9.10).

### 1.2.7 An example: "It's too hot!"

Some people like to turn the thermostat way up, annoying other people who like their houses cool. Here's a little gadget (Figure 1.18) that lets folks of the latter persuasion know when to complain - it lights up a red light-emitting diode (LED) indicator when the room is warmer than $30^{\circ} \mathrm{C}$ $\left(86^{\circ} \mathrm{F}\right)$. It also shows how to use the humble voltage divider (and even humbler Ohm's law), and how to deal with an LED, which behaves like a zener diode (and is sometimes used as such).

The triangular symbol is a comparator, a handy device (discussed in §12.3) that switches its output according to the relative voltages at its two input terminals. The temperature sensing device is $R_{4}$, which decreases in resistance by about $4 \% /{ }^{\circ} \mathrm{C}$, and which is $10 \mathrm{k} \Omega$ at $25^{\circ} \mathrm{C}$. So we've made
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0046.jpg?height=568&width=767&top_left_y=221&top_left_x=1086)

Figure 1.17. Low-voltage zeners are pretty dismal, as seen in these measured $I$ vs. $V$ curves (for three members of the 1N522167 series), particularly in contrast to the excellent measured performance of a pair of "IC voltage references" (LM385Z-1.2 and LM385Z-2.5, see $\S 9.10$ and Table 9.7). However, zener diodes in the neighborhood of 6 V (such as the 5.6 V 1 N 5232 B or 6.2 V 1N5234B) exhibit admirably steep curves, and are useful parts.
it the lower leg of a voltage divider $\left(R_{3} R_{4}\right)$, whose output is compared with the temperature-insensitive divider $R_{1} R_{2}$. When it's hotter than $30^{\circ} \mathrm{C}$, point " X " is at a lower voltage than point "Y," so the comparator pulls its output to ground.

At the output there's an LED, which behaves electrically like a 1.6 V zener diode; and when current is flowing, it lights up. Its lower terminal is then at $5 \mathrm{~V}-1.6 \mathrm{~V}$, or +3.4 V . So we've added a series resistor, sized to allow 5 mA when the comparator output is at ground: $R_{5}=3.4 \mathrm{~V} / 5 \mathrm{~mA}$, or $680 \Omega$.

If you wanted to, you could make the setpoint adjustable by replacing $R_{2}$ with a 5 k pot in series with a 5 k fixed resistor. We'll see later that it's also a good idea to add some hysteresis, to encourage the comparator to be decisive. Note that this circuit is insensitive to the exact powersupply voltage because it compares ratios. Ratiometric techniques are good; we'll see them again later.

## 1.3 Signals

A later section in this chapter will deal with capacitors, devices whose properties depend on the way the voltages and currents in a circuit are changing. Our analysis of dc circuits so far (Ohm's law, Thévenin equivalent circuits, etc.) still holds, even if the voltages and currents are changing in time. But for a proper understanding of alternating-current (ac) circuits, it is useful to have in mind certain common
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0047.jpg?height=422&width=721&top_left_y=187&top_left_x=160)

Figure 1.18. The LED lights up when it's hotter than $30^{\circ} \mathrm{C}$. The comparator (which we'll see later, in Chapters 4 and 12) pulls its output to ground when the voltage at " X " is less than the voltage at "Y." $R_{4}$ is a thermistor, which is a resistor with a deliberate negative temperature coefficient; that is, its resistance decreases with increasing temperature - by about $4 \% /{ }^{\circ} \mathrm{C}$.
types of signals, voltages that change in time in a particular way.

### 1.3.1 Sinusoidal signals

Sinusoidal signals are the most popular signals around; they're what you get out of the wall plug. If someone says something like "take a $10 \mu \mathrm{~V}$ signal at 1 MHz ," they mean a sinewave. Mathematically, what you have is a voltage described by

$$
\begin{equation*}
V=A \sin 2 \pi f t \tag{1.10}
\end{equation*}
$$

where $A$ is called the amplitude and $f$ is the frequency in hertz (cycles per second). A sinewave looks like the wave shown in Figure 1.19. Sometimes it is important to know the value of the signal at some arbitrary time $t=0$, in which case you may see a phase $\phi$ in the expression:

$$
V=A \sin (2 \pi f t+\phi)
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0047.jpg?height=268&width=545&top_left_y=1718&top_left_x=253)

Figure 1.19. Sinewave of amplitude $A$ and frequency $f$.
The other variation on this simple theme is the use of angular frequency, which looks like this:

$$
V=A \sin \omega t
$$

Here $\omega$ is the angular frequency, measured in radians per
second. Just remember the important relation $\omega=2 \pi f$ and you won't go wrong.

The great merit of sinewaves (and the cause of their perennial popularity) is the fact that they are the solutions to certain linear differential equations that happen to describe many phenomena in nature as well as the properties of linear circuits. A linear circuit has the property that its output, when driven by the sum of two input signals, equals the sum of its individual outputs when driven by each input signal in turn; i.e., if $\mathscr{O}(A)$ represents the output when driven by signal $A$, then a circuit is linear if $\mathscr{O}(A+B)=\mathscr{O}(A)+\mathscr{O}(B)$. A linear circuit driven by a sinewave always responds with a sinewave, although in general the phase and amplitude are changed. No other periodic signal can make this statement. It is standard practice, in fact, to describe the behavior of a circuit by its frequency response, by which we mean the way the circuit alters the amplitude of an applied sinewave as a function of frequency. A stereo amplifier, for instance, should be characterized by a "flat" frequency response over the range 20 Hz to 20 kHz , at least.

The sinewave frequencies we usually deal with range from a few hertz to a few tens of megahertz. Lower frequencies, down to 0.0001 Hz or lower, can be generated with carefully built circuits, if needed. Higher frequencies, up to say 2000 MHz ( 2 GHz ) and above, can be generated, but they require special transmission-line techniques. Above that, you're dealing with microwaves, for which conventional wired circuits with lumped-circuit elements become impractical, and exotic waveguides or "striplines" are used instead.

### 1.3.2 Signal amplitudes and decibels

In addition to its amplitude, there are several other ways to characterize the magnitude of a sinewave or any other signal. You sometimes see it specified by peak-to-peak amplitude (pp amplitude), which is just what you would guess, namely, twice the amplitude. The other method is to give the root-mean-square amplitude (rms amplitude), which is $V_{\mathrm{rms}}=(1 / \sqrt{2}) A=0.707 A$ (this is for sinewaves only; the ratio of pp to rms will be different for other waveforms). Odd as it may seem, this is the usual method, because rms voltage is what's used to compute power. The nominal voltage across the terminals of a wall socket (in the United States) is 120 volts $\mathrm{rms}, 60 \mathrm{~Hz}$. The amplitude is 170 volts (339 volts pp). ${ }^{18}$

[^13]
#### A. Decibels

How do you compare the relative amplitudes of two signals? You could say, for instance, that signal $X$ is twice as large as signal $Y$. That's fine, and useful for many purposes. But because we often deal with ratios as large as a million, it is better to use a logarithmic measure, and for this we present the decibel (it's one-tenth as large as something called a bel, which no one ever uses). By definition, the ratio of two signals, in decibels ( dB ), is

$$
\begin{equation*}
\mathrm{dB}=10 \log _{10} \frac{P_{2}}{P_{1}} \tag{1.11}
\end{equation*}
$$

where $P_{1}$ and $P_{2}$ represent the power in the two signals. We are often dealing with signal amplitudes, however, in which case we can express the ratio of two signals having the same waveform as

$$
\begin{equation*}
\mathrm{dB}=20 \log _{10} \frac{A_{2}}{A_{1}} \tag{1.12}
\end{equation*}
$$

where $A_{1}$ and $A_{2}$ are the two signal amplitudes. So, for instance, one signal of twice the amplitude of another is +6 dB relative to it, since $\log _{10} 2=0.3010$. A signal 10 times as large is +20 dB ; a signal one-tenth as large is -20 dB .

Although decibels are ordinarily used to specify the ratio of two signals, they are sometimes used as an absolute measure of amplitude. What is happening is that you are assuming some reference signal level and expressing any other level in decibels relative to it. There are several standard levels (which are unstated, but understood) that are used in this way; the most common references are (a) $0 \mathrm{dBV}(1 \mathrm{Vms})$; (b) 0 dBm (the voltage corresponding to 1 mW into some assumed load impedance, which for radiofrequencies is usually $50 \Omega$, but for audio is often $600 \Omega$; the corresponding 0 dBm amplitudes, when loaded by those impedances, are then 0.22 V rms and 0.78 V rms ); and (c) the small noise voltage generated by a resistor at room temperature (this surprising fact is discussed in §8.1.1). In addition to these, there are reference amplitudes used for measurements in other fields of engineering and science. For instance, in acoustics, 0 dB SPL (sound pressure level) is a wave whose rms pressure is $20 \mu \mathrm{~Pa}$ (that's $2 \times 10^{-10} \mathrm{~atm}$ ); in audio communications, levels can be stated in dBrnC (relative noise reference weighted in frequency by "curve C"). When stating amplitudes this way, it is best to be specific about the 0 dB reference amplitude;

For a sinewave the relationship is $V_{\mathrm{avg}}=V_{\mathrm{rms}} / 1.11$. However, such meters are usually calibrated so that they indicate the rms sinewave amplitude. For signals other than sinewaves their indication is in error; be sure to use a "true rms" meter if you want the right answer.
say something like "an amplitude of 27 decibels relative to 1 V rms ," or abbreviate " 27 dB re $1 \mathrm{~V} \mathrm{rms,"}$ or define a term like "dBV."19

Exercise 1.12. Determine the voltage and power ratios for a pair of signals with the following decibel ratios: (a) 3 dB , (b) 6 dB , (c) 10 dB , (d) 20 dB .

Exercise 1.13. We might call this amusing exercise "Desert Island dBs ": in the table below we've started entering some values for power ratios corresponding to the first dozen integral dBs, using the results for parts (a) and (c) of the last exercise. Your job is to complete the table, without recourse to a calculator. A possibly helpful hint: starting at 10 dB , go down the table in steps of 3 dB , then up in a step of 10 dB , then down again. Finally, get rid of yucky numbers like 3.125 (and its near relatives) by noticing that it's charmingly close to $\pi$.

| dB | ratio $\left(P / P_{0}\right)$ |
| ---: | :---: |
| 0 | 1 |
| 1 |  |
| 2 |  |
| 3 | 2 |
| 4 |  |
| 5 |  |
| 6 | 4 |
| 7 |  |
| 8 |  |
| 9 | 8 |
| 10 | 10 |
| 11 |  |

### 1.3.3 Other signals

#### A. Ramp

The ramp is a signal that looks like the one shown in Figure 1.20 A . It is simply a voltage rising (or falling) at a constant rate. That can't go on forever, of course, even in science fiction movies. It is sometimes approximated by a finite ramp (Figure 1.20B) or by a periodic ramp (known as a sawtooth, Figure 1.20C).

#### B. Triangle

The triangle wave is a close cousin of the ramp; it is simply a symmetrical ramp (Figure 1.21).

#### C. Noise

Signals of interest are often mixed with noise; this is a catch-all phrase that usually applies to random noise of thermal origin. Noise voltages can be specified by their

[^14]A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=269&width=499&top_left_y=223&top_left_x=281)
B.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=282&width=498&top_left_y=499&top_left_x=284)
C.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=243&width=529&top_left_y=797&top_left_x=281)

Figure 1.20. A: Voltage-ramp waveform. B: Ramp with limit. C: Sawtooth wave.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=203&width=394&top_left_y=1179&top_left_x=326)

Figure 1.21. Triangle wave.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=241&width=585&top_left_y=1492&top_left_x=228)

Figure 1.22. Noise.
frequency spectrum (power per hertz) or by their amplitude distribution. One of the most common kind of noise is band-limited white Gaussian noise, which means a signal with equal power per hertz in some band of frequencies and that exhibits a Gaussian (bell-shaped) distribution of amplitudes when many instantaneous measurements of its amplitude are made. This kind of noise is generated by a resistor (Johnson noise or Nyquist noise), and it plagues sensitive measurements of all kinds. On an oscilloscope it appears as shown in Figure 1.22. We will discuss noise and low-noise techniques in considerable detail in Chapter 8.

#### D. Square wave

A square wave is a signal that varies in time as shown in Figure 1.23. Like the sinewave, it is characterized by amplitude and frequency (and perhaps phase). A linear circuit driven by a square wave rarely responds with a square wave. For a square wave, the peak amplitude and the rms amplitude are the same.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=238&width=457&top_left_y=539&top_left_x=1144)

Figure 1.23. Square wave.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=246&width=554&top_left_y=913&top_left_x=1098)

Figure 1.24. Rise time of a step waveform.

The edges of a square wave are not perfectly square; in typical electronic circuits the rise time $t_{r}$ ranges from a few nanoseconds to a few microseconds. Figure 1.24 shows the sort of thing usually seen. The rise time is conventionally defined as the time required for the signal to go from $10 \%$ to $90 \%$ of its total transition.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0049.jpg?height=236&width=802&top_left_y=1540&top_left_x=974)

Figure 1.25. Positive- and negative-going pulses of both polarities.

#### E. Pulses

A pulse is a signal that looks like the objects shown in Figure 1.25 . It is defined by amplitude and pulse width. You can generate a train of periodic (equally spaced) pulses, in which case you can talk about the frequency, or pulse repetition rate, and the "duty cycle," the ratio of pulse width to repetition period (duty cycle ranges from zero to $100 \%$ ). Pulses can have positive or negative polarity; in addition, they can be "positive-going" or "negative-going." For
instance, the second pulse in Figure 1.25 is a negativegoing pulse of positive polarity.

#### F. Steps and spikes

Steps and spikes are signals that are talked about a lot but are not so often used. They provide a nice way of describing what happens in a circuit. If you could draw them, they would look something like the example in Figure 1.26. The step function is part of a square wave; the spike is simply a jump of vanishingly short duration.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0050.jpg?height=246&width=777&top_left_y=660&top_left_x=234)

Figure 1.26. Steps and spikes.

### 1.3.4 Logic levels

Pulses and square waves are used extensively in digital electronics, in which predefined voltage levels represent one of two possible states present at any point in the circuit. These states are called simply HIGH and Low, and correspond to the 1 (true) and 0 (false) states of Boolean logic (the algebra that describes such two-state systems).

Precise voltages are not necessary in digital electronics. You need only to distinguish which of the two possible states is present. Each digital logic family therefore specifies legal HIGH and low states. For example, the "74LVC" digital logic family runs from a single +3.3 V supply, with output levels that are typically 0 V (LOW) and $3.3 \mathrm{~V}(\mathrm{HIGH})$, and an input decision threshold of 1.5 V . However, actual outputs can be as much as 0.4 V away from ground or from +3.3 V without malfunction. We'll have much more to say about logic levels in Chapters 10 through 12.

### 1.3.5 Signal sources

Often the source of a signal is some part of the circuit you are working on. But for test purposes a flexible signal source is invaluable. They come in three flavors: signal generators, pulse generators, and function generators.

#### A. Signal generators

Signal generators are sinewave oscillators, usually equipped to give a wide range of frequency coverage,
with provision for precise control of amplitude (using a resistive divider network called an attenuator). Some units let you modulate (i.e., vary in time) the output amplitude ("AM" for "amplitude modulated") or frequency ("FM" for "frequency modulated"). A variation on this theme is the sweep generator, a signal generator that can sweep its output frequency repeatedly over some range. These are handy for testing circuits whose properties vary with frequency in a particular way, e.g., "tuned circuits" or filters. Nowadays these devices, as well as most test instruments, are available in configurations that allow you to program the frequency, amplitude, etc., from a computer or other digital instrument.

For many signal generators the signal source is a frequency synthesizer, a device that generates sinewaves whose frequencies can be set precisely. The frequency is set digitally, often to eight significant figures or more, and is internally synthesized from a precise standard (a standalone quartz-crystal oscillator or rubidium frequency standard, or a GPS-derived oscillator) by digital methods we will discuss later (§13.13.6). Typical of synthesizers is the programmable SG384 from Stanford Research Systems, with a frequency range of $1 \mu \mathrm{~Hz}$ to 4 GHz , an amplitude range of -110 dBm to $+16.5 \mathrm{dBm}(0.7 \mu \mathrm{~V}$ to 1.5 V , rms $)$, and various modulation modes such as AM, FM, and $\Phi$; it costs about $\$ 4,600$. You can get synthesized sweep generators, and you can get synthesizers that produce other waveforms (see Function Generators, below). If your requirement is for no-nonsense accurate frequency generation, you can't beat a synthesizer.

#### B. Pulse generators

Pulse generators make only pulses, but what pulses! Pulse width, repetition rate, amplitude, polarity, rise time, etc., may all be adjustable. The fastest ones go up to gigahertz pulse rates. In addition, many units allow you to generate pulse pairs, with settable spacing and repetition rate, or even programmable patterns (they are sometimes called pattern generators). Most contemporary pulse generators are provided with logic-level outputs for easy connection to digital circuitry. As with signal generators, these come in the programmable variety.

#### C. Function generators

In many ways function generators are the most flexible signal sources of all. You can make sine, triangle, and square waves over an enormous frequency range $(0.01 \mathrm{~Hz}$ to 30 MHz is typical), with control of amplitude and dc offset (a constant-dc voltage added to the signal). Many of them have provision for frequency sweeping, often in
several modes (linear or logarithmic frequency variation versus time). They are available with pulse outputs (although not with the flexibility you get with a pulse generator), and some of them have provision for modulation.

Traditional function generators used analog circuitry, but contemporary models generally are synthesized digital function generators, exhibiting all the flexibility of a function generator along with the stability and accuracy of a frequency synthesizer. In addition, they let you program an "arbitrary" waveform, specifying the amplitude at a set of equally spaced points. An example is the Tektronix AFG3102, with a lower frequency limit of 1 microhertz, which can make sine and square waves to 100 MHz , pulses and "noise" to 50 MHz , and arbitrary waveforms (up to 128 k points) to 50 MHz . It has modulation (five kinds), sweep (linear and log), and burst modes (1 to $10^{6}$ cycles), and everything is programmable, including frequency, pulse width and rise times, modulation, and amplitude ( 20 mV to 10 Vpp ); it even includes some bizarre built-in waveforms such as $\sin (x) / x$, exponential rise and fall, Gaussian, and Lorentzian. It has two independent outputs and costs about $\$ 5 k$. For general use, if you can have only one signal source, the function generator is for you.

## 1.4 Capacitors and ac circuits

Once we enter the world of changing voltages and currents, or "signals," we encounter two very interesting circuit elements that are useless in purely dc circuits: capacitors and inductors. As you will see, these humble devices, combined with resistors, complete the triad of passive linear circuit elements that form the basis of nearly all circuitry. ${ }^{20}$ Capacitors, in particular, are essential in nearly every circuit application. They are used for waveform generation, filtering, and blocking and bypass applications. They are used in integrators and differentiators. In combination with inductors, they make possible sharp filters for separating desired signals from background. You will see some of these applications as we continue with this chapter, and there will be numerous interesting examples in later chapters.

Let's proceed, then, to look at capacitors in detail. Por-

[^15]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0051.jpg?height=124&width=185&top_left_y=216&top_left_x=1280)

Figure 1.27. Capacitors. The curved electrode indicates the negative terminal of a polarized capacitor, or the "outer foil" of a wrapped-film capacitor.
tions of the treatment that follows are necessarily mathematical in nature; the reader with little mathematical preparation may find the math review in Appendix A helpful. In any case, an understanding of the details is less important in the long run than an understanding of the results.

### 1.4.1 Capacitors

A capacitor (Figure 1.27) (the old-fashioned name was condenser) is a device that has two wires sticking out of it and has the property

$$
\begin{equation*}
Q=C V \tag{1.13}
\end{equation*}
$$

Its basic form is a pair of closely-spaced metal plates, separated by some insulating material, as in the rolledup "axial-film capacitor" of Figure 1.28. A capacitor of $C$ farads with $V$ volts across its terminals has $Q$ coulombs of stored charge on one plate and $-Q$ on the other. The capacitance is proportional to the area and inversely proportional to the spacing. For the simple parallel-plate capacitor, with separation $d$ and plate area $A$ (and with the spacing $d$ much less than the dimensions of the plates), the capacitance $C$ is given by

$$
\begin{equation*}
C=8.85 \times 10^{-14} \varepsilon A / d \mathrm{~F} \tag{1.14}
\end{equation*}
$$

where $\varepsilon$ is the dielectric constant of the insulator, and the dimensions are measured in centimeters. It takes a lot of area, and tiny spacing, to make the sort of capacitances commonly used in circuits. ${ }^{21}$ For example, a pair of $1 \mathrm{~cm}^{2}$ plates separated by 1 mm is a capacitor of slightly less than $10^{-12} \mathrm{~F}$ (a picofarad); you'd need 100,000 of them just to create the $0.1 \mu \mathrm{~F}$ capacitor of Figure 1.28 (which is nothing special; we routinely use capacitors with many microfarads of capacitance). Ordinarily you don't need to calculate capacitances, because you buy a capacitor as an electronic component.

To a first approximation, capacitors are devices that might be considered simply frequency-dependent resistors.

[^16]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0052.jpg?height=376&width=575&top_left_y=218&top_left_x=325)

Figure 1.28. You get a lot of area by rolling up a pair of metallized plastic films. And it's great fun unrolling one of these axial-lead Mylar capacitors (ditto for the old-style golf balls with their lengthy wound-up rubber band).

They allow you to make frequency-dependent voltage dividers, for instance. For some applications (bypass, coupling) this is almost all you need to know, but for other applications (filtering, energy storage, resonant circuits) a deeper understanding is needed. For example, ideal capacitors cannot dissipate power, even though current can flow through them, because the voltage and current are $90^{\circ}$ out of phase.

Before launching into the details of capacitors in the following dozen pages (including some necessary mathematics that describes their behavior in time and in frequency), we wish to emphasize those first two applications - bypass and coupling - because they are the most common uses of capacitors, and they are easy to understand at the simplest level. We'll see these in detail later (\$§1.7.1C and 1.7.16A), but no need to wait - it's easy, and intuitive. Because a capacitor looks like an open circuit at dc, it lets you couple a varying signal while blocking its average dc level. This is a blocking capacitor (also called a coupling capacitor), as in Figure 1.93. Likewise, because a capacitor looks like a short circuit at high frequencies, it suppresses ("bypasses") signals where you don't want them, for example on the dc voltages that power your circuits, as in Figure 8.80A (where capacitors are suppressing signals on the +5 V and -5 V dc supply voltages, and also on the base terminal of transistor $Q_{2}$ ). ${ }^{22}$ Demographically, these two applications account for the vast majority of capacitors that are wired into the world's circuits.

Taking the derivative of the defining equation 1.13 , you get

[^17]\$\$

$$
\begin{equation*}
I=C \frac{d V}{d t} \tag{1.15}
\end{equation*}
$$

\$\$

So a capacitor is more complicated than a resistor: the current is not simply proportional to the voltage, but rather to the rate of change of voltage. If you change the voltage across a farad by 1 volt per second, you are supplying an amp. Conversely, if you supply an amp, its voltage changes by 1 volt per second. A farad is an enormous capacitance, and you usually deal in microfarads $(\mu \mathrm{F})$, nanofarads $(\mathrm{nF})$, or picofarads $(\mathrm{pF}) .{ }^{23}$ For instance, if you supply a current of 1 mA to $1 \mu \mathrm{~F}$, the voltage will rise at 1000 volts per second. A 10 ms pulse of this current will increase the voltage across the capacitor by 10 volts (Figure 1.29).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0052.jpg?height=623&width=460&top_left_y=806&top_left_x=1242)

Figure 1.29. The voltage across a capacitor changes when a current flows through it.

When you charge up a capacitor, you're supplying energy. The capacitor doesn't get hot; instead, it stores the energy in its internal electric fields. It's an easy exercise to discover for yourself that the amount of stored energy in a charged capacitor is just

$$
\begin{equation*}
U_{\mathrm{C}}=\frac{1}{2} C V^{2} \tag{1.16}
\end{equation*}
$$

where $U_{\mathrm{C}}$ is in joules for $C$ in farads and $V$ in volts. This is an important result; we'll see it often.

Exercise 1.14. Take the energy challenge: imagine charging up a capacitor of capacitance $C$, from 0 V to some final voltage $V_{\mathrm{f}}$. If you do it right, the result won't depend on how you get there,

[^18]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0053.jpg?height=1111&width=1586&top_left_y=215&top_left_x=156)

Figure 1.30. Capacitors masquerade as anything they like! Here is a representative collection. In the lower left are small-value variable capacitors (one air, three ceramic), with large-value polarized aluminum electrolytics above them (the three on the left have radial leads, the three on the right have axial leads, and the specimen with screw terminals at top is often called a computer electrolytic). Next in line across the top is a low-inductance film capacitor (note the wide strap terminals), then an oil-filled paper capacitor, and last, a set of disc ceramic capacitors running down the right. The four rectangular objects below are film capacitors (polyester, polycarbonate, or polypropylene). The D-subminiature connector seems misplaced - but it is a filtered connector, with a 1000 pF capacitor from each pin to the shell. To its left is a group of seven polarized tantalum electrolytics (five with axial leads, one radial, and one surface-mount). The three capacitors above them are axial-film capacitors. The ten capacitors at bottom center are all ceramic types (four with radial leads, two axial, and four surface-mount chip capacitors); above them are high-voltage capacitors - an axial-glass capacitor, and a ceramic transmitting capacitor with screw terminals. Finally, below them and to the left are four mica capacitors and a pair of diode-like objects known as varactors, which are voltage-variable capacitors made from a diode junction.
so you don't need to assume constant current charging (though you're welcome to do so). At any instant the rate of flow of energy into the capacitor is VI (joules/s); so you need to integrate $d U=$ VIdt from start to finish. Take it from there.

Capacitors come in an amazing variety of shapes and sizes (Figure 1.30 shows examples of most of them); with time, you will come to recognize their more common incarnations. For the smallest capacitances you may see examples of the basic parallel-plate (or cylindrical piston) construction. For greater capacitance, you need more area and
closer spacing; the usual approach is to plate some conductor onto a thin insulating material (the dielectric), for instance, aluminized plastic film rolled up into a small cylindrical configuration. Other popular types are thin ceramic wafers (ceramic chip capacitors), metal foils with oxide insulators (electrolytic capacitors), and metallized mica. Each of these types has unique properties; for a brief rundown, see the section on capacitors in Chapter $1 x$. In general, ceramic and polyester types are used for most noncritical circuit applications; capacitors with polycarbonate, polystyrene, polypropylene, Teflon, or glass dielectric are
used in demanding applications; tantalum capacitors are used where greater capacitance is needed; and aluminum electrolytics are used for power-supply filtering.

#### A. Capacitors in parallel and series

The capacitance of several capacitors in parallel is the sum of their individual capacitances. This is easy to see: put voltage $V$ across the parallel combination; then

$$
\begin{aligned}
C_{\text {total }} V & =Q_{\text {total }}=Q_{1}+Q_{2}+Q_{3}+\cdots \\
& =C_{1} V+C_{2} V+C_{3} V+\cdots \\
& =\left(C_{1}+C_{2}+C_{3}+\cdots\right) V
\end{aligned}
$$

or

$$
\begin{equation*}
C_{\text {total }}=C_{1}+C_{2}+C_{3}+\cdots \tag{1.17}
\end{equation*}
$$

For capacitors in series, the formula is like that for resistors in parallel:

$$
\begin{equation*}
C_{\text {total }}=\frac{1}{\frac{1}{C_{1}}+\frac{1}{C_{2}}+\frac{1}{C_{3}}+\cdots} \tag{1.18}
\end{equation*}
$$

or (two capacitors only)

$$
C_{\text {total }}=\frac{C_{1} C_{2}}{C_{1}+C_{2}} .
$$

Exercise 1.15. Derive the formula for the capacitance of two capacitors in series. Hint: because there is no external connection to the point where the two capacitors are connected together, they must have equal stored charges.

The current that flows in a capacitor during charging $(I=C d V / d t)$ has some unusual features. Unlike resistive current, it's not proportional to voltage, but rather to the rate of change (the "time derivative") of voltage. Furthermore, unlike the situation in a resistor, the power $(V \times I)$ associated with capacitive current is not turned into heat, but is stored as energy in the capacitor's internal electric field. You get all that energy back when you discharge the capacitor. We'll see another way to look at these curious properties when we talk about reactance, beginning in §1.7.

### 1.4.2 RC circuits: $V$ and $/$ versus time

When dealing with ac circuits (or, in general, any circuits that have changing voltages and currents), there are two possible approaches. You can talk about $V$ and $I$ versus time, or you can talk about amplitude versus signal frequency. Both approaches have their merits, and you find yourself switching back and forth according to which description is most convenient in each situation. We begin our
study of ac circuits in the time domain. Starting with §1.7, we will tackle the frequency domain.

What are some of the features of circuits with capacitors? To answer this question, let's begin with the simple $R C$ circuit (Figure 1.31). Application of the capacitor rules gives

$$
\begin{equation*}
C \frac{d V}{d t}=I=-\frac{V}{R} \tag{1.19}
\end{equation*}
$$

This is a differential equation, and its solution is

$$
\begin{equation*}
V=A e^{-t / R C} \tag{1.20}
\end{equation*}
$$

So a charged capacitor placed across a resistor will discharge as in Figure 1.32. Intuition serves well here: the current that flows is (from the resistor equation) proportional to the remaining voltage; but the slope of the discharge is (from the capacitor equation) proportional to that current. So the discharge curve has to be a function whose derivative is proportional to its value, i.e., an exponential.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0054.jpg?height=146&width=197&top_left_y=1039&top_left_x=1371)

Figure 1.31. The simplest $R C$ circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0054.jpg?height=889&width=664&top_left_y=1308&top_left_x=1140)

Figure 1.32. $R C$ discharge waveform, plotted with (A) linear and (B) logarithmic voltage axes.

#### A. Time constant

The product $R C$ is called the time constant of the circuit. For $R$ in ohms and $C$ in farads, the product $R C$ is in seconds. A microfarad across 1.0 k has a time constant of 1 ms ; if the capacitor is initially charged to 1.0 V , the initial current is 1.0 mA .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0055.jpg?height=254&width=493&top_left_y=485&top_left_x=289)

Figure 1.33. $R C$ charging circuit.
Figure 1.33 shows a slightly different circuit. At time $t=0$, someone connects the battery. The equation for the circuit is then

$$
I=C \frac{d V}{d t}=\frac{V_{\mathrm{f}}-V_{\mathrm{out}}}{R}
$$

with the solution

$$
V_{\text {out }}=V_{\mathrm{f}}+A e^{-t / R C}
$$

(Please don't worry if you can't follow the mathematics. What we are doing is getting some important results, which you should remember. Later we will use the results often, with no further need for the mathematics used to derive them. For readers whose knowledge of math is somewhat, uh, rusty, the brief review in Appendix A may prove helpful.) The constant $A$ is determined by initial conditions (Figure 1.34): $V=0$ at $t=0$; therefore, $A=-V_{\mathrm{f}}$, and

$$
\begin{equation*}
V_{\mathrm{out}}=V_{\mathrm{f}}\left(1-e^{-t / R C}\right) \tag{1.21}
\end{equation*}
$$

Once again there's good intuition: as the capacitor charges up, the slope (which is proportional to current, because it's a capacitor) is proportional to the remaining voltage (because that's what appears across the resistor, producing the current); so we have a waveform whose slope decreases proportionally to the vertical distance it has still to go - an exponential.

You can turn around the last equation to figure out the time required to reach a voltage $V$ on the way to the final voltage $V_{\mathrm{f}}$. Try it! (Refer to Appendix A if you need help with logarithms.) You should get

$$
\begin{equation*}
t=R C \log _{e}\left(\frac{V_{\mathrm{f}}}{V_{\mathrm{f}}-V}\right) \tag{1.22}
\end{equation*}
$$

#### B. Decay to equilibrium

Eventually (when $t \gg R C$ ), $V$ reaches $V_{\mathrm{f}}$. (Presenting the " $5 R C$ rule of thumb": a capacitor charges or decays to
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0055.jpg?height=359&width=561&top_left_y=216&top_left_x=1092)

Figure 1.34. $R C$ charging waveform.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0055.jpg?height=420&width=756&top_left_y=670&top_left_x=994)

Figure 1.35. Output (lower waveforms) across a capacitor, when driven by square waves through a resistor.
within $1 \%$ of its final value in five time constants.) If we then change the battery voltage to some other value (say, 0 V ), $V$ will decay toward that new value with an exponential $e^{-t / R C}$. For example, replacing the battery's step input from 0 to $+V_{\mathrm{f}}$ with a square-wave input $V_{\mathrm{in}}(t)$ would produce the output shown in Figure 1.35.

Exercise 1.16. Show that the rise time (the time required for going from $10 \%$ to $90 \%$ of its final value) of this signal is $2.2 R C$.

You might ask the obvious next question: what about $V(t)$ for arbitrary $V_{\text {in }}(t)$ ? The solution involves an inhomogeneous differential equation and can be solved by standard methods (which are, however, beyond the scope of this book). You would find

$$
V(t)=\frac{1}{R C} \int_{-\infty}^{t} V_{\mathrm{in}}(\tau) e^{-(t-\tau) / R C} d \tau
$$

That is, the $R C$ circuit averages past history at the input with a weighting factor of

$$
e^{-\Delta t / R C}
$$

In practice, you seldom ask this question. Instead, you deal in the frequency domain, in which you ask how much of each frequency component present in the input gets through. We will get to this important topic soon (§1.7). Before we do, though, there are a few other interesting
circuits we can analyze simply with this time-domain approach.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0056.jpg?height=210&width=514&top_left_y=359&top_left_x=381)

Figure 1.36. Looks complicated, but it's not! (Thévenin to the rescue.)

#### C. Simplification by Thévenin equivalents

We could go ahead and analyze more complicated circuits by similar methods, writing down the differential equations and trying to find solutions. For most purposes it simply isn't worth it. This is as complicated an $R C$ circuit as we will need. Many other circuits can be reduced to it; take, for example, the circuit in Figure 1.36. By just using the Thévenin equivalent of the voltage divider formed by $R_{1}$ and $R_{2}$, you can find the output $V(t)$ produced by a step input for $V_{\text {in }}$.

Exercise 1.17. In the circuit shown in Figure 1.36, $R_{1}=R_{2}=10 \mathrm{k}$, and $C=0.1 \mu \mathrm{~F}$. Find $V(t)$ and sketch it.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0056.jpg?height=873&width=690&top_left_y=1279&top_left_x=272)

Figure 1.37. Producing a delayed digital waveform with the help of an $R C$ and a pair of LVC-family logic buffers (tiny parts with a huge part number: SN74LVC1G17DCKR!).

#### D. A circuit example: time-delay circuit

Let's take a short detour to try out these theoretical ideas on a couple of real circuits. Textbooks usually avoid such pragmatism, especially in early chapters, but we think it's fun to apply electronics to practical applications. We'll need to introduce a few "black-box" components to get the job done, but you'll learn about them in detail later, so don't worry.

We have already mentioned logic levels, the voltages that digital circuits live on. Figure 1.37 shows an application of capacitors to produce a delayed pulse. The triangular symbols are "CMOS ${ }^{24}$ buffers." They give a HIGH output if the input is HIGH (more than one-half the dc powersupply voltage used to power them), and vice versa. The first buffer provides a replica of the input signal, but with low source resistance, to prevent input loading by the $R C$ (recall our earlier discussion of circuit loading in §1.2.5A). The $R C$ output has the characteristic decays and causes the output buffer to switch $10 \mu \mathrm{~s}$ after the input transitions (an $R C$ reaches $50 \%$ output after a time $t=0.7 R C$ ). In an actual application you would have to consider the effect of the buffer input threshold deviating from one-half the supply voltage, which would alter the delay and change the output pulse width. Such a circuit is sometimes used to delay a pulse so that something else can happen first. In designing circuits you try not too often to rely on tricks like this, but they're occasionally handy.

#### E. Another circuit example: "One Minute of Power"

Figure 1.38 shows another example of what can be done with simple $R C$ timing circuits. The triangular symbol is a comparator, something we'll treat in detail later, in Chapters 4 and 10 ; all you need to know, for now, is that (a) it is an IC (containing a bunch of resistors and transistors), (b) it is powered from some positive dc voltage that you connect to the pin labeled " $V_{+}$," and (c) it drives its output (the wire sticking out to the right) either to $V_{+}$or to ground, depending on whether the input labeled " + " is more or less positive than the input labeled "-," respectively. (These are called the non-inverting and the inverting inputs, respectively.) It doesn't draw any current from its inputs, but it happily drives loads that require up to 20 mA or so. And a comparator is decisive: its output is either "HIGH" (at $V_{+}$) or "LOW" (ground).

Here's how the circuit works: the voltage divider $R_{3} R_{4}$ holds the ( - ) input at $37 \%$ of the supply voltage, in this case about +1.8 V ; let's call that the "reference voltage."

[^19]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=394&width=628&top_left_y=219&top_left_x=204)

Figure 1.38. $R C$ timing circuit: one push $\rightarrow$ one minute!.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=371&width=559&top_left_y=692&top_left_x=246)

Figure 1.39. Producing a delayed digital waveform for the circuit of Figure 1.38. The voltage $V_{C 1}$ has a rise time of $R_{1} C_{1} \approx 10 \mathrm{~ms}$.

So if the circuit has been sitting there for a while, $C_{1}$ is fully discharged, and the comparator's output is at ground. When you push the START button momentarily, $C_{1}$ charges quickly ( 10 ms time constant) to +5 V , which makes the comparator's output switch to +5 V ; see Figure 1.39. After the button is released, the capacitor discharges exponentially toward ground, with a time constant of $\tau=R_{2} C_{1}$, which we've set to be 1 minute. At that time its voltage crosses the reference voltage, so the comparator's output switches rapidly back to ground. (Note that we've conveniently chosen the reference voltage to be a fraction $1 / e$ of $V_{+}$, so it takes exactly one time constant $\tau$ for that to happen. For $R_{2}$ we used the closest standard value to $6 \mathrm{M} \Omega$; see Appendix C.) The bottom line is that the output spends 1 minute at +5 V , after the button is pushed.

We'll add a few details shortly, but first let's use the output to do some interesting things, which are shown in Figures 1.40A-D. You can make a self-stopping flashlight key fob by connecting its output to an LED; you need to put a resistor in series, to set the current (we'll say much more about this later). If you prefer to make some noise, you could connect a piezo beeper to beep continuously (or intermittently) for a minute (this might be an end-of-cycle signal for a clothes dryer). Another possibility is to attach a small electromechanical relay, which is just an electrically operated mechanical switch, to provide a pair of contacts
that can activate pretty much any load you care to switch on and off. The use of a relay has the important property that the load - the circuit being switched by the relay - is electrically isolated from the +5 V and ground of the timing circuit itself.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=159&width=387&top_left_y=436&top_left_x=1082)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=63&width=400&top_left_y=601&top_left_x=1086)
B.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=165&width=424&top_left_y=609&top_left_x=1145)
C.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0057.jpg?height=508&width=573&top_left_y=815&top_left_x=1091)

Figure 1.40. Driving interesting stuff from the output of the timer circuit in Figure 1.38.

Finally, for turning serious industrial machinery on and off, you would probably use a hefty solid-state relay (SSR, §12.7), which has within it an infrared LED coupled to an ac switching device known as a triac. When activated, the triac acts as an excellent mechanical switch, capable of switching many amperes, and (like the electromechanical relay) is fully isolated electrically from its input circuit. The example shows this thing hooked to an air compressor, so your friends will get a minute's worth of air to inflate their tires at your home "gas station" (literally!) after they drop a quarter into your coin-initiated timer. You could do an analogous thing with a coin-operated hot shower (but, hey, we get only one minute?!).

Some details: (a) in the circuit of Figure 1.38 you could omit $R_{1}$ and the circuit would still work, but there would be a large transient current when the discharged capacitor was initially connected across the +5 V supply (recall $I=C d V / d t$ : here you would be trying to produce 5 V of " $d V$ " in roughly 0 s of " $d t$ "). By adding a series resistor $R_{1}$ you limit the peak current to a modest 5 mA while charging
the capacitor fast enough ( $>99 \%$ in $5 R C$ time constants, or 0.05 s ). (b) The comparator output would likely bounce around a bit (see Figure 4.31), just as the (+) input crosses the reference voltage in its leisurely exponential promenade toward ground, owing to unavoidable bits of electrical noise. To fix this problem you usually see the circuit arranged so that some of the output is coupled back to the input in a way that reinforces the switching (this is officially called hysteresis, or positive feedback; we'll see it in Chapters 4 and 10). (c) In electronic circuits it's always a good idea to bypass the dc supply by connecting one or more capacitors between the dc "rail" and ground. The capacitance is noncritical - values of $0.1 \mu \mathrm{~F}$ to $10 \mu \mathrm{~F}$ are commonly used; see §1.7.16A.

Our simple examples above all involved turning some load on and off. But there are other uses for an electronic logic signal, like the output of the comparator, that is in one of two possible binary states, called HIGH and LOw (in this case +5 V and ground), 1 and 0 , or TRUE and false. For example, such a signal can enable or disable the operation of some other circuit. Imagine that the opening of a car door triggers our 1 min HIGH output, which then enables a keypad to accept a security code so you can start the car. After a minute, if you haven't managed to type the magic code, it shuts off, thus ensuring a certain minimum of operator sobriety.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0058.jpg?height=496&width=481&top_left_y=1316&top_left_x=382)

Figure 1.41. Differentiators. A. Perfect (except it has no output terminal). B. Approximate (but at least it has an output!).

### 1.4.3 Differentiators

You can make a simple circuit that differentiates an input signal; that is, $V_{\text {out }} \propto d V_{\text {in }} / d t$. Let's take it in two steps.

1. First look at the (impractical) circuit in Figure 1.41A: The input voltage $V_{\text {in }}(t)$ produces a current through the capacitor of $I_{\text {cap }}=C d V_{\text {in }} / d t$. That's just what we want - if we
could somehow use the current through $C$ as our "output"! But we can't. ${ }^{25}$
2. So we add a small resistor from the low side of the capacitor to ground, to act as a "current-sensing" resistor (Figure 1.41B). The good news is that we now have an output proportional to the current through the capacitor. The bad news is that the circuit is no longer a perfect mathematical differentiator. That's because the voltage across $C$ (whose derivative produces the current we are sensing with $R$ ) is no longer equal to $V_{\text {in }}$; it now equals the difference between $V_{\text {in }}$ and $V_{\text {out }}$.Here's how it goes: the voltage across $C$ is $V_{\text {in }}-V_{\text {out }}$, so

$$
I=C \frac{d}{d t}\left(V_{\text {in }}-V_{\text {out }}\right)=\frac{V_{\text {out }}}{R}
$$

If we choose $R$ and $C$ small enough so that $d V_{\text {out }} / d t \ll$ $d V_{\text {in }} / d t$, then

$$
C \frac{d V_{\mathrm{in}}}{d t} \approx \frac{V_{\mathrm{out}}}{R}
$$

or

$$
V_{\text {out }}(t) \approx R C \frac{d}{d t} V_{\text {in }}(t)
$$

That is, we get an output proportional to the rate of change of the input waveform.

To keep $d V_{\text {out }} / d t \ll d V_{\text {in }} / d t$, we make the product $R C$ small, taking care not to "load" the input by making $R$ too small (at the transition the change in voltage across the capacitor is zero, so $R$ is the load seen by the input). We will have a better criterion for this when we look at things in the frequency domain (\$1.7.10). If you drive this circuit with a square wave, the output will be as shown in Figure 1.42.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0058.jpg?height=299&width=387&top_left_y=1524&top_left_x=1281)

Figure 1.42. Output waveform (bottom) from differentiator driven by a square wave.

Differentiators are handy for detecting leading edges and trailing edges in pulse signals, and in digital circuitry you sometimes see things like those depicted in Figure 1.43. The $R C$ differentiator generates spikes at the transitions of the input signal, and the output buffer converts

[^20]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0059.jpg?height=764&width=637&top_left_y=215&top_left_x=202)

Figure 1.43. Leading-edge detector.
the spikes to short square-topped pulses. In practice, the negative spike will be small because of a diode (a handy device discussed in §1.6) built into the buffer.

To inject some real-world realism here, we hooked up and made some measurements on a differentiator that we configured for high-speed signals. For this we used $C=1 \mathrm{pF}$ and $R=50 \Omega$ (the latter is the world-wide standard for highspeed circuits, see Appendix H), we drove it with a 5 V step of settable slew rate (i.e., $d V / d t$ ). Figure 1.44 shows both input and output waveforms, for three choices of $d V_{\text {in }} / d t$. At these speeds (note the horizontal scale: 4 nanoseconds per division!) circuits often depart from ideal performance, as can be seen in the fastest risetime. The two slower steps show reasonable behavior; that is, a flat-top output waveform during the input's upward ramp; check for yourself that the output amplitude is correctly predicted by the formula.

#### A. Unintentional capacitive coupling

Differentiators sometimes crop up unexpectedly, in situations where they're not welcome. You may see signals like those shown in Figure 1.45. The first case is caused by a square wave somewhere in the circuit coupling capacitively to the signal line you're looking at; that might indicate a missing resistor termination on your signal line. If not, you must either reduce the source resistance of the signal line or find a way to reduce capacitive coupling from the offending square wave. The second case is typical of what you might see when you look at a square wave, but have a
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0059.jpg?height=537&width=797&top_left_y=219&top_left_x=974)

Figure 1.44. Three fast step waveforms, differentiated by the $R C$ network shown. For the fastest waveform ( $10^{9}$ volts per second!), imperfections in the components and measuring instruments cause deviation from the ideal.
broken connection somewhere, usually at the scope probe. The very small capacitance of the broken connection combines with the scope input resistance to form a differentiator. Knowing that you've got a differentiated "something" can help you find the trouble and eliminate it.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0059.jpg?height=430&width=641&top_left_y=1201&top_left_x=1052)

Figure 1.45. Two examples of unintentional capacitive coupling.

### 1.4.4 Integrators

If $R C$ circuits can take derivatives, why not integrals? As before, let's take it in two steps.

1. Imagine that we have an input signal that is a timevarying current versus time, $I_{\mathrm{in}}(t)$ (Figure 1.46A). ${ }^{26}$ That input current is precisely the current through the capacitor, so $I_{\text {in }}(t)=C d V(t) / d t$, and therefore $V(t)=\int I_{\text {in }}(t) d t$.

[^21]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0060.jpg?height=445&width=387&top_left_y=206&top_left_x=429)

Figure 1.46. Integrator. A. Perfect (but requires a current input signal). B. Approximate (see text).

That's just what we wanted! Thus a simple capacitor, with one side grounded, is an integrator, if we have an input signal in the form of a current $I_{\text {in }}(t)$. Most of the time we don't, though.
2. So we connect a resistor in series with the more usual input voltage signal $V_{\text {in }}(t)$, to convert it to a current (Figure 1.46B). The good news is that it works, sort of. The bad news is that the circuit is no longer a perfect integrator. That's because the current through $C$ (whose integral produces the output voltage) is no longer proportional to $V_{\text {in }}$; it is now proportional to the difference between $V_{\text {in }}$ and $V$. Here's how it goes: the voltage across $R$ is $V_{\text {in }}-V$, so

$$
I=C \frac{d V}{d t}=\frac{V_{\mathrm{in}}-V}{R}
$$

If we manage to keep $V \ll V_{\text {in }}$, by keeping the product $R C$ large, ${ }^{27}$ then

$$
C \frac{d V}{d t} \approx \frac{V_{\mathrm{in}}}{R}
$$

or

$$
V(t)=\frac{1}{R C} \int^{t} V_{\text {in }}(t) d t+\text { constant. }
$$

That is, we get an output proportional to the integral over time of the input waveform. You can see how the approximation works for a square-wave input: $V(t)$ is then the exponential charging curve we saw earlier (Figure 1.47). The first part of the exponential is a ramp, the integral of a constant; as we increase the time constant $R C$, we pick off a smaller part of the exponential, i.e., a better approximation to a perfect ramp.

Note that the condition $V \ll V_{\text {in }}$ is the same as saying that $I$ is proportional to $V_{\text {in }}$, which was our first integrator

[^22]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0060.jpg?height=450&width=496&top_left_y=219&top_left_x=1221)

Figure 1.47. Integrator approximation is good when $V_{\text {out }} \ll V_{\text {in }}$.
circuit. A large voltage across a large resistance approximates a current source and, in fact, is frequently used as one.

Later, when we get to operational amplifiers and feedback, we will be able to build integrators without the restriction $V_{\text {out }} \ll V_{\text {in }}$. They will work over large frequency and voltage ranges with negligible error.

The integrator is used extensively in analog computation. It is a useful subcircuit that finds application in control systems, feedback, analog-digital conversion, and waveform generation.

#### A. Ramp generators

At this point it is easy to understand how a ramp generator works. This nice circuit is extremely useful, for example in timing circuits, waveform and function generators, analog oscilloscope sweep circuits, and analog-digital conversion circuitry. The circuit uses a constant current to charge a capacitor (Figure 1.48). From the capacitor equation $I=$ $C(d V / d t)$, you get $V(t)=(I / C) t$. The output waveform is as shown in Figure 1.49. The ramp stops when the current source "runs out of voltage," i.e., reaches the limit of its compliance. On the same figure is shown the curve for a simple $R C$, with the resistor tied to a voltage source equal to the compliance of the current source, and with $R$ chosen so that the current at zero output voltage is the same as that of the current source. (Real current sources generally have output compliances limited by the power-supply voltages used in making them, so the comparison is realistic.) In the next chapter, which deals with transistors, we will design some current sources, with some refinements to follow in the chapters on operational amplifiers (op-amps) and FETs. Exciting things to look forward to!

Exercise 1.18. A current of 1 mA charges a $1 \mu \mathrm{~F}$ capacitor. How long does it take the ramp to reach 10 volts?
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0061.jpg?height=223&width=473&top_left_y=220&top_left_x=284)

Figure 1.48. A constant-current source charging a capacitor generates a ramp voltage waveform.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0061.jpg?height=261&width=473&top_left_y=589&top_left_x=284)

Figure 1.49. Constant-current charging (with finite compliance) versus $R C$ charging.

### 1.4.5 Not quite perfect...

Real capacitors (the kind you can see, and touch, and pay money for) generally behave according to theory; but they have some additional "features" that can cause problems in some demanding applications. For example, all capacitors exhibit some series resistance (which may be a function of frequency), and some series inductance (see the next section), along with some frequency-dependent parallel resistance. Then there's a "memory" effect (known as dielectric absorption), which is rarely discussed in polite society: if you charge a capacitor up to some voltage $V_{0}$ and hold it there for a while, and then discharge it to 0 V , then when you remove the short across its terminals it will tend to drift back a bit toward $V_{0}$.

Don't worry about this stuff, for now. We'll treat in detail these effects (and other oddities of real-world components) in the advanced topics Chapter $1 x$.

## 1.5 Inductors and transformers

### 1.5.1 Inductors

If you understand capacitors, you shouldn't have great trouble with inductors (Figure 1.50). They're closely related to capacitors: the rate of current change in an inductor is proportional to the voltage applied across it (for a capacitor it's the other way around - the rate of voltage change is proportional to the current through it). The defining equation for an inductor is

$$
\begin{equation*}
V=L \frac{d I}{d t} \tag{1.23}
\end{equation*}
$$

where $L$ is called the inductance and is measured in henrys (or $\mathrm{mH}, \mu \mathrm{H}, \mathrm{nH}$, etc.). Putting a constant voltage across an inductor causes the current to rise as a ramp (compare with a capacitor, in which a constant current causes the voltage to rise as a ramp); 1 V across 1 H produces a current that increases at 1 amp per second.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0061.jpg?height=52&width=434&top_left_y=500&top_left_x=1153)

Figure 1.50. Inductors. The parallel-bar symbol represents a core of magnetic material.

Just as with capacitors, the energy invested in ramping up the current in an inductor is stored internally, here in the form of magnetic fields. And the analogous formula is

$$
\begin{equation*}
U_{\mathrm{L}}=\frac{1}{2} L I^{2} \tag{1.24}
\end{equation*}
$$

where $U_{\mathrm{L}}$ is in joules (watt seconds) for $L$ in henrys and $I$ in amperes. As with capacitors, this is an important result, one which lies at the core of switching power conversion (exemplified by those little black "wall-warts" that provide power to all manner of consumer electronic gadgets). We'll see lots more of this in Chapter 9.

The symbol for an inductor looks like a coil of wire; that's because, in its simplest form, that's all it is. Its somewhat peculiar behavior comes about because inductors are magnetic devices, in which two things are going on: current flowing through the coil creates a magnetic field aligned along the coil's axis; and then changes in that field produce a voltage (sometimes called "back EMF") in a way that tries to cancel out those changes (an effect known as Lenz's law). The inductance $L$ of a coil is simply the ratio of magnetic flux passing through the coil divided by the current through the coil that produces that flux (multiplied by an overall constant). Inductance depends on the coil geometry (e.g., diameter and length) and the properties of any magnetic material (the "core") that may be used to confine the magnetic field. That's all you need to understand why the inductance of a coil of given geometry is proportional to the square of the number of turns.
Exercise 1.19. Explain why $L \propto n^{2}$ for an inductor consisting of a coil of $n$ turns of wire, maintaining fixed diameter and length as $n$ is varied.

We'll get into some more detail in the Chapter $1 x$. But it's worth displaying a semi-empirical formula for the approximate inductance $L$ of a coil of diameter $d$ and length $l$, in which the $n^{2}$ dependence is on display:

$$
L \approx K \frac{d^{2} n^{2}}{18 d+40 l} \quad \mu \mathrm{H}
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0062.jpg?height=703&width=1248&top_left_y=215&top_left_x=422)

Figure 1.51. Inductors. Top row, left to right: encapsulated toroid, hermetically-sealed toroid, board-mount pot core, bare toroid (two sizes). Middle row: slug-tuned ferrite-core inductors (three sizes). Bottom row: high-current ferrite-core choke, ferrite-bead choke, dipped radial-lead ferrite-core inductor, surface-mount ferrite chokes, molded axial-lead ferrite-core chokes (two styles), lacquered ferrite-core inductors (two styles).
where $K=1.0$ or 0.395 for dimensions in inches or centimeters, respectively. This is known as Wheeler's formula and is accurate to $1 \%$ as long as $l>0.4 d$.

As with capacitive current, inductive current is not simply proportional to voltage (as in a resistor). Furthermore, unlike the situation in a resistor, the power associated with inductive current $(V \times I)$ is not turned into heat, but is stored as energy in the inductor's magnetic field (recall that for a capacitor the power associated with capacitive current is likewise not dissipated as heat, but is stored as energy in the capacitor's electric field). You get all that energy back when you interrupt the inductor's current (with a capacitor you get all the energy back when you discharge the voltage to zero).

The basic inductor is a coil, which may be just a loop with one or more turns of wire; or it may be a coil with some length, known as a solenoid. Variations include coils wound on various core materials, the most popular being iron (or iron alloys, laminations, or powder) and ferrite (a gray, nonconductive, brittle magnetic material). These are all ploys to multiply the inductance of a given coil by the "permeability" of the core material. The core may be in the shape of a rod, a toroid (doughnut), or even more bizarre shapes, such as a "pot core" (which has to be seen to be understood; the best description we can come up with is a doughnut mold split horizontally in half, if doughnuts were
made in molds). See Figure 1.51 for some typical geometries.

Inductors find heavy use in radiofrequency (RF) circuits, serving as RF "chokes" and as parts of tuned circuits (§1.7.14). A pair of closely coupled inductors forms the interesting object known as a transformer. We will talk briefly about them shortly.

An inductor is, in a real sense, the opposite of a capacitor. ${ }^{28}$ You will see how that works out later in the chapter when we deal with the important subject of impedance.

#### A. A look ahead: some magic with inductors

Just to give a taste of some of the tricks that you can do with inductors, take a look at Figure 1.52. Although we'll understand these circuits a lot better when we go at them in Chapter 9, it's possible to see what's going on with what we know already. In Figure 1.52A the left-hand side of inductor $L$ is alternately switched between a dc input voltage $V_{\text {in }}$ and ground, at some rapid rate, spending equal times
${ }^{28}$ In practice, however, capacitors are much more widely used in electronic circuits. That is because practical inductors depart significantly from ideal performance - by having winding resistance, core losses, and self-capacitance - whereas practical capacitors are nearly perfect (more on this in Chapter $1 x$ ). Inductors are indispensable, however, in switching power converters, as well as in tuned $L C$ circuits for RF applications.
connected to each (a " $50 \%$ duty cycle"). But the defining equation $V=L d I / d t$ requires that the average voltage across an inductor must be zero, otherwise the magnitude of its average current is rising without limit. (This is sometimes called the volt-second balance rule.) From this it follows that the average output voltage is half the input voltage (make sure you understand why). In this circuit $C_{2}$ acts as a storage capacitor for steadying the output voltage (more on this later, and in Chapter 9).

Producing an output that is half the voltage of an input is not very exciting; after all, a simple voltage divider can do that. But, unlike a voltage divider, this circuit does not waste any energy; apart from non-idealities of the components, it is $100 \%$ efficient. And in fact this circuit is widely used in power conversion; it's called a "synchronous buck converter."

But look now at Figure 1.52B, which is just a turnedaround version of Figure 1.52A. This time, volt-second balance requires that the output voltage be twice the input voltage. You can't do that with a voltage divider! Once again, the output capacitor ( $C_{1}$ this time) serves to hold the output voltage steady by storing charge. This configuration is called a "synchronous boost converter."

These and other switching converters are discussed extensively in Chapter 9, where Table 9.5 lists some fifty representative types.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0063.jpg?height=421&width=689&top_left_y=1315&top_left_x=176)

Figure 1.52. Inductors let you do neat tricks, such as increasing a dc input voltage.

### 1.5.2 Transformers

A transformer is a device consisting of two closely coupled coils (called primary and secondary). An ac voltage applied to the primary appears across the secondary, with a voltage multiplication proportional to the turns ratio of the transformer, and with a current multiplication inversely proportional to the turns ratio. Power is conserved. Figure 1.53 shows the circuit symbol for a laminated-core transformer (the kind used for 60 Hz ac power conversion).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0063.jpg?height=152&width=149&top_left_y=217&top_left_x=1298)

Figure 1.53. Transformer.

Transformers are quite efficient (output power is very nearly equal to input power); thus, a step-up transformer gives higher voltage at lower current. Jumping ahead for a moment, a transformer of turns ratio $n$ increases the impedance by $n^{2}$. There is very little primary current if the secondary is unloaded.

Power transformers (meant for use from the 115 V powerline) serve two important functions in electronic instruments: they change the ac line voltage to a useful (usually lower) value that can be used by the circuit, and they "isolate" the electronic device from actual connection to the powerline, because the windings of a transformer are electrically insulated from each other. They come in an enormous variety of secondary voltages and currents: outputs as low as 1 volt or so up to several thousand volts, current ratings from a few milliamps to hundreds of amps. Typical transformers for use in electronic instruments might have secondary voltages from 10 to 50 volts, with current ratings of 0.1 to 5 amps or so. A related class of transformers is used in electronic power conversion, in which plenty of power is flowing, but typically as pulse or square waveforms, and at much higher frequencies $(50 \mathrm{kHz}$ to 1 MHz is typical).

Transformers for signals at audio frequencies and radio frequencies are also available. At radio frequencies you sometimes use tuned transformers if only a narrow range of frequencies is present. There is also an interesting class of transmission-line transformers. In general, transformers for use at high frequencies must use special core materials or construction to minimize core losses, whereas lowfrequency transformers (e.g., ac powerline transformers) are burdened instead by large and heavy cores. The two kinds of transformers are in general not interchangeable.

#### A. Problems, problems...

This simple "first-look" description ignores interesting and important - issues. For example, there are inductances associated with the transformer, as suggested by its circuit symbol: an effective parallel inductance (called the magnetizing inductance) and an effective series inductance (called the leakage inductance). Magnetizing inductance causes a primary current even with no secondary load; more significantly, it means that you cannot make a "dc
transformer." And leakage inductance causes a voltage drop that depends on load current, as well as bedeviling circuits that have fast pulses or edges. Other departures from ideal performance include winding resistance, core losses, capacitance, and magnetic coupling to the outside world. Unlike capacitors (which behave nearly ideally in most circuit applications), the deficiencies of inductors have significant effects in real-world circuit applications. We'll deal with these in Chapter $1 x$ and Chapter 9.

## 1.6 Diodes and diode circuits

We are not done with capacitors and inductors! We have dealt with them in the time domain ( $R C$ circuits, exponential charge and discharge, differentiators and integrators, and so on), but we have not yet tackled their behavior in the frequency domain.

We will get to that soon enough. But this is a good time to take a break from "RLC" and put our knowledge to use with some clever and useful circuits. We begin by introducing a new device, the diode. It's our first example of a nonlinear device, and you can do nifty things with it.

### 1.6.1 Diodes

The circuit elements we've discussed so far (resistors, capacitors, and inductors) are all linear, meaning that a doubling of the applied signal (a voltage, say) produces a doubling of the response (a current, say). This is true even for the reactive devices (capacitors and inductors). These components are also passive, as opposed to active devices, the latter exemplified by transistors, which are semiconductor devices that control the flow of power. And they are all two-terminal devices, which is self-explanatory.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0064.jpg?height=80&width=272&top_left_y=1654&top_left_x=484)

Figure 1.54. Diode.
The diode (Figure 1.54) is an important and useful twoterminal passive nonlinear device. It has the $V-I$ curve shown in Figure 1.55. (In keeping with the general philosophy of this book, we will not attempt to describe the solid-state physics that makes such devices possible.)

The diode's arrow (the anode terminal) points in the direction of forward current flow. For example, if the diode is in a circuit in which a current of 10 mA is flowing from anode to cathode, then (from the graph) the anode is approximately 0.6 V more positive than the cathode; this is called the "forward voltage drop." The reverse current,
which is measured in the nanoamp range for a generalpurpose diode (note the hugely different scales in the graph for forward and reverse current), is almost never of any consequence until you reach the reverse breakdown voltage (also called the peak inverse voltage, PIV), typically 75 volts for a general-purpose diode like the 1N4148. (Normally you never subject a diode to voltages large enough to cause reverse breakdown; the exception is the zener diode we mentioned earlier.) Frequently, also, the forward voltage drop of about 0.5 to 0.8 V is of little concern, and the diode can be treated as a good approximation to an ideal one-way conductor. There are other important characteristics that distinguish the thousands of diode types available, e.g., maximum forward current, capacitance, leakage current, and reverse recovery time; Table 1.1 includes a few popular diodes, to give a sense of the capabilities of these little devices.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0064.jpg?height=519&width=549&top_left_y=955&top_left_x=1195)

Figure 1.55. Diode $V-I$ curve.
Before jumping into some circuits with diodes, we should point out two things: (a) a diode doesn't have a resistance (it doesn't obey Ohm's law). (b) If you put some diodes in a circuit, it won't have a Thévenin equivalent.

### 1.6.2 Rectification

A rectifier changes ac to dc; this is one of the simplest and most important applications of diodes (which are sometimes called rectifiers). The simplest circuit is shown in Figure 1.56. The "ac" symbol represents a source of ac voltage; in electronic circuits it is usually provided by a transformer, powered from the ac powerline. For a sinewave input that is much larger than the forward drop (about 0.6 V for silicon diodes, the usual type), the output will look like that in Figure 1.57. If you think of the diode as a one-way conductor, you won't have any trouble

Table 1.1 Representative Diodes

| Part \# | $V_{\text {R }}$ (max) | IR (typ, $25^{\circ} \mathrm{C}$ ) |  | $V_{\mathrm{F}}$ @ $\mathrm{I}_{\mathrm{F}}$ |  | Capacitance | SMT ${ }^{\text {a }} \mathrm{p} / \mathrm{n}$ | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | (V) | (A @ | V) | (mV) | (mA) | (pF @ V V ) |  |  |
| Silicon |  |  |  |  |  |  |  |  |
| PAD5 | 45 | 0.25pA | 20V | 800 | 1 | 0.5pF 5V | SSTPAD5 | metal + glass can |
| 1N4148 | 75 | 10nA | 200 | 750 | 10 | 0.9pF OV | 1N4148W | jellybean sig diode |
| 1N4007 | 1000 | 50nA | 800V | 800 | 250 | 12pF 10V | DL4007 | 1N4004 lower V |
| 1N5406 | 600 | <10uA | 600V | 1.0V | 10A | 18pF 10V | none | heat through leads |
| Schottky ${ }^{\text {b }}$ |  |  |  |  |  |  |  |  |
| 1N6263 | 60 | 7nA | 20V | 400 | 1 | 0.6pF 10V | 1N6263W | see also 1N5711 |
| 1N5819 | 40 | 10HA | 32 V | 400 | 1000 | 150pF 1V | 1N5819HW | jellybean |
| 1N5822 | 40 | $40 \mu \mathrm{~A}$ | 32 V | 480 | 3000 | 450pF 1V | none | power Schottky |
| MBRP40045 | 545 | 500 4 A | 40V | 540 | 400A | 3500pF 10V | you jest! | Moby dual Schottky |

Notes: (a) SMT, surface-mount technology. (b) Schottky diodes have lower forward voltage and zero reverse-recovery time, but more capacitance.
understanding how the circuit works. This circuit is called a half-wave rectifier, because only half of the input waveform is used.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0065.jpg?height=221&width=401&top_left_y=1017&top_left_x=320)

Figure 1.56. Half-wave rectifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0065.jpg?height=210&width=729&top_left_y=1359&top_left_x=161)

Figure 1.57. Half-wave output voltage (unfiltered).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0065.jpg?height=251&width=419&top_left_y=1691&top_left_x=311)

Figure 1.58. Full-wave bridge rectifier.

Figure 1.58 shows another rectifier circuit, a "full-wave bridge." Figure 1.59 shows the voltage across the load; note that the entire input waveform is used. The gaps at zero voltage occur because of the diodes' forward voltage drop. In this circuit, two diodes are always in series with the input; when you design low-voltage power supplies, for
which the diode drop becomes significant, you have to remember that. ${ }^{29}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0065.jpg?height=213&width=852&top_left_y=1013&top_left_x=949)

Figure 1.59. Full-wave output voltage (unfiltered).

### 1.6.3 Power-supply filtering

The preceding rectified waveforms aren't good for much as they stand. They're "dc" only in the sense that they don't change polarity. But they still have a lot of "ripple" (periodic variations in voltage about the steady value) that has to be smoothed out in order to generate genuine dc. This we do by attaching a relatively large value capacitor (Figure 1.60); it charges up to the peak output voltage during the diode conduction, and its stored charge ( $Q=C V$ ) provides the output current in between charging cycles. Note that the diodes prevent the capacitor from discharging back through the ac source. In this application you should think of the capacitor as an energy storage device, with stored energy $U=\frac{1}{2} C V^{2}$ (recall $\S 1.4 .1$; for $C$ in farads and $V$ in volts, $U$ comes out in joules, or equivalently, watt seconds).

The capacitor value is chosen so that

$$
R_{\text {load }} C \gg 1 / f
$$

[^23]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0066.jpg?height=228&width=516&top_left_y=220&top_left_x=362)

Figure 1.60. Full-wave bridge with output storage ("filter") capacitor.
(where $f$ is the ripple frequency, here 120 Hz ) in order to ensure small ripple by making the time constant for discharge much longer than the time between recharging. We make this vague statement clearer now.

#### A. Calculation of ripple voltage

It is easy to calculate the approximate ripple voltage, particularly if it is small compared with the dc (see Figure 1.61). The load causes the capacitor to discharge somewhat between cycles (or half-cycles, for full-wave rectification). If you assume that the load current stays constant (it will, for small ripple), you have

$$
\begin{equation*}
\Delta V=\frac{I}{C} \Delta t \quad\left(\text { from } I=C \frac{d V}{d t}\right) \tag{1.25}
\end{equation*}
$$

Just use $1 / f$ (or $1 / 2 f$ for full-wave rectification) for $\Delta t$ (this estimate is a bit on the safe side, because the capacitor begins charging again in less than a half-cycle). You get ${ }^{30}$

$$
\begin{array}{ll}
\Delta V=\frac{I_{\text {load }}}{f C} & \text { (half-wave) } \\
\Delta V=\frac{I_{\text {load }}}{2 f C} & \text { (full-wave). }
\end{array}
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0066.jpg?height=351&width=818&top_left_y=1526&top_left_x=216)

Figure 1.61. Power-supply ripple calculation.
If you wanted to do the calculation without any approximation, you would use the exact exponential discharge formula. You would be misguided in insisting on that kind

[^24]of accuracy, though, for two reasons. (a) The discharge is an exponential only if the load is a resistance; many loads are not. In fact, the most common load, a voltage regulator, looks like a constant-current load. (b) Power supplies are built with capacitors with typical tolerances of $20 \%$ or more. Realizing the manufacturing spread, you design conservatively, allowing for the worst-case combination of component values.

In this case, viewing the initial part of the discharge as a ramp is in fact quite accurate, especially if the ripple is small, and in any case it errs in the direction of conservative design - it overestimates the ripple.

Exercise 1.20. Design a full-wave bridge rectifier circuit to deliver 10 V dc with less than $0.1 \mathrm{~V}(\mathrm{pp})$ ripple into a load drawing up to 10 mA . Choose the appropriate ac input voltage, assuming 0.6 V diode drops. Be sure to use the correct ripple frequency in your calculation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0066.jpg?height=233&width=509&top_left_y=975&top_left_x=1215)

Figure 1.62. Bridge rectifier circuit. The polarity marking and curved electrode indicate a polarized capacitor, which must not be allowed to charge with the opposite polarity.

### 1.6.4 Rectifier configurations for power supplies

#### A. Full-wave bridge

A dc power supply with the bridge circuit we just discussed looks as shown in Figure 1.62. In practice, you generally buy the bridge as a prepackaged module. The smallest ones come with maximum current ratings of 1 A average, with a selection of rated minimum breakdown voltages going from 100 V to 600 V , or even 1000 V . Giant bridge rectifiers are available with current ratings of 25 A or more.

#### B. Center-tapped full-wave rectifier

The circuit in Figure 1.63 is called a center-tapped fullwave rectifier. The output voltage is half what you get if you use a bridge rectifier. It is not the most efficient circuit in terms of transformer design, because each half of the secondary is used only half the time. To develop some intuition on this subtle point, consider two different configurations that produce the same rectified dc output voltage: (a) the circuit of Figure 1.63, and (b) the same transformer, this time with its secondary cut at the center tap and
rewired with the two halves in parallel, the resultant combined secondary winding connected to a full-wave bridge. Now, to deliver the same output power, each half winding in (a), during its conduction cycle, must supply the same current as the parallel pair in (b). But the power dissipated in the winding resistances goes like $I^{2} R$, so the power lost to heating in the transformer secondary windings reduced by a factor of 2 for the bridge configuration (b).

Here's another way to see the problem: imagine we use the same transformer as in (a), but for our comparison circuit we replace the pair of diodes with a bridge, as in Figure 1.62 , and we leave the center tap unconnected. Now, to deliver the same output power, the current through the winding during that time is twice what it would be for a true full-wave circuit. To expand on this subtle point: heating in the windings, calculated from Ohm's law, is $I^{2} R$, so you have four times the heating for half the time, or twice the average heating of an equivalent full-wave bridge circuit. You would have to choose a transformer with a current rating 1.4 (square root of 2) times as large compared with the (better) bridge circuit; besides costing more, the resulting supply would be bulkier and heavier.

Exercise 1.21. This illustration of $I^{2} R$ heating may help you understand the disadvantage of the center-tapped rectifier circuit. What fuse rating (minimum) is required for passing the current waveform shown in Figure 1.64, which has 1 amp average current? Hint: a fuse "blows out" by melting a metallic link $\left(I^{2} R\right.$ heating), for steady currents larger than its rating. Assume for this problem that the thermal time constant of the fusible link is much longer than the time scale of the square wave, i.e., that the fuse responds to the value of $I^{2}$ averaged over many cycles.

#### C. Split supply

A popular variation of the center-tapped full-wave circuit is shown in Figure 1.65. It gives you split supplies (equal plus and minus voltages), which many circuits need. It is an efficient circuit, because both halves of the input waveform are used in each winding section.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0067.jpg?height=248&width=519&top_left_y=1963&top_left_x=266)

Figure 1.63. Full-wave rectifier using center-tapped transformer.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0067.jpg?height=231&width=524&top_left_y=216&top_left_x=1110)

Figure 1.64. Illustrating greater $I^{2} R$ heating with discontinuous current flow.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0067.jpg?height=289&width=639&top_left_y=590&top_left_x=1053)

Figure 1.65. Dual-polarity (split) supply.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0067.jpg?height=286&width=611&top_left_y=977&top_left_x=1067)

Figure 1.66. Voltage doubler.

#### D. Voltage multipliers

The circuit shown in Figure 1.66 is called a voltage doubler. Think of it as two half-wave rectifier circuits in series. It is officially a full-wave rectifier circuit because both halves of the input waveform are used - the ripple frequency is twice the ac frequency $(120 \mathrm{~Hz}$ for the 60 Hz line voltage in the United States).

Variations of this circuit exist for voltage triplers, quadruplers, etc. Figure 1.67 shows doubler, tripler, and quadrupler circuits that let you ground one side of the transformer. You can extend this scheme as far as you want, producing what's called a Cockcroft-Walton generator; these are used in arcane applications (such as particle accelerators) and in everyday applications (such as image intensifiers, air ionizers, laser copiers, and even bug zappers) that require a high dc voltage but hardly any current.

### 1.6.5 Regulators

By choosing capacitors that are sufficiently large, you can reduce the ripple voltage to any desired level. This bruteforce approach has three disadvantages.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0068.jpg?height=1149&width=707&top_left_y=219&top_left_x=269)

Figure 1.67. Voltage multipliers; these configurations don't require a floating voltage source.

- The required capacitors may be prohibitively bulky and expensive.
- The very short interval of current flow during each cycle $^{31}$ (only very near the top of the sinusoidal waveform) produces more $I^{2} R$ heating.
- Even with the ripple reduced to negligible levels, you still have variations of output voltage that are due to other causes, e.g., the dc output voltage will be roughly proportional to the ac input voltage, giving rise to fluctuations caused by input line voltage variations. In addition, changes in load current will still cause the output voltage to change because of the finite internal resistances of the transformer, diode, etc. In other words, the Thévenin equivalent circuit of the dc power supply has $R>0$.
A better approach to power-supply design is to use enough capacitance to reduce ripple to low levels (perhaps

[^25]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0068.jpg?height=228&width=677&top_left_y=220&top_left_x=1136)

Figure 1.68. Regulated dc power supply.
$10 \%$ of the dc voltage), then use an active feedback circuit to eliminate the remaining ripple. Such a feedback circuit "looks at" the output, making changes in a controllable series resistor (a transistor) as necessary to keep the output voltage constant (Figure 1.68). This is known as a "linear regulated dc power supply." ${ }^{32}$

These voltage regulators are used almost universally as power supplies for electronic circuits. Nowadays complete voltage regulators are available as inexpensive ICs (priced under \$1). A power supply built with a voltage regulator can be made easily adjustable and self-protecting (against short circuits, overheating, etc.), with excellent properties as a voltage source (e.g., internal resistance measured in milliohms). We will deal with regulated dc power supplies in Chapter 9.

### 1.6.6 Circuit applications of diodes

#### A. Signal rectifier

There are other occasions when you use a diode to make a waveform of one polarity only. If the input waveform isn't a sinewave, you usually don't think of it as a rectification in the sense of a power supply. For instance, you might want a train of pulses corresponding to the rising edge of a square wave. The easiest way is to rectify the differentiated wave (Figure 1.69). Always keep in mind the 0.6 V (approximately) forward drop of the diode. This circuit, for instance, gives no output for square waves smaller than 0.6 V pp . If this is a problem, there are various tricks to circumvent this limitation. One possibility is to use hot carrier diodes (Schottky diodes), with a forward drop of about 0.25 V .

A possible circuit solution to this problem of finite diode drop is shown in Figure 1.70. Here $D_{1}$ compensates $D_{2}$ 's forward drop by providing 0.6 V of bias to hold $D_{2}$ at the threshold of conduction. Using a diode $\left(D_{1}\right)$ to provide the bias (rather than, say, a voltage divider) has several

[^26]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0069.jpg?height=213&width=545&top_left_y=220&top_left_x=248)

Figure 1.69. Signal rectifier applied to differentiator output.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0069.jpg?height=402&width=516&top_left_y=544&top_left_x=265)

Figure 1.70. Compensating the forward voltage drop of a diode signal rectifier.
advantages: (a) there is nothing to adjust, (b) the compensation will be nearly perfect, and (c) changes of the forward drop (e.g., with changing temperature) will be compensated properly. Later we will see other instances of matched-pair compensation of forward drops in diodes, transistors, and FETs. It is a simple and powerful trick.

#### B. Diode gates

Another application of diodes, which we will recognize later under the general heading of logic, is to pass the higher of two voltages without affecting the lower. A good example is battery backup, a method of keeping something running (e.g, the "real-time clock" chip in a computer, which keeps a running count of date and time) that must continue running even when the device is switched off. Figure 1.71 shows a circuit that does the job. The battery does nothing until the +5 V power is switched off; then it takes over without interruption.

#### C. Diode clamps

Sometimes it is desirable to limit the range of a signal (i.e., prevent it from exceeding certain voltage limits) somewhere in a circuit. The circuit shown in Figure 1.72 will accomplish this. The diode prevents the output from exceeding about +5.6 V , with no effect on voltages less than that (including negative voltages); the only limitation is that the input must not go so negative that the reverse breakdown voltage of the diode is exceeded (e.g., -75 V for a 1N4148). The series resistor limits the diode current during
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0069.jpg?height=414&width=715&top_left_y=219&top_left_x=1015)

Figure 1.71. Diode OR gate: battery backup. The real-time clock chips are specified to operate properly with supply voltages from +1.8 V to +5.5 V . They draw a paltry $0.25 \mu \mathrm{~A}$, which calculates to a 1-million-hour life (a hundred years) from a standard CR2032 coin cell!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0069.jpg?height=151&width=332&top_left_y=894&top_left_x=1204)

Figure 1.72. Diode voltage clamp.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0069.jpg?height=417&width=511&top_left_y=1154&top_left_x=1117)

Figure 1.73. Voltage divider providing clamping voltage.
clamping action; however, a side effect is that it adds $1 \mathrm{k} \Omega$ of series resistance (in the Thévenin sense) to the signal, so its value is a compromise between maintaining a desirable low source (Thévenin) resistance and a desirable low clamping current. Diode clamps are standard equipment on all inputs in contemporary CMOS digital logic. Without them, the delicate input circuits are easily destroyed by static electricity discharges during handling.

Exercise 1.22. Design a symmetrical clamp, i.e., one that confines a signal to the range -5.6 to +5.6 V .

A voltage divider can provide the reference voltage for a clamp (Figure 1.73). In this case you must ensure that the resistance looking into the voltage divider $\left(R_{\mathrm{vd}}\right)$ is small compared with $R$ because what you have looks as shown
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0070.jpg?height=205&width=394&top_left_y=219&top_left_x=423)

Figure 1.74. Clamping to voltage divider: equivalent circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0070.jpg?height=216&width=323&top_left_y=545&top_left_x=461)

Figure 1.75. Poor clamping: voltage divider not stiff enough.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0070.jpg?height=307&width=521&top_left_y=880&top_left_x=362)

Figure 1.76. Clamping waveform for circuit of Figure 1.73.
in Figure 1.74 when the voltage divider is replaced with its Thévenin equivalent circuit. When the diode conducts (input voltage exceeds clamp voltage), the output is really just the output of a voltage divider, with the Thévenin equivalent resistance of the voltage reference as the lower resistor (Figure 1.75). So, for the values shown, the output of the clamp for a triangle-wave input would look as shown in Figure 1.76. The problem is that the voltage divider doesn't provide a stiff reference, in the language of electronics. A stiff voltage source is one that doesn't bend easily, i.e., it has low internal (Thévenin) resistance.

In practice, the problem of finite impedance of the voltage-divider reference can be easily solved by use of a transistor or an op-amp. This is usually a better solution than using very small resistor values, because it doesn't consume large currents, yet it provides a voltage reference with a Thévenin resistance of a few ohms or less. Furthermore, there are other ways to construct a clamp, using an op-amp as part of the clamp circuit. You will see these methods in Chapter 4.

Alternatively, a simple way to stiffen the clamp circuit of Figure 1.73, for time-varying signals only, is to add a socalled bypass capacitor across the lower ( $1 \mathrm{k} \Omega$ ) resistor. To understand this fully we need to know about capacitors in
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0070.jpg?height=210&width=495&top_left_y=219&top_left_x=1222)

Figure 1.77. dc restoration.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0070.jpg?height=215&width=361&top_left_y=538&top_left_x=1289)

Figure 1.78. Diode limiter.
the frequency domain, a subject we'll take up shortly. For now we'll simply say that you can put a capacitor across the 1 k resistor, and its stored charge acts to maintain that point at constant voltage. For example, a $15 \mu \mathrm{~F}$ capacitor to ground would make the divider look as if it had a Thévenin resistance of less than $10 \Omega$ for frequencies above 1 kHz . (You could similarly add a bypass capacitor across $D_{1}$ in Figure 1.70.) As we'll learn, the effectiveness of this trick decreases at low frequencies, and it does nothing at dc.

One interesting clamp application is "dc restoration" of a signal that has been ac coupled (capacitively coupled). Figure 1.77 shows the idea. This is particularly important for circuits whose inputs look like diodes (e.g., a transistor with grounded emitter, as we'll see in the next chapter); otherwise an ac-coupled signal will just fade away, as the coupling capacitor charges up to the signal's peak voltage.

#### D. Limiter

One last clamp circuit is shown in Figure 1.78. This circuit limits the output "swing" (again, a common electronics term) to one diode drop in either polarity, roughly $\pm 0.6 \mathrm{~V}$. That might seem awfully small, but if the next stage is an amplifier with large voltage amplification, its input will always be near 0 V ; otherwise the output is in "saturation" (e.g., if the next stage has a gain of 1000 and operates from $\pm 15 \mathrm{~V}$ supplies, its input must stay in the range $\pm 15 \mathrm{mV}$ in order for its output not to saturate). Figure 1.79 shows what a limiter does to oversize sinewaves and spikes. This clamp circuit is often used as input protection for a highgain amplifier.

#### E. Diodes as nonlinear elements

To a good approximation the forward current through a diode is proportional to an exponential function of the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0071.jpg?height=935&width=625&top_left_y=211&top_left_x=208)

Figure 1.79. A. Limiting large-amplitude sinewaves; B. details; and C. spikes.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0071.jpg?height=297&width=330&top_left_y=1283&top_left_x=358)

Figure 1.80. Exploiting the diode's nonlinear $V-I$ curve: logarithmic converter.
voltage across it at a given temperature (for a discussion of the exact law, see $\S 2.3 .1$ ). So you can use a diode to generate an output voltage proportional to the logarithm of a current (Figure 1.80). Because $V$ hovers in the region of 0.6 V , with only small voltage changes that reflect input current variations, you can generate the input current with a resistor if the input voltage is much larger than a diode drop (Figure 1.81).

In practice, you may want an output voltage that isn't offset by the 0.6 V diode drop. In addition, it would be nice to have a circuit that is insensitive to changes in temperature (a silicon diode's voltage drop decreases approximately $2 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ ). The method of diode drop compensation is helpful here (Figure 1.82). $R_{1}$ makes $D_{2}$ conduct, holding
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0071.jpg?height=215&width=401&top_left_y=209&top_left_x=1172)

Figure 1.81. Approximate log converter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0071.jpg?height=350&width=467&top_left_y=529&top_left_x=1139)

Figure 1.82. Diode drop compensation in the logarithmic converter.
point $A$ at about -0.6 V . Point $B$ is then near ground (making $I_{\text {in }}$ accurately proportional to $V_{\text {in }}$, incidentally). As long as the two (identical) diodes are at the same temperature, there is good cancellation of the forward drops, except, of course, for the difference owing to input current through $D_{1}$, which produces the desired output. In this circuit, $R_{1}$ should be chosen so that the current through $D_{2}$ is significantly larger than the maximum input current in order to keep $D_{2}$ in conduction.

In Chapter $2 x$ we will examine better ways of constructing logarithmic converter circuits, along with careful methods of temperature compensation. With such methods it is possible to construct logarithmic converters accurate to a few percent over six decades or more of input current. A better understanding of diode and transistor characteristics, along with an understanding of op-amps, is necessary first. This section is meant to serve only as an introduction for things to come.

### 1.6.7 Inductive loads and diode protection

What happens if you open a switch that is providing current to an inductor? Because inductors have the property

$$
V=L d I / d t
$$

it is not possible to turn off the current suddenly, because that would imply an infinite voltage across the inductor's terminals. What happens instead is that the voltage across the inductor rises abruptly and keeps rising until it forces current to flow. Electronic devices controlling inductive
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0072.jpg?height=368&width=228&top_left_y=219&top_left_x=508)

Figure 1.83. Inductive "kick."
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0072.jpg?height=365&width=335&top_left_y=695&top_left_x=455)

Figure 1.84. Blocking inductive kick.
loads can be easily damaged, especially the component that "breaks down" in order to satisfy the inductor's craving for continuity of current. Consider the circuit in Figure 1.83 . The switch is initially closed, and current is flowing through the inductor (which might be a relay, as described later). When the switch is opened, the inductor tries to keep current flowing from $A$ to $B$, as it had been. In other words, it tries to make current flow out of $B$, which it does by forcing $B$ to a high positive voltage (relative to $A$ ). In a case like this, in which there's no connection to terminal $B$, it may go 1000 V positive before the switch contact "blows over." This shortens the life of the switch and also generates impulsive interference that may affect other circuits nearby. If the switch happens to be a transistor, it would be an understatement to say that its life is shortened; its life is ended.

The best solution usually is to put a diode across the inductor, as in Figure 1.84. When the switch is on, the diode is back-biased (from the dc drop across the inductor's winding resistance). At turn-off the diode goes into conduction, putting the switch terminal a diode drop above the positive supply voltage. The diode must be able to handle the initial diode current, which equals the steady current that had been flowing through the inductor; something like a 1N4004 is fine for nearly all cases.

The only disadvantage of this simple protection circuit is that it lengthens the decay of current through the inductor, because the rate of change of inductor current
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0072.jpg?height=246&width=225&top_left_y=219&top_left_x=1362)

Figure 1.85. $R C$ "snubber" for suppressing inductive kick.
is proportional to the voltage across it. For applications in which the current must decay quickly (high-speed actuators or relays, camera shutters, magnet coils, etc.), it may be better to put a resistor across the inductor, choosing its value so that $V_{\text {supply }}+I R$ is less than the maximum allowed voltage across the switch. For the fastest decay with a given maximum voltage, a zener with series diode (or other voltage-clamping device) can be used instead, giving a linear-like ramp-down of current rather than an exponential decay (see discussion in Chapter 1x).

For inductors driven from ac (transformers, ac relays), the diode protection just described will not work, because the diode will conduct on alternate half-cycles when the switch is closed. In that case a good solution is an $R C$ "snubber" network (Figure 1.85). The values shown are typical for small inductive loads driven from the ac powerline. Such a snubber should be included in all instruments that run from the ac powerline, because the power transformer is inductive. ${ }^{33}$

An alternative to the $R C$ snubber is the use of a bidirectional zener-like voltage-clamping element. Among these the most common are the bidirectional "TVS" (transient voltage suppressor) zener and the metal-oxide varistor ("MOV"); the latter is an inexpensive device that looks something like a disc ceramic capacitor and behaves electrically like a bidirectional zener diode. Both classes are designed for transient voltage protection, are variously available at voltage ratings from 10 to 1000 volts, and can handle transient currents up to thousands of amperes (see Chapter $9 x$ ). Including a transient suppressor (with appropriate fusing) across the ac powerline terminals makes good sense in a piece of electronic equipment, not only to prevent inductive spike interference to other nearby instruments but also to prevent occasional large powerline spikes from damaging the instrument itself.

### 1.6.8 Interlude: inductors as friends

Lest we leave the impression that inductance and inductors are things only to be feared, let's look at the circuit in

[^27]Figure 1.86. The goal is to charge up the capacitor from a source of dc voltage $V_{\text {in }}$. In the top circuit (Figure 1.86A) we've done it the conventional way, with a series resistor to limit the peak current demanded from the voltage source. OK, it does work - but it has a drawback that can be serious, namely that half the energy is lost as heat in the resistor. By contrast, in the circuit with the inductor (Figure 1.86 B ) no energy is lost (assuming ideal components); and, as a bonus, the capacitor gets charged to twice the input voltage. The output-voltage waveform is a sinusoidal half-cycle at the resonant frequency $f=1 / 2 \pi \sqrt{L C}$, a topic we'll see soon (§1.7.14). ${ }^{34,35}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0073.jpg?height=190&width=334&top_left_y=790&top_left_x=244)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0073.jpg?height=481&width=585&top_left_y=776&top_left_x=241)
B.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0073.jpg?height=562&width=800&top_left_y=209&top_left_x=973)

Figure 1.87. Example of frequency analysis: "boom box" loudspeaker equalization. The lowest and highest piano notes, called A0 and C8, are at 27.5 Hz and 4.2 kHz ; they are four octaves below A440 and four octaves above middle C, respectively.

## 1.7 Impedance and reactance

Warning: this section is somewhat mathematical; you may wish to skip over the mathematics, but be sure to pay attention to the results and graphs.

Circuits with capacitors and inductors are more complicated than the resistive circuits we talked about earlier, in that their behavior depends on frequency: a "voltage divider" containing a capacitor or inductor will have a frequency-dependent division ratio. In addition, circuits containing these components (known collectively as reactive components) "corrupt" input waveforms such as square waves, as we saw earlier.

However, both capacitors and inductors are linear devices, meaning that the amplitude of the output waveform, whatever its shape, increases exactly in proportion to the input waveform's amplitude. This linearity has many consequences, the most important of which is probably the following: the output of a linear circuit, driven with a sinewave at some frequency $f$, is itself a sinewave at the same frequency (with, at most, changed amplitude and phase).

Because of this remarkable property of circuits containing resistors, capacitors, and inductors (and, later, linear amplifiers), it is particularly convenient to analyze any such circuit by asking how the output voltage (amplitude and phase) depends on the input voltage for sinewave input at a single frequency, even though this may not be the intended use. A graph of the resulting frequency response, in which the ratio of output to input is plotted for each sinewave frequency, is useful for thinking about many kinds of

[^28]Figure 1.86. Resonant charging is lossless (with ideal components) compared with the $50 \%$ efficiency of resistive charging. Charging is complete after $t_{\mathrm{f}}$, equal to a half-cycle of the resonant frequency. The series diode terminates the cycle, which would otherwise continue to oscillate between 0 and $2 V_{\text {in }}$.
waveforms. As an example, a certain "boom-box" loudspeaker might have the frequency response shown in Figure 1.87, in which the "output" in this case is of course sound pressure, not voltage. It is desirable for a speaker to have a "flat" response, meaning that the graph of sound pressure versus frequency is constant over the band of audible frequencies. In this case the speaker's deficiencies can be corrected by the introduction of a passive filter with the inverse response (as shown) within the amplifiers of the radio.

As we will see, it is possible to generalize Ohm's law, replacing the word "resistance" with "impedance," in order to describe any circuit containing these linear passive devices (resistors, capacitors, and inductors). You could think of the subject of impedance (generalized resistance) as Ohm's law for circuits that include capacitors and inductors.

Some terminology: impedance $(\mathbf{Z})$ is the "generalized resistance"; inductors and capacitors, for which the voltage and current are always $90^{\circ}$ out of phase, are reactive; they have reactance $(X)$. Resistors, with voltage and current always in phase, are resistive; they have resistance ( $R$ ). In general, in a circuit that combines resistive and reactive components, the voltage and current at some place will have some in-between phase relationship, described by a complex impedance: impedance $=$ resistance + reactance, or $\mathbf{Z}=R+j X$ (more about this later). ${ }^{36}$ However, you'll see statements like "the impedance of the capacitor at this frequency is . . ." The reason you don't have to use the word "reactance" in such a case is that impedance covers everything. In fact, you frequently use the word "impedance" even when you know it's a resistance you're talking about; you say "the source impedance" or "the output impedance" when you mean the Thévenin equivalent resistance of some source. The same holds for "input impedance."

In all that follows, we will be talking about circuits driven by sinewaves at a single frequency. Analysis of circuits driven by complicated waveforms is more elaborate, involving the methods we used earlier (differential equations) or decomposition of the waveform into sinewaves (Fourier analysis). Fortunately, these methods are seldom necessary.

### 1.7.1 Frequency analysis of reactive circuits

Let's start by looking at a capacitor driven by a sinewave voltage source $V(t)=V_{0} \sin \omega t$ (Figure 1.88). The current

[^29]is
$$
I(t)=C \frac{d V}{d t}=C \omega V_{0} \cos \omega t,
$$
i.e., a current of amplitude $\omega C V_{0}$, with its phase leading the input voltage by $90^{\circ}$. If we consider amplitudes only, and disregard phases, the current is
$$
I=\frac{V}{1 / \omega C}
$$
(Recall that $\omega=2 \pi f$.) It behaves like a frequencydependent resistance $R=1 / \omega C$, but in addition the current is $90^{\circ}$ out of phase with the voltage (Figure 1.89).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0074.jpg?height=210&width=393&top_left_y=778&top_left_x=1278)

Figure 1.88. A sinusoidal ac voltage drives a capacitor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0074.jpg?height=415&width=575&top_left_y=1119&top_left_x=1182)

Figure 1.89. Current in a capacitor leads the sinusoidal voltage by $90^{\circ}$.

For example, a $1 \mu \mathrm{~F}$ capacitor put across the 115 volts (rms) 60 Hz powerline draws a current of rms amplitude:

$$
I=\frac{115}{1 /\left(2 \pi \times 60 \times 10^{-6}\right)}=43.4 \mathrm{~mA}(\mathrm{rms})
$$

Soon enough we will complicate matters by explicitly worrying about phase shifts and the like - and that will get us into some complex algebra that terrifies beginners (often) and mathophobes (always). Before we do that, though, this is a good time to develop intuition about the frequencydependent behavior of some basic and important circuits that use capacitors, ignoring for the time being the troublesome fact that, when driven with a sinusoidal signal, currents and voltages in a capacitor are not in phase.

As we just saw, the ratio of magnitudes of voltage to
current, in a capacitor driven at a frequency $\omega$, is just

$$
\frac{|V|}{|I|}=\frac{1}{\omega C}
$$

which we can think of as a sort of "resistance" - the magnitude of the current is proportional to the magnitude of the applied voltage. The official name for this quantity is reactance, with the symbol $X$, thus $X_{\mathrm{C}}$ for the reactance of a capacitor. ${ }^{37}$ So, for a capacitor,

$$
\begin{equation*}
X_{\mathrm{C}}=\frac{1}{\omega C} \tag{1.26}
\end{equation*}
$$

This means that a larger capacitance has a smaller reactance. And this makes sense, because, for example, if you double the value of a capacitor, it takes twice as much current to charge and discharge it through the same voltage swing in the same time (recall $I=C d V / d t$ ). For the same reason the reactance decreases as you increase the frequency - doubling the frequency (while holding $V$ constant) doubles the rate of change of voltage and therefore requires that you double the current, thus half the reactance.

So, roughly speaking, we can think of a capacitor as a "frequency-dependent resistor." Sometimes that's good enough, sometimes it isn't. We'll look at a few circuits in which this simplified view gets us reasonably good results, and provides nice intuition; later we'll fix it up, using the correct complex algebra, to get a precise result. (Keep in mind that the results we are about to get are approximate; we're lying to you - but it's a small lie, and anyway we'll tell the truth later. In the meantime we'll use the weird symbol $\asymp$ instead of = in all such "approximate equations," and we'll flag the equation as approximate.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0075.jpg?height=192&width=315&top_left_y=1567&top_left_x=363)

Figure 1.90. Lowpass filter.

#### A. RC lowpass filter (approximate)

The circuit in Figure 1.90 is called a lowpass filter, because it passes low frequencies and blocks high frequencies. If you think of it as a frequency-dependent voltage divider, this makes sense: the lower leg of the divider (the capacitor) has a decreasing reactance with increasing frequency, so the ratio of $V_{\text {out }} / V_{\text {in }}$ decreases accordingly:

[^30]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0075.jpg?height=840&width=802&top_left_y=218&top_left_x=977)

Figure 1.91. Frequency response of single-section $R C$ filters, showing the results both of a simple approximation that ignores phase (dashed curve), and the exact result (solid curve). The fractional error (i.e., dashed/solid) is plotted above.

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}} \asymp \frac{X_{\mathrm{C}}}{R+X_{\mathrm{C}}}=\frac{1 / \omega C}{R+1 / \omega C}=\frac{1}{1+\omega R C} \quad \text { (approximate!) } \tag{1.27}
\end{equation*}
$$

We've plotted that ratio in Figure 1.91 (and also that of its cousin, the highpass filter), along with their exact results that we'll understand soon enough in §1.7.8.

You can see that the circuit passes low frequencies fully (because at low frequencies the capacitor's reactance is very high, so it's like a divider with a smaller resistor atop a larger one) and that it blocks high frequencies. In particular, the crossover from "pass" to "block" (often called the breakpoint) occurs at a frequency $\omega_{0}$ at which the capacitor's reactance $\left(1 / \omega_{0} C\right)$ is equal to the resistance $R: \omega_{0}=$ $1 / R C$. At frequencies well beyond the crossover (where the product $\omega R C \gg 1$ ), the output decreases inversely with increasing frequency; that makes sense because the reactance of the capacitor, already much smaller than $R$, continues dropping as $1 / \omega$. It's worth noting that, even with our "ignoration of phase shifts," the equation (and graph) for the ratio of voltages is quite accurate at both low and high frequencies and is only modestly in error around the crossover
frequency, where the correct ratio is $V_{\text {out }} / V_{\text {in }}=1 / \sqrt{2} \approx$ 0.7 , rather than the 0.5 that we got. ${ }^{38}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0076.jpg?height=231&width=341&top_left_y=341&top_left_x=452)

Figure 1.92. Highpass filter.

#### B. RC highpass filter (approximate)

You get the reverse behavior (pass high frequencies, block low) by interchanging $R$ and $C$, as in Figure 1.92. Treating it as a frequency-dependent voltage divider, and ignoring phase shifts once again, we get (see Figure 1.91)

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}} \asymp \frac{R}{R+X_{C}}=\frac{R}{R+1 / \omega C}=\frac{\omega R C}{1+\omega R C} \quad \text { (approximate!) } \tag{1.28}
\end{equation*}
$$

High frequencies (above the same crossover frequency as before, $\omega \gg \omega_{0}=1 / R C$ ) pass through (because the capacitor's reactance is much smaller than $R$ ), whereas frequencies well below the crossover are blocked (the capacitor's reactance is much larger than $R$ ). As before, the equation and graph are accurate at both ends, and only modestly in error at the crossover, where the correct ratio is, again, $V_{\text {out }} / V_{\text {in }}=1 / \sqrt{2}$.

#### C. Blocking capacitor

Sometimes you want to let some band of signal frequencies pass through a circuit, but you want to block any steady dc voltage that may be present (we'll see how this can happen when we learn about amplifiers in the next chapter). You can do the job with an $R C$ highpass filter if you choose the crossover frequency correctly: a highpass filter always blocks dc, so what you do is choose component values so that the crossover frequency is below all frequencies of interest. This is one of the more frequent uses of a capacitor and is known as a dc blocking capacitor.

For instance, every stereo audio amplifier has all its inputs capacitively coupled, because it doesn't know what dc level its input signals might be riding on. In such a coupling application you always pick $R$ and $C$ so that all frequencies of interest (in this case, 20 Hz to 20 kHz ) are passed

[^31]without loss (attenuation). That determines the product $R C: R C>1 / \omega_{\min }$, where for this case you might choose $f_{\min } \approx 5 \mathrm{~Hz}$, and so $R C=1 / \omega_{\min }=1 / 2 \pi f_{\min } \approx 30 \mathrm{~ms}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0076.jpg?height=310&width=657&top_left_y=401&top_left_x=1141)

Figure 1.93. "Blocking capacitor": a highpass filter for which all signal frequencies of interest are in the passband.

You've got the product, but you still have to choose individual values for $R$ and $C$. You do this by noticing that the input signal sees a load equal to $R$ at signal frequencies (where $C$ 's reactance is small - it's just a piece of wire there), so you choose $R$ to be a reasonable load, i.e., not so small that it's hard to drive, and not so large that the circuit is prone to signal pickup from other circuits in the box. In the audio business it's common to see a value of $10 \mathrm{k} \Omega$, so we might choose that value, for which the corresponding $C$ is $3.3 \mu \mathrm{~F}$ (Figure 1.93). The circuit connected to the output should have an input resistance much greater than $10 \mathrm{k} \Omega$, to avoid loading effects on the filter's output; and the driving circuit should be able to drive a $10 \mathrm{k} \Omega$ load without significant attenuation (loss of signal amplitude) to prevent circuit loading effects by the filter on the signal source. It's worth noting that our approximate model, ignoring phase shifts, is perfectly adequate for blocking capacitor design; that is because the signal band is fully in the passband, where the effects of phase shifts are negligible.

In this section we've been thinking in the frequency domain (sinewaves of frequency $f$ ). But it's useful to think in the time domain, where, for example, you might use a blocking capacitor to couple pulses, or square waves. In such situations you encounter waveform distortion, in the form of "droop" and overshoot (rather than the simple amplitude attenuation and phase shift you get with sinusoidal waves). Thinking in the time domain, the criterion you use to avoid waveform distortion in a pulse of duration $T$ is that the time constant $\tau=R C \gg T$. The resulting droop is approximately $T / \tau$ (followed by a comparable overshoot at the next transition).

You often need to know the reactance of a capacitor at a given frequency (e.g., for design of filters). Figure 1.100 in §1.7.8 provides a very useful graph covering large ranges
of capacitance and frequency, giving the value of $X_{C}=$ $1 / 2 \pi f C$.

#### D. Driving and loading RC filters

This example of an audio-blocking capacitor raised the issue of driving and loading $R C$ filter circuits. As we discussed in $\S 1.2 .5 \mathrm{~A}$, in the context of voltage dividers, you generally like to arrange things so that the circuit being driven does not significantly load the driving resistance (Thévenin equivalent source resistance) of the signal source.

The same logic applies here, but with a generalized kind of resistance that includes the reactance of capacitors (and inductors), known as impedance. So a signal source's impedance should generally be small compared with the impedance of the thing being driven. ${ }^{39}$ We'll have a precise way of talking about impedance shortly, but it's correct to say that, apart from phase shifts, the impedance of a capacitor is equal to its reactance.

What we want to know, then, are the input and output impedances of the two simple $R C$ filters (lowpass and highpass). This sounds complicated, because there are four impedances, and they all vary with frequency. However, if you ask the question the right way, the answer is simple, and the same in all cases!

First, assume that in each case the right thing is being done to the other end of the filter: when we ask the input impedance, we assume the output drives a high impedance (compared with its own); and when we ask the output impedance, we assume the input is driven by a signal source of low internal (Thévenin) impedance. Second, we dispose of the variation of impedances with frequency by asking only for the worst-case value; that is, we care what only the maximum output impedance of a filter circuit may be (because that is the worst for driving a load), and we care about only the minimum input impedance (because that is the hardest to drive).

Now the answer is astonishingly simple: in all cases the worst-case impedance is just $R$.
Exercise 1.23. Show that the preceding statement is correct.
So, for example, if you want to hang an $R C$ lowpass filter onto the output of an amplifier whose output resistance is $100 \Omega$, start with $R=1 \mathrm{k}$, then choose $C$ for the breakpoint you want. Be sure that whatever loads the output has an input impedance of at least 10k. You can't go wrong.

Exercise 1.24. Design a two-stage "bandpass" $R C$ filter, in which

[^32]the first stage is highpass with a breakpoint of 100 Hz , and the second stage is lowpass with a breakpoint of 10 kHz . Assume the input signal source has an impedance of $100 \Omega$. What is the worstcase output impedance of your filter, and therefore what is the minimum recommended load impedance?

### 1.7.2 Reactance of inductors

Before we embark on a fully correct treatment of impedance, replete with complex exponentials and the like, let's use our approximation tricks to figure out the reactance of an inductor.

It goes as before: we imagine an inductor $L$ driven by a sinusoidal voltage source of angular frequency $\omega$ such that a current $I(t)=I_{0} \sin \omega t$ is flowing. ${ }^{40}$ Then the voltage across the inductor is

$$
V(t)=L \frac{d I(t)}{d t}=L \omega I_{0} \cos \omega t
$$

And so the ratio of magnitudes of voltage to current - the resistance-like quantity called reactance - is just

$$
\frac{|V|}{|I|}=\frac{L \omega I_{0}}{I_{0}}=\omega L
$$

So. for an inductor,

$$
\begin{equation*}
X_{\mathrm{L}}=\omega L \tag{1.29}
\end{equation*}
$$

Inductors, like capacitors, have a frequency-dependent reactance; however, here the reactance increases with increasing frequency (the opposite of capacitors, where it decreases with increasing frequency). So, in the simplest view, a series inductor can be used to pass dc and low frequencies (where its reactance is small) while blocking high frequencies (where its reactance is high). You often see inductors used this way, particularly in circuits that operate at radio frequencies; in that application they're sometimes called chokes.

### 1.7.3 Voltages and currents as complex numbers

At this point it is necessary to get into some complex algebra; you may wish to skip over the math in some of the following sections, taking note of the results as we derive them. A knowledge of the detailed mathematics is not necessary for understanding the remainder of the book. Very little mathematics will be used in later chapters. The section ahead is easily the most difficult for the reader with little mathematical preparation. Don't be discouraged!

As we've just seen, there can be phase shifts between

[^33]the voltage and current in an ac circuit being driven by a sinewave at some frequency. Nevertheless, as long as the circuit contains only linear elements (resistors, capacitors, inductors), the magnitudes of the currents everywhere in the circuit are still proportional to the magnitude of the driving voltage, so we might hope to find some generalization of voltage, current, and resistance in order to rescue Ohm's law. Evidently a single number won't suffice to specify the current, say, at some point in the circuit, because we must somehow have information about both the magnitude and phase shift.

Although we can imagine specifying the magnitudes and phase shifts of voltages and currents at any point in the circuit by writing them out explicitly, e.g., $V(t)=$ $23.7 \sin (377 t+0.38)$, it turns out that we can meet our requirements more simply by using the algebra of complex numbers to represent voltages and currents. Then we can simply add or subtract the complex number representations, rather than laboriously having to add or subtract the actual sinusoidal functions of time themselves. Because the actual voltages and currents are real quantities that vary with time, we must develop a rule for converting from actual quantities to their representations, and vice versa. Recalling once again that we are talking about a single sinewave frequency, $\omega$, we agree to use the following rules.

1. Voltages and currents are represented by the complex quantities $\mathbf{V}$ and $\mathbf{I}$. The voltage $V_{0} \cos (\omega t+\phi)$ is to be represented by the complex number $V_{0} e^{j \phi}$. Recall that $e^{j \phi}=\cos \phi+j \sin \phi$, where $j=\sqrt{-1}$.
2. We obtain actual voltages and currents by multiplying their complex number representations by $e^{j \omega t}$ and then taking the real part: $V(t)=\mathscr{R} e\left(\mathbf{V} e^{j \omega t}\right), I(t)=$ $\mathscr{R} e\left(\mathbf{I}^{j \omega t}\right)$.

In other words,

| circuit voltage versus time |  | complex number representation |
| :---: | :---: | :---: |
| $V_{0} \cos (\omega t+\phi)$ |  | $V_{0} e^{j \phi}=a+j b$ |
|  | multiply by $e^{j \omega t}$ and take real part |  |

(In electronics, the symbol $j$ is used instead of $i$ in the exponential in order to avoid confusion with the symbol $i$ meaning small-signal current.) Thus, in the general case, the actual voltages and currents are given by

$$
\begin{aligned}
V(t) & =\mathscr{R e} e\left(\mathbf{V} e^{j \omega t}\right) \\
& =\mathscr{R} e(\mathbf{V}) \cos \omega t-\mathscr{I} m(\mathbf{V}) \sin \omega t
\end{aligned}
$$

$$
\begin{aligned}
I(t) & =\mathscr{R} e\left(\mathbf{I} e^{j \omega t}\right) \\
& =\mathscr{R} e(\mathbf{I}) \cos \omega t-\mathscr{I} m(\mathbf{I}) \sin \omega t .
\end{aligned}
$$

For example, a voltage whose complex representation is

$$
\mathbf{V}=5 j
$$

corresponds to a (real) voltage versus time of

$$
\begin{aligned}
V(t) & =\mathscr{R} e[5 j \cos \omega t+5 j(j) \sin \omega t] \\
& =-5 \sin \omega t \text { volts. }
\end{aligned}
$$

### 1.7.4 Reactance of capacitors and inductors

With this convention we can apply complex Ohm's law correctly to circuits containing capacitors and inductors, just as for resistors, once we know the reactance of a capacitor or inductor. Let's find out what these are. We begin with a simple (co)sinusoidal voltage $V_{0} \cos \omega t$ applied across a capacitor:

$$
V(t)=\mathscr{R} e\left(V_{0} e^{j \omega t}\right) .
$$

Then, using $I=C(d V(t) / d t)$, we obtain

$$
\begin{aligned}
I(t) & =-V_{0} C \omega \sin \omega t=\mathscr{R} e\left(\frac{V_{0} e^{j \omega t}}{-j / \omega C}\right), \\
& =\mathscr{R} e\left(\frac{V_{0} e^{j \omega t}}{\mathbf{Z}_{\mathrm{C}}}\right)
\end{aligned}
$$

i.e., for a capacitor

$$
\mathbf{Z}_{\mathrm{C}}=-j / \omega C \quad\left(=-j X_{\mathrm{C}}\right) ;
$$

$\mathbf{Z}_{\mathrm{C}}$ is the impedance of a capacitor at frequency $\omega$; it is equal in magnitude to the reactance $X_{C}=1 / \omega C$ that we found earlier, but with a factor of $-j$ that accounts for the $90^{\circ}$ leading phase shift of current versus voltage. As an example, a $1 \mu \mathrm{~F}$ capacitor has an impedance of $-2653 j \Omega$ at 60 Hz , and $-0.16 j \Omega$ at 1 MHz . The corresponding reactances are $2653 \Omega$ and $0.16 \Omega .{ }^{41}$ Its reactance (and also its impedance) at dc is infinite.

If we did a similar analysis for an inductor, we would find

$$
\mathbf{Z}_{\mathrm{L}}=j \omega L \quad\left(=j X_{\mathrm{L}}\right) .
$$

A circuit containing only capacitors and inductors always has a purely imaginary impedance, meaning that the voltage and current are always $90^{\circ}$ out of phase - it is purely reactive. When the circuit contains resistors, there is also

[^34]a real part to the impedance. The term "reactance" in that case means the imaginary part only.

### 1.7.5 Ohm's law generalized

With these conventions for representing voltages and currents, Ohm's law takes a simple form. It reads simply

$$
\begin{aligned}
\mathbf{I} & =\mathbf{V} / \mathbf{Z} \\
\mathbf{V} & =\mathbf{I Z}
\end{aligned}
$$

where the voltage represented by $\mathbf{V}$ is applied across a circuit of impedance $\mathbf{Z}$, giving a current represented by $\mathbf{I}$. The complex impedance of devices in series or parallel obeys the same rules as resistance:

$$
\begin{align*}
& \mathbf{Z}=\mathbf{Z}_{\mathbf{1}}+\mathbf{Z}_{\mathbf{2}}+\mathbf{Z}_{\mathbf{3}}+\cdots \quad \text { (series) }  \tag{1.30}\\
& \mathbf{Z}=\frac{1}{\frac{1}{\mathbf{Z}_{1}}+\frac{1}{\mathbf{Z}_{\mathbf{2}}}+\frac{1}{\mathbf{Z}_{3}}+\cdots} \quad \text { (parallel) } \tag{1.31}
\end{align*}
$$

Finally, for completeness we summarize here the formulas for the impedance of resistors, capacitors, and inductors:

$$
\begin{array}{ll}
\mathbf{Z}_{\mathrm{R}}=R & (\text { (resistor) } \\
\mathbf{Z}_{\mathrm{C}}=-j / \omega C=1 / j \omega C & \text { (capacitor) }  \tag{1.32}\\
\mathbf{Z}_{\mathrm{L}}=j \omega L & \text { (inductor) }
\end{array}
$$

With these rules we can analyze many ac circuits by the same general methods we used in handling dc circuits, i.e., application of the series and parallel formulas and Ohm's law. Our results for circuits such as voltage dividers will look nearly the same as before. For multiply-connected networks we may have to use Kirchhoff's laws, just as with dc circuits, in this case using the complex representations for $V$ and $I$ : the sum of the (complex) voltage drops around a closed loop is zero, and the sum of the (complex) currents into a point is zero. The latter rule implies, as with dc circuits, that the (complex) current in a series circuit is the same everywhere.

Exercise 1.25. Use the preceding rules for the impedance of devices in parallel and in series to derive the formulas (1.17) and (1.18) for the capacitance of two capacitors (a) in parallel and (b) in series. Hint: in each case, let the individual capacitors have capacitances $C_{1}$ and $C_{2}$. Write down the impedance of the parallel or series combination; then equate it to the impedance of a capacitor with capacitance $C$. Then find $C$.

Let's try out these techniques on the simplest circuit imaginable, an ac voltage applied across a capacitor, which we looked at earlier, in §1.7.1. Then, after a brief look at power in reactive circuits (to finish laying the groundwork),
we'll analyze (correctly, this time) the simple but extremely important and useful $R C$ lowpass and highpass filter circuits.

Imagine putting a $1 \mu \mathrm{~F}$ capacitor across a 115 volts (rms) 60 Hz powerline. What current flows? Using complex Ohm's law, we have

$$
\mathbf{Z}=-j / \omega C
$$

Therefore, the current is given by

$$
\mathbf{I}=\mathbf{V} / \mathbf{Z}
$$

The phase of the voltage is arbitrary, so let us choose $\mathbf{V}=$ $A$, i.e., $V(t)=A \cos \omega t$, where the amplitude $A=115 \sqrt{2} \approx$ 163 volts. Then

$$
\mathbf{I}=j \omega C A \approx-0.061 \sin \omega t
$$

The resulting current has an amplitude of 61 mA ( 43 mA rms) and leads the voltage by $90^{\circ}$. This agrees with our previous calculation. More simply, we could have noticed that the impedance of the capacitor is negative imaginary, so whatever the absolute phase of $V$, the phase of $I_{\text {cap }}$ must lead by $90^{\circ}$. And in general the phase angle between current and voltage, for any two-terminal $R L C$ circuit, is equal to the angle of the (complex) impedance of that circuit.

Note that if we wanted to know just the magnitude of the current, and didn't care what the relative phase was, we could have avoided doing any complex algebra: if

$$
\mathbf{A}=\mathbf{B} / \mathbf{C}
$$

then

$$
A=B / C
$$

where $A, B$, and $C$ are the magnitudes of the respective complex numbers; this holds for multiplication, also (see Exercise 1.18). Thus, in this case,

$$
I=V / Z=\omega C V
$$

This trick, which we used earlier (because we didn't know any better), is often useful.

Surprisingly, there is no power dissipated by the capacitor in this example. Such activity won't increase your electric bill; you'll see why in the next section. Then we will go on to look at circuits containing resistors and capacitors with our complex Ohm's law.

Exercise 1.26. Show that, if $\mathbf{A}=\mathbf{B C}$, then $A=B C$, where $A, B$, and $C$ are magnitudes. Hint: represent each complex number in polar form, i.e., $\mathbf{A}=A e^{i \theta}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0080.jpg?height=480&width=835&top_left_y=209&top_left_x=200)

Figure 1.94. The power delivered to a capacitor is zero over a full sinusoidal cycle, owing to the $90^{\circ}$ phase shift between voltage and current.

### 1.7.6 Power in reactive circuits

The instantaneous power delivered to any circuit element is always given by the product $P=V I$. However, in reactive circuits where $V$ and $I$ are not simply proportional, you can't just multiply their amplitudes together. Funny things can happen; for instance, the sign of the product can reverse over one cycle of the ac signal. Figure 1.94 shows an example. During time intervals $A$ and $C$, power is being delivered to the capacitor (albeit at a variable rate), causing it to charge up; its stored energy is increasing (power is the rate of change of energy). During intervals $B$ and $D$, the power delivered to the capacitor is negative; it is discharging. The average power over a whole cycle for this example is in fact exactly zero, a statement that is always true for any purely reactive circuit element (inductors, capacitors, or any combination thereof). If you know your trigonometric integrals, the next exercise will show you how to prove this.

Exercise 1.27. Optional exercise: prove that a circuit whose current is $90^{\circ}$ out of phase with the driving voltage consumes no power, averaged over an entire cycle.

How do we find the average power consumed by an arbitrary circuit? In general, we can imagine adding up little pieces of VI product, then dividing by the elapsed time. In other words,

$$
\begin{equation*}
P=\frac{1}{T} \int_{0}^{T} V(t) I(t) d t \tag{1.33}
\end{equation*}
$$

where $T$ is the time for one complete cycle. Luckily, that's almost never necessary. Instead, it is easy to show that the average power is given by

$$
\begin{equation*}
P=\mathscr{R} e\left(\mathbf{V} \mathbf{I}^{*}\right)=\mathscr{R} e\left(\mathbf{V}^{*} \mathbf{I}\right), \tag{1.34}
\end{equation*}
$$

where $\mathbf{V}$ and $\mathbf{I}$ are complex rms amplitudes (and an asterisk means complex conjugate - see the math review, Appendix A, if this is unfamiliar).

Let's take an example. Consider the preceding circuit, with a 1 volt (rms) sinewave driving a capacitor. We'll do everything with rms amplitudes, for simplicity. We have

$$
\begin{aligned}
\mathbf{V} & =1 \\
\mathbf{I} & =\frac{\mathbf{V}}{-j / \omega C}=j \omega C \\
P & =\mathscr{R} e\left(\mathbf{V I}^{*}\right)=\mathscr{R} e(-j \omega C)=0 .
\end{aligned}
$$

That is, the average power is zero, as stated earlier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0080.jpg?height=254&width=391&top_left_y=832&top_left_x=1274)

Figure 1.95. Power and power factor in a series $R C$ circuit.
As another example, consider the circuit shown in Figure 1.95. Our calculations go like this:

$$
\begin{aligned}
\mathbf{Z} & =R-\frac{j}{\omega C} \\
\mathbf{V} & =V_{0} \\
\mathbf{I} & =\frac{\mathbf{V}}{\mathbf{Z}}=\frac{V_{0}}{R-(j / \omega C)}=\frac{V_{0}[R+(j / \omega C)]}{R^{2}+\left(1 / \omega^{2} C^{2}\right)} \\
P & =\mathscr{R} e\left(\mathbf{V I}^{*}\right)=\frac{V_{0}^{2} R}{R^{2}+\left(1 / \omega^{2} C^{2}\right)}
\end{aligned}
$$

(In the third line we multiplied numerator and denominator by the complex conjugate of the denominator in order to make the denominator real.) The calculated power ${ }^{42}$ is less than the product of the magnitudes of $\mathbf{V}$ and $\mathbf{I}$. In fact, their ratio is called the power factor:

$$
\begin{aligned}
|\mathbf{V}||\mathbf{I}| & =\frac{V_{0}^{2}}{\left[R^{2}+\left(1 / \omega^{2} C^{2}\right)\right]^{1 / 2}} \\
\text { power factor } & =\frac{\text { power }}{|\mathbf{V}||\mathbf{I}|} \\
& =\frac{R}{\left[R^{2}+\left(1 / \omega^{2} C^{2}\right)\right]^{1 / 2}}
\end{aligned}
$$

[^35]in this case. The power factor is the cosine of the phase angle between the voltage and the current, and it ranges from 0 (purely reactive circuit) to 1 (purely resistive). A power factor of less than 1 indicates some component of reactive current. ${ }^{43}$ It's worth noting that the power factor goes to unity, and the dissipated power goes to $V^{2} / R$, in the limit of large capacitance (or of high frequency), where the reactance of the capacitor becomes much less than $R$.

Exercise 1.28. Show that all the average power delivered to the preceding circuit winds up in the resistor. Do this by computing the value of $V_{R}^{2} / R$. What is that power, in watts, for a series circuit of a $1 \mu \mathrm{~F}$ capacitor and a 1.0 k resistor placed across the 115 volt (rms), 60 Hz powerline?

Power factor is a serious matter in large-scale electrical power distribution, because reactive currents don't result in useful power being delivered to the load, but cost the power company plenty in terms of $I^{2} R$ heating in the resistance of generators, transformers, and wiring. Although residential users are billed only for "real" power $\left[\mathscr{R} e\left(\mathbf{V I}^{*}\right)\right]$, the power company charges industrial users according to the power factor. This explains the capacitor yards that you see behind large factories, built to cancel the inductive reactance of industrial machinery (i.e., motors).

Exercise 1.29. Show that adding a series capacitor of value $C=$ $1 / \omega^{2} L$ makes the power factor equal 1.0 in a series $R L$ circuit. Now do the same thing, but with the word "series" changed to "parallel."

### 1.7.7 Voltage dividers generalized

Our original voltage divider (Figure 1.6) consisted of a pair of resistors in series to ground, input at the top and output at the junction. The generalization of that simple resistive divider is a similar circuit in which either or both resistors are replaced with a capacitor or inductor (or a more complicated network made from $R, L$, and $C$ ), as in Figure 1.96. In general, the division ratio $V_{\text {out }} / V_{\text {in }}$ of such a divider is not constant, but depends on frequency (as we have already seen, in our approximate treatment of the lowpass and highpass filters in §1.7.1). The analysis is straightforward:

$$
\begin{aligned}
\mathbf{I} & =\frac{\mathbf{V}_{\text {in }}}{\mathbf{Z}_{\text {total }}} \\
\mathbf{Z}_{\text {total }} & =\mathbf{Z}_{1}+\mathbf{Z}_{2}
\end{aligned}
$$

[^36]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0081.jpg?height=368&width=391&top_left_y=206&top_left_x=1177)

Figure 1.96. Generalized voltage divider: a pair of arbitrary impedances.

$$
\mathbf{V}_{\mathrm{out}}=\mathbf{I} \mathbf{Z}_{2}=\mathbf{V}_{\mathrm{in}} \frac{\mathbf{Z}_{2}}{\mathbf{Z}_{1}+\mathbf{Z}_{2}}
$$

Rather than worrying about this result in general, let's look at some simple (but very important) examples, beginning with the $R C$ highpass and lowpass filters we approximated earlier.

### 1.7.8 RC highpass filters

We've seen that by combining resistors with capacitors it is possible to make frequency-dependent voltage dividers, owing to the frequency dependence of a capacitor's impedance $\mathbf{Z}_{\mathrm{C}}=-j / \omega C$. Such circuits can have the desirable property of passing signal frequencies of interest while rejecting undesired signal frequencies. In this subsection and the next we revisit the simple lowpass and highpass $R C$ filters, correcting the approximate analysis of $\S 1.7 .1$; though simple, these circuits are important and widely used. Chapter 6 and Appendix E describe filters of greater sophistication.

Referring back to the classic $R C$ highpass filter (Figure 1.92), we see that the complex Ohm's law (or the complex voltage-divider equation) gives

$$
\mathbf{V}_{\text {out }}=\mathbf{V}_{\text {in }} \frac{R}{R-j / \omega C}=\mathbf{V}_{\text {in }} \frac{R(R+j / \omega C)}{R^{2}+\left(1 / \omega^{2} C^{2}\right)}
$$

(For the last step, multiply top and bottom by the complex conjugate of the denominator.) Most often we don't care about the phase of $V_{\text {out }}$, just its amplitude:

$$
\begin{aligned}
V_{\text {out }} & =\left(\mathbf{V}_{\text {out }} \mathbf{V}_{\text {out }}^{*}\right)^{1 / 2} \\
& =\frac{R}{\left[R^{2}+\left(1 / \omega^{2} C^{2}\right)\right]^{1 / 2}} V_{\text {in }}
\end{aligned}
$$

Note the analogy to a resistive divider, where

$$
V_{\text {out }}=\frac{R_{2}}{R_{1}+R_{2}} V_{\text {in }}
$$

Here the impedance of the series $R C$ combination
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0082.jpg?height=266&width=266&top_left_y=219&top_left_x=487)

Figure 1.97. Input impedance of unloaded highpass filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0082.jpg?height=307&width=603&top_left_y=584&top_left_x=321)

Figure 1.98. Impedance of series $R C$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0082.jpg?height=251&width=493&top_left_y=997&top_left_x=371)

Figure 1.99. Frequency response of highpass filter. The corresponding phase shift goes smoothly from $+90^{\circ}$ (at $\omega=0$ ), through $+45^{\circ}$ (at $\omega_{3 \mathrm{~dB}}$ ), to $0^{\circ}$ (at $\omega=\infty$ ), analogous to the lowpass filter's phase shift (Figure 1.104).
(Figure 1.97) is as shown in Figure 1.98. So the "response" of this circuit, ignoring phase shifts by taking magnitudes of the complex amplitudes, is given by

$$
\begin{align*}
V_{\text {out }} & =\frac{R}{\left[R^{2}+\left(1 / \omega^{2} C^{2}\right)\right]^{1 / 2}} V_{\mathrm{in}} \\
& =\frac{2 \pi f R C}{\left[1+(2 \pi f R C)^{2}\right]^{1 / 2}} V_{\mathrm{in}} \tag{1.35}
\end{align*}
$$

and looks as shown in Figure 1.99 (and earlier in Figure 1.91).

Note that we could have gotten this result immediately by taking the ratio of the magnitudes of impedances, as in Exercise 1.26 and the example immediately preceding it; the numerator is the magnitude of the impedance of the lower leg of the divider $(R)$, and the denominator is the magnitude of the impedance of the series combination of $R$ and $C$.

As we noted earlier, the output is approximately equal to the input at high frequencies (how high? $\omega \gtrsim 1 / R C$ ) and goes to zero at low frequencies. The highpass filter is
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0082.jpg?height=1376&width=809&top_left_y=207&top_left_x=1065)

Figure 1.100. A: Reactance of inductors and capacitors versus frequency; all decades are identical, except for scale. B: A single decade from part A expanded, with standard $20 \%$ component values (EIA "E6") shown.
very common; for instance, the input to the oscilloscope can be switched to "ac coupling." That's just an $R C$ highpass filter with the bend at about 10 Hz (you would use ac coupling if you wanted to look at a small signal riding on a large dc voltage). Engineers like to refer to the -3 dB "breakpoint" of a filter (or of any circuit that behaves like a filter). In the case of the simple $R C$ high-pass filter, the -3 dB breakpoint is given by

$$
f_{3 \mathrm{~dB}}=1 / 2 \pi R C
$$

You often need to know the impedance of a capacitor at a given frequency (e.g., for the design of filters).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0083.jpg?height=206&width=231&top_left_y=221&top_left_x=405)

Figure 1.101. Highpass filter example.
Figure 1.100 provides a very useful graph covering large ranges of capacitance and frequency, giving the value of $|\mathbf{Z}|=1 / 2 \pi f C$.

As an example, consider the filter shown in Figure 1.101. It is a highpass filter with the 3 dB point ${ }^{44}$ at 15.9 kHz . The impedance of a load driven by it should be much larger than 1.0 k in order to prevent circuit loading effects on the filter's output, and the driving source should be able to drive a 1.0 k load without significant attenuation (loss of signal amplitude) in order to prevent circuit loading effects by the filter on the signal source (recall §1.7.1D for worst-case source and load impedances of $R C$ filters).

### 1.7.9 RC lowpass filters

Revisiting the lowpass filter, in which you get the opposite frequency behavior by interchanging $R$ and $C$ (Figure 1.90, repeated here as Figure 1.102), we find the accurate result

$$
\begin{equation*}
V_{\mathrm{out}}=\frac{1}{\left(1+\omega^{2} R^{2} C^{2}\right)^{1 / 2}} V_{\mathrm{in}} \tag{1.36}
\end{equation*}
$$

as seen in Figure 1.103 (and earlier in Figure 1.91). The 3 dB point is again at a frequency ${ }^{45} f=1 / 2 \pi R C$. Lowpass filters are quite handy in real life. For instance, a lowpass filter can be used to eliminate interference from nearby radio and television stations $(0.5-800 \mathrm{MHz})$, a problem that plagues audio amplifiers and other sensitive electronic equipment.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0083.jpg?height=195&width=314&top_left_y=1686&top_left_x=366)

Figure 1.102. Lowpass filter.

Exercise 1.30. Show that the preceding expression for the response of an $R C$ lowpass filter is correct.

44 One often omits the minus sign when referring to the -3 dB point.
${ }^{45}$ As mentioned in $\S 1.7 .1 \mathrm{~A}$, we often like to define the breakpoint frequency $\omega_{0}=1 / R C$, and work with frequency ratios $\omega / \omega_{0}$. Then a useful form for the denominator in eq'n 1.36 is $\sqrt{1+\left(\omega / \omega_{0}\right)^{2}}$. The same applies to eq'n 1.35 , where the numerator becomes $\omega / \omega_{0}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0083.jpg?height=256&width=552&top_left_y=211&top_left_x=1099)

Figure 1.103. Frequency response of lowpass filter.

The lowpass filter's output can be viewed as a signal source in its own right. When driven by a perfect ac voltage (zero source impedance), the filter's output looks like $R$ at low frequencies (the perfect signal source can be replaced with a short, i.e., by its small-signal source impedance, for the purpose of impedance calculations). It drops to zero impedance at high frequencies, where the capacitor dominates the output impedance. The signal driving the filter sees a load of $R$ plus the load resistance at low frequencies, dropping to just $R$ at high frequencies. As we remarked in §1.7.1D, the worst-case source impedance and the worstcase load impedance of an $R C$ filter (lowpass or highpass) are both equal to $R$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0083.jpg?height=485&width=595&top_left_y=1181&top_left_x=1116)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0083.jpg?height=463&width=693&top_left_y=1656&top_left_x=1026)

Figure 1.104. Frequency response (phase and amplitude) of lowpass filter plotted on logarithmic axes. Note that the phase shift is $-45^{\circ}$ at the -3 dB point and is within $6^{\circ}$ of its asymptotic value for a decade of frequency change.

In Figure 1.104, we've plotted the same lowpass filter response with logarithmic axes, which is a more common way that it's done. You can think of the vertical axis as decibels, and the horizontal axis as octaves (or decades). On such a plot, equal distances correspond to equal ratios. We've also plotted the phase shift, using a linear vertical axis (degrees) and the same logarithmic frequency axis. This sort of plot is good for seeing the detailed response even when it is greatly attenuated (as at right); we'll see a number of such plots in Chapter 6, when we treat active filters. Note that the filter curve plotted here becomes a straight line at large attenuations, with a slope of $-20 \mathrm{~dB} /$ decade (engineers prefer to say " $-6 \mathrm{~dB} /$ octave"). Note also that the phase shift goes smoothly from $0^{\circ}$ (at frequencies well below the breakpoint) to $-90^{\circ}$ (well above it), with a value of $-45^{\circ}$ at the -3 dB point. A rule of thumb for single-section $R C$ filters is that the phase shift is $\approx 6^{\circ}$ from its asymptotic value at $0.1 f_{3 \mathrm{~dB}}$ and at $10 f_{3 \mathrm{~dB}}$.

Exercise 1.31. Prove the last assertion.
An interesting question is the following: is it possible to make a filter with some arbitrary specified amplitude response and some other arbitrary specified phase response? Surprisingly, the answer is no: the demands of causality (i.e., that response must follow cause, not precede it) force a relationship between phase and amplitude response of realizable analog filters (known officially as the KramersKronig relation).

### 1.7.10 RC differentiators and integrators in the frequency domain

The $R C$ differentiator that we saw in $\S 1.4 .3$ is exactly the same circuit as the highpass filter in this section. In fact, it can be considered as either, depending on whether you're thinking of waveforms in the time domain or response in the frequency domain. We can restate the earlier timedomain condition for its proper operation ( $\left.d V_{\text {out }} \ll d V_{\text {in }}\right)$ in terms of the frequency response: for the output to be small compared with the input, the signal frequency (or frequencies) must be well below the 3 dB point. This is easy to check: suppose we have the input signal $V_{\text {in }}=\sin \omega t$. Then, using the equation we obtained earlier for the differentiator output, we have

$$
V_{\mathrm{out}}=R C \frac{d}{d t} \sin \omega t=\omega R C \cos \omega t
$$

and so $d V_{\text {out }} \ll d V_{\text {in }}$ if $\omega R C \ll 1$, i.e., $R C \ll 1 / \omega$. If the input signal contains a range of frequencies, this must hold for the highest frequencies present in the input.

The $R C$ integrator (§1.4.4) is the same circuit as the lowpass filter; by similar reasoning, the criterion for a good integrator is that the lowest signal frequencies must be well above the 3 dB point.

### 1.7.11 Inductors versus capacitors

Instead of capacitors, inductors can be combined with resistors to make lowpass (or highpass) filters. In practice, however, you rarely see RL lowpass or highpass filters. The reason is that inductors tend to be more bulky and expensive and perform less well (i.e., they depart further from the ideal) than capacitors (see Chapter $1 x$ ). If you have a choice, use a capacitor. One important exception to this general statement is the use of ferrite beads and chokes in high-frequency circuits. You just string a few beads here and there in the circuit; they make the wire interconnections slightly inductive, raising the impedance at very high frequencies and preventing oscillations, without the added series resistance you would get with an $R C$ filter. An $R F$ choke is an inductor, usually a few turns of wire wound on a ferrite core, used for the same purpose in RF circuits. Note, however, that inductors are essential components in (a) $L C$ tuned circuits (\$1.7.14), and (b) switch-mode power converters (§9.6.4).

### 1.7.12 Phasor diagrams

There's a nice graphical method that can be helpful when we are trying to understand reactive circuits. Let's take an example, namely, the fact that an $R C$ filter attenuates 3 dB at a frequency $f=1 / 2 \pi R C$, which we derived in $\S 1.7 .8$. This is true for both highpass and lowpass filters. It is easy to get a bit confused here, because at that frequency the reactance of the capacitor equals the resistance of the resistor; so you might at first expect 6 dB attenuation (a factor of $1 / 2$ in voltage). That is what you would get, for example, if you were to replace the capacitor with a resistor of the same impedance magnitude. The confusion arises because the capacitor is reactive, but the matter is clarified by a phasor diagram (Figure 1.105). The axes are the real (resistive) and imaginary (reactive) components of the impedance. In a series circuit like this, the axes also represent the (complex) voltage, because the current is the same everywhere. So for this circuit (think of it as an $R C$ voltage divider) the input voltage (applied across the series $R C$ pair) is proportional to the length of the hypotenuse, and the output voltage (across $R$ only) is proportional to the length of the $R$ leg of the triangle. The diagram represents the situation at the frequency where the capacitor's reactance equals $R$,
i.e., $f=1 / 2 \pi R C$, and shows that the ratio of output voltage to input voltage is $1 / \sqrt{2}$, i.e., -3 dB .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0085.jpg?height=220&width=264&top_left_y=349&top_left_x=184)
$R C$ filter at -3 dB point
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0085.jpg?height=231&width=346&top_left_y=341&top_left_x=531)
resistive divider:
$R_{1}=R_{2}=R \quad(-6 \mathrm{~dB})$
B.

Figure 1.105. Phasor diagram for lowpass filter at 3 dB point.

The angle between the vectors gives the phase shift from input to output. At the 3 dB point, for instance, the output amplitude equals the input amplitude divided by the square root of 2 , and it leads by $45^{\circ}$ in phase. This graphical method makes it easy to read off amplitude and phase relationships in $R L C$ circuits. You can use it, for example, to get the response of the highpass filter that we previously derived algebraically.

Exercise 1.32. Use a phasor diagram to derive the response of an $R C$ high-pass filter: $V_{\text {out }}=V_{\text {in }} R / \sqrt{R^{2}+\left(1 / \omega^{2} C^{2}\right)}$.

Exercise 1.33. At what frequency does an $R C$ lowpass filter attenuate by 6 dB (output voltage equal to half the input voltage)? What is the phase shift at that frequency?

Exercise 1.34. Use a phasor diagram to obtain the lowpass filter response previously derived algebraically.

In the next chapter (§2.2.8) we'll see a nice example of phasor diagrams in connection with a constant-amplitude phase-shifting circuit.

### 1.7.13 "Poles" and decibels per octave

Look again at the response of the $R C$ lowpass filter (Figures 1.103 and 1.104). Far to the right of the "knee" the output amplitude is dropping proportional to $1 / f$. In one octave (as in music, one octave is twice the frequency) the output amplitude will drop to half, or -6 dB ; so a simple $R C$ filter has a $6 \mathrm{~dB} /$ octave falloff. You can make filters with several $R C$ sections; then you get 12 dB /octave (two $R C$ sections), $18 \mathrm{~dB} /$ octave (three sections), and so on. This is the usual way of describing how a filter behaves beyond the cutoff. Another popular way is to say a "three-pole filter," for instance, meaning a filter with three $R C$ sections (or one that behaves like one). (The word "pole" derives from a method of analysis that is beyond the scope of this book and that involves complex
transfer functions in the complex frequency plane, known by engineers as the " $s$-plane." This is discussed in the advanced volume, in Chapter $1 x$.)

A caution on multistage filters: you can't simply cascade several identical filter sections in order to get a frequency response that is the concatenation of the individual responses. The reason is that each stage will load the previous one significantly (since they're identical), changing the overall response. Remember that the response function we derived for the simple $R C$ filters was based on a zero-impedance driving source and an infinite-impedance load. One solution is to make each successive filter section have much higher impedance than the preceding one. A better solution involves active circuits like transistor or operational amplifier (op-amp) interstage "buffers," or active filters. These subjects will be treated in Chapters 2-4, 6 , and 13 .

### 1.7.14 Resonant circuits

When capacitors are combined with inductors or are used in special circuits called active filters, it is possible to make circuits that have very sharp frequency characteristics (e.g., a large peak in the response at a particular frequency), compared with the gradual characteristics of the $R C$ filters we've seen so far. These circuits find applications in various audio and RF devices. Let's now take a quick look at $L C$ circuits (there will be more on them, and active filters, in Chapter 6 and in Appendix E).

#### A. Parallel and series LC circuits

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0085.jpg?height=289&width=381&top_left_y=1529&top_left_x=1182)

Figure 1.106. $L C$ resonant circuit: bandpass filter.

First, consider the circuit shown in Figure 1.106. The impedance of the $L C$ combination at frequency $f$ is just

$$
\begin{aligned}
\frac{1}{\mathbf{Z}_{\mathrm{LC}}} & =\frac{1}{\mathbf{Z}_{\mathrm{L}}}+\frac{1}{\mathbf{Z}_{\mathrm{C}}}=\frac{1}{j \omega L}-\frac{\omega C}{j} \\
& =j\left(\omega C-\frac{1}{\omega L}\right)
\end{aligned}
$$

i.e.,

$$
\mathbf{Z}_{\mathrm{LC}}=\frac{j}{(1 / \omega L)-\omega C}
$$

In combination with $R$ it forms a voltage divider. Because of the opposite behaviors of inductors and capacitors, the impedance of the parallel $L C$ goes to infinity at the resonant frequency

$$
\begin{equation*}
f_{0}=1 / 2 \pi \sqrt{L C} \tag{1.37}
\end{equation*}
$$

(i.e., $\omega_{0}=1 / \sqrt{L C}$ ), giving a peak in the response there. The overall response is as shown in Figure 1.107.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0086.jpg?height=513&width=802&top_left_y=570&top_left_x=219)

Figure 1.107. Frequency response of parallel $L C$ "tank" circuit. The inset shows the time-domain behavior: a damped oscillation ("ringing") waveform following an input voltage step or pulse.

In practice, losses in the inductor and capacitor limit the sharpness of the peak, but with good design these losses can be made very small. Conversely, a $Q$-spoiling resistor is sometimes added intentionally to reduce the sharpness of the resonant peak. This circuit is known simply as a parallel $L C$ resonant circuit (or "tuned circuit," or "tank") and is used extensively in RF circuits to select a particular frequency for amplification (the $L$ or $C$ can be variable, so you can tune the resonant frequency). The higher the driving impedance, the sharper the peak; it is not uncommon to drive them with something approaching a current source, as you will see later. The quality factor $Q$ is a measure of the sharpness of the peak. It equals the resonant frequency divided by the width at the -3 dB points. For a parallel $R L C$ circuit, $Q=\omega_{0} R C,{ }^{46}$

Another variety of $L C$ circuit is the series $L C$ (Figure 1.108). By writing down the impedance formulas involved, and assuming that both the capacitor and inductor are ideal, i.e., that they have no resistive losses, ${ }^{47}$ you can convince yourself that the impedance of the $L C$ goes to zero

[^37]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0086.jpg?height=376&width=789&top_left_y=215&top_left_x=1079)

Figure 1.108. $L C$ notch filter ("trap"). The inductive and capacitive reactances behave as shown, but the opposite sign of their complex impedances causes the series impedance to plummet. For ideal components the reactance of the series $L C$ goes completely to zero at resonance; for real-world components the minimum is non-zero, and usually dominated by the inductor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0086.jpg?height=753&width=799&top_left_y=894&top_left_x=1075)

Figure 1.109. Frequency and phase response of the series $L C$ trap. The phase changes abruptly at resonance, an effect seen in other resonator types (see for example Figure 7.36).
at resonance $\left(f_{0}=1 / 2 \pi \sqrt{L C}\right)$. Such a circuit is a "trap" for signals at or near the resonant frequency, shorting them to ground. Again, this circuit finds application mainly in RF circuits. Figure 1.109 shows what the response looks like. The $Q$ of a series $R L C$ circuit is $Q=\omega_{0} L / R .^{48}$ To see the impact of increasing $Q$, look at the accurate plots of tank and notch response in Figure 1.110.

[^38]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0087.jpg?height=573&width=795&top_left_y=216&top_left_x=123)

Figure 1.110. Response of $L C$ tank (dotted curves) and trap (solid curves) for several values of quality factor, $Q$.

Exercise 1.35. Find the response ( $V_{\text {out }} / V_{\text {in }}$ versus frequency) for the series $L C$ trap circuit in Figure 1.108.

These descriptions of $L C$ resonant circuits are phrased in terms of frequency response, i.e., in the frequency domain. In the time domain you're generally interested in a circuit's response to pulses, or steps; there you see the sort of behavior shown in the inset of Figure 1.107, an $L C$ circuit with $Q=20$. The signal voltage falls to $1 / e(37 \%)$ in $Q / \pi$ cycles; the stored energy (proportional to $v^{2}$ ) falls to $1 / e(61 \%$ in amplitude) in $Q / 2 \pi$ cycles. You may prefer to think in radians: the energy falls to $1 / e$ in $Q$ radians, and the voltage falls to $1 / e$ in $2 Q$ radians. $L C$ resonant circuits are not unique in providing highly frequency-selective circuit behavior; alternatives include quartz-crystal, ceramic, and surface acoustic-wave (SAW) resonators; transmission lines; and resonant cavities.

### 1.7.15 LC filters

By combining inductors with capacitors you can produce filters (lowpass, highpass, bandpass) with far sharper behavior in frequency response than you can with a filter made from a simple $R C$, or from any number of cascaded $R C$ sections. We'll see more of this, and the related topic of active filters, in Chapter 6. But it's worth admiring now how well this works, to appreciate the virtue of the humble inductor (an often-maligned circuit component).

As an example, look at Figure 1.111, a photograph of a "mixer-digitizer" circuit board that we built for a project some years back (specifically, a radio receiver with 250 million simultaneous channels). There's lots of stuff on the board, which has to frequency-shift and digitize three
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0087.jpg?height=593&width=832&top_left_y=206&top_left_x=959)

Figure 1.111. There are six $L C$ lowpass filters on this circuit board, part of the process of frequency conversion and digitizing for which this "mixer-digitizer" was designed.

RF bands; its design could occupy a book chapter. For now just gaze at the lumpy filter in the oval (there are five more on the board), comprising three inductors (the square metal cans) and four capacitors (the pairs of shiny oblongs). It's a lowpass filter, designed to cut off at 1.0 MHz ; it prevents 'aliases" in the digitized output, a subject we'll visit in Chapter 13.

How well does it work? Figure 1.112 shows a "frequency sweep," in which a sinewave input goes from 0 Hz to 2 MHz as the trace goes from left to right across the screen. The sausage shapes are the "envelope" of the sinewave output, here comparing the $L C$ filter with an $R C$ lowpass filter with the same 1 MHz cutoff $(1 \mathrm{k} \Omega$ and 160 pF ). The $L C$ wins, hands down. The $R C$ is pathetic by comparison. It's not even good English to call 1 MHz its "cutoff": it hardly cuts anything off.

### 1.7.16 Other capacitor applications

In addition to their uses in filters, resonant circuits, differentiators, and integrators, capacitors are needed for several other important applications. We treat these in detail later in the book, mentioning them here only as a preview.

#### A. Bypassing

The impedance of a capacitor decreases with increasing frequency. This is the basis of another important application: bypassing. There are places in circuits where you want to allow a dc voltage, but you don't want signals present. Placing a capacitor across that circuit element (usually a resistor) will help to kill any signals there. You choose the (noncritical) capacitor value so that its
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0088.jpg?height=537&width=795&top_left_y=221&top_left_x=225)

Figure 1.112. Frequency sweep of the $L C$ lowpass filter shown in Figure 1.111 compared with an $R C$ lowpass filter with the same 1 MHz cutoff frequency. The dark outline is the amplitude envelope of the fast swept sinewave, which achieves a sandpaper appearance in this digital 'scope capture.
impedance at signal frequencies is small compared with what it is bypassing. You will see much more of this in later chapters.

#### B. Power-supply filtering

We saw this application in $\S 1.6 .3$, to filter the ripple from rectifier circuits. Although circuit designers often call them filter capacitors, this is really a form of bypassing, or energy storage, with large-value capacitors; we prefer the term storage capacitor. And these capacitors really are large - they're the big shiny round things you see inside most electronic instruments. We'll get into dc powersupply design in detail in Chapter 9.

#### C. Timing and waveform generation

As we've seen, a capacitor supplied with a constant current charges up with a ramp waveform. This is the basis of ramp and sawtooth generators, used in analog function generators, oscilloscope sweep circuits, analog-digital converters, and timing circuits. $R C$ circuits are also used for timing, and they form the basis of delay circuits (monostable multivibrators). These timing and waveform applications are important in many areas of electronics and will be covered in Chapters 3, 6, 10, and 11.

### 1.7.17 Thévenin's theorem generalized

When capacitors and inductors are included, Thévenin's theorem must be restated: any two-terminal network of resistors, capacitors, inductors, and signal sources is equivalent to a single complex impedance in series with a single signal source. As before, you find the (complex) impedance
and the signal source (waveform, amplitude, and phase) from the open-circuit output voltage and the short-circuit output current.

## 1.8 Putting it all together - an AM radio

In our circuit course we tie together the topics of this chapter by hooking up a simple AM radio. The signal that's transmitted is a sinewave at the station's frequency in the AM band $(520-1720 \mathrm{kHz})$, with its amplitude varied ("modulated") according to the audio waveform (Figure 1.113). In other words, an audio waveform described by some function $f(t)$ would be transmitted as a RF signal $[A+f(t)] \sin 2 \pi f_{\mathrm{c}}$; here $f_{\mathrm{c}}$ is the station's "carrier" frequency, and the constant $A$ is added to the audio waveform so that the coefficient $[A+f(t)]$ is never negative.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0088.jpg?height=356&width=517&top_left_y=911&top_left_x=1216)

Figure 1.113. An AM signal consists of an RF carrier ( $\sim 1 \mathrm{MHz}$ ) whose amplitude is varied by the audio-frequency signal (speech or music; audible frequencies up to $\sim 5 \mathrm{kHz}$ ). The audio waveform is dc offset so that the envelope does not cross zero.

At the receiver end (that's $u s!$ ) the task is to select this station (among many) and somehow extract the modulating envelope, which is the desired audio signal. Figure 1.114 shows the simplest AM radio; it is the "crystal set" of yesteryear. It's really quite straightforward: the parallel $L C$ resonant circuit is tuned to the station's frequency by the variable capacitor $C_{1}$ (§1.7.14); the diode $D$ is a half-wave rectifier (§1.6.2), which (if ideal) would pass only the positive half-cycles of the modulated carrier; and $R_{1}$ provides a light load, so that the rectified output follows the halfcycles back down to zero. We're almost done. We add small capacitor $C_{2}$ to prevent the output from following the fast half-cycles of carrier (it's a storage capacitor, §1.7.16B), choosing the time constant $R_{1} C_{2}$ to be long compared with a carrier period $(\sim 1 \mu \mathrm{~s})$, but short compared with the period of the highest audio frequency ( $\sim 200 \mu \mathrm{~s}$ ).

Figures 1.115 and 1.116 show what you see when you probe around with a 'scope. The bare antenna shows plenty of low-frequency pickup (mostly 60 Hz ac powerline), and a tiny bit of signal from all the AM stations at once. But
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0089.jpg?height=478&width=773&top_left_y=220&top_left_x=139)

Figure 1.114. The simplest AM receiver. Variable capacitor $C_{1}$ tunes the desired station, diode $D$ picks off the positive envelope (smoothed by $R_{1} C_{2}$ ), and the resulting weak audio signal is amplified to drive the loudspeaker, loudly.
when you connect it to the $L C$ resonant circuit, all the lowfrequency stuff disappears (because the $L C$ looks like a very low impedance, Figure 1.107) and it sees only the selected AM station. What's interesting here is that the amplitude of the selected station is much larger with the $L C$ attached than with nothing connected to the antenna: that's because the resonant circuit's high $Q$ is storing energy from multiple cycles of the signal. ${ }^{49}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0089.jpg?height=468&width=799&top_left_y=1271&top_left_x=121)

Figure 1.115. Observed waveforms at point " $X$ " from the bare antenna (top) and with the $L C$ connected. Note that the low-frequency junk disappears and that the radio signal gets larger. These are single-shot traces, in which the $\sim 1 \mathrm{MHz}$ radiofrequency carrier appears as a solid filled area. Vertical: $1 \mathrm{~V} / \mathrm{div}$; horizontal: $4 \mathrm{~ms} / \mathrm{div}$.

The audio amplifier is fun, too, but we're not ready for it. We'll see how to make one of those in Chapter 2 (with discrete transistors), and again in Chapter 4 (with operational amplifiers, the Lego ${ }^{\text {TM }}$ block of analog design).

[^39]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0089.jpg?height=473&width=804&top_left_y=220&top_left_x=973)

Figure 1.116. Observed waveforms at point " $Y$ " with $R_{1}$ only (top) and with smoothing capacitor $C_{2}$ included (bottom). The upper pair is a single-shot capture (with the $\sim 1 \mathrm{MHz}$ carrier appearing as solid black), and the lower pair is a separate single-shot capture, in which we have offset the rectified wave for clarity. Vertical: $1 \mathrm{~V} / \mathrm{div}$; horizontal: $1 \mathrm{~ms} / \mathrm{div}$.

And one amusing final note: in our class, we like to show the effect of probing point " X " with a length of BNC (bayonet Neill-Concelman) cable going to a 'scope input (that's how we start out, in the first week). When we do that, the cable's capacitance (about $30 \mathrm{pF} / \mathrm{ft}$ ) adds to $C_{1}$, lowering the resonant frequency and so tuning to a different station. If we choose right, it changes languages (from English to Spanish)! The students howl with laughter - a language-translating electronic component. Then we use an ordinary 'scope probe, with its $\sim 10 \mathrm{pF}$ of capacitance: no change of station, nor of language.

## 1.9 Other passive components

In the following subsections we would like to introduce briefly an assortment of miscellaneous but essential components. If you are experienced in electronic construction, you may wish to proceed to the next chapter.

### 1.9.1 Electromechanical devices: switches

These mundane but important devices seem to wind up in most electronic equipment. It is worth spending a few paragraphs on the subject (and there's more in Chapter 1x). Figures 1.117 and 1.118 show some common switch types.

#### A. Toggle switches

The simple toggle switch is available in various configurations, depending on the number of poles; Figure 1.119 shows the usual ones (SPST indicates a single-pole singlethrow switch, SPDT indicates a single-pole double-throw
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0090.jpg?height=858&width=1363&top_left_y=209&top_left_x=362)

Figure 1.117. Switch Smorgasbord. The nine switches at right are momentary-contact ("pushbutton") switches, including both panelmounting and PCB-mounting types (PCB, printed-circuit board). To their left are additional types, including lever-actuated and multipole styles. Above them are a pair of panel-mounting binary-coded thumbwheel switches, to the left of which is a matrix-encoded hexadecimal keypad. The switches at center foreground are toggle switches, in both panel-mounting and PCB-mounting varieties; several actuator styles are shown, including a locking variety (fourth from front) that must be pulled before it will switch. The rotary switches in the left column illustrate binary-coded types (the three in front and the larger square one), and the traditional multipole-multiposition configurable wafer switches.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0090.jpg?height=649&width=1248&top_left_y=1377&top_left_x=422)

Figure 1.118. Board-mounted "DIP switches." Left group, front to back and left to right (all are SPST): single station side-action toggle; three-station side-action, two-station rocker, and single-station slide; eight-station slide (low-profile) and six-station rocker; eight-station slide and rocker. Middle group (all are hexadecimal coded): six-pin low-profile, six-pin with top or side adjust; 16-pin with true and complement coding. Right group: $2 \mathrm{~mm} \times 2 \mathrm{~mm}$ surface-mount header block with movable jumper ("shunt"), $0.1^{\prime \prime} \times 0.1^{\prime \prime}$ ( $2.54 \mathrm{~mm} \times 2.54 \mathrm{~mm}$ ) through-hole header block with shunts; 18-pin SPDT (common actuator); eight-pin dual SPDT slide and rocker; 16-pin quad SPDT slide (two examples).
switch, and DPDT indicates a double-pole double-throw switch). Toggle switches are also available with "center OFF" positions and with up to four poles switched simultaneously. Toggle switches are always "break before make," e.g., the moving contact never connects to both terminals in an SPDT switch.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0091.jpg?height=292&width=708&top_left_y=479&top_left_x=169)

Figure 1.119. Fundamental switch types.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0091.jpg?height=187&width=626&top_left_y=881&top_left_x=213)

Figure 1.120. Momentary-contact (pushbutton) switches.

#### B. Pushbutton switches

Pushbutton switches are useful for momentary-contact applications; they are drawn schematically as shown in Figure 1.120 (NO and NC mean normally open and normally closed). For SPDT momentary-contact switches, the terminals must be labeled NO and NC, whereas for SPST types the symbol is self-explanatory. Momentary-contact switches are always "break before make." In the electrical (as opposed to electronic) industry, the terms form A, form B , and form C are used to mean SPST (NO), SPST (NC), and SPDT, respectively.

#### C. Rotary switches

Rotary switches are available with many poles and many positions, often as kits with individual wafers and shaft hardware. Both shorting (make-before-break) and nonshorting (break-before-make) types are available, and they can be mixed on the same switch. In many applications the shorting type is useful to prevent an open circuit between switch positions, because circuits can go amok with unconnected inputs. Nonshorting types are necessary if the separate lines being switched to one common line must not ever be connected to each other.

Sometimes you don't really want all those poles, you just want to know how many clicks (detents) the shaft has been turned. For that a common form of rotary switch en-
codes its position as a 4-bit binary quantity, thereby saving lots of wires (only five are needed: the four bits, and a common line). An alternative is the use of a rotary encoder, an electromechanical panel-mounting device that creates a sequence of $N$ pulse pairs for each full rotation of the knob. These come in two flavors (internally using either mechanical contacts or electro-optical methods), and typically provide from 16 to 200 pulse pairs per revolution. The optical varieties cost more, but they last forever.

#### D. PC-mounting switches

It's common to see little arrays of switches on printedcircuit (PC) boards, like the ones shown in Figure 1.118. They're often called DIP switches, referring to the integrated circuit dual in-line package that they borrow, though contemporary practice increasingly uses the more compact surface-mount technology (SMT) package. As the photograph illustrates, you can get coded rotary switches; and because these are used for set-and-forget internal settings, you can substitute a multipin header block, with little slideon "shunts" to make the connections.

#### E. Other switch types

In addition to these basic switch types, there are available various exotic switches such as Hall-effect switches, reed switches, proximity switches, etc. All switches carry maximum current and voltage ratings; a small toggle switch might be rated at 150 volts and 5 amps . Operation with inductive loads drastically reduces switch life because of arcing during turn-off. It's always OK to operate a switch below its maximum ratings, with one notable exception: since many switches rely on substantial current flow to clean away contact oxides, it's important to use a switch that is designed for "dry switching" when switching lowlevel signals, ${ }^{50}$ otherwise you'll get noisy and intermittent operation (see Chapter 1x).

#### F. Switch examples

As an example of what can be done with simple switches, let's consider the following problem: suppose you want to sound a warning buzzer if the driver of a car is seated and one of the car doors is open. Both doors and the driver's seat have switches, all normally open. Figure 1.121 shows a circuit that does what you want. If one or the other door is open (switch closed) AND the seat switch is closed, the buzzer sounds. The words OR and AND are used in a logic sense here, and we will see this example again in

[^40]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0092.jpg?height=453&width=302&top_left_y=220&top_left_x=471)

Figure 1.121. Switch circuit example: open door warning.
Chapters 2, 3, and 10 when we talk about transistors and digital logic.

Figure 1.122 shows a classic switch circuit used to turn a ceiling lamp on or off from a switch at either of two entrances to a room.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0092.jpg?height=386&width=509&top_left_y=996&top_left_x=363)

Figure 1.122. Electrician's "three-way" switch wiring.

Exercise 1.36. Although few electronic circuit designers know how, every electrician can wire up a light fixture so that any of $N$ switches can turn it on or off. See if you can figure out this generalization of Figure 1.122. It requires two SPDT switches and $N-2$ DPDT switches.

### 1.9.2 Electromechanical devices: relays

Relays are electrically controlled switches. In the traditional electromechanical relay, a coil pulls in an armature (to close the contacts) when sufficient coil current flows. Many varieties are available, including "latching" and "stepping" relays. ${ }^{51}$ Relays are available with dc or ac

[^41]excitation, and coil voltages from 3 volts up to 115 volts (ac or dc) are common. "Mercury-wetted" and "reed" relays are intended for high-speed ( $\sim 1 \mathrm{~ms}$ ) applications, and giant relays intended to switch thousands of amps are used by power companies.

The solid-state relay (SSR) - consisting of a semiconductor electronic switch that is turned on by a LED - provides better performance and reliability than mechanical relays, though at greater cost. SSRs operate rapidly, without contact "bounce," and usually provide for smart switching of ac power (they turn on at the moment of zero voltage, and they turn off at the moment of zero current). Much more on these useful devices in Chapter 12.

As we'll learn, electrically controlled switching of signals within a circuit can be accomplished with transistor switches, without having to use relays of any sort (Chapters 2 and 3 ). The primary uses of relays are in remote switching and high-voltage (or high-current) switching, where it is important to have complete electrical isolation between the control signal and the circuit being switched.

### 1.9.3 Connectors

Bringing signals in and out of an instrument, routing signal and dc power around between the various parts of an instrument, providing flexibility by permitting circuit boards and larger modules of the instrument to be unplugged (and replaced) - these are the functions of the connector, an essential ingredient (and usually the most unreliable part) of any piece of electronic equipment. Connectors come in a bewildering variety of sizes and shapes. ${ }^{52}$ Figures 1.123 , 1.124 , and 1.125 give some idea of the variety.

#### A. Single-wire connectors

The simplest kind of connector is the simple pin jack or banana jack used on multimeters, power supplies, etc. It is handy and inexpensive, but not as useful as the shieldedcable or multiwire connectors you often need. The humble binding post is another form of single-wire connector, notable for the clumsiness it inspires in those who try to use it.

#### B. Shielded-cable connectors

To prevent capacitive pickup, and for other reasons we'll go into in Appendix H, it is usually desirable to pipe signals around from one instrument to another in shielded coaxial cable. The most popular connector is the BNC type that

[^42]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0093.jpg?height=853&width=1514&top_left_y=206&top_left_x=192)

Figure 1.123. Rectangular connectors. The variety of available multipin connectors is staggering. Here is a collection of common specimens: the five connectors at lower left are multipin nylon power connectors (sometimes called Molex-type for historical reasons). Above them are four dual-row box headers ( $0.1^{\prime \prime}$ spacing, shown with and without latch ejectors, and also with Wire-Wrap ${ }^{\circledR}$ and right-angle tails), and to their right an open ("unshrouded") $0.1^{\prime \prime}$ dual-row header, along with a pair of dual-row headers of finer pitch ( 2 mm and 1.27 mm ). These dual-row male connectors mate with insulation displacement connectors (IDC) such as the one shown attached to a short length of ribbon cable (just above the unshrouded header). Just below the ribbon are shown single-row $0.1^{\prime \prime}$ headers, with mating shells (AMP MODU) that accept individual wire leads. At bottom right are several terminal blocks used for power wiring, and four "Faston"type crimpable spade lugs. Above them are USB connectors, and to their left are the common RJ-45 and RJ-11 modular telephone/data connectors. The popular and reliable D-subminiature connectors are at center, including (right to left) a pair of 50-pin micro-D (cable plug, PCB socket), the 9-pin D-sub, 26-pin high-density, and a pair of 25 -pin D-subs (one IDC). Above them are (right to left) a 96 -pin VME backplane connector, a 62-pin card-edge connector with solder tails, a "Centronics-type" connector with latching bail, and a card-edge connector with ribbon IDC. At top left is a miscellany - a mating pair of "GR-type" dual banana connectors, a mating pair of Cinch-type connectors, a mating pair of shrouded Winchester-type connectors with locking jackscrews, and (to their right) a screw-terminal barrier block. Not shown here are the really tiny connectors used in small portable electronics (smartphones, cameras, etc); you can see a fine example in Figure 1.131.
adorns most instrument front panels. It connects with a quarter-turn twist and completes both the shield (ground) circuit and inner conductor (signal) circuit simultaneously. Like all connectors used to mate a cable to an instrument, it comes in both panel-mounting and cable-terminating varieties.

Among the other connectors for use with coaxial cable are the TNC ("threaded Neill-Concelman," a close cousin of the BNC, but with threaded outer shell), the highperformance but bulky type N, the miniature SMA and SMB, the subminiature LEMO and SMC, and the highvoltage MHV and SHV. The so-called phono jack used in audio equipment is a nice lesson in bad design, because the
inner (signal) conductor mates before the shield (ground) when you plug it in; furthermore, the design of the connector is such that both shield and center conductor tend to make poor contact. You've undoubtedly heard the results! Not to be outdone, the television industry has responded with its own bad standard, the type-F coax "connector," which uses the unsupported inner wire of the coax as the pin of the male plug, and a shoddy arrangement to mate the shield. ${ }^{53}$

We hereby induct these losers into the Electronic

[^43]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0094.jpg?height=791&width=1577&top_left_y=209&top_left_x=255)

Figure 1.124. Circular connectors. A selection of multipin and other "non-RF" connectors; the panel-mounting receptacle is shown to the left of each cable-mounted plug. Top row, left to right: "MS"-type (MIL-C-5015) rugged connector (available in hundreds of configurations), high-current ( 50 A ) "Supericon," multipin locking XLR. Middle row: weatherproof (Switchcraft EN3), 12 mm video (Hirose RM), circular DIN, circular mini-DIN, 4-pin microphone connector. Bottom row: locking 6-pin (Lemo), microminiature 7-pin shielded (Microtech EP-7S), miniature 2-pin shrouded (Litton SM), 2.5 mm power, banana, pin jack.

Components Hall of Infamy, some charter members of which are shown in Figure 1.126.

#### C. Multipin connectors

Very frequently electronic instruments demand multiwire cables and connectors. There are literally dozens of different kinds. The simplest example is a three-wire "IEC" powerline cord connector. Among the more popular are the excellent type-D subminiature, the Winchester MRA series, the venerable MS type, and the flat ribbon-cable mass-termination connectors. These and others are shown in Figure 1.123.

Beware of connectors that can't tolerate being dropped on the floor (the miniature hexagon connectors are classic) or that don't provide a secure locking mechanism (e.g., the Jones 300 series).

#### D. Card-edge connectors

The most common method used to make connection to printed-circuit cards is the card-edge connector, which mates to a row of gold-plated contacts at the edge of the card; common examples are the motherboard connectors that accept plug-in computer memory modules. Card-edge connectors may have from 15 to 100 or more connections,
and they come with different lug styles according to the method of connection. You can solder them to a "motherboard" or "backplane," which is itself just another PCB containing the interconnecting wiring between the individual circuit cards. Alternatively, you may want to use edge connectors with standard solder-lug terminations, particularly in a system with only a few cards. A more reliable (though more costly) solution is the use of "two-part" PCB connectors, in which one part (soldered onto the board) mates with the other part (on a backplane, etc); an example is the widely used VME (VersaModule Eurocard) connector (upper right-hand corner of Figure 1.123).

### 1.9.4 Indicators

#### A. Meters

To read out the value of some voltage or current, you have a choice between the time-honored moving-pointer type of meter and digital-readout meters. The latter are more expensive and more accurate. Both types are available in a variety of voltage and current ranges. There are, in addition, exotic panel meters that read out such things as VUs (volume units, an audio dB scale), expanded-scale ac volts (e.g., 105 to 130 V ), temperature (from a thermocouple),
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0095.jpg?height=1055&width=1578&top_left_y=202&top_left_x=160)

Figure 1.125. RF and shielded connectors. The panel-mounting receptacle is shown to the left of each cable-mounted plug. Top row, left to right: stereo phone jack, audio "XLR" type; N and UHF (RF connectors). Second row down: BNC, TNC, type F; MHV and SHV (high voltage). Third row down: 2.5 mm ( $3 / 32^{\prime \prime}$ ) audio, 3.5 mm stereo, improved 3.5 mm stereo, phono ("RCA type"), LEMO coaxial. Bottom row: SMA (panel jack, flexible coax plug), SMA (board-mount jack, rigid coax plug), SMB; SC and ST (optical fiber).
percentage motor load, frequency, etc. Digital panel meters often provide the option of logic-level outputs, in addition to the visible display, for internal use by the instrument.

As a substitute for a dedicated meter (whether analog or digital), you increasingly see an LCD (liquid-crystal display) or LED panel with a meter-like pattern. This is flexible and efficient: with a graphic LCD display module (§12.5.3) you can offer the user a choice of "meters," according to the quantity being displayed, all under the control of an embedded controller (a built-in microprocessor; see Chapter 15).

#### B. Lamps, LEDs, and displays

Flashing lights, screens full of numbers and letters, eerie sounds - these are the stuff of science fiction movies, and except for the last, they form the subject of lamps and displays (see §12.5.3). Small incandescent lamps used to be standard for front-panel indicators, but they have been re-
placed with LEDs. The latter behave electrically like ordinary diodes, but with a forward voltage drop in the range of 1.5 to 2 volts (for red, orange, and some green LEDs; 3.6 V for blue ${ }^{54}$ and high-brightness green; see Figure 2.8). When current flows in the forward direction, they light up. Typically, 2 mA to 10 mA produces adequate brightness. LEDs are cheaper than incandescent lamps, they last pretty much forever, and they come in four standard colors as well as "white" (which is usually a blue LED with a yellow fluorescent coating). They come in convenient panel-mounting packages; some even provide built-in current limiting. ${ }^{55}$

LEDs can also be used for digital displays, for example

[^44]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0096.jpg?height=549&width=827&top_left_y=205&top_left_x=204)

Figure 1.126. Components to avoid. We advise against using components like these, if you have a choice (see text if you need convincing!). Top row, left to right: low-value wirewound pot, type UHF connector, electrical tape ("just say no!"). Middle row: "cinchtype" connectors, microphone connector, hexagon connectors. Bottom row: slide switch, cheap IC socket (not "screw-machined"), type-F connector, open-element trimmer pot, phono connector.
as 7 -segment numeric displays or (for displaying letters as well as numbers - "alphanumeric") 16-segment displays or dot-matrix displays. However, if more than a few digits or characters need to be displayed, LCDs are generally preferred. These come in line-oriented arrays (e.g., 16 characters by 1 line, up to 40 characters by 4 lines), with a simple interface that permits sequential or addressable entry of alphanumeric characters and additional symbols. They are inexpensive, low power, and visible even in sunlight. Back-lighted versions work well even in subdued light, but are not low power. Much more on these (and other) optoelectronic devices in §12.5.

### 1.9.5 Variable components

#### A. Variable resistors

Variable resistors (also called volume controls, potentiometers, pots, or trimmers) are useful as panel controls or internal adjustments in circuits. A classic panel type is the 2-watt-type AB potentiometer; it uses the same basic material as the fixed carbon-composition resistor, with a rotatable "wiper" contact. Other panel types are available with ceramic or plastic resistance elements, with improved characteristics. Multiturn types ( 3,5 , or 10 turns) are available, with counting dials, for improved resolution and linearity. "Ganged" pots (several independent sections on one shaft) are also manufactured, although in limited variety, for applications that demand them. Figure 1.8 shows a representative selection of pots and trimmers.

For use inside an instrument, rather than on the front panel, trimmer pots come in single-turn and multiturn styles, most intended for printed-circuit mounting. These are handy for calibration adjustments of the "set-andforget" type. Good advice: resist the temptation to use lots of trimmers in your circuits. Use good design instead.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0096.jpg?height=121&width=243&top_left_y=516&top_left_x=1353)

Figure 1.127. Potentiometer (three-terminal variable resistor).

The symbol for a variable resistor, or pot, is shown in Figure 1.127. Sometimes the symbols CW and CCW are used to indicate the clockwise and counterclockwise ends.

An all-electronic version of a potentiometer can be made with an array of electronic (transistor) switches that select a tap in a long chain of fixed resistors. As awkward as that may sound, it is a perfectly workable scheme when implemented as an IC. For example, Analog Devices, Maxim/Dallas Semiconductor, and Xicor make a series of "digital potentiometers" with up to 1024 steps; they come as single or dual units, and some of them are "nonvolatile," meaning that they remember their last setting even if power has been turned off. These find application in consumer electronics (televisions, stereos) where you want to adjust the volume from your infrared remote control, rather than by turning a knob; see $\S 3.4 .3 \mathrm{E}$.

One important point about variable resistors: don't attempt to use a potentiometer as a substitute for a precise resistor value somewhere within a circuit. This is tempting, because you can trim the resistance to the value you want. The trouble is that potentiometers are not as stable as good $(1 \%)$ resistors, and in addition they may not have good resolution (i.e., they can't be set to a precise value). If you must have a precise and settable resistor value somewhere, use a combination of a $1 \%$ (or better) precision resistor and a potentiometer, with the fixed resistor contributing most of the resistance. For example, if you need a 23.4 k resistor, use a $22.6 \mathrm{k} 1 \%$ fixed resistor (a standard value) in series with a 2 k trimmer pot. Another possibility is to use a series combination of several precision resistors, selecting the last (and smallest) resistor to give the desired series resistance.

As we'll see later (§3.2.7), it is possible to use FETs as voltage-controlled variable resistors in some applications. Another possibility is an "optophotoresistor" (§12.7). Transistors can be used as variable-gain amplifiers, again controlled by a voltage. Keep an open mind when design brainstorming.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0097.jpg?height=63&width=137&top_left_y=216&top_left_x=452)

Figure 1.128. Variable capacitor.

#### B. Variable capacitors

Variable capacitors are primarily confined to the smaller capacitance values (up to about 1000 pF ) and are commonly used in RF circuits. Trimmers are available for incircuit adjustments, in addition to the panel type for user tuning. Figure 1.128 shows the symbol for a variable capacitor.

Diodes operated with applied reverse voltage can be used as voltage-variable capacitors; in this application they're called varactors, or sometimes varicaps or epicaps. They're very important in RF applications, especially phase-locked loops, automatic frequency control (AFC), modulators, and parametric amplifiers.

#### C. Variable inductors

Variable inductors are usually made by arranging to move a piece of core material in a fixed coil. In this form they're available with inductances ranging from microhenrys to henrys, typically with a $2: 1$ tuning range for any given inductor. Also available are rotary inductors (coreless coils with a rolling contact). ${ }^{56}$

#### D. Variable transformers

Variable transformers are handy devices, especially the ones operated from the 115 volt ac line. They're usually configured as "autotransformers," which means that they have only one winding, with a sliding contact. They're also commonly called Variacs (the name given to them by General Radio), and they are made by Technipower, Superior Electric, and others. Figure 1.129 shows a classic unit from General Radio. Typically they provide 0 to 135 volts ac output when operated from 115 volts, and they come in current ratings from 1 amp to 20 amps or more. They're good for testing instruments that seem to be affected by powerline variations, and in any case to verify worst-case performance. Important Warning: don't forget that the output is not electrically isolated from the powerline, as it would be with a transformer!

[^45]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0097.jpg?height=554&width=825&top_left_y=223&top_left_x=960)

Figure 1.129. A powerline variable transformer ("Variac") lets you adjust the ac input voltage to something you are testing. Here a 5 A unit is shown, both clothed and undressed.

## 1.10 A parting shot: confusing markings and itty-bitty components

In our electronics course, ${ }^{57}$ and indeed in day-to-day electronics on the bench, we encounter a wonderful confusion of component markings. Capacitors in particular are just, well, perverse: they rarely bother specifying units (even though they span 12 orders of magnitude, picofarads to farads), and for ceramic SMT varieties they dispense with any markings whatsoever! Even worse, they are still caught up in the transition from printing the value as an integer (e.g., " 470 " meaning 470 pF ) versus using exponent notation (e.g., " 470 " meaning $47 \times 10^{0}$, i.e., 47 pF ). Figure 1.130 shows exactly that case! Another trap for the unwary (and sometimes the wary, as well) is the date-code gotcha: the 4-digit code (yydd) can masquerade as a part number, as in the four examples in the photo. And, as components become smaller and smaller, there's precious little room for all but the briefest of markings; so, following the pharmaceutical industry, manufacturers invent a short

[^46]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0098.jpg?height=689&width=830&top_left_y=209&top_left_x=207)

Figure 1.130. Confusion Central! The three ICs are each marked with both a part number (e.g., UA7812) and a "date code" (e.g., UC7924, signifying the 24th week of 1979). Unfortunately, both are perfectly valid part numbers (a +12 V or a -24 V regulator). The resistor pair (actually two views of identically marked resistors) suffers from the same problem: it could be $7.32 \mathrm{~K} \Omega \pm 1 \%$, or it could be $85.0 \mathrm{k} \Omega \pm 5 \%$ (it's the former, but who would know?). The pair of ceramic capacitors are both marked 470K (470,000 of something?), but, surprise, the " $K$ " means $10 \%$ tolerance; and, bigger surprise, the square cap is 47 pF , the round one is 470 pF . And what is one to make of a black box labeled 80K000 (pronounced "eighty-koooh"), or a diode with two cathodes (and no anode?), or a resistor with a single black band in the center?
alphanumeric code for each component. And that's all you get. For example, National's LMV981 op-amp comes in several 6-pin packages: the SOT23 is marked "A78A," the smaller SC70 says "A77," and the really tiny microSMD blurts out a single letter "A" (or "H" if it's free of lead). Not much to go on.

### 1.10.1 Surface-mount technology: the joy and the pain

While we're complaining, let's whine just a bit about the difficulty of prototyping circuits with tiny surface-mount components. From an electrical point of view they are excellent: low inductance, and compact. But they are nearly impossible to wire up in prototype breadboard fashion, in the way that was easy with "through-hole" (or "leaded" pronounced lee'-ded) components, such as resistors with axial leads (a wire sticking out each end), or integrated circuits in DIP (dual in-line) cases. Figure 1.131 gives
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0098.jpg?height=615&width=795&top_left_y=218&top_left_x=1077)

Figure 1.131. We're "all thumbs" when working with surfacemount technology (SMT). This is a corner of a cellphone circuit board, showing small ceramic resistors and capacitors, integrated circuits with ball-grid connecting dots on their undersides, and the Lilliputian connectors for the antenna and display panel. See also Figure 4.84.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0098.jpg?height=593&width=809&top_left_y=1140&top_left_x=1065)

Figure 1.132. How small can these things get?! The "01005"-size SMT $\left(0.016^{\prime \prime} \times 0.008^{\prime \prime}\right.$, or $0.4 \mathrm{~mm} \times 0.2 \mathrm{~mm}$ ) represents the industry's greatest insult to the experimenter.
a sense of the scale of these little components, and Figure 1.132 displays the true horror of the tiniest of these the " 01005 "-size chip components ( 0402 metric) that measure $200 \mu \mathrm{~m} \times 400 \mu \mathrm{~m}$ : not much thicker than a human hair, and indistinguishable from dust!

Sometimes you can use little adapter carriers (from companies like Bellin Dynamic Systems, Capital Advanced Technologies, or Aries) to convert an SMT integrated circuit to a fake DIP. But the densest surface-mount
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0099.jpg?height=738&width=1573&top_left_y=210&top_left_x=160)

Figure 1.133. A taste of the world of passive components in surface-mount packages: connectors, switches, trimmer pots, inductors, resistors, capacitors, crystals, fuses.... If you can name it, you can probably get it in SMT.
packages have no leads at all, just an array of bumps (up to several thousand!) on the underside; and these require serious "reflow" equipment before you can do anything with them. Sadly, we cannot ignore this disturbing trend, because the majority of new components are offered only in surface-mount packages. Woe to the lone basement experimenter-inventor! Figure 1.133 give a sense of the variety of passive component types that come in surfacemount configurations.

#### Additional Exercises for Chapter 1

Exercise 1.37. Find the Norton equivalent circuit (a current source in parallel with a resistor) for the voltage divider in Figure 1.134. Show that the Norton equivalent gives the same output voltage as the actual circuit when loaded by a 5 k resistor.

Exercise 1.38. Find the Thévenin equivalent for the circuit shown in Figure 1.135. Is it the same as the Thévenin equivalent for Exercise 1.37?

Exercise 1.39. Design a "rumble filter" for audio. It should pass frequencies greater than 20 Hz (set the -3 dB point at 10 Hz ). Assume zero source impedance (perfect voltage source) and 10k (minimum) load impedance (that's important so that you can choose $R$ and $C$ such that the load doesn't affect the filter operation significantly).

Exercise 1.40. Design a "scratch filter" for audio signals ( 3 dB
down at 10 kHz ). Use the same source and load impedances as in Exercise 1.39.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0099.jpg?height=238&width=473&top_left_y=1243&top_left_x=1136)

Figure 1.134. Example for Norton equivalent circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0099.jpg?height=412&width=239&top_left_y=1610&top_left_x=1253)

Figure 1.135. Example for Thévenin equivalent circuit.

Exercise 1.41. How would you make a filter with $R$ 's and $C$ 's to give the response shown in Figure 1.136?

Exercise 1.42. Design a bandpass $R C$ filter (as in Figure 1.137);
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0100.jpg?height=248&width=539&top_left_y=218&top_left_x=345)

Figure 1.136. High-emphasis filter response.
$f_{1}$ and $f_{2}$ are the 3 dB points. Choose impedances so that the first stage isn't much affected by the loading of the second stage.

Exercise 1.43. Sketch the output for the circuit shown in Figure 1.138.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0100.jpg?height=223&width=716&top_left_y=797&top_left_x=262)

Figure 1.137. Bandpass filter response.

Exercise 1.44. Design an oscilloscope " $\times 10$ probe" to use with a scope whose input impedance is $1 \mathrm{M} \Omega$ in parallel with 20 pF by figuring out what goes inside the probe handle in Figure 1.139. Assume that the probe cable adds an additional 100 pF and that the probe components are placed at the tip end (rather than at the scope end) of the cable. The resultant network should have
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0100.jpg?height=289&width=493&top_left_y=223&top_left_x=1223)

Figure 1.138. Circuit for Exercise 1.43.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0100.jpg?height=401&width=731&top_left_y=616&top_left_x=1104)

Figure 1.139. Oscilloscope $\times 10$ probe.

20 dB ( $\times 10$ voltage division ratio) attenuation at all frequencies, including dc. The reason for using a $\times 10$ probe is to increase the load impedance seen by the circuit under test, which reduces loading effects. What input impedance ( $R$ in parallel with $C$ ) does your $\times 10$ probe present to the circuit under test when used with the scope?

#### Review of Chapter 1

An A-to-H summary of what we have learned in Chapter 1. This summary reviews basic principles and facts in Chapter 1, but it does not cover application circuit diagrams and practical engineering advice presented there.

#### IfA. Voltage and Current.

Electronic circuits consist of components connected together with wires. Current $(I)$ is the rate of flow of charge through some point in these connections; it's measured in amperes (or milliamps, microamps, etc.). Voltage ( $V$ ) between two points in a circuit can be viewed as an applied driving "force" that causes currents to flow between them; voltage is measured in volts (or kilovolts, millivolts, etc.); see $\S 1.2 .1$. Voltages and currents can be steady (dc), or varying. The latter may be as simple as the sinusoidal alternating voltage (ac) from the wallplug, or as complex as a high-frequency modulated communications waveform, in which case it's usually called a signal (see T[B below). The algebraic sum of currents at a point in a circuit (a node) is zero (Kirchhoff's current law, KCL, a consequence of conservation of charge), and the sum of voltage drops going around a closed loop in a circuit is zero (Kirchhoff's voltage law, KVL, a consequence of the conservative nature of the electrostatic field).

#### IB. Signal Types and Amplitude.

See §1.3. In digital electronics we deal with pulses, which are signals that bounce around between two voltages (e.g., +5 V and ground); in the analog world it's sinewaves that win the popularity contest. In either case, a periodic signal is characterized by its frequency $f$ (units of $\mathrm{Hz}, \mathrm{MHz}$, etc.) or, equivalently, period $T$ (units of $\mathrm{ms}, \mu \mathrm{s}$, etc.). For sinewaves it's often more convenient to use angular frequency (radians/s), given by $\omega=2 \pi f$.

Digital amplitudes are specified simply by the HIGH and Low voltage levels. With sinewaves the situation is more complicated: the amplitude of a signal $V(t)=V_{0} \sin \omega t$ can be given as (a) peak amplitude (or just "amplitude") $V_{0}$, (b) root-mean-square (rms) amplitude $V_{\mathrm{rms}}=V_{0} / \sqrt{2}$, or (c) peak-to-peak amplitude $V_{\mathrm{pp}}=2 V_{0}$. If unstated, a sinewave amplitude is usually understood to be $V_{\mathrm{rms}}$. A signal of rms amplitude $V_{\text {rms }}$ delivers power $P=V_{\mathrm{rms}}^{2} / R_{\text {load }}$ to a resistive load (regardless of the signal's waveform), which accounts for the popularity of rms amplitude measure.

Ratios of signal amplitude (or power) are commonly expressed in decibels $(\mathrm{dB})$, defined as $\mathrm{dB}=10 \log _{10}\left(P_{2} / P_{1}\right)$ or $20 \log _{10}\left(V_{2} / V_{1}\right)$; see $\S 1.3 .2$. An amplitude ratio of 10 (or power ratio of 100 ) is $20 \mathrm{~dB} ; 3 \mathrm{~dB}$ is a doubling of
power; 6 dB is a doubling of amplitude (or quadrupling of power). Decibel measure is also used to specify amplitude (or power) directly, by giving a reference level: for example, $-30 \mathrm{dBm}(\mathrm{dB}$ relative to 1 mW ) is $1 \mathrm{microwatt;}$ +3 dBVrms is a signal of 1.4 V rms amplitude ( 2 V peak, 4 Vpp ).

Other important waveforms are square waves, triangle waves, ramps, noise, and a host of modulation schemes by which a simple "carrier" wave is varied in order to convey information; some examples are AM and FM for analog communication, and PPM (pulse-position modulation) or QAM (quadrature-amplitude modulation) for digital communication.

#### IC. The Relationship Between Current and Voltage.

This chapter concentrated on the fundamental, essential, and ubiquitous two-terminal linear devices: resistors, capacitors, and inductors. (Subsequent chapters deal with transistors - three-terminal devices in which a signal applied to one terminal controls the current flow through the other pair - and their many interesting applications. These include amplification, filtering, power conversion, switching, and the like.) The simplest linear device is the resistor, for which $I=V / R$ (Ohm's Law, see $\S 1.2 .2 \mathrm{~A}$ ). The term "linear" means that the response (e.g., current) to a combined sum of inputs (i.e., voltages) is equal to the sum of the responses that each input would produce: $I\left(V_{1}+V_{2}\right)=I\left(V_{1}\right)+I\left(V_{2}\right)$.

#### ID. Resistors, Capacitors, and Inductors.

The resistor is clearly linear. But it is not the only linear two-terminal component, because linearity does not require $I \propto V$. The other two linear components are $c a$ pacitors (§1.4.1) and inductors (§1.5.1), for which there is a time-dependent relationship between voltage and current: $I=C d V / d t$ and $V=L d I / d t$, respectively. These are the time domain descriptions. Thinking instead in the frequency domain, these components are described by their impedances, the ratio of voltage to current (as a function of frequency) when driven with a sinewave (§1.7). A linear device, when driven with a sinusoid, responds with a sinusoid of the same frequency, but with changed amplitude and phase. Impedances are therefore complex, with the real part representing the amplitude of the response that is in-phase, and the imaginary part representing the amplitude of the response that is in quadrature $\left(90^{\circ}\right.$ out of phase). Alternatively, in the polar representation of complex impedance $\left(Z=|Z| e^{i \theta}\right)$, the magnitude $|Z|$ is the ratio of magnitudes $(|Z|=|V| /|I|)$ and the quantity $\theta$ is the phase shift between $V$ and $I$. The impedances of the three
linear 2-terminal components are $Z_{\mathrm{R}}=R, Z_{\mathrm{C}}=-j / \omega C$, and $Z_{\mathrm{L}}=j \omega L$, where (as always) $\omega=2 \pi f$; see $\S 1.7 .5$. Sinewave current through a resistor is in phase with voltage, whereas for a capacitor it leads by $90^{\circ}$, and for an inductor it lags by $90^{\circ}$.

#### ПE. Series and Parallel.

The impedance of components connected in series is the sum of their impedances; thus $R_{\text {series }}=R_{1}+R_{2}+\cdots$, $L_{\text {series }}=L_{1}+L_{2}+\cdots, \quad$ and $\quad 1 / C_{\text {series }}=1 / C_{1}+1 / C_{2}+\cdots$. When connected in parallel, on the other hand, it's the admittances (inverse of impedance) that add. Thus the formula for capacitors in parallel looks like the formula for resistors in series, $C_{\mathrm{parallel}}=C_{1}+C_{2}+\cdots$; and vice versa for resistors and inductors, thus $1 / R_{\text {parallel }}=1 / R_{1}+1 / R_{2}+\cdots$. For a pair of resistors in parallel this reduces to $R_{\text {parallel }}=\left(R_{1} R_{2}\right) /\left(R_{1}+R_{2}\right)$. For example, two resistors of value $R$ have resistance $R / 2$ when connected in parallel, or resistance $2 R$ in series.

The power dissipated in a resistor $R$ is $P=I^{2} R=V^{2} / R$. There is no dissipation in an ideal capacitor or inductor, because the voltage and current are $90^{\circ}$ out of phase. See §1.7.6.

#### ПF. Basic Circuits with R, L, and C.

Resistors are everywhere. They can be used to set an operating current, as for example when powering an LED or biasing a zener diode (Figure 1.16); in such applications the current is simply $I=\left(V_{\text {supply }}-V_{\text {load }}\right) / R$. In other applications (e.g., as a transistor's load resistor in an amplifier, Figure 3.29) it is the current that is known, and a resistor is used to convert it to a voltage. An important circuit fragment is the voltage divider (§1.2.3), whose unloaded output voltage (across $R_{2}$ ) is $V_{\text {out }}=V_{\text {in }} R_{2} /\left(R_{1}+R_{2}\right)$.

If one of the resistors in a voltage divider is replaced with a capacitor, you get a simple filter: lowpass if the lower leg is a capacitor, highpass if the upper leg is a capacitor (§§1.7.1 and 1.7.7). In either case the -3 dB transition frequency is at $f_{3 \mathrm{~dB}}=1 / 2 \pi R C$. The ultimate rolloff rate of such a "single-pole" lowpass filter is $-6 \mathrm{~dB} /$ octave, or $-20 \mathrm{~dB} /$ decade; i.e., the signal amplitude falls as $1 / f$ well beyond $f_{3 \mathrm{~dB}}$. More complex filters can be created by combining inductors with capacitors, see Chapter 6. A capacitor in parallel with an inductor forms a resonant circuit; its impedance (for ideal components) goes to infinity at the resonant frequency $f=1 /(2 \pi \sqrt{L C})$. The impedance of a series $L C$ goes to zero at that same resonant frequency. See §1.7.14.

Other important capacitor applications in this chapter (§1.7.16) include (a) bypassing, in which a capacitor's low
impedance at signal frequencies suppresses unwanted signals, e.g., on a dc supply rail; (b) blocking (§1.7.1C), in which a highpass filter blocks dc, but passes all frequencies of interest (i.e., the breakpoint is chosen below all signal frequencies); (c) timing (§1.4.2D), in which an $R C$ circuit (or a constant current into a capacitor) generates a sloping waveform used to create an oscillation or a timing interval; and (d) energy storage (§1.7.16B), in which a capacitor's stored charge $Q=C V$ smooths out the ripples in a dc power supply.

In later chapters we'll see some additional applications of capacitors: (e) peak detection and sample-and-hold (§§4.5.1 and 4.5.2), which capture the voltage peak or transient value of a waveform, and (f) the integrator (§4.2.6), which performs a mathematical integration of an input signal.

#### ๆG. Loading; Thévenin Equivalent Circuit.

Connecting a load (e.g., a resistor) to the output of a circuit (a "signal source") causes the unloaded output voltage to drop; the amount of such loading depends on the load resistance, and the signal source's ability to drive it. The latter is usually expressed as the equivalent source impedance (or Thévenin impedance) of the signal. That is, the signal source is modeled as a perfect voltage source $V_{\text {sig }}$ in series with a resistor $R_{\text {sig }}$. The output of the resistive voltage divider driven from an input voltage $V_{\mathrm{in}}$, for example, is modeled as a voltage source $V_{\text {sig }}=V_{\text {in }} R_{2} /\left(R_{1}+R_{2}\right)$ in series with a resistance $R_{\mathrm{sig}}=R_{1} R_{2} /\left(R_{1}+R_{2}\right)$ (which is just $\left.R_{1} \| R_{2}\right)$. So the output of a $1 \mathrm{k} \Omega-1 \mathrm{k} \Omega$ voltage divider driven by a 10 V battery looks like 5 V in series with $500 \Omega$.

Any combination of voltage sources, current sources, and resistors can be modeled perfectly by a single voltage source in series with a single resistor (its "Thévenin equivalent circuit"), or by a single current source in parallel with a single resistor (its "Norton equivalent circuit"); see Appendix D. The Thévenin equivalent source and resistance values are found from the open-circuit voltage and short-circuit current as $V_{\mathrm{Th}}=V_{\mathrm{oc}}, R_{\mathrm{Th}}=V_{\mathrm{oc}} / I_{\mathrm{sc}}$; and for the Norton equivalent they are $I_{\mathrm{N}}=I_{\mathrm{sc}}, R_{\mathrm{N}}=V_{\mathrm{oc}} / I_{\mathrm{sc}}$.

Because a load impedance forms a voltage divider with the signal's source impedance, it's usually desirable for the latter to be small compared with any anticipated load impedance (§1.2.5A). However, there are two exceptions: (a) a current source has a high source impedance (ideally infinite), and should drive a load of much lower impedance; and (b) signals of high frequency (or fast risetime), traveling through a length of cable, suffer reflections unless the load impedance equals the so-called "characteristic impedance" $Z_{0}$ of the cable (commonly $50 \Omega$ ), see Appendix H .

#### IH. The Diode, a Nonlinear Component.

There are important two-terminal devices that are not linear, notably the diode (or rectifier), see §1.6. The ideal diode conducts in one direction only; it is a "one-way valve." The onset of conduction in real diodes is roughly at 0.5 V in the "forward" direction, and there is some small leakage current in the "reverse" direction, see Figure 1.55 . Useful diode circuits include power-supply rectification (conversion of ac to dc, §1.6.2), signal rectification (§1.6.6A), clamping (signal limiting, §1.6.6C), and gating (§1.6.6B). Diodes are commonly used to prevent polarity
reversal, as in Figure 1.84; and their exponential current versus applied voltage can be used to fashion circuits with logarithmic response (§1.6.6E).

Diodes specify a maximum safe reverse voltage, beyond which avalanche breakdown (an abrupt rise of current) occurs. You don't go there! But you can (and should) with a zener diode (§1.2.6A), for which a reverse breakdown voltage (in steps, going from about 3.3 V to 100 V or more) is specified. Zeners are used to establish a voltage within a circuit (Figure 1.16), or to limit a signal's swing.

# 2. BIPOLAR TRANSISTORS

## 2.1 Introduction

The transistor is our most important example of an "active" component, a device that can amplify, producing an output signal with more power in it than the input signal. The additional power comes from an external source of power (the power supply, to be exact). Note that voltage amplification isn't what matters, since, for example, a step-up transformer, a "passive" component just like a resistor or capacitor, has voltage gain but no power gain. ${ }^{1}$ Devices with power gain are distinguishable by their ability to make oscillators, by feeding some output signal back into the input.

It is interesting to note that the property of power amplification seemed very important to the inventors of the transistor. Almost the first thing they did to convince themselves that they had really invented something was to power a loudspeaker from a transistor, observing that the output signal sounded louder than the input signal.

The transistor is the essential ingredient of every electronic circuit, from the simplest amplifier or oscillator to the most elaborate digital computer. Integrated circuits (ICs), which have largely replaced circuits constructed from discrete transistors, are themselves merely arrays of transistors and other components built from a single chip of semiconductor material.

A good understanding of transistors is very important, even if most of your circuits are made from ICs, because you need to understand the input and output properties of the IC in order to connect it to the rest of your circuit and to the outside world. In addition, the transistor is the single most powerful resource for interfacing, whether between ICs and other circuitry or between one subcircuit and another. Finally, there are frequent (some might say too frequent) situations in which the right IC just doesn't exist, and you have to rely on discrete transistor circuitry to do the job. As you will see, transistors have an excitement all their own. Learning how they work can be great fun.

[^47]There are two major species of transistors: in this chapter we will learn about bipolar junction transistors (BJTs), which historically came first with their Nobel Prize-winning invention in 1947 at Bell Laboratories. The next chapter deals with "field-effect" transistors (FETs), the now-dominant species in digital electronics. To give the coarsest comparison, BJTs excel in accuracy and low noise, whereas FETs excel in low power, high impedance, and high-current switching; there is, of course, much more to this complex subject.

Our treatment of bipolar transistors is going to be quite different from that of many other books. It is common practice to use the $h$-parameter model and equivalent circuit. In our opinion that is unnecessarily complicated and unintuitive. Not only does circuit behavior tend to be revealed to you as something that drops out of elaborate equations, rather than deriving from a clear understanding in your own mind as to how the circuit functions; you also have the tendency to lose sight of which parameters of transistor behavior you can count on and, more important, which ones can vary over large ranges.

In this chapter we will instead build up a very simple introductory transistor model and immediately work out some circuits with it. Its limitations will soon become apparent; then we will expand the model to include the respected Ebers-Moll conventions. With the EbersMoll equations and a simple three-terminal model, you will have a good understanding of transistors; you won't need to do a lot of calculations, and your designs will be first rate. In particular, they will be largely independent of the poorly controlled transistor parameters such as current gain.

Some important engineering notation should be mentioned. Voltage at a transistor terminal (relative to ground) is indicated by a single subscript (C, B, or E): $V_{\mathrm{C}}$ is the collector voltage, for instance. Voltage between two terminals is indicated by a double subscript: $V_{\mathrm{BE}}$ is the base-toemitter voltage drop, for instance. If the same letter is repeated, that means a power-supply voltage: $V_{\mathrm{CC}}$ is the (positive) power-supply voltage associated with the collector,
and $V_{\mathrm{EE}}$ is the (negative) supply voltage associated with the emitter. ${ }^{2}$

#### Why transistor circuits are difficult

For those learning electronics for the first time, this chapter will be difficult. Here's why: all the circuits in the last chapter dealt with two-terminal devices, whether linear (resistors, capacitors, inductors) or nonlinear (diodes). So there was only one voltage (the voltage between the terminals) and only one current (the current flowing through the device) to think about. Transistors, by contrast, are threeterminal devices, which means there are two voltages and two currents to juggle. ${ }^{3}$

### 2.1.1 First transistor model: current amplifier

Let's begin. A bipolar transistor is a three-terminal device (Figure 2.1), in which a small current applied to the base controls a much larger current flowing between the collector and emitter. It is available in two flavors ( $n p n$ and pnp), with properties that meet the following rules for $n p n$ transistors (for pnp simply reverse all polarities):

1. Polarity The collector must be more positive than the emitter.
2. Junctions The base-emitter and base-collector circuits behave like diodes (Figure 2.2) in which a small current applied to the base controls a much larger current flowing between the collector and emitter. Normally the base-emitter diode is conducting, whereas the basecollector diode is reverse-biased, i.e., the applied voltage is in the opposite direction to easy current flow.
3. Maximum ratings Any given transistor has maximum values of $I_{\mathrm{C}}, I_{\mathrm{B}}$, and $V_{\mathrm{CE}}$ that cannot be exceeded without costing the exceeder the price of a new transistor (for typical values, see the listing in Table 2.1 on page 74 , Table 2.2 on page 106, and Table 8.1 on pages 501-502 There are also other limits, such as power dissipation ( $I_{\mathrm{C}} V_{\mathrm{CE}}$ ), temperature, and $V_{\mathrm{BE}}$, that you must keep in mind.
4. Current amplifier When rules $1-3$ are obeyed, $I_{C}$ is roughly proportional to $I_{B}$ and can be written as

$$
\begin{equation*}
I_{\mathrm{C}}=h_{\mathrm{FE}} I_{\mathrm{B}}=\beta I_{\mathrm{B}}, \tag{2.1}
\end{equation*}
$$

${ }^{2}$ In practice, circuit designers use $V_{\mathrm{CC}}$ to designate the positive supply and $V_{\mathrm{EE}}$ the negative supply, even though logically they should be interchanged for pnp transistors (where all polarities are reversed).
${ }^{3}$ You might think that there would be three voltages and three currents; but it's slightly less complicated than that, because there are only two independent voltages and two independent currents, thanks to Kirchhoff's voltage and current laws.
where $\beta$, the current gain (sometimes called ${ }^{4} h_{\mathrm{FE}}$ ), is typically about 100 . Both $I_{\mathrm{B}}$ and $I_{\mathrm{C}}$ flow to the emitter. Note: the collector current is not due to forward conduction of the base-collector diode; that diode is reversebiased. Just think of it as "transistor action."
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0105.jpg?height=440&width=644&top_left_y=428&top_left_x=1048)

Figure 2.1. Transistor symbols and small transistor package drawings (not to scale). A selection of common transistor packages are shown in Figure 2.3.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0105.jpg?height=235&width=582&top_left_y=1028&top_left_x=1079)

Figure 2.2. An ohmmeter's view of a transistor's terminals.

Rule 4 gives the transistor its usefulness: a small current flowing into the base controls a much larger current flowing into the collector.

An important warning: the current gain $\beta$ is not a "good" transistor parameter; for instance, its value can vary from 50 to 250 for different specimens of a given transistor type. It also depends on the collector current, collector-toemitter voltage, and temperature. A circuit that depends on a particular value for beta is a bad circuit.

Note particularly the effect of rule 2 . This means you can't go sticking an arbitrary voltage across the baseemitter terminals, because an enormous current will flow if the base is more positive than the emitter by more than about 0.6 to 0.8 V (forward diode drop). This rule also implies that an operating transistor has $V_{\mathrm{B}} \approx V_{\mathrm{E}}+0.6 \mathrm{~V}$ $\left(V_{\mathrm{B}}=V_{\mathrm{E}}+V_{\mathrm{BE}}\right)$. Again, polarities are normally given for $n p n$ transistors; reverse them for $p n p$.

Let us emphasize again that you should not try to think of the collector current as diode conduction. It isn't,

[^48]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0106.jpg?height=863&width=1154&top_left_y=211&top_left_x=471)

Figure 2.3. Most of the common packages are shown here, for which we give the traditional designations. Top row (power), left to right: TO-220 (with and without heatsink), TO-39, TO-5, TO-3. Middle row (surface mount): SM-8 (dual), SO-8 (dual), SOT-23, ceramic SOE, SOT-223. Bottom row: DIP-16 (quad), DIP-4, TO-92, TO-18, TO-18 (dual).
because the collector-base diode normally has voltages applied across it in the reverse direction. Furthermore, collector current varies very little with collector voltage (it behaves like a not-too-great current source), unlike forward diode conduction, in which the current rises very rapidly with applied voltage.

Table 2.1 on the following page includes a selection of commonly used bipolar transistors, with the corresponding curves of current gain ${ }^{5}$ in Figure 2.4, and a selection of transistors intended for power applications is listed in Table 2.2 on page 106. A more complete listing can be found in Table 8.1 on pages 501-502 and Figure 8.39 in Chapter 8.

## 2.2 Some basic transistor circuits

### 2.2.1 Transistor switch

Look at the circuit in Figure 2.5. This application, in which a small control current enables a much larger current to

[^49]flow in another circuit, is called a transistor switch. From the preceding rules it is easy to understand. When the mechanical switch is open, there is no base current. So, from rule 4, there is no collector current. The lamp is off.

When the switch is closed, the base rises to 0.6 V (baseemitter diode is in forward conduction). The drop across the base resistor is 9.4 V , so the base current is 9.4 mA . Blind application of Rule 4 gives $I_{C}=940 \mathrm{~mA}$ (for a typical beta of 100). That is wrong. Why? Because rule 4 holds only if Rule 1 is obeyed: at a collector current of 100 mA the lamp has 10 V across it. To get a higher current you would have to pull the collector below ground. A transistor can't do this, and the result is what's called saturation the collector goes as close to ground as it can (typical saturation voltages are about $0.05-0.2 \mathrm{~V}$, see Chapter $2 x$.) and stays there. In this case, the lamp goes on, with its rated 10 V across it.

Overdriving the base (we used 9.4 mA when 1.0 mA would have barely sufficed) makes the circuit conservative; in this particular case it is a good idea, since a lamp draws more current when cold (the resistance of a lamp when cold is 5 to 10 times lower than its resistance at operating current). Also, transistor beta drops at low collector-to-base voltages, so some extra base current is necessary to bring

Table 2.1 Representative Bipolar Transistors
Part \#

| npn |  | pnp |  | $V_{\text {CEO }}$ <br> (V) | $I_{(\mathrm{mA})}^{\mathrm{C}(\mathrm{max})}$ | $h_{\text {FE }}^{(\text {typ })}$ |  | gain curve ${ }^{d}$ | $\begin{aligned} & C_{\mathrm{cb}}^{\mathrm{a}} \\ & (\mathrm{pF}) \end{aligned}$ | $\begin{gathered} f_{\mathrm{T}}^{\mathrm{a}} \\ (\mathrm{MHz}) \end{gathered}$ | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| TO-92 | SOT-23 | TO-92 | SOT-23 |  |  |  |  |  |  |  |  |
| 2N3904 | MMBT3904 | 2N3906 | MMBT3906 | 40 | 150 | 200 | 10 | 6 | 2.5 | 300 | jellybean |
| 2N4401 | MMBT4401 | 2N4403 | MMBT4403 | 40 | 500 | 150 | 150 | 7 | 7 | 300 | '2222 and '2907 dies |
| BC337 | BC817 | BC327 | BC807 | 45 | 750 | 350 | 40 | 5 | 10 | 150 | jellybean |
| 2N5089 | MMBT5089 | 2N5087 | MMBT5087 | 25 | 50 | 500 | 1 | 3 | 1.8 | 350 | high beta |
| BC547C | BC847C | BC557C | BC857C | 45 | 100 | 500 | 10 | 4 | 5 | 150 | jellybean ${ }^{\text {b }}$ |
| MPSA14 | MMBTA14 | MPSA64 | MMBTA64 | 30 | 300 | 10000 | 50 | - | 7 | 125 | Darlington |
| ZTX618 | FMMT618 | ZTX718 | FMMT718 | 20 | 2500 | 320 | 3A | 3a | - | 120 | high /c, small pkg |
| PN2369 | MMBT2369 | 2N5771 | MMBT5771 | 15 | 150 | 100 | 10 | 10 | 3 | 500 | fast switch, gold doped |
| 2N5551 | MMBT5551 | 2N5401 | MMBT5401 | 150 | 100 | 100 | 10 | 5a | 2.5 | 100 | SOT-223 available |
| MPSA42 | MMBTA42 | MPSA92 | MMBTA92 | 300 | 30 | 75 | 10 | 9 | 1.5 | 50 | HV small signal |
| MPS5179 | BFS17 | MPSH81 | MMBTH81 | 15 | 25 | 90 | 20 | 8 | 0.9 | 900 | RF amplifier |
| - | BFR93 ${ }^{\text {C }}$ | - | BFT93 ${ }^{\text {C }}$ | 12 | 50 | 50 | 15 | 10 | 0.5 | 4000 | RF amp |
| TIP142 | - | TIP147 | - | 100 | 10A | >1000 | 5A | - | high | low | TO-220, Darlington |

Notes: (a) see Chapter $2 x$ for graphs of $C_{\mathrm{cb}}$ and $f_{\mathrm{T}}$. (b) lower beta versions have an -A or -B suffix; low-noise versions are BC850 (npn) and BC860 (pnp). (c) also BFR25A and BFT25A. (d) see Figure 2.4.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0107.jpg?height=694&width=797&top_left_y=1079&top_left_x=122)

Figure 2.4. Curves of typical transistor current gain, $\beta$, for a selection of transistors from Table 2.1. These curves are taken from manufacturers' literature. You can expect production spreads of $+100 \%,-50 \%$ from the "typical" values graphed. See also Figure 8.39 for measured beta plots for 44 types of "low-noise" transistors.
a transistor into full saturation. Incidentally, in a real circuit you would probably put a resistor from base to ground (perhaps 10k in this case) to make sure the base is at ground with the switch open. It wouldn't affect the ON operation, because it would sink only 0.06 mA from the base circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0107.jpg?height=371&width=465&top_left_y=1080&top_left_x=1140)

Figure 2.5. Transistor switch example.

There are certain cautions to be observed when designing transistor switches:

1. Choose the base resistor conservatively to get plenty of excess base current, especially when driving lamps, because of the reduced beta at low $V_{\mathrm{CE}}$. This is also a good idea for high-speed switching, because of capacitive effects and reduced beta at very high frequencies (many megahertz). ${ }^{6}$
2. If the load swings below ground for some reason (e.g., it is driven from ac, or it is inductive), use a diode in series with the collector (or a diode in the reverse direction to ground) to prevent collector-base conduction on negative swings.
3. For inductive loads, protect the transistor with a diode

[^50]across the load, as shown in Figure 2.6. ${ }^{7}$ Without the diode the inductor will swing the collector to a large positive voltage when the switch is opened, most likely exceeding the collector-emitter breakdown voltage, as the inductor tries to maintain its "on" current from $V_{\mathrm{CC}}$ to the collector (see the discussion of inductors in $\S 1.6 .7$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0108.jpg?height=389&width=236&top_left_y=515&top_left_x=474)

Figure 2.6. Always use a suppression diode when switching an inductive load.

You might ask why we are bothering with a transistor, and all its complexity, when we could just use that mechanical switch alone to control the lamp or other load. There are several good reasons: (a) a transistor switch can be driven electrically from some other circuit, for example a computer output bit; (b) transistor switches enable you to switch very rapidly, typically in a small fraction of a microsecond; (c) you can switch many different circuits with a single control signal; (d) mechanical switches suffer from wear, and their contacts "bounce" when the switch is activated, often making and breaking the circuit a few dozen times in the first few milliseconds after activation; and (e) with transistor switches you can take advantage of remote cold switching, in which only dc control voltages snake around through cables to reach front-panel switches, rather than the electronically inferior approach of having the signals themselves traveling through cables and switches (if you run lots of signals through cables, you're likely to get capacitive pickup as well as some signal degradation).

#### A. "Transistor man"

The cartoon in Figure 2.7 may help you understand some limits of transistor behavior. The little man's perpetual task in life is to try to keep $I_{\mathrm{C}}=\beta I_{B}$; however, he is only allowed to turn the knob on the variable resistor. Thus he can go from a short circuit (saturation) to an open circuit (transistor in the OFF state), or anything in between, but he isn't allowed to use batteries, current sources, etc.

[^51]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0108.jpg?height=810&width=779&top_left_y=207&top_left_x=1080)

Figure 2.7. "Transistor man" observes the base current, and adjusts the output rheostat in an attempt to maintain the output current $\beta$ times larger; $h_{\mathrm{FE}}$ and $\beta$ are used interchangeably.

One warning is in order here: don't think that the collector of a transistor looks like a resistor. It doesn't. Rather, it looks approximately like a poor-quality constant-current sink (the value of current depending on the signal applied to the base), primarily because of this little man's efforts.

Another thing to keep in mind is that, at any given time, a transistor may be (a) cut off (no collector current), (b) in the active region (some collector current, and collector voltage more than a few tenths of a volt above the emitter), or (c) in saturation (collector within a few tenths of a volt of the emitter). See the discussion of transistor saturation in Chapter $2 x$ for more details.

### 2.2.2 Switching circuit examples

The transistor switch is an example of a nonlinear circuit: the output is not proportional to the input; ${ }^{8}$ instead it goes to one of two possible states (cut off, or saturated). Such two-state circuits are extremely common ${ }^{9}$ and form the basis of digital electronics. But to the authors the subject of

[^52]linear circuits (such as amplifiers, current sources, and integrators) offers the most interesting challenges and the potential for great circuit creativity. We will move on to linear circuits in a moment, but this is a good time to enjoy a few circuit examples with transistors acting as switches we like to give a feeling for the richness of electronics by showing real-world examples as soon as possible.

#### A. LED driver

Light-emitting diode indicators - LEDs - have replaced the incandescent lamps of yesteryear for all electronic indicator and readout applications; they're cheap, they come in lots of colors, and they last just about forever. Electrically they are similar to the ordinary silicon signal diodes we met in Chapter 1, but with a larger forward voltage drop (generally in the range of $1.5-3.5 \mathrm{~V}$, rather than approximately ${ }^{10}$ 0.6 V ); that is, as you slowly increase the voltage across an LED's terminals, you find that they start conducting current at, say, 1.5 V , and the current increases rapidly as you apply somewhat more voltage (Figure 2.8). They light up, too! Typical "high-efficiency" indicator LEDs look pretty good at a few milliamps, and they'll knock your eye out at 10-20 mA.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0109.jpg?height=608&width=791&top_left_y=1196&top_left_x=125)

Figure 2.8. Like silicon diodes, LEDs have rapidly increasing current versus applied voltage, but with larger forward voltage drops.

We'll show a variety of techniques for driving LEDs in Chapter 12; but we can drive them already, with what we know. The first thing to realize is that we can't just switch a voltage across them, as in Figure 2.5, because of their steep $I$ versus $V$ behavior; for example, applying 5 V across an

[^53]LED is guaranteed to blow it out. We need instead to treat it gently, coaxing it to draw the right current.

Let's assume that we want the LED to light in response to a digital signal line when it goes to a HIGH value of +3.3 V (from its normal resting voltage near ground). Let's assume also that the digital line can provide up to 1 mA of current, if needed. The procedure goes like this: first, choose an LED operating current that will provide adequate brightness, say 5 mA (you might want to try a few samples, to make sure you like the color, brightness, and viewing angle). Then use an $n p n$ transistor as a switch (Figure 2.9), choosing the collector resistor to provide the chosen LED current, realizing that the voltage drop across the resistor is the supply voltage minus the LED forward drop at its operating current. Finally, choose the base resistor to ensure saturation, assuming a conservatively low transistor beta ( $\beta \geq 25$ is pretty safe for a typical small-signal transistor like the popular 2N3904).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0109.jpg?height=363&width=483&top_left_y=987&top_left_x=1136)

Figure 2.9. Driving an LED from a "logic-level" input signal, using an $n p n$ saturated switch and series current-limiting resistor.

Note that the transistor is acting as a saturated switch, with the collector resistor setting the operating current. As we'll see shortly, you can devise circuits that provide an accurate current output, largely independent of what the load does. Such a "current source" can also be used to drive LEDs. But our circuit is simple, and effective. There are other variations: we'll see in the next chapter that a MOSFET-type ${ }^{11}$ transistor is often a better choice. And in Chapters $10-12$ we'll see ways to drive LEDs and other optoelectronic devices directly from digital integrated circuits, without external discrete transistors.

Exercise 2.1. What is the LED current, approximately, in the circuit of Figure 2.9? What minimum beta is required for $Q_{1}$ ?

#### B. Variations on a theme

For these switch examples, one side of the load is connected to a positive supply voltage, and the other side is

[^54]switched to ground by the $n p n$ transistor switch. What if you want instead to ground one side of the load and switch the "high side" to a positive voltage?

It's easy enough - but you've got to use the other polarity of transistor (pnp), with its emitter at the positive rail, and its collector tied to the load's high side, as in Figure 2.10 A . The transistor is cut off when the base is held at the emitter voltage (here +15 V ), and switched into saturation by bringing the base toward the collector (i.e., toward ground). When the input is brought to ground, there's about 4 mA of base current through the $3.3 \mathrm{k} \Omega$ base resistor, sufficient for switching loads up to about $200 \mathrm{~mA}(\beta>50$ ).

An awkwardness of this circuit is the need to hold the input at +15 V to turn off the switch; it would be much better to use a lower control voltage, for example, +3 V and ground, commonly available in digital logic that we'll be seeing in Chapters $10-15$. Figure 2.10B shows how to do that: npn switch $Q_{2}$ accepts the "logic-level" input of 0 V or +3 V , pulling its collector load to ground accordingly. When $Q_{2}$ is cut off, $R_{3}$ holds $Q_{3}$ off; when $Q_{2}$ is saturated (by a +3 V input), $R_{2}$ sinks base current from $Q_{3}$ to bring it into saturation.

The "divider" formed by $R_{2} R_{3}$ may be confusing: $R_{3}$ 's job is to keep $Q_{3}$ off when $Q_{2}$ is off; and when $Q_{2}$ pulls its collector low, most of its collector current comes from $Q_{3}$ 's base (because only $\sim 0.6 \mathrm{~mA}$ of the 4.4 mA collector current comes from $R_{3}$ - make sure you understand why). That is, $R_{3}$ does not have much effect on $Q_{3}$ 's saturation. Another way to say it is that the divider would sit at about +11.6 V (rather than +14.4 V ), were it not for $Q_{3}$ 's baseemitter diode, which consequently gets most of $Q_{2}$ 's collector current. In any case, the value of $R_{3}$ is not critical and could be made larger; the tradeoff is slower turn-off of $Q_{3}$, owing to capacitive effects. ${ }^{12}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0110.jpg?height=376&width=814&top_left_y=1646&top_left_x=218)

Figure 2.10. Switching the high side of a load returned to ground.

[^55]
#### C. Pulse generator -I

By including a simple $R C$, you can make a circuit that gives a pulse output from a step input; the time constant $\tau=R C$ determines the pulse width. Figure 2.11 shows one way. $Q_{2}$ is normally held in saturation by $R_{3}$, so its output is close to ground; note that $R_{3}$ is chosen small enough to ensure $Q_{2}$ 's saturation. With the circuit's input at ground, $Q_{1}$ is cut off, with its collector at +5 V . The capacitor $C_{1}$ is therefore charged, with +5 V on its left terminal and approximately +0.6 V on its right terminal; i.e., it has about 4.4 V across it. The circuit is waiting for something to happen.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0110.jpg?height=794&width=802&top_left_y=710&top_left_x=1066)

Figure 2.11. Generating a short pulse from a step input waveform.
A +5 V positive input step brings $Q_{1}$ into saturation (note the values of $R_{1}$ and $R_{2}$ ), forcing its collector to ground; because of the voltage across $C_{1}$, this brings the base of $Q_{2}$ momentarily negative, to about $-4.4 \mathrm{~V}{ }^{13} Q_{2}$ is then cutoff, no current flows through $R_{4}$, and so its output jumps to +5 V ; this is the beginning of the output pulse. Now for the $R C$ : $C_{1}$ can't hold $Q_{2}$ 's base below ground forever, because current is flowing down through $R_{3}$, trying to pull it up. So the right-hand side of the capacitor charges toward +5 V , with a time constant $\tau=R_{3} C_{1}$, here equal to $100 \mu \mathrm{~s}$. The output pulse width is set by this time constant

[^56]and is proportional to $\tau$. To figure out the pulse width accurately you have to look in detail at the circuit operation. In this case it's easy enough to see that the output transistor $Q_{2}$ will turn on again, terminating the output pulse, when the rising voltage on the base of transistor $Q_{2}$ reaches the $\approx 0.6 \mathrm{~V} V_{\mathrm{BE}}$ drop required for turn-on. Try this problem to test your understanding.

Exercise 2.2. Show that the output pulse width for the circuit of Figure 2.11 is approximately $T_{\text {pulse }}=0.76 R_{3} C_{1}=76 \mu \mathrm{~s}$. A good starting point is to notice that $C_{1}$ is charging exponentially from -4.4 V toward +5 V , with the time constant as above.

#### D. Pulse generator - II

Let's play with this circuit a bit. It works fine as described, but note that it requires that the input remain high throughout the duration of the output pulse, at least. It would be nice to eliminate that restriction, and the circuit in Figure 2.12 shows how. To the original circuit we've added a third transistor switch $Q_{3}$, whose job is to hold the collector of $Q_{1}$ at ground once the output pulse begins, regardless of what the input signal does. Now any positive input pulse - whether longer or shorter than the desired output pulse width - produces the same output pulse width; look at the waveforms in the figure. Note that we've chosen $R_{5}$ relatively large to minimize output loading while still ensuring full saturation of $Q_{3}$.

Exercise 2.3. Elaborate on this last statement: what is the output voltage during the pulse, slightly reduced owing to the loading effect of $R_{5}$ ? What is the minimum required beta of $Q_{3}$ to guarantee its saturation during the output pulse?

#### E. Pulse generator - III

For our final act, let's fix a deficiency of these circuits, namely a tendency for the output pulse to turn off somewhat slowly. That happens because $Q_{2}$ 's base voltage, with its leisurely $100 \mu \mathrm{~s} R C$ time constant, rises smoothly (and relatively slowly) through the turn-on voltage threshold of $\approx 0.6 \mathrm{~V}$. Note, by the way, that this problem does not occur at the turn-on of the output pulse, because at that transition $Q_{2}$ 's base voltage drops abruptly down to approximately -4.4 V , owing to the sharp input step waveform, which is further sharpened by the switching action of $Q_{1}$.

The cure here is to add at the output a clever circuit known as a Schmitt trigger, shown in its transistor implementation ${ }^{14}$ in Figure 2.13A. It works like this: imagine a time within the positive output pulse of the previous circuits, so the input to this new Schmitt circuit is high (near

[^57]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0111.jpg?height=998&width=818&top_left_y=210&top_left_x=966)

Figure 2.12. Generating a short pulse from a step or pulse input.
$+5 \mathrm{~V})$. That holds $Q_{4}$ in saturation, and so $Q_{5}$ is cut off, with the output at +5 V . The emitter current of $Q_{4}$ is about 5 mA , so the emitter voltage is approximately +100 mV ; the base is a $V_{\mathrm{BE}}$ higher, approximately +700 mV .

Now imagine the trailing edge of the input pulse waveform, whose voltage smoothly drops toward ground. As it drops below $700 \mathrm{mV}, Q_{4}$ begins to turn off, so its collector voltage rises. If this were a simple transistor switch (i.e., if $Q_{5}$ were absent) the collector would rise to +5 V ; here, however, the collector resistor $R_{7}$ instead supplies current to $Q_{5}$, putting it in saturation. So $Q_{5}$ 's collector drops nearly to ground.

At this simple level of analysis the circuit appears to be pretty useless, because its output is the same as its input! Let's look a little closer, though: as the input voltage drops through the 700 mV threshold and $Q_{5}$ turns on, the total emitter current rises to $\approx 10 \mathrm{~mA}$ ( 5 mA from $Q_{5}$ 's collector current, and another $\approx 5 \mathrm{~mA}$ from its base current, both of which flow out the emitter). The drop across the emitter resistor is now 200 mV , which means that the input threshold has increased to about +800 mV . So the input voltage, which had just dropped below 700 mV , now finds itself well below the new threshold, causing the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0112.jpg?height=448&width=835&top_left_y=220&top_left_x=201)
B.

Figure 2.13. A "Schmitt trigger" produces an output with abrupt transitions, regardless of the speed of the input waveform.
output to switch abruptly. This "regenerative" action is how the Schmitt trigger turns a slowly moving waveform into an abrupt transition.

A similar action occurs as the input rises through this higher threshold; see Figure 2.13B, which illustrates how the output voltage changes as the input voltage passes through the two thresholds, an effect known as hysteresis. The Schmitt trigger produces rapid output transitions as the input passes through either threshold. We'll see Schmitt triggers again in Chapters 4 and 10.

There are many enjoyable applications of transistor switches, including "signal" applications like this (combined with more complex digital logic circuits), as well as "power switching" circuits in which transistors operating at high currents, high voltages, or both, are used to control hefty loads, perform power conversion, and so on. Transistor switches can also be used as substitutes for mechanical switches when we are dealing with continuous ("linear" or "analog") waveforms. We'll see examples of these in the next chapter, when we deal with FETs, which are ideally suited to such switching tasks, and again in Chapter 12, where we deal with the control of signals and external loads from logic-level signals.

We now move on to consider the first of several linear transistor circuits.

### 2.2.3 Emitter follower

Figure 2.14 shows an example of an emitter follower. It is called that because the output terminal is the emitter, which follows the input (the base), less one diode drop:

$$
V_{E} \approx V_{B}-0.6 \text { volts. }
$$

The output is a replica of the input, but 0.6 to 0.7 V less positive. For this circuit, $V_{\text {in }}$ must stay at +0.6 V or more, or else the output will sit at ground. By returning the emit-
ter resistor to a negative supply voltage, you can permit negative voltage swings as well. Note that there is no collector resistor in an emitter follower.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0112.jpg?height=351&width=371&top_left_y=401&top_left_x=1289)

Figure 2.14. Emitter follower.

At first glance this circuit may appear quite thoroughly useless, until you realize that the input impedance is much larger than the output impedance, as will be demonstrated shortly. This means that the circuit requires less power from the signal source to drive a given load than would be the case if the signal source were to drive the load directly. Or a signal of some internal impedance (in the Thévenin sense) can now drive a load of comparable or even lower impedance without loss of amplitude (from the usual voltage-divider effect). In other words, an emitter follower has current gain, even though it has no voltage gain. It has power gain. Voltage gain isn't everything!

#### A. Impedances of sources and loads

This last point is very important and is worth some more discussion before we calculate in detail the beneficial effects of emitter followers. In electronic circuits, you're always hooking the output of something to the input of something else, as suggested in Figure 2.15. The signal source might be the output of an amplifier stage (with Thévenin equivalent series impedance $\mathbf{Z}_{\text {out }}$ ), driving the next stage or perhaps a load (of some input impedance $\mathbf{Z}_{\text {in }}$ ). In general, the loading effect of the following stage causes a reduction of signal, as we discussed earlier in $\S 1.2 .5 \mathrm{~A}$. For this reason it is usually best to keep $Z_{\text {out }} \ll Z_{\text {in }}$ (a factor of 10 is a comfortable rule of thumb).

In some situations it is OK to forgo this general goal of making the source stiff compared with the load. In particular, if the load is always connected (e.g., within a circuit) and if it presents a known and constant $\mathbf{Z}_{\text {in }}$, it is not too serious if it "loads" the source. However, it is always nicer if signal levels don't change when a load is connected. Also, if $\mathbf{Z}_{\text {in }}$ varies with signal level, then having a stiff source
( $Z_{\text {out }} \ll Z_{\text {in }}$ ) ensures linearity, where otherwise the leveldependent voltage divider would cause distortion. ${ }^{15}$

Finally, as we remarked in $\S 1.2 .5 \mathrm{~A}$, there are two situations in which $Z_{\text {out }} \ll Z_{\text {in }}$ is actually the wrong thing to do: in radiofrequency circuits we usually match impedances $\left(\mathbf{Z}_{\text {out }}=\mathbf{Z}_{\text {in }}\right)$, for reasons we'll describe in Appendix H. A second exception applies if the signal being coupled is a current rather than a voltage. In that case the situation is reversed, and we strive to make $Z_{\text {in }} \ll Z_{\text {out }}$ ( $Z_{\text {out }}=\infty$, for a current source).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0113.jpg?height=338&width=763&top_left_y=660&top_left_x=139)

Figure 2.15. Illustrating circuit "loading" as a voltage divider.

#### B. Input and output impedances of emitter followers

As we've stated, the emitter follower is useful for changing impedances of signals or loads. To put it starkly, that's really the whole point of an emitter follower.

Let's calculate the input and output impedances of the emitter follower. In the preceding circuit we consider $R$ to be the load (in practice it sometimes is the load; otherwise the load is in parallel with $R$, but with $R$ dominating the parallel resistance anyway). Make a voltage change $\Delta V_{\mathrm{B}}$ at the base; the corresponding change at the emitter is $\Delta V_{\mathrm{E}}=$ $\Delta V_{\mathrm{B}}$. Then the change in emitter current is

$$
\Delta I_{\mathrm{E}}=\Delta V_{\mathrm{B}} / R,
$$

so

$$
\Delta I_{\mathrm{B}}=\frac{1}{\beta+1} \Delta I_{\mathrm{E}}=\frac{\Delta V_{\mathrm{B}}}{R(\beta+1)}
$$

(using $I_{\mathrm{E}}=I_{\mathrm{C}}+I_{\mathrm{B}}$ ). The input resistance is $\Delta V_{\mathrm{B}} / \Delta I_{\mathrm{B}}$. Therefore

$$
\begin{equation*}
r_{\text {in }}=(\beta+1) R \tag{2.2}
\end{equation*}
$$

The transistor small-signal (or "incremental") current gain

[^58]( $\beta$, or $h_{\mathrm{fe}}$ ) is typically about 100 , so a low-impedance load looks like a much higher impedance at the base; it is easier to drive.

In the preceding calculation we used the changes in the voltages and currents, rather than the steady (dc) values of those voltages (or currents), to arrive at our input resistance $r_{\text {in }}$. Such a "small-signal" analysis is used when the variations represent a possible signal, as in an audio amplifier, riding on a steady dc "bias" (see §2.2.7). Although we indicated changes in voltage and current explicitly (with " $\Delta V$," etc.), the usual practice is to use lowercase symbols for small-signal variations (thus $\Delta V \leftrightarrow v$ ); with this convention the above equation for $\Delta I_{\mathrm{E}}$, for example, would read $i_{\mathrm{E}}=v_{\mathrm{B}} / R$.

The distinction between dc current gain $\left(h_{\mathrm{FE}}\right)$ and smallsignal current gain ( $h_{\mathrm{fe}}$ ) isn't always made clear, and the term beta is used for both. That's alright, since $h_{\mathrm{fe}} \approx h_{\mathrm{FE}}$ (except at very high frequencies), and you never assume you know them accurately, anyway.

Although we used resistances in the preceding derivation, we could generalize to complex impedances by allowing $\Delta V_{\mathrm{B}}, \Delta I_{\mathrm{B}}$, etc., to become complex numbers. We would find that the same transformation rule applies for impedances:

$$
\begin{equation*}
\mathbf{Z}_{\mathrm{in}}=(\beta+1) \mathbf{Z}_{\text {load }} \tag{2.3}
\end{equation*}
$$

We could do a similar calculation to find that the output impedance $\mathbf{Z}_{\text {out }}$ of an emitter follower (the impedance looking into the emitter) driven from a source of internal impedance $\mathbf{Z}_{\text {source }}$ is given by

$$
\begin{equation*}
\mathbf{Z}_{\mathrm{out}}=\frac{\mathbf{Z}_{\text {source }}}{\beta+1} \tag{2.4}
\end{equation*}
$$

Strictly speaking, the output impedance of the circuit should also include the parallel resistance of $R$, but in practice $\mathbf{Z}_{\text {out }}$ (the impedance looking into the emitter) dominates.

Exercise 2.4. Show that the preceding relationship is correct. Hint: hold the source voltage fixed and find the change in output current for a given forced change in output voltage. Remember that the source voltage is connected to the base through a series resistor.

Because of these nice properties, emitter followers find application in many situations, e.g., making lowimpedance signal sources within a circuit (or at outputs), making stiff voltage references from higher-impedance references (formed from voltage dividers, say), and generally isolating signal sources from the loading effects of subsequent stages.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0114.jpg?height=386&width=858&top_left_y=205&top_left_x=206)

Figure 2.16. Putting an emitter follower in front of a switch makes it easy for a low-current control signal to switch a high-current load.

Exercise 2.5. Use a follower with the base driven from a voltage divider to provide a stiff source of +5 volts from an available regulated +15 V supply. Load current $(\max )=25 \mathrm{~mA}$. Choose your resistor values so that the output voltage doesn't drop more than 5\% under full load.

#### C. Follower drives switch

Figure 2.16 shows a nice example of an emitter follower rescuing an awkward circuit. We're trying to switch a really bright white LED (the kind you use for "area lighting"), which drops about 3.6 V at its desired 500 mA of forward current. And we've got a $0-3 \mathrm{~V}$ digital logic signal available to control the switch. The first circuit uses a single npn saturated switch, with a base resistor sized to produce 10 mA of base current, and a $2.5 \Omega$ current-limiting resistor in series with the LED.

This circuit is OK, sort of. But it draws an uncomfortably large current from the control input; and it requires $Q_{1}$ to have plenty of current gain at the full load current of 0.5 A . In the second circuit (Figure 2.16B) an emitter follower has come to the rescue, greatly reducing the input current (because of its current gain), and at the same time relaxing the minimum beta requirement of the switch $\left(Q_{3}\right)$. To be fair, we should point out that a low-threshold MOSFET provides an even simpler solution here; we'll tell you how, in Chapters 3 and 12.

#### D. Important points about followers

Current flow in one direction only. Notice (\$2.1.1, rule 4) that in an emitter follower the npn transistor can only source (as opposed to sink) current. For instance, in the loaded circuit shown in Figure 2.17 the output can swing to within a transistor saturation voltage drop of $V_{\mathrm{CC}}$ (about +9.9 V ), but it cannot go more negative than -5 volts. That is because on the extreme negative swing, the transistor can do no better than to turn off completely, which it does at -4.4 volts input ( -5 V out-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0114.jpg?height=346&width=369&top_left_y=220&top_left_x=1262)

Figure 2.17. An npn emitter follower can source plenty of current through the transistor, but can sink limited current only through its emitter resistor.
put, set by the divider formed by the load and emitter resistors). Further negative swing at the input results in back-biasing of the base-emitter junction, but no further change in output. The output, for a 10 volt amplitude sinewave input, looks as shown in Figure 2.18.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0114.jpg?height=231&width=683&top_left_y=971&top_left_x=1133)

Figure 2.18. Illustrating the asymmetrical current drive capability of the $n p n$ emitter follower.

Another way to view the problem is to say that the emitter follower has a low value of small-signal output impedance, whereas its large-signal output impedance is much higher (as large as $R_{\mathrm{E}}$ ). The output impedance changes over from its small-signal value to its largesignal value at the point where the transistor goes out of the active region (in this case at an output voltage of -5 V ). To put this point another way, a low value of small-signal output impedance doesn't necessarily mean that the circuit can generate large signal swings into a low resistance load. A low small-signal output impedance doesn't imply a large output current capability.

Possible solutions to this problem involve either decreasing the value of the emitter resistor (with greater power dissipation in resistor and transistor), using a pnp transistor (if all signals are negative only), or using a "push-pull" configuration, in which two complementary transistors (one npn, one pnp) are used (§2.4.1). This sort of problem can also come up when the load that an emitter follower is driving contains voltage or current sources of its own, and thus can force a current in the "wrong" direction. This happens most often with
regulated power supplies (the output is usually an emitter follower) driving a circuit that has other power supplies.
Base-emitter breakdown. Always remember that the base-emitter reverse breakdown voltage for silicon transistors is small, quite often as little as 6 volts. Input swings large enough to take the transistor out of conduction can easily result in breakdown (causing permanent degradation of current gain $\beta$ ) unless a protective diode is added (Figure 2.19).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0115.jpg?height=262&width=287&top_left_y=647&top_left_x=415)

Figure 2.19. A diode prevents base-emitter reverse voltage breakdown.

Gain is slightly less than unity. The voltage gain of an emitter follower is actually slightly less than 1.0 , because the base-emitter voltage drop is not really constant, but depends slightly on collector current. You will see how to handle that later in the chapter, when we have the Ebers-Moll equation.

### 2.2.4 Emitter followers as voltage regulators

The simplest regulated supply of voltage is simply a zener (Figure 2.20). Some current must flow through the zener, so you choose

$$
\frac{V_{\mathrm{in}}(\min )-V_{\text {out }}}{R}>I_{\mathrm{out}}(\max ) .
$$

Because $V_{\text {in }}$ isn't regulated, you use the lowest value of $V_{\text {in }}$ that might occur. Designing for satisfactory operation under the worst combination (here minimum $V_{\text {in }}$ and maximum $I_{\text {out }}$ ) is known as "worst-case" design. In practice, you would also worry about component tolerances, linevoltage limits, etc., designing to accommodate the worst possible combination that would ever occur.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0115.jpg?height=234&width=553&top_left_y=2003&top_left_x=244)

Figure 2.20. Simple zener voltage regulator.

The zener must be able to dissipate

$$
P_{\text {zener }}=\left(\frac{V_{\mathrm{in}}-V_{\mathrm{out}}}{R}-I_{\mathrm{out}}\right) V_{\text {zener }}
$$

Again, for worst-case design, you would use $V_{\text {in }}(\max )$ and $I_{\text {out }}$ (min).

Exercise 2.6. Design a +10 V̇ regulated supply for load currents from 0 to 100 mA ; the input voltage is +20 to +25 V . Allow at least 10 mA zener current under all (worst-case) conditions. What power rating must the zener have?

This simple zener-regulated supply is sometimes used for noncritical circuits or circuits using little supply current. However, it has limited usefulness, for several reasons:

- $V_{\text {out }}$ isn't adjustable or settable to a precise value.
- Zener diodes give only moderate ripple rejection and regulation against changes of input or load, owing to their finite dynamic impedance.
- For widely varying load currents a high-power zener is often necessary to handle the dissipation at low load current. ${ }^{16}$

By using an emitter follower to isolate the zener, you get the improved circuit shown in Figure 2.21. Now the situation is much better. Zener current can be made relatively independent of load current, since the transistor base current is small, and far lower zener power dissipation is possible (reduced by as much as a factor of $\beta$ ). The collector resistor $R_{\mathrm{C}}$ can be added to protect the transistor from momentary output short circuits by limiting the current, even though it is not essential to the emitter follower function. Choose $R_{\mathrm{C}}$ so that the voltage drop across it is less than the drop across $R$ for the highest normal load current (i.e., so that the transistor does not saturate at maximum load).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0115.jpg?height=330&width=506&top_left_y=1687&top_left_x=1119)

Figure 2.21. Zener regulator with follower, for increased output current. $R_{\mathrm{C}}$ protects the transistor by limiting maximum output current.

[^59]Exercise 2.7. Design a +10 V supply with the same specifications as in Exercise 2.6. Use a zener and emitter follower. Calculate worst-case dissipation in transistor and zener. What is the percentage change in zener current from the no-load condition to full load? Compare with your previous circuit.

A nice variation of this circuit aims to eliminate the effect of ripple current (through $R$ ) on the zener voltage by supplying the zener current from a current source, which is the subject of §2.2.6. An alternative method uses a lowpass filter in the zener bias circuit (Figure 2.22). $R$ is chosen such that the series pair provides sufficient zener current. Then $C$ is chosen large enough so that $R C \gg 1 / f_{\text {ripple }} \cdot{ }^{17}$.

Later you will see better voltage regulators, ones in which you can vary the output easily and continuously by using feedback. They are also better voltage sources, with output impedances measured in milliohms, temperature coefficients of a few parts per million per degree centigrade, and other desirable features.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0116.jpg?height=430&width=501&top_left_y=974&top_left_x=369)

Figure 2.22. Reducing ripple in the zener regulator.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0116.jpg?height=399&width=481&top_left_y=1520&top_left_x=382)

Figure 2.23. Biasing an emitter follower from a previous stage.

### 2.2.5 Emitter follower biasing

When an emitter follower is driven from a preceding stage in a circuit, it is usually OK to connect its base directly to the previous stage's output, as shown in Figure 2.23.

[^60]Because the signal on $Q_{1}$ 's collector is always within the range of the power supplies, $Q_{2}$ 's base will be between $V_{\mathrm{CC}}$ and ground, and therefore $Q_{2}$ is in the active region (neither cut off nor saturated), with its base-emitter diode in conduction and its collector at least a few tenths of a volt more positive than its emitter. Sometimes, though, the input to a follower may not be so conveniently situated with respect to the supply voltages. A typical example is a capacitively coupled (or ac-coupled) signal from some external source (e.g., an audio signal input to a stereo amplifier). In that case the signal's average voltage is zero, and direct coupling to an emitter follower will give an output like that in Figure 2.24.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0116.jpg?height=331&width=781&top_left_y=809&top_left_x=1079)

Figure 2.24. A transistor amplifier powered from a single positive supply cannot generate negative voltage swings at the transistor output terminal.

It is necessary to bias the follower (in fact, any transistor amplifier) so that collector current flows during the entire signal swing. In this case a voltage divider is the simplest way (Figure 2.25). $R_{1}$ and $R_{2}$ are chosen to put the base halfway between ground and $V_{\mathrm{CC}}$ when there is no input signal, i.e., $R_{1}$ and $R_{2}$ are approximately equal. The process of selecting the operating voltages in a circuit, in the absence of applied signals, is known as setting the quiescent point. In this case, as in most cases, the quiescent point is chosen to allow maximum symmetrical signal swing of the output waveform without clipping (flattening of the top or bottom of the waveform). What values should $R_{1}$ and $R_{2}$ have? Applying our general principle ( $\S 1.2 .5 \mathrm{~A}$, $\S 2.2 .3 \mathrm{~A}$ ), we make the impedance of the dc bias source (the impedance looking into the voltage divider) small compared with the load it drives (the dc impedance looking into the base of the follower). In this case,

$$
R_{1} \| R_{2} \ll \beta R_{\mathrm{E}}
$$

This is approximately equivalent to saying that the current flowing in the voltage divider should be large compared with the current drawn by the base.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0117.jpg?height=371&width=603&top_left_y=223&top_left_x=247)

Figure 2.25. An ac-coupled emitter follower. Note base bias voltage divider.

#### A. Emitter follower design example

As an actual design example, let's make an emitter follower for audio signals $(20 \mathrm{~Hz}$ to 20 kHz$) . V_{\mathrm{CC}}$ is +15 V , and quiescent current is to be 1 mA .

Step 1. Choose $V_{E}$. For the largest possible symmetrical swing without clipping, $V_{\mathrm{E}}=0.5 V_{\mathrm{CC}}$, or +7.5 volts.

Step 2. Choose $R_{\mathrm{E}}$. For a quiescent current of 1 mA , $R_{\mathrm{E}}=7.5 \mathrm{k}$.

Step 3. Choose $R_{1}$ and $R_{2} . V_{\mathrm{B}}$ is $V_{\mathrm{E}}+0.6 \mathrm{~V}$, or 8.1 V . This determines the ratio of $R_{1}$ to $R_{2}$ as $1: 1.17$. The preceding loading criterion requires that the parallel resistance of $R_{1}$ and $R_{2}$ be about 75 k or less (one-tenth of $7.5 \mathrm{k} \times \beta$ ). Suitable standard values are $R_{1}=130 \mathrm{k}, R_{2}=150 \mathrm{k}$.

Step 4. Choose $C_{1}$. The capacitor $C_{1}$ forms a highpass filter with the impedance it sees as a load, namely the impedance looking into the base in parallel with the impedance looking into the base voltage divider. If we assume that the load this circuit will drive is large compared with the emitter resistor, then the impedance looking into the base is $\beta R_{\mathrm{E}}$, about 750 k . The divider looks like 70 k . So the capacitor sees a load of about 63 k , and it should have a value of at least $0.15 \mu \mathrm{~F}$ so that the 3 dB point will be below the lowest frequency of interest, 20 Hz .

Step 5. Choose $C_{2}$. The capacitor $C_{2}$ forms a highpass filter in combination with the load impedance, which is unknown. However, it is safe to assume that the load impedance won't be smaller than $R_{\mathrm{E}}$, which gives a value for $C_{2}$ of at least $1.0 \mu \mathrm{~F}$ to put the 3 dB point below 20 Hz . Because there are now two cascaded highpass filter sections, the capacitor values should be increased somewhat to prevent excessive attenuation (reduction of signal amplitude, in this case 6 dB ) at the lowest frequency of interest. $C_{1}=0.47 \mu \mathrm{~F}$ and $C_{2}=3.3 \mu \mathrm{~F}$ might be good choices. ${ }^{18}$

[^61]From our simple transistor model, the output impedance at the emitter is just $\mathbf{Z}_{\text {out }}=R_{\mathrm{E}} \|\left[\left(\mathbf{Z}_{\text {in }}\left\|R_{1}\right\| R_{2}\right) / \beta\right]$, where $\mathbf{Z}_{\text {in }}$ is the (Thévenin) output resistance of the signal that drives this circuit. So, taking $\beta \approx 100$, a signal source with $10 \mathrm{k} \Omega$ output resistance would result in an output impedance (at the emitter) of about $87 \Omega$. As we'll see later in the chapter (§2.3), there's an effect (the intrinsic emitter impedance, $r_{\mathrm{e}}$ ) that adds an additional resistance of $0.025 / I_{\mathrm{E}}$ effectively in series with the emitter; so the output impedance here (with $10 \mathrm{k} \Omega$ source) would be about $110 \Omega$.

#### B. Followers with split supplies

Because signals often are "near ground," it is convenient to use symmetrical positive and negative supplies. This simplifies biasing and eliminates coupling capacitors (Figure 2.26).
Warning: you must always provide a dc path for base bias current, even if it goes only to ground. In this circuit it is assumed that the signal source has a dc path to ground. If not (e.g., if the signal is capacitively coupled), you must provide a resistor to ground (Figure 2.27). $R_{\mathrm{B}}$ could be about one-tenth of $\beta R_{\mathrm{E}}$, as before.

Exercise 2.8. Design an emitter follower with $\pm 15 \mathrm{~V}$ supplies to operate over the audio range ( 20 Hz to 20 kHz ). Use 5 mA quiescent current and capacitive input coupling.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0117.jpg?height=309&width=539&top_left_y=1376&top_left_x=1103)

Figure 2.26. A dc-coupled emitter follower with split supply.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0117.jpg?height=353&width=545&top_left_y=1831&top_left_x=1151)

Figure 2.27. Always provide a dc bias path.

#### C. Bad biasing

You sometimes see sadness-inducing circuits like the disaster shown in Figure 2.28. The designer chose $R_{\mathrm{B}}$ by assuming a particular value for beta (100), estimating the base current, and then hoping for a 7 V drop across $R_{\mathrm{B}}$. This is a bad design; beta is not a good parameter and will vary considerably. By using voltage biasing with a stiff voltage divider, as in the detailed example presented earlier, the quiescent point is insensitive to variations in transistor beta. For instance, in the previous design example the emitter voltage will increase by only $0.35 \mathrm{~V}(5 \%)$ for a transistor with $\beta=200$ instead of the nominal $\beta=100$. And, as with this emitter follower example, it is just as easy to fall into this trap and design bad transistor circuits in the other transistor configurations (notably the common-emitter amplifier, which we will treat later in this chapter).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0118.jpg?height=414&width=455&top_left_y=928&top_left_x=426)

Figure 2.28. Don't do this!

#### D. Cancelling the offset -I

Wouldn't it be nice if an emitter follower did not cause an offset of the output signal by the $V_{\mathrm{BE}} \approx 0.6 \mathrm{~V}$ base-emitter drop? Figure 2.29 shows how to cancel the dc offset, by cascading a pnp follower (which has a positive $V_{\mathrm{BE}}$ offset) with an $n p n$ follower (which has a comparable negative $V_{\mathrm{BE}}$ offset). Here we've configured the circuit with $\pm 10 \mathrm{~V}$ symmetrical split supplies; and we've used equal-value emitter resistors so that the two transistors have a comparable quiescent current for an input signal near 0 V .

This is a nice trick, useful to know about and often helpful. But the cancellation isn't perfect, for reasons we'll see later in the chapter ( $V_{\mathrm{BE}}$ depends somewhat on collector current, and on transistor size, §2.3), and again in Chapter 5. But, as we'll see in Chapter 4, it is in fact rather easy to make a follower, using operational amplifiers, with nearly perfect zero offset ( $10 \mu \mathrm{~V}$ or less); and as a bonus you get input impedances in the gigaohms (or more), input currents in the nanoamps (or less), and output impedances
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0118.jpg?height=393&width=705&top_left_y=209&top_left_x=1117)

Figure 2.29. Cascading a pnp and an npn follower produces approximate cancellation of the $V_{\mathrm{BE}}$ offsets.
measured in fractions of an ohm. Take a look ahead at Chapter 4.

### 2.2.6 Current source

Current sources, although often neglected, are as important and as useful as voltage sources. They often provide an excellent way to bias transistors, and they are unequaled as "active loads" for super-gain amplifier stages and as emitter sources for differential amplifiers. Integrators, sawtooth generators, and ramp generators need current sources. They provide wide-voltage-range pullups within amplifier and regulator circuits. And, finally, there are applications in the outside world that require constant current sources, e.g., electrophoresis or electrochemistry.

#### A. Resistor plus voltage source

The simplest approximation to a current source is shown in Figure 2.30. As long as $R_{\text {load }} \ll R$ (in other words, $V_{\text {load }} \ll$ $V$ ), the current is nearly constant and is approximately

$$
I \approx V / R
$$

The load doesn't have to be resistive. A capacitor will charge at a constant rate, as long as $V_{\text {cap }} \ll V$; this is just the first part of the exponential charging curve of an $R C$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0118.jpg?height=221&width=475&top_left_y=1813&top_left_x=1237)

Figure 2.30. Current-source approximation.
There are several drawbacks to a simple resistor current source. To make a good approximation to a current source, you must use large voltages, with lots of power dissipation in the resistor. In addition, the current isn't easily
programmable, i.e., controllable over a large range by means of a voltage somewhere else in the circuit.

Exercise 2.9. If you want a current source constant to $1 \%$ over a load voltage range of 0 to +10 volts, how large a voltage source must you use in series with a single resistor?

Exercise 2.10. Suppose you want a 10 mA current in the preceding problem. How much power is dissipated in the series resistor? How much gets to the load?

#### B. Transistor current source

Happily, it is possible to make a very good current source with a transistor (Figure 2.31). It works like this: applying $V_{\mathrm{B}}$ to the base, with $V_{\mathrm{B}}>0.6 \mathrm{~V}$, ensures that the emitter is always conducting:

$$
V_{\mathrm{E}}=V_{\mathrm{B}}-0.6 \text { volts. }
$$

So

$$
I_{\mathrm{E}}=V_{\mathrm{E}} / R_{\mathrm{E}}=\left(V_{\mathrm{B}}-0.6 \text { volts }\right) / R_{\mathrm{E}}
$$

But, since $I_{\mathrm{E}} \approx I_{\mathrm{C}}$ for large beta,

$$
\begin{equation*}
I_{\mathrm{C}} \approx\left(V_{\mathrm{B}}-0.6 \text { volts }\right) / R_{\mathrm{E}}, \tag{2.5}
\end{equation*}
$$

independent of $V_{C}$, as long as the transistor is not saturated ( $V_{\mathrm{C}} \gtrsim V_{\mathrm{E}}+0.2$ volts).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0119.jpg?height=533&width=286&top_left_y=1323&top_left_x=380)

Figure 2.31. Transistor current source: basic concept.

#### C. Current-source biasing

The base voltage can be provided in a number of ways. A voltage divider is OK , as long as it is stiff enough. As before, the criterion is that its impedance should be much less than the dc impedance looking into the base ( $\beta R_{\mathrm{E}}$ ). Or you can use a zener diode (or a two-terminal IC reference like the LM385), biased from $V_{\mathrm{CC}}$, or even a few forward-
biased diodes ${ }^{19}$ in series from base to the corresponding emitter supply. Figure 2.32 shows some examples. In the last example (Figure 2.32C), a pnp transistor sources current to a load returned to ground. The other examples (using $n p n$ transistors) should properly be called current sinks, but the usual practice is to refer to them all loosely as "current sources." ${ }^{20}$ In the first circuit, the voltage-divider impedance of $\sim 1.3 \mathrm{k}$ is stiff compared with the impedance looking into the base of about 100 k (for $\beta=100$ ), so any changes in beta with collector voltage will not much affect the output current by causing the base voltage to change. In the other two circuits the biasing resistors are chosen to provide several milliamps to bring the diodes into conduction.

#### D. Compliance

A current source can provide constant current to the load only over some finite range of load voltage. To do otherwise would be equivalent to providing infinite power. The output voltage range over which a current source behaves well is called its output compliance. For the preceding transistor current sources, the compliance is set by the requirement that the transistors stay in the active region. Thus in the first circuit the voltage at the collector can go down until the transistor is almost in saturation, perhaps +1.1 V at the collector. The second circuit, with its higher emitter voltage, can sink current down to a collector voltage of about +5.1 V .

In all cases the collector voltage can range from a value near saturation all the way up to the supply voltage. For example, the last circuit can source current to the load for any voltage between zero and about +8.6 V across the load. In fact, the load might even contain batteries or power supplies of its own, which could carry the collector beyond the supply voltage (Figure 2.32A,B) or below ground (Figure 2.32 C ). That's OK , but you must watch out for transistor breakdown ( $V_{\mathrm{CE}}$ must not exceed $B V_{\mathrm{CEO}}$, the specified collector-emitter breakdown voltage) and also for excessive power dissipation (set by $I_{\mathrm{C}} V_{\mathrm{CE}}$ ). As you will see in $\S \S 3.5 .1 \mathrm{~B}, 3.6 .4 \mathrm{C}$, and 9.4 .2 , there is an additional safe-operating-area constraint on power transistors.
Exercise 2.11. You have +5 and +15 V regulated supplies available in a circuit. Design a 5 mA npn current sink using the +5 V to bias the base. What is the output compliance?

[^62]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0120.jpg?height=485&width=1458&top_left_y=204&top_left_x=317)

Figure 2.32. Transistor current-source circuits, illustrating three methods of base biasing; npn transistors sink current, whereas pnp transistors source current. The circuit in C illustrates a load returned to ground. See also Figure 3.26.

A current source doesn't have to have a fixed voltage at the base. By varying $V_{\mathrm{B}}$ you get a voltage-programmable current source. The input signal swing $v_{\text {in }}$ (recall that lowercase symbols mean variations) must stay small enough so that the emitter voltage never drops to zero, if the output current is to reflect input-voltage variations smoothly. The result will be a current source with variations in output current proportional to the variations in input voltage, $i_{\text {out }}=v_{\text {in }} / R_{\mathrm{E}}$. This is the basis of the amplifier we'll see next (§2.2.7).

#### E. Cancelling the offset - II

It's a minor drawback of these current source circuits that you have to apply a base voltage that is offset by $V_{\mathrm{BE}} \approx$ 0.6 V from the voltage that you want to appear across the emitter resistor; and it is of course the latter that sets the output current. It's the same offset issue as with an emitter follower; and you can use the same trick (§2.2.5D) to bring about approximate cancellation of the offset in situations in which that is a problem.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0120.jpg?height=430&width=598&top_left_y=1693&top_left_x=323)

Figure 2.33. Compensating the $V_{\mathrm{BE}}$ drop in a current source.
Look at Figure 2.33. It has our standard current-source output stage $Q_{2}$, with the current set by the voltage across the emitter resistor: $I_{L}=V_{\mathrm{E}} / R_{2}$. So $Q_{2}$ 's base needs to be
a $V_{\mathrm{BE}}$ higher (the offset), but that's just what the pnp input follower does anyway. So, voilà, the voltage at $Q_{2}$ 's emitter winds up being approximately equal to $V_{\text {in }}$ that you apply; and so the output current is simply $I_{\mathrm{L}}=V_{\text {in }} / R_{2}$, with no ifs, ands, buts, or $V_{\mathrm{BE}}$ offsets. Cute!

We hasten to point out, though, that this is not a particularly accurate cancellation, because the two transistors will in general have different collector currents, and therefore somewhat different base-emitter drops (§2.3). But it's a first-order hack, and a lot better than nothing. And, once again, the magic of operational amplifiers (Chapter 4) will provide a way to make current sources in which the output current is accurately programmed by an input voltage, without that pesky $V_{\mathrm{BE}}$ offset.

#### F. Deficiencies of current sources

These transistor current-source circuits perform well, particularly when compared with a simple resistor biased from a fixed voltage (Figure 2.30). When you look closely, though, you find that they do depart from the ideal at some level of scrutiny - that is, the load current does show some (relatively small) variation with voltage. Another way to say the same thing is that the current source has a finite $\left(R_{\mathrm{Th}}<\infty\right)$ Thévenin equivalent resistance.

We discuss the causes of these deficiencies, and some very clever circuit fixes, later in the chapter, and also in Chapter 2x.

### 2.2.7 Common-emitter amplifier

Consider a current source with a resistor as load (Figure 2.34). The collector voltage is

$$
V_{\mathrm{C}}=V_{\mathrm{CC}}-I_{\mathrm{C}} R_{\mathrm{C}}
$$

We could capacitively couple a signal to the base to cause the collector voltage to vary. Consider the example in
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0121.jpg?height=348&width=299&top_left_y=221&top_left_x=371)

Figure 2.34. Current source driving a resistor as load: an amplifier!

Figure 2.35. Blocking capacitor $C$ is chosen so that all frequencies of interest are passed by the highpass filter it forms in combination with the parallel resistance of the base biasing resistors ${ }^{21}$; that is,

$$
C \geq \frac{1}{2 \pi f\left(R_{1} \| R_{2}\right)} .
$$

The quiescent collector current is 1.0 mA because of the applied base bias and the 1.0 k emitter resistor. That current puts the collector at +10 volts ( +20 V , minus 1.0 mA through 10k). Now imagine an applied wiggle in base voltage $v_{\mathrm{B}}$. The emitter follows with $v_{\mathrm{E}}=v_{\mathrm{B}}$, which causes a wiggle in emitter current

$$
i_{\mathrm{E}}=v_{\mathrm{E}} / R_{\mathrm{E}}=v_{\mathrm{B}} / R_{\mathrm{E}}
$$

and nearly the same change in collector current ( $\beta$ is large). So the initial wiggle in base voltage finally causes a collector voltage wiggle

$$
v_{\mathrm{C}}=-i_{\mathrm{C}} R_{\mathrm{C}}=-v_{\mathrm{B}}\left(R_{\mathrm{C}} / R_{\mathrm{E}}\right)
$$

Aha! It's a voltage amplifier, with a voltage amplification (or "gain") given by

$$
\begin{equation*}
\text { gain }=v_{\text {out }} / v_{\mathrm{in}}=-R_{\mathrm{C}} / R_{\mathrm{E}} \tag{2.6}
\end{equation*}
$$

In this case the gain is $-10,000 / 1000$, or -10 . The minus sign means that a positive wiggle at the input gets turned into a negative wiggle ( 10 times as large) at the output. This is called a common-emitter amplifier with emitter degeneration.

#### A. Input and output impedances of the common-emitter amplifier

We can easily determine the input and output impedances of the amplifier. The input signal sees, in parallel, 110 k , 10 k , and the impedance looking into the base. The latter is

[^63]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0121.jpg?height=450&width=592&top_left_y=219&top_left_x=1079)

Figure 2.35. An ac common-emitter amplifier with emitter degeneration. Note that the output terminal is the collector rather than the emitter.
about 100 k ( $\beta$ times $R_{\mathrm{E}}$ ), so the input impedance (dominated by the 10 k ) is about 8 k . The input coupling capacitor thus forms a highpass filter, with the 3 dB point at 200 Hz . The signal driving the amplifier sees $0.1 \mu \mathrm{~F}$ in series with 8 k , which to signals of normal frequencies (well above the 3 dB point) just looks like 8 k .

The output impedance is 10 k in parallel with the impedance looking into the collector. What is that? Well, remember that if you snip off the collector resistor, you're simply looking into a current source. The collector impedance is very large (measured in megohms), and so the output impedance is just the value of the collector resistor, 10k. It is worth remembering that the impedance looking into a transistor's collector is high, whereas the impedance looking into the emitter is low (as in the emitter follower). Although the output impedance of a commonemitter amplifier will be dominated by the collector load resistor, the output impedance of an emitter follower will not be dominated by the emitter load resistor, but rather by the impedance looking into the emitter.

### 2.2.8 Unity-gain phase splitter

Sometimes it is useful to generate a signal and its inverse, i.e., two signals $180^{\circ}$ out of phase. That's easy to do - just use an emitter-degenerated amplifier with a gain of -1 (Figure 2.36). The quiescent collector voltage is set to $0.75 V_{\mathrm{CC}}$, rather than the usual $0.5 V_{\mathrm{CC}}$, in order to achieve the same result - maximum symmetrical output swing without clipping at either output. The collector can swing from $0.5 V_{\mathrm{CC}}$ to $V_{\mathrm{CC}}$, whereas the emitter can swing from ground to $0.5 V_{\mathrm{CC}}$.

Note that the phase-splitter outputs must be loaded with equal (or very high) impedances at the two outputs to maintain gain symmetry.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0122.jpg?height=452&width=550&top_left_y=218&top_left_x=345)

Figure 2.36. Unity-gain phase splitter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0122.jpg?height=319&width=432&top_left_y=792&top_left_x=401)

Figure 2.37. Constant-amplitude phase shifter.

#### A. Phase shifter

A nice use of the phase splitter is shown in Figure 2.37. This circuit gives (for a sinewave input) an output sinewave of adjustable phase (from zero to $180^{\circ}$ ) and with constant amplitude. It can be best understood with a phasor diagram of voltages (\$1.7.12); with the input signal represented by a unit vector along the real axis, the signals look as shown in Figure 2.38.

Signal vectors $\mathbf{v}_{\mathrm{R}}$ and $\mathbf{v}_{\mathrm{C}}$ must be at right angles, and they must add to form a vector of constant length along the real axis. There is a theorem from geometry that says that the locus of such points is a circle. So the resultant vector (the output voltage) always has unit length, i.e., the same amplitude as the input, and its phase can vary from nearly zero to nearly $180^{\circ}$ relative to the input wave as $R$ is varied from nearly zero to a value much larger than $X_{C}$ at the operating frequency. However, note that the phase shift depends on the frequency of the input signal for a given setting of the potentiometer $R$. It is worth noting that a simple $R C$ highpass (or lowpass) network could also be used as an adjustable phase shifter. However, its output amplitude would vary over an enormous range as the phase shift was adjusted.

An additional concern here is the ability of the phasesplitter circuit to drive the $R C$ phase shifter as a load. Ideally, the load should present an impedance that is large
compared with the collector and emitter resistors. As a result, this circuit is of limited utility where a wide range of phase shifts is required. You will see improved phasesplitter techniques in Chapter 4, where we use op-amps as impedance buffers, and in Chapter 7, where a cascade of several phase-shifter sections generates a set of "quadrature" signals that extends the phase-shifting range to a full $0^{\circ}$ to $360^{\circ}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0122.jpg?height=452&width=697&top_left_y=585&top_left_x=1121)

Figure 2.38. Phasor diagram for phase shifter, for which $\theta=$ $2 \arctan (\omega R C)$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0122.jpg?height=427&width=580&top_left_y=1195&top_left_x=1179)

Figure 2.39. The common-emitter amplifier is a transconductance stage driving a (resistive) load.

### 2.2.9 Transconductance

In the preceding section we figured out the operation of the emitter-degenerated amplifier by (a) imagining an applied base voltage swing and seeing that the emitter voltage had the same swing, then (b) calculating the emitter current swing; then, ignoring the small base current contribution, we got the collector current swing and thus (c) the collector voltage swing. The voltage gain was then simply the ratio of collector (output) voltage swing to base (input) voltage swing.

There's another way to think about this kind of amplifier. Imagine breaking it apart, as in Figure 2.39. The first
part is a voltage-controlled current source, with quiescent current of 1.0 mA and gain of $-1 \mathrm{~mA} / \mathrm{V}$. Gain means the ratio of output to input; in this case the gain has units of current/voltage, or 1/resistance. The inverse of resistance is called conductance. ${ }^{22}$ An amplifier whose gain has units of conductance is called a transconductance amplifier; the ratio of changes $\Delta I_{\text {out }} / \Delta V_{\text {in }}$ (usually written with smallsignal changes indicated in lowercase: $i_{\text {out }} / v_{\text {in }}$ ) is called the transconductance, $g_{m}$ :

$$
\begin{equation*}
g_{m}=\frac{\Delta I_{\text {out }}}{\Delta V_{\text {in }}}=\frac{i_{\text {out }}}{v_{\text {in }}} . \tag{2.7}
\end{equation*}
$$

Think of the first part of the circuit as a transconductance amplifier, i.e., a voltage-to-current amplifier with transconductance $g_{m}$ (gain) of $-1 \mathrm{~mA} / \mathrm{V}(1000 \mu \mathrm{~S}$, or 1 mS , which is just $1 / R_{\mathrm{E}}$ ). The second part of the circuit is the load resistor, an "amplifier" that converts current to voltage. This resistor could be called a transresistance converter, and its gain $\left(r_{m}\right)$ has units of voltage/current, or resistance. In this case its quiescent voltage is $V_{\mathrm{CC}}$, and its gain (transresistance) is $10 \mathrm{~V} / \mathrm{mA}$ ( $10 \mathrm{k} \Omega$ ), which is just $R_{\mathrm{C}}$. Connecting the two parts together gives you a voltage amplifier. You get the overall gain by multiplying the two gains. In this case the voltage gain $G_{V}=g_{m} R_{\mathrm{C}}=-R_{\mathrm{C}} / R_{\mathrm{E}}$, or -10 , a unitless number equal to the ratio (output voltage change)/(input voltage change).

This is a useful way to think about an amplifier, because you can analyze performance of the sections independently. For example, you can analyze the transconductance part of the amplifier by evaluating $g_{m}$ for different circuit configurations or even different devices, such as field-effect transistors FETs. Then you can analyze the transresistance (or load) part by considering gain versus voltage swing tradeoffs. If you are interested in the overall voltage gain, it is given by $G_{\mathrm{V}}=g_{m} r_{m}$, where $r_{m}$ is the transresistance of the load. Ultimately the substitution of an active load (current source), with its extremely high transresistance, can yield single-stage voltage gains of 10,000 or more. The cascode configuration, which we will discuss later, is another example easily understood with this approach.

In Chapter 4, which deals with operational amplifiers, you will see further examples of amplifiers with voltages or currents as inputs or outputs: voltage amplifiers (voltage to voltage), current amplifiers (current to current), and transresistance amplifiers (current to voltage).

[^64]
#### A. Turning up the gain: limitations of the simple model

The voltage gain of the emitter-degenerated amplifier is $-R_{\mathrm{C}} / R_{\mathrm{E}}$, according to our model. What happens as $R_{\mathrm{E}}$ is reduced toward zero? The equation predicts that the gain will rise without limit. But if we made actual measurements of the preceding circuit, keeping the quiescent current constant at 1 mA , we would find that the gain would level off at about 400 when $R_{\mathrm{E}}$ is zero, i.e., with the emitter grounded. We would also find that the amplifier would become significantly nonlinear (the output would not be a faithful replica of the input), the input impedance would become small and nonlinear, and the biasing would become critical and unstable with temperature. Clearly our transistor model is incomplete and needs to be modified to handle this circuit situation, as well as others we will talk about presently. Our fixed-up model, which we will call the transconductance model, will be accurate enough for the remainder of the book.

#### B. Recap: the "four topologies"

Before jumping into the complexity just ahead, let's remind ourselves of the four transistor circuits we've seen, namely the switch, emitter follower, current source, and commonemitter amplifier. We've drawn these very schematically in Figure 2.40, omitting details like biasing, and even the polarity of transistor (i.e., $n p n$ or $p n p$ ). For completeness we've included also a fifth circuit, the common-base amplifier, which we'll meet soon enough (§2.4.5B).

## 2.3 Ebers-Moll model applied to basic transistor circuits

We've enjoyed seeing some nice feats that can be accomplished with the simplest BJT model - switch, follower, current source, amplifier - but we've run up against some serious limitations (hey, would you believe, infinite gain?!). Now it's time to go a level deeper, to address these limitations. The material that follows will suffice for our purposes. And - good news - for many BJT applications the simple model you've already seen is completely adequate.

### 2.3.1 Improved transistor model: transconductance amplifier

The important change is in rule 4 (\$2.1.1), where we said earlier that $I_{\mathrm{C}}=\beta I_{\mathrm{B}}$. We thought of the transistor as a current amplifier whose input circuit behaved like a diode. That's roughly correct, and for some applications it's good enough. But to understand differential amplifiers,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0124.jpg?height=417&width=1284&top_left_y=215&top_left_x=404)

Figure 2.40. Five basic transistor circuits. Fixed voltages (power supplies or ground) are indicated by connections to horizontal line segments. For the switch, the load may be a resistor, to produce a full-swing voltage output; for the common-emitter amplifier, the emitter resistor may be bypassed or omitted altogether.
logarithmic converters, temperature compensation, and other important applications, you must think of the transistor as a transconductance device - collector current is determined by base-to-emitter voltage.

Here's the modified rule 4.
4. Transconductance amplifier When rules 1-3 (§2.1.1) are obeyed, $I_{\mathrm{C}}$ is related to $V_{\mathrm{BE}}$ by ${ }^{23}$

$$
\begin{equation*}
I_{\mathrm{C}}=I_{\mathrm{S}}(T)\left(e^{V_{\mathrm{BE}} / V_{\mathrm{T}}}-1\right) \tag{2.8}
\end{equation*}
$$

or, equivalently,

$$
\begin{equation*}
V_{\mathrm{BE}}=\frac{k T}{q} \log _{e}\left(\frac{I_{\mathrm{C}}}{I_{\mathrm{S}}(T)}+1\right), \tag{2.9}
\end{equation*}
$$

where

$$
\begin{equation*}
V_{\mathrm{T}}=k T / q=25.3 \mathrm{mV} \tag{2.10}
\end{equation*}
$$

at room temperature $\left(68^{\circ} \mathrm{F}, 20^{\circ} \mathrm{C}\right), q$ is the electron charge ( $1.60 \times 10^{-19}$ coulombs), $k$ is Boltzmann's constant $\left(1.38 \times 10^{-23}\right.$ joules/K, sometimes written $\left.k_{\mathrm{B}}\right), T$ is the absolute temperature in degrees Kelvin $\left(\mathrm{K}={ }^{\circ} \mathrm{C}+273.16\right)$, and $I_{\mathrm{S}}(T)$ is the saturation current of the particular transistor (which depends strongly on temperature, $T$, as we'll see shortly). Then the base current, which also depends on $V_{\mathrm{BE}}$, can be approximated by

$$
I_{\mathrm{B}}=I_{\mathrm{C}} / \beta,
$$

where the "constant" $\beta$ is typically in the range 20 to 1000, but depends on transistor type, $I_{\mathrm{C}}, V_{\mathrm{CE}}$, and temperature. $I_{S}(T)$ approximates the reverse leakage current (roughly $10^{-15} \mathrm{~A}$ for a small-signal transistor like the 2 N 3904 ). In the active region $I_{\mathrm{C}} \gg I_{S}$, and therefore

[^65]the -1 term can be neglected in comparison with the exponential:
\$\$

$$
\begin{equation*}
I_{\mathrm{C}} \approx I_{\mathrm{S}}(T) e^{V_{\mathrm{BE}} / V_{\mathrm{T}}} \tag{2.11}
\end{equation*}
$$

\$\$

The equation for $I_{\mathrm{C}}$ is known as the Ebers-Moll equation. ${ }^{24}$ It also describes approximately the current versus voltage for a diode, if $V_{\mathrm{T}}$ is multiplied by a correction factor $m$ between 1 and 2. For transistors it is important to realize that the collector current is accurately determined by the base-emitter voltage, rather than by the base current (the base current is then roughly determined by $\beta$ ), and that this exponential law is accurate over an enormous range of currents, typically from nanoamps to milliamps. Figure 2.41 makes the point graphically. ${ }^{25}$ If you measure the base current at various collector currents, you will get a graph of $\beta$ versus $I_{C}$ like that in Figure 2.42. Transistor beta versus collector current is discussed further in Chapter $2 x$.

Although the Ebers-Moll equation tells us that the base-emitter voltage "programs" the collector current, this property is not easy to use in practice (biasing a transistor by applying a base voltage) because of the large temperature coefficient of base-emitter voltage. You will see later how the Ebers-Moll equation provides insight and solutions to this problem.

### 2.3.2 Consequences of the Ebers-Moll model: rules of thumb for transistor design

From the Ebers-Moll equation (2.8) we get these simple (but handy) "ratio rules" for collector current: $I_{\mathrm{C} 2} / I_{\mathrm{C} 1}=\exp \left(\Delta V_{\mathrm{BE}} / V_{\mathrm{T}}\right)$ and $\Delta V_{\mathrm{BE}}=V_{\mathrm{T}} \log _{e}\left(I_{\mathrm{C} 2} / I_{\mathrm{C} 1}\right) . \mathrm{We}$

[^66]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0125.jpg?height=631&width=802&top_left_y=205&top_left_x=119)

Figure 2.41. Transistor base and collector currents as functions of base-to-emitter voltage $V_{\mathrm{BE}}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0125.jpg?height=412&width=746&top_left_y=993&top_left_x=150)

Figure 2.42. Typical transistor current gain $(\beta)$ versus collector current.
also get the following important quantities we will be using often in circuit design.

#### A. The steepness of the diode curve.

How much do we need to increase $V_{\mathrm{BE}}$ to increase $I_{\mathrm{C}}$ by a factor of 10 ? From the Ebers-Moll equation, that's just $V_{\mathrm{T}} \log _{e} 10$, or 58.2 mV at room temperature. We like to remember this as base-emitter voltage increases approximately 60 mV per decade of collector current. (Two other formulations: collector current doubles for each 18 mV increase in base-emitter voltage; collector current increases $4 \%$ per millivolt increase in base-emitter voltage.) Equivalently, $I_{\mathrm{C}}=I_{C 0} e^{\Delta V / 25}$, where $\Delta V$ is in millivolts. ${ }^{26}$

[^67]
#### B. The small-signal impedance looking into the emitter, $r_{\mathrm{e}}$, for the base held at a fixed voltage.

Taking the derivative of $V_{\mathrm{BE}}$ with respect to $I_{\mathrm{C}}$, you get

$$
\begin{equation*}
r_{\mathrm{e}}=V_{T} / I_{\mathrm{C}}=25 / I_{\mathrm{C}} \text { ohms, } \tag{2.12}
\end{equation*}
$$

where $I_{\mathrm{C}}$ is in milliamps. ${ }^{27}$ The numerical value $25 / I_{\mathrm{C}}$ is for room temperature. This intrinsic emitter resistance, $r_{\mathrm{e}}$, acts as if it is in series with the emitter in all transistor circuits. It limits the gain of a grounded-emitter amplifier, causes an emitter follower to have a voltage gain of slightly less than unity, and prevents the output impedance of an emitter follower from reaching zero. Note that the transconductance ${ }^{28}$ of a grounded emitter amplifier is just

$$
\begin{equation*}
g_{m}=I_{\mathrm{C}} / V_{\mathrm{T}}=1 / r_{\mathrm{e}}\left(=40 I_{\mathrm{C}} \text { at room temp }\right) \tag{2.13}
\end{equation*}
$$

#### C. The temperature dependence of $V_{\mathrm{BE}}$.

A glance at the Ebers-Moll equation suggests that $V_{\mathrm{BE}}$ (at constant $I_{\mathrm{C}}$ ) has a positive temperature coefficient because of the multiplying factor of $T$ in $V_{\mathrm{T}}$. However, the strong temperature dependence of $I_{\mathrm{S}}(T)$ more than compensates for that term, such that $V_{\mathrm{BE}}$ (at constant $I_{\mathrm{C}}$ ) decreases about $2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$. It is roughly proportional to $1 / T_{\mathrm{abs}}$, where $T_{\mathrm{abs}}$ is the absolute temperature. Sometimes it's useful to cast this instead in terms of the temperature dependence of $I_{\mathrm{C}}$ (at constant $V_{\mathrm{BE}}$ ): I Increases about $9 \% /{ }^{\circ} \mathrm{C}$; it doubles for an $8^{\circ} \mathrm{C}$ rise.

There is one additional quantity we will need on occasion, although it is not derivable from the Ebers-Moll equation. It is known as the Early effect, ${ }^{29}$ and it sets important limits on current-source and amplifier performance.

#### D. Early effect.

$V_{\mathrm{BE}}$ (at constant $I_{\mathrm{C}}$ ) varies slightly with changing $V_{\mathrm{CE}}$. This effect is caused by the variation of effective base width as $V_{\mathrm{CE}}$ changes, and it is given, approximately, by

$$
\begin{equation*}
\Delta V_{\mathrm{BE}}=-\eta \Delta V_{\mathrm{CE}} \tag{2.14}
\end{equation*}
$$

where $\eta \approx 10^{-4}-10^{-5}$. (As an example, the npn 2N5088 has $\eta=1.3 \times 10^{-4}$, thus a 1.3 mV change of $V_{\mathrm{BE}}$ to maintain constant collector current when $V_{\mathrm{CE}}$ changes by 10 V .)
opportunity to make a "silicon thermometer." We'll see more of this in Chapter 2x, and again in Chapter 9.
27 We like to remember the fact that $r_{\mathrm{e}}=25 \Omega$ at a collector current of 1 mA . Then we just scale inversely for other currents: thus $r_{\mathrm{e}}=2.5 \Omega$ at $I_{\mathrm{C}}=10 \mathrm{~mA}$, etc.
${ }^{28}$ At the next level of sophistication we'll see that, since the quantity $r_{\mathrm{e}}$ is proportional to absolute temperature, a grounded emitter amplifier whose collector current is PTAT has transconductance (and gain) independent of temperature. More in Chapter $2 x$.
29 J. M. Early, "Effects of space-charge layer widening in junction transistors," Proc. IRE 40, 1401 (1952). James Early died in 2004.

This is often described instead as a linear increase of collector current with increasing collector voltage when $V_{\mathrm{BE}}$ is held constant; you see it expressed as

$$
\begin{equation*}
I_{\mathrm{C}}=I_{\mathrm{C} 0}\left(1+\frac{V_{\mathrm{CE}}}{V_{\mathrm{A}}}\right) \tag{2.15}
\end{equation*}
$$

where $V_{\mathrm{A}}$ (typically $50-500 \mathrm{~V}$ ) is known as the Early voltage. ${ }^{30}$ This is shown graphically in Figure 2.59 in $\S 2.3 .7 \mathrm{~A}$. A low Early voltage indicates a low collector output resistance; pnp transistors tend to have low $V_{\mathrm{A}}$, see measured values in Table 8.1. We treat the Early effect in more detail in Chapter $2 x .{ }^{31}$

These are the essential quantities we need. With them we will be able to handle most problems of transistor circuit design, and we will have little need to refer to the Ebers-Moll equation itself. ${ }^{32}$

### 2.3.3 The emitter follower revisited

Before looking again at the common-emitter amplifier with the benefit of our new transistor model, let's take a quick look at the humble emitter follower. The EbersMoll model predicts that an emitter follower should have nonzero output impedance, even when driven by a voltage source, because of finite $r_{\mathrm{e}}$ (item B in the above list). The same effect also produces a voltage gain slightly less than unity, because $r_{\mathrm{e}}$ forms a voltage divider with the load resistor.

These effects are easy to calculate. With fixed base voltage, the impedance looking back into the emitter is just $R_{\text {out }}=d V_{\mathrm{BE}} / d I_{\mathrm{E}}$; but $I_{\mathrm{E}} \approx I_{\mathrm{C}}$, so $R_{\text {out }} \approx r_{\mathrm{e}}$, the intrinsic emitter resistance [recall $r_{\mathrm{e}}=25 / I_{\mathrm{C}}(\mathrm{mA})$ ]. For example, in Figure 2.43A, the load sees a driving impedance of $r_{\mathrm{e}}=25 \Omega$, because $I_{\mathrm{C}}=1 \mathrm{~mA}$. (This is paralleled by the emitter resistor $R_{\mathrm{E}}$, if used; but in practice $R_{\mathrm{E}}$ will always be much larger than $r_{\mathrm{e}}$.) Figure 2.43B shows a more typical situation, with finite source resistance $R_{\mathrm{S}}$ (for simplicity we've omitted the obligatory biasing components -

[^68]base divider and blocking capacitor - which are shown in Figure 2.43C). In this case the emitter follower's output impedance is just $r_{\mathrm{e}}$ in series with $R_{\mathrm{S}} /(\beta+1)$ (again paralleled by an unimportant $R_{\mathrm{E}}$, if present). For example, if $R_{\mathrm{s}}=1 \mathrm{k}$ and $I_{\mathrm{C}}=1 \mathrm{~mA}, R_{\text {out }}=35 \Omega$ (assuming $\beta=100$ ). It is easy to show that the intrinsic emitter $r_{\mathrm{e}}$ also figures into an emitter follower's input impedance, just as if it were in series with the load (actually, parallel combination of load resistor and emitter resistor). In other words, for the emitter follower circuit the effect of the Ebers-Moll model is simply to add a series emitter resistance $r_{\mathrm{e}}$ to our earlier results. ${ }^{33}$

The voltage gain of an emitter follower is slightly less than unity, owing to the voltage divider produced by $r_{\mathrm{e}}$ and the load. It is simple to calculate, because the output is at the junction of $r_{\mathrm{e}}$ and $R_{\text {load }}: G_{\mathrm{V}}=v_{\text {out }} / v_{\text {in }}=R_{\mathrm{L}} /\left(r_{\mathrm{e}}+R_{\mathrm{L}}\right)$. Thus, for example, a follower running at 1 mA quiescent current, with 1 k load, has a voltage gain of 0.976 . Engineers sometimes like to write the gain in terms of the transconductance, to put it in a form that holds for FETs also (see §3.2.3A); in that case (using $g_{m}=1 / r_{\mathrm{e}}$ ) you get $G_{\mathrm{V}}=R_{\mathrm{L}} g_{m} /\left(1+R_{\mathrm{L}} g_{m}\right)$.

### 2.3.4 The common-emitter amplifier revisited

Previously we got wrong answers for the voltage gain of the common-emitter amplifier with emitter resistor (sometimes called emitter degeneration) when we set the emitter resistor equal to zero; recall that our wrong answer was $G_{\mathrm{V}}=-R_{\mathrm{C}} / R_{\mathrm{E}}=\infty!$

The problem is that the transistor has $25 / I_{\mathrm{C}}(\mathrm{mA})$ ohms of built-in (intrinsic) emitter resistance $r_{\mathrm{e}}$ that must be added to the actual external emitter resistor. This resistance is significant only when small emitter resistors (or none at all) are used. ${ }^{34}$ So, for instance, the amplifier we considered previously will have a voltage gain of $-10 \mathrm{k} / r_{\mathrm{e}}$, or -400 , when the external emitter resistor is zero. The input impedance is not zero, as we would have predicted earlier $\left(\beta R_{\mathrm{E}}\right.$ ); it is approximately $\beta r_{\mathrm{e}}$, or in this case ( 1 mA quiescent current) about $2.5 \mathrm{k} .{ }^{35}$

[^69]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0127.jpg?height=1386&width=751&top_left_y=169&top_left_x=142)

Figure 2.43. Output impedance of emitter followers (see text).

The terms "grounded emitter" and "common emitter" are sometimes used interchangeably, and they can be confusing. We will use the phrase "grounded-emitter amplifier" to mean a common-emitter amplifier with $R_{\mathrm{E}}=0$ (or equivalent bypassing). A common-emitter amplifier stage may have an emitter resistor; what matters is that the emitter circuit is common to the input circuit and the output circuit.

[^70]
#### A. Shortcomings of the single-stage grounded emitter amplifier

The extra voltage gain you get by using $R_{\mathrm{E}}=0$ comes at the expense of other properties of the amplifier. In fact, the grounded-emitter amplifier, in spite of its popularity in textbooks, should be avoided except in circuits with overall negative feedback. In order to see why, consider Figure 2.44 .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0127.jpg?height=340&width=465&top_left_y=565&top_left_x=1140)

Figure 2.44. Common-emitter amplifier without emitter degeneration.

1. Nonlinearity. The voltage gain is $G=-g_{m} R_{\mathrm{C}}=$ $-R_{\mathrm{C}} / r_{\mathrm{e}}=-R_{\mathrm{C}} I_{\mathrm{C}}(\mathrm{mA}) / 25$, so for a quiescent current of 1 mA , the gain is -400 . But $I_{\mathrm{C}}$ varies as the output signal varies. For this example, the gain will vary from -800 $\left(V_{\text {out }}=0, I_{\mathrm{C}}=2 \mathrm{~mA}\right)$ down to zero ( $\left.V_{\text {out }}=V_{\mathrm{CC}}, I_{\mathrm{C}}=0\right)$. For a triangle-wave input, the output will look as in Figure 2.45. The amplifier has lots of distortion, or poor linearity. The grounded-emitter amplifier without feedback is useful only for small-signal swings about the quiescent point. By contrast, the emitter-degenerated amplifier has a gain almost entirely independent of collector current, as long as $R_{\mathrm{E}} \gg r_{\mathrm{e}}$, and can be used for undistorted amplification even with large-signal swings.

It's easy to estimate the distortion, both with and without an external emitter resistor. With a grounded emitter, the incremental (small-signal) gain is $G_{\mathrm{V}}=-R_{\mathrm{C}} / r_{\mathrm{e}}=$ $-I_{\mathrm{C}} R_{\mathrm{C}} / V_{\mathrm{T}}=-V_{\text {drop }} / V_{\mathrm{T}}$, where $V_{\text {drop }}$ is the instantaneous voltage drop across the collector resistor. Because the gain is proportional to the drop across the collector resistor, the nonlinearity (fractional change of gain with swing) equals the ratio of instantaneous swing to average quiescent drop across the collector resistor: $\Delta G / G \approx \Delta V_{\text {out }} / V_{\text {drop }}$, where $V_{\text {drop }}$ is the average, or quiescent, voltage drop across the collector resistor $R_{\mathrm{C}}$. Because this represents the extreme variation of gain (i.e., at the peaks of the swing), the overall waveform "distortion" (usually stated as the amplitude of the residual waveform after subtraction of the strictly linear component) will be smaller by roughly a factor of 3 . Note that the distortion depends on only the ratio of swing to quiescent drop, and not directly on the operating current, etc.

As an example, in a grounded emitter amplifier powered from +10 V , biased to half the supply (i.e., $V_{\text {drop }}=5 \mathrm{~V}$ ), we measured a distortion of $0.7 \%$ at 0.1 V output sinewave amplitude and $6.6 \%$ at 1 V amplitude; these values are in good agreement with the predicted values. Compare this with the situation with an added external emitter resistor $R_{\mathrm{E}}$, in which the voltage gain becomes $G_{\mathrm{V}}=-R_{\mathrm{C}} /\left(r_{\mathrm{e}}+R_{\mathrm{E}}\right)=$ $-I_{\mathrm{C}} R_{\mathrm{C}} /\left(V_{\mathrm{T}}+I_{\mathrm{C}} R_{\mathrm{E}}\right)$. Only the first term in the denominator contributes distortion, so the distortion is reduced by the ratio of $r_{\mathrm{e}}$ to the total effective emitter resistance: the nonlinearity becomes $\Delta G / G \approx\left(\Delta V_{\text {out }} / V_{\text {drop }}\right)\left[r_{\mathrm{e}} /\left(r_{\mathrm{e}}+R_{\mathrm{E}}\right)\right]=$ $\left(\Delta V_{\text {out }} / V_{\text {drop }}\right)\left[V_{\mathrm{T}} /\left(V_{\mathrm{T}}+I_{\mathrm{E}} R_{\mathrm{E}}\right)\right]$; the second term is the factor by which the distortion is reduced. When we added an emitter resistor, chosen to drop 0.25 V at the quiescent current - which by this estimate should reduce the nonlinearity by a factor of $10-$ the measured distortion of the previous amplifier dropped to $0.08 \%$ and $0.74 \%$ for 0.1 V and 1 V output amplitudes, respectively. Once again, these measurement agree well with our prediction.

Exercise 2.12. Calculate the predicted distortion for these two amplifiers at the two output levels that were measured.

As we remarked, the nonlinearity of a common-emitter amplifier, when driven by a triangle wave, takes the form of the asymmetric "barn roof" distortion sketched in Figure 2.45. ${ }^{36}$ For comparison we took a real-life 'scope (oscilloscope) trace of a grounded emitter amplifier (Figure 2.46); we used a 2 N 3904 with a 5 k collector resistor to a +10 V supply, biased (carefully!) to half the supply. With a ruler we estimated the incremental gain at output voltages of +5 V (halfway to $V_{+}$) and at +7.5 V , as shown, where the collector current is 1 mA and 0.5 mA , respectively. The gain values are in pretty good agreement with the predictions $\left(G=R_{\mathrm{C}} / r_{\mathrm{e}}=I_{\mathrm{C}}(\mathrm{mA}) R_{\mathrm{C}} / 25 \Omega\right)$ of $G=-200$ and $G=-100$, respectively. By comparison, Figure 2.47 shows what happened when we added a $225 \Omega$ emitter resistor: the gain is reduced by a factor of 10 at the quiescent point $\left(G=R_{\mathrm{C}} /\left(R_{\mathrm{E}}+r_{\mathrm{e}}\right) \approx R_{\mathrm{C}} / 250 \Omega\right)$, but with much improved linearity (because changes in $r_{\mathrm{e}}$ contribute little to the overall resistance in the denominator, which is now dominated by the fixed $225 \Omega$ external emitter resistor).

For sinusoidal input, the output contains all harmonics of the fundamental wave. Later in the chapter we'll see how to make differential amplifiers with a pair of transistors; for these the residual distortion is symmetric, and contains only the odd harmonics. And in Chapter $2 x$ we'll see some very clever methods for cancelling distortion in differential

[^71]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0128.jpg?height=397&width=741&top_left_y=220&top_left_x=1099)

Figure 2.45. Nonlinear output waveform from grounded-emitter amplifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0128.jpg?height=496&width=777&top_left_y=767&top_left_x=1076)

Figure 2.46. Real life! The grounded-emitter amplifier of Figure 2.44 , with $R_{\mathrm{C}}=5 \mathrm{k}, V_{+}=+10 \mathrm{~V}$, and a 1 kHz triangle wave input. Top and bottom of the screen are +10 V and ground for the dccoupled output trace (note sensitive scale for the ac-coupled input signal). Gain estimates (tangent lines) are at $V_{\text {out }}$ values of $0.5 V_{+}$ and $0.75 V_{+}$. Horizontal: $0.2 \mathrm{~ms} /$ div.
amplifiers, along with the use of SPICE simulation software for rapid analysis and circuit iteration. Finally, to set things in perspective, we should add that any amplifier's residual distortion can be reduced dramatically by use of negative feedback. We'll introduce feedback later in this chapter (\$2.5), after you've gained familiarity with common transistor circuits. Feedback will finally take center stage when we get to operational amplifiers in Chapter 4.
2. Input impedance. The input impedance is roughly $\mathbf{Z}_{\text {in }}=\beta r_{\mathrm{e}}=25 \beta / I_{\mathrm{C}}(\mathrm{mA})$ ohms. Once again, $I_{\mathrm{C}}$ varies over the signal swing, giving a varying input impedance. Unless the signal source driving the base has low impedance, you will wind up with nonlinearity because of the nonlinear (variable) voltage divider formed from the signal source and the amplifier's input impedance. By contrast, the input impedance of an emitter-degenerated amplifier is nearly constant, and high.
3. Biasing. The grounded emitter amplifier is difficult to
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0129.jpg?height=509&width=766&top_left_y=210&top_left_x=135)

Figure 2.47. Adding a $225 \Omega$ emitter resistor improves the linearity dramatically at the expense of gain (which drops by a factor of 10 at the quiescent point). Horizontal: $0.2 \mathrm{~ms} /$ div.
bias. It might be tempting just to apply a voltage (from a voltage divider) that gives the right quiescent current according to the Ebers-Moll equation. That won't work, because of the temperature dependence of $V_{\mathrm{BE}}$ (at fixed $I_{\mathrm{C}}$ ), which varies about $2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ [it actually decreases with increasing $T$ because of the variation of $I_{\mathrm{S}}(T)$ with temperature; as a result, $V_{\mathrm{BE}}$ is roughly proportional to $1 / T$, the absolute temperature]. This means that the collector current (for fixed $V_{\mathrm{BE}}$ ) will increase by a factor of 10 for a $30^{\circ} \mathrm{C}$ rise in temperature (which corresponds to a 60 mV change in $V_{\mathrm{BE}}$ ), or about $9 \% /{ }^{\circ} \mathrm{C}$. Such unstable biasing is useless, because even rather small changes in temperature will cause the amplifier to saturate. For example, a grounded emitter stage biased with the collector at half the supply voltage will go into saturation if the temperature rises by $8^{\circ} \mathrm{C}$.
Exercise 2.13. Verify that an $8^{\circ} \mathrm{C}$ rise in ambient temperature will cause a base-voltage-biased grounded emitter stage to saturate, assuming that it was initially biased for $V_{\mathrm{C}}=0.5 V_{\mathrm{CC}}$.

Some solutions to the biasing problem are discussed in the following sections. By contrast, the emitterdegenerated amplifier achieves stable biasing by applying a voltage to the base, most of which appears across the emitter resistor, thus determining the quiescent current.

#### B. Emitter resistor as feedback

Adding an external series resistor to the intrinsic emitter resistance $r_{\mathrm{e}}$ (emitter degeneration) improves many properties of the common-emitter amplifier, but at the expense of gain. You will see the same thing happening in Chapters 4 and 5, when we discuss negative feedback, an important technique for improving amplifier characteristics by feeding back some of the output signal to reduce the effective input signal. The similarity here is no coincidence -
the emitter-degenerated amplifier itself uses a form of negative feedback. Think of the transistor as a transconductance device, determining collector current (and therefore output voltage) according to the voltage applied between the base and emitter; but the input to the amplifier is the voltage from base to ground. So the voltage from base to emitter is the input voltage, minus a sample of the output (namely $I_{\mathrm{E}} R_{\mathrm{E}}$ ). That's negative feedback, and that's why emitter degeneration improves most properties of the amplifier (here improved linearity and stability and increased input impedance. ${ }^{37}$ ) Later in the chapter, in $\S 2.5$, we'll make these statements quantitative when we first look at feedback. And there are great things to look forward to, with the full flowering of feedback in Chapters 4 and 5!

### 2.3.5 Biasing the common-emitter amplifier

If you must have the highest possible gain (or if the amplifier stage is inside a feedback loop), it is possible to arrange successful biasing of a common-emitter amplifier. There are three solutions that can be applied, separately or in combination: bypassed emitter resistor, matched biasing transistor, and dc feedback.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0129.jpg?height=465&width=669&top_left_y=1183&top_left_x=1015)

Figure 2.48. A bypassed emitter resistor can be used to improve the bias stability of a grounded-emitter amplifier.

#### A. Bypassed emitter resistor

You can use a bypassed emitter resistor, biasing as for the degenerated amplifier, as shown in Figure 2.48. In this case $R_{\mathrm{E}}$ has been chosen about $0.1 R_{\mathrm{C}}$, for ease of biasing; if $R_{\mathrm{E}}$ is too small, the emitter voltage will be much smaller than the base-emitter drop, leading to temperature instability of the quiescent point as $V_{\mathrm{BE}}$ varies with temperature. The emitter bypass capacitor is chosen to make its impedance small compared with $r_{\mathrm{e}}$ (not $R_{\mathrm{E}}-$ why?) at the

[^72]lowest frequency of interest. In this case its impedance is $25 \Omega$ at 650 Hz . At signal frequencies the input coupling capacitor sees an impedance of 10 k in parallel with the base impedance, in this case $\beta \times 25 \Omega$, or roughly 2.5 k . At dc , the impedance looking into the base is much larger ( $\beta$ times the emitter resistor, or about 100k).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0130.jpg?height=435&width=513&top_left_y=484&top_left_x=343)

Figure 2.49. Gain-of-50 stage presents bias stability problem.
A variation on this circuit consists of using two emitter resistors in series, one of them bypassed. For instance, suppose you want an amplifier with a voltage gain of 50, quiescent current of 1 mA , and $V_{\mathrm{CC}}$ of +20 volts, for signals from 20 Hz to 20 kHz . If you try to use the emitterdegenerated circuit, you will have the circuit shown in Figure 2.49. The collector resistor is chosen to put the quiescent collector voltage at $0.5 V_{\mathrm{CC}}$. Then the emitter resistor is chosen for the required gain, including the effects of the $r_{\mathrm{e}}$ of $25 / I_{\mathrm{C}}(\mathrm{mA})$. The problem is that the emitter voltage of only 0.175 V will vary significantly as the $\sim 0.6 \mathrm{~V}$ of base-emitter drop varies with temperature $\left(-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}\right.$, approximately), since the base is held at constant voltage by $R_{1}$ and $R_{2}$; for instance, you can verify that an increase of $20^{\circ} \mathrm{C}$ will cause the collector current to increase by nearly $25 \%$.

Exercise 2.14. Show that this statement is correct.
The solution here is to add some bypassed emitter resistance for stable biasing, with no change in gain at signal frequencies (Figure 2.50). As before, the collector resistor is chosen to put the collector at 10 volts $\left(0.5 V_{\mathrm{CC}}\right)$. Then the unbypassed emitter resistor is chosen to give a gain of 50, including the intrinsic emitter resistance $r_{\mathrm{e}}=$ $25 / I_{\mathrm{C}}(\mathrm{mA})$. Enough bypassed emitter resistance is added to make stable biasing possible (one-tenth of the collector resistance is a good guideline). The base voltage is chosen to give 1 mA of emitter current, with impedance about one-tenth the dc impedance looking into the base (in this case about 100 k ). The emitter bypass capacitor is chosen to have low impedance compared with $180+25 \Omega$ at the lowest signal frequencies. Finally, the input coupling ca-
pacitor is chosen to have low impedance compared with the signal-frequency input impedance of the amplifier, which is equal to the voltage-divider impedance in parallel with $\beta \times(180+25) \Omega$ (the $820 \Omega$ is bypassed and looks like a short at signal frequencies).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0130.jpg?height=511&width=578&top_left_y=454&top_left_x=1193)

Figure 2.50. A common-emitter amplifier combining bias stability, linearity, and large voltage gain.

An alternative circuit splits the signal and dc paths (Figure 2.51 ). This lets you vary the gain (by changing the $180 \Omega$ resistor) without bias change.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0130.jpg?height=407&width=381&top_left_y=1225&top_left_x=1248)

Figure 2.51. Equivalent emitter circuit for Figure 2.50.

#### B. Matched biasing transistor

You can use a matched transistor to generate the correct base voltage for the required collector current; this ensures automatic temperature compensation (Figure 2.52). ${ }^{38} Q_{1}$ 's collector is drawing 1 mA , since it is guaranteed to be near ground (about one $V_{\mathrm{BE}}$ drop above ground, to be exact); if $Q_{1}$ and $Q_{2}$ are a matched pair (available as a single device, with the two transistors on one piece of silicon), then $Q_{2}$ will also be biased to draw 1 mA , putting its collector at

[^73]+10 volts and allowing a full $\pm 10 \mathrm{~V}$ symmetrical swing on its collector. Changes in temperature are of no importance as long as both transistors are at the same temperature. This is a good reason for using a "monolithic" dual transistor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0131.jpg?height=978&width=639&top_left_y=406&top_left_x=224)

Figure 2.52. Biasing scheme with compensated $V_{\mathrm{BE}}$ drop, for both grounded emitter (A) and degenerated emitter (B) stages. With the values shown, $V_{\mathrm{C}}$ would be approximately 10.5 V ; reducing the 20 k resistor to 19.1 k (a standard value) would take into account the effects of $V_{\mathrm{BE}}$ and finite $\beta$ and put $V_{\mathrm{C}}$ at 10 V .

#### C. Feedback at dc

You can use dc feedback to stabilize the quiescent point. Figure 2.53A shows one method. By taking the bias voltage from the collector, rather than from $V_{\mathrm{CC}}$, you get some measure of bias stability. The base sits one diode drop above ground - and because its bias comes from a 10:1 divider, the collector must be at 11 diode drops above ground, or about 7 volts. Any tendency for the transistor to saturate (e.g., if it happens to have unusually high beta) is stabilized, since the dropping collector voltage will reduce the base bias. This scheme is acceptable if great stability is not required. The quiescent point is liable to drift a volt or so as the ambient (surrounding) temperature changes, because the base-emitter voltage has a significant temperature coefficient (Ebers-Moll, again). Better stability is possible if
several stages of amplification are included within the feedback loop. You will see examples later in connection with feedback.

A better understanding of feedback is really necessary to understand this circuit. For instance, feedback acts to reduce the input and output impedances. The input signal sees $R_{1}$ 's resistance effectively reduced by the voltage gain of the stage. In this case it is equivalent to a resistor of about $200 \Omega$ to ground (not pleasant at all!). Later in this chapter (and again in Chapter 4) we treat feedback in enough detail so that you will be able to figure the voltage gain and terminal impedance of this circuit.

Figures 2.53B-D illustrate some variations on the basic dc-feedback bias scheme: circuit B adds some emitter degeneration to improve linearity and predictability of gain; circuit C adds to that an input follower to increase the input impedance (with appropriately increased $R_{1} R_{2}$ divider values and changed ratio to accommodate the additional $V_{\mathrm{BE}}$ drop); and circuit D combines the methods of Figure 2.51 with circuit B to achieve greater bias stability.

Note that the base bias resistor values in these circuits could be increased to raise the input impedance, but you should then take into account the non-negligible base current. Suitable values might be $R_{1}=220 \mathrm{k}$ and $R_{2}=33 \mathrm{k}$. An alternative approach might be to bypass the feedback resistance in order to eliminate feedback (and therefore lowered input impedance) at signal frequencies (Figure 2.54). ${ }^{39}$

#### D. Comments on biasing and gain

One important point about grounded emitter amplifier stages: you might think that the voltage gain can be raised by increasing the quiescent current, since the intrinsic emitter resistance $r_{\mathrm{e}}$ drops with rising current. Although $r_{\mathrm{e}}$ does decrease with increasing collector current, the smaller collector resistor you need to obtain the same quiescent collector voltage just cancels the advantage. In fact, you can show that the small-signal voltage gain of a grounded-emitter amplifier biased to $0.5 V_{\mathrm{CC}}$ is given by $G=20 V_{\mathrm{CC}}$ (in volts), independent of quiescent current.

Exercise 2.15. Show that the preceding statement is true.
If you need more voltage gain in one stage, one approach is to use a current source as an active load. Because its impedance is very high, single-stage voltage gains of

[^74]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0132.jpg?height=524&width=1677&top_left_y=210&top_left_x=215)

Figure 2.53. Bias stability is improved by feedback.

1000 or more are possible. ${ }^{40}$ Such an arrangement cannot be used with the biasing schemes we have discussed, but must be part of an overall dc feedback loop, a subject we will discuss in Chapter 4. You should be sure such an amplifier looks into a high-impedance load; otherwise the gain obtained by high collector load impedance will be lost. Something like an emitter follower, an FET, or an op-amp presents a good load.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0132.jpg?height=409&width=419&top_left_y=1183&top_left_x=428)

Figure 2.54. Eliminating impedance-lowering feedback at signal frequencies.

In RF amplifiers intended for use only over a narrow frequency range, it is common to use a parallel $L C$ circuit as a collector load. In that case a very high voltage gain is possible since the $L C$ circuit has high impedance (like a current source) at the signal frequency, with low impedance at dc. Because the $L C$ is "tuned," out-of-band interfering signals (and distortion) are effectively rejected. Additional bonuses are the possibility of peak-to-peak (pp) output swings of $2 V_{\mathrm{CC}}$, and the use of transformer coupling from the inductor.

[^75]Exercise 2.16. Design a tuned common-emitter amplifier stage to operate at 100 kHz . Use a bypassed emitter resistor, and set the quiescent current at 1.0 mA . Assume $V_{\mathrm{CC}}=+15 \mathrm{~V}$ and $L=$ 1.0 mH , and put a 6.2 k resistor across the $L C$ to set $Q=10$ (to get a $10 \%$ bandpass; see $\S 1.7$-14). Use capacitive input coupling.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0132.jpg?height=396&width=580&top_left_y=1093&top_left_x=1179)

Figure 2.55. Classic bipolar-transistor matched-pair current mirror. Note the common convention of referring to the positive supply as $V_{\mathrm{CC}}$, even when pnp transistors are used.

### 2.3.6 An aside: the perfect transistor

Looking at BJT transistor properties like the non-zero (and temperature-dependent) $V_{\mathrm{BE}}$, the finite (and currentdependent) emitter impedance $r_{\mathrm{e}}$ and transconductance $g_{m}$, the collector current that varies with collector voltage (Early effect) etc., one is tempted to ask which transistor is better? Is there a "best" transistor, or perhaps even a perfect transistor? If you go through our transistor tables, e.g., Tables 2.1 and 2.2, and especially Table 8.1 for small-signal transistors, you'll see there is no best transistor candidate. That's because all physical bipolar transistors are subject to the same device physics, and their parameters tend to scale with die size and current, etc.

However, it turns out that there is a candidate for a "perfect transistor," if you don't limit yourself to a single $n p n$ or $p n p$ structure; see Figure 2.56. This device has nearly ideal properties: $V_{\mathrm{BE}}=0 \mathrm{~V}(!)$, along with very high $g_{m}$ (thus low $r_{\mathrm{e}}$ ), and very high beta. And just to top it off, current can flow in either direction - it's ambidextrous, or "bipolarity" (saying it's bipolarity is better than saying it's a bipolar bipolar transistor). Like a regular BJT, it's a transconductance device: when driven with a positive $V_{\mathrm{BE}}$ input signal, it sources an output current that is $g_{m}$ times greater, and vice versa (with a negative $V_{\mathrm{BE}}$ it sinks a current). Unlike a BJT, though, it's noninverting. All signals are referenced to ground. Very nice.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0133.jpg?height=438&width=819&top_left_y=781&top_left_x=106)

Figure 2.56. A. An ordinary common-emitter BJT amplifier stage, with an emitter-degeneration resistor $R_{\mathrm{E}}$ and a load resistor $R_{\mathrm{L}}$. B. In a common-emitter amplifier built with the "perfect" transistor, all signals are referenced to ground, to which the load $R_{\mathrm{L}}$ is also returned (the power supplies are not shown). C. The OTA symbol for the perfect transistor, implemented as an Operational Transconductance Amplifier device. The truncated apex symbol means the device has a current output.

How does the perfect transistor work? Figure 2.57 shows a four-transistor circuit known as a diamond transistor stage. This circuit is a variation of the cascaded pnpnpn emitter follower in Figure 2.29: a complementary npnpnp input follower is wired in parallel, and biased with current sources; the emitter outputs ( $2 V_{\mathrm{BE}}$ apart) drive a matched push-pull output follower, which therefore runs at the same quiescent current. The common node is the effective emitter, $E$. Finally, a pair of current mirrors brings the two individual collector currents to a common output, the effective collector, $C$, where the output current is zero if the input voltage (between terminals $B$ and $E$ ) is zero. As with an ordinary BJT, any current into (or out of) the emitter has to appear at the collector. The part does require two power supply connections. We'll have more to say about this interesting component in Chapters $2 x$ and $4 x$.

Texas Instruments calls their perfect transistor (its part
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0133.jpg?height=761&width=759&top_left_y=219&top_left_x=993)

Figure 2.57. A. The OPA860 perfect transistor includes a diamond transistor (the triangle) and a pair of current mirrors. A second diamond transistor acts as an output buffer. B. The diamond transistor consists of a complementary pair of matched offset-cancelled emitter followers.
number is OPA86041) an Operational Transconductance Amplifier (OTA). Other names they use are "VoltageControlled Current source," "Transconductor," "Macro Transistor," and "positive second-generation current conveyor" (CCII + ). We fear it has a branding identity crisis, so, with characteristic understatement, we're calling it a "perfect transistor."

How close to perfection do these parts come? The OPA860 and OPA861 perfect transistors have these specs: $V_{\text {os }}=3 \mathrm{mV}$ typ ( 12 mV max), $g_{m}=95 \mathrm{mS}, r_{\mathrm{e}}=10.5 \Omega$, $Z_{\text {out }}=54 \mathrm{k} \Omega\left\|2 \mathrm{pF}, Z_{\text {in }}=455 \mathrm{k} \Omega\right\| 2 \mathrm{pF}, I_{\text {out }(\max )}= \pm 15 \mathrm{~mA}$. Its maximum gain is 5100 . Hardly perfect, but, hey, not half bad. You can create many nice circuits with these puppies (e.g., active filter, wideband current summing circuit, or integrator for nanosecond-scale pulses); see the OPA860 datasheet for details.

[^76]
### 2.3.7 Current mirrors

The technique of matched base-emitter biasing can be used to make what is called a current mirror, an interesting current-source circuit that simply reverses the sign of a "programming" current. (Figure 2.55). You program the mirror by sinking a current from $Q_{1}$ 's collector. That causes a $V_{\mathrm{BE}}$ for $Q_{1}$ appropriate to that current at the circuit temperature and for that transistor type. $Q_{2}$, matched to $Q_{1}{ }^{42}$ is thereby programmed to source the same current to the load. The small base currents are unimportant. ${ }^{43}$

One nice feature of this circuit is voltage compliance of the output transistor current source to within a few tenths of a volt of $V_{\mathrm{CC}}$, as there is no emitter resistor drop to contend with. Also, in many applications it is handy to be able to program a current with a current. An easy way to generate the control current $I_{\mathrm{P}}$ is with a resistor (Figure 2.58). Because the bases are a diode drop below $V_{\mathrm{CC}}$, the 14.4 k resistor produces a control current, and therefore an output current, of 1 mA . Current mirrors can be used in transistor circuits whenever a current source is needed. They're very popular in integrated circuits, where (a) matched transistors abound and (b) the designer tries to make circuits that will work over a large range of supply voltages. There are even resistorless IC op-amps in which the operating current of the whole amplifier is set by one external resistor, with all the quiescent currents of the individual amplifier stages inside being determined by current mirrors.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0134.jpg?height=387&width=371&top_left_y=1383&top_left_x=432)

Figure 2.58. Programming current-mirror current.

#### A. Current-mirror limitations due to the Early effect

One problem with the simple current mirror is that the output current varies a bit with changes in output voltage, i.e.,

[^77]the output impedance is not infinite. This is because of the slight variation of $V_{\mathrm{BE}}$ with collector voltage at a given current in $Q_{2}$ (which is due to the Early effect); said a different way, the curve of collector current versus collectoremitter voltage at a fixed base-emitter voltage is not flat (Figure 2.59). In practice, the current might vary $25 \%$ or so over the output compliance range - much poorer performance than that of the current source with an emitter resistor discussed earlier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0134.jpg?height=389&width=777&top_left_y=627&top_left_x=1081)

Figure 2.59. Early effect: collector current varies with $V_{\mathrm{CE}}$. (Interestingly, you get a very similar curve, with comparable $V_{\mathrm{A}}$, if you apply instead a family of constant base currents.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0134.jpg?height=398&width=397&top_left_y=1232&top_left_x=1258)

Figure 2.60. Improved current mirror with emitter resistors.

One solution, if a better current source is needed (it often isn't), is the circuit shown in Figure 2.60. The emitter resistors are chosen to have at least a few tenths of a volt drop; this makes the circuit a far better current source, since the small variations of $V_{\mathrm{BE}}$ with $V_{\mathrm{CE}}$ are now negligible in determining the output current. Again, matched transistors should be used. Note that this circuit loses its effectiveness if operation over a wide range of programming current is intended (figure out why). ${ }^{44}$

[^78]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0135.jpg?height=471&width=802&top_left_y=244&top_left_x=117)

Figure 2.61. Wilson current mirror. Good stability with load variations is achieved through cascode transistor $Q_{3}$, which reduces voltage variations across $Q_{1}$. Adding a pair of emitter resistors $R_{\mathrm{E}}$, as shown, reduces output current error caused by $V_{\mathrm{BE}}$ mismatch, when chosen such that $I_{\mathrm{P}} R_{\mathrm{E}}$ is of order 100 mV or more.

#### B. Wilson mirror

Another current mirror with improved consistency of current is shown in the clever circuit of Figure 2.61. $Q_{1}$ and $Q_{2}$ are in the usual mirror configuration, but $Q_{3}$ now keeps $Q_{1}$ 's collector fixed at two diode drops below $V_{\mathrm{CC}}$. That circumvents the Early effect in $Q_{1}$, whose collector is now the programming terminal, with $Q_{2}$ now sourcing the output current. The result is that both current-determining transistors ( $Q_{1}$ and $Q_{2}$ ) have fixed collector-emitter drops; you can think of $Q_{3}$ as simply passing the output current through to a variable-voltage load (a similar trick is used in the cascode connection, which you will see later in the chapter). Transistor $Q_{3}$, by the way, does not have to be matched to $Q_{1}$ and $Q_{2}$; but if it has the same beta, then you get an exact cancellation of the (small) base current error that afflicts the simple mirror of Figure 2.55 (or the betaenhanced mirror in Chapter 2x).

Exercise 2.17. Show that this statement is true.

There are additional nice tricks you can do with current mirrors, such as generating multiple independent outputs, or an output that is a fixed multiple of the programming current. One trick (invented by the legendary Widlar) is to unbalance the $R_{\mathrm{E}}$ 's in Figure 2.61; as a rough estimate, the output current ratio is approximately the ratio of resistor values (because the base-emitter drops are roughly equal). But to get it right you need to take into account the difference of $V_{\mathrm{BE}}$ 's (because the transistors are running at different currents), for which the graph in Figure 2.62 is helpful. This graph is also useful for estimating the current unbalance in a current mirror built with discrete (i.e.,
not matched) transistors. We treat current mirrors further in Chapter $2 x(\$ 82 x .3$ and 2x.11).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0135.jpg?height=789&width=807&top_left_y=330&top_left_x=974)

Figure 2.62. Collector current ratios for matched transistors, as determined by the difference in applied base-emitter voltages. See Table 8.1b for low-noise matched BJTs.

### 2.3.8 Differential amplifiers

The differential amplifier is a very common configuration used to amplify the difference voltage between two input signals. In the ideal case the output is entirely independent of the individual signal levels - only the difference matters.

Differential amplifiers are important in applications in which weak signals are contaminated by "pickup" and other miscellaneous noise. Examples include digital and RF signals transferred over twisted-pair cables, audio signals (the term "balanced" means differential, usually $600 \Omega$ impedance, in the audio business), local-area-network signals (such as 100BASE-TX and 1000BASE-T Ethernet), electrocardiogram voltages, magnetic disk head amplifiers, and numerous other applications. A differential amplifier at the receiving end restores the original signal if the interfering "common-mode" signals (see below) are not too large. Differential amplifiers are universally used in operational amplifiers, an essential building block that is the subject of Chapter 4. They're very important in dc amplifier design (amplifiers that amplify clear down to dc, i.e., have no coupling capacitors) because their symmetrical design is inherently compensated against thermal drifts.

Some nomenclature: when both inputs change levels together, that's a common-mode input change. A differential change is called normal mode, or sometimes differential mode. A good differential amplifier has a high commonmode rejection ratio (CMRR), the ratio of response for a normal-mode signal to the response for a common-mode signal of the same amplitude. CMRR is usually specified in decibels. The common-mode input range is the voltage level over which the inputs may vary. The differential amplifier is sometimes called a "long-tailed pair."

Figure 2.63 shows the basic circuit. The output is taken off one collector with respect to ground; that is called a single-ended output and is the most common configuration. You can think of this amplifier as a device that amplifies a difference signal and converts it to a single-ended signal so that ordinary subcircuits (followers, current sources, etc.) can make use of the output. (If, instead, a differential output is desired, it is taken between the collectors.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0136.jpg?height=457&width=667&top_left_y=991&top_left_x=284)

Figure 2.63. Classic transistor differential amplifier.
What is the gain? That's easy enough to calculate: imagine a symmetrical input signal wiggle, in which input 1 rises by $v_{\text {in }}$ (a small-signal variation) and input 2 drops by the same amount. As long as both transistors stay in the active region, point $A$ remains fixed. You then determine the gain as with the single transistor amplifier, remembering that the input change is actually twice the wiggle on either base: $G_{\text {diff }}=R_{\mathrm{C}} / 2\left(r_{\mathrm{e}}+R_{\mathrm{E}}\right)$. Typically $R_{\mathrm{E}}$ is small, $100 \Omega$ or less, or it may be omitted entirely. Differential voltage gains of a few hundred are possible.

You can determine the common-mode gain by putting identical signals $v_{\text {in }}$ on both inputs. If you think about it correctly ${ }^{45}$ (remembering that $R_{1}$ carries both emitter currents), you'll find $G_{\mathrm{CM}}=-R_{\mathrm{C}} /\left(2 R_{1}+R_{\mathrm{E}}\right)$. Here we've ig-

[^79]nored the small $r_{\mathrm{e}}$, because $R_{1}$ is typically large, at least a few thousand ohms. We really could have ignored $R_{\mathrm{E}}$ as well. The CMRR is thus roughly $R_{1} /\left(r_{\mathrm{e}}+R_{\mathrm{E}}\right)$. Let's look at a typical example (Figure 2.64) to get some familiarity with differential amplifiers.

Collector resistor $R_{\mathrm{C}}$ is chosen for a quiescent current of $100 \mu \mathrm{~A}$. As usual, we put the collector at $0.5 V_{\mathrm{CC}}$ for large dynamic range. $Q_{1}$ 's collector resistor can be omitted, since no output is taken there. ${ }^{46} R_{1}$ is chosen to give total emitter current of $200 \mu \mathrm{~A}$, split equally between the two sides when the (differential) input is zero. From the formulas just derived, this amplifier has a differential gain of 10 and a common-mode gain of 0.55 . Omitting the 1.0 k resistors raises the differential gain to 50 , but drops the (differential) input impedance from about 250 k to about 50 k (you can substitute Darlington transistors ${ }^{47}$ in the input stage to raise the impedance into the megohm range, if necessary).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0136.jpg?height=613&width=792&top_left_y=954&top_left_x=1076)

Figure 2.64. Calculating differential amplifier performance.
Remember that the maximum gain of a single-ended grounded emitter amplifier biased to $0.5 V_{\mathrm{CC}}$ is $20 V_{\mathrm{CC}}$ (in volts). In the case of a differential amplifier the maximum differential gain $\left(R_{\mathrm{E}}=0\right)$ is half that figure, or (for arbitrary quiescent point) 20 times the voltage (in volts) across the collector resistor. The corresponding maximum CMRR (again with $R_{\mathrm{E}}=0$ ) is equal to 20 times the voltage (in volts) across $R_{1}$. As with the single-ended common-emitter amplifier, the emitter resistors $R_{\mathrm{E}}$ reduce distortion, at the

[^80]expense of gain. See the extensive discussion of BJT amplifier distortion in Chapter $2 x$.

Exercise 2.18. Verify that these expressions are correct. Then design a differential amplifier to run from $\pm 5 \mathrm{~V}$ supply rails, with $G_{\text {diff }}=25$ and $R_{\text {out }}=10 \mathrm{k}$. As usual, put the collector's quiescent point at half of $V_{\mathrm{CC}}$.

#### A. Biasing with a current source

The common-mode gain of the differential amplifier can be reduced enormously by the substitution of a current source for $R_{1}$. Then $R_{1}$ effectively becomes very large and the common-mode gain is nearly zero. If you prefer, just imagine a common-mode input swing; the emitter current source maintains a constant total emitter current, shared equally by the two collector circuits, by symmetry. The output is therefore unchanged. Figure 2.65 shows an example. The CMRR of this circuit, using an LM394 monolithic transistor pair for $Q_{1}$ and $Q_{2}$, will be around 100,000:1 $(100 \mathrm{~dB})$ at dc. The common-mode input range for this circuit goes from -3.5 V to +3 V ; it is limited at the low end by the compliance of the emitter current source and at the high end by the collector's quiescent voltage. ${ }^{48}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0137.jpg?height=626&width=725&top_left_y=1182&top_left_x=196)

Figure 2.65. Improving CMRR of the differential amplifier with a current source.

Be sure to remember that this amplifier, like all transistor amplifiers, must have a dc bias path to the bases. If the input is capacitively coupled, for instance, you must have

[^81]base resistors to ground. An additional caution for differential amplifiers, particularly those without inter-emitter resistors: bipolar transistors can tolerate only 6 volts of baseemitter reverse bias before breakdown; thus, applying a differential input voltage larger than this will destroy the input stage (if there is no inter-emitter resistor). An inter-emitter resistor limits the breakdown current and prevents destruction, but the transistors may be degraded nonetheless (in beta, noise, etc.). In either case the input impedance drops drastically during reverse conduction.

An interesting aside: the emitter current sink shown in Figure 2.65 has some variation with temperature, because $V_{\mathrm{BE}}$ decreases with increasing temperature (to the tune of approximately $-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$, §2.3.2), causing the current to increase. More explicitly, if we call the 1.24 V zenerlike reference " $V_{\text {ref }}$ " then the drop across the emitter resistor equals $V_{\mathrm{ref}}-V_{\mathrm{BE}}$; the current is proportional, thus increasing with temperature. As it happens, this is in fact beneficial: it can be shown from basic transistor theory that the quantity $V_{g 0}-V_{\mathrm{BE}}$ is approximately proportional to absolute temperature (PTAT), where $V_{g 0}$ is the silicon bandgap voltage (extrapolated to absolute zero), approximately 1.23 V . So, by choosing our $V_{\text {ref }}$ voltage equal to the bandgap voltage, we have an emitter current that increases PTAT; and this cancels the temperature dependence of differential-pair voltage gain $\left(g_{m} \propto 1 / T_{\text {abs }}, \S 2.3 .2\right.$ ). We'll explore this sort of cleverness a bit more in §9.10.2. And in Chapter 9 there's extensive discussion of the differential amplifier and the closely related "instrumentation amplifier."

#### B. Use in single-ended dc amplifiers

A differential amplifier makes an excellent dc amplifier, even for single-ended inputs. You just ground one of the inputs and connect the signal to the other (Figure 2.66). You might think that the "unused" transistor could be eliminated. Not so! The differential configuration is inherently compensated for temperature drifts, and even when one input is at ground that transistor is still doing something: a temperature change causes both $V_{\mathrm{BE}}$ 's to change the same amount, with no change in balance or output. That is, changes in $V_{\mathrm{BE}}$ are not amplified by $G_{\text {diff }}$ (only by $G_{\mathrm{CM}}$, which can be made essentially zero). Furthermore, the cancellation of $V_{\mathrm{BE}}$ 's means that there are no 0.6 V drops at the input to worry about. The quality of a dc amplifier constructed this way is limited only by mismatching of input $V_{\mathrm{BE}}$ 's or their temperature coefficients. Commercial monolithic transistor pairs and commercial differential amplifier ICs are available with extremely good matching (e.g., the MAT12 npn monolithic matched pair has a typical drift of
$V_{\mathrm{BE}}$ between the two transistors of $0.15 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ ). See Table 8.1 b on page 502 for a listing of matched BJTs.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0138.jpg?height=489&width=689&top_left_y=324&top_left_x=311)

Figure 2.66. A differential amplifier can be used as a precision single-ended dc amplifier.

Either input could have been grounded in the preceding circuit example. The choice depends on whether or not the amplifier is supposed to invert the signal. (The configuration shown is preferable at high frequencies, however, because of the Miller effect; see §2.4.5.) The connection shown is noninverting, and so the inverting input has been grounded. This terminology carries over to op-amps, which are versatile high-gain differential amplifiers.

#### C. Current-mirror active load

As with the simple grounded-emitter amplifier, it is sometimes desirable to have a single-stage differential amplifier with very high gain. An elegant solution is a currentmirror active load (Figure 2.67). $Q_{1} Q_{2}$ is the differential pair with emitter current source. $Q_{3}$ and $Q_{4}$, a current mirror, form the collector load. The high effective collector load impedance provided by the mirror yields voltage gains of 5000 or more, assuming no load at the amplifier's output. ${ }^{49}$ Such an amplifier is very common as the input stage in a larger circuit, and is usually used only within a feedback loop, or as a comparator (discussed in the next section). Be sure to keep the load impedance of such an amplifier very high, or the gain will drop enormously.

#### D. Differential amplifiers as phase splitters

The collectors of a symmetrical differential amplifier generate equal signal swings of opposite phase. By taking outputs from both collectors, you've got a phase splitter. Of course, you could also use a differential amplifier with both

[^82]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0138.jpg?height=473&width=499&top_left_y=218&top_left_x=1220)

Figure 2.67. Differential amplifier with active current mirror load.
differential inputs and differential outputs. This differential output signal could then be used to drive an additional differential amplifier stage, with greatly improved overall common-mode rejection.

#### E. Differential amplifiers as comparators

Because of its high gain and stable characteristics, the differential amplifier is the main building block of the comparator (which we saw in §1.4.2E), a circuit that tells which of two inputs is larger. They are used for all sorts of applications: switching on lights and heaters, generating square waves from triangles, detecting when a level in a circuit exceeds some particular threshold, class-D amplifiers and pulse-code modulation, switching power supplies, etc. The basic idea is to connect a differential amplifier so that it turns a transistor switch on or off, depending on the relative levels of the input signals. The linear region of amplification is ignored, with one or the other of the two input transistors cut off at any time. A typical hookup is illustrated in $\S 2.6 .2$ by a temperature-controlling circuit that uses a resistive temperature sensor (thermistor).

## 2.4 Some amplifier building blocks

We've now seen most of the basic - and important transistor circuit configurations: switch, follower, current source (and mirror), and common-emitter amplifier (both single-ended and differential). For the remainder of the chapter we look at some circuit elaborations and their consequences: push-pull, Darlington and Sziklai, bootstrapping, Miller effect, and the cascode configuration. We'll finish with an introduction to the wonderful (and essential) technique of negative feedback. Chapter $2 x$ deals with follow-on transistor circuits and techniques at a greater level of sophistication.

Table 2.2 Bipolar Power Transistors ${ }^{a}$

|  |  |  | $V_{\text {CEO }}$ <br> max | $\underset{\max _{\mathrm{b}}}{\mathrm{I}^{b}}$ | Pdiss $m^{b}{ }^{b, h}$ | $R_{\theta \mathrm{JC}}^{\mathrm{C}}$ |  | FE | Ic | $f_{\mathrm{T}}$ min | multiple |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| NPN | PNP | Case | (V) | (A) | (W) | ( ${ }^{\circ} \mathrm{C} / \mathrm{W}$ ) | min | typ | (A) | (MHz) | manf? |
| standard BJT |  |  |  |  |  |  |  |  |  |  |  |
| BD139 | BD140 | TO-126 | 80 | 1.5 | 12.5 | 10 | $40^{\text {e }}$ | 100 | 0.15 | 50 | $\cdot$ |
| 2N3055 | 2N2955 | TO-3 | 60 | 15 | 115 | 1.5 | 20 | -- | 4 | 2.5 | $\cdot$ |
| 2N6292 | 2N6107 | TO-220 | 70 | 7 | 40 | 3.1 | 30 | -- | 2 | 4 | - |
| TIP31C | TIP32C | TO-220 | 100 | 3 | 40 | 3.1 | 25 | 100 | 1 | 3 | $\cdot$ |
| TIP33C | TIP34C | TO-218 ${ }^{\text {d }}$ | 100 | 10 | 80 | 1.6 | 40 | 100 | 1 | 3 | $\cdot$ |
| TIP35C | TIP36C | TO-218 ${ }^{\text {d }}$ | 100 | 25 | 125 | 1.0 | 25 | 150 | 1.5 | 3 | $\cdot$ |
| MJ15015 | MJ15016 | TO-3 | 120 | 15 | 180 | 1.0 | 20 | 35 | 4 | $0.8^{9}$ | - |
| MJE15030 | MJE15031 | TO-220 | 150 | 8 | 50 | 2.5 | 40 | 80 | 3 | 30 | $\cdot$,z |
| MJE15032 | MJE15033 | TO-220 | 250 | 8 | 50 | 2.5 | 50 | 100 | 1 | 30 | $\cdot$ |
| 2SC5200 | 2SA1943 | TO-264 | 230 | 17 | 150 | 0.8 | 55 | 80 | 1 | 30 | $\cdot$ |
| 2SC5242 ${ }^{\text {k }}$ | 2SA1962 ${ }^{k}$ | TO-3P | 250 | s | S | S | s | s | s | s | $\cdot$ |
| MJE340 | MJE350 | TO-126 | 300 | 0.5 | 20 | 6 | 30 | -- | 0.05 | -- | $\cdot$ |
| TIP47 | MJE5730 | TO-220 | 250 | 1 | 40 | 3.1 | 30 | -- | 0.3 | 10 | $\cdot$ |
| TIP50 ${ }^{\text {U }}$ | MJE5731A ${ }^{\text {u }}$ | TO-220 | 400 | s | s | s | S | -- | s | s | $\cdot$ |
| MJE13007 | MJE5852 | TO-220 | $400^{f}$ | 8 | 80 | 1.6 | $8^{9}$ | 209 | 2 | $14^{t}$ | - |
| Darlington |  |  |  |  |  |  |  |  |  |  |  |
| MJD112 | MJD117 | DPak | 100 | 2 | 20 | 6.3 | 1000 | 2000 | 2 | 25 | $\cdot$ |
| TIP122 | TIP127 | TO-220 | 100 | 5 | 65 | 1.9 | 1000 | -- | 3 | -- | $\cdot$ |
| TIP142 | TIP147 | TO-218 | 100 | 10 | 125 | 1.0 | 1000 | -- | 5 | -- | $\cdot$ |
| MJ11015 | MJ11016 | TO-3 | 120 | 30 | 200 | 0.9 | 1000 | -- | 20 | 4 | $\cdot$ |
| MJ11032 | MJ11033 | TO-3 | 120 | 50 | 300 | 0.6 | 1000 | -- | 25 | -- | $\cdot$ |
| MJH11019 | MJH11020 | TO-218 | 200 v | 15 | 150 | 0.8 | 400 | -- | 10 | 3 | $\cdot$ |

Notes: (a) sorted more or less by voltage, current and families; see also additional tables in Chapter $2 x$. (b) with case at 25C. (c) $P_{\text {diss }}($ reality $)=\left(T_{J}[\right.$ your-max-value $\left.]-T a m b\right) /\left(R_{\theta J C}+R_{\theta C S}+R_{\theta S A}\right)$; this is a much lower number than the "spec," especially if you're careful with $T_{J}$ max, say $100^{\circ} \mathrm{C}$. (d) similar to TO-247. (e) higher gain grades are available. (f) much higher VCES "blocking" capability (compared with Vceo), e.g. 700V for MJE13007. (g) higher for the PNP device. (h) Pdiss $(m a x)=\left(150^{\circ} \mathrm{C}-25^{\circ} \mathrm{C}\right) / R_{\theta J C}$; this is a classic datasheet specsmanship value. (k) larger pkg version of above. (s) same as above. (t) typical. (u) higher voltage version of above. (v) there are also 150 V and 250V versions. (z) if these are hard to get, try the '028 and '029 versions (120V rather than 150V).

### 2.4.1 Push-pull output stages

As we mentioned earlier in the chapter, an npn emitter follower cannot sink current and a pnp follower cannot source current. The result is that a single-ended follower operating between split supplies can drive a ground-returned load only if a high quiescent current is used. ${ }^{50}$ The quiescent current must be at least as large as the maximum output current during peaks of the waveform, resulting in high quiescent power dissipation. For example, Figure 2.68 shows a follower circuit to drive an $8 \Omega$ loudspeaker load with up to 10 watts of audio.

An explanation of the driver stage: the pnp follower $Q_{1}$ is included to reduce drive requirements and to cancel $Q_{2}$ 's $V_{\mathrm{BE}}$ offset ( 0 V input gives approximately 0 V output).

[^83]$Q_{1}$ could, of course, be omitted for simplicity. The hefty current source in $Q_{1}$ 's emitter load is used to ensure that there is sufficient base drive to $Q_{2}$ at the top of the signal swing. A resistor as emitter load would be inferior because it would have to be a rather low value ( $50 \Omega$ or less) in order to guarantee at least 50 mA of base drive to $Q_{2}$ at the peak of the swing, when load current would be maximum and the drop across the resistor would be minimum; the resultant quiescent current in $Q_{1}$ would be excessive.

The output of this example circuit can swing to nearly $\pm 15$ volts (peak) in both directions, giving the desired output power ( 9 V rms across $8 \Omega$ ). However, the output transistor dissipates 55 watts with no signal (hence the heatsink symbol), and the emitter resistor dissipates another 110 watts. Quiescent power dissipation many times greater than the maximum output power is characteristic of this kind of class-A circuit (transistor always in conduction);
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0140.jpg?height=465&width=684&top_left_y=219&top_left_x=278)

Figure 2.68. A 10 W loudspeaker amplifier, built with a singleended emitter follower, dissipates 165 W of quiescent power!
this obviously leaves a lot to be desired in applications in which any significant amount of power is involved.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0140.jpg?height=417&width=433&top_left_y=919&top_left_x=406)

Figure 2.69. Push-pull emitter follower.
Figure 2.69 shows a push-pull follower doing the same job. $Q_{1}$ conducts on positive swings, $Q_{2}$ on negative swings. With zero input voltage, there is no collector current and no power dissipation. At 10 watts of output power there is less than 10 watts of dissipation in each transistor. ${ }^{51}$

#### A. Crossover distortion in push-pull stages

There is a problem with the preceding circuit as drawn. The output trails the input by a $V_{\mathrm{BE}}$ drop; on positive swings the output is about 0.6 V less positive than the input, and the reverse for negative swings. For an input sine wave, the output would look as shown in Figure 2.70. In the language of the audio business, this is called crossover distortion. The best cure (feedback offers another method, although by itself it is not entirely satisfactory; see §4.3.1E) is to bias the push-pull stage into slight conduction, as in Figure 2.71.

The bias resistors $R$ bring the diodes into forward conduction, holding $Q_{1}$ 's base a diode drop above the input

[^84]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0140.jpg?height=292&width=735&top_left_y=221&top_left_x=1102)

Figure 2.70. Crossover distortion in the push-pull follower.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0140.jpg?height=541&width=726&top_left_y=630&top_left_x=1109)

Figure 2.71. Biasing the push-pull follower to eliminate crossover distortion.
signal and $Q_{2}$ 's base a diode drop below the input signal. Now, as the input signal crosses through zero, conduction passes from $Q_{2}$ to $Q_{1}$; one of the output transistors is always on. The value $R$ of the base resistors is chosen to provide enough base current for the output transistors at the peak output swing. For instance, with $\pm 20 \mathrm{~V}$ supplies and an $8 \Omega$ load running up to 10 watts sinewave power, the peak base voltage is about 13.5 volts and the peak load current is about 1.6 amps . Assuming a transistor beta of 50 (power transistors generally have lower current gain than small-signal transistors), the 32 mA of necessary base current will require base resistors of about $220 \Omega(6.5 \mathrm{~V}$ from $V_{\mathrm{CC}}$ to base at peak swing).

In this circuit we've added a resistor from input to output (this could have been done in Figure 2.69 as well). This serves to eliminate the "dead zone" as conduction passes from one transistor to the other (particularly in the first circuit), which is desirable especially when this circuit is included within a larger feedback circuit. However, it does not substitute for the better procedure of linearizing by biasing, as in Figure 2.71, to achieve transistor conduction over the full output waveform. We have more to say about this in Chapter $2 x$.
B. Thermal stability in class-B push-pull amplifiers The preceding amplifier has one unfortunate feature: it is not thermally stable. As the output transistors warm up (and they will get hot, because they are dissipating power when signal is applied), their $V_{\mathrm{BE}}$ drops, causing quiescent current to flow. The added heat this produces causes the situation to get worse, with the strong possibility of what is called thermal runaway (whether it runs away or not depends on a number of factors, including how large a "heatsink" is used, how well the diode's temperature tracks the transistor's temperature, etc.). Even without runaway, better control over the circuit is needed, usually with the sort of arrangement shown in Figure 2.72.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0141.jpg?height=592&width=529&top_left_y=778&top_left_x=279)

Figure 2.72. Adding (small) emitter resistors improve thermal stability in the push-pull follower.

For variety, the input is shown coming from the collector of the previous stage; $R_{1}$ now serves the dual purpose of being $Q_{1}$ 's collector resistor, and also providing current to bias the diodes and bias-setting resistor in the push-pull base circuit. Here $R_{3}$ and $R_{4}$, typically a few ohms or less, provide a "cushion" for the critical quiescent current biasing: the voltage between the bases of the output transistors must now be a bit greater than two diode drops, and you provide the extra with adjustable biasing resistor $R_{2}$ (often replaced with a third series diode, or, better, with the more elegant biasing circuit of Figure 2.78 on page 111). With a few tenths of a volt across $R_{3}$ and $R_{4}$, the temperature variation of $V_{\mathrm{BE}}$ doesn't cause the current to rise very rapidly (the larger the drop across $R_{3}$ and $R_{4}$, the less sensitive it is), and the circuit will be stable. Stability is improved by mounting the diodes ${ }^{52}$

[^85]in physical contact with the output transistors (or their heatsinks).

You can estimate the thermal stability of such a circuit by remembering that the base-emitter drop decreases by about 2.1 mV for each $1^{\circ} \mathrm{C}$ rise, and that the collector current increases by a factor of 10 for every 60 mV increase in base-emitter voltage (or $4 \%$ per mV ). For example, if $R_{2}$ were replaced with a diode, you would have three diode drops between the bases of $Q_{2}$ and $Q_{3}$, leaving about one diode drop across the series combination of $R_{3}$ and $R_{4}$. (The latter would then be chosen to give an appropriate quiescent current, perhaps 100 mA for an audio power amplifier.) The worst case for thermal stability occurs if the biasing diodes are not thermally coupled to the output transistors.

Let us assume the worst and calculate the increase in output-stage quiescent current corresponding to a $30^{\circ} \mathrm{C}$ temperature rise in output transistor temperature. That's not a lot for a power amplifier, by the way. For that temperature rise, the $V_{\mathrm{BE}}$ of each output transistor will decrease by about 63 mV at constant current, raising the voltage across $R_{3}$ and $R_{4}$ by about $50 \%$ (i.e., the quiescent current will rise by about $50 \%$ ). The corresponding figure for the preceding amplifier circuit without emitter resistors (Figure 2.71) will be a factor of 10 rise in quiescent current (recall that $I_{C}$ increases a decade per 60 mV increase in $V_{\mathrm{BE}}$ ), i.e., $1000 \%$. The improved thermal stability of this biasing arrangement (even without having the diodes thermally coupled to the output transistors) is evident. And you'll do significantly better when the diodes (or diode-connected transistors, or, best of all, $V_{\mathrm{BE}}$-referenced biasing as shown in Figure 2.78) ride along on the heatsink.

This circuit has the additional advantage that, by adjusting the quiescent current, you have some control over the amount of residual crossover distortion. A push-pull amplifier biased in this way to obtain substantial quiescent current at the crossover point is sometimes referred to as a "class-AB" amplifier, meaning that both transistors conduct simultaneously during a significant portion of the cycle. In practice, you choose a quiescent current that is a good compromise between low distortion and excessive quiescent dissipation. Feedback, introduced later in this chapter (and exploited shamelessly, and with joy, in Chapter 4), is almost always used to reduce distortion still further.

We will see a further evolution of this circuit in §2.4.2, where we supplement it with the intriguingly named techniques of $V_{\mathrm{BE}}$-referenced biasing, collector bootstrapping, and $\beta$-boosting complementary Darlington output stage.

#### C. "Class-D" amplifiers

An interesting solution to this whole business of power dissipation (and distortion) in class-AB linear power amplifiers is to abandon the idea of a linear stage entirely and use instead a switching scheme: imagine that the push-pull follower transistors $Q_{2}$ and $Q_{3}$ in Figure 2.72 are replaced with a pair of transistor switches, with one ON and the other ofF at any time, so that the output is switched completely to $+V_{\mathrm{CC}}$ or to $-V_{\mathrm{CC}}$ at any instant. Imagine also that these switches are operated at a high frequency (say at least 10 times the highest audio frequency) and that their relative timing is controlled (by techniques we'll see later, in Chapters $10-13$ ) such that the average output voltage is equal to the desired analog output. Finally, we add an $L C$ lowpass filter to kill the high switching signal, leaving the desired (lower-frequency) analog output intact.

This is a Class-D, or switching amplifier. It has the advantage of very high efficiency, because the switching transistors are either off (no current) or in saturation (near-zero voltage); that is, the power dissipated in the switching transistors (the product $V_{\mathrm{CE}} \times I_{\mathrm{C}}$ ) is always small. There's also no worry about thermal runaway. The downsides are the problems of emission of high-frequency noise, switching feedthrough to the output, and the difficulty of achieving excellent linearity.

Class-D amplifiers are nearly universal in inexpensive audio equipment, and they are increasingly finding their way into high-end audio equipment. Figure 2.73 shows measured waveforms of an inexpensive (and tiny!) class-D amplifier IC driving a $5 \Omega$ load with a sinewave at the high end of the audio range ( 20 kHz ). This particular IC uses a 250 kHz switching frequency, and can drive 20 watts each into a pair of stereo speakers; pretty much everything you need (except for the output $L C$ filters) is on the chip, which costs about $\$ 3$ in small quantities. Pretty neat.

### 2.4.2 Darlington connection

If you hook two transistors together as in Figure 2.74, the result - called a Darlington connection ${ }^{53}$ (or Darlington pair) - behaves like a single transistor with beta equal to the product of the two transistor betas. ${ }^{54}$ This can be very handy where high currents are involved (e.g., voltage regulators or power amplifier output stages), or for input stages

[^86]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0142.jpg?height=496&width=812&top_left_y=219&top_left_x=1066)

Figure 2.73. Class-D amplifier waveforms: a 20 kHz input sinewave controls the "duty cycle" (fraction of time the output is HIGH) of a push-pull switched output. These waveforms are from a TPA3123 stereo amplifier chip running from +15 V , and show the prefiltered PWM (pulse-width modulated) output, and the final smoothed output after the LC lowpass output filter. Horizontal: $10 \mu \mathrm{~s} / \mathrm{div}$.
of amplifiers where very high input impedance is necessary.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0142.jpg?height=307&width=401&top_left_y=1160&top_left_x=1269)

Figure 2.74. Darlington transistor configuration.
For a Darlington transistor the base-emitter drop is twice normal and the saturation voltage is at least one diode drop (since $Q_{1}$ 's emitter must be a diode drop above $Q_{2}$ 's emitter). Also, the combination tends to act like a rather slow transistor because $Q_{1}$ cannot turn off $Q_{2}$ quickly. This problem is usually taken care of by including a resistor from base to emitter of $Q_{2}$ (Figure 2.75). Resistor $R$ also prevents leakage current through $Q_{1}$ from biasing $Q_{2}$ into conduction; ${ }^{55}$ its value is chosen so that $Q_{1}$ 's leakage current (nanoamps for small-signal transistors, as much as hundreds of microamps for power transistors) produces less than a diode drop across $R$, and so that $R$ doesn't sink a large proportion of $Q_{2}$ 's base current when it has a diode drop across it. Typically $R$ might be a few hundred ohms in

[^87]a power transistor Darlington, or a few thousand ohms for a small-signal Darlington.

Darlington transistors are available as single packages, usually with the base-emitter resistor included. A typical example is the $n p n$ power Darlington MJH6284 (and pnp cousin MJH6287), with a current gain of 1000 (typical) at a collector current of 10 amps . Another popular power Darlington is the inexpensive $n p n$ TIP142 (and pnp cousin TIP147): these cost $\$ 1$ in small quantities and have typical $\beta=4000$ at $I_{\mathrm{C}}=5 \mathrm{~A}$. And for small-signal applications we like the widely available MPSA14 or MMBTA14 (in TO-92 and SOT23 packages, respectively), with a minimum beta of 10,000 at 10 mA and 20,000 at 100 mA . These 30 volt parts have no internal base-emitter resistor (so you can use them at very low currents); they cost less than $\$ 0.10$ in small quantities. Figure 2.76 shows beta versus collector current for these parts; note the pleasantly high values of beta, but with substantial dependence both on temperature and on collector current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0143.jpg?height=379&width=399&top_left_y=1035&top_left_x=323)

Figure 2.75. Improving turn-off speed in a Darlington pair. (The beta formula is valid as long as $R$ does not rob significant base current from $Q_{2}$.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0143.jpg?height=552&width=797&top_left_y=1630&top_left_x=122)

Figure 2.76. Typical beta versus collector current for the popular MPSA14 npn Darlington (adapted from the datasheet).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0143.jpg?height=371&width=534&top_left_y=218&top_left_x=1116)

Figure 2.77. Sziklai connection ("complementary Darlington").

#### A. Sziklai connection

A similar beta-boosting configuration is the Sziklai connection, ${ }^{56}$ sometimes referred to as a complementary Darlington (Figure 2.77). This combination behaves like an npn transistor, again with large beta. It has only a single base-emitter drop, but (like the Darlington) it also cannot saturate to less than a diode drop. A resistor from base to emitter of $Q_{2}$ is advisable, for the same reasons as with the Darlington (leakage current; speed; stability of $V_{\mathrm{BE}}$ ). This connection is common in push-pull power output stages in which the designer may wish to use one polarity of highcurrent output transistor only. However, even when used as complementary polarity pairs, it is generally to be preferred over the Darlington for amplifiers and other linear applications; that is because it has the advantage of a single $V_{\mathrm{BE}}$ drop (versus two), and that voltage drop is stabilized by the base-emitter resistor of the output transistor. For example, if $R_{\mathrm{B}}$ is chosen such that its current (with a nominal $V_{\mathrm{BE}}$ drop across it) is $25 \%$ of the output transistor's base current at peak output, then the driver transistor sees a collector current that ranges over only a factor of 5; so its $V_{\mathrm{BE}}$ (which is the Sziklai's $V_{\mathrm{BE}}$ ) varies only $40 \mathrm{mV}\left(V_{\mathrm{T}} \ln 5\right)$ over the full output current swing. The Sziklai configuration is discussed in more detail in Chapter 2x (see §2x.10); and you'll find nice examples of circuits that rely on the

[^88]Sziklai's unique properties in that chapter's section "BJT amplifier distortion: a SPICE exploration."

Figure 2.78 shows a nice example of a push-pull Sziklai output stage. This has an important advantage compared with the Darlington alternative, namely that the biasing of the $Q_{3} Q_{5}$ pair into class-AB conduction (to minimize crossover distortion) has just two base-emitter drops, rather than four; and, more importantly, $Q_{3}$ and $Q_{5}$ are running cool compared with the output transistors ( $Q_{4}$ and $Q_{6}$ ), so they can be relied upon to have a stable baseemitter drop. This allows higher quiescent currents than with the conventional Darlington, where you have to leave a larger safety margin; bottom line, lower distortion. ${ }^{57}$

In this circuit $Q_{2}$ functions as an "adjustable $V_{\mathrm{BE}}$ multiplier" for biasing, here settable from 1 to $3.5 V_{\mathrm{BE}}$ 's; it is bypassed at signal frequencies. Another circuit trick is the "bootstrapping" of $Q_{1}$ 's collector resistor by $C_{1}$ (see §2.4.3), raising its effective resistance at signal frequencies and increasing the amplifier's loop gain to produce lower distortion.

#### B. Superbeta transistor

The Darlington connection and its near relatives should not be confused with the so-called superbeta transistor, a device with very high current gain achieved through the manufacturing process. A typical superbeta transistor is the 2N5962, with a guaranteed minimum current gain of 450 at collector currents from $10 \mu \mathrm{~A}$ to 10 mA (see, for example, Table 8.1a on page 501. Superbeta matched pairs are available for use in low-level amplifiers that require matched characteristics, for example the differential amplifier of §2.3.8. Legendary examples are the LM394 and MAT-01 series; these provide high-gain $n p n$ transistor pairs whose $V_{\mathrm{BE}}$ 's are matched to a fraction of a millivolt (as little as $50 \mu \mathrm{~V}$ in the best versions) and whose betas are matched to about $1 \%$. The MAT-03 is a $p n p$ matched pair (see Table 8.1 b on page 502). Some commercial op-amps use superbeta differential input stages to achieve input (i.e., base bias) currents as low as 50 picoamps this way; examples are the LT1008 and LT1012.

### 2.4.3 Bootstrapping

When biasing an emitter follower, for instance, you choose the base voltage-divider resistors so that the divider presents a stiff voltage source to the base, i.e., their par-

[^89]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0144.jpg?height=904&width=855&top_left_y=219&top_left_x=1057)

Figure 2.78. Push-pull power stage with Sziklai-pair output transistors, capable of output swings to $\pm 70 \mathrm{~V}$ and output currents of $\pm 2 \mathrm{~A}$ peak.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0144.jpg?height=373&width=425&top_left_y=1316&top_left_x=1262)

Figure 2.79. Bias network lowers input impedance.
allel impedance is much less than the impedance looking into the base. For this reason the resulting circuit has an input impedance dominated by the voltage divider - the driving signal sees a much lower impedance than would otherwise be necessary. Figure 2.79 shows an example. The input resistance of about 9.1 k is mostly due to the voltagedivider impedance of 10 k . It is always desirable to keep input impedances high, and anyway it's a shame to load the input with the divider, which, after all, is only there to bias the transistor.
"Bootstrapping" is the colorful name given to a technique that circumvents this problem (Figure 2.80). The
transistor is biased by the divider $R_{1} R_{2}$ through series resistor $R_{3}$. Capacitor $C_{2}$ is chosen to have low impedance at signal frequencies compared with the bias resistors. As always, bias is stable if the dc impedance seen from the base (in this case 9.7 k ) is much less than the dc impedance looking into the base (in this case approximately 100k). But now the signal-frequency input impedance is no longer the same as the dc impedance. Look at it this way: an input wiggle $v_{\text {in }}$ results in an emitter wiggle $v_{\mathrm{E}} \approx v_{\mathrm{in}}$. So the change in current through bias resistor $R_{3}$ is $i=$ $\left(v_{\text {in }}-v_{\mathrm{E}}\right) / R_{3} \approx 0$, i.e., $Z_{\text {in }}$ (of the bias string) $=v_{\text {in }} / i_{\text {in }} \approx$ infinity. We've made the loading (shunt) impedance of the bias network very large at signal frequencies.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0145.jpg?height=415&width=516&top_left_y=790&top_left_x=257)

Figure 2.80. Raising the input impedance of an emitter follower at signal frequencies by bootstrapping the base bias divider.

Another way of seeing this is to notice that $R_{3}$ always has the same voltage across it at signal frequencies (since both ends of the resistor have the same voltage changes), i.e., it's a current source. But a current source has infinite impedance. In reality the effective impedance is less than infinity because the gain of a follower is slightly less than unity. That is so because the base-emitter drop depends on collector current, which changes with the signal level. You could have predicted the same result from the voltagedividing effect of the impedance looking into the emitter $\left[r_{\mathrm{e}}=25 / I_{\mathrm{C}}(\mathrm{mA})\right.$ ohms $]$ combined with the emitter resistor. If the follower has voltage gain $A$ (slightly less than unity), the effective value of $R_{3}$ at signal frequencies is

$$
R_{3} /(1-A)
$$

The voltage gain of a follower can be written $A=R_{\mathrm{L}} /\left(R_{\mathrm{L}}+r_{\mathrm{e}}\right)$, where $R_{\mathrm{L}}$ is the total load seen at the emitter (here $R_{1}\left\|R_{2}\right\| R_{4}$ ), so the effective value of bias resistor $R_{3}$ at signal frequencies can be written as $R_{3} \rightarrow$ $R_{3}\left(1+R_{\mathrm{L}} / r_{\mathrm{e}}\right)$. In practice the value of $R_{3}$ is effectively increased by a hundred or so, and the input impedance is then dominated by the transistor's base impedance. The emitterdegenerated amplifier can be bootstrapped in the same way,
since the signal on the emitter follows the base. The bias divider circuit is driven by the low-impedance emitter output at signal frequencies, which is what isolates the input signal from this usual task, and makes possible the beneficial increase of input impedance.

#### A. Bootstrapping collector load resistors

The bootstrap principle can be used to increase the effective value of a transistor's collector load resistor, if that stage drives a follower. That can increase the voltage gain of the stage substantially - recall that $G_{\mathrm{V}}=-g_{m} R_{\mathrm{C}}$, with $g_{m}=1 /\left(R_{\mathrm{E}}+r_{\mathrm{e}}\right)$. This technique is used in Figure 2.78, where we bootstrapped $Q_{1}$ 's collector load resistor $\left(R_{2}\right)$, forming an approximate current-source load. This serves two useful functions: (a) it raises the voltage gain of $Q_{1}$, and (b) it provides base drive current to $Q_{3} Q_{4}$ that does not drop off toward the top of the swing (as would a resistive load, just when you need it most).

### 2.4.4 Current sharing in paralleled BJTs

It's not unusual in power electronics design to find that the power transistor you've chosen is not able to handle the required power dissipation, and needs to share the job with additional transistors. This is a fine idea, but you need a way to ensure that each transistor handles an equal portion of the power dissipation. In $\S 9.13 .5$ we illustrate the use of transistors in series. This can simplify the problem, because we know they'll all be running at the same current. But it's often more attractive to divide up the current by connecting the transistors in parallel, as in Figure 2.81A.

There are two problems with this approach. First, we know the bipolar transistor is a transconductance device, with its collector current determined in a precise way by its base-to-emitter voltage $V_{\mathrm{BE}}$, as given by the Ebers-Moll equations 2.8 and 2.9. As we saw in $\S 2.3 .2$, the temperature coefficient of $V_{\mathrm{BE}}$ (at constant collector current) is about $-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$; or, equivalently, $I_{\mathrm{C}}$ increases with temperature for a fixed $V_{\mathrm{BE}} .{ }^{58}$ This is unfortunate, because if the junction of one of the transistors becomes hotter than the rest, it takes more of the total current, thereby heating up even more. It's in danger of the dreaded thermal runaway.

The second problem is that transistors of the same part number are not identical. They come off the shelf with

[^90]differing values of $V_{\mathrm{BE}}$ for a given $I_{\mathrm{C}}$. This is true even for parts made at the same time on the same fabrication line, and from the same silicon wafer. To see how large a variation you are likely to get, we measured 100 adjacent ZTX851 transistors on a reel, with an observed spread of about 17 mV , shown in Figure 8.44. This really represents a "best case," because you cannot be certain that a batch of incoming transistors derive from a single lot, much less a single wafer. When you first build something, the $V_{\mathrm{BE}}$ 's of "identical" transistors may be within $20-50 \mathrm{mV}$ of each other, but that matching is lost when one of them has to be replaced someday. It's always safer to assume a possible 100 mV or so spread of base-emitter voltages. Recalling that $\Delta V_{\mathrm{BE}}=60 \mathrm{mV}$ corresponds to a factor of ten current ratio, it's clear that you cannot get away with a direct parallel connection like Figure 2.81A.

The usual solution to this problem is the use of small resistors in the emitters, as shown in Figure 2.81B. These are called emitter-ballasting resistors, and their value is chosen to drop at least a few tenths of a volt at the higher end of the anticipated operating current range. That voltage drop must be adequate to swamp the $V_{\mathrm{BE}}$ spread of the individual transistors, and is ordinarily chosen somewhere in the range of $300-500 \mathrm{mV}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0146.jpg?height=358&width=687&top_left_y=1316&top_left_x=279)

Figure 2.81. To equalize the currents of parallel transistors, use emitter ballasting resistors $R_{\mathrm{E}}$, as in circuit B .

At high currents the resistors may suffer from an inconveniently-high power dissipation, so you may want to use the current-sharing trick shown in Figure 2.82. Here the current-sensing transistors $Q_{4}-Q_{6}$ adjust the base drive to the "paralleled" power transistors $Q_{1}-Q_{3}$ to maintain equal emitter currents (you can think of $Q_{4}-Q_{6}$ as a high-gain differential amplifier with three inputs). This "active ballast" technique works well with power Darlington BJTs, and it works particularly well with MOSFETs (see Figure 3.117), thanks to their negligible input (gate) current, thus making

MOSFETs a good choice for circuits with lots of power dissipation. ${ }^{59}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0146.jpg?height=555&width=707&top_left_y=340&top_left_x=1116)

Figure 2.82. Active ballasting of parallel transistors $Q_{1}-Q_{3}$ via feedback from current sensing transistors $Q_{4}-Q_{6}$ lets you configure a parallel power transistors with very low drops across the emitter resistors.

### 2.4.5 Capacitance and Miller effect

In our discussion so far we have used what amounts to a dc, or low-frequency, model of the transistor. Our simple current amplifier model and the more sophisticated EbersMoll transconductance model both deal with voltages, currents, and resistances seen at the various terminals. With these models alone we have managed to go quite far, and in fact these simple models contain nearly everything you will ever need to know to design transistor circuits. However, one important aspect that has serious impact on highspeed and high-frequency circuits has been neglected: the existence of capacitance in the external circuit and in the transistor junctions themselves. Indeed, at high frequencies the effects of capacitance often dominate circuit behavior; at 100 MHz a typical junction capacitance of 5 pF has an impedance of just $320 \Omega$ !

In this brief subsection we introduce the problem, illustrate some of its circuit incarnations, and suggest some methods of circumventing its effects. It would be a mistake to leave this chapter without realizing the nature of this problem. In the course of this brief discussion we will encounter the infamous Miller effect, and the use of configurations such as the cascode to overcome it.

[^91]
#### A. Junction and circuit capacitance

Capacitance limits the speed at which the voltages within a circuit can swing ("slew rate"), owing to finite driving impedance or current. When a capacitance is driven by a finite source resistance, you see $R C$ exponential charging behavior, whereas a capacitance driven by a current source leads to slew-rate-limited waveforms (ramps). As general guidance, reducing the source impedances and load capacitances and increasing the drive currents within a circuit will speed things up. However, there are some subtleties connected with feedback capacitance and input capacitance. Let's take a brief look.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0147.jpg?height=550&width=554&top_left_y=735&top_left_x=223)

Figure 2.83. Junction and load capacitances in a transistor amplifier.

The circuit in Figure 2.83 illustrates most of the problems of junction capacitance. The output capacitance forms a time constant with the output resistance $R_{\mathrm{L}}$ ( $R_{\mathrm{L}}$ includes both the collector and load resistances, and $C_{\mathrm{L}}$ includes both junction and load capacitances), giving a rolloff starting at some frequency $f=1 / 2 \pi R_{\mathrm{L}} C_{\mathrm{L}}$.

The same is true for the input capacitance, $C_{\mathrm{be}}$, in combination with the source impedance $R_{\mathrm{S}}$. Of greater significance, at high frequencies the input capacitance robs base current, effectively decreasing the transistor's beta. In fact, transistor datasheets specify a cutoff frequency, $f_{\mathrm{T}}$, at which the beta has decreased to unity - not much of an amplifier anymore! We discuss this further in Chapter $2 x$.

#### B. Miller effect

The feedback impedance $C_{\mathrm{cb}}$ is another matter. The amplifier has some overall voltage gain $G_{\mathrm{V}}$, so a small voltage wiggle at the input results in a wiggle $G_{\mathrm{V}}$ times larger (and inverted) at the collector. This means that the signal source sees a current through $C_{\mathrm{cb}}$ that is $G_{\mathrm{V}}+1$ times as large as if $C_{\mathrm{cb}}$ were connected from base to ground; i.e., for the pur-
pose of input rolloff frequency calculations, the feedback capacitance behaves like a capacitor of value $C_{\mathrm{cb}}\left(G_{\mathrm{V}}+\right.$ 1) from input to ground. This effective increase of $C_{\mathrm{cb}}$ is known as the Miller effect. It often dominates the rolloff characteristics of amplifiers, because a typical feedback capacitance of 4 pF can look like several hundred picofarads to ground.

There are several methods available for beating the Miller effect: (a) you can decrease the source impedance driving a grounded-emitter stage by using an emitter follower. Figure 2.84 shows three other possibilities; (b) the differential amplifier circuit with no collector resistor in $Q_{1}$ (Figure 2.84A) has no Miller effect; you can think of it as an emitter follower driving a grounded-base amplifier (see below); (c) the famous cascode configuration (Figure 2.84B) elegantly defeats the Miller effect. Here $Q_{1}$ is a grounded-emitter amplifier with $R_{\mathrm{L}}$ as its collector resistor: $Q_{2}$ is interposed in the collector path to prevent $Q_{1}$ 's collector from swinging (thereby eliminating the Miller effect) while passing the collector current through to the load resistor unchanged. The input labeled $V_{+}$is a fixed-bias voltage, usually set a few volts above $Q_{1}$ 's emitter voltage to pin $Q_{1}$ 's collector and keep it in the active region. This circuit fragment is incomplete, because biasing is not shown; you could either include a bypassed emitter resistor and base divider for biasing $Q_{1}$ (as we did earlier in the chapter) or include it within an overall loop with feedback at dc. $V_{+}$might be provided from a divider or zener, with bypassing to keep it stiff at signal frequencies. (d) Finally, the grounded-base amplifier can be used by itself, as shown in Figure 2.84C. It has no Miller effect because the base is driven by zero source impedance (ground), and the amplifier is noninverting from input to output.

Exercise 2.19. Explain in detail why there is no Miller effect in either transistor in the preceding differential amplifier and cascode circuits.

Capacitive effects can be somewhat more complicated than this brief introduction might indicate. In particular: (a) the rolloffs that are due to feedback and output capacitances are not entirely independent; in the terminology of the trade there is pole splitting; (b) the transistor's input capacitance still has an effect, even with a stiff input signal source. In particular, current that flows through $C_{\text {be }}$ is not amplified by the transistor. This base current "robbing" by the input capacitance causes the transistor's small-signal current gain $h_{\mathrm{fe}}$ to drop at high frequencies, eventually reaching unity at a frequency known as $f_{\mathrm{T}}$. (c) To complicate matters, the junction capacitances depend on voltage: a dominant portion of $C_{\mathrm{be}}$ changes proportionally with
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0148.jpg?height=532&width=1430&top_left_y=201&top_left_x=377)

Figure 2.84. Three circuit configurations that avoid the Miller effect. A. Differential amplifier with inverting input grounded. B. Cascode connection. C. Grounded base amplifier.
operating current, so $f_{\mathrm{T}}$ is given instead. ${ }^{60}$ (d) When a transistor is operated as a switch, effects associated with charge stored in the base region of a saturated transistor cause an additional loss of speed.

The Miller effect looms large in high-speed and wideband circuits, and we'll be seeing it again and again in subsequent chapters.

### 2.4.6 Field-effect transistors

In this chapter we have dealt exclusively with BJTs, characterized by the Ebers-Moll equation. BJTs were the original transistors, and they are widely used in analog circuit design. However, it would be a mistake to continue without a few words of explanation about the other kind of transistor, the FET, which we will take up in detail in Chapter 3.

The FET behaves in many ways like an ordinary bipolar transistor. It is a three-terminal amplifying device, available in both polarities, with a terminal (the gate) that controls the current flow between the other two terminals (source and drain). It has a unique property, though: the gate draws no dc current, except for leakage. This means that extremely high input impedances are possible, limited only by capacitance and leakage effects. With FETs you don't have to worry about providing substantial base current, as was necessary with the BJT circuit design of this chapter. Input currents measured in picoamperes are commonplace. Yet the FET is a rugged and capable device, with voltage and current ratings comparable to those of bipolar transistors.

Most of the available devices fabricated with BJTs

[^92](matched pairs, differential and operational amplifiers, comparators, high-current switches and amplifiers, and RF amplifiers) are also available with FET construction, often with superior performance. Furthermore, digital logic, microprocessors, memory, and all manner of complex and wonderful large-scale digital chips are built almost exclusively with FETs. Finally, the area of micropower design is dominated by FET circuits. It is not exaggeration to say that, demographically, almost all transistors are FETs. ${ }^{61}$

FETs are so important in electronic design that we devote the next chapter to them before treating operational amplifiers and feedback in Chapter 4. We urge the reader to be patient with us as we lay the groundwork in these first three difficult chapters; that patience will be rewarded many times over in the succeeding chapters, as we explore the enjoyable topics of circuit design with operational amplifiers and digital integrated circuits.

## 2.5 Negative feedback

We've hinted earlier in the chapter that feedback offers a cure to some vexing problems: biasing the groundedemitter amplifier (\$2.3.4 and 2.3.5), biasing the differential amplifier with current-mirror active load (§2.3.8C), and minimizing crossover distortion in push-pull followers (§2.4.1A). It's even better than that - negative feedback

[^93]is a wonderful technique that can cure all manner of ills: distortion and nonlinearities, frequency dependence of amplifier gain, departure from ideal performance of voltage sources, current sources, or pretty much anything else.

We'll be enjoying the benefits of negative feedback fully in Chapter 4, where we introduce the universal analog component called an operational amplifier ("op-amp"), a creature that thrives on negative feedback. But this is a good place to introduce feedback, both because it is widely used in discrete transistor circuits and also because it is present already in our common emitter amplifier, whose improved linearity (compared with that of the grounded-emitter amplifier) is due to negative feedback.

### 2.5.1 Introduction to feedback

Feedback has become such a well-known concept that the word has entered the general vocabulary. In control systems, feedback consists of comparing the actual output of the system with the desired output and making a correction accordingly. The "system" can be almost anything: for instance, the process of driving a car down the road, in which the output (the position and velocity of the car) is sensed by the driver, who compares it with expectations and makes corrections to the input (steering wheel, throttle, brake). In amplifier circuits the output should be a multiple of the input, so in a feedback amplifier the input is compared with an attenuated version of the output.

As used in amplifiers, negative feedback is implemented simply by coupling the output back in such a way as to cancel some of the input. You might think that this would only have the effect of reducing the amplifier's gain and would be a pretty stupid thing to do. Harold S. Black, who attempted to patent negative feedback in 1928, was greeted with the same response. In his words, "Our patent application was treated in the same manner as one for a perpetual-motion machine." ${ }^{62}$ True, it does lower the gain, but in exchange it also improves other characteristics, most notably freedom from distortion and nonlinearity, flatness of response (or conformity to some desired frequency response), and predictability. In fact, as more negative feedback is used, the resultant amplifier characteristics become less dependent on the characteristics of the open-loop (nofeedback) amplifier and finally depend on the properties only of the feedback network itself. Operational amplifiers

[^94](the very high-gain differential amplifier building blocks of Chapter 4) are typically used in this high-loop-gain limit, with open-loop voltage gain (no feedback) of a million or so.

A feedback network can be frequency dependent, to produce an equalization amplifier (with specific gain-versus-frequency characteristics), or it can be amplitude dependent, producing a nonlinear amplifier (an example is a logarithmic amplifier, built with feedback that exploits the logarithmic $V_{\mathrm{BE}}$ versus $I_{\mathrm{C}}$ of a diode or transistor). It can be arranged to produce a current source (near-infinite output impedance) or a voltage source (near-zero output impedance), and it can be connected to generate very high or very low input impedance. Speaking in general terms, the property that is sampled to produce feedback is the property that is improved. Thus, if you feed back a signal proportional to the output current, you will generate a good current source. ${ }^{63}$

Let's look at how feedback works, and how it affects what an amplifier does. We will find simple expressions for the input impedance, output impedance, and gain of an amplifier with negative feedback.

### 2.5.2 Gain equation

Look at Figure 2.85. To get started we've drawn the familiar common-emitter amplifier with emitter degeneration. Thinking of the transistor in the Ebers-Moll sense, the small-signal voltage from base to emitter ( $\Delta V_{\mathrm{BE}}$ ) programs the collector current. But $\Delta V_{\mathrm{BE}}$ is less than the input voltage $V_{\mathrm{in}}$, because of the drop across $R_{\mathrm{E}}$. If the output is unloaded, it's easy to get the equation in the figure. In other words, the common-emitter amplifier with emitter degeneration is a grounded-emitter amplifier with negative feedback, as we hinted earlier.

This circuit has some subtleties, which we'd like to sidestep for now by looking instead at the more straightforward configuration shown in Figure 2.85B. Here we've drawn a differential amplifier (with differential gain $A$ ), with a fraction of its output signal subtracted from the circuit input $v_{\text {in }}$. That fraction, of course, is given simply by

[^95]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0150.jpg?height=838&width=822&top_left_y=220&top_left_x=201)
B. $V_{\text {diff }}=V_{\text {in }}-\frac{R_{2}}{R_{1}+R_{2}} V_{\text {out }}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0150.jpg?height=233&width=561&top_left_y=1159&top_left_x=268)
C.
$$
V_{\text {diff }}=V_{\text {in }}-B V_{\text {out }}
$$

Figure 2.85. Negative feedback subtracts a fraction of the output from the input: A. Common-emitter amplifier. B. Differential amplifier configured as a noninverting voltage amplifier. C. Conventional block diagram.
the voltage divider equation, as shown. This is a very common configuration, widely used with op-amps (Chapter 4), and known simply as a "noninverting amplifier."

When talking about negative feedback, it's conventional to draw a diagram like Figure 2.85 C , in which the feedback fraction is simply labeled $B$. This is useful because it allows more generality than a voltage divider (feedback can include frequency-dependent components like capacitors, and nonlinear components like diodes), and it keeps the equations simple. For a voltage divider, of course, $B$ would simply be equal to $R_{2} /\left(R_{1}+R_{2}\right)$.

Let's figure out the gain. The amplifier has open-loop voltage gain $A$, and the feedback network subtracts a fraction $B$ of the output voltage from the input. (Later we will generalize things so that inputs and outputs can be currents
or voltages.) The input to the gain block is then $V_{\text {in }}-B V_{\text {out }}$. But the output is just the input times $A$ :

$$
A\left(V_{\text {in }}-B V_{\text {out }}\right)=V_{\text {out }} .
$$

In other words,

$$
V_{\text {out }}=\frac{A}{1+A B} V_{\text {in }}
$$

and so the closed-loop voltage gain, $V_{\text {out }} / V_{\mathrm{in}}$, is just

$$
\begin{equation*}
G=\frac{A}{1+A B} \tag{2.16}
\end{equation*}
$$

Some terminology: the standard designations for these quantities are as follows: $G=$ closed-loop gain, $A=$ openloop gain, $A B=$ loop gain, $1+A B=$ return difference, or desensitivity. The feedback network is sometimes called the beta network (no relation to transistor beta, $h_{\mathrm{fe}}$ ). ${ }^{64}$

### 2.5.3 Effects of feedback on amplifier circuits

Let's look at the important effects of feedback. The most significant are predictability of gain (and reduction of distortion), changed input impedance, and changed output impedance.

#### A. Predictability of gain

The voltage gain is $G=A /(1+A B)$. In the limit of infinite ${ }^{65}$ open-loop gain $A, G=1 / B$. For finite gain $A$, feedback acts to reduce the effects of variations of $A$ (with frequency, temperature, amplitude, etc.). For instance, suppose $A$ depends on frequency as in Figure 2.86. This will surely satisfy anyone's definition of a poor amplifier (the gain varies over a factor of 10 with frequency). Now imagine we introduce feedback, with $B=0.1$ (a simple voltage divider will do). The closed-loop voltage gain now varies from 1000/[1 $+(1000 \times 0.1)]$, or 9.90 , to $10,000 /[1$ $+(10,000 \times 0.1)]$, or 9.99 , a variation of just $1 \%$ over the same range of frequency! To put it in audio terms, the original amplifier is flat to $\pm 10 \mathrm{~dB}$, whereas the feedback amplifier is flat to $\pm 0.04 \mathrm{~dB}$. We can now recover the original gain of 1000 with nearly this linearity simply by cascading three such stages.

It was for just this reason (namely, the need for extremely flat-response telephone repeater amplifiers) that

[^96]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0151.jpg?height=266&width=531&top_left_y=219&top_left_x=260)

Figure 2.86. Amplifier with open-loop gain $A$ that varies widely with frequency $f$.
negative feedback in electronics was invented. As the inventor, Harold Black, described it in his first open publication on the invention [Elec. Eng., 53, 114, (1934)], "by building an amplifier whose gain is made deliberately, say 40 decibels higher than necessary ( 10,000 -fold excess on energy basis) and then feeding the output back to the input in such a way as to throw away the excess gain, it has been found possible to effect extraordinary improvement in constancy of amplification and freedom from nonlinearity." Black's patent is spectacular, with dozens of elegant figures; we reproduce one of them here (Figure 2.87), which makes the point eloquently.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0151.jpg?height=608&width=718&top_left_y=1153&top_left_x=161)

Figure 2.87. Harold Black explains it in his historic 1937 patent, with the unassuming title "Wave translation system."

It is easy to show, by taking the partial derivative of $G$ with respect to $A$ (i.e., $\partial G / \partial A$ ), that relative variations in the open-loop gain are reduced by the desensitivity:

$$
\begin{equation*}
\frac{\Delta G}{G}=\frac{1}{1+A B} \frac{\Delta A}{A} . \tag{2.17}
\end{equation*}
$$

Thus, for good performance the loop gain $A B$ should be much larger than 1 . That's equivalent to saying that the open-loop gain should be much larger than the closed-loop gain.

A very important consequence of this is that nonlinearities, which are simply gain variations that depend on signal level, are reduced in exactly the same way.

#### B. Input impedance

Feedback can be arranged to subtract a voltage or a current from the input (these are sometimes called series feedback and shunt feedback, respectively). The noninverting amplifier configuration we've been considering, for instance, subtracts a sample of the output voltage from the differential voltage appearing at the input, whereas the feedback scheme in Figure 2.89B subtracts a current from the input. The effects on input impedance are opposite in the two cases: voltage feedback multiplies the open-loop input impedance by $1+A B$, whereas current feedback reduces it by the same factor. In the limit of infinite loop gain the input impedance (at the amplifier's input terminal) goes to infinity or zero, respectively. This is easy to understand, since voltage feedback tends to subtract signal from the input, resulting in a smaller change (by the factor $A B$ ) across the amplifier's input resistance; it's a form of bootstrapping. Current feedback reduces the input signal by bucking it with an equal current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0151.jpg?height=407&width=609&top_left_y=1220&top_left_x=1068)

Figure 2.88. Series-feedback input impedance.

#### Series (voltage) feedback

Let's see explicitly how the effective input impedance is changed by feedback. We illustrate the case of voltage feedback only, since the derivations are similar for the two cases. We begin with a differential amplifier model with (finite) input resistance as shown in Figure 2.88. An input $V_{\text {in }}$ is reduced by $B V_{\text {out }}$, putting a voltage $V_{\text {diff }}=V_{\text {in }}-B V_{\text {out }}$ across the inputs of the amplifier. The input current is therefore

$$
I_{\text {in }}=\frac{V_{\text {in }}-B V_{\text {out }}}{R_{i}}=\frac{V_{\text {in }}\left(1-B \frac{A}{1+A B}\right)}{R_{i}}=\frac{V_{\text {in }}}{(1+A B) R_{i}},
$$

giving an effective input impedance

$$
Z_{\text {in }}=V_{\text {in }} / I_{\text {in }}=(1+A B) R_{i} .
$$

In other words, the input impedance is boosted by a factor of the loop gain plus one. If you were to use the circuit of Figure 2.85B to close the feedback loop around a differential amplifier whose native input impedance is $100 \mathrm{k} \Omega$ and whose differential gain is $10^{4}$, choosing the resistor ratio (99:1) for a target gain of 100 (in the limit of infinite amplifier gain), the input impedance seen by the signal source would be approximately $10 \mathrm{M} \Omega$, and the closed-loop gain would be 99.66

#### Shunt (current) feedback

Look at Figure 2.89A. The impedance seen looking into the input of a voltage amplifier with current feedback is reduced by the feedback current, which opposes voltage changes at the input. ${ }^{67}$ By considering the current change produced by a voltage change at the input, you find that the input signal sees a parallel combination of (a) the amplifier's native input impedance $R_{\mathrm{i}}$ and (b) the feedback resistor $R_{\mathrm{f}}$ divided by $1+A$. That is,

$$
Z_{\mathrm{in}}=R_{\mathrm{i}} \| \frac{R_{\mathrm{f}}}{1+A}
$$

(see if you can prove this). In cases of very high loop gain (e.g, an op-amp), the input impedance is reduced to a fraction of an ohm, which might seem bad. But in fact this configuration is used to convert an input current into an output voltage (a "transresistance amplifier"), for which a low input impedance is a good characteristic. We'll see examples in Chapters 4 and $4 x$.

By the addition of an input resistor (Figure 2.89B) the circuit becomes an "inverting amplifier," with input resistance as shown. You can think of this (particularly in the high-loop-gain limit) as a resistor feeding a current-tovoltage amplifier. In that limit $R_{\mathrm{in}}$ approximately equals $R_{1}$ (and the closed-loop gain approximately equals $-R_{2} / R_{1}$ ).

It is a straightforward exercise to derive an expression for the closed-loop voltage gain of the inverting amplifier with finite loop gain. The answer is

$$
G=-A(1-B) /(1+A B)
$$

where $B$ is defined as before, $B=R_{1} /\left(R_{1}+R_{2}\right)$. In the limit of large open-loop gain $A, G=1-1 / B$ (i.e., $\left.G=-R_{2} / R_{1}\right)$.

[^97]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0152.jpg?height=989&width=667&top_left_y=218&top_left_x=1136)

Figure 2.89. Input and output impedances for (A) transresistance amplifier and ( B ) inverting amplifier.

Exercise 2.20. Derive the foregoing expressions for input impedance and gain of the inverting amplifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0152.jpg?height=414&width=575&top_left_y=1484&top_left_x=1182)

Figure 2.90. Output impedance.

#### C. Output impedance

Again, feedback can extract a sample of the output voltage or the output current. In the first case the open-loop output impedance will be reduced by the factor $1+A B$, whereas in the second case it will be increased by the same factor. We illustrate this effect for the case of voltage sampling.

We begin with the model shown in Figure 2.90. This time we have shown the output impedance explicitly. The calculation is simplified by a trick: short the input and apply a voltage $V$ to the output; by calculating the output current $I$, we get the output impedance $R_{\mathrm{o}}^{\prime}=V / I$. Voltage $V$ at the output puts a voltage $-B V$ across the amplifier's input, producing a voltage $-A B V$ in the amplifier's internal generator. The output current is therefore

$$
I=\frac{V-(-A B V)}{R_{\mathrm{o}}}=\frac{V(1+A B)}{R_{\mathrm{o}}}
$$

giving an effective output impedance ${ }^{68}$ of

$$
Z_{\text {out }}=V / I=R_{\mathrm{o}} /(1+A B) .
$$

#### D. Sensing output current

Feedback can be connected instead to sample the output current. Then the expression for output impedance becomes

$$
Z_{\text {out }}=R_{\mathrm{o}}(1+A B)
$$

In fact, it is possible to have multiple feedback paths, sampling both voltage and current. In the general case the output impedance is given by Blackman's impedance relation ${ }^{69}$

$$
Z_{\mathrm{out}}=R_{\mathrm{o}} \frac{1+(A B)_{\mathrm{SC}}}{1+(A B)_{\mathrm{OC}}}
$$

where $(A B)_{\mathrm{SC}}$ is the loop gain with the output shorted to ground and $(A B)_{\mathrm{OC}}$ is the loop gain with no load attached. Thus feedback can be used to generate a desired output impedance. This equation reduces to the previous results for the usual situation in which feedback is derived from either the output voltage or the output current. See additional discussion in Chapter $2 x$.

### 2.5.4 Two important details

Feedback is a rich subject, which we've simplified shamelessly in this brief introduction. Here are two details that should not be overlooked, however, even at this somewhat superficial level of understanding.

[^98]
#### A. Loading by the feedback network

In feedback computations, you usually assume that the beta network doesn't load the amplifier's output. If it does, that must be taken into account in computing the open-loop gain. Likewise, if the connection of the beta network at the amplifier's input affects the open-loop gain (feedback removed, but network still connected), you must use the modified open-loop gain. Finally, the preceding expressions assume that the beta network is unidirectional, i.e., it does not couple any signal from the input to the output.

#### B. Phase shifts, stability, and "compensation"

The open-loop amplifier gain $A$ is central in the expressions we've found for closed-loop gain and the corresponding input and output impedances. By default one might reasonably assume that $A$ is a real number - that is, that the output is in phase with the input. In real life things are more complex, ${ }^{70}$ because of the effects of circuit capacitances (and Miller effect, §2.4.5), and also the limited bandwidth ( $f_{\mathrm{T}}$ ) of the active components themselves. The result is that the open-loop amplifier will exhibit lagging phase shifts that increase with frequency. This has several consequences for the closed-loop amplifier.

#### Stability

If the open-loop amplifier's lagging phase shift reaches $180^{\circ}$, then negative feedback becomes positive feedback, with the possibility of oscillation. This is not what you want! (The actual criterion for oscillation is that the phase shift be $180^{\circ}$ at a frequency at which the loop gain $A B$ equals 1.) This is a serious concern, particularly in amplifiers with plenty of gain (such as op-amps). The problem is only exacerbated if the feedback network contributes additional lagging phase shift (as it often will). The subject of frequency compensation in feedback amplifiers deals directly with this essential issue; you can read about it in §4.9.

#### Gain and phase shift

The expressions we found for closed-loop gain and for the input and output impedances contain the open-loop gain A. For example, the voltage amplifier with series feedback (Figures 2.85B\&C, 2.88, and 2.90) has closed-loop gain $G_{\text {CL }}=A /(1+A B)$, where $A=G_{\text {OL }}$, the amplifier's openloop gain. Let's imagine that the open-loop gain $A$ is 100, and that we've chosen $B=0.1$ for a target closed-loop gain of $G_{\mathrm{CL}} \approx 10$. Now, if the open-loop amplifier had no phase shifts, then $G_{\text {CL }} \approx 9.09$, also without phase shift. If instead the amplifier has a $90^{\circ}$ lagging phase shift, then $A$ is pure

[^99]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0154.jpg?height=787&width=1087&top_left_y=216&top_left_x=502)

Figure 2.91. Transistor power amplifier with negative feedback.
imaginary $(A=-100 j)$, and the closed-loop gain becomes $G_{\mathrm{CL}}=9.90-0.99 j$. That's a magnitude $\left|G_{\mathrm{CL}}\right|=9.95$, with a lagging phase shift of approximately $6^{\circ}$. In other words, the effect of a pretty significant (halfway to oscillation!) open-loop phase shift turns out, in fact, to be favorable: the closed-loop gain is only $0.5 \%$ less than the target, compared with $9 \%$ for the case of the same amplifier without phase shift. The price you pay is some residual phase shift and, of course, an approach to instability.

As artificial as this example may seem, it in fact reflects a reality of op-amps, which usually have an $\sim 90^{\circ}$ lagging phase shift over almost their entire bandwidth (typically from $\sim 10 \mathrm{~Hz}$ to 1 MHz or more). Because of their much higher open-loop gain, the amplifier with feedback exhibits very little phase shift, and an accurate gain set almost entirely by the feedback network. Much more on this in Chapter 4, and in $\S 4.9$.

Exercise 2.21. Verify that the above expressions for $G_{\text {CL }}$ are correct.

### 2.5.5 Two examples of transistor amplifiers with feedback

Let's look at two transistor amplifier designs to see how the performance is affected by negative feedback. There's a bit of complexity in this analysis ... don't be discouraged! ${ }^{71}$

[^100]Figure 2.91 shows a complete transistor amplifier with negative feedback. Let's see how it goes.

#### A. Circuit description

It may look complicated, but it is extremely straightforward in design and is relatively easy to analyze. $Q_{1}$ and $Q_{2}$ form a differential pair, with common-emitter amplifier $Q_{3}$ amplifying its output. $R_{6}$ is $Q_{3}$ 's collector load resistor, and push-pull pair $Q_{4}$ and $Q_{5}$ form the output emitter follower. The output voltage is sampled by the feedback network consisting of voltage divider $R_{4}$ and $R_{5}$, with $C_{2}$ included to reduce the gain to unity at dc for stable biasing. $R_{3}$ sets the quiescent current in the differential pair, and since overall feedback guarantees that the quiescent output voltage is at ground, $Q_{3}$ 's quiescent current is easily seen to be 10 mA ( $V_{\mathrm{EE}}$ across $R_{6}$, approximately). As we discussed earlier (§2.4.1B), the diodes bias the push-pull pair into conduction, leaving one diode drop across the series pair $R_{7}$ and $R_{8}$, i.e., 60 mA quiescent current. That's classAB operation, good for minimizing crossover distortion, at the cost of 1 watt standby dissipation in each output transistor.

From the point of view of our earlier circuits, the only unusual feature is $Q_{1}$ 's quiescent collector voltage, one diode drop below $V_{\mathrm{CC}}$. That is where it must sit in order to hold $Q_{3}$ in conduction, and the feedback path ensures that it will. (For instance, if $Q_{1}$ were to pull its collector closer to ground, $Q_{3}$ would conduct heavily, raising the output
voltage, which in turn would force $Q_{2}$ to conduct more heavily, reducing $Q_{1}$ 's collector current and hence restoring the status quo.) $R_{2}$ was chosen to give a diode drop at $Q_{1}$ 's quiescent current in order to keep the collector currents in the differential pair approximately equal at the quiescent point. In this transistor circuit the input bias current is not negligible $(4 \mu \mathrm{~A})$, resulting in a 0.4 V drop across the 100 k input resistors. In transistor amplifier circuits like this, in which the input currents are considerably larger than in op-amps, it is particularly important to make sure that the dc resistances seen from the inputs are equal, as shown (a Darlington input stage would probably be better here).

#### B. Analysis

Let's analyze this circuit in detail, determining the gain, input and output impedances, and distortion. To illustrate the utility of feedback, we will find these parameters for both the open-loop and closed-loop situations (recognizing that biasing would be hopeless in the open-loop case). To get a feeling for the linearizing effect of the feedback, the gain will be calculated at +10 volts and -10 volts output, as well as at the quiescent point $(0 \mathrm{~V})$.

#### Open loop

Input impedance We cut the feedback at point $X$ and ground the right-hand side of $R_{4}$. The input signal sees 100k in parallel with the impedance looking into the base. The latter is $h_{\mathrm{fe}}$ times twice the intrinsic emitter resistance plus the impedance seen at $Q_{2}$ 's emitter caused by the finite impedance of the feedback network at $Q_{2}$ 's base. For $h_{\mathrm{fe}} \approx 250, Z_{\mathrm{in}} \approx 250 \times[(2 \times 25)+(3.3 \mathrm{k} / 250)]$; i.e., $Z_{\text {in }} \approx 16 \mathrm{k}$.

Output impedance Since the impedance looking back into $Q_{3}$ 's collector is high, the output transistors are driven by a 1.5 k source $\left(R_{6}\right)$. The output impedance is about $15 \Omega$ ( $\beta \approx 100$ ) plus the $5 \Omega$ emitter resistance, or $20 \Omega$. The intrinsic emitter resistance of $0.4 \Omega$ is negligible.

Gain The differential input stage sees a load of $R_{2}$ paralleled by $Q_{3}$ 's base resistance. Since $Q_{3}$ is running 10 mA quiescent current, its intrinsic emitter resistance is $2.5 \Omega$, giving a base impedance of about $250 \Omega$ (again, $\beta \approx 100$ ). The differential pair thus has a gain of

$$
\frac{250 \| 620}{2 \times 25 \Omega} \text { or } 3.5
$$

The second stage, $Q_{3}$, has a voltage gain of $1.5 \mathrm{k} \Omega / 2.5 \Omega$, or 600. The overall voltage gain at the quiescent point is $3.5 \times 600$, or 2100 . Since $Q_{3}$ 's gain depends on its collector current, there is substantial change of gain with signal
swing, i.e., nonlinearity. The gain is tabulated in the following section for three values of output voltage.

Closed loop
Input impedance This circuit uses series feedback, so the input impedance is raised by $(1+$ loop gain $)$. The feedback network is a voltage divider with $B=1 / 30$ at signal frequencies, so the loop gain $A B$ is 70 . The input impedance is therefore $70 \times 16 \mathrm{k}$, still paralleled by the 100 k bias resistor, i.e., about 92 k . The bias resistor now dominates the input impedance.

Output impedance Since the output voltage is sampled, the output impedance is reduced by $(1+$ loop gain $)$. The output impedance is therefore $0.3 \Omega$. Note that this is a small-signal impedance and does not mean that a $1 \Omega$ load could be driven to nearly full swing, for instance. The $5 \Omega$ emitter resistors in the output stage limit the large signal swing. For instance, a $4 \Omega$ load could be driven only to 10 Vpp , approximately.

Gain The gain is $A /(1+A B)$. At the quiescent point that equals 30.84, using the exact value for $B$. To illustrate the gain stability achieved with negative feedback, the overall voltage gain of the circuit with and without feedback is tabulated at three values of output level at the end of this paragraph. It should be obvious that negative feedback has brought about considerable improvement in the amplifier's characteristics, although in fairness it should be pointed out that the amplifier could have been designed for better open-loop performance, e.g., by using a current source for $Q_{3}$ 's collector load and degenerating its emitter, by using a current source for the differential-pair emitter circuit, etc. Even so, feedback would still make a large improvement.

|  | Open loop |  |  |  | Closed loop |  |  |
| :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| $V_{\text {out }}$ | -10 | 0 | +10 | -10 | 0 | +10 |  |
| $\mathbf{Z}_{\text {in }}$ | 16 k | 16 k | 16 k | 92 k | 92 k | 92 k |  |
| $\mathbf{Z}_{\text {out }}$ | $20 \Omega$ | $20 \Omega$ | $20 \Omega$ | $0.3 \Omega$ | $0.3 \Omega$ | $0.3 \Omega$ |  |
| Gain | 1360 | 2100 | 2400 | 30.60 | 30.84 | 30.90 |  |

#### C. Series-feedback pair

Figure 2.92 shows another transistor amplifier with feedback. Thinking of $Q_{1}$ as an amplifier of its base-emitter voltage drop (thinking in the Ebers-Moll sense), the feedback samples the output voltage and subtracts a fraction of it from the input signal. This circuit is a bit tricky because $Q_{2}$ 's collector resistor doubles as the feedback network. Applying the techniques we used earlier, one can show that $G($ open loop $) \approx 200$, loop gain $\approx 20, Z_{\text {out }}($ open
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0156.jpg?height=516&width=608&top_left_y=219&top_left_x=326)

Figure 2.92. Series-feedback pair.
loop $) \approx 10 \mathrm{k}, Z_{\text {out }}($ closed loop $) \approx 500 \Omega$, and $G($ closed loop) $\approx 9.5$.

Exercise 2.22. Go for it!

## 2.6 Some typical transistor circuits

To illustrate some of the ideas of this chapter, let's look at a few examples of circuits with transistors. The range of circuits we can cover at this point is necessarily limited, because real-world circuits usually incorporate op-amps (the subject of Chapter 4) and other useful ICs - but we'll see plenty of transistors used alongside ICs in those later chapters.

### 2.6.1 Regulated power supply

Figure 2.93 shows a very common configuration. $R_{1}$ normally holds $Q_{1}$ on; when the output reaches 10 volts, $Q_{2}$ goes into conduction (base at 5 V ), preventing further rise of output voltage by shunting base current from $Q_{1}$ 's base. The supply can be made adjustable by replacing $R_{2}$ and $R_{3}$ with a potentiometer. In this voltage regulator (or "regulated dc supply") circuit, negative feedback acts to stabilize the output voltage: $Q_{2}$ "looks at" the output and does something about it if the output isn't at the right voltage.

A few details: (a) Adding a biasing resistor $R_{4}$ ensures a relatively constant zener current, so that the zener voltage does not change significantly with load current. It is tempting to provide that bias current from the input, but it is far better to use the regulated output. A warning is in order: whenever you use an output voltage to make something happen within a circuit, make sure that the circuit will start up correctly; here, however, there is no problem (why not?). (b) The capacitor $C_{1}$ would probably be needed in
this circuit to ensure stability (i.e., to prevent oscillation), particularly if the output were capacitively bypassed (as it should be), for reasons we will see later in connection with feedback loop stability (§4.9).

We'll see much more of this subject in Chapter 9.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0156.jpg?height=471&width=723&top_left_y=448&top_left_x=1108)

Figure 2.93. Feedback voltage regulator.

### 2.6.2 Temperature controller

The schematic diagram in Figure 2.94 shows a temperature controller based on a thermistor sensing element, a device that changes resistance with temperature. Differential Darlington $Q_{1}-Q_{4}$ compares the voltage of the adjustable reference divider $R_{4}-R_{6}$ with the divider formed from the thermistor and $R_{2}$. (By comparing ratios from the same supply, the comparison becomes insensitive to supply variations; this particular configuration is called a Wheatstone bridge.) Current mirror $Q_{5} Q_{6}$ provides an active load to raise the gain, and mirror $Q_{7} Q_{8}$ provides emitter current. $Q_{9}$ compares the differential amplifier output with a fixed voltage, saturating Darlington $Q_{10} Q_{11}$ (which supplies power to the heater) if the thermistor is too cold. $R_{9}$ is a current-sensing resistor that turns on protection transistor $Q_{12}$ if the output current exceeds about 6 amps ; that steals base drive from $Q_{10} Q_{11}$, preventing damage. And $R_{12}$ adds a small amount of positive feedback, to cause the heater to snap on and off abruptly; this is the same trick (a "Schmitt trigger") as in Figure 2.13.

### 2.6.3 Simple logic with transistors and diodes

Figure 2.95 shows a circuit that performs a task we illustrated in $\S 1.9 .1 \mathrm{~F}$ : sounding a buzzer if either car door is open and the driver is seated. In this circuit the transistors all operate as switches (either OFF or saturated). Diodes $D_{1}$ and $D_{2}$ form what is called an OR gate, turning off $Q_{1}$ if either door is open (switch closed). However, the collector of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0157.jpg?height=942&width=1427&top_left_y=218&top_left_x=246)

Figure 2.94. Temperature controller for 250 W heater.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0157.jpg?height=646&width=1074&top_left_y=1233&top_left_x=412)

Figure 2.95. Both diodes and transistors are used to make digital logic "gates" in this seat-belt buzzer circuit.
$Q_{1}$ stays near ground, preventing the buzzer from sounding unless switch $S_{3}$ is also closed (driver seated); in that case $R_{2}$ turns on $Q_{3}$, putting 12 volts across the buzzer. $D_{3}$ provides a diode drop so that $Q_{1}$ is OFF with $S_{1}$ or $S_{2}$ closed, and $D_{4}$ protects $Q_{3}$ from the buzzer's inductive turn-off transient. In Chapters $10-15$ we discuss logic circuitry in detail.

#### Additional Exercises for Chapter 2

Exercise 2.23. Design a transistor switch circuit that allows you to switch two loads to ground by means of saturated npn transistors. Closing switch $A$ should cause both loads to be powered, whereas closing switch $B$ should power only one load. Hint: use diodes.

Exercise 2.24. Consider the current source in Figure 2.96. (a) What is $I_{\text {load }}$ ? What is the output compliance? Assume $V_{\mathrm{BE}}$ is 0.6 V . (b) If $\beta$ varies from 50 to 100 for collector voltages within the output compliance range, how much will the output current vary? (There are two effects here.) (c) If $V_{\mathrm{BE}}$ varies according to $\Delta V_{\mathrm{BE}}=-0.0001 \Delta V_{\mathrm{CE}}$ (Early effect), how much will the load current vary over the compliance range? (d) What is the temperature coefficient of output current assuming that $\beta$ does not vary with temperature? What is the temperature coefficient of output current assuming that $\beta$ increases from its nominal value of 100 by $0.4 \% /{ }^{\circ} \mathrm{C}$ ?
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0158.jpg?height=376&width=351&top_left_y=690&top_left_x=442)

Figure 2.96. Current source exercise.

Exercise 2.25. Design a common-emitter $n p n$ amplifier with a voltage gain of $15, V_{\mathrm{CC}}$ of +15 V , and $I_{\mathrm{C}}$ of 0.5 mA . Bias the collector at $0.5 V_{\mathrm{CC}}$, and put the low-frequency 3 dB point at 100 Hz .
Exercise 2.26. Bootstrap the circuit in the preceding problem to raise the input impedance. Choose the rolloff of the bootstrap appropriately.

Exercise 2.27. Design a dc-coupled differential amplifier with a voltage gain of 50 (to a single-ended output) for input signals near ground, supply voltages of $\pm 15$ volts, and quiescent currents of 0.1 mA in each transistor. Use a current source in the emitter and an emitter follower output stage.
Exercise 2.28. In this problem you will ultimately design an amplifier whose gain is controlled by an externally applied voltage (in Chapter 3 you will see how to do the same thing with FETs). (a) Begin by designing a long-tailed pair differential amplifier with emitter current source and no emitter resistors (undegenerated). Use $\pm 15 \mathrm{~V}$ supplies. Set $I_{\mathrm{C}}$ (each transistor) at $100 \mu \mathrm{~A}$, and use $R_{\mathrm{C}}=10 \mathrm{k}$. Calculate the voltage gain from a single-ended input (other input grounded) to a single-ended output. (b) Now modify the circuit so that an externally applied voltage controls the emitter current source. Give an approximate formula for the gain as a function of controlling voltage. (In a real circuit you might arrange a second set of voltage-controlled current sources
to cancel the quiescent-point shift that gain changes produce in this circuit, or a differential-input second stage could be added to your circuit.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0158.jpg?height=350&width=447&top_left_y=381&top_left_x=1246)

Figure 2.97. Bad biasing.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0158.jpg?height=618&width=733&top_left_y=834&top_left_x=1103)

Figure 2.98. Base-current cancellation scheme used in precision operational amplifiers. Bias-current cancellation is discussed in detail in Chapter $4 x$.

Exercise 2.29. Disregarding the lessons of this chapter, a disgruntled student builds the amplifier shown in Figure 2.97. He adjusts $R$ until the quiescent point is $0.5 V_{\mathrm{CC}}$. (a) What is $Z_{\text {in }}$ (at high frequencies where $Z_{\mathrm{C}} \approx 0$ )? (b) What is the small-signal voltage gain? (c) What rise in ambient temperature (roughly) will cause the transistor to saturate?

Exercise 2.30. Several commercially available precision op-amps (e.g., the venerable OP-07) use the circuit in Figure 2.98 to cancel input bias current (only half of the symmetrical-input differential amplifier is shown in detail; the other half works the same way). Explain how the circuit works. Note: $Q_{1}$ and $Q_{2}$ are a betamatched pair. Hint: it's all done with mirrors.

### Review of Chapter 2

An A-to-W review of Chapter 2. This review doesn't follow the exact topic order in the chapter: here we first cover transistor theory, then circle back to discuss some applications. In the chapter circuits have been interspersed with theory to provide motivation and illustrate how to use the theory.

#### IA. Pin-Labeling Conventions.

The introduction (§2.1) describes some transistor and circuit-labeling conventions. For example, $V_{\mathrm{B}}$ (with a single subscript) indicates the voltage at the base terminal, and similarly $I_{\mathrm{B}}$ indicates current flowing into the base terminal. $V_{\mathrm{BE}}$ (two subscripts) indicates base-to-emitter voltage. Symbols like $V_{\mathrm{CC}}$ and $V_{\mathrm{EE}}$ (repeated subscripts) indicate the positive and negative supply voltages.

#### IB. Transistor Types and Polarities.

Transistors are three-terminal devices capable of amplifying signals. They come in two broad classes, bipolar junction transistors (BJTs, the subject of this chapter), and field-effect transistors (FETs, the subject of Chapter 3). BJTs have a control terminal called the base, and a pair of output terminals, called the collector and the emitter (the corresponding terminals in a FET are gate, drain, and source). A signal applied to the base controls the current flowing from collector to emitter. There are two BJT polarities available, $n p n$ and $p n p$; for $n p n$ devices the collector is more positive than the emitter, and the opposite is true for pnp. Figure 2.2 illustrates this and identifies intrinsic diodes that are part of the transistor structure, see IID and IIF below. The figure also illustrates that the collector current and the (much smaller) base current combine to form the emitter current.

Operating modes Transistors can operate as switches turned ON or OFF - or they can be used as linear devices, for example as amplifiers, with an output current proportional to an input signal. Put another way, a transistor can be in one of three states: cutoff (non-zero $V_{\mathrm{CE}}$ but zero $I_{\mathrm{C}}$ ), saturated (non-zero $I_{\mathrm{C}}$ but near-zero $V_{\mathrm{CE}}$ ), or in the linear region (non-zero $V_{\mathrm{CE}}$ and $I_{\mathrm{C}}$ ). If you prefer prose (and using "voltage" as shorthand for collector-to-emitter voltage $V_{\mathrm{CE}}$, and "current" as shorthand for collector current $I_{\mathrm{C}}$ ), the cutoff state has voltage but no current, the saturated state has current but near-zero voltage, and the linear region has both voltage and current.

#### IC. Transistor Man and Current Gain.

In the simplest analysis, §2.1.1, the transistor is simply a current amplifier, with a current gain called beta (symbol $\beta$, or sometimes $h_{\mathrm{FE}}$ ). A current into the base causes
a current $\beta$ times larger to flow from collector to emitter, $I_{\mathrm{C}}=\beta I_{\mathrm{B}}$, if the external circuit allows it. When currents are flowing, the base-emitter diode is conducting, so the base is $\sim 0.65 \mathrm{~V}$ more positive (for $n p n$ ) than the emitter. The transistor doesn't create the collector current out of thin air; it simply throttles current from an available supply voltage. This important point is emphasized by our "transistor man" creation (Figure 2.7), a little homunculus whose job is to continuously examine the base current and attempt to adjust the collector's current to be a factor of $\beta$ (or $h_{\mathrm{FE}}$ ) times larger. For a typical BJT the beta might be around 150, but beta is only loosely specified, and a particular transistor type may have a $3: 1$ spread (or more) in specified beta at some collector current (and further 3:1 spreads of $\beta$ versus $I_{\mathrm{C}}$ and $\beta$ versus temperature, see for example Figure 2.76).

#### ID. Switches and Saturation.

When operated as a switch, §2.2.1, a current must be injected into the base to keep the transistor "ON." This current must be substantially more than $I_{\mathrm{B}}=I_{\mathrm{C}} / \beta$. In practice a value of $1 / 10$ th of the maximum expected collector current is common, but you could use less, depending on the manufacturer's recommendations. Under this condition the transistor is in saturation, with $25-200 \mathrm{mV}$ across the terminals. At such low collector-to-emitter voltages the base-to-collector diode in Figure 2.2 is conducting, and it robs some of the base-current drive. This creates an equilibrium at the saturation voltage. We'll return in $9[\mathrm{~K}$ to look at some circuit examples. See also the discussion of transistor saturation in Chapter $2 x$.

#### ๆE. The BJT is a Transconductance Device.

As we point out in §2.1.1, "A circuit that depends on a particular value for beta is a bad circuit." That's because $\beta$ can vary by factors of 2 to 3 from the manufacturer's nominal datasheet value. A more reliable design approach is to use other highly-predictable BJT parameters that take into account that it is a transconductance device. In keeping with the definition of transconductance (an output current proportional to an input voltage), a BJT's collector current, $I_{\mathrm{C}}$, is controlled by its base-to-emitter voltage, $V_{\mathrm{BE}}$, see $\S 2.3$. (We can then rely on $I_{\mathrm{B}}=I_{\mathrm{C}} / \beta$ to estimate the base current, the other way around from the simple approach in $\mathbb{I C}$.) The transconductance view of BJTs is helpful in many circumstances (estimating gain, distortion, tempco), and it is essential in understanding and designing circuits such as differential amplifiers and current mirrors. However, in many situations you can circumvent the beta-uncertainty problem with circuit design tricks such as dc feedback or emitter degeneration, without explicitly invoking Ebers-Moll
(IIF). Note also that, just as it would be a bad idea to bias a BJT by applying a base current calculated from $I_{\mathrm{C}} / \beta$ (from an assumed $\beta$ ), it would be even worse to attempt to bias a BJT by applying a calculated $V_{\mathrm{BE}}$ (from an assumed $I_{\mathrm{s}}$, see $\mathbb{I}$ F); more on this in $\mathbb{I} \mathrm{Q}$, below. We might paraphrase this by saying "a circuit that depends on a particular value for $I_{\mathrm{s}}$, or for operation at a precise ambient temperature, is a bad circuit."

#### IF. Ebers-Moll.

Figure 2.41 shows a typical Gummel plot, with $V_{\mathrm{BE}}$ dictating $I_{\mathrm{C}}$, and thus an approximate $I_{\mathrm{B}}$. Equations (2.8) and (2.9) show the exponential (or logarithmic) nature of this relationship. A simple form of the equation, $I_{\mathrm{C}}=I_{\mathrm{s}} \exp \left(V_{\mathrm{BE}} / V_{\mathrm{T}}\right)$ and its inverse, $V_{\mathrm{BE}}=V_{\mathrm{T}} \log _{e}\left(I_{\mathrm{C}} / I_{\mathrm{s}}\right)$, where the constant $V_{\mathrm{T}}=25 \mathrm{mV}$ at $25^{\circ} \mathrm{C}$, reveals that collector current is determined by $V_{\mathrm{BE}}$ and a parameter $I_{\mathrm{s}}$, the latter related to the transistor die size and its current density. $I_{\mathrm{S}}$ is a very small current, typically some $10^{11}$ times smaller than $I_{C}$. The Ebers-Moll formula accurately holds for the entire range of silicon BJT types, for example those listed in Table 8.1. The integrated-circuit (IC) industry relies on Ebers-Moll for the design of their highly-successful BJT linear circuits.

#### IG. Collector Current versus Base Voltage: Rules of Thumb.

See §2.3.2. It's useful to remember a few rules of thumb, which we can derive from Ebers-Moll: $I_{\mathrm{C}}$ increases by a factor of ten for $\mathrm{a} \approx 60 \mathrm{mV}$ increase in $V_{\mathrm{BE}}$; it doubles for an $\approx 18 \mathrm{mV} V_{\mathrm{BE}}$ increase, and it increases $4 \%$ for a 1 mV $V_{\mathrm{BE}}$ increase.

IH. Small Signals, Transconductance and $r_{\mathrm{e}}$.
See §2.3.2B. It's convenient to assume operation at fixed $I_{\mathrm{C}}$, and look for the effect of small changes ("small signals"). First, thinking about the rules of thumb above, we can calculate (eq'n 2.13,) the transconductance, $g_{m}=\partial I_{\mathrm{C}} / \partial V_{\mathrm{BE}}=I_{\mathrm{C}} / V_{\mathrm{T}}$. This evaluates to $g_{m}=40 \mathrm{mS}$ at 1 mA , with $g_{m}$ proportional to current. To put it another way, we can assign an effective internal resistance $r_{\mathrm{e}}$ in series with the emitter, $r_{\mathrm{e}}=1 / g_{m}=V_{\mathrm{T}} / I_{\mathrm{C}}$, see eq'n 2.12. (The small $r$ indicates small signal.) A useful fact to memorize: $r_{\mathrm{e}}$ is about $25 \Omega$ at a collector current of 1 mA , and it scales inversely with current.

#### III. Dependence on Temperature.

See §2.3.2C. In $\llbracket \mathrm{F}$ we said $V_{\mathrm{T}}=25 \mathrm{mV}$ at $25^{\circ} \mathrm{C}$, which suggests it's not exactly a constant, but changes with temperature. Because $V_{\mathrm{T}}=k T / q$ (\$2.3.1), you might guess that $V_{\mathrm{BE}}$ is proportional to absolute temperature, thus a temper-
ature coefficient of about $+2 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ (because $V_{\mathrm{BE}} \approx 600 \mathrm{mV}$ at $T=300 \mathrm{~K}$ ). But the scaling parameter $I_{\mathrm{s}}$ has a large opposite tempco, producing an overall tempco of about $-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$. Memorize this fact also! Because $V_{\mathrm{T}}$ is proportional to absolute temperature, the tempco of transconductance at fixed collector current is inversely proportional to absolute temperature (recall $g_{m}=I_{\mathrm{C}} / V_{\mathrm{T}}$ ), and thus drops by about $0.34 \% /^{\circ} \mathrm{C}$ at $25^{\circ} \mathrm{C}$.

#### IJ. Early Effect.

See §2.3.2D. In our simple understanding so far, base voltages (or currents) "program" a BJT's collector current, independent of collector voltage. But in reality $I_{C}$ increases slightly with increasing $V_{\text {CE }}$. This is called the Early effect, see eq'n 2.14 and Figure 2.59, which can be characterized by an Early voltage $V_{\mathrm{A}}$, a parameter independent of operating current; see eq'n 2.15. If the Early voltage is low (a common drawback of $p n p$ transistors) the effect can be quite large. For example, a pnp 2N5087 with $V_{\mathrm{A}}=55 \mathrm{~V}$ has $\eta=4 \times 10^{-4}$, and would experience a 4 mV shift of $V_{\mathrm{BE}}$ with a 10 V change of $V_{\mathrm{CE}}$; if instead the base voltage were held constant, a 10 V increase of collector voltage would cause a $17 \%$ increase of collector current. We hasten to point out there are circuit configurations, such as degeneration, or the cascode, that alleviate the Early effect. For more detail see the discussion in Chapter $2 x$.

#### Circuit Examples

With this summary of basic BJT theory, we now circle back and review some circuit examples from Chapter 2. One way to review the circuits is to flip through the chapter looking at the pictures (and reading the captions), and refer to the associated text wherever you are uncertain of the underlying principles.

#### ףK. Transistor Switches.

BJT switches are discussed in §2.2.1, and circuit examples appear in Figures 2.9 (driving an LED), 2.10 (highside switching, including level shifting), and 2.16 (with an emitter-follower driver). Simply put, you arrange to drive a current into the base to put the transistor into solid saturation for the anticipated collector load current (i.e., $I_{\mathrm{B}} \gg$ $\left.I_{\mathrm{C}} / \beta\right)$, bringing its collector within tens of millivolts of the emitter. More like this appears in Chapter 12 (Logic Interfacing). Looking forward, the use of MOSFET switches often provide a superior switching solution (§§3.4.4 and 3.5); their control terminal (the gate) conveniently requires no static gate current, though you may have to provide significant transient currents to charge its gate capacitance during rapid switching.

#### IL. Transistor Pulsers.

Basic timer and pulse generator circuits are shown in Figures 2.11 (pulse from a step) and 2.12 (pulse from a pulse). These are simple, but not terribly accurate or stable; better to use a dedicated timer or pulse generator IC, see §7.2.

#### 11M. Schmitt Trigger.

A Schmitt trigger is a threshold level-detecting circuit (Figure 2.13) with hysteresis to prevent multiple transitions when noisy input signals go though the threshold(s). Although you can make a Schmitt trigger circuit with discrete transistors, good design practice favors the use of dedicated comparator ICs, see $\S \S 4.3 .2$ and 12.3.

#### IN. Emitter Follower.

The emitter follower is a linear amplifier with an ideal voltage gain of unity, see $\S 2.2 .3$. The beta of the transistor increases the follower's input impedance and reduces its output impedance, see $\S 2.2 .3 \mathrm{~B}$ and eq'n 2.2. There's more detail in §2.3.3 and Figure 2.43, where the effect of the intrinsic emitter resistance $r_{\mathrm{e}}$ is taken into account. In simplified form $R_{\text {out }}=r_{\mathrm{e}}+R_{\mathrm{S}} / \beta$, where $R_{\mathrm{S}}$ is the signal source resistance seen at the base. The dc output voltage is offset from the dc input by $V_{\mathrm{BE}}$, about 0.6 V to 0.7 V , unless a cancelling circuit is used, see §2.2.3D and Figure 2.29. Emitter followers are also used as voltage regulators, see $\S 2.2 .4$ and Figures 2.21 and 2.22. A precision alternative is the op-amp follower, see $\S 4.2 .3$ in Chapter 4.

#### IO. Current Source (or Current Sink).

In contrast to the familiar voltage source (which delivers a constant voltage regardless of load current, think of a battery), a current source delivers a constant current regardless of the load's voltage drop, see §2.2.6 and Figure 2.31; there's no everyday "battery equivalent." Transconductance devices like BJTs, with their relatively constant collector output currents, are natural candidates for making current sources. For the simplest current source, the base is biased with a voltage, say $V_{\mathrm{b}}$, with respect to a reference point (often ground), and the emitter is connected through a resistor to the same reference. For an $n p n$ transistor with ground reference the output (sinking) current will be $I_{\mathrm{C}}=\left(V_{\mathrm{b}}-V_{\mathrm{BE}}\right) / R_{\mathrm{E}}$, see Figure 2.32 . For better stability and predictability the $V_{\mathrm{BE}}$ term can be cancelled, see Figure 2.33. The operating voltage range of a current source is called its compliance range, set on the low end by collector saturation, and on the high end by the transistor's breakdown voltage or by power-dissipation issues. Current sources are frequently created using current-mirror circuits, see TIP below. Precise and stable current sources can
be made with op-amps (§4.2.5); there are also dedicated current-source integrated circuits (§9.3.14).

#### IP. Current Mirrors.

A current mirror (§2.3.7) is a three-terminal current-source circuit that generates an output current proportional to an input "programming" current. In a typical configuration (Figures 2.55 and 2.58) the mirror attaches to a dc rail (or to ground), reflecting the programming current, the latter perhaps set by a resistor. The circuit often omits any emitter resistors, thus achieving compliance to within a fraction of a volt of the rail. Ordinarily you wouldn't attempt to apply exactly the right $V_{\mathrm{BE}}$ to generate a prescribed $I_{\mathrm{C}}$ (à la Ebers-Moll); but that's exactly what you're doing here. The trick is that one transistor $\left(Q_{1}\right)$ of the matched pair inverts Ebers-Moll, creating from the programming current $I_{\mathrm{P}}$ exactly the right $V_{\mathrm{BE}}$ to re-create the same current in the output transistor $Q_{2}$. Cute!

These circuits assume matched transistors, such as you would find inside an IC (recall from $\mathbb{I} \mathrm{G}$ that even a 1 mV difference of $V_{\mathrm{BE}}$ produces a $4 \%$ change of current). Figure 2.62 graphs base-emitter voltage difference versus collector current ratio, $\Delta V_{\mathrm{BE}}=V_{\mathrm{T}} \log _{e}\left(I_{\mathrm{C} 2} / I_{\mathrm{C} 1}\right)$. You can exploit this effect to generate a "ratio mirror," as discussed in Chapter 2x.

As nice as it looks, the basic current mirror of Figure 2.55 suffers from Early-effect change of output current when the output voltage changes. The effect is particularly serious with pnp transistors: in the example of a 2N5087 in $\mathbb{I J} \mathrm{J}$ above, the 4 mV change of $V_{\mathrm{BE}}$ (for a 10 V output change) would cause a $17 \%$ current error. One solution (Figure 2.60) is to add emitter degeneration resistors, at the expense both of compliance near the reference rail and of dynamic range. A more elegant solution is the Wilson mirror (Figure 2.61), which defeats Early effect by exploiting the ever-useful cascode configuration (Figure 2.84B). Cascode transistor $Q_{3}$ passes output transistor $Q_{2}$ 's collector current to the load, while $Q_{2}$ operates with a fixed $V_{\mathrm{CE}}$ of one diode drop (its own $V_{\mathrm{BE}}$ ). The Wilson mirror's ingenious configuration also cancels base-current errors (an ordinary mirror with BJTs having $\beta=100$ has a current error of $2 \%$ ). Degeneration resistors can be added, as shown in circuit B, for additional suppression of Early effect, but they would be omitted in a "pure Wilson mirror." Linear ICs are full of Wilson mirrors. See Chapter $2 x$ for a discussion of bipolarity current mirrors.

#### ПQ. Common-Emitter Amplifiers.

See $\S$ §.2.7 and 2.3.4, and Figures 2.35, 2.48 and 2.50. The simplest form of BJT amplifier has a grounded emitter, a load resistor $R_{\mathrm{L}}$ from the collector to a supply $V_{+}$, and
a dc bias plus a small signal voltage applied to the base. The gain is $G_{\mathrm{V}}=-R_{\mathrm{L}} / r_{\mathrm{e}}$. If the base bias is carefully set so that the collector current pulls the collector halfway to ground, then $I_{\mathrm{C}}=V_{\mathrm{S}} / 2 R_{\mathrm{L}}, r_{\mathrm{e}}=V_{\mathrm{T}} / I_{\mathrm{C}}=2 R_{\mathrm{L}} V_{\mathrm{T}} / V_{\mathrm{S}}$, and so the voltage gain (recall $V_{\mathrm{T}} \approx 25 \mathrm{mV}$ ) is $G_{\mathrm{V}}=-20 V_{\mathrm{s}}$, where $V_{\mathrm{s}}$ is in units of volts. For $V_{\mathrm{s}}=20 \mathrm{~V}$, for example, the voltage gain is -400 .

That's a lot of gain! Unless the signals are small, however, there's a serious problem: the gain is inverse in $r_{\mathrm{e}}$, thus proportional to $I_{\mathrm{C}}$. But the latter changes as the output voltage swings up and down, producing first-order changes in gain, with resulting severe distortion (Figure 2.46). This can be alleviated (at the expense of gain) by adding emitter degeneration in the form of an emitter resistor $R_{\mathrm{E}}$. The gain is then $G_{\mathrm{V}}=-R_{\mathrm{L}} /\left(R_{\mathrm{E}}+r_{\mathrm{e}}\right)$, with greatly reduced effect of varying $r_{\mathrm{e}}$; see Figure 2.47, where emitter degeneration was added to reduce the gain by a factor of ten ( $\left.R_{\mathrm{E}}=9 r_{\mathrm{e}}\right)$. This is also a form of negative feedback, see $\S 2.3 .4 \mathrm{~B}$ and IIW below. You can think of this circuit as a classic current source ( $\Psi \mathrm{O}$ ) driving a resistor as load; the voltage gain is the current source's transconductance multiplied by the load resistance, $G_{\mathrm{V}}=g_{m} R_{\mathrm{L}}$, where $g_{m}=-1 / r_{\mathrm{e}}$.

We've sidestepped the important issue of setting the base bias voltage to produce the desired quiescent collector current. But we don't know the appropriate voltage $V_{\mathrm{BE}}$, and a small change has a big effect, see $\Psi_{[ }$above (e.g., a 60 mV uncertainty in $V_{\mathrm{BE}}$, which is about what you might encounter from different batches of a given transistor, produces a $10 \times$ error in $I_{C}!$ ). There are many circuit solutions, see §2.3.5, but the simplest involves adding emitter degeneration at dc, bypassed as necessary to produce higher gain at signal frequencies (Figure 2.50 and 2.51). Another approach is to use a matching transistor to set the bias, analogous to the current mirror (Figure 2.52); this method is inherent in the widely-used differential amplifier (Figure 2.65). A third approach is to exploit feedback to set the bias (Figures 2.53 and 2.54 ), a method that figures centrally in op-amp circuits (Chapter 4).

#### IR. Differential Amplifiers.

The differential amplifier (\$2.3.8) is a symmetrical configuration of two matched transistors, used to amplify the difference of two input signals. It may include emitter degeneration (Figure 2.64), but need not (Figure 2.65). For best performance the emitter pulldown resistor is replaced by a current source, and (for highest gain) the resistive collector load is replaced by a current mirror (Figure 2.67). Differential amplifiers should reject strongly any common-mode input signal, achieving a good common-mode rejection ratio (CMRR, the ratio $G_{\mathrm{diff}} / G_{\mathrm{CM}}$ ). Differential amplifiers can be used to amplify single-ended input signals (ground
the other input), where the inherent cancellation of $V_{\mathrm{BE}}$ offsets allows accurate dc performance (\$2.3.8B). Ordinarily you use only one output from a differential amplifier; that is, it is used to to convert a balanced input to a single-ended output. But you can use both outputs (a "fully-differential amplifier," §5.17) to drive a balanced load, or to create a pair of signals $180^{\circ}$ out of phase (a phase splitter). See also the sections on the emitter-input differential amplifier and on BJT amplifier distortion in Chapter 2x, and §5.13-§5.16 (precision differential and instrumentation amplifiers).

#### IS. Comparators.

A differential amplifier with lots of gain $G_{\text {diff }}$ is driven into differential saturation with a small differential input (§2.3.8E). For example, just a few millivolts of input difference is adequate to saturate the output if $G_{\text {diff }}=1000$ (easily accomplished with a current-mirror collector load). When operated in this way, the differential amplifier is a voltage comparator, a circuit used widely to sense thresholds or compare signal levels; it's the basis of analog-todigital conversion, and figures importantly in Chapter 12 (see $\S 12.3$ and Tables 12.1 and 12.2).

#### IT. Push-Pull Amplifiers.

A single transistor conducts in one direction only (e.g., an npn transistor can only sink current from its collector, and source current from its emitter). That makes it awkward to drive a heavy load with alternating polarity (e.g., a loudspeaker, servomotor, etc.), although it can be done, wastefully, with a single-ended stage ("class-A") with high quiescent current, see Figure 2.68. The push-pull configuration uses a pair of transistors connected to opposite supply rails (§2.4.1), an arrangement that can supply large output currents of either polarity with little or no quiescent current. Figure 2.69 shows a push-pull follower with complementary polarities, and with zero quiescent current ("class-B"); this produces some crossover distortion, which can be eliminated by biasing the pair into quiescent conduction ("class-AB," Figure 2.71),. The output transistors can be beta-boosting configurations like the Darlington or Sziklai (IIU), see for example Figure 2.78. The pushpull configuration is widely used in logic circuits (see Figure 10.25), gate driver ICs (see Figure 3.97), and in combination with op-amps to deliver greater output currents (see Figure 4.26).

#### qU. The Darlington and Sziklai Connections.

These simple combinations of two transistors create a 3terminal equivalent transistor with $\beta=\beta_{1} \beta_{2}$. The Darlington (Figures 2.74 and 2.75) cascades two transistors of the
same polarity and has a base-emitter drop of $2 V_{\mathrm{BE}}$; the Sziklai (Figure 2.77) pairs opposite polarities, and has a single base-emitter drop (which is only weakly dependent on output current, thanks to $R_{\mathrm{B}}$ ). For either configuration a resistor $R_{\mathrm{B}}$ should be connected across the output transistor's base-emitter terminals. For more about this subject see see the discussion in Chapter $2 x$.

#### IV. Miller Effect.

Like all electronic components, transistors have interterminal capacitances, designated (by terminal pairs) $C_{\mathrm{be}}$, $C_{\mathrm{ce}}$, and $C_{\mathrm{c}} .^{72}$ While $C_{\mathrm{be}}$ and $C_{\mathrm{ce}}$ slow the input and output waveforms by creating lowpass filters with the source and load resistances, the effect of the feedback capacitance $C_{\mathrm{cb}}$ is more insidious: it creates an additional input capacitance to ground equal to $C_{\mathrm{cb}}$ multiplied by the stage's inverting voltage gain, thus its effective input capacitance becomes $C_{\mathrm{eff}}=\left(G_{\mathrm{V}}+1\right) C_{\mathrm{cb}}$. This is the infamous Miller effect (\$2.4.5B), whose impact can be devastating in high-speed and wideband amplifiers. Some circuit solutions include

[^101]the grounded-base amplifier, the differential amplifier, and the cascode configuration (see the discussion of cascode in Chapter 2x).

#### IW. Negative Feedback.

If there were a Nobel prize for grand-concepts-in-circuitdesign, it would surely go to Harold Black for his elegant elucidation of negative feedback. In its simplest form, it consists of subtracting, from the input signal, a fraction $B$ of an amplifier's output signal $V_{\text {out }}$ (Figure 2.85). If the amplifier's open-loop gain is $A$, then the closed-loop gain becomes (eq'n 2.16) $G_{\mathrm{cl}}=A /(1+A B)$. The quantity $A B$, which generally is large compared with unity, is called the loop gain, and it (more precisely the quantity $1+A B$ ) is the multiplier by which negative feedback improves the amplifier's performance: improved linearity and constancy of gain, and (in this series feedback circuit configuration) raised input impedance and lowered output impedance; see §2.5.3.

Feedback is the essence of linear design, and it is woven deeply into the DNA of op-amp circuits (the subject of Chapter 4), and power circuits (Chapter 9). With negative feedback you can make amplifiers with $0.0001 \%$ distortion, voltage sources with $0.001 \Omega$ output impedance, and many other wonders too magnificent here to relate. Stay tuned. Better yet, read on!

# 3.FIELD-EFFECT TRANSISTORS

## 3.1 Introduction

Field-effect transistors (FETs) are different from the bipolar transistors ${ }^{1}$ that we talked about in the last chapter. Broadly speaking, however, they are similar devices, which we might call charge-control devices: in both cases (Figure 3.1) we have a three-terminal device in which the conduction between two electrodes depends on the availability of charge carriers, which is controlled by a voltage applied to a third control electrode.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0164.jpg?height=281&width=453&top_left_y=1005&top_left_x=396)

Figure 3.1. The $n$-channel MOSFET and its $n p n$ transistor analog.
Here's how they differ: in a bipolar transistor the collector-base junction is back-biased, so no current normally flows. Forward-biasing the base-emitter junction by $\approx 0.6 \mathrm{~V}$ overcomes its diode "contact potential barrier," causing electrons to enter the base region, where they are strongly attracted to the collector. Although some base current results, most of these "minority carriers" are captured by the collector. This results in a collector current, controlled by a (much smaller) base current. The collector current is proportional to the rate of injection of minority carriers into the base region, which is an exponential function of $V_{B E}$ (the Ebers-Moll equation). You can think of a bipolar transistor as a current amplifier (with roughly constant current gain $\beta$ ) or as a transconductance device (Ebers-Moll: collector current programmed by base-emitter voltage).

In an FET, as the name suggests, conduction in a channel is controlled by an electric field, produced by a voltage applied to the gate electrode. There are no forwardbiased junctions, so the gate draws no current. This is per-

[^102]haps the most important advantage of the FET. As with BJTs, there are two polarities, $n$-channel FETs (conduction by electrons) and p-channel FETs (conduction by holes). These two polarities are analogous to the familiar npn and pnp bipolar transistors, respectively. In addition, however, FETs tend to be confusing at first because they can be made with two different kinds of gates (thus JFETs and MOSFETs) and with two different kinds of channel doping (leading to enhancement and depletion modes). We'll sort out these possibilities shortly.

First, though, some motivation and perspective. The FET's nonexistent gate current is its most important characteristic. The resulting high input impedance (which can be greater than $10^{14} \Omega$ ) is essential in many applications, and in any case it makes circuit design simple and fun. For applications like analog switches and amplifiers of ultrahigh input impedance, FETs have no equal. They can be easily used by themselves or combined with bipolar transistors to make integrated circuits. In the next chapter we'll see how successful that process has been in making nearly perfect (and wonderfully easy to use) operational amplifiers, and in Chapters 10-14 we'll see how digital electronics has been revolutionized by MOSFET integrated circuits. Because many FETs using very low current can be constructed in a small area, they are especially useful for very large-scale integration (VLSI) digital circuits such as microprocessors, memory, and "application-specific" chips of the sort used in cellphones, televisions, and the like. At the other end of the spectrum, robust high-current MOSFETs (50 amps or more) have replaced bipolar transistors in many applications, often providing simpler circuits with improved performance.

### 3.1.1 FET characteristics

Beginners sometimes become catatonic when directly confronted with the confusing variety of FET types. That variety arises from the combined choices of polarity ( $n$ channel or $p$-channel), form of gate insulation [semiconductor junction (JFET) or oxide insulator (MOSFET)], and channel doping (enhancement or depletion mode). Of the
eight resulting possibilities, six could be made, and five actually are. Four of those five are of major importance.

It will aid understanding (and sanity), however, if we begin with one type only, just as we did with the npn bipolar transistor. Once comfortable with FETs, we'll have little trouble with their family tree.

#### A. FET V-I curves

Let's look first at the $n$-channel enhancement-mode MOSFET, which is analogous to the npn bipolar transistor (Figure 3.2). In normal operation the drain ( $\sim$ collector) is more positive than the source ( $\sim$ emitter). No current flows from drain to source unless the gate ( $\sim$ base) is brought positive with respect to the source. Once the gate is thus "forwardbiased," there will be drain current, all of which flows to the source. Figure 3.2 shows how the drain current $I_{\mathrm{D}}$ varies with drain-source voltage $V_{\mathrm{DS}}$ for a few values of controlling gate-source voltage $V_{\mathrm{GS}}$. For comparison, the corresponding "family" of curves of $I_{C}$ versus $V_{B E}$ for an ordinary npn bipolar transistor is shown. Evidently there are a lot of similarities between $n$-channel MOSFETs and $n p n$ bipolar transistors.

Like the npn transistor, the FET has a high incremental drain impedance, giving roughly constant current for $V_{\mathrm{DS}}$ greater than a volt or two. By an unfortunate choice of language, this is called the "saturation" region of the FET (a better term is "current saturation") and corresponds to the "active" region of the bipolar transistor. Analogous to the bipolar transistor, a larger gate-to-source bias produces a larger drain current. And, analogous to bipolar transistors, FETs are not perfect transconductance devices (constant drain current for constant gate-source voltage): just as the ideal Ebers-Moll transconductance characteristic of bipolar transistors is degraded by the Early effect (§2.3.2D and $\S 2 x .8$ ), there's an analogous departure from the ideal transconductance behavior for FETs, characterized by a finite drain output resistance $r_{\mathrm{o}}$ (more usually called $1 / g_{\text {os }}$, see §3.3.2 and §3x.4).

So far, the FET looks just like the $n p n$ transistor. Let's look closer, though. For one thing, over the normal range of currents the saturation drain current increases rather modestly with increasing gate voltage $\left(V_{\mathrm{GS}}\right)$. In fact, it is approximately proportional to $\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$, where $V_{\mathrm{th}}$ is the gate threshold voltage at which drain current begins ( $V_{\mathrm{th}} \approx 1.63 \mathrm{~V}$ for the FET in Figure 3.2); compare this mild quadratic law with the steep exponential transistor law, as given to us by Ebers and Moll. Second, there is zero dc gate current, so you mustn't think of the FET as a device with current gain (which would be infinite). Instead, think of the FET as a transconductance device, with gate-source
voltage programming the drain current, as we did with the bipolar transistor in the Ebers-Moll treatment. Recall that the transconductance $g_{m}$ is simply the ratio $i_{\mathrm{d}} / v_{\mathrm{gs}}$ (using the convention of lowercase letters to indicate "smallsignal" changes in a parameter; e.g., $\left.i_{\mathrm{d}} / v_{\mathrm{gs}}=\delta I_{\mathrm{D}} / \delta V_{\mathrm{GS}}\right)$. Third, the gate of a MOSFET is truly insulated from the drain-source channel; thus, unlike the situation for bipolar transistors (or JFETs, as we'll see), you can bring it positive (or negative) at least 10 V or more without worrying about diode conduction. Finally, the FET differs from the bipolar transistor in the so-called linear (low-voltage) region of the graph, where it behaves rather accurately like a resistor, even for negative $V_{\mathrm{DS}}$; this turns out to be quite useful because the equivalent drain-source resistance is, as you might guess, programmed by the gate-source voltage.

#### B. Two examples

FETs will have more surprises in store for us. But before getting into more details, let's look at two simple switching applications. Figure 3.3 shows the MOSFET equivalent of Figure 2.5, our first saturated transistor switch. The FET circuit is even simpler, because we don't have to concern ourselves with the inevitable compromise of providing adequate base drive current (considering worst-case minimum $\beta$ combined with the lamp's cold resistance) without squandering excessive power. Instead, we just apply a fullswing dc voltage drive to the cooperative high-impedance gate. As long as the switched-on FET behaves like a resistance that is small compared with the load, it will bring its drain close to ground; typical power MOSFETs have $R_{\mathrm{ON}}<0.1 \Omega$, which is fine for this job.

We demonstrate this circuit in our electronics course, but we put a resistor in series with the gate. The students are surprised when they discover its resistance $-10 \mathrm{M} \Omega-$ which implies a "beta" of at least 100,000. They are even more surprised when they notice that the light stays on when the gate is then open-circuited: the gate voltage is held on the gate's capacitance, and will stay that way for the rest of the hour's lecture. ${ }^{2}$ That implies that the gate current is well below a picoampere!

Figure 3.4 shows an "analog switch"3 application, which cannot be done at all with bipolar transistors. The idea here is to switch the conduction of a FET from opencircuit (gate reverse-biased) to short-circuit (gate forwardbiased), thus blocking or passing the analog signal (we'll see plenty of reasons to do this sort of thing later). In this

[^103]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0166.jpg?height=1213&width=1300&top_left_y=210&top_left_x=396)

Figure 3.2. Measured MOSFET/transistor characteristic curves: A. VN0106 (similar to the popular 2N7000) n-channel MOSFET: $I_{\mathrm{D}}$ versus $V_{\mathrm{DS}}$ for various values of $V_{\mathrm{GS}}$. B. 2 N 3904 npn bipolar transistor: $I_{\mathrm{C}}$ versus $V_{\mathrm{CE}}$ for various values of $V_{\mathrm{BE}}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0166.jpg?height=323&width=313&top_left_y=1568&top_left_x=466)

Figure 3.3. MOSFET power switch.
case we just arrange for the gate to be driven more negative than any input signal swing (switch open), or a few volts more positive than any input signal swing (switch closed). Bipolar transistors aren't suited to this application, because the base draws current and forms diodes with the emitter and collector, producing awkward clamping action. The MOSFET is delightfully simple by comparison, need-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0166.jpg?height=437&width=613&top_left_y=1567&top_left_x=1163)

Figure 3.4. MOSFET analog (signal) switch.
ing only a voltage swing into the (essentially open-circuit) gate. ${ }^{4}$

[^104]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0167.jpg?height=373&width=723&top_left_y=209&top_left_x=159)

Figure 3.5. An $n$-channel "lateral" MOSFET.

### 3.1.2 FET types

#### A. n-channel, p-channel

Now for the family tree. First, FETs (like BJTs) can be fabricated in both polarities. Thus the mirror twin of our $n$-channel MOSFET is a $p$-channel MOSFET. Its behavior is symmetrical, mimicking pnp transistors: the drain is normally negative with respect to the source, and drain current flows if the gate is brought at least a volt or two negative with respect to the source. The symmetry isn't perfect because the carriers are holes, rather than electrons, with lower mobility and minority carrier lifetime. ${ }^{5}$ The consequence is worth remembering - $p$-channel FETs usually have poorer performance, manifested as a higher gate threshold voltage, higher $R_{\mathrm{ON}}$, and lower saturation current. ${ }^{6}$

#### B. MOSFET, JFET

In a MOSFET ("Metal-Oxide-Semiconductor Field-Effect Transistor") the gate region is separated from the conducting channel by a thin layer of $\mathrm{SiO}_{2}$ (glass) grown onto the channel (Figure 3.5). The gate, which may be either metal or doped silicon, is truly insulated from the sourcedrain circuit, with characteristic input resistance $>10^{14} \Omega$. It affects channel conduction purely by its electric field. MOSFETs are sometimes called insulated-gate FETs, or IGFETs. The gate insulating layer is quite thin, typically less than a wavelength of light, and can withstand gate voltages up to $\pm 20 \mathrm{~V}$ in typical power MOSFETs (less for the
what simplistic, for instance ignoring the effects of gate-channel capacitance and the variation of $R_{\mathrm{ON}}$ with signal swing. We'll have more to say about analog switches later.
${ }^{5}$ These are semiconductor parameters of importance in transistor performance.
${ }^{6}$ In the case of so-called "complementary pairs" (an $n$-channel and a $p$ channel part with similar voltage and current ratings), the $p$-channel part is usually built with a larger area in order to match the performance of the $n$-channel part. You can see the evidence in the datasheet in the form of greater capacitance for the $p$-channel part.
small MOSFETs in low-voltage integrated circuits). MOSFETs are easy to use because the gate can swing either polarity relative to the source without any gate current flowing. They are, however, quite susceptible to damage from static electricity; you can destroy a MOSFET device literally by touching it.
<img class="imgSvg" id = "m2y4u40ivqy3hw7kd5" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBpdnF5M2h3N2tkNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMjA4IDExOC44NTAyOTE5MzY5NzIyNSIgc3R5bGU9IndpZHRoOiAyMDcuNjM0NDg3NTkxNzI0NDVweDsgaGVpZ2h0OiAxMTguODUwMjkxOTM2OTcyMjVweDsgb3ZlcmZsb3c6IHZpc2libGU7Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTM4LjM1NDY3Njc2OTU0MDQyIiB5MT0iMzYuNzUwMDE4MzY0ODk3MTciIHgyPSIxNjUuNjM0NDg3NTkxNzI0NDUiIHkyPSIyMS4wMDAwMzY3Mjk4MDE0OTQiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEzOC4zNTQ2NTU1NjM1Nzk2NiIgeTE9IjY4LjI1MDAxODM2NDg5MDA0IiB4Mj0iMTM4LjM1NDY3Njc2OTU0MDQyIiB5Mj0iMzYuNzUwMDE4MzY0ODk3MTciPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS01IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjExMS4wNzQ4ODcxNTMzMTcxMiIgeTE9IjIxIiB4Mj0iMTM4LjM1NDY3Njc2OTU0MDQyIiB5Mj0iMzYuNzUwMDE4MzY0ODk3MTciPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjExMS4wNzQ4NDQ3NDEzOTU2NSIgeTE9IjgzLjk5OTk5OTk5OTk4NTcyIiB4Mj0iMTM4LjM1NDY1NTU2MzU3OTY2IiB5Mj0iNjguMjUwMDE4MzY0ODkwMDQiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjgzLjc5NTA3NjMzMTEzMzEyIiB5MT0iMzYuNzQ5OTgxNjM1MDk1NzIiIHgyPSIxMTEuMDc0ODg3MTUzMzE3MTIiIHkyPSIyMSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjgzLjc5NTA1NTEyNTE3MjM4IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTkiIHgyPSIxMTEuMDc0ODQ0NzQxMzk1NjUiIHkyPSI4My45OTk5OTk5OTk5ODU3MiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTEzIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjgzLjc5NTA1NTEyNTE3MjM4IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTkiIHgyPSI4My43OTUwNzYzMzExMzMxMiIgeTI9IjM2Ljc0OTk4MTYzNTA5NTcyIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwaXZxeTNodzdrZDUtMTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNzMuMDIxNDAwNjgzMzMxNDQiIHkxPSI5Ny44NTAyOTE5MzY5NzIyNSIgeDI9IjgzLjc5NTA1NTEyNTE3MjM4IiB5Mj0iNjguMjQ5OTgxNjM1MDg4NTkiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS0xNyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI1Mi43NzM2MTQ1ODc2NzEzIiB5MT0iNjIuNzgwMDQzMTU0Nzg2OTY2IiB4Mj0iODMuNzk1MDU1MTI1MTcyMzgiIHkyPSI2OC4yNDk5ODE2MzUwODg1OSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTE5IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iMzMuMTc5NzE4MzQ3MTcxODMiIHgyPSI1Mi43NzM2MTQ1ODc2NzEzIiB5Mj0iNjIuNzgwMDQzMTU0Nzg2OTY2Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48bWFzayBpZD0idGV4dC1tYXNrLW0yeTR1NDBpdnF5M2h3N2tkNSI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0id2hpdGUiPjwvcmVjdD48Y2lyY2xlIGN4PSI0MiIgY3k9IjMzLjE3OTcxODM0NzE3MTgzIiByPSI3Ljg3NSIgZmlsbD0iYmxhY2siPjwvY2lyY2xlPjwvbWFzaz48c3R5bGU+CiAgICAgICAgICAgICAgICAuZWxlbWVudC1tMnk0dTQwaXZxeTNodzdrZDUgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQwaXZxeTNodzdrZDUgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTJ5NHU0MGl2cXkzaHc3a2Q1KSI+PGxpbmUgeDE9IjEzOC4zNTQ2NzY3Njk1NDA0MiIgeTE9IjM2Ljc1MDAxODM2NDg5NzE3IiB4Mj0iMTY1LjYzNDQ4NzU5MTcyNDQ1IiB5Mj0iMjEuMDAwMDM2NzI5ODAxNDk0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMzguMzU0NjU1NTYzNTc5NjYiIHkxPSI2OC4yNTAwMTgzNjQ4OTAwNCIgeDI9IjEzOC4zNTQ2NzY3Njk1NDA0MiIgeTI9IjM2Ljc1MDAxODM2NDg5NzE3IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTMnKSI+PC9saW5lPjxsaW5lIHgxPSIxMTEuMDc0ODg3MTUzMzE3MTIiIHkxPSIyMSIgeDI9IjEzOC4zNTQ2NzY3Njk1NDA0MiIgeTI9IjM2Ljc1MDAxODM2NDg5NzE3IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTUnKSI+PC9saW5lPjxsaW5lIHgxPSIxMTEuMDc0ODQ0NzQxMzk1NjUiIHkxPSI4My45OTk5OTk5OTk5ODU3MiIgeDI9IjEzOC4zNTQ2NTU1NjM1Nzk2NiIgeTI9IjY4LjI1MDAxODM2NDg5MDA0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTcnKSI+PC9saW5lPjxsaW5lIHgxPSI4My43OTUwNzYzMzExMzMxMiIgeTE9IjM2Ljc0OTk4MTYzNTA5NTcyIiB4Mj0iMTExLjA3NDg4NzE1MzMxNzEyIiB5Mj0iMjEiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwaXZxeTNodzdrZDUtOScpIj48L2xpbmU+PGxpbmUgeDE9IjgzLjc5NTA1NTEyNTE3MjM4IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTkiIHgyPSIxMTEuMDc0ODQ0NzQxMzk1NjUiIHkyPSI4My45OTk5OTk5OTk5ODU3MiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS0xMScpIj48L2xpbmU+PGxpbmUgeDE9IjgzLjc5NTA1NTEyNTE3MjM4IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTkiIHgyPSI4My43OTUwNzYzMzExMzMxMiIgeTI9IjM2Ljc0OTk4MTYzNTA5NTcyIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTEzJykiPjwvbGluZT48bGluZSB4MT0iNzMuMDIxNDAwNjgzMzMxNDQiIHkxPSI5Ny44NTAyOTE5MzY5NzIyNSIgeDI9IjgzLjc5NTA1NTEyNTE3MjM4IiB5Mj0iNjguMjQ5OTgxNjM1MDg4NTkiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwaXZxeTNodzdrZDUtMTUnKSI+PC9saW5lPjxsaW5lIHgxPSI1Mi43NzM2MTQ1ODc2NzEzIiB5MT0iNjIuNzgwMDQzMTU0Nzg2OTY2IiB4Mj0iODMuNzk1MDU1MTI1MTcyMzgiIHkyPSI2OC4yNDk5ODE2MzUwODg1OSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBpdnF5M2h3N2tkNS0xNycpIj48L2xpbmU+PGxpbmUgeDE9IjQyIiB5MT0iMzMuMTc5NzE4MzQ3MTcxODMiIHgyPSI1Mi43NzM2MTQ1ODc2NzEzIiB5Mj0iNjIuNzgwMDQzMTU0Nzg2OTY2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGl2cXkzaHc3a2Q1LTE5JykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTY1LjYzNDQ4NzU5MTcyNDQ1IiB5PSIyMS4wMDAwMzY3Mjk4MDE0OTQiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEzOC4zNTQ2NzY3Njk1NDA0MiIgeT0iMzYuNzUwMDE4MzY0ODk3MTciIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEzOC4zNTQ2NTU1NjM1Nzk2NiIgeT0iNjguMjUwMDE4MzY0ODkwMDQiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjExMS4wNzQ4NDQ3NDEzOTU2NSIgeT0iODMuOTk5OTk5OTk5OTg1NzIiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjgzLjc5NTA1NTEyNTE3MjM4IiB5PSI2OC4yNDk5ODE2MzUwODg1OSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNzMuMDIxNDAwNjgzMzMxNDQiIHk9Ijk3Ljg1MDI5MTkzNjk3MjI1IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI1Mi43NzM2MTQ1ODc2NzEzIiB5PSI2Mi43ODAwNDMxNTQ3ODY5NjYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjM2Ljc1IiB5PSIzOC40Mjk3MTgzNDcxNzE4MyIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MGl2cXkzaHc3a2Q1IiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbHRyOwogICAgICAgICAgICAiPjx0c3Bhbj5TPC90c3Bhbj48dHNwYW4gc3R5bGU9InVuaWNvZGUtYmlkaTogcGxhaW50ZXh0OyI+SDwvdHNwYW4+PC90ZXh0Pjx0ZXh0IHg9IjQyIiB5PSIzMy4xNzk3MTgzNDcxNzE4MyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iODMuNzk1MDc2MzMxMTMzMTIiIHk9IjM2Ljc0OTk4MTYzNTA5NTcyIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMTEuMDc0ODg3MTUzMzE3MTIiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0167.jpg?height=93&width=108&top_left_y=489&top_left_x=1413)
<img class="imgSvg" id = "m2y4u40lvien53dltce" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBsdmllbjUzZGx0Y2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDE5MyAxMTYuNTI5NzkyNDU3MjcyNTUiIHN0eWxlPSJ3aWR0aDogMTkzLjExOTIwMDg3NjgxNDU1cHg7IGhlaWdodDogMTE2LjUyOTc5MjQ1NzI3MjU1cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBsdmllbjUzZGx0Y2UtMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjUuMjU2OTEyOTEzNDMyMDMiIHkxPSI1MC4wNDQ4MTg5MzQ1MzI3NiIgeDI9IjE1Mi41MzY3MDI1Mjk2NTUzIiB5Mj0iNjUuNzk0ODM3Mjk5NDI5OTMiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBsdmllbjUzZGx0Y2UtMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjIuNDIxOTA5NjA3NzUwNTUiIHkxPSI1NC45NTUxODEwNjU0NTI5NTUiIHgyPSIxNDkuNzAxNjk5MjIzOTczOCIgeTI9IjcwLjcwNTE5OTQzMDM1MDEyIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTIzLjgzOTQxMTI2MDU5MTI5IiB5MT0iNTIuNDk5OTk5OTk5OTkyODYiIHgyPSIxMjMuODM5NDMyNDY2NTUyMDUiIHkyPSIyMSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjU1OTYwMDQzODQwNzI3IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTUiIHgyPSIxMjMuODM5NDExMjYwNTkxMjkiIHkyPSI1Mi40OTk5OTk5OTk5OTI4NiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjgwLjgwOTU4MjA3MzUxMDA5IiB5MT0iOTUuNTI5NzcxMjUxMzExNzkiIHgyPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTI9IjY4LjI0OTk4MTYzNTA4ODU1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjU1OTYwMDQzODQwNzI3IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTUiIHgyPSIxMTIuMzA5NTgyMDczNTAyOTUiIHkyPSI5NS41Mjk3OTI0NTcyNzI1NSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS0xMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI2OS4yNzk4MTA4MjIxODQwMiIgeTE9IjUyLjQ5OTk2MzI3MDE5MTM4IiB4Mj0iOTYuNTU5NjAwNDM4NDA3MjciIHkyPSI2OC4yNDk5ODE2MzUwODg1NSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS0xNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MiIgeTE9IjY4LjI0OTk0NDkwNTI4NzA3IiB4Mj0iNjkuMjc5ODEwODIyMTg0MDIiIHkyPSI1Mi40OTk5NjMyNzAxOTEzOCI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PG1hc2sgaWQ9InRleHQtbWFzay1tMnk0dTQwbHZpZW41M2RsdGNlIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjwvbWFzaz48c3R5bGU+CiAgICAgICAgICAgICAgICAuZWxlbWVudC1tMnk0dTQwbHZpZW41M2RsdGNlIHsKICAgICAgICAgICAgICAgICAgICBmb250OiAxNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50LWJhc2VsaW5lOiAnbWlkZGxlJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5zdWItbTJ5NHU0MGx2aWVuNTNkbHRjZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogOC40cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgPC9zdHlsZT48ZyBtYXNrPSJ1cmwoI3RleHQtbWFzay1tMnk0dTQwbHZpZW41M2RsdGNlKSI+PGxpbmUgeDE9IjEyNS4yNTY5MTI5MTM0MzIwMyIgeTE9IjUwLjA0NDgxODkzNDUzMjc2IiB4Mj0iMTUyLjUzNjcwMjUyOTY1NTMiIHkyPSI2NS43OTQ4MzcyOTk0Mjk5MyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBsdmllbjUzZGx0Y2UtMScpIj48L2xpbmU+PGxpbmUgeDE9IjEyMi40MjE5MDk2MDc3NTA1NSIgeTE9IjU0Ljk1NTE4MTA2NTQ1Mjk1NSIgeDI9IjE0OS43MDE2OTkyMjM5NzM4IiB5Mj0iNzAuNzA1MTk5NDMwMzUwMTIiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTMnKSI+PC9saW5lPjxsaW5lIHgxPSIxMjMuODM5NDExMjYwNTkxMjkiIHkxPSI1Mi40OTk5OTk5OTk5OTI4NiIgeDI9IjEyMy44Mzk0MzI0NjY1NTIwNSIgeTI9IjIxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS01JykiPjwvbGluZT48bGluZSB4MT0iOTYuNTU5NjAwNDM4NDA3MjciIHkxPSI2OC4yNDk5ODE2MzUwODg1NSIgeDI9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeTI9IjUyLjQ5OTk5OTk5OTk5Mjg2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MGx2aWVuNTNkbHRjZS03JykiPjwvbGluZT48bGluZSB4MT0iODAuODA5NTgyMDczNTEwMDkiIHkxPSI5NS41Mjk3NzEyNTEzMTE3OSIgeDI9Ijk2LjU1OTYwMDQzODQwNzI3IiB5Mj0iNjguMjQ5OTgxNjM1MDg4NTUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTknKSI+PC9saW5lPjxsaW5lIHgxPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTE9IjY4LjI0OTk4MTYzNTA4ODU1IiB4Mj0iMTEyLjMwOTU4MjA3MzUwMjk1IiB5Mj0iOTUuNTI5NzkyNDU3MjcyNTUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTExJykiPjwvbGluZT48bGluZSB4MT0iNjkuMjc5ODEwODIyMTg0MDIiIHkxPSI1Mi40OTk5NjMyNzAxOTEzOCIgeDI9Ijk2LjU1OTYwMDQzODQwNzI3IiB5Mj0iNjguMjQ5OTgxNjM1MDg4NTUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTEzJykiPjwvbGluZT48bGluZSB4MT0iNDIiIHkxPSI2OC4yNDk5NDQ5MDUyODcwNyIgeDI9IjY5LjI3OTgxMDgyMjE4NDAyIiB5Mj0iNTIuNDk5OTYzMjcwMTkxMzgiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbHZpZW41M2RsdGNlLTE1JykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTUxLjExOTIwMDg3NjgxNDU1IiB5PSI2OC4yNTAwMTgzNjQ4OTAwMiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTIzLjgzOTQxMTI2MDU5MTI5IiB5PSI1Mi40OTk5OTk5OTk5OTI4NiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTIzLjgzOTQzMjQ2NjU1MjA1IiB5PSIyMSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iOTYuNTU5NjAwNDM4NDA3MjciIHk9IjY4LjI0OTk4MTYzNTA4ODU1IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI4MC44MDk1ODIwNzM1MTAwOSIgeT0iOTUuNTI5NzcxMjUxMzExNzkiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjExMi4zMDk1ODIwNzM1MDI5NSIgeT0iOTUuNTI5NzkyNDU3MjcyNTUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjY5LjI3OTgxMDgyMjE4NDAyIiB5PSI1Mi40OTk5NjMyNzAxOTEzOCIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjY4LjI0OTk0NDkwNTI4NzA3IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
<img class="imgSvg" id = "m2y4u40m01zlb3g87bve" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBtMDF6bGIzZzg3YnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxOTMgMTIwLjc0OTk4MTYzNTA4MTQxIiBzdHlsZT0id2lkdGg6IDE5My4xMTkyMDA4NzY4MTQ1NXB4OyBoZWlnaHQ6IDEyMC43NDk5ODE2MzUwODE0MXB4OyBvdmVyZmxvdzogdmlzaWJsZTsiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS0xIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyNS4yNTY5MTI5MTM0MzIwMyIgeTE9IjUwLjA0NDgxODkzNDUzMjc2IiB4Mj0iMTUyLjUzNjcwMjUyOTY1NTMiIHkyPSI2NS43OTQ4MzcyOTk0Mjk5MyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MG0wMXpsYjNnODdidmUtMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjIuNDIxOTA5NjA3NzUwNTUiIHkxPSI1NC45NTUxODEwNjU0NTI5NTUiIHgyPSIxNDkuNzAxNjk5MjIzOTczOCIgeTI9IjcwLjcwNTE5OTQzMDM1MDEyIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS01IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeTE9IjUyLjQ5OTk5OTk5OTk5Mjg2IiB4Mj0iMTIzLjgzOTQzMjQ2NjU1MjA1IiB5Mj0iMjEiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBtMDF6bGIzZzg3YnZlLTciIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iOTYuNTU5NjAwNDM4NDA3MjciIHkxPSI2OC4yNDk5ODE2MzUwODg1NSIgeDI9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeTI9IjUyLjQ5OTk5OTk5OTk5Mjg2Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjU1OTU3OTIzMjQ0NjUiIHkxPSI5OS43NDk5ODE2MzUwODE0MSIgeDI9Ijk2LjU1OTYwMDQzODQwNzI3IiB5Mj0iNjguMjQ5OTgxNjM1MDg4NTUiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBtMDF6bGIzZzg3YnZlLTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijc0Ljg0Mjc5MzA4OTQ4NzgzIiB5MT0iNDkuMTY0NjAyOTc1NzYwOTEiIHgyPSI5Ni42NjY2MjQ3ODI0NjY0NCIgeTI9IjYxLjc2NDYxNzY2NzY3ODY0Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS0xMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI2OS4yNzk4MTA4MjIxODQwMiIgeTE9IjUyLjQ5OTk2MzI3MDE5MTM4IiB4Mj0iOTYuNTU5NjAwNDM4NDA3MjciIHkyPSI2OC4yNDk5ODE2MzUwODg1NSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MG0wMXpsYjNnODdidmUtMTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNDIiIHkxPSI2OC4yNDk5NDQ5MDUyODcwNyIgeDI9IjY5LjI3OTgxMDgyMjE4NDAyIiB5Mj0iNTIuNDk5OTYzMjcwMTkxMzgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxtYXNrIGlkPSJ0ZXh0LW1hc2stbTJ5NHU0MG0wMXpsYjNnODdidmUiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IndoaXRlIj48L3JlY3Q+PGNpcmNsZSBjeD0iNDIiIGN5PSI2OC4yNDk5NDQ5MDUyODcwNyIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48L21hc2s+PHN0eWxlPgogICAgICAgICAgICAgICAgLmVsZW1lbnQtbTJ5NHU0MG0wMXpsYjNnODdidmUgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQwbTAxemxiM2c4N2J2ZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogOC40cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgPC9zdHlsZT48ZyBtYXNrPSJ1cmwoI3RleHQtbWFzay1tMnk0dTQwbTAxemxiM2c4N2J2ZSkiPjxsaW5lIHgxPSIxMjUuMjU2OTEyOTEzNDMyMDMiIHkxPSI1MC4wNDQ4MTg5MzQ1MzI3NiIgeDI9IjE1Mi41MzY3MDI1Mjk2NTUzIiB5Mj0iNjUuNzk0ODM3Mjk5NDI5OTMiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS0xJykiPjwvbGluZT48bGluZSB4MT0iMTIyLjQyMTkwOTYwNzc1MDU1IiB5MT0iNTQuOTU1MTgxMDY1NDUyOTU1IiB4Mj0iMTQ5LjcwMTY5OTIyMzk3MzgiIHkyPSI3MC43MDUxOTk0MzAzNTAxMiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBtMDF6bGIzZzg3YnZlLTMnKSI+PC9saW5lPjxsaW5lIHgxPSIxMjMuODM5NDExMjYwNTkxMjkiIHkxPSI1Mi40OTk5OTk5OTk5OTI4NiIgeDI9IjEyMy44Mzk0MzI0NjY1NTIwNSIgeTI9IjIxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG0wMXpsYjNnODdidmUtNScpIj48L2xpbmU+PGxpbmUgeDE9Ijk2LjU1OTYwMDQzODQwNzI3IiB5MT0iNjguMjQ5OTgxNjM1MDg4NTUiIHgyPSIxMjMuODM5NDExMjYwNTkxMjkiIHkyPSI1Mi40OTk5OTk5OTk5OTI4NiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBtMDF6bGIzZzg3YnZlLTcnKSI+PC9saW5lPjxsaW5lIHgxPSI5Ni41NTk1NzkyMzI0NDY1IiB5MT0iOTkuNzQ5OTgxNjM1MDgxNDEiIHgyPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTI9IjY4LjI0OTk4MTYzNTA4ODU1IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG0wMXpsYjNnODdidmUtOScpIj48L2xpbmU+PGxpbmUgeDE9Ijc0Ljg0Mjc5MzA4OTQ4NzgzIiB5MT0iNDkuMTY0NjAyOTc1NzYwOTEiIHgyPSI5Ni42NjY2MjQ3ODI0NjY0NCIgeTI9IjYxLjc2NDYxNzY2NzY3ODY0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG0wMXpsYjNnODdidmUtMTEnKSI+PC9saW5lPjxsaW5lIHgxPSI2OS4yNzk4MTA4MjIxODQwMiIgeTE9IjUyLjQ5OTk2MzI3MDE5MTM4IiB4Mj0iOTYuNTU5NjAwNDM4NDA3MjciIHkyPSI2OC4yNDk5ODE2MzUwODg1NSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBtMDF6bGIzZzg3YnZlLTEzJykiPjwvbGluZT48bGluZSB4MT0iNDIiIHkxPSI2OC4yNDk5NDQ5MDUyODcwNyIgeDI9IjY5LjI3OTgxMDgyMjE4NDAyIiB5Mj0iNTIuNDk5OTYzMjcwMTkxMzgiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbTAxemxiM2c4N2J2ZS0xNScpIj48L2xpbmU+PC9nPjxnPjx0ZXh0IHg9IjE1MS4xMTkyMDA4NzY4MTQ1NSIgeT0iNjguMjUwMDE4MzY0ODkwMDIiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeT0iNTIuNDk5OTk5OTk5OTkyODYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyMy44Mzk0MzI0NjY1NTIwNSIgeT0iMjEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijk2LjU1OTYwMDQzODQwNzI3IiB5PSI2OC4yNDk5ODE2MzUwODg1NSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iOTYuNTU5NTc5MjMyNDQ2NSIgeT0iOTkuNzQ5OTgxNjM1MDgxNDEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjY5LjI3OTgxMDgyMjE4NDAyIiB5PSI1Mi40OTk5NjMyNzAxOTEzOCIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNDcuMjUiIHk9IjczLjQ5OTk0NDkwNTI4NzA3IiBjbGFzcz0iZWxlbWVudC1tMnk0dTQwbTAxemxiM2c4N2J2ZSIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDsgdW5pY29kZS1iaWRpOiBiaWRpLW92ZXJyaWRlOwogICAgICAgICAgICAiPjx0c3Bhbj5JPC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjY4LjI0OTk0NDkwNTI4NzA3IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
<img class="imgSvg" id = "m2y4u40n8nt5r6c3nto" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBuOG50NXI2YzNudG8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDIyMCA1Ny43NTAwOTE4MjQ1MDAxMiIgc3R5bGU9IndpZHRoOiAyMjAuMzk4OTkwNDkzMDM3ODFweDsgaGVpZ2h0OiA1Ny43NTAwOTE4MjQ1MDAxMnB4OyBvdmVyZmxvdzogdmlzaWJsZTsiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUxLjExOTIwMDg3NjgxNDU1IiB5MT0iMjEuMDAwMDczNDU5NjAyOTYiIHgyPSIxNzguMzk4OTkwNDkzMDM3ODEiIHkyPSIzNi43NTAwOTE4MjQ1MDAxMiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MG44bnQ1cjZjM250by0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyOS40MDIzNjc4MzExNjYxNSIgeTE9IjQwLjA4NTQyMjg3OTE4MjE3NSIgeDI9IjE1MS4yMjYyMTY0ODg5MTMzNyIgeTI9IjI3LjQ4NTQzNzU3MTEwNTY1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTIzLjgzOTM5MDA1NDYzMDUxIiB5MT0iMzYuNzUwMDU1MDk0Njk4NjQiIHgyPSIxNTEuMTE5MjAwODc2ODE0NTUiIHkyPSIyMS4wMDAwNzM0NTk2MDI5NiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MG44bnQ1cjZjM250by03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjU1OTYwMDQzODQwNzI3IiB5MT0iMjEuMDAwMDM2NzI5ODAxNDgiIHgyPSIxMjMuODM5MzkwMDU0NjMwNTEiIHkyPSIzNi43NTAwNTUwOTQ2OTg2NCI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MG44bnQ1cjZjM250by05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijc0Ljg0Mjc2NzM5Mjc1ODg3IiB5MT0iNDAuMDg1Mzg2MTQ5MzgwNjk2IiB4Mj0iOTYuNjY2NjE2MDUwNTA2MSIgeTI9IjI3LjQ4NTQwMDg0MTMwNDE3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjY5LjI3OTc4OTYxNjIyMzI1IiB5MT0iMzYuNzUwMDE4MzY0ODk3MTYiIHgyPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTI9IjIxLjAwMDAzNjcyOTgwMTQ4Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTEzIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iMjEiIHgyPSI2OS4yNzk3ODk2MTYyMjMyNSIgeTI9IjM2Ljc1MDAxODM2NDg5NzE2Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48bWFzayBpZD0idGV4dC1tYXNrLW0yeTR1NDBuOG50NXI2YzNudG8iPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IndoaXRlIj48L3JlY3Q+PGNpcmNsZSBjeD0iNDIiIGN5PSIyMSIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48L21hc2s+PHN0eWxlPgogICAgICAgICAgICAgICAgLmVsZW1lbnQtbTJ5NHU0MG44bnQ1cjZjM250byB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogMTRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGFsaWdubWVudC1iYXNlbGluZTogJ21pZGRsZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuc3ViLW0yeTR1NDBuOG50NXI2YzNudG8gewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTJ5NHU0MG44bnQ1cjZjM250bykiPjxsaW5lIHgxPSIxNTEuMTE5MjAwODc2ODE0NTUiIHkxPSIyMS4wMDAwNzM0NTk2MDI5NiIgeDI9IjE3OC4zOTg5OTA0OTMwMzc4MSIgeTI9IjM2Ljc1MDA5MTgyNDUwMDEyIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG44bnQ1cjZjM250by0xJykiPjwvbGluZT48bGluZSB4MT0iMTI5LjQwMjM2NzgzMTE2NjE1IiB5MT0iNDAuMDg1NDIyODc5MTgyMTc1IiB4Mj0iMTUxLjIyNjIxNjQ4ODkxMzM3IiB5Mj0iMjcuNDg1NDM3NTcxMTA1NjUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTMnKSI+PC9saW5lPjxsaW5lIHgxPSIxMjMuODM5MzkwMDU0NjMwNTEiIHkxPSIzNi43NTAwNTUwOTQ2OTg2NCIgeDI9IjE1MS4xMTkyMDA4NzY4MTQ1NSIgeTI9IjIxLjAwMDA3MzQ1OTYwMjk2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG44bnQ1cjZjM250by01JykiPjwvbGluZT48bGluZSB4MT0iOTYuNTU5NjAwNDM4NDA3MjciIHkxPSIyMS4wMDAwMzY3Mjk4MDE0OCIgeDI9IjEyMy44MzkzOTAwNTQ2MzA1MSIgeTI9IjM2Ljc1MDA1NTA5NDY5ODY0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MG44bnQ1cjZjM250by03JykiPjwvbGluZT48bGluZSB4MT0iNzQuODQyNzY3MzkyNzU4ODciIHkxPSI0MC4wODUzODYxNDkzODA2OTYiIHgyPSI5Ni42NjY2MTYwNTA1MDYxIiB5Mj0iMjcuNDg1NDAwODQxMzA0MTciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwbjhudDVyNmMzbnRvLTknKSI+PC9saW5lPjxsaW5lIHgxPSI2OS4yNzk3ODk2MTYyMjMyNSIgeTE9IjM2Ljc1MDAxODM2NDg5NzE2IiB4Mj0iOTYuNTU5NjAwNDM4NDA3MjciIHkyPSIyMS4wMDAwMzY3Mjk4MDE0OCIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBuOG50NXI2YzNudG8tMTEnKSI+PC9saW5lPjxsaW5lIHgxPSI0MiIgeTE9IjIxIiB4Mj0iNjkuMjc5Nzg5NjE2MjIzMjUiIHkyPSIzNi43NTAwMTgzNjQ4OTcxNiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBuOG50NXI2YzNudG8tMTMnKSI+PC9saW5lPjwvZz48Zz48dGV4dCB4PSIxNzguMzk4OTkwNDkzMDM3ODEiIHk9IjM2Ljc1MDA5MTgyNDUwMDEyIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxNTEuMTE5MjAwODc2ODE0NTUiIHk9IjIxLjAwMDA3MzQ1OTYwMjk2IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMjMuODM5MzkwMDU0NjMwNTEiIHk9IjM2Ljc1MDA1NTA5NDY5ODY0IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI5Ni41NTk2MDA0Mzg0MDcyNyIgeT0iMjEuMDAwMDM2NzI5ODAxNDgiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjY5LjI3OTc4OTYxNjIyMzI1IiB5PSIzNi43NTAwMTgzNjQ4OTcxNiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNDcuMjUiIHk9IjI2LjI1IiBjbGFzcz0iZWxlbWVudC1tMnk0dTQwbjhudDVyNmMzbnRvIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogcnRsOyB1bmljb2RlLWJpZGk6IGJpZGktb3ZlcnJpZGU7CiAgICAgICAgICAgICI+PHRzcGFuPkk8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSI0MiIgeT0iMjEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0PjwvZz48L3N2Zz4="/>
<img class="imgSvg" id = "m2y4u40ouj8rko5u56e" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBvdWo4cmtvNXU1NmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDExNSA0Mi4wMDAwMTQxMzczMDcxNzYiIHN0eWxlPSJ3aWR0aDogMTE1LjQ5OTk5OTk5OTk5NjgycHg7IGhlaWdodDogNDIuMDAwMDE0MTM3MzA3MTc2cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBvdWo4cmtvNXU1NmUtMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MiIgeTE9IjIxIiB4Mj0iNzMuNDk5OTk5OTk5OTk2ODIiIHkyPSIyMS4wMDAwMTQxMzczMDcxOCI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PG1hc2sgaWQ9InRleHQtbWFzay1tMnk0dTQwb3VqOHJrbzV1NTZlIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjxjaXJjbGUgY3g9IjczLjQ5OTk5OTk5OTk5NjgyIiBjeT0iMjEuMDAwMDE0MTM3MzA3MTgiIHI9IjcuODc1IiBmaWxsPSJibGFjayI+PC9jaXJjbGU+PGNpcmNsZSBjeD0iNDIiIGN5PSIyMSIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48L21hc2s+PHN0eWxlPgogICAgICAgICAgICAgICAgLmVsZW1lbnQtbTJ5NHU0MG91ajhya281dTU2ZSB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogMTRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGFsaWdubWVudC1iYXNlbGluZTogJ21pZGRsZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuc3ViLW0yeTR1NDBvdWo4cmtvNXU1NmUgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTJ5NHU0MG91ajhya281dTU2ZSkiPjxsaW5lIHgxPSI0MiIgeTE9IjIxIiB4Mj0iNzMuNDk5OTk5OTk5OTk2ODIiIHkyPSIyMS4wMDAwMTQxMzczMDcxOCIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBvdWo4cmtvNXU1NmUtMScpIj48L2xpbmU+PC9nPjxnPjx0ZXh0IHg9IjY5LjU2MjQ5OTk5OTk5NjgyIiB5PSIyNi4yNTAwMTQxMzczMDcxOCIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MG91ajhya281dTU2ZSIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGx0cjsKICAgICAgICAgICAgIj48dHNwYW4gc3R5bGU9IgogICAgICAgICAgICAgICAgdW5pY29kZS1iaWRpOiBwbGFpbnRleHQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGxyLXRiOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgIj5BbDwvdHNwYW4+PHRzcGFuIHN0eWxlPSJ1bmljb2RlLWJpZGk6IHBsYWludGV4dDsiPkg8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSI3My40OTk5OTk5OTk5OTY4MiIgeT0iMjEuMDAwMDE0MTM3MzA3MTgiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjQ3LjI1IiB5PSIyNi4yNSIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MG91ajhya281dTU2ZSIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDsgdW5pY29kZS1iaWRpOiBiaWRpLW92ZXJyaWRlOwogICAgICAgICAgICAiPjx0c3Bhbj5WPC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
<img class="imgSvg" id = "m2y4u40pyemfqrfa37j" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBweWVtZnFyZmEzN2oiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDE5NCA5Ni41NTk2ODUyNjIyNDA3MyIgc3R5bGU9IndpZHRoOiAxOTQuMjQ5OTc1NTEzNDIxMjhweDsgaGVpZ2h0OiA5Ni41NTk2ODUyNjIyNDA3M3B4OyBvdmVyZmxvdzogdmlzaWJsZTsiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTM2LjQ5OTk5OTk5OTk2MTkxIiB5MT0iNDguMjc5ODcwOTA1NzM0NzEiIHgyPSIxNTIuMjQ5OTc1NTEzNDIxMjgiIHkyPSI3NS41NTk2ODUyNjIyNDA3MyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHB5ZW1mcXJmYTM3ai0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEwOC4xNTAwMDUwODk0MDM5NSIgeTE9IjQyLjYwOTg0NTQ1ODU4NDA3NiIgeDI9IjEzMy4zNTAwMDUwODkzOTM3NiIgeTI9IjQyLjYwOTg2ODA3ODI3NTU3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTA0Ljk5OTk5OTk5OTk3NDYyIiB5MT0iNDguMjc5ODQyNjMxMTIwMzYiIHgyPSIxMzYuNDk5OTk5OTk5OTYxOTEiIHkyPSI0OC4yNzk4NzA5MDU3MzQ3MSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHB5ZW1mcXJmYTM3ai03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijg5LjI0OTk3NTUxMzQ0NjY0IiB5MT0iNzUuNTU5NjI4NzEzMDEyIiB4Mj0iMTA0Ljk5OTk5OTk5OTk3NDYyIiB5Mj0iNDguMjc5ODQyNjMxMTIwMzYiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBweWVtZnFyZmEzN2otOSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4OS4yNTAwMjQ0ODY1MTUyNyIgeTE9IjIxLjAwMDAyODI3NDYxNDM2NSIgeDI9IjEwNC45OTk5OTk5OTk5NzQ2MiIgeTI9IjQ4LjI3OTg0MjYzMTEyMDM2Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjYwLjkwMDAyOTU3NTk1NzI4IiB5MT0iMTUuMzMwMDAyODI3NDYzNzE2IiB4Mj0iODYuMTAwMDI5NTc1OTQ3MTMiIHkyPSIxNS4zMzAwMjU0NDcxNTUyMjIiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBweWVtZnFyZmEzN2otMTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNTcuNzUwMDI0NDg2NTI3OTYiIHkxPSIyMSIgeDI9Ijg5LjI1MDAyNDQ4NjUxNTI3IiB5Mj0iMjEuMDAwMDI4Mjc0NjE0MzY1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTE1IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iNDguMjc5Nzg2MDgxODkxNjYiIHgyPSI1Ny43NTAwMjQ0ODY1Mjc5NiIgeTI9IjIxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjwvZGVmcz48bWFzayBpZD0idGV4dC1tYXNrLW0yeTR1NDBweWVtZnFyZmEzN2oiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IndoaXRlIj48L3JlY3Q+PC9tYXNrPjxzdHlsZT4KICAgICAgICAgICAgICAgIC5lbGVtZW50LW0yeTR1NDBweWVtZnFyZmEzN2ogewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQwcHllbWZxcmZhMzdqIHsKICAgICAgICAgICAgICAgICAgICBmb250OiA4LjRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICA8L3N0eWxlPjxnIG1hc2s9InVybCgjdGV4dC1tYXNrLW0yeTR1NDBweWVtZnFyZmEzN2opIj48bGluZSB4MT0iMTM2LjQ5OTk5OTk5OTk2MTkxIiB5MT0iNDguMjc5ODcwOTA1NzM0NzEiIHgyPSIxNTIuMjQ5OTc1NTEzNDIxMjgiIHkyPSI3NS41NTk2ODUyNjIyNDA3MyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBweWVtZnFyZmEzN2otMScpIj48L2xpbmU+PGxpbmUgeDE9IjEwOC4xNTAwMDUwODk0MDM5NSIgeTE9IjQyLjYwOTg0NTQ1ODU4NDA3NiIgeDI9IjEzMy4zNTAwMDUwODkzOTM3NiIgeTI9IjQyLjYwOTg2ODA3ODI3NTU3IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHB5ZW1mcXJmYTM3ai0zJykiPjwvbGluZT48bGluZSB4MT0iMTA0Ljk5OTk5OTk5OTk3NDYyIiB5MT0iNDguMjc5ODQyNjMxMTIwMzYiIHgyPSIxMzYuNDk5OTk5OTk5OTYxOTEiIHkyPSI0OC4yNzk4NzA5MDU3MzQ3MSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBweWVtZnFyZmEzN2otNScpIj48L2xpbmU+PGxpbmUgeDE9Ijg5LjI0OTk3NTUxMzQ0NjY0IiB5MT0iNzUuNTU5NjI4NzEzMDEyIiB4Mj0iMTA0Ljk5OTk5OTk5OTk3NDYyIiB5Mj0iNDguMjc5ODQyNjMxMTIwMzYiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTcnKSI+PC9saW5lPjxsaW5lIHgxPSI4OS4yNTAwMjQ0ODY1MTUyNyIgeTE9IjIxLjAwMDAyODI3NDYxNDM2NSIgeDI9IjEwNC45OTk5OTk5OTk5NzQ2MiIgeTI9IjQ4LjI3OTg0MjYzMTEyMDM2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHB5ZW1mcXJmYTM3ai05JykiPjwvbGluZT48bGluZSB4MT0iNjAuOTAwMDI5NTc1OTU3MjgiIHkxPSIxNS4zMzAwMDI4Mjc0NjM3MTYiIHgyPSI4Ni4xMDAwMjk1NzU5NDcxMyIgeTI9IjE1LjMzMDAyNTQ0NzE1NTIyMiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBweWVtZnFyZmEzN2otMTEnKSI+PC9saW5lPjxsaW5lIHgxPSI1Ny43NTAwMjQ0ODY1Mjc5NiIgeTE9IjIxIiB4Mj0iODkuMjUwMDI0NDg2NTE1MjciIHkyPSIyMS4wMDAwMjgyNzQ2MTQzNjUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTEzJykiPjwvbGluZT48bGluZSB4MT0iNDIiIHkxPSI0OC4yNzk3ODYwODE4OTE2NiIgeDI9IjU3Ljc1MDAyNDQ4NjUyNzk2IiB5Mj0iMjEiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcHllbWZxcmZhMzdqLTE1JykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTUyLjI0OTk3NTUxMzQyMTI4IiB5PSI3NS41NTk2ODUyNjIyNDA3MyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTM2LjQ5OTk5OTk5OTk2MTkxIiB5PSI0OC4yNzk4NzA5MDU3MzQ3MSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTA0Ljk5OTk5OTk5OTk3NDYyIiB5PSI0OC4yNzk4NDI2MzExMjAzNiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iODkuMjQ5OTc1NTEzNDQ2NjQiIHk9Ijc1LjU1OTYyODcxMzAxMiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iODkuMjUwMDI0NDg2NTE1MjciIHk9IjIxLjAwMDAyODI3NDYxNDM2NSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNTcuNzUwMDI0NDg2NTI3OTYiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI0MiIgeT0iNDguMjc5Nzg2MDgxODkxNjYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0PjwvZz48L3N2Zz4="/>
<img class="imgSvg" id = "m2y4u40qmzcxopdzhnf" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBxbXpjeG9wZHpobmYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDIyMCA5NS42MjY3MjY4MzgzMDQzOCIgc3R5bGU9IndpZHRoOiAyMTkuNzQxMzI3OTYzMDkzNzRweDsgaGVpZ2h0OiA5NS42MjY3MjY4MzgzMDQzOHB4OyBvdmVyZmxvdzogdmlzaWJsZTsiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUwLjQ2MTUxMDA3MjI2NzEyIiB5MT0iNzQuNjI2NzI2ODM4MzA0MzgiIHgyPSIxNzcuNzQxMzI3OTYzMDkzNzQiIHkyPSI1OC44NzY3NTc0NDY0ODIxNyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyMy4xODE3Mjc1MjQ3MDg0MiIgeTE9IjU4Ljg3NjY5NjIzMDE0NjQxIiB4Mj0iMTUwLjQ2MTUxMDA3MjI2NzEyIiB5Mj0iNzQuNjI2NzI2ODM4MzA0MzgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBxbXpjeG9wZHpobmYtNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI5NC40MDUwMzEyMzM1ODI0OCIgeTE9IjcxLjY4ODg2ODE5OTM0NDE2IiB4Mj0iMTIzLjE4MTcyNzUyNDcwODQyIiB5Mj0iNTguODc2Njk2MjMwMTQ2NDEiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBxbXpjeG9wZHpobmYtNyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMTkuODg5MTE2MDgxNDMzMjQiIHkxPSIyNy41NDkyNTI4MzE2ODgwMSIgeDI9IjEyMy4xODE3Mjc1MjQ3MDg0MiIgeTI9IjU4Ljg3NjY5NjIzMDE0NjQxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNzMuMzI3NDQzMzk4NDU4MzkiIHkxPSI0OC4yNzk3ODI1NDc1NTg2OCIgeDI9Ijk0LjQwNTAzMTIzMzU4MjQ4IiB5Mj0iNzEuNjg4ODY4MTk5MzQ0MTYiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBxbXpjeG9wZHpobmYtMTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iODkuMDc3NDc0MDA2NjE2MzMiIHkxPSIyMSIgeDI9IjExOS44ODkxMTYwODE0MzMyNCIgeTI9IjI3LjU0OTI1MjgzMTY4ODAxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTEzIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjczLjMyNzQ0MzM5ODQ1ODM5IiB5MT0iNDguMjc5NzgyNTQ3NTU4NjgiIHgyPSI4OS4wNzc0NzQwMDY2MTYzMyIgeTI9IjIxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTE1IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iNTEuNTcyMzkzOTkwODMzOSIgeDI9IjczLjMyNzQ0MzM5ODQ1ODM5IiB5Mj0iNDguMjc5NzgyNTQ3NTU4NjgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxtYXNrIGlkPSJ0ZXh0LW1hc2stbTJ5NHU0MHFtemN4b3BkemhuZiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0id2hpdGUiPjwvcmVjdD48Y2lyY2xlIGN4PSIxNTAuNDYxNTEwMDcyMjY3MTIiIGN5PSI3NC42MjY3MjY4MzgzMDQzOCIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48Y2lyY2xlIGN4PSI3My4zMjc0NDMzOTg0NTgzOSIgY3k9IjQ4LjI3OTc4MjU0NzU1ODY4IiByPSI3Ljg3NSIgZmlsbD0iYmxhY2siPjwvY2lyY2xlPjwvbWFzaz48c3R5bGU+CiAgICAgICAgICAgICAgICAuZWxlbWVudC1tMnk0dTQwcW16Y3hvcGR6aG5mIHsKICAgICAgICAgICAgICAgICAgICBmb250OiAxNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICAgICAgYWxpZ25tZW50LWJhc2VsaW5lOiAnbWlkZGxlJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5zdWItbTJ5NHU0MHFtemN4b3BkemhuZiB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogOC40cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgPC9zdHlsZT48ZyBtYXNrPSJ1cmwoI3RleHQtbWFzay1tMnk0dTQwcW16Y3hvcGR6aG5mKSI+PGxpbmUgeDE9IjE1MC40NjE1MTAwNzIyNjcxMiIgeTE9Ijc0LjYyNjcyNjgzODMwNDM4IiB4Mj0iMTc3Ljc0MTMyNzk2MzA5Mzc0IiB5Mj0iNTguODc2NzU3NDQ2NDgyMTciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMjMuMTgxNzI3NTI0NzA4NDIiIHkxPSI1OC44NzY2OTYyMzAxNDY0MSIgeDI9IjE1MC40NjE1MTAwNzIyNjcxMiIgeTI9Ijc0LjYyNjcyNjgzODMwNDM4IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi0zJykiPjwvbGluZT48bGluZSB4MT0iOTQuNDA1MDMxMjMzNTgyNDgiIHkxPSI3MS42ODg4NjgxOTkzNDQxNiIgeDI9IjEyMy4xODE3Mjc1MjQ3MDg0MiIgeTI9IjU4Ljg3NjY5NjIzMDE0NjQxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi01JykiPjwvbGluZT48bGluZSB4MT0iMTE5Ljg4OTExNjA4MTQzMzI0IiB5MT0iMjcuNTQ5MjUyODMxNjg4MDEiIHgyPSIxMjMuMTgxNzI3NTI0NzA4NDIiIHkyPSI1OC44NzY2OTYyMzAxNDY0MSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBxbXpjeG9wZHpobmYtNycpIj48L2xpbmU+PGxpbmUgeDE9IjczLjMyNzQ0MzM5ODQ1ODM5IiB5MT0iNDguMjc5NzgyNTQ3NTU4NjgiIHgyPSI5NC40MDUwMzEyMzM1ODI0OCIgeTI9IjcxLjY4ODg2ODE5OTM0NDE2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi05JykiPjwvbGluZT48bGluZSB4MT0iODkuMDc3NDc0MDA2NjE2MzMiIHkxPSIyMSIgeDI9IjExOS44ODkxMTYwODE0MzMyNCIgeTI9IjI3LjU0OTI1MjgzMTY4ODAxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi0xMScpIj48L2xpbmU+PGxpbmUgeDE9IjczLjMyNzQ0MzM5ODQ1ODM5IiB5MT0iNDguMjc5NzgyNTQ3NTU4NjgiIHgyPSI4OS4wNzc0NzQwMDY2MTYzMyIgeTI9IjIxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHFtemN4b3BkemhuZi0xMycpIj48L2xpbmU+PGxpbmUgeDE9IjQyIiB5MT0iNTEuNTcyMzkzOTkwODMzOSIgeDI9IjczLjMyNzQ0MzM5ODQ1ODM5IiB5Mj0iNDguMjc5NzgyNTQ3NTU4NjgiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcW16Y3hvcGR6aG5mLTE1JykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTc3Ljc0MTMyNzk2MzA5Mzc0IiB5PSI1OC44NzY3NTc0NDY0ODIxNyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTUwLjQ2MTUxMDA3MjI2NzEyIiB5PSI2Ni43NTE3MjY4MzgzMDQzOCIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MHFtemN4b3BkemhuZiIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IHZlcnRpY2FsLXJsOwogICAgICAgICAgICAgICAgdGV4dC1vcmllbnRhdGlvbjogdXByaWdodDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiAtMXB4OwogICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBsdHI7CiAgICAgICAgICAgICI+PHRzcGFuPk88L3RzcGFuPjwvdGV4dD48dGV4dCB4PSIxNTAuNDYxNTEwMDcyMjY3MTIiIHk9Ijc0LjYyNjcyNjgzODMwNDM4IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMjMuMTgxNzI3NTI0NzA4NDIiIHk9IjU4Ljg3NjY5NjIzMDE0NjQxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMTkuODg5MTE2MDgxNDMzMjQiIHk9IjI3LjU0OTI1MjgzMTY4ODAxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI4OS4wNzc0NzQwMDY2MTYzMyIgeT0iMjEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijc4LjU3NzQ0MzM5ODQ1ODM5IiB5PSI1My41Mjk3ODI1NDc1NTg2OCIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MHFtemN4b3BkemhuZiIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDsgdW5pY29kZS1iaWRpOiBiaWRpLW92ZXJyaWRlOwogICAgICAgICAgICAiPjx0c3Bhbj5JPC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNzMuMzI3NDQzMzk4NDU4MzkiIHk9IjQ4LjI3OTc4MjU0NzU1ODY4IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI0MiIgeT0iNTEuNTcyMzkzOTkwODMzOSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iOTQuNDA1MDMxMjMzNTgyNDgiIHk9IjcxLjY4ODg2ODE5OTM0NDE2IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
<img class="imgSvg" id = "m2y4u40rubdie7b3sq8" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBydWJkaWU3YjNzcTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDIxMCA2OS4yNzk4MzU1NjI0NzUiIHN0eWxlPSJ3aWR0aDogMjA5Ljk5OTk5OTk5OTk4NzMycHg7IGhlaWdodDogNjkuMjc5ODM1NTYyNDc1cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMzYuNDk5OTk5OTk5OTkwNSIgeTE9IjIxLjAwMDA0MjQxMTkyMTUyNyIgeDI9IjE2Ny45OTk5OTk5OTk5ODczMiIgeTI9IjIxLjAwMDA1NjU0OTIyODcwMiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHJ1YmRpZTdiM3NxOC0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyMC43NDk5ODc3NTY3MjQ5MiIgeTE9IjQ4LjI3OTgzNTU2MjQ3NSIgeDI9IjEzNi40OTk5OTk5OTk5OTA1IiB5Mj0iMjEuMDAwMDQyNDExOTIxNTI3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcnViZGllN2Izc3E4LTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iOTIuMzk5OTg1MjEyMDEyNDgiIHkxPSI1My45NDk4MjI4Mzg4OTc5NyIgeDI9IjExNy41OTk5ODUyMTIwMDk5NSIgeTI9IjUzLjk0OTgzNDE0ODc0MzY5Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcnViZGllN2Izc3E4LTciIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iODkuMjQ5OTg3NzU2NzI4MDkiIHkxPSI0OC4yNzk4MjE0MjUxNjc4MjUiIHgyPSIxMjAuNzQ5OTg3NzU2NzI0OTIiIHkyPSI0OC4yNzk4MzU1NjI0NzUiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtOSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI3My40OTk5OTk5OTk5OTY4MyIgeTE9IjIxLjAwMDAxNDEzNzMwNzE3NiIgeDI9Ijg5LjI0OTk4Nzc1NjcyODA5IiB5Mj0iNDguMjc5ODIxNDI1MTY3ODI1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwcnViZGllN2Izc3E4LTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iMjEiIHgyPSI3My40OTk5OTk5OTk5OTY4MyIgeTI9IjIxLjAwMDAxNDEzNzMwNzE3NiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PG1hc2sgaWQ9InRleHQtbWFzay1tMnk0dTQwcnViZGllN2Izc3E4Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjxjaXJjbGUgY3g9IjQyIiBjeT0iMjEiIHI9IjcuODc1IiBmaWxsPSJibGFjayI+PC9jaXJjbGU+PC9tYXNrPjxzdHlsZT4KICAgICAgICAgICAgICAgIC5lbGVtZW50LW0yeTR1NDBydWJkaWU3YjNzcTggewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQwcnViZGllN2Izc3E4IHsKICAgICAgICAgICAgICAgICAgICBmb250OiA4LjRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICA8L3N0eWxlPjxnIG1hc2s9InVybCgjdGV4dC1tYXNrLW0yeTR1NDBydWJkaWU3YjNzcTgpIj48bGluZSB4MT0iMTM2LjQ5OTk5OTk5OTk5MDUiIHkxPSIyMS4wMDAwNDI0MTE5MjE1MjciIHgyPSIxNjcuOTk5OTk5OTk5OTg3MzIiIHkyPSIyMS4wMDAwNTY1NDkyMjg3MDIiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwcnViZGllN2Izc3E4LTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMjAuNzQ5OTg3NzU2NzI0OTIiIHkxPSI0OC4yNzk4MzU1NjI0NzUiIHgyPSIxMzYuNDk5OTk5OTk5OTkwNSIgeTI9IjIxLjAwMDA0MjQxMTkyMTUyNyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtMycpIj48L2xpbmU+PGxpbmUgeDE9IjkyLjM5OTk4NTIxMjAxMjQ4IiB5MT0iNTMuOTQ5ODIyODM4ODk3OTciIHgyPSIxMTcuNTk5OTg1MjEyMDA5OTUiIHkyPSI1My45NDk4MzQxNDg3NDM2OSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtNScpIj48L2xpbmU+PGxpbmUgeDE9Ijg5LjI0OTk4Nzc1NjcyODA5IiB5MT0iNDguMjc5ODIxNDI1MTY3ODI1IiB4Mj0iMTIwLjc0OTk4Nzc1NjcyNDkyIiB5Mj0iNDguMjc5ODM1NTYyNDc1IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHJ1YmRpZTdiM3NxOC03JykiPjwvbGluZT48bGluZSB4MT0iNzMuNDk5OTk5OTk5OTk2ODMiIHkxPSIyMS4wMDAwMTQxMzczMDcxNzYiIHgyPSI4OS4yNDk5ODc3NTY3MjgwOSIgeTI9IjQ4LjI3OTgyMTQyNTE2NzgyNSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtOScpIj48L2xpbmU+PGxpbmUgeDE9IjQyIiB5MT0iMjEiIHgyPSI3My40OTk5OTk5OTk5OTY4MyIgeTI9IjIxLjAwMDAxNDEzNzMwNzE3NiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBydWJkaWU3YjNzcTgtMTEnKSI+PC9saW5lPjwvZz48Zz48dGV4dCB4PSIxNjcuOTk5OTk5OTk5OTg3MzIiIHk9IjIxLjAwMDA1NjU0OTIyODcwMiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTM2LjQ5OTk5OTk5OTk5MDUiIHk9IjIxLjAwMDA0MjQxMTkyMTUyNyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTIwLjc0OTk4Nzc1NjcyNDkyIiB5PSI0OC4yNzk4MzU1NjI0NzUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijg5LjI0OTk4Nzc1NjcyODA5IiB5PSI0OC4yNzk4MjE0MjUxNjc4MjUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjczLjQ5OTk5OTk5OTk5NjgzIiB5PSIyMS4wMDAwMTQxMzczMDcxNzYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjQ3LjI1IiB5PSIyNi4yNSIgY2xhc3M9ImVsZW1lbnQtbTJ5NHU0MHJ1YmRpZTdiM3NxOCIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDsgdW5pY29kZS1iaWRpOiBiaWRpLW92ZXJyaWRlOwogICAgICAgICAgICAiPjx0c3Bhbj5JPC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
n-channel
<img class="imgSvg" id = "m2y4u40sttayel3xon" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDBzdHRheWVsM3hvbiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTk0IDk2LjU1OTU0Mzg4OTE2ODk0IiBzdHlsZT0id2lkdGg6IDE5NC4yNTAwMjQ0ODY0ODk5M3B4OyBoZWlnaHQ6IDk2LjU1OTU0Mzg4OTE2ODk0cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi0xIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEzNi41MDAwNDg5NzMwMzA1NCIgeTE9IjIxLjAwMDAyODI3NDYxNDM2IiB4Mj0iMTUyLjI1MDAyNDQ4NjQ4OTkiIHkyPSI0OC4yNzk4NDI2MzExMjAzNyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHN0dGF5ZWwzeG9uLTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTA4LjE1MDA1NDA2MjQ3MjU1IiB5MT0iMTUuMzMwMDAyODI3NDYzNzIzIiB4Mj0iMTMzLjM1MDA1NDA2MjQ2MjQiIHkyPSIxNS4zMzAwMjU0NDcxNTUyMDgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi01IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEwNS4wMDAwNDg5NzMwNDMyNSIgeTE9IjIxIiB4Mj0iMTM2LjUwMDA0ODk3MzAzMDU0IiB5Mj0iMjEuMDAwMDI4Mjc0NjE0MzYiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijg5LjI1MDAyNDQ4NjUxNTI5IiB5MT0iNDguMjc5Nzg2MDgxODkxNjQiIHgyPSIxMDUuMDAwMDQ4OTczMDQzMjUiIHkyPSIyMSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0MHN0dGF5ZWwzeG9uLTkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjAuOTAwMDE5Mzk3MDk2MTE2IiB5MT0iNTMuOTQ5NzYwNjM0NzM2NDQiIHgyPSI4Ni4xMDAwMTkzOTcwODU5OSIgeTI9IjUzLjk0OTc4MzI1NDQyNzkyIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQwc3R0YXllbDN4b24tMTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNTcuNzUwMDI0NDg2NTI3OTgiIHkxPSI0OC4yNzk3NTc4MDcyNzcyOSIgeDI9Ijg5LjI1MDAyNDQ4NjUxNTI5IiB5Mj0iNDguMjc5Nzg2MDgxODkxNjQiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi0xMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MiIgeTE9Ijc1LjU1OTU0Mzg4OTE2ODk0IiB4Mj0iNTcuNzUwMDI0NDg2NTI3OTgiIHkyPSI0OC4yNzk3NTc4MDcyNzcyOSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PG1hc2sgaWQ9InRleHQtbWFzay1tMnk0dTQwc3R0YXllbDN4b24iPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IndoaXRlIj48L3JlY3Q+PC9tYXNrPjxzdHlsZT4KICAgICAgICAgICAgICAgIC5lbGVtZW50LW0yeTR1NDBzdHRheWVsM3hvbiB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogMTRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGFsaWdubWVudC1iYXNlbGluZTogJ21pZGRsZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuc3ViLW0yeTR1NDBzdHRheWVsM3hvbiB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogOC40cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgPC9zdHlsZT48ZyBtYXNrPSJ1cmwoI3RleHQtbWFzay1tMnk0dTQwc3R0YXllbDN4b24pIj48bGluZSB4MT0iMTM2LjUwMDA0ODk3MzAzMDU0IiB5MT0iMjEuMDAwMDI4Mjc0NjE0MzYiIHgyPSIxNTIuMjUwMDI0NDg2NDg5OSIgeTI9IjQ4LjI3OTg0MjYzMTEyMDM3IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHN0dGF5ZWwzeG9uLTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMDguMTUwMDU0MDYyNDcyNTUiIHkxPSIxNS4zMzAwMDI4Mjc0NjM3MjMiIHgyPSIxMzMuMzUwMDU0MDYyNDYyNCIgeTI9IjE1LjMzMDAyNTQ0NzE1NTIwOCIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi0zJykiPjwvbGluZT48bGluZSB4MT0iMTA1LjAwMDA0ODk3MzA0MzI1IiB5MT0iMjEiIHgyPSIxMzYuNTAwMDQ4OTczMDMwNTQiIHkyPSIyMS4wMDAwMjgyNzQ2MTQzNiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDBzdHRheWVsM3hvbi01JykiPjwvbGluZT48bGluZSB4MT0iODkuMjUwMDI0NDg2NTE1MjkiIHkxPSI0OC4yNzk3ODYwODE4OTE2NCIgeDI9IjEwNS4wMDAwNDg5NzMwNDMyNSIgeTI9IjIxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHN0dGF5ZWwzeG9uLTcnKSI+PC9saW5lPjxsaW5lIHgxPSI2MC45MDAwMTkzOTcwOTYxMTYiIHkxPSI1My45NDk3NjA2MzQ3MzY0NCIgeDI9Ijg2LjEwMDAxOTM5NzA4NTk5IiB5Mj0iNTMuOTQ5NzgzMjU0NDI3OTIiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwc3R0YXllbDN4b24tOScpIj48L2xpbmU+PGxpbmUgeDE9IjU3Ljc1MDAyNDQ4NjUyNzk4IiB5MT0iNDguMjc5NzU3ODA3Mjc3MjkiIHgyPSI4OS4yNTAwMjQ0ODY1MTUyOSIgeTI9IjQ4LjI3OTc4NjA4MTg5MTY0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MHN0dGF5ZWwzeG9uLTExJykiPjwvbGluZT48bGluZSB4MT0iNDIiIHkxPSI3NS41NTk1NDM4ODkxNjg5NCIgeDI9IjU3Ljc1MDAyNDQ4NjUyNzk4IiB5Mj0iNDguMjc5NzU3ODA3Mjc3MjkiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQwc3R0YXllbDN4b24tMTMnKSI+PC9saW5lPjwvZz48Zz48dGV4dCB4PSIxNTIuMjUwMDI0NDg2NDg5OSIgeT0iNDguMjc5ODQyNjMxMTIwMzciIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEzNi41MDAwNDg5NzMwMzA1NCIgeT0iMjEuMDAwMDI4Mjc0NjE0MzYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEwNS4wMDAwNDg5NzMwNDMyNSIgeT0iMjEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijg5LjI1MDAyNDQ4NjUxNTI5IiB5PSI0OC4yNzk3ODYwODE4OTE2NCIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNTcuNzUwMDI0NDg2NTI3OTgiIHk9IjQ4LjI3OTc1NzgwNzI3NzI5IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI0MiIgeT0iNzUuNTU5NTQzODg5MTY4OTQiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0PjwvZz48L3N2Zz4="/>
p-channel

Figure 3.6. MOSFET schematic symbols.
The symbols for MOSFETs are shown in Figure 3.6. The extra terminal that is sometimes shown is the "body," or "substrate," the piece of silicon in which the FET is fabricated. Because the body forms a diode junction with the channel, it must be held at a nonconducting voltage. It can be tied to the source or to a point in the circuit more negative (positive) than the source for $n$-channel ( $p$-channel) MOSFETs. It is common to see the body terminal omitted; furthermore, engineers often use the symbol with the symmetrical gate. Unfortunately, with what's left you can't tell source from drain; worse still, you can't tell $n$-channel from $p$-channel! In this book we most often use the bottom pair of schematic symbols, which, though somewhat unconventional, are unambiguous and uncluttered. ${ }^{7}$

In a JFET (Junction Field-Effect Transistor) the gate forms a semiconductor junction with the underlying channel. This has the important consequence that a JFET gate should not be forward biased with respect to the channel, to prevent gate current. For example, diode conduction will occur as the gate of an $n$-channel JFET approaches +0.6 V with respect to the more negative end of the channel (which is usually the source). The gate is therefore operated reverse-biased with respect to the channel, and no

[^105]current (except diode leakage) flows in the gate circuit. The circuit symbols for JFETs are shown in Figure 3.7. Once again, we favor the symbol with offset gate to identify the source (though JFETs and small integrated MOSFETs are symmetrical, power MOSFETs are quite asymmetrical, with very different capacitances and breakdown voltages).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0168.jpg?height=529&width=539&top_left_y=496&top_left_x=353)

Figure 3.7. JFET schematic symbols: A. $n$-channel JFET. B. $p$ channel JFET.

#### C. Enhancement, depletion

The $n$-channel MOSFETs with which we began the chapter were nonconducting, with zero (or negative) gate bias, and were driven into conduction by bringing the gate positive with respect to the source. This kind of FET is known as enhancement mode. The other possibility is to manufacture the $n$-channel FET with the channel semiconductor "doped" so that there is plenty of channel conduction even with zero gate bias, and the gate must be reverse-biased by a few volts to cut off the drain current. Such a FET is known as depletion mode. MOSFETs can be made in either variety, because the gate, being insulated from the channel, can swing either polarity. But JFETs, with their gatechannel diode, permit only reverse gate bias, and therefore are made only in depletion mode.

A graph of drain current versus gate-source voltage, at a fixed value of drain voltage, may help clarify this distinction (Figures 3.8 and 3.9). The enhancement-mode device draws no drain current until the gate is brought positive (these are $n$-channel FETs) with respect to the source, whereas the depletion-mode device is operating at nearly its maximum value of drain current when the gate is at the same voltage as the source. In some sense the two categories are artificial, because the two curves are identical except for a shift along the $V_{\mathrm{GS}}$ axis. In fact, it is possible to manufacture "in-between" MOSFETs. Nevertheless,
the distinction is an important one when it comes to circuit design.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0168.jpg?height=507&width=593&top_left_y=323&top_left_x=1170)

Figure 3.8. Transfer characteristics ( $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ ) for a JFET (depletion-mode) and a MOSFET (enhancement-mode) transistor. See also the measured curves in Figure 3.19.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0168.jpg?height=601&width=797&top_left_y=1031&top_left_x=1076)

Figure 3.9. Lending some authenticity to Figure 3.8's notional sketch: measured $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ for a selection of $n$-channel FETs.

Note that JFETs are always depletion-mode devices and that the gate cannot be brought more than about 0.5 V more positive (for $n$-channel) than the source, since the gate-channel diode will conduct. MOSFETs can be either enhancement or depletion, but in practice the dominant species is enhancement, with a sprinkling of depletion-mode MOSFETs. ${ }^{8}$ Most of the time, then, you need worry only about (a) depletion-mode JFETs and

[^106](b) enhancement-mode MOSFETs. Each come in the two polarities, $n$-channel and $p$-channel.

### 3.1.3 Universal FET characteristics

A family tree (Figure 3.10) and a map (Figure 3.11) of input-output voltage (source grounded) may help simplify things. The different devices (including garden-variety $n p n$ and $p n p$ bipolar transistors) are drawn in the quadrant that characterizes their input and output voltages when they are in the active region with source (or emitter) grounded. You don't have to remember the properties of the five kinds of FETs, though, because they're all basically the same.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0169.jpg?height=412&width=740&top_left_y=794&top_left_x=153)

Figure 3.10. FET family tree.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0169.jpg?height=478&width=796&top_left_y=1340&top_left_x=125)

Figure 3.11. Transistor "polarity map."
First, with the source grounded, a FET is turned on (brought into conduction) by bringing the gate voltage "toward" the active drain supply voltage. This is true for all five types of FETs, as well as the bipolar transistors. For example, an $n$-channel JFET (which is necessarily depletion mode) uses a positive drain supply, as do all $n$-type devices. Thus a positive-going gate voltage tends to turn on the JFET. The subtlety for depletion-mode devices is that the gate must be (negatively) back-biased for zero drain
current, whereas for enhancement-mode devices zero gate voltage is sufficient to give zero drain current.

Second, because of the near symmetry of source and drain, either terminal can act as the effective source (exception: not true for power MOSFETs, in which the body is internally connected to the source). When thinking of FET action, and for purposes of calculation, remember that the effective source terminal is always the one most "away" from the active drain supply. For example, suppose a FET is used to switch a line to ground, and both positive and negative signals are present on the switched line, which is usually selected to be the FET drain. If the switch is an $n$-channel MOSFET (therefore enhancement) and a negative voltage happens to be present on the (turned-off) drain terminal, then that terminal is actually the "source" for purposes of gate turn-on voltage calculation. Thus a negative gate voltage larger than the most negative signal, rather than ground, is needed to ensure turn-off.

The graph in Figure 3.12 may help to sort out all these confusing ideas. Again, the difference between enhancement and depletion is merely a question of displacement along the $V_{G S}$ axis, i.e., whether there is a lot of drain current or no drain current at all when the gate is at the same potential as the source. The $n$-channel and $p$-channel FETs are complementary in the same way as npn and pnp bipolar transistors.

In Figure 3.12 we have used standard symbols for the important FET parameters of saturation current and cutoff voltage. For JFETs the value of drain current with the gate shorted to source is specified on the datasheets as $I_{\mathrm{DSS}}$ and is nearly the maximum drain current possible. (I $I_{\mathrm{DSS}}$ means current from drain to source with the gate shorted to the source. Throughout the chapter you will see this notation, in which the first two subscripted letters designate the pair of terminals and the third specifies the condition.) For enhancement-mode MOSFETs the analogous specification is $I_{\mathrm{D}(\mathrm{ON})}$, given at some forward gate voltage (" $I_{\mathrm{DSs}}$ " would be zero for any enhancement-mode device).

For JFETs the gate-source voltage at which the drain current is brought essentially to zero $^{9}$ is called the "gate-source cutoff voltage," $V_{\mathrm{GS}(\mathrm{OFF})}$, or (sometimes) the "pinch-off voltage," $V_{\mathrm{P}}$, and is typically in the range of -1 V to -5 V (positive for $p$-channel, of course). The analogous quantity is not normally specified for enhancementmode MOSFETs; ${ }^{10}$ instead, datasheets specify the

[^107]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0170.jpg?height=667&width=693&top_left_y=205&top_left_x=271)

Figure 3.12. Important gate voltages and drain currents.
"gate-source threshold voltage," $V_{\mathrm{GS}(\mathrm{th})}$, at which the onset of drain current has reached a small but arbitrary threshold value, typically $0.25 \mathrm{~mA} . V_{\mathrm{GS}(\mathrm{th})}$ is typically in the range of $0.5-5 \mathrm{~V}$, in the "forward" direction, of course.

With FETs it is easy to get confused about polarities. For example, $n$-channel devices, which usually have the drain positive with respect to the source, can have positive or negative gate voltage and positive (enhancement) or negative (depletion) threshold voltages. To make matters worse, the drain can be (and often is) operated negative with respect to the source. Of course, all these statements go in reverse for $p$-channel devices. In order to minimize confusion, we will always assume that we are talking about n-channel devices unless explicitly stated otherwise. Likewise, because MOSFETs are nearly always enhancement mode, and JFETs are always depletion mode, we'll omit those designations from now on.

### 3.1.4 FET drain characteristics

In Figure 3.2 we showed a family of curves of $I_{D}$ versus $V_{\mathrm{DS}}$ that we measured for a VN0106, an $n$-channel

[^108]enhancement-mode MOSFET. ${ }^{11}$ We remarked that FETs behave like pretty good transconductance devices over most of the graph (i.e., $I_{\mathrm{D}}$ nearly constant for a given $V_{\mathrm{GS}}$ ), except at small $V_{\mathrm{DS}}$, where they approximate a resistance (i.e., $I_{\mathrm{D}}$ proportional to $V_{\mathrm{DS}}$ ). In both cases the applied gatesource voltage controls the behavior, which can be well described by the FET analog of the Ebers-Moll equation. Let's look now at these two regions a bit more closely; we'll revisit this important subject in greater detail in $\S 3.3$ and again in the advanced-topics Chapter $3 x$.

Figure 3.13 shows the situation schematically. In both regions the drain current depends on $V_{\mathrm{GS}}-V_{\mathrm{th}}$, the amount by which the applied gate-source voltage exceeds the threshold (or pinch-off) voltage. The linear region, in which drain current is approximately proportional to $V_{\mathrm{DS}}$, extends up to a voltage $V_{\mathrm{DS}(\mathrm{sat})}$, after which the drain current is approximately constant. The slope in the linear region, $I_{\mathrm{D}} / V_{\mathrm{DS}}$, is proportional to the gate bias, $V_{\mathrm{GS}}-V_{\mathrm{th}}$. Furthermore, the drain voltage at which the curves enter the "saturation region," $V_{\mathrm{DS}(\mathrm{sat})}$, is approximately $V_{\mathrm{GS}}-V_{\mathrm{th}}$, making the saturation drain current, $I_{\mathrm{D}(\mathrm{sat})}$, proportional to $\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$, the quadratic law we mentioned earlier. For reference, here are the universal FET drain-current formulas:

$$
\begin{align*}
& I_{\mathrm{D}}=2 \kappa\left[\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right) V_{\mathrm{DS}}-V_{\mathrm{DS}}^{2} / 2\right] \quad \text { (linear region) }  \tag{3.1}\\
& I_{\mathrm{D}}=\kappa\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2} \quad \text { (saturation region) } \tag{3.2}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0170.jpg?height=563&width=703&top_left_y=1392&top_left_x=1118)

Figure 3.13. Linear and saturation regions of FET operation.
If we call $V_{\mathrm{GS}}-V_{\mathrm{th}}$ (the amount by which the gatesource voltage exceeds the threshold) the "gate drive," the

[^109]important results are that (a) the resistance in the linear region is inversely proportional to the gate drive, (b) the linear region extends to a drain-source voltage approximately equal to the gate drive, and (c) the saturation drain current is proportional to the square of the gate drive. These equations assume that the body is connected to the source. Note that the "linear region" is not really linear because of the $V_{\mathrm{DS}}^{2}$ term; we'll show a clever circuit fix later.

The scale factor $\kappa$ depends on particulars such as the geometry of the FET, oxide capacitance, and carrier mobility. ${ }^{12}$ It has a temperature dependence $\kappa \propto T^{-3 / 2}$, which alone would cause $I_{\mathrm{D}}$ to decrease with increasing temperature. However, $V_{\text {th }}$ also depends slightly on temperature $\left(2-5 \mathrm{mV} /{ }^{\circ} \mathrm{C}\right)$; the combined effect produces the curve of drain current versus temperature, as shown in Figure 3.14.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0171.jpg?height=590&width=672&top_left_y=863&top_left_x=182)

Figure 3.14. The "threshold voltage" $V_{\text {th }}$ is found by extrapolating a square-root plot of $I_{\mathrm{D}}$ to zero drain current. The FET saturation drain current has a negative tempco in the high-current regime.

At large gate voltages the negative temperature coefficient of $\kappa$ causes the drain current to decrease with increasing temperature. As a consequence, FETs of a given type, operating in this high-current regime, can often be paralleled without the external current-equalizing ("emitterballasting") resistors that you must use with bipolar transistors (see §3.6.3). ${ }^{13}$ This same negative coefficient also prevents thermal runaway in local regions of the junction (an

[^110]effect known as "current hogging"), which severely limits the power capability of large bipolar transistors, as we'll see when we discuss "second breakdown" and "safe operating area" in Chapter 9.

At small drain currents (where the temperature coefficient of $V_{\text {th }}$ dominates), $I_{\mathrm{D}}$ has a positive tempco, with a point of zero temperature coefficient at some drain current in between. This effect is exploited in FET op-amps to minimize temperature drift, as we'll see in the next chapter.

#### A. Subthreshold region

Our expression given earlier for saturation drain current does not apply for very small drain currents. This is known as the "subthreshold" region, where the channel is below the threshold for conduction, but some current flows anyway because of a small population of thermally energetic electrons. If you've studied physics or chemistry, you probably know in your bones that the resulting drain current is exponential (with some scale factor) in the difference voltage $V_{\mathrm{GS}}-V_{\mathrm{th}}$.

We measured some MOSFETs over nine decades of drain current ( 1 nA to 1 A ) and plotted the result as a graph of $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ (Figure 3.15). The region from 1 nA to 1 mA is quite precisely exponential; above this subthreshold region the curves enter the normal "quadratic" region. For the $n$-channel MOSFET (Supertex type VN01, similar to the ever-popular 2N7000) we checked out a sample of 20 transistors (from four different manufacturing runs spread over two years), plotting the extreme range to give you an idea of the variability (see next section). Note the somewhat poorer characteristics $\left(V_{\mathrm{th}}, I_{\mathrm{D}(\mathrm{ON})}\right)$ of the "complementary" VP01 (similar to the popular BS250).

JFETs exhibit similar behavior, as illustrated in the measured data of Figure 3.16 (though $V_{\mathrm{GS}}$ is necessarily limited to reverse-bias voltage polarity, or at most to a forwardbias less than a diode drop). The quadratic region, where $I_{\mathrm{D}} \propto\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$, is seen most clearly by plotting the square root of drain current versus gate voltage; see Figure 3.14 and Figure 3.51 later in the chapter.

### 3.1.5 Manufacturing spread of FET characteristics

Before we look at some circuits, let's take a look at the range of FET parameters (such as $I_{\mathrm{DSS}}$ and $V_{\mathrm{GS}(\mathrm{th})}$ ), as well as their manufacturing "spread" among devices of the same nominal type, in order to get a better idea of the FET. Unfortunately, many of the characteristics of FETs show a much greater process spread than the corresponding

[^111]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0172.jpg?height=577&width=812&top_left_y=219&top_left_x=209)

Figure 3.15. Measured MOSFET saturation drain current versus gate-source voltage. For the VN01 the dotted curves are the extreme specimens, and the solid curve is the median, from a group of 20 MOSFETs.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0172.jpg?height=593&width=802&top_left_y=1081&top_left_x=219)

Figure 3.16. Five decades of measured drain current versus gate-to-source voltage for the $n$-channel 2N5457 JFET. In the subthreshold region the drain current is exponential, like a BJT, with nearly the same scale factor $V_{\mathrm{T}}(k T / q$, or 25.3 mV at room temperature); at higher currents it becomes quadratic (the calculated curve has been offset by $+10 \%$ for clarity).
characteristics of bipolar transistors, a fact that the circuit designer must keep in mind. For example, the 2N7000 (a typical $n$-channel MOSFET) has a specified $V_{\mathrm{GS}(\mathrm{th})}$ of 0.8 $3 \mathrm{~V}\left(I_{\mathrm{D}}=1 \mathrm{~mA}\right)$, compared with the analogous $V_{\mathrm{BE}}$ spread of $0.63-0.83 \mathrm{~V}$ (also at $I_{\mathrm{C}}=1 \mathrm{~mA}$ ) for a small npn bipolar transistor. Here's what you can expect:

FET Characteristics: Manufacturing Spread

| Characteristic | Available Range | Spread |
| :--- | :---: | :---: |
| $I_{\mathrm{DSS}}, I_{\mathrm{D}(\mathrm{ON})}$ | 1 mA to 500 A | $\times 5$ |
| $R_{\mathrm{DS}(\mathrm{ON})}$ | $0.001 \Omega$ to 10 k | $\times 5$ |
| $g_{m} @ 1 \mathrm{~mA}$ | $500-3000 \mu \mathrm{~S}$ | $\times 5$ |
| $V_{\mathrm{P}}(\mathrm{JFETs})$ | $0.5-10 \mathrm{~V}$ | 5 V |
| $V_{\mathrm{GS}(\mathrm{th})}(\mathrm{MOSFETs})$ | $0.5-5 \mathrm{~V}$ | 2 V |
| $B V_{\mathrm{DS}(\mathrm{OFF})}$ | $6-1000 \mathrm{~V}$ |  |
| $B V_{\mathrm{GS}(\mathrm{OFF})}$ | $6-125 \mathrm{~V}$ |  |

$R_{\mathrm{DS}(\mathrm{ON})}$ is the drain-source resistance (linear region, i.e., small $V_{\mathrm{DS}}$ ) when the FET is conducting fully, e.g., with the gate grounded in the case of JFETs or with a large applied gate-source voltage (usually specified as 10 V ) for MOSFETs. $I_{\mathrm{DSS}}$ and $I_{\mathrm{D}(\mathrm{ON})}$ are the saturation-region (large $V_{\mathrm{DS}}$ ) drain currents under the same turned-on gate drive conditions. $V_{\mathrm{P}}$ is the pinch-off voltage (JFETs), $V_{\mathrm{GS}(\mathrm{th})}$ is the turn-on gate threshold voltage (MOSFETs), and the $B V$ 's are breakdown voltages. As you can see, a JFET with a grounded source may be a good current source, but you can't predict very well what the current will be. Likewise, the $V_{\mathrm{GS}}$ needed to produce some value of drain current can vary considerably, in contrast to the predictable ( $\approx 0.6 \mathrm{~V}$ ) $V_{B E}$ of bipolar transistors. Figure 3.17 illustrates this latter point graphically: we measured the $V_{\mathrm{GS}}$ values at a drain current of 1 mA for a hundred pieces each (hey, they're pretty cheap: about $\$ 0.10$ each) of three popular JFET types (the 2N5457-59 series, graded by their $I_{\text {DSS }}$ ). The spread of gate-source voltages, within each type, is about 1 V . For comparison, look at the analogous plot for BJTs in Figure 8.44; there the spread is just $10-20 \mathrm{mV}$.

#### A. Matching of characteristics

As you can see, FETs are inferior to bipolar transistors in $V_{\mathrm{GS}}$ predictability, i.e., they have a large spread in the $V_{\mathrm{GS}}$ required to produce a given $I_{D}$. Devices with a large process spread will, in general, have a larger offset (voltage unbalance) when used as differential pairs. For instance, typical run-of-the-mill bipolar transistors might show a spread in $V_{\mathrm{BE}}$ of 25 mV or so, at some collector current, for a selection of off-the-shelf transistors. The comparable "official" figure (as specified on datasheets) for MOSFETs is more like 1 V to $2 \mathrm{~V}!{ }^{14}$ Because FETs have some very desirable characteristics otherwise, it is worthwhile putting in some

[^112]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0173.jpg?height=578&width=769&top_left_y=221&top_left_x=136)

Figure 3.17. We wore our fingers to the bone (a "digital" measurement?) collecting $V_{\mathrm{GS}}$ values (at $V_{\mathrm{DS}}=5 \mathrm{~V}$ and $I_{\mathrm{D}}=1 \mathrm{~mA}$ ) for 300 JFETs in the popular 2N5457-59 series. Compare with the analogous histograms in Figure 8.44.
extra effort to reduce these offsets in specially manufactured matched pairs. IC designers use techniques like interdigitation (two devices sharing the same general piece of IC real estate) and thermal-gradient cancellation schemes to improve performance (Figure 3.18).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0173.jpg?height=754&width=693&top_left_y=1266&top_left_x=179)

Figure 3.18. Techniques for transistor matching: A. Interdigitation (Courtesy of Linear Integrated Systems.) B. Temperature gradient cancellation.
important in some application (when several transistors are used in parallel, for example), you should measure the actual parts.

The results are impressive. Although FET devices still cannot equal bipolar transistors in $V_{\mathrm{GS}}$ matching, their performance is adequate for most applications. For example, the best previously available matched FET had ${ }^{15}$ a voltage offset of 0.5 mV and tempco of $5 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ (max), whereas the best bipolar pair has values of $25 \mu \mathrm{~V}$ and $0.3 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ (max), roughly 20 times better.

Operational amplifiers (the universal high-gain differential amplifiers we'll see in the next chapter) are available in both flavors; you would generally choose one with bipolar innards for high precision (because of its close inputtransistor $V_{\mathrm{BE}}$ matching), whereas a FET-input op-amp is the obvious choice for high-impedance applications (because its inputs - FET gates - draw no current). For example, the inexpensive JFET-input LF411 and LF412 that we will use as our all-around op-amp in the next chapter has a typical input (leakage) current of 50 pA and costs \$0.60; the popular MOSFET-input TLC272 costs about the same and has a typical input (leakage) current of only 1 pA ! Compare this with a common bipolar op-amp, the LM324, with typical input (bias) current of $45,000 \mathrm{pA}(45 \mathrm{nA}) .{ }^{16}$

### 3.1.6 Basic FET circuits

Now we're ready to look at FET circuits. You can usually find a way to convert a circuit that uses BJTs into one using FETs - but the new circuit may not be an improvement! For the remainder of the chapter we'd like to illustrate circuit situations that take advantage of the unique properties of FETs, i.e., circuits that work better with FETs or that you can't build at all with bipolar transistors. For this purpose it may be helpful to group FET applications into categories; here are the most important, as we see it.

High-impedance/low-current. Buffers or amplifiers for applications in which the base current and finite input

15 Sadly, these parts are no longer available. But the art of transistor matching is alive and well in the innards of op-amps, for which the best JFET specimen has an offset and tempco of 0.1 mV and $1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$, respectively, whereas the best BJT specimen has 0.01 mV and $0.1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$, i.e., 10 times better.
${ }^{16}$ BJT enthusiasts would cry "foul!," and point out that you can use superbeta BJTs, combined with bias-current cancellation schemes, to bring the input current down to 25 pA ; they would further point out that FET-input current (which is leakage) rises dramatically with temperature, whereas BJT-input current (which is honest bias current) is stable or even tends to decrease slightly (see Figure 3.48). FET enthusiasts would prevail, though, with the rejoinder that MOSFET-input amplifiers like the dual LMC6042 have typical input currents of 2 femtoamps (that's 0.000002 nA !).
impedance of BJTs limit performance. Although you can build such circuits with discrete FETs, current practice favors using integrated circuits built with FETs. Some of these use FETs as a high-impedance frontend for an otherwise bipolar design, whereas others use FETs throughout. When available FET ICs do not provide adequate performance, a hybrid approach (discrete JFET front-end, assisted by an op-amp) can push the performance envelope.
Analog switches. MOSFETs are excellent voltagecontrolled analog switches, as we hinted in §3.1.1B. We'll look briefly at this subject. Once again, you should generally use dedicated "analog switch" ICs, rather than building discrete circuits.
Digital logic. MOSFETs dominate microprocessors, memory, special-purpose VLSI, and most highperformance digital logic. They are used exclusively in micropower logic and low-power portable devices. Here, too, MOSFETs make their appearance in integrated circuits. We'll see why FETs are preferable to BJTs.
Power switching. Power MOSFETs are usually preferable to ordinary bipolar power transistors for switching loads, as we suggested in our first circuit of the chapter. For this application you use discrete power FETs.
Variable resistors; current sources. In the "linear" region of the drain curves, FETs behave like voltagecontrolled resistors; in the "saturation" region they are voltage-controlled current sources. You can exploit this intrinsic behavior of FETs in your circuits.
Generalized replacement for bipolar transistors. You can use FETs in oscillators, amplifiers, voltage regulators, and radiofrequency circuits (to name a few), where bipolar transistors are also normally used. FETs aren't guaranteed to make a better circuit - sometimes they will, sometimes they won't. You should keep them in mind as an alternative.

Now let's look at these subjects. We'll adopt a slightly different order, for clarity.

### 3.2 FET linear circuits

A note to the reader: This section and the next ( $\S \S 3.2$ and 3.3) deal primarily with JFETs, which are well suited to linear applications such as current sources, followers, and amplifiers. If you need a low-noise amplifier with extremely high input impedance, the JFET is your friend (and maybe your only friend). Readers wishing to move directly to MOSFETs, starting with FET switches, may wish to

| Table 3.1 JFET Mini-table ${ }^{\text {a }}$ (see also JFET Table 3.7) |  |  |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# | $I_{\text {dss }}$ <br> (mA) | VGS(off) |  | measured at 1 mA |  |  | $\begin{gathered} \text { Crss } \\ \text { typ } \\ \text { (pF) } \end{gathered}$ | $\begin{aligned} & R_{\mathrm{ON}} \\ & \text { typ } \\ & (\Omega) \end{aligned}$ |
|  |  | min <br> (V) | max (V) | VGS <br> (V) | $\begin{aligned} & g_{m} \\ & (\mathrm{mS}) \end{aligned}$ | $\begin{gathered} G_{\max ^{b}} \\ (\mathrm{~V} / \mathrm{V}) \end{gathered}$ |  |  |
| N5484 | A 1-5 | -0.3 | -3 | -0.73 | 2.3 | 180 |  |  |
| 2N5485 | B 4-10 | -0.4 | -4 | -1.7 | 2.1 | 110 | 1 |  |
| 2N5486 | C 8-20 | -2 | -6 | -2.4 | 2.1 | 50 |  |  |
| 2N5457 | D 1-5 | -0.5 | -6 | -0.81 | 2.0 | 200 | 1.5 |  |
| 2N5458 | E 2-9 | -1 | -7 | -2.3 | 2.3 | 170 | 1.5 |  |
| 2N5459 | F 4-16 | -2 | -8 | -2.8 | 2.0 | 100 | 1.5 |  |
| BF862 | G 10-25 | -0.3 | -1.2 | -0.40 | 12 | 250 | 1.9 |  |
| J309 | H 12-30 | -1 | -4 | -1.6 | 4.2 | 300 | 2 | 50 |
| J310 | J 24-60 | -2 | -6.5 | -3.0 | 4.3 | 100 | 2 | 50 |
| J113 | K 2- | -0.5 | -3 | -1.5 | 5.7 | 140 | 3 | 50 |
| J112 | L 5- | -1 | -5 | -3.3 | 5 | 100 | 3 | 30 |
| PN4393 | M 5-30 | -0.5 | -3 | -0.83 | 6.2 | 100 | 3.5 | 100 |
| PN4392 | N 25-75 | -2 | -5 | -2.6 | 5.4 | 130 | 3.5 | 60 |
| LSK170B | P 6-12 | -0.2 | -2 | -0.09 | 11 | 160 | 5 |  |
| J110 | Q 10- | -0.5 | -4 | -1.2 | 6.1 | 220 | 8 | 18 |
| J107 | R 100- | -0.5 | -4.5 | -2.6 | 8.2 | 340 | 35 | 8 |
| J105 | - 500- | -4.5 | -10 | -8.7 | 6.4 | 60 | 35 | 3 |
| 601 | S 30- |  | -3 |  |  | 00 |  |  |

Notes: (a) sorted by family $C_{\text {rss }}$, and within each family by increasing IDSs. (b) $G_{\max }=g_{m} / g_{\text {os }}$, the maximum grounded-source voltage gain into a current source as drain load; $G_{\max }$ is proportional to $V_{D S}$ (tabulated values are at $V_{\mathrm{DS}}=5 \mathrm{~V}$ ), and for most JFETs $\mathrm{G}_{\text {max }}$ is relatively constant over varying /D.
skip over these JFET materials, ${ }^{17}$ and proceed directly to §3.4 on page 171, where we launch into the MOSFETdominated subjects of signal switching, digital logic, and power switching.

### 3.2.1 Some representative JFETs: a brief tour

Table 3.1 lists a small selection of representative $n$-channel JFETs. ${ }^{18}$ Let's take a look at what you get.

This selection includes only $n$-channel JFETs, the dominant polarity. Complements with similar characteristics are sometimes available, for example the $p$-channel $2 \mathrm{~N} 5460-$ 62 for the $n$-channel 2N5457-59; see Table 3.7 on page 217 for additional examples.

Many JFETs come in families of three or four parts, graded by $I_{\mathrm{DSS}}$ and $V_{\mathrm{GS}(\text { off })}$, which alleviates somewhat

[^113]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0175.jpg?height=578&width=815&top_left_y=216&top_left_x=113)

Figure 3.19. Measured drain current versus gate-source voltage for the JFETs in Table 3.1 on the previous page.
the annoying circuit design problems created by the wide spread of those parameters. But even those graded families may present a spread of as much as 5:1 (or more). Note also that JFETs intended for switching applications (the ones specifying $R_{\text {on }}$ ) may specify only a minimum value of $I_{\text {DSs }}$ : what can you say, for example, about the likely value for a J110 (specified as $I_{\mathrm{DSS}}=10 \mathrm{~mA}$, minimum)? Answer: not much - our sample measured 122 mA !

In many applications (amplifiers, followers) you want lots of transconductance gain, $g_{m}$. JFET datasheets usually specify $g_{m}$ at the part's $I_{\text {DSS }}$, but that's not terribly useful if you don't know what $I_{\mathrm{DSS}}$ is. Moreover, the listed $g_{m}$ at $I_{\text {DSS }}$ is afflicted with the usual specification spread, typically 5:1 or so. Unlike BJTs, for which the transconductance is predictably given by $g_{m}=1 / r_{\mathrm{e}}=I_{\mathrm{C}} / V_{\mathrm{T}}$ (where $V_{\mathrm{T}}=k T / q \approx 25.3 \mathrm{mV}$ ), the transconductance of different JFET types can vary by an order of magnitude, even when each is operated at the same drain current. In Table 3.1 on the previous page we've listed measured values of $g_{m}$, all at a standard current of $1 \mathrm{~mA} .{ }^{19}$ At these currents their transconductance is much less than that of a BJT (where $g_{m}=40 \mathrm{mS}$ at 1 mA ), though they compete well at very low currents (the subthreshold region). This behavior can be seen in the different slopes of the measured $I_{D}$ versus $V_{\mathrm{GS}}$ curves of Figure 3.19.

The column labeled $G_{\max }$ lists the voltage gain when used as a grounded-source amplifier with current-source load; in that case the effective load resistance is related to a quantity called $g_{\text {os }}$, the output conductance seen looking into the drain with the gate voltage held constant (analo-

[^114]gous to the Early effect in BJTs; more on this in Chapter $3 x$ ). Here, too, there is a wide spread among JFET types.

A parameter that is important in low-level amplification is a JFET's input noise voltage, not listed here but treated in detail in Chapter 8. The standout happens to be the IF3601 (an amazing $e_{\mathrm{n}}=0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), but your pact with the devil is the high 300 pF capacitance of the large-area junction. ${ }^{20}$

There's much more to say about the inhabitants of the JFET zoo, as we'll see in connection with Table 3.7 on page 217. Chapter 8 discusses JFETs in connection with noise ( $\S 8.6$ and 8.6.5), with a table of relevant parts (Table 8.2 on page 516).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0175.jpg?height=299&width=259&top_left_y=738&top_left_x=1243)

Figure 3.20. An $n$-channel JFET current sink.

### 3.2.2 JFET current sources

JFETs are used as current sources within integrated circuits (particularly op-amps), and also sometimes in discrete designs. The simplest JFET current source is shown in Figure 3.20; we chose a JFET, rather than a MOSFET, because it needs no gate bias (it's depletion mode). From a graph of FET drain characteristics (Figure 3.21) you can see that the current will be reasonably constant for $V_{\mathrm{DS}}$ larger than a couple of volts. However, because of $I_{\text {DSS }}$ spread, the current is unpredictable. For example, the MMBF5484 (a typical $n$-channel JFET) has a specified $I_{\text {DSS }}$ of $1-5 \mathrm{~mA}$. Still, the circuit is attractive because of the simplicity of a two-terminal constant-current device. If that appeals to you, you're in luck. You can buy "current-regulator diodes" that are nothing more than JFETs with gate tied to source, sorted according to current. They're the current analog of a zener (voltage-regulator) diode. Here are the characteristics of the 1N5283-1N5314 series: ${ }^{21}$
${ }^{20}$ See Table 8.2 for the IF3601 and IF3602 (dual). Runners-up in the lownoise competition are the LSK170B and the BF862, with considerably lower capacitances.
${ }^{21}$ Said to be available from several manufacturers. Alternatives include the MS5283, MV5283, and MX5283 series from Microsemi; the SST502-SST511 and CR160-CR470 series from Vishay; and the J500-J511, J553-J557, and U553-U557 series from InterFET. Alternative sources: Central Semiconductor and Linear Integrated Systems.

| Characteristic | Value |
| :--- | :--- |
| Currents available | $0.22-4.7 \mathrm{~mA}$ |
| Tolerance | $\pm 10 \%$ |
| Temperature coefficient | $\pm 0.4 \% /{ }^{\circ} \mathrm{C}$ |
| Voltage range | $1-2.5 \mathrm{~V}$ min, 100 V max |
| Current regulation | $5 \%$ typical |
| Impedance | 1 M typ (for 1 mA device) |

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0176.jpg?height=1210&width=702&top_left_y=586&top_left_x=274)

Figure 3.21. Measured JFET characteristic curves. 2N5484 nchannel JFET: $I_{\mathrm{D}}$ versus $V_{\mathrm{DS}}$ for various values of $V_{\mathrm{GS}}$. See also Figure 3.47.

We measured $I$ versus $V$ for a 1N5294 (rated at 0.75 mA ), applying 1 ms voltage pulses at 100 ms intervals to prevent heating. Figure 3.22A shows good constancy of current up to the breakdown voltage ( $\sim 145 \mathrm{~V}$ for this particular specimen). You can see also the effect of heating when voltage is applied continuously in a dc measurement, caused by the negative temperature coefficient of drain current. Figure 3.22B shows that the device reaches full cur-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0176.jpg?height=1003&width=753&top_left_y=218&top_left_x=1098)

Figure 3.22. 1N5294 current regulator diode.
rent with somewhat less than 1.5 V across it (here both pulsed and dc curves are plotted, demonstrating negligible thermal effects with less than 0.4 mW dissipation). We'll show how to use these devices to make a cute trianglewave generator in $\S 7.1 .3 \mathrm{E}$. And we'll have much more to say about current sources in $\S 4.2 .5$ and §9.3.14.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0176.jpg?height=391&width=608&top_left_y=1588&top_left_x=1163)

Figure 3.23. JFET current sink $\left(I=V_{\mathrm{GS}} / R\right)$ for $I_{\mathrm{D}}<I_{\mathrm{DSS}}$.

#### A. Source self-biasing

A variation of the previous circuit (Figure 3.23) gives you an adjustable current source. The self-biasing resistor $R$ back-biases the gate by $I_{\mathrm{D}} R$, reducing $I_{\mathrm{D}}$ and bringing the

JFET closer to pinch-off. You can estimate the value of $R$ from the drain curves for the particular JFET. This circuit allows you to set the current (which must be less than $I_{\mathrm{DSS}}$ ), as well as to make it more predictable. Furthermore, the circuit is a better current source (higher impedance) because the source resistor provides "current-sensing feedback" (which we'll learn about in §4.2.5A). (There's a nice demonstration of this in in the figure "Measured $I_{\mathrm{D}}$ versus $V_{\text {DS }}$ for four JFETs" in $\S 3 x .4 .3$, where you will find draincurrent versus drain-voltage curves both with and without a source self-biasing resistor.) Remember, though, that actual curves of $I_{\mathrm{D}}$ for some value of $V_{\mathrm{GS}}$ obtained with a real FET may differ markedly from the values read from a set of published curves, owing to manufacturing spread. (This is illustrated nicely by the examples of Figures 3.25 and 3.41 on pages 145 and 156 , using actual measured drain characteristics from a batch of JFETs.) You may therefore want to use an adjustable source resistor, if it is important to have a specific current.

Exercise 3.1. Use the 2N5484 measured curves in Figure 3.21 to design a JFET current source to deliver 1 mA . Now ponder the fact that the specified $I_{\text {DSS }}$ of a 2 N 5484 is $1 \mathrm{~mA}(\mathrm{~min}), 5 \mathrm{~mA}$ (max).

#### B. Example: emitter follower pull-down

Let's look at an example to explore further this problem of unpredictability of JFET zero-bias drain current, $I_{\mathrm{DSS}}$ (or, equivalently, the difficulty of predicting the gate-source bias needed to produce a desired drain current).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0177.jpg?height=550&width=473&top_left_y=1447&top_left_x=279)

Figure 3.24. Design example: npn emitter follower with JFET current sink.

Figure 3.24 shows a BJT emitter follower, running between $\pm 12 \mathrm{~V}$ split supplies, with a current-sinking JFET pull-down to the negative rail. We specify that the circuit must be able to deliver a full swing of $\pm 10 \mathrm{~V}$ into a $2 \mathrm{k} \Omega$
load (that's $\pm 5 \mathrm{~mA}$ load current). You might at first think of using a simple pull-down resistor $R_{\mathrm{E}}$ to the -12 V rail. But the output swing requirement makes things difficult, because you would need to keep $R_{\mathrm{E}}$ less than $400 \Omega$ (we might choose $365 \Omega$, a standard $1 \%$ value) to get a full negative swing; and that low resistance would produce a relatively high quiescent current (at 0 V output) of 33 mA (thus $\sim 400 \mathrm{~mW}$ quiescent dissipation both in $Q_{1}$ and in $R_{\mathrm{E}}$ ), compared with the 5 mA peak current delivered to the load (recall the discussion in §2.4.1). Worse still, a resistive pulldown also greatly degrades linearity, owing to variations in the follower's $r_{\mathrm{e}}$ caused by the large variation of collector current ( 65 mA at the top of the swing, dropping to 0.5 mA at the bottom, thus corresponding $r_{\mathrm{e}}$ of $0.4 \Omega$ and $50 \Omega$ into a combined load resistance of $\sim 300 \Omega$ ). Finally, the small resistive pull-down resistor (compared with the minimum load resistance) undesirably reduces the circuit's input impedance by a factor of 6 .

So an active current sink is the way to go. A first possibility is to choose a JFET whose minimum specified $I_{\mathrm{DSS}}$ is at least equal to our required 5.5 mA . Only the 2 N 5486 member of the 2N5484-86 family satisfies this requirement $\left(8 \mathrm{~mA} \leq I_{\mathrm{DSS}} \leq 20 \mathrm{~mA}\right.$, see Table 3.1 on page 141 ). But these currents are rather more than we'd like, and a part with $I_{\mathrm{DSS}}=20 \mathrm{~mA}$ produces too much heat: the worst-case dissipation is 440 mW in either the JFET (at peak positive swing) or the BJT (at peak negative swing with no load), too much for a transistor in a TO-92 or SOT-23 package without a heatsink.

So, let's add a source resistor so we can tailor the JFET's drain current; we'll aim for a 5.5 mA minimum sink current, so that we retain 0.5 mA reserve at full negative swing. The 2N5486's minimum $I_{\text {DSS }}$ of 8 mA guarantees that a source self-biased circuit can sink the required 5.5 mA current. Now we need only choose the source resistor $R_{\mathrm{S}}$.

The problem is that datasheet curves of $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ (called "transfer characteristics"), when provided at all, do not show the full range of possibilities; instead they show curves typical of parts with two or three selected values of $I_{\mathrm{DSS}}$ within the allowable range. And sometimes all you get are tabulated limits for $I_{\mathrm{DSS}}$ and for $V_{\mathrm{GS}(\mathrm{off})} .^{22}$ But you can measure some JFETs to get a sense of things. We did this, and Figure 3.25 shows measured $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ curves for seven 2N5486s from different manufacturers

[^115]and batches. ${ }^{23}$ Assuming this represents the full range of variability (it doesn't, quite, as seen from the minimum $I_{\mathrm{DSS}}$ of 9.2 mA ) then we can swing a load line up from the origin until the lowest intersection is above $I_{\mathrm{D}}=5.5 \mathrm{~mA}$. That's an $R_{\mathrm{S}}$ of $140 \Omega$ (shown), for which the range of drain current is 5.7 mA (minimum) to 9.5 mA (maximum).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0178.jpg?height=550&width=771&top_left_y=516&top_left_x=237)

Figure 3.25. Choosing a source resistor $R_{\mathrm{S}}$ to bias a JFET current sink to produce $I_{\text {sink }} \geq 5.5 \mathrm{~mA}$.

The good news is that the circuit will work; the bad news is that the range of sink currents is nearly $2: 1$ (taking into account the possibility of production parts whose curves span a somewhat wider range than seen in these seven parts). But the good news, again, is that even for a JFET at the high end of the range (thus $I_{\text {sink }} \approx 10 \mathrm{~mA}$ ), the follower's worst-case dissipation is limited to 220 mW (at peak negative swing, no load), and the JFET's worst-case dissipation is likewise limited to 220 mW (at peak positive swing). This is well within allowable dissipation for a TO92 transistor ( 350 mW at $25^{\circ} \mathrm{C}$ ambient).

#### C. Current sinks for JFET amplifiers

Stepping back a bit, one might ask whether a JFET current sink, with its 2:1 spread of quiescent current, was a good choice. True, it works. But you can do better with a simple BJT current sink, five versions of which are shown in Figure 3.26. These use more parts, but sink a predictable current. And if you really care about minimizing parts count, then you can always use the alternative of a JFET selected for a narrow range of $I_{\mathrm{DSS}}$, with no self-biasing resistor,

[^116]i.e., Figure 3.24 with $R_{\mathrm{S}}=0$ (the 2 N 5485 specifies $I_{\mathrm{DSS}}$ as $4 \mathrm{~mA}-10 \mathrm{~mA}$; you might select parts from $5.5-8 \mathrm{~mA}$ ). ${ }^{24}$

This example illustrates the down side of the loose drain current (and corresponding gate voltage) specifications characteristic of all JFETs. As attractive as it may seem to drop in a JFET when you need a current source, it's problematical. But JFETs come into their own when you need an amplifier with high input impedance and low noise - although the loosey-goosey specs are still challenging, the results are worth the bother. We'll see examples presently.

#### D. Imperfect current source

A JFET current source, even if built with a source resistor, shows some variation of output current with output voltage; i.e., it has finite output impedance, rather than the desirable infinite $Z_{\text {out }}{ }^{25}$ The measured curves of Figure 3.21, for example, suggest that, over a drain voltage range of $5-20 \mathrm{~V}$, a 2N5484 shows a drain current variation of $5 \%$ when operated with gate tied to source (i.e., $I_{\text {DSS }}$ ). This might drop to $2 \%$ or so if you use a source resistor. An elegant solution is the use of a cascode transistor to suppress drain voltage variations in the current-setting transistor. This can be used both for BJT current sources (it's shown in §2x.3) and for JFET current sources, as shown in Figure 3.27. The idea (as with BJTs) is to use a second JFET to hold constant the drain-source voltage of the current source. $Q_{1}$ is an ordinary JFET current source, shown in this case with a source resistor. $Q_{2}$ is a JFET of larger $I_{\mathrm{DSS}}$, connected "in series" with the current source. It passes $Q_{1}$ 's (constant) drain current through to the load, while holding $Q_{1}$ 's drain at a fixed voltage - namely the gate-source voltage that makes $Q_{2}$ operate at the same current as $Q_{1}$. Thus $Q_{2}$ shields $Q_{1}$ from voltage swings at its output; since $Q_{1}$ doesn't see drain voltage variations, it just sits there and provides constant current. If you look back at the Wilson mirror (Figures 2.61, 3.26D), you'll see that it uses this same voltage-clamping idea.

You may recognize this JFET circuit as the "cascode," which is normally used to circumvent Miller effect (\$2.4.5). A JFET cascode is simpler than a BJT cascode,

[^117]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0179.jpg?height=440&width=1659&top_left_y=198&top_left_x=99)

Figure 3.26. Alternatives to the JFET pulldown of Figure 3.24. A. Classic BJT current sink, base biased to $\sim 2 V_{\mathrm{BE}}$; you can substitute a red LED for the diode pair. B. $Q_{3}$ creates a " $1.5 V_{\mathrm{BE}}$ " base bias for current sink $Q_{2}$; adding optional resistor $R_{\mathrm{C}}$, chosen equal to $Q_{3}$ 's $r_{\mathrm{e}}$, cleverly compensates for the latter's change in $V_{\mathrm{BE}}$ with supply-voltage variations (i.e., $I_{\mathrm{C}}$ variations through the 5.6 k resistor). This configuration is useful if the current-sink output must operate very close to the negative rail - down to a few hundred mV , say, if configured as a " $1.25 V_{\mathrm{BE}}$ " bias. C. Current mirror with $\approx 200 \mathrm{mV}$ emitter ballasting (needed to equalize collector currents in view of $V_{\mathrm{BE}}$ mismatch, and to suppress the Early effect output-current variations). D. Wilson mirror with matched pair; no emitter resistors needed. E. "Ring-of-two" current source. See Figure 2.32 for other current source circuits.
however, because you don't need a bias voltage for the gate of the upper FET: because it's depletion mode, you can simply connect the upper gate to the lower source terminal (compare with Figure 2.84); $Q_{2}$ 's gate-to-source voltage at the operating current (set by $Q_{1}$ with its $R_{\mathrm{S}}$ ) then sets $Q_{1}$ 's drain-to-source operating voltage: $V_{\mathrm{DS} 1}=-V_{\mathrm{GS} 2}$. A nice additional benefit is that the resultant circuit is a two-terminal current source.

It is important to realize that a good bipolar transistor current source will give far better predictability and stability than a JFET current source. Furthermore, the op-amp-assisted current sources we'll see in the next chapter are better still. For example, a FET current source might vary $5 \%$ over a typical temperature range and load-voltage variation, even after being set to the desired current by trimming the source resistor, whereas an op-amp/transistor (or op-amp/FET) current source is predictable and stable to better than $0.5 \%$ without great effort.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0179.jpg?height=432&width=338&top_left_y=1830&top_left_x=331)

Figure 3.27. Cascode JFET current sink.

### 3.2.3 FET amplifiers

Source followers and common-source FET amplifiers are analogous to the emitter followers and common-emitter amplifiers made with bipolar transistors that we talked about in the previous chapter. However, the absence of dc gate current makes it possible to realize very high input impedances. Such amplifiers are essential when dealing with the high-impedance signal sources encountered in measurement and instrumentation. For some specialized applications you may want to build followers or amplifiers with discrete FETs; most of the time, however, you can take advantage of FET-input op-amps. In either case it's worth knowing how they work.

With JFETs it is convenient to use the same self-biasing scheme as with JFET current sources (§3.2.2), with a single gate-biasing resistor to ground (Figure 3.28); MOSFETs require a divider from the drain supply, or split supplies, just as we used with BJTs. The gate-biasing resistors can be quite large (a megohm or more), because the gate leakage current is measured in picoamps to nanoamps.

#### A. Transconductance

The absence of gate current makes transconductance (the ratio of output current to input voltage: $g_{m}=i_{\text {out }} / v_{\text {in }}$ ) the natural gain parameter for FETs. This is in contrast to bipolar transistors in the last chapter, where we at first flirted with the idea of current gain, or beta ( $\left.i_{\text {out }} / i_{\text {in }}\right)$, then introduced the transconductance-oriented Ebers-Moll model: it's useful to think of BJTs either way, depending on the application.

FET transconductance can be estimated from the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0180.jpg?height=450&width=718&top_left_y=221&top_left_x=262)

Figure 3.28. Common-source amplifier and source follower. For both configurations the source voltage is above ground, because of the source current flowing through $R_{\mathrm{S}}$, with a quiescent point $V_{\mathrm{S}}=V_{\mathrm{GS}}=R_{\mathrm{S}} I_{\mathrm{D}}\left(V_{\mathrm{GS}}\right)$.
characteristic curves, either by looking at the increase in $I_{\mathrm{D}}$ from one gate-voltage curve to the next on the family of curves (Figures 3.2 or 3.21 ), or, more simply, from the slope of the $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ transfer characteristics curve (Figures 3.15 or 3.51 ). The transconductance depends on drain current (we'll see how, shortly) and is, of course,

$$
g_{m}\left(I_{\mathrm{D}}\right)=i_{\mathrm{d}} / v_{\mathrm{gs}}
$$

(Remember that lowercase letters indicate quantities that are small-signal variations.) From this we get the voltage gain,

$$
G_{\mathrm{voltage}}=v_{\mathrm{d}} / v_{\mathrm{gs}}=-R_{\mathrm{D}} i_{\mathrm{d}} / v_{\mathrm{gs}}
$$

i.e.,

$$
\begin{equation*}
G=-g_{m} R_{\mathrm{D}} \tag{3.3}
\end{equation*}
$$

just the same as the bipolar-transistor result in §2.2.9, with load resistor $R_{\mathrm{C}}$ replaced with $R_{\mathrm{D}}$. Typically, small-signal FETs have transconductances in the neighborhood of 10 millisiemens ${ }^{26}(\mathrm{mS})$ at a few milliamps. ${ }^{27}$ Because $g_{m}$ depends on drain current, there will be some variation of gain (nonlinearity) over the waveform as the drain current varies, just as we have with grounded emitter amplifiers (where $g_{m}=1 / r_{\mathrm{e}}$, proportional to $I_{\mathrm{C}}$ ).

In the following discussion we'll be using the concept of FET gate drive, $V_{\mathrm{GS}}-V_{\mathrm{th}}$. Recall that $V_{\mathrm{th}}$ is the extrapolated gate threshold voltage we discussed in $\S 3.1 .3$ and 3.1.4.

The variation of $g_{m}$ with drain current is easy to calculate and highly useful when designing JFET followers and amplifiers. For operation above subthreshold ( $I_{\mathrm{D}}>$

[^118]$I_{\text {DSS }} / 25$, say), we've seen that the drain current is quadratic in the gate drive
\$\$

$$
\begin{equation*}
I_{\mathrm{D}}=\kappa\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2} \tag{3.4}
\end{equation*}
$$

$$
from which the transconductance $\left(g_{m}=i_{\mathrm{d}} / v_{\mathrm{gs}}=\right.$ $\left.\partial I_{D} / \partial V_{G S}\right)$ is seen to be
$$

$$
\begin{equation*}
g_{m}=2 \kappa\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)=2 \sqrt{\kappa I_{\mathrm{D}}} \tag{3.5}
\end{equation*}
$$

\$\$

In other words, in the "quadratic region" of drain current, $g_{m}$ is proportional to gate drive, increasing approximately linearly from pinchoff to its specified value at $I_{\mathrm{DSS}}$; alternatively, you can say that it is proportional to the square root of drain current. ${ }^{28}$ This is a helpful rule, particularly because the datasheets specify $g_{m}$ only at its maximum value, at $I_{\mathrm{DSS}}$; we'll use it shortly. ${ }^{29}$

As an example, if (as is often the case) you're operating a JFET in its quadratic region and you want to estimate the transconductance at some drain current $I_{\mathrm{D}}$, then if you know $g_{m}$ at some other drain current $I_{\mathrm{D} 0}$ (which may be $I_{\mathrm{DSS}}$ ) you can exploit the square root dependence on drain current in eq'n 3.5 to find, simply

$$
\begin{equation*}
g_{m} / g_{m 0}=\left(I_{\mathrm{D}} / I_{\mathrm{D} 0}\right)^{\frac{1}{2}} \tag{3.6}
\end{equation*}
$$

FETs in general have considerably lower transconductance than bipolar transistors, ${ }^{30}$ which makes them less impressive as amplifiers and followers; we treat this in more detail in $\S 3 x .2$. However, their outstanding characteristic of extremely low input (gate) current, often of order a picoampere or less, makes it worthwhile to develop circuit solutions that circumvent the problems of low gain (e.g., current source as drain load), or that enhance their effective transconductance ("transconductance enhancer").

At this point it's helpful to see some JFET amplifier examples.

28 Be careful about signs: in these equations $V_{\mathrm{th}}$ and $V_{\mathrm{GS}}$ are negative (for $n$-channel JFETs), but $V_{\text {th }}$ is more negative, thus a positive value for $g_{m}$. As long as you respect signs, these expressions work for $n$-channel or $p$-channel and for enhancement or depletion modes. Note that the value $\kappa$ is not given on datasheets, but can be determined empirically for a given part type and manufacturer. Generally speaking, within a given batch or type of JFET you'll find variations in $V_{\mathrm{th}}$, with $\kappa$ being relatively constant. Thus a measurement of $I_{\mathrm{DSS}}$ and $V_{\mathrm{th}}$ allows you to calculate $\kappa$ from eq'n 3.4 , under the assumption that the quadratic region of drain current extends all the way to $I_{\mathrm{DSS}}$ (it usually does).
${ }^{29}$ See $\S 3 x .2$ for further discussion of transconductance versus drain current.
${ }^{30}$ Except in the low drain-current ("subthreshold") region; see Figure 3.54 and analogous figures in $\S 3 x .2$.

#### B. JFET amplifier configurations

Figure 3.29 shows the basic configurations for a JFET common-source amplifier stage. In circuit A the JFET is running at its $I_{\mathrm{DSS}}$, with $R_{\mathrm{D}}$ sized small enough so that the drain is at least a volt or two above ground for the maximum specified $I_{\mathrm{DSS}}$. (This is often an annoying constraint, given the loose ratio of specified $I_{\mathrm{DSS}(\max )} / I_{\mathrm{DSS}(\min )}-\mathrm{com}-$ monly 5:1 for most JFETs, see Tables 3.1 on page 141, 8.2 on page 516, and 3.7 on page 217; presently we'll see ways to handle this awkward situation.) The resistor across the input can be very large $-100 \mathrm{M} \Omega$ or more - with an input blocking capacitor (for an ac-coupled amplifier); or it can be omitted altogether for a dc-coupled signal near ground. For this circuit the ideal voltage gain is $G=g_{m} R_{\mathrm{D}}$, where $g_{m}$ is the transconductance at the operating drain current; it is analogous to the BJT grounded-emitter amplifier of Figure 2.44. ${ }^{31}$

To illustrate actual component values and performance we've chosen the exemplary BF862, because of its high transconductance ( 45 mS typical at $I_{\mathrm{DSS}}$ ) and tight $I_{\mathrm{DSS}}$ $\operatorname{spec}(10-25 \mathrm{~mA})$; it happens also to be a low-noise part, as we'll see in Chapter 8. The drain resistor $R_{\mathrm{D}}$ is sized to maintain a minimum 2.5 V across $Q_{1}$ (for specified $\left.I_{\mathrm{DSS}(\max )}\right)$; the typical voltage gain is then $G=-g_{m} R_{\mathrm{D}} \approx-$ 13 (inverting).

By adding a source resistor $R_{\mathrm{S}}$ circuit B lets you run at a drain current less than $I_{\mathrm{DSS}}$, in the manner of Figures 3.23 and 3.25. But the source degeneration reduces the gain, to $G=-R_{\mathrm{D}} /\left(R_{\mathrm{S}}+1 / g_{m}\right)$. This is analogous to the degenerated BJT common-emitter amplifier of Figure 2.49 (but with simpler self-biasing because the gate-source junction is back-biased), with $1 / g_{m}$ replacing $r_{\mathrm{e}}$ (you can think of $1 / g_{m}$ as an "intrinsic source impedance" of the JFET, analogous to the intrinsic emitter resistance $r_{\mathrm{e}}$ of the BJT). ${ }^{32} \mathrm{Il}-$ lustrating with the same BF862, we aim for a drain current of 2 mA by choosing a source self-bias resistor $R_{\mathrm{S}}=200 \Omega$, estimating that $\sim 0.4 \mathrm{~V}$ of gate back-bias is about right. ${ }^{33}$ Estimating that $g_{m} \approx 20 \mathrm{mS}$ at this drain current, ${ }^{34}$ we ar-

[^119]rive at an estimated voltage gain (from the above equation) of $G \approx-8$.

Circuit C bypasses the source resistor at signal frequencies, so you can run at the same dc drain current as circuit B , but with the higher gain as in circuit A (where $g_{m}$ is the transconductance at the actual drain current, here reduced from the $I_{\text {DSS }}$ of circuit A); it's analogous to the BJT circuit of Figure 2.48. You can throttle back the gain by adding a gain-setting resistor $R_{\mathrm{S}^{\prime}}$ in series with the capacitor (circuit D), for a signal-frequency gain of $G=-$ $R_{\mathrm{D}} /\left(R_{\mathrm{S}} \| R_{\mathrm{S}^{\prime}}+1 / g_{m}\right)$; this is analogous to the BJT circuit of Figure 2.50. Or you can step on the throttle by adding a second stage of voltage gain, as in circuit E , with the second stage common-emitter amplifier multiplying the first-stage gain of any of the previous single-stage circuits by a factor $R_{\mathrm{C}} I_{\mathrm{C}} / V_{\mathrm{T}}$ (i.e., $R_{\mathrm{C}} / r_{\mathrm{e}}$ ), where as always $V_{\mathrm{T}}=k T / q \approx 25 \mathrm{mV}$. This approximation assumes $Q_{2}$ is driven by a voltage source, i.e., $R_{\mathrm{D}} \ll \beta r_{\mathrm{e}}$; most of the gain of the combination comes from the BJT, with its high transconductance. The similar-looking circuit F creates a three-terminal hybrid creature, with the BJT's $g_{m}$ contributing to achieve a high effective overall transconductance; in this configuration the BJT is a "transconductance enhancer." This configuration is closely analogous to the BJT complementary Darlington (Sziklai) of Figure 2.77, and is treated in more detail in §3x.2.

#### C. Adding a cascode

The last four circuits show how to implement a drainclamping cascode to the common-source stage. This elegant configuration is usually featured as a way to circumvent the Miller effect (the effective multiplication of draingate capacitance by the stage's voltage gain); that's the way it was presented in Figure 2.84, where it made its first appearance. Here it indeed accomplishes that (it's a "Miller killer"), which is helpful in keeping the input impedance high. But it's better than that: (a) it also lets you keep the drain-to-source voltage low (avoiding the precipitous rise in "impact-ionization" gate current, §3.2.8); and (b) by clamping the drain-source voltage it circumvents the " $g_{\text {os }}$ effect" (finite output impedance $r_{\mathrm{o}}$, caused by $I_{\mathrm{D}}$ dependence on $V_{\mathrm{DS}}$ ); the voltage gain is then not degraded, and is simply $G=g_{m} R_{\mathrm{D}}$. This latter benefit is reminiscent of the use of a cascode transistor in the Wilson current mirror (Figure 2.61); it's an "Early killer." There's more detail in Chapter $3 x$ (§3x.4), including experimental results from four JFET exemplars whose $g_{m}$ and $g_{\text {os }}$ were measured; then their gain predictions were compared with measured amplifier gains (both with and without cascode).

In circuit G the BJT's base bias sets the JFET's
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0182.jpg?height=917&width=1736&top_left_y=210&top_left_x=215)

Figure 3.29. Simple single-supply JFET common-source amplifiers.
drain-to-source operating voltage. It's simpler to use a second JFET ( $Q_{2}$ in circuit H ), which must be chosen to have a larger $V_{\mathrm{GS}}$ back-bias than $Q_{1}$ at the same drain current, though the generally loose gate voltage specifications make this an uncertain proposition. Circuit J is an "inverted cascode," in which $Q_{1}$ 's drain current variations divert current from $Q_{2}$; it's a helpful circuit to know about when you find yourself bumping into the positive rail with a conventional cascode. Finally, in circuit K an op-amp transimpedance stage (current-to-voltage; see §4.3.1) substitutes for the drain-clamping cascode transistor $Q_{2}$ : feedback through $R_{\mathrm{f}}$ maintains its inverting input (the "-" input) at the bias voltage while producing an output voltage $V_{0}=-$ $I_{\mathrm{D}} R_{\mathrm{f}}+V_{\text {bias }} ;$ the optional resistor $R_{2}$ lets you add an offset to reposition the quiescent output voltage according to your whim.

The circuits in Figure 3.29 operate from a single positive supply voltage; they're simple, but, given the characteristically loose $I_{\mathrm{DSS}}$ and $V_{\mathrm{GS}}$ specifications of JFETs, they suffer from significant uncertainty of operating current. If you have available a negative supply voltage as well, there are several ways to rig things up to ensure predictable biasing. Look at Figure 3.30A, where the operating current of the $n$-channel JFET is set by the source pulldown resistor, $I_{\mathrm{D}}=-\left(V_{-}+V_{\mathrm{GS}}\right) / R_{\mathrm{S}}$, or approximately $V_{-} / R_{\mathrm{S}}$ for negative supply voltages large compared with
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0182.jpg?height=481&width=799&top_left_y=1206&top_left_x=1075)

Figure 3.30. A negative supply rail allows predictable sourcepulldown biasing of JFET common-source amplifiers.
the JFET's gate-source voltage. As in Figure 3.29C, the bypass capacitor lets signal frequencies partake of the full JFET gain, i.e., $G_{\mathrm{V}}=-g_{m} R_{\mathrm{D}}$, where $g_{m}$ is the transconductance at the operating current. A more elegant solution is the use of a current-sink pulldown, as in Figure 3.30B. The LM334 is an inexpensive ( $\sim \$ 0.50$ ) resistor-programmable current source (see §9.3.14B), here configured for 1 mA $\left(I \approx 0.067 / R_{\text {set }}\right)$. With this circuit there's no uncertainty about the operating current (it does not depend on $V_{\mathrm{GS}}$ ); better still, the LM334 operates down to 1 V drop, so you can operate with a single positive supply if the JFET's
minimum specified gate-source voltage at the programmed current is at least a volt. ${ }^{35}$

#### D. Series-feedback ("current-feedback") pair

The JFET amplifiers just illustrated have admirably high input impedance, but they suffer from rather low (and not terribly predictable) gain. Bipolar transistors give you predictable gain, and lots of it; but you pay the price in terms of input current. You can have the best of both worlds, though, by combining a JFET front-end of modest (and not terribly predictable) gain with some serious second-stage gain. That way you get the ultra-low input current (high input impedance) of a JFET, but with enough overall openloop circuit gain so that negative feedback can close the loop to produce predictable gain.

The next circuit is a low-power $(660 \mu \mathrm{~A})$ batteryoperated amplifier. We'll explore it in more detail than usual, introducing some new concepts along the way. Figure 3.31 shows the first of several JFET amplifier examples that exploit the JFET's ultra-low input current, combined with an additional gain stage (and feedback) to achieve predictable and stable voltage gain. It is similar to the bipolar series-feedback pair illustrated in Figure 2.92: $Q_{1}$ is a common-source amplifier, with BJT $Q_{2}$ providing secondstage voltage gain to the output (via follower $Q_{3}$, whose base-emitter drop across $R_{3}$ sets $Q_{2}$ 's collector current). That provides the needed voltage gain (which the JFET's low $g_{m}$ is unable to provide). Negative feedback closes the loop via voltage divider $R_{6}$ and $R_{5} \| R_{1}$ (at signal frequencies) and biasing via $R_{6}$ and $R_{1}$ at dc. This configuration is variously known as "series feedback" or "current feedback."

The spread of specified $I_{\text {DSS }}$ (or, equivalently, of $V_{\mathrm{GS}(\text { off })}$ ) creates a problem in any JFET design. To deal with that, we choose a JFET with a tight $V_{\mathrm{GS}(\mathrm{off})}$ specification $(-1.2$ to $-2.7 \mathrm{~V})$, and we run it at a drain current well below $I_{\mathrm{DSS}}(10 \mathrm{~mA}$ minimum) so that the gate-source voltage is close to $V_{\mathrm{GS}(\mathrm{off})}$. The feedback path sets the signal gain. With some careful thought (and some juggling and iteration), the same feedback path can be made to establish the (dc-coupled) bias condition.

Here's how it goes. The gate is at ground; we start by assuming a source voltage of approximately 1.7 V , and choose $R_{1}$ for $500 \mu \mathrm{~A}$. Of that, about $300 \mu \mathrm{~A}$ comes from the JFET's drain current ( $Q_{2}$ 's $V_{\mathrm{BE}}$ across $R_{2}$ ); thus

[^120]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0183.jpg?height=680&width=552&top_left_y=211&top_left_x=1099)

Figure 3.31. JFET-BJT series-feedback pair.
$\sim 200 \mu \mathrm{~A}$ is coming from $R_{6}$. This puts the output at about +2.4 V and sets $Q_{3}$ 's emitter current at about $300 \mu \mathrm{~A}$ $\left(110 \mu \mathrm{~A}\right.$ through $R_{4}$, plus $200 \mu \mathrm{~A}$ through $R_{6}$, minus $60 \mu \mathrm{~A}$ from $R_{3}$ ).

That's the self-consistent situation, under the assumed $V_{\mathrm{GS}}$ of -1.7 V . For a different $V_{\mathrm{GS}}$, the dc output voltage would change accordingly; it could range from +1.3 to +4 V over the extreme specified range of gate threshold voltage. This would degrade the maximum possible output swing, but that would usually be OK for an amplifier handling small signals (if not, $R_{1}$ could be selected for different $V_{\mathrm{GS}}$ ranges of JFET parts). ${ }^{36}$

The nominal gain at signal frequencies is approximately 100 , set by $R_{5}$ (blocked by $\left.C_{1}\right): G=1+R_{6} /\left(R_{5} \| R_{1}\right)$. The low-frequency -3 dB point is at 100 Hz (where the reactance of $C_{1}$ equals $R_{5}$ ). The high-frequency -3 dB point is not so easily calculated, but a SPICE model puts it at approximately 800 kHz (it measured 720 kHz in our breadboard, where there are some added parasitic capacitances). The latter is due primarily to the $R C$ rolloff of $Q_{1}$ 's output signal impedance of $2.1 \mathrm{k} \Omega$ (i.e., $R_{2}$ ) driving $Q_{2}$ 's input capacitance of $\sim 4 \mathrm{pF}$, with the latter greatly magnified by the Miller effect.

For large signal driving impedances $R_{\text {sig }}$ the amplifier's

[^121]bandwidth is reduced, ${ }^{37}$ owing to an input capacitance of $\sim 5 \mathrm{pF}$; see Figure 3.32. This is due primarily to the JFET's drain-to-gate capacitance (plus wiring capacitance), given that the source terminal is bootstrapped by feedback. There are numerous tricks to deal with this effect (if more bandwidth is desired), including a cascode in the JFET's drain (which can be bootstrapped to further suppress its input capacitance) and a cascode in the $Q_{2}$ BJT gain stage. Some of these techniques are discussed in Chapter $3 x$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0184.jpg?height=493&width=774&top_left_y=626&top_left_x=230)

Figure 3.32. Measured gain versus frequency for the amplifier of Figure 3.31. The $f_{3 \mathrm{~dB}}$ with $R_{\text {sig }}=1 \mathrm{M} \Omega$ shows that $C_{\mathrm{in}}=7 \mathrm{pF}$.

Design equations and design hints Collecting it together in one place:

$$
\begin{aligned}
& G=1+\frac{R_{6}}{R_{5} \| R_{1}} \approx 1+\frac{R_{6}}{R_{5}} \quad \text { (ac gain) }, \\
& G_{\mathrm{OL}}=g_{\mathrm{m} 1} R_{2} g_{\mathrm{m} 2} R_{3} g_{\mathrm{m} 3}\left(R_{4} \| R_{6}\right), \quad \text { (open-loop gain }{ }^{38} \text { ) } \\
& I_{\mathrm{D}}=\frac{V_{\mathrm{BE} 2}}{R_{2}} \approx \frac{0.7}{R_{2}} \quad \text { (JFET bias) }, \\
& I_{\mathrm{C} 2}=\frac{V_{\mathrm{BE} 3}}{R_{3}} \approx \frac{0.65}{R_{3}} \quad\left(Q_{2} \text { bias }\right), \\
& V_{\text {out }}=V_{\mathrm{S}}\left(1-\frac{R_{6}}{R_{1}}\right)+\frac{R_{6}}{R_{2}} V_{\mathrm{BE} 2}+\frac{R_{6}}{R_{1}}\left|V_{\mathrm{EE}}\right| \quad \text { (output bias). }
\end{aligned}
$$

37 Though paradoxically for $R_{\text {sig }}$ values of a few $\mathrm{k} \Omega$ it is extended somewhat, owing to some response "peaking."
38 This expression overestimates the open-loop gain by neglecting the gain-limiting Early effect in $Q_{2}$, the stage where most of the circuit's overall gain resides. The measured 2 N 3906 Early voltage $V_{A} \approx 25 \mathrm{~V}$ (§2x.8) implies a maximum voltage gain of the $Q_{2} Q_{3}$ stage of $\sim 1000$ (compared with its ideal $G \approx 2500$ ), thus an overall open-loop gain of $\sim 5000$. This is ample for the modest $\times 100$ closed-loop gain.

For single-supply operation the last term is zero. Basically, $R_{2}$ sets $I_{\mathrm{D}}$, and the ratio $R_{6} / R_{1}$ sets $V_{\text {out }}$. For singlesupply operation ( $V_{\mathrm{EE}}=0$ ) use a small value for $R_{6}$ if the JFET has substantial $V_{\mathrm{GS}}$ at its operating current and larger values for $R_{6}$ for lower $V_{\mathrm{GS}}$ parts. The latter is tricky, because the "leverage" of $R_{6} / R_{1}$ can push $V_{\text {out }}$ all over the map. Choose $R_{4}$ to help set $I_{\mathrm{C} 3}$ after you've dealt with $V_{\text {out }}$. It may be necessary to select $R_{1}$ to go with batches of parts with similar $V_{\mathrm{GS}}$. A negative $V_{\mathrm{EE}}$ supply helps with biasing and also permits output swings both sides of ground.

Another way to handle the uncertainty in $V_{\text {out }}$ is to apply a positive bias to the gate, as in Figure 3.33A. This adds a positive offset of $V_{\mathrm{B}}$ at the source terminal (whose voltage is now $V_{\mathrm{S}}=V_{\mathrm{B}}-V_{\mathrm{GS}}$, where $V_{\mathrm{GS}}$ is negative for an $n$-channel JFET), making $V_{\mathrm{GS}}$ less important, and thus a smaller fractional uncertainty in $V_{\mathrm{S}}$. While you're at it, you can easily bootstrap the gate bias divider, ${ }^{39}$ as in Figure 3.33 B , to raise the input impedance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0184.jpg?height=440&width=802&top_left_y=971&top_left_x=1056)

Figure 3.33. A. A positive bias at the gate of $Q_{1}$ in Figure 3.31 improves the predictability of $V_{\text {out }}$. B. Add a bootstrap to raise $R_{\text {in }}$.

#### E. Simple "hybrid" JFET amplifier

With the assistance of an op-amp (the magnificent centerpiece of Chapter 4) you can do wonders. Put simply, an op-amp is a "very high-gain difference amplifier in a bottle," intended to be fodder for feedback as the universal core of pretty much any analog circuit. It's pure engine: a turbocharged Harley unicycle with dual intakes. This example and the next show a couple of ways to use an opamp's properties in support of a JFET amplifier. Look first at Figure 3.34. Here we've chosen the excellent 2SK170B (with LSK170B as a second source) for the front-end: it has lots of transconductance (about 25 mS at its $I_{\mathrm{DSS}}$ of 612 mA ), along with very low noise voltage ( $\sim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). We run it at zero gate voltage; and we deal with the $2: 1$

[^122]spread of specified $I_{\mathrm{DSS}}$ (a tighter specification than provided for most JFETs) by choosing the drain load resistor $R_{\mathrm{D}}$ small enough to avoid dc saturation even at $I_{\mathrm{DSS}}$ (max). The actual drain voltage is unimportant because we use ac coupling to the second stage (via $C_{1}$ ). Ignoring for the moment the second stage (and setting $R_{\mathrm{g}}=0$ ), the front-end voltage gain would be $G=g_{m} R_{\mathrm{D}}$, or roughly $G \approx 25$, with perhaps $\pm 25 \%$ uncertainly from JFET manufacturing process variations.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0185.jpg?height=575&width=853&top_left_y=626&top_left_x=71)

Figure 3.34. Hybrid JFET amplifier: high-Z, low-noise, wideband amplifier. A response peak (for $R_{\text {sig }} \sim 1 \mathrm{k} \Omega$ ) can be tamed by adding a 10-20 pF capacitor across the input, see Figure 3.35.

But the load seen by the drain (at signal frequencies) is in fact the low-impedance input of the second stage, which is an op-amp configured here as a current-to-voltage ("transresistance") converter (see §4.3.1C). Its "gain" (ratio of output voltage to input current, thus units of resistance) is just $R_{1}$, making the overall open-loop gain $G=$ $g_{m} R_{1}$ (again assuming no feedback, and $R_{\mathrm{g}}=0$ ). So, for the circuit values shown, the open-loop gain $G_{\mathrm{OL}} \approx 2500$.

Now we close the loop via $R_{\mathrm{f}}$, subtracting from the input a fraction $R_{\mathrm{g}} /\left(R_{\mathrm{g}}+R_{\mathrm{f}}\right)$, for an ideal closed-loop gain $G_{\mathrm{CL}}=1+R_{\mathrm{f}} / R_{\mathrm{g}}=50$. The loop gain (ratio of open-loop to closed-loop gains) is about 50, adequate for good linearity and predictability of gain (see §2.5.3). Note the low resistance of $R_{\mathrm{g}}$ : it should be small enough so that the open-loop gain is not much reduced (thus $R_{\mathrm{g}}<1 / g_{m}$ ); and it should also be small enough so that its Johnson noise contribution is insignificant (§8.1). For a JFET transconductance of 25 mS , the first constraint limits $R_{\mathrm{g}}$ to somewhat less than $40 \Omega$; and for this JFET's noise voltage of $\sim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ the second constraint limits $R_{\mathrm{g}}$ to somewhat less than $25 \Omega$. Thus we choose the low $\sim 10 \Omega$ value. With the values shown, the open-loop gain is reduced by $\sim 20 \%$, the in-
put noise voltage is increased by $\sim 8 \%$, and the feedback network loads the op-amp to $\pm 20 \mathrm{~mA}$ at full swing. ${ }^{40}$

The op-amp here was chosen for its wide bandwidth (it falls to unity gain at $\sim 100 \mathrm{MHz}$ ), so the circuit's closedloop gain rolls off at about $20 \mathrm{MHz},{ }^{41}$ as seen in the measured data of Figure 3.35. A bonus is the impressive output drive capability: up to 100 mA , and full $\pm 10 \mathrm{~V}$ swing to nearly 10 MHz . The small compensation capacitor $C_{\mathrm{c}}$ enhances stability: with no compensation we measured 5 dB of peaking at 16 MHz ; adding $C_{\mathrm{c}}$ resulted in an insignificant 0.1 dB peaking at 10 MHz and a high-frequency rolloff of -3 dB at $22 \mathrm{MHz} .{ }^{42}$

An alternative circuit that exploits the JFET's high input impedance is an input JFET source follower (§3.2.6) driving a stage of voltage gain. That's a perfectly good configuration, particularly if a current sink is used for the source pulldown. But the circuit of Figure 3.34 excels in achieving both lower noise and better linearity.

### 3.2.4 Differential amplifiers

Thus far we've dealt with the JFET's uncertain $I_{D}$ versus $V_{\mathrm{GS}}$ relationship by restricting ourselves to ac-coupled amplifier designs. But we can do better: a JFET matched pair lets us make dc-coupled amplifiers of respectable performance. And of course their very low input current means that these circuits can serve as high-input-impedance frontend stages for bipolar differential amplifiers, as well as for the important op-amps and comparators we'll meet in the next chapter. As we mentioned earlier, the substantial $V_{\mathrm{GS}}$ offsets of FETs will generally result in larger input voltage offsets and offset drifts than with a comparable amplifier
${ }^{40}$ If you're not happy with that, you could double or triple $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$, at the expense of slightly higher amplifier noise. See $\S 8.6$ for much more on low-noise JFET design.
${ }^{41}$ When driven with a low signal impedance. With a higher impedance signal source, the rolloff is dominated by the circuit's input capacitance: $Q_{1}$ has a drain-to-gate capacitance $C_{\mathrm{rss}}$ of 6 pF , thus the observed -3 dB bandwidth of $\sim 400 \mathrm{kHz}$ with a $100 \mathrm{k} \Omega$ source. Happily, the larger gate-to-source capacitance $\left(C_{\mathrm{iss}} \approx 30 \mathrm{pF}\right)$ is bootstrapped into insignificance by feedback. "And what of the evil Miller effect?" you wonder. That's suppressed here, because the op-amp holds its $(-)$ input fixed (a "virtual ground") via feedback through $R_{1}$; see $\S 4.3 .1 \mathrm{C}$.
${ }^{42}$ In any feedback circuit there's the possibility of some "peaking" in the response at some frequency (or, in the worst case, a full-blown oscillation). This circuit exhibits modest peaking for input impedances in the range of a few $\mathrm{k} \Omega$, as seen in Figure 3.35. Its amplitude can be tamed by adding $\sim 10-20 \mathrm{pF}$ of input shunt capacitance, with some consequent reduction of bandwidth.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0186.jpg?height=542&width=776&top_left_y=221&top_left_x=227)

Figure 3.35. Measured gain versus frequency for the amplifier of Figure 3.34. The solid curves are with a 10 pF shunt capacitor across the input, a compromise value for good performance over a wide range of input signal impedances (omit the capacitor for high source impedance, increase it for the worst-case $R_{\mathrm{sig}} \approx 1 \mathrm{k} \Omega$ ).
constructed entirely with bipolar transistors, but of course the input impedance will be raised enormously.

Figure 3.36 shows the simplest configurations, analogous to the simple BJT differential amplifiers of Figures 2.63 and 2.67. The differential gain of the classic longtailed pair in Figure 3.36A (defined as $\Delta V_{\text {out }} / \Delta V_{\text {in }}$, with $R_{1}=R_{2}$ and differential output as shown) is just $G=g_{m} R_{1}$; the common-mode rejection is greatly improved with a current sink substituting for the source resistor $R_{\mathrm{S}}$. A drawback of this circuit is the uncertainty in gain (owing to the uncertainty in transconductance); and the gain is modest, owing to the limited transconductance of JFETs in general. You can circumvent the gain limitation by replacing the drain load resistor(s) with a current mirror, as in Figure 3.36B. This circuit fragment is not bias stable, however: it must be accompanied by a following stage that is configured to provide dc feedback.

These circuits suffer also from the Miller effect (§2.4.5), whose multiplying action on the feedback capacitance $C_{\mathrm{rss}}$ acts to increase the effective input capacitance, thus (in combination with the signal's source impedance) reducing the bandwidth. The current mirror in circuit (B) clamps $Q_{1}$ 's drain, but the Miller effect is present still at $Q_{2}$ 's input. ${ }^{43}$ As with BJT amplifier stages, an effective method of eliminating the Miller effect is the use of a cascode transistor (either JFET or BJT) in the drain(s), a desirable configuration discussed later and in Chapter $3 x$ in the section

[^123]"Bandwidth of the Cascode.". By clamping the drain voltage, the cascode also eliminates a reduction in gain seen in simple circuits like that of Figure 3.36A: that's because the JFET's drain-current depends somewhat on drain voltage (the upward slope in plots of drain-current versus drainsource voltage, which you can think of as a finite output impedance), which can reduce the ideal $g_{m} R_{1}$ gain by as much as $25 \%$.

For this and other reasons the cascode is highly recommended, even when bandwidth is not an issue. Curious about those "other reasons"? Consider this: the gate current in JFETs, normally down in the picoamperes, rises precipitously with drain-to-source voltage - see Figure 3.49 on page 164 where picoamps become microamps! A cascode lets you clamp the drain to a low operating voltage, suppressing this effect. This is nicely illustrated in the figure toward the end of $\S 3 x .4$ in Chapter $3 x$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0186.jpg?height=476&width=723&top_left_y=938&top_left_x=1108)

Figure 3.36. Simplest JFET differential amplifiers.

#### A. Example: a dc-coupled hybrid JFET amplifier

In the earlier hybrid amplifier design example (Figure 3.34) we dodged the issue of unpredictable JFET drain current by settling for an ac-coupled amplifier. That's fine for something like an audio or RF amplifier; but sometimes you'd like response all the way down to dc.

You can achieve that by exploiting a matched-pair JFET differential input stage in a fully dc-coupled arrangement, as in Figure 3.37. The overall configuration is a commonsource differential amplifier with the input signal connected to one side. Its differential voltage output drives a wideband op-amp, whose output (divided by the gainsetting voltage divider) provides negative feedback to the other terminal of the input pair. As with the previous circuit, the closed-loop gain is $G_{\mathrm{CL}}=1+R_{\mathrm{f}} / R_{\mathrm{g}}=50$, with a small loop compensation capacitor $C_{\mathrm{c}}$ chosen for best response without peaking.

The devil's in the details, which, if you're lucky,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0187.jpg?height=588&width=832&top_left_y=221&top_left_x=102)

Figure 3.37. An op-amp closes the loop around a JFET matched pair to create a dc-coupled wideband low-noise amplifier with high input impedance. Replace source bias resistor $R_{\mathrm{S}}$ with a current sink (see Figure 3.26) for enhanced supply rejection.
may come together in a symphonic harmony. This circuit worked out nicely; thus our enthusiasm for a bit of discussion. Here goes.

The LSK389 is a very low-noise ( $\sim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) monolithic matched JFET pair, ${ }^{44}$ available in three $I_{\mathrm{DSS}}$ grades. We chose the midcurrent -B suffix part (with a specified $I_{\text {DSS }}$ between 6 mA and 12 mA ), and we force each JFET of the pair to run at 5 mA by sinking 10 mA from the pair of source terminals. That puts the drains at +5 V (the op-amp enforces equality), with an open-loop gain (from single-ended input to differential output) of approximately $G=g_{m}\left(R_{\mathrm{D}}+0.5 R_{\mathrm{T}}\right) \approx 40$. To this the op-amp contributes its substantial open-loop gain ( 90 dB , i.e., $\times 30,000$ ), in a scary-looking configuration whose stability might seem seriously to be in doubt. But not to worry - the $\div 50$ divider in the return loop safely limits the loop gain, ${ }^{45}$ with any tendency toward instability easily tamed with appropriate choice of $C_{\mathrm{c}}$.

According to the datasheet, the input pair $Q_{\text {lab }}$ has "Tight Matching." But that's on the scale of JFETs, not BJTs - here that "matching" is a whopping $\pm 20 \mathrm{mV}$ maximum (about $100 \times$ the matching of a good BJT pair), which the circuit's $G=50$ would amplify to an output offset of 1 V ! Hence the offset trim $R_{\mathrm{T}}$, with enough range to balance the worst-case input offset.

Our initial design included a bypass capacitor from the drain of the input transistor to ground, to suppress the

[^124]Miller effect. A nice thought, but the reality is that the Miller effect is almost entirely absent owing to the opamp's clamping effect on the drain pair. And the bypass capacitor introduces two problems: it unbalances the transistor pair, so the circuit is sensitive to noise on the positive supply rail; and it introduces a phase shift within the loop, causing some undesirable peaking, thus requiring a larger value of $C_{\mathrm{c}}$ and therefore reduced bandwidth.

Now for the feedback stability "compensation." In a single-ended circuit like Figure 3.34 you can put a small capacitor across either $R_{1}$ or across $R_{\mathrm{f}}$. Here, though, we want to maintain input-stage symmetry, so $C_{\mathrm{c}}$ has to go across $R_{\mathrm{f}}$. On the bench we found that 10 pF was required to eliminate peaking in the frequency response, when tested with a low-level sinewave input; Figure 3.38 shows the data.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0187.jpg?height=402&width=802&top_left_y=906&top_left_x=974)

Figure 3.38. Selecting the compensation capacitor $C_{\mathrm{c}}$ for the amplifier of Figure 3.37. A value of 8 or 10 pF works well.

A final bit of compensation is the shunt capacitor $C_{\text {in }}$ across the input to suppress some modest peaking that is seen for signal sources of $\sim 1 \mathrm{k} \Omega$ impedance $\left(R_{\text {sig }}\right)$. Here 5 pF did the job nicely (though it increased the circuit's input capacitance to $\sim 20 \mathrm{pF}$ ). Figure 3.39 shows the measured gain versus frequency for the finished circuit (with the component values shown in Figure 3.37), for nine values of $R_{\text {sig }}$ (spanning four decades of resistance).

As with the previous circuit, the LM6171 op-amp provides a full $\pm 10 \mathrm{~V}$ output swing to nearly 10 MHz . The $50 \Omega$ resistor in series with the output ensures stability into capacitive loads; it also provides "back termination" into $50 \Omega$ coax cable (see the Appendix $H$ on Transmission Lines). This op-amp is not particularly quiet $\left(e_{\mathrm{n}} \sim 12 \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$ ), but that's good enough: the circuit's input-stage gain of $\sim 40$ reduces the op-amp's noise contribution to $\sim 0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ when referred to the input. The amplifier's overall noise is $\sim 2 \mathrm{nV} / \sqrt{\mathrm{Hz}} .^{46}$

[^125]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0188.jpg?height=465&width=786&top_left_y=206&top_left_x=227)

Figure 3.39. Measured gain versus frequency for the amplifier of Figure 3.37, for a range of values of signal source impedance $R_{\text {sig }}$.

This is a pretty good amplifier! With a bit of refinement (primarily substituting a low-noise current sink for $R_{\mathrm{S}}$ ), two such amplifiers, combined in a so-called "instrumentation amplifier" (INA) configuration, will outperform any available integrated INA in terms of both noise and speed; see Figure 8.49 in §8.6.3.

#### B. Comparison with JFET-input op-amps

We can hear it already: "Yeah, yeah...you guys like to show off your clever circuits, with lots of discrete components. But nowadays that kind of circuit art is obsolete, because you can get all that performance, and more, in readily available integrated circuits - op-amps, in particular."

But, can you? Table 3.2 lists the currently available opamps with JFET inputs that have a chance of competing. How does their performance compare with that of our dccoupled hybrid amplifier of Figure 3.37? Let's see...
Output swing Only the first three op-amps can swing over the full $\pm 15 \mathrm{~V}$ range; OK , but. . .
Bandwidth ...the fastest of those "high-voltage" opamps has 80 MHz GBW, thus for $G=50$ a bandwidth of less than 2 MHz ; and the two fastest op-amps, which can match our amplifier's bandwidth, can swing only $\pm 4 \mathrm{~V}$ or so. By contrast, our amplifier's GBW is 4 GHz ( 40 times the op-amp's $f_{\mathrm{T}}=100 \mathrm{MHz}$ ), and thus excess gain (e.g., 400 at 10 MHz ) with lower resulting distortion.

Noise Our amplifier's noise of $\sim 2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ is 6 dB quieter than the best of Table 3.2's offerings.
Cost \$5-10 for the op-amp solution, roughly the same for the better-performing hybrid amplifier ( $\$ 2.50$ for the LM6171, \$3.25 for the LSK389 dual JFET)

JFET. That will reduce the input noise to $\sim 0.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, but with a greatly increased input capacitance (about 300 pF ). (And thermal noise from the feedback network will degrade this unless $R_{\mathrm{g}}$ is decreased to $\sim 5 \Omega$; see $\S 8.1$ and Figure 8.80A.)

Table 3.2 Selected Fast JFET-input Op-amps ${ }^{a}$

| Part \# | Supply |  | $\begin{gathered} \text { Ibias } \\ 25^{\circ} \mathrm{C} \\ \text { typ } \\ \text { (pA) } \\ \hline \end{gathered}$ | $e_{n}$ <br> 1 kHz <br> typ <br> $(\mathrm{nV} / \sqrt{ } \mathrm{Hz})$ | GBW <br> typ <br> (MHz) | Slew Rate typ <br> ( $\mathrm{V} / \mathrm{Hs}$ ) | Cost qty 25 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | Voltage range | $\begin{gathered} I_{Q}^{Q} \\ \text { typ } \end{gathered}$ |  |  |  |  |  |
|  | (V) | (mA) |  |  |  |  |  |
| OPA604A | 9-50 | 5 | 50 | 10 | 20 | 25 | 2.93 |
| OPA827A | 8-40 | 5 | 15 | 4 | 22 | 28 | 9.00 |
| ADA4637 | 9-36 | 7 | 1 | 6 | $8^{\text {d }}$ | 170 | 10.12 |
| OPA656 | 9-13 | 14 | 2 | $7^{\text {b }}$ | 230 | 290 | 5.59 |
| OPA657 | 9-13 | 14 | 2 | 7 | $1600^{\text {d }}$ | 700 | 10.01 |
| ADA4817 | 5-10.6 | 19 | 2 | $4^{\text {C }}$ | 1050 | 870 | 4.93 |

Notes: (a) candidates for wideband low-noise amplifier. (b) low $e_{n} C$ noise: $C_{\mathrm{in}}=2.8 \mathrm{pF}$. (c) lowest $e_{n} C$ noise: $C_{\text {in }}=1.5 \mathrm{pF}$. (d) decomp, $G_{\mathrm{CL}}>7$.

The contest so far? The hybrid amplifier is winning, in terms of the combined performance metric of bandwidth, output swing, and noise voltage. But we're not done yet...
Offset voltage The op-amps win, here, with out-of-thebox $V_{\text {os }}$ values of 2 mV (max) for the three fastest parts; the hybrid amp requires manual trimming of its 20 mV worst-case untrimmed offset, if better is needed.
Parts count A win, again, for the op-amps.
Input capacitance Just 1.5 pF for the ADA4817, versus 10 pF or more for the hybrid (the price we paid for $2 \times$ lower noise).
Input current 20 pA (max) for the ADA4817 (but that's a low-voltage part), versus 200 pA for the hybrid (unfair! - that's specified at a large negative bias, $V_{\mathrm{GS}}=-30 \mathrm{~V}$ )

The verdict? A split decision: the JFET op-amp solution is simple and can deliver plenty of speed (or plenty of swing, but not both), along with untrimmed accuracy and very low-input capacitance (thus low " $e_{\mathrm{n}} C$ " noise; see Chapter 8). The hybrid approach delivers speed and swing and lowest noise voltage; but it requires manual trim, it's more complicated, and it has more input capacitance. Note also that an op-amp is a more flexible building block in general, providing, for example, a wide common-mode input-voltage range that our hybrid circuit does not have; but that is not needed here, because the input is always close to ground (owing to the circuit's gain of 50).

### 3.2.5 Oscillators

In general, FETs have characteristics that make them useful substitutes for bipolar transistors in almost any circuit that can benefit from their uniquely high input impedance and low bias current. A particular instance is the use of a JFET amplifier stage to implement a high-stability $L C$ or crystal oscillator; we'll show examples in §7.1.5D.

### 3.2.6 Source followers

Because of the relatively low transconductance of FETs, it's often better to use a FET "source follower" (analogous to an emitter follower) as an input buffer to a conventional BJT amplifier, rather than trying to make a commonsource FET amplifier directly. You still get the high input impedance and zero dc input current of the FET, and the BJT's large transconductance lets you achieve high singlestage gain. Furthermore, discrete FETs (i.e., those that are not part of an integrated circuit) tend to have higher interelectrode capacitance than BJTs, leading to greater Miller effect ( $\$ 2.4 .5 \mathrm{~B}$ ) in common-source amplifiers; the sourcefollower configuration, like the emitter follower, has no Miller effect.

FET followers, with their high input impedance, are commonly used as input stages in oscilloscopes as well as in other measuring instruments. There are many applications in which the signal-source impedance is intrinsically high, e.g., capacitor microphones, pH probes, chargedparticle detectors, or microelectrode signals in biology and medicine. In these cases, a FET input stage (whether discrete or part of an integrated circuit) is a good solution. Within circuits there are situations in which the following stage must draw little or no current. Common examples are analog "sample-and-hold" and "peak detector" circuits, in which the level is stored on a capacitor and will "droop" if the next amplifier draws significant input current. In all these applications the advantage of negligible input current of a FET more than compensates for its low transconductance, making source followers (or even common-source amplifiers) attractive alternatives to the bipolar emitter follower.

Figure 3.40 shows the simplest source follower, which ideally should produce an accurate replica of the input waveform while drawing essentially zero input current. Let's figure out important things like its quiescent operating point, its exact voltage gain, its output impedance, and the voltage offset from input to output.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0189.jpg?height=289&width=231&top_left_y=1886&top_left_x=405)

Figure 3.40. $N$-channel JFET source follower. Unlike the npn BJT emitter follower (in which the output trails the input by $V_{\mathrm{BE}} \approx 0.6 \mathrm{~V}$ ), the output is here more positive than the input.

#### A. Quiescent operating point

The JFET source follower is not as simply analyzed as the analogous BJT emitter follower, in which the emitter voltage simply trails the base voltage by a relatively constant (and predictable) $V_{\mathrm{BE}} \approx 0.6 \mathrm{~V}$. That is because the FET has less abrupt (and far less predictable) transfer characteristics ( $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ ) - the same issue we've just wrestled with in connection with the JFET current source (\$3.2.2) and the JFET amplifier (§3.2.3).

We could use the same iterative approach here, seeking the quiescent source voltage $V_{\mathrm{S}}$ (and therefore $V_{\mathrm{GS}}=V_{\mathrm{S}}$ ) that produces a source current $I_{\mathrm{S}}$ (and therefore $I_{\mathrm{D}}=I_{\mathrm{S}}$ ) consistent with that $V_{\mathrm{S}}$. And we could do this by interpolating between curves like those in Figure 3.21A (a family of $I_{\mathrm{D}}$ versus $V_{\mathrm{DS}}$ for several $V_{\mathrm{GS}}$ 's), or by sliding up and down a transfer characteristic curve like that in Figure 3.41 (a single curve of $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$, at some fixed $V_{\mathrm{DS}}$ ), until we find the point at which $I_{\mathrm{D}} R_{\mathrm{L}}=-V_{\mathrm{GS}}$.

But there is an elegant graphical method, used extensively during the days of vacuum tubes, that lets you find the operating point immediately: the method of "load lines."

#### B. Load lines

To find the operating point for the source follower in Figure 3.40 , we simply notice that the load resistor $R_{\mathrm{L}}$ imposes its rules on allowable $V_{\mathrm{GS}}$ versus $I_{\mathrm{S}}$, namely, Ohm's law: $I_{\mathrm{S}} R_{\mathrm{L}}=-V_{\mathrm{GS}}$. We can plot this constraint on the same graph as the transfer curve of Figure 3.41, as a straight line with slope $-1 / R_{\mathrm{L}}$; note that it goes "backward,"
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0189.jpg?height=564&width=774&top_left_y=1514&top_left_x=985)

Figure 3.41. Measured transfer curves for a set of 2N5457 and 2N5458 $n$-channel JFETs at $V_{\mathrm{DS}}=10 \mathrm{~V}$. These measurements extend beyond $I_{\mathrm{DSS}}$, with $V_{\mathrm{GS}}$ taken 0.6 V into positive territory. The OnSemi curves show the parts with the lowest, middle, and highest $I_{\mathrm{DSS}}$ from a batch of ten each.
because $V_{\mathrm{S}}=-V_{\mathrm{GS}}$. The operating point has to be consistent with this constraint and simultaneously with the transfer characteristic of the JFET. In other words, the operating point is the intersection of the two curves. In this case, with $R_{\mathrm{L}}=1 \mathrm{k}$, the quiescent point is at $V_{\mathrm{S}}=+1.6 \mathrm{~V}$ (and, from the lowest 2N5458 curve, $I_{\mathrm{D}}=1.6 \mathrm{~mA}$ ).

Lest one be tempted to fall too quickly in love with this technique, we hasten to point out that the characteristic curves for a particular type of JFET exhibit a large spread. For the 2N5458 illustrated in Figure 3.41, for example, the specification allows $I_{\text {DSS }}$ to be anywhere between 2 and 9 mA (and the pinchoff voltage $V_{\mathrm{GS}(\text { off })}$ can range from -1.0 to -7.0 V ). In practice, it is rare to find devices at the extremes, and there tends to be good consistency in a single manufacturing batch (as indicated by the date code stamped on the parts); for example, by measuring a batch of 10 2N5458's (Figure 3.41) we determined that the quiescent point in this circuit would range from 1.52 to 1.74 V .

#### C. Output amplitude and voltage gain

We can figure out the output amplitude, as we did for the emitter follower in Section 2.3.3, using the transconductance. We have

$$
v_{\mathrm{s}}=R_{\mathrm{L}} i_{\mathrm{d}}
$$

since $i_{\mathrm{g}}$ is negligible; but

$$
i_{\mathrm{d}}=g_{m} v_{\mathrm{gs}}=g_{m}\left(v_{\mathrm{g}}-v_{\mathrm{s}}\right)
$$

so

$$
v_{\mathrm{s}}=\left[\frac{R_{\mathrm{L}} g_{m}}{\left(1+R_{\mathrm{L}} g_{m}\right)}\right] v_{\mathrm{g}}
$$

That is, the gain is

$$
\begin{equation*}
G=\frac{1}{1+\frac{1}{g_{m} R_{\mathrm{L}}}} \tag{3.7}
\end{equation*}
$$

For $R_{\mathrm{L}} \gg 1 / g_{m}$ it is a good follower $\left(v_{\mathrm{s}} \approx v_{\mathrm{g}}\right)$, with gain approaching, but always less than, unity. We are not near that limit in this example, in which the measured value $g_{m}=1.9 \mathrm{mS}$ implies a voltage gain of $G_{\mathrm{V}}=0.66$ into the $1 \mathrm{k} \Omega$ load, far from the ideal of unity gain. Furthermore, the variation of transconductance over the signal swing results in undesirable nonlinearity. One solution is to use a JFET with higher transconductance, or (better) add a BJT transconductance enhancer (Figure 3.29F and §3x.2). But in situations in which the external load impedance is high, an elegant solution is to use a current sink as an active load, as we'll see presently ( $\S 3.2 .6 \mathrm{~F}$ ).

#### D. Input impedance

Our hope that JFET source followers have infinite input impedance is largely fulfilled, but they do have some gate leakage current (see §3.2.8) and input capacitance (see Table 3.7 on page 217). Gate leakage can become a problem at drain-gate voltage greater than about 5 V (Figure 3.49), so be sure to check the JFET's datasheet and, if necessary, consider adding a cascode to limit $V_{\mathrm{DG}}$.

A follower's frequency response when driven by signals of high source impedance is limited by input capacitance, $f_{3 \mathrm{~dB}}=1 / 2 \pi C_{\text {in }}$, where $C_{\text {in }}=C_{\text {iss }}+C_{\mathrm{rss}}+C_{\text {stray }}$. The gate-source capacitance $C_{\text {iss }}$ is generally about two to five times higher than the gate-drain capacitance $C_{\mathrm{rss}}$, but fortunately it's bootstrapped by the follower action and is effectively reduced to $\left(1-G_{V}\right) C_{\text {iss }}$. If you follow our advice (below) so that $G_{V}$ is nearly 1.0 , only the JFET's $C_{\text {rss }}$ remains to limit the bandwidth. But it's possible to bootstrap the drain and reduce the effect of $C_{\mathrm{rss}}$ by a factor of 5 . This leaves $C_{\text {stray }}$ as "the last man standing" to limit the bandwidth - but you may be able to knock him down too by "guarding" most of the input wiring capacitance (i.e., using the follower's output signal to drive the cable's shield; see the discussion of signal guarding in §5.15.3).

#### E. Output impedance

The preceding equation for $v_{\mathrm{s}}$ is precisely what you would predict if the source follower's output impedance were equal to $1 / g_{m}$ (try the calculation, assuming a source voltage of $v_{\mathrm{g}}$ in series with $1 / g_{m}$ driving a load of $R_{\mathrm{L}}$ ). This is exactly analogous to the emitter-follower situation, in which the output impedance was $r_{\mathrm{e}}=25 / I_{\mathrm{C}}$, or $1 / g_{m}$. It can be easily shown explicitly that a source follower has output impedance $1 / g_{m}$ by figuring the source current for a signal applied to the output with the gate grounded (Figure 3.42). The drain current is

$$
i_{\mathrm{d}}=g_{m} v_{\mathrm{gs}}=g_{m} v
$$

so

$$
\begin{equation*}
r_{\mathrm{out}}=v / i_{\mathrm{d}}=1 / g_{m} \tag{3.8}
\end{equation*}
$$

typically a few hundred ohms at currents of a few milliamps. ${ }^{47}$

In general, FET source followers aren't nearly as stiff as emitter followers. The exception is at very low currents,

[^126]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0191.jpg?height=284&width=244&top_left_y=225&top_left_x=123)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0191.jpg?height=366&width=458&top_left_y=220&top_left_x=442)

Figure 3.42. Calculating source-follower output impedance.
in the subthreshold region, where the transconductance of some JFETs approaches that of a BJT operated at the same current; see Figure 3.54 on page 168.

In this example, with $g_{m}=1.9 \mathrm{mS}$, the impedance looking back into the JFET's source is $r_{\text {out }}=525 \Omega$, which combines with the parallel 1 k source load resistor to produce an output impedance of $345 \Omega$, quite a bit higher than the analogous value of $r_{\mathrm{e}}=16 \Omega$ for a BJT operating at the same 1.6 mA .

We were able to calculate the voltage gain and output impedance reasonably accurately in this example because we took the trouble to measure the $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ characteristic curves. It's worth pointing out, however, that the manufacturer's datasheet for the 2N5458 gives us little help here: it gives no characteristic curves for the 2N5458, only for the lower-current part (2N5457); and for the 2N5458 it specifies $g_{m}$ only at $I_{\mathrm{DSS}}$, where it gives a range of 1.5 mS to 5.5 mS . From these limits, along with the $I_{\mathrm{DSS}}$ and $V_{\mathrm{GS}(\mathrm{OFF})}$ limits above, we would not be able to form a good estimate of the operating transconductance, because the operating point with a fixed value of source load resistor is illdetermined. We could do better by assuming that we adjust $R_{\mathrm{S}}$ to make $I_{\mathrm{D}}=1.6 \mathrm{~mA}$, say; then, using the fact that $g_{m} \propto \sqrt{I_{\mathrm{D}}}$, the specified limits of $I_{\mathrm{DSS}}$ and of $g_{m}$ (at $I_{\mathrm{DSS}}$ ) guarantee that $g_{m}$ lies in the range 0.6 mS to $4.9 \mathrm{mS} .^{48}$ Our measured value of $g_{m}$ falls nicely within this range, being rather close to the geometric mean of these limits.

There are two drawbacks to this circuit.

1. The relatively high output impedance means that the output swing may be significantly less than the input swing, even with high load impedance, because $R_{\mathrm{L}}$ alone forms a divider with the source's output impedance. Furthermore, because the drain current is changing over the signal waveform, $g_{m}$ and therefore the output impedance will

[^127]vary, producing some nonlinearity (distortion) at the output. The situation is improved if FETs of high transconductance are used, of course, but a combination FET-BJT follower (or FET-BJT " $g_{m}$ enhancer," Figure 3.29F) is often a better solution.
2. Because the $V_{\mathrm{GS}}$ needed to produce a certain operating current is a poorly controlled parameter in FET manufacture, a source follower has an unpredictable dc offset, a serious drawback for dc-coupled circuits.
(An additional problem is caused by the fact that an FET's drain current depends to some degree on drain-tosource voltage. You might call this the " $g_{\text {os }}$ effect," which also acts to reduce the gain from the ideal $G=1$. It is discussed later in §§3.3.2 and in the Chapter $3 x$ section "Bandwidth of the Source Follower with a Capacitive Load.")

Perhaps this is a good place to pause and realize that many of the circuits we've been considering would be easier to implement, and would work better, if we had access to a negative supply voltage. But often that's not the case; so, in the spirit of real-world circuit design constraints (and as a useful learning exercise) we're slogging through the extra difficulties posed by single-supply JFET follower design. But if you do have a negative supply available, by all means use it!

#### F. Active load

The addition of a few components improves the source follower enormously. Work with us here, as we take it in stages (Figure 3.43).

First we replace the load resistor (called $R_{\mathrm{S}}$ in Figure 3.43A) with a (pull-down) current sink (circuit B). (You can think of this as the previous case, with infinite $R_{\mathrm{S}}$.) The constant source current makes $V_{\mathrm{GS}}$ approximately constant, thus reducing nonlinearities. A nice trick (circuit $\mathrm{B}^{\prime}$ ) has a BJT follower doing double duty, both providing low output impedance while sinking a (roughly) constant current of $V_{\mathrm{BE}} / R_{\mathrm{B}}$.

We still have the problem of unpredictable (and therefore nonzero) offset voltage (from input to output) of $V_{G S}$ (or $V_{\mathrm{GS}}+V_{\mathrm{BE}}$, for circuit $\mathrm{B}^{\prime}$ ). Of course, we could simply adjust $I_{\text {sink }}$ to the particular value of $I_{\mathrm{DSS}}$ for the given FET (in the first circuit) or adjust $R_{\mathrm{B}}$ (in the second). This is a poor solution for two reasons: (a) it requires individual adjustment for each FET; and (b) even so, $I_{\mathrm{D}}$ may vary by a factor of two over the normal operating temperature range for a given $V_{\mathrm{GS}}$.

A better circuit uses a matched FET pair to achieve zero offset (circuit C). $Q_{1}$ and $Q_{2}$ are a matched pair, on a single chip of silicon, for example the excellent LSK389 (see
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0192.jpg?height=1207&width=1683&top_left_y=177&top_left_x=235)

Figure 3.43. JFET unity-gain source followers - from simplest to best.

Table 3.7 on page 217), with $Q_{2}$ sinking a current of $I_{\mathrm{DSS}}$, i.e., its drain-current corresponding to $V_{\mathrm{GS}}=0$. But the JFETs are matched, so $V_{\mathrm{GS}}=0$ for both transistors: voilà, $Q_{1}$ is a follower with zero offset. Because $Q_{2}$ tracks $Q_{1}$ in temperature, the offset remains near zero, independent of temperature.

You usually see the preceding circuit with source resistors added (circuit D). A little thought should convince you that the upper resistor $R$ is necessary and that equal-value resistors guarantee that $V_{\text {out }}=V_{\text {in }}$ if $Q_{1}$ and $Q_{2}$ are matched. This circuit modification gives better $I_{\mathrm{D}}$ predictability, it allows you to set the drain current to some value less than $I_{\mathrm{DSS}}$, and the source degeneration gives improved linearity. The variation of circuit G lets you trim the (already small) residual offset voltage caused by imperfect matching of the $Q_{1} Q_{2}$ pair; the LSK389, for example, specifies a worstcase mismatch (at 1 mA drain current) of $\Delta V_{\mathrm{GS}}=20 \mathrm{mV} .^{49}$

Circuit E adds a BJT output follower $\left(Q_{3}\right)$, with a JFET

[^128]current sink pull-down $\left(Q_{5}\right)$. Transistor $Q_{4}$ adds a compensating $V_{\mathrm{BE}}$ in $Q_{2}$ 's source to maintain approximately zero dc offset from input to output.

Circuits A-D all share a problem, namely, the drain-tosource voltage across $Q_{1}$ varies directly with input signal. This can cause several undesirable effects. For example, imagine that circuit C is run between $\pm 10 \mathrm{~V}$ supply rails and that the input signal swings between +5 and -5 V .
the two JFETs, but in circuit D there is a $V_{\mathrm{DS}}$ mismatch that depends on the input signal voltage relative to the supply rails. To estimate the resulting offset voltage of the follower you need to know the JFETs' output conductance $\left(g_{\text {os }}\right)$, which causes an input-output offset in the follower that is proportional to the $V_{\mathrm{DS}}$ mismatch. That parameter is not specified on this JFET's datasheet, but from our measurements (see Table 3.7 on page 217 ) we know that $g_{\text {os }} \approx 100 \mu \mathrm{~S}$, which causes a follower offset of $\Delta V=\Delta V_{\mathrm{DS}} / G_{\max }$; here that amounts to $\approx 60 \mathrm{mV}$ for a 10 V difference in $V_{\mathrm{DS}}$, quite a bit larger than the 20 mV maximum untrimmed offset of the JFET pair (when the $V_{\mathrm{DS}}$ 's are balanced). The cure? Circuit H, a cascode in each JFET to hold each $V_{\text {DS }}$ constant. Thunderous applause, yet again, for the remarkable cascode.

At the positive signal peak, $Q_{1}$ has less than 5 V from drain to source, while $Q_{2}$ has more than 15 V . Because a FET's drain current (at fixed $V_{\mathrm{GS}}$ ) varies slightly with drain-to-source voltage (discussed in §§3.3.2 and $3 x .4$ ), consequences here are a departure from strict unity gain and (worse) a potential nonlinearity; another consequence is that the input gate current can rise dramatically at drain-to-source voltages greater than 5 V (see Figure 3.49 on page 164 ), seriously degrading the otherwise admirably low input current.

An excellent solution to these problems (and others!) is the cascode configuration, as in circuit $H$. Here we've added JFETs $Q_{6}$ and $Q_{7}$, which need not be matched, but which must be chosen to have a $V_{\mathrm{GS}}$ larger than the minimum desired $V_{\mathrm{DS}}$ of $Q_{1}$ and $Q_{2}$. The cascode transistors bootstrap $V_{\mathrm{DS}}$ of $Q_{1}$ and $Q_{2}$ to a voltage equal to the $V_{\mathrm{GS}}$ of $Q_{6}$ and $Q_{7}$ while passing through the drain currents. So $Q_{1}$ and $Q_{2}$ operate at constant (and low) $V_{\mathrm{DS}}$, with the cascode transistors taking up the slack as the signal swings, thus addressing both problems described in the preceding paragraph. The results are dramatic, as we'll see presently in a low-distortion "case study."

A further improvement on these JFET follower circuits is the addition of a pnp transconductance enhancer in $Q_{1}$ 's drain circuit (as in Figure 3.29, where the greatly increased transconductance rescues an otherwise mediocre amplifier stage); this is particularly helpful if the follower is to drive a relatively low load impedance. This is fleshed out in more detail in §3x.2.

JFETs can handle plenty of forward gate current, but they are easily damaged by reverse breakdown. When that possibility exists, it's a good idea to add gate protection, as in circuit F. The series resistor $R_{\text {prot }}$ limits current through the clamp diode $D$ (which should be a low-leakage part like the 1 N 3595 , if low input current is important). You can use the base-collector junction of an ordinary BJT, or the gate-channel diode of a JFET; see the plot of measured diode reverse leakage currents in §1x.7. But there's a compromise here: a large value of $R_{\text {prot }}$ safely limits the clamp current, but it introduces excessive Johnson (ther$\mathrm{mal})$ noise, a serious issue in low-noise applications. The use of a depletion-mode MOSFET current limiter solves this problem elegantly; see §5.15.4 for details.

Note that the JFETs in these examples can be replaced with depletion-mode MOSFETs, which are available with voltage ratings to 1000 V ; in that case it's necessary to protect the gate against both forward and reverse overvoltages greater than $\pm 20 \mathrm{~V}$.

In a further variation of these circuits, you can use the output signal to drive an inner "guard" shield in order to
effectively eliminate the effects of shielded-cable capacitance, which would otherwise be devastating for the high source impedances that you might see with this sort of high-impedance input buffer amplifier.

#### G. Case study: low-distortion JFET follower

To explore quantitatively the improvement you get with a current-sink pull-down, and further with a cascode arrangement, we wired up the three follower circuits in Figure 3.44, each with an LSK389 dual JFET; these correspond to circuits A, D, and H of Figure 3.43. To seriously challenge these circuits' linearity, we drove each with a clean 1 kHz sinewave, ${ }^{50}$ at signal amplitudes that pushed precariously close to the supply rails.

The simple resistor pull-down circuit (Figure 3.44A) exhibited an expected dc offset (about 0.25 V at the quiescent point), with measured distortion (Figure 3.45) going from $0.02 \%$ (at 1 Vrms ) to about $0.14 \%$ (at 5 Vrms ). That's pretty decent performance, especially given that this circuit is entirely open-loop (no feedback); it's better than we expected. The distortion was almost entirely second harmonic (i.e., at $2 f_{\text {in }}$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0193.jpg?height=631&width=835&top_left_y=1123&top_left_x=955)

Figure 3.44. Three candidates for the JFET follower low-distortion medal-of-honor.

Adding an LSK389 matched JFET current sink with source degeneration (Figure 3.44B) made a nice improvement: a dc offset of about 10 mV and a measured distortion reduced by a factor of ten $(20 \mathrm{~dB})$, with the distortion now almost entirely third harmonic ( $3 f_{\text {in }}$ ). We're in serious audiophile territory here. Finally, adding a cascode (the

[^129]J310's $V_{\mathrm{GS}}$ is much larger than that of $Q_{1}$, so that the latter runs at $V_{\mathrm{DS}} \approx 2 \mathrm{~V}$ ) improves the linearity by another 20 dB , bumping into the measurement floor of our modest apparatus. ${ }^{51}$ The low drain-to-source voltage across $Q_{1 \mathrm{a}}$ imposed by the cascode also ensures a low input gate current. ${ }^{52}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0194.jpg?height=470&width=759&top_left_y=454&top_left_x=243)

Figure 3.45. Measured distortion versus signal amplitude for the JFET followers of Figure 3.44, with $R_{\mathrm{L}}=1 \mathrm{M}$.

### 3.2.7 FETs as variable resistors

Figure 3.21 showed the region of JFET characteristic curves (drain current versus $V_{\mathrm{DS}}$ for a small family of $V_{\mathrm{GS}}$ voltages), both in the normal ("saturated") regime and in the "linear" region of small $V_{\mathrm{DS}}$. We showed the equivalent pair of graphs for a MOSFET at the beginning of the chapter (Figure 3.2). The $I_{D}$-versus- $V_{D S}$ curves are approximately straight lines for $V_{\mathrm{DS}}$ smaller than $V_{\mathrm{GS}}-V_{\mathrm{th}}$, and they extend in both directions through zero, i.e., the device can be used as a voltage-controlled resistor for small signals of either polarity. From our equation for $I_{D}$ versus $V_{G S}$ in the linear region (\$3.1.4, eq'n 3.1) we easily find the ratio $\left(I_{\mathrm{D}} / V_{\mathrm{DS}}\right)$ to be

$$
\begin{equation*}
\frac{1}{r_{\mathrm{DS}}}=2 \kappa\left[\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)-\frac{V_{\mathrm{DS}}}{2}\right] \tag{3.9}
\end{equation*}
$$

The last term represents a nonlinearity, i.e., a departure from resistive behavior (resistance shouldn't depend on signal voltage). However, for drain voltages substantially less than the amount by which the gate is above threshold ( $V_{\text {DS }} \rightarrow 0$ ), the last term becomes unimportant, and the FET behaves approximately like a resistance:

[^130]\$\$

$$
\begin{equation*}
r_{\mathrm{DS}} \approx 1 /\left[2 \kappa\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)\right] \tag{3.10}
\end{equation*}
$$

\$\$

Because the device-dependent parameter $\kappa$ isn't a quantity you are likely to know, it's more useful to write $r_{\mathrm{DS}}$ as

$$
\begin{equation*}
r_{\mathrm{DS}} \approx r_{\mathrm{G} 0}\left(V_{\mathrm{G} 0}-V_{\mathrm{th}}\right) /\left(V_{\mathrm{G}}-V_{\mathrm{th}}\right) \tag{3.11}
\end{equation*}
$$

where the resistance $r_{\mathrm{DS}}$ at any gate voltage $V_{\mathrm{G}}$ is written in terms of the (known) resistance $r_{\mathrm{G} 0}$ at some gate voltage $V_{\mathrm{G} 0}$.
Exercise 3.2. Derive the preceding "scaling" law.
From either formula you can see that the conductance $\left(=1 / r_{\mathrm{DS}}\right)$ is proportional to the amount by which the gate voltage exceeds threshold. Another useful fact is that $r_{\mathrm{DS}}=1 / g_{m}$, i.e., the channel resistance in the linear region is the inverse of the transconductance in the saturated region. This is a handy thing to know, because either $g_{m}$ or $r_{\mathrm{DS}}$ is a parameter nearly always specified on FET data sheets.

Exercise 3.3. Show that $r_{\mathrm{DS}}=1 / g_{m}$ by finding the transconductance from the saturation drain-current formula in §3.1.4.

Typically, the values of resistance you can produce with FETs vary from a few tens of ohms (as low as $0.001 \Omega$ for power MOSFETs) all the way up to an open circuit. A typical application might be an automatic-gain-control (AGC) circuit in which the gain of an amplifier is adjusted (by means of feedback) to keep the output within the linear range. In such an AGC circuit you must be careful to put the variable-resistance FET at a place in the circuit where the signal swing is small, preferably less than 200 mV or so.

The range of $V_{\mathrm{DS}}$ over which the FET behaves like a good resistor depends on the particular FET and is roughly proportional to the amount by which the gate voltage exceeds threshold. Typically you might see nonlinearities of about $2 \%$ for $V_{\mathrm{DS}}<0.1\left(V_{\mathrm{GS}}-V_{\text {th }}\right)$, and perhaps $10 \%$ nonlinearity for $V_{\mathrm{DS}} \approx 0.25\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)$. Matched FETs make it easy to design a ganged variable resistor to control several signals at once. You can also find some JFETs specifically intended for use as variable resistors (e.g., the InterFET 2N4338-41 series, and VCR series), with nominal ON-resistances specified at some $V_{\mathrm{GS}}$ (usually 0 V ).

#### A. Linearizing trick

It is possible to improve the linearity and, simultaneously, the range of $V_{\mathrm{DS}}$ over which a FET behaves like a resistor, by a simple compensation scheme. Look at the expression 3.9 for $1 / r_{\mathrm{DS}}$; you can see that the linearity will be nearly
perfect if you can add to the gate voltage a voltage equal to one half the drain-source voltage. Figure 3.46 shows two circuits to do exactly that.

In the first, the JFET forms the lower half of a resistive voltage divider, thus forming a voltage-controlled attenuator (or "volume control"). $R_{1}$ and $R_{2}$ improve the linearity by adding a voltage of $0.5 V_{\mathrm{DS}}$ to $V_{\mathrm{GS}}$, as just discussed. The JFETs shown have an ON-resistance (gate grounded) of $60 \Omega$ (max), giving the circuit an attenuation range of 0 to 40 dB . In the second circuit, the JFET's controllable resistance forms the lower leg of the gain-setting feedback divider in an op-amp noninverting voltage amplifier (the voltage gain is $G=\left[10 \mathrm{k} / R_{\mathrm{FET}}\right]+1$ ).

The linearization of $r_{\text {DS }}$ with a resistive gate-divider circuit, as above, is remarkably effective. In Figure 3.47 we've compared actual measured curves of $I_{\mathrm{D}}$ versus $V_{\mathrm{DS}}$ in the linear (low- $V_{\mathrm{DS}}$ ) region for FETs, both with and without the linearizing circuit. The linearizing circuit is essential for low-distortion applications with signal swings of more than a few millivolts. We used it for amplitude control in the oscillator circuit of Figure 7.22, where the JFET was combined with a series resistor to create a low-distortion gain trimmer; the measured distortion of just $0.0002 \%$.

When considering FETs for an application requiring a gain control, e.g., an AGC or "modulator" (in which the amplitude of a high-frequency signal is varied at an audio rate, say), it is worthwhile to look also at "analog-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0195.jpg?height=861&width=716&top_left_y=1383&top_left_x=221)

Figure 3.46. Linearizing the JFET variable resistor.
multiplier" ICs. These are high-accuracy devices with good dynamic range that are normally used to form the product of two voltages. One of the voltages can be a dc control signal, setting the multiplication factor of the device for the other input signal, i.e., the gain. Analog multipliers exploit the $g_{m}$-versus- $I_{\mathrm{C}}$ characteristic of bipolar transistors $\left[g_{m}=I_{\mathrm{C}}(\mathrm{mA}) / 25\right.$ siemens], in a configuration known as the "Gilbert cell," using matched arrays to circumvent problems of offsets and bias shifts. At very high frequencies ( 100 MHz and above), passive "balanced mixers" are often the best devices to accomplish the same task.

It is important to remember that a FET in conduction at low $V_{\mathrm{DS}}$ behaves like a good resistor all the way down to zero volts from drain to source (and even a bit beyond, in the opposite quadrant). There are no diode drops, sat-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0195.jpg?height=1218&width=859&top_left_y=906&top_left_x=943)

Figure 3.47. Measured curves of $I_{\mathrm{D}}$ versus $V_{\mathrm{DS}}$ for both (top) a JFET and (bottom) a MOSFET, showing the linearizing effect of a resistor pair (as in Figure 3.46). Note the relatively high current scale for the MOSFET.
uration voltages, or the like to worry about. We will see op-amps and digital logic families (CMOS) that take advantage of this nice property, giving outputs that saturate cleanly to the power supplies.

### 3.2.8 FET gate current

We said at the outset that FETs in general, and MOSFETs in particular, have essentially zero steady-state gate current. This is perhaps the most important property of FETs, and it was exploited in the high-impedance amplifiers and followers in the previous sections. It will prove essential, too, in applications to follow - most notably analog switches and digital logic.

Of course, at some level of scrutiny we might expect to see some gate current. It's important to know about gate current, because a naive zero-current model is guaranteed to get you in trouble sooner or later. In fact, finite gate current arises from several mechanisms. (a) Even in MOSFETs the silicon dioxide gate insulation is not perfect, leading to leakage currents in the picoampere range. (b) In JFETs the gate "insulation" is really a back-biased diode junction, with the same impurity and junction leakagecurrent mechanisms as ordinary diodes. (c) Furthermore, JFETs ( $n$-channel in particular) suffer from an additional effect known as "impact-ionization" gate current, which can reach astounding levels. (d) Finally - and most important for high-speed circuits - both JFETs and MOSFETs have dynamic gate current, caused by ac signals driving the gate capacitance; this can cause Miller effect, just as with bipolar transistors. ${ }^{53}$ We'll deal with this important topic later, in $\S \S 3.5$ and 3.5.4.

In most cases gate input currents are negligible in comparison with BJT base currents. However, there are situations in which a FET may actually have higher input current. Let's look at the numbers.

#### A. Gate leakage

The low-frequency input impedance of a FET amplifier (or follower) is limited by gate leakage. JFET datasheets usually specify a breakdown voltage, $B V_{\text {GSS }}$, defined as the voltage from gate to channel (source and drain connected together) at which the gate current reaches $1 \mu \mathrm{~A}$. For smaller applied gate-channel voltages, the gate leakage current, $I_{\mathrm{GSS}}$, again measured with the source and drain connected together, is considerably smaller, dropping

[^131]quickly to the picoampere range for gate-drain voltages well below breakdown. With MOSFETs you must never allow the gate insulation to break down; instead, gate leakage is specified as some maximum leakage current at a specified gate-channel voltage. Integrated circuit amplifiers with FETs (e.g., FET op-amps) use the misleading term "input bias current," $I_{\mathrm{B}}$, to specify input leakage current; it's usually in the picoampere range.

The good news is that these leakage currents are in the picoampere range at room temperature. The bad news is that they increase rapidly (in fact, exponentially) with temperature, roughly doubling every $10^{\circ} \mathrm{C}$. By contrast, BJT base current inn't leakage, it's bias current, and in fact tends to decrease slightly with increasing temperature. The comparison is shown graphically in Figure 3.48, a plot of input current versus temperature for several IC amplifiers (op-amps). The FET-input op-amps have the lowest input currents at room temperature (and below), but their input current rises rapidly with temperature, crossing over the curves for amplifiers with carefully designed BJT input stages like the LM10 and LT1012. These BJT op-amps, along with "premium" low-input-current JFET op-amps like the OPA111 and OPA627, are fairly expensive. However, we also included everyday "jellybean" op-amps like the bipolar LM358 and JFET LF411/2 in the figure to give
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0196.jpg?height=810&width=751&top_left_y=1309&top_left_x=1094)

Figure 3.48. The input current of a FET amplifier is gate leakage, which doubles every $10^{\circ} \mathrm{C}$. The FET-input amplifiers in this plot (solid lines) are easily spotted by their characteristic upward slope.
an idea of input currents you can expect with inexpensive (less than a dollar) op-amps.

#### B. JFET impact-ionization current

In addition to conventional gate leakage effects, $n$-channel JFETs suffer from rather large gate leakage currents when operated with substantial $V_{\mathrm{DS}}$ and $I_{\mathrm{D}}$ (the gate leakage specified on datasheets is measured under the unrealistic conditions that both $V_{\mathrm{DS}}=0$ and $I_{\mathrm{D}}=0$ !). Figure 3.49 shows what happens. The gate leakage current remains near the $I_{\mathrm{GSS}}$ value until you reach a critical drain-gate voltage, at which point it rises precipitously. This extra "impact-ionization" current is proportional to drain current, and it rises exponentially with voltage and temperature. The onset of this current occurs at drain-gate voltages of about $25 \%$ of $B V_{\mathrm{GSS}}$, and it can reach gate currents of a microamp or more. Obviously a "high-impedance buffer" with a microamp of input current is worthless. That's what you would get if you used a BF862 as a follower, running 1 mA of drain current from a 20 volt supply.

This extra gate leakage current afflicts primarily $n$ channel JFETs, and it occurs at higher values of draingate voltage. Some cures are to (a) operate at low draingate voltage, either with a low-voltage drain supply or with a cascode, (b) use a $p$-channel JFET, where the effect is much smaller, or (c) use a MOSFET. The most important thing is to be aware of the effect so that it doesn't catch you by surprise.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0197.jpg?height=550&width=776&top_left_y=1572&top_left_x=135)

Figure 3.49. JFET gate leakage increases disastrously at higher drain-gate voltages and is proportional to drain current, as seen in the datasheet curves for the otherwise excellent BF862 $n$-channel JFET.

#### C. Dynamic gate current

Gate leakage is a dc effect. Whatever is driving the gate must also supply an ac current, because of gate capacitance. Consider a common-source amplifier. Just as with bipolar transistors, you can have the simple effect of input capacitance to ground (called $C_{\text {iss }}$ ), and you can have the capacitance-multiplying Miller effect (which acts on the feedback capacitance $C_{\text {rss }}$ ). There are two reasons why capacitive effects are more serious in FETs than in bipolar transistors. First, you use FETs (rather than BJTs) because you want very low input current; thus the capacitive currents loom relatively larger for the same capacitance. Second, FETs often have considerably larger capacitance than equivalent bipolar transistors.

To appreciate the effect of capacitance, consider a FET amplifier intended for a signal source of 100 k source impedance. At dc there's no problem, because the picoampere currents produce only microvolt drops across the signal source's internal impedance. But at 1 MHz , say, an input capacitance of 5 pF presents a shunt impedance of about 30 k , seriously attenuating the signal. In fact, any amplifier is in trouble with a high-impedance signal at high frequencies, and the usual solution is to operate at low impedance ( $50 \Omega$ is typical) or use tuned $L C$ circuits to resonate away the parasitic capacitance. The point to understand is that the FET amplifier doesn't look like a $10^{12} \Omega$ load at signal frequencies.

As another example, imagine switching a 5 amp highvoltage load with a power MOSFET (there aren't any highpower JFETs), in the style of Figure 3.50. One might naively assume that the gate could be driven from a digital logic output with low current-sourcing capability, for example the so-called 4000-series CMOS logic, which can supply an output current of the order of 1 mA with a swing from ground to +10 V . In fact, such a circuit would be a disaster, because 1 mA of gate drive into the 200 pF average feedback capacitance of the IRF740 would stretch the output switching speed to a leisurely $50 \mu \mathrm{~s} .{ }^{54}$

Even worse, the dynamic gate currents $\left(I_{\text {gate }}=C d V_{\mathrm{D}} / d t\right)$ would force currents back into the logic device's output, possibly destroying it by means of a perverse effect known as "SCR latchup" (more of which in Chapters 10 and 11);

54 Our model is unacceptably crude, because feedback capacitance varies rapidly with drain voltage (see §3.5.4A). It's OK to use a constant value for feedback capacitance $C_{\text {rss }}$ for small-signal calculations; but for a switching application like this, you need to go to the datasheet for values of gate charge, which take into account the nonlinear behavior of the capacitances. In this example the datasheet specifies $Q_{\mathrm{G}} \approx 40 \mathrm{nC}$ of gate charge, producing a switching time of $t=Q_{\mathrm{G}} / i=40 \mu \mathrm{~s}$ at a (dynamic) drive current $i$ of 1 mA .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0198.jpg?height=289&width=598&top_left_y=218&top_left_x=323)

Figure 3.50. Dynamic gate current example: driving a fastswitching load.
for this and other reasons a series resistor (not shown in the figure) is usually added between the driving device and the MOSFET's gate. Bipolar power transistors have somewhat lower capacitances and therefore somewhat lower dynamic input currents (but still in the same ballpark); but when you design a circuit to drive a 5 amp power BJT, you're expecting to provide a few hundred milliamps or so of base drive (via a Darlington or whatever), whereas with a FET you tend to take for granted low input current. In this example in which you would have to supply a couple of amperes of gate drive current to bring about the 25 ns switching speed that the MOSFET is capable of - the ultra-high-impedance FET has lost some of its luster.

Exercise 3.4. Estimate the switching times for the circuit of Figure 3.50 , with 1 amp of gate drive current, assuming either (a) an average feedback capacitance of 200 pF , or (more accurately) (b) a required gate charge of 40 nC .

## 3.3 A closer look at JFETs

In §3.1.4 we introduced the landscape of FET operating regions: for drain voltages of a volt or more (to get beyond the "linear" resistive region) there is the conventional operating region in which the saturation drain current ${ }^{55} I_{\mathrm{D}}$ is proportional to $\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$ and (at much lower drain currents) the subthreshold region in which $I_{\mathrm{D}}$ is exponential in $V_{\text {GS }}$.

That's the simple picture. Because JFETs are the devices of choice for accurate or low-noise (or both) circuits with high input impedance, it's worth looking more closely at their idiosyncrasies, ideally with measurements of actual devices.

[^132]We've undertaken an exhaustive (and exhausting!) review of most of the available JFETs, collecting sample batches of each, often from multiple manufacturers. Table 3.7 on page 217 includes most of them, with some measured parameters ( $I_{\mathrm{DSS}}$, and $g_{\mathrm{os}}, g_{m}$, and $V_{\mathrm{GS}}$ at a useful drain current) alongside the datasheet specifications. ${ }^{56}$ See also Table 8.2 on page 516, which lists a nice selection of low-noise JFETs.

Advanced JFET topics are treated in Chapter $3 x$; here we discuss a few essential subjects - JFET operating regions (including the often neglected subthreshold region), JFET transconductance, and JFET capacitance.

### 3.3.1 Drain current versus gate voltage

A persistent issue with JFET circuit design is parameter spread. This is nicely illustrated in Figures 3.51 and 3.52, where we've plotted measured $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ for six samples of the 2N5457 $n$-channel JFET (three from each of two manufacturers ${ }^{57}$ ), and three samples of the related 2N5458 (from the same 2N5457-59 family). In each case we chose the parts with the highest, lowest, and median values of measured $I_{\mathrm{DSS}}$ in a batch of ten parts. For these measurements we ventured into positive gate voltages (up nearly to a diode drop, the onset of gate conduction), well beyond the usual zero-bias limit; nothing terrible happens, but in general this is a practice that should be avoided.

Let's look more closely at the data for these nine parts to understand different aspects of their performance and the impact on JFET circuit designs.

#### A. The quadratic region

The linear plot is what you usually see in datasheets and in textbooks. That scaling reveals well the quadratic behavior of drain current at a significant fraction of the zero-bias drain current ( $I_{\mathrm{DSs}}$ ), where JFETs are most often operated [eq'n 3.4]. You can see also the variation of $I_{\text {DSS }}$ among samples (the specified range for the half-dozen 2N5457 samples is indicated by a vertical bar), as well as the somewhat steeper slope for the Fairchild 2N5457 samples. The slope is, of course, just the transconductance gain, $g_{m}=$ $d I_{\mathrm{D}} / d V_{\mathrm{GS}}$, increasing linearly with $V_{\mathrm{GS}}$ [eq'n 3.5] in this regime of where the drain current is quadratic in $V_{\mathrm{GS}}-V_{\mathrm{th}}$.

[^133]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0199.jpg?height=1509&width=809&top_left_y=205&top_left_x=121)

Figure 3.51. Drain current versus gate voltage for nine parts from the 2N5457-9 $n$-channel JFET family, operating with $V_{\mathrm{DS}}=5 \mathrm{~V}$. The same data is plotted on linear, log, and square-root axes. The ON Semi and Fairchild parts both meet the $I_{\mathrm{DSS}}$ spec (middle panel) despite their substantially different curves. Note that the measurements extend beyond $I_{\mathrm{DSS}}$, to $V_{\mathrm{GS}}+0.6 \mathrm{~V}$.

#### Finding $V_{\text {th }}$ : square-root plot

Look next at the square-root plot, which gives the quadratic region a chance to stretch out its limbs. The extrapolation to zero drain current defines the threshold voltage $V_{\mathrm{th}}$. At that voltage the current is not zero - it's just down near the top of the subthreshold region.

#### B. The subthreshold region

Finally, the log plot greatly expands the low-current region. The curves bend over toward a straight-line (thus exponential) behavior at the lowest currents - this is the subthreshold region, which is explored six orders of magnitude more deeply in Figure 3.52.

#### C. The deep subthreshold region

From the extended curves in Figure 3.52 we can see that JFETs continue to do their stuff down to picoamp drain currents, conforming accurately to an exponential draincurrent law (analogous to the BJT's Ebers-Moll), which can be written as

$$
\begin{equation*}
I_{\mathrm{D}}=I_{0} \exp \left(V_{\mathrm{GS}} / n V_{\mathrm{T}}\right) \tag{3.12}
\end{equation*}
$$

with the same $V_{\mathrm{T}}=k T / q \approx 25 \mathrm{mV}$ as in Ebers-Moll (but with an added fudge factor $n$ ). The measured data in Figure 3.52 corresponds to a near-unity value for $n(n=1.05)$. In other words, at very low drain currents, a JFET has nearly the same transconductance as a BJT operating at that same collector current (as confirmed in the measured transconductance data of Figure 3.54 on page 168). ${ }^{58}$ Note that the Fairchild parts (in a gesture of egalitarian spirit) are no longer anomalous - unlike their behavior in the quadratic region (where they were the transconductance champs), at low currents they exhibit the same transconductance (slope) as the other parts.

### 3.3.2 Drain current versus drain-source voltage: output conductance

Drain current (at constant $V_{\mathrm{GS}}$ ) does have some dependence upon drain-to-source voltage, in contrast to the idealized picture that you usually see (and to the promulgation of which we are guilty parties: see §3.1.4 and Figure 3.13). You can think of this effect as analogous to Early effect in BJTs (§2x.8), or, equivalently, as a finite output impedance $r_{\mathrm{O}}$ (or, more commonly, finite output conductance $g_{\text {os }}=1 / r_{0}$ ) seen at the drain terminal when the gatesource voltage is held constant. This effect limits the maximum gain of a grounded-source amplifier configured with

[^134]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0200.jpg?height=858&width=1286&top_left_y=219&top_left_x=403)

Figure 3.52. Log plot of measured drain currents (dots) versus gate voltage for the same JFETs as in Figure 3.51. JFETs work fine at 10 pA , far below the arbitrary 10 nA drain current that conventionally defines the gate-source cutoff voltage $V_{\mathrm{GS} \text { (off) }}$.
a current source as drain load (that's the $G_{\text {max }}$ parameter in Table 3.1 on page 141), and you need to take it into account if your gain approaches $G_{\text {max }}$. It also further degrades the performance of a source follower (already degraded by low $g_{m} R_{\mathrm{L}}$; see §3.2.6) if $G_{\text {max }}$ is comparable to or less than $g_{m} R_{\mathrm{L}}$. These consequences are discussed in detail in Chapter $3 x$ ( $\S 3 x .4)$; but they are important enough to be worthy of mention here.

#### A. Degraded gain and linearity in the common-source amplifier

This " $g_{\text {os }}$ effect" limits the maximum gain of the common-source amplifier, by effectively putting a resistance $r_{0}=1 / g_{\text {os }}$ across the drain load impedance. For a simple resistive drain load $R_{\mathrm{D}}$ that reduces the gain from the ideal $G=g_{m} R_{\mathrm{D}}$ to $G=g_{m}\left(R_{\mathrm{D}} \| r_{\mathrm{o}}\right)$, or

$$
\begin{equation*}
G=g_{m} R_{\mathrm{D}} \frac{1}{1+g_{\text {os }} R_{\mathrm{D}}} \tag{3.13}
\end{equation*}
$$

A further unwelcome consequence is some nonlinearity, owing to the dependence of $g_{\text {os }}$ upon drain voltage. See $\S 3 x .4$ if you want to know more about this.

#### B. Gain error in the source follower

The " $g_{\text {os }}$ effect" also acts to reduce the gain of the source follower from the ideal $G=1$. This is most noticeable
with relatively light loads, where $R_{\mathrm{L}} \gg 1 / g_{m}$ (and therefore where you would expect the voltage gain to be very close to unity). Taking this effect into account, the voltage gain of the simple JFET follower of Figure 3.40 becomes

$$
\begin{equation*}
G=\frac{1}{1+\frac{1}{g_{m} R_{\mathrm{L}}}+\frac{1}{G_{\max }}} \tag{3.14}
\end{equation*}
$$

where $G_{\text {max }}$ is the ratio of drain conductance to transconductance ( $G_{\text {max }}=g_{o s} / g_{m}$ ) at the operating voltage and current. (We defined $G_{\text {max }}$ because it's roughly constant with current ${ }^{59}$ and therefore more useful than the currentdependent $r_{\mathrm{O}}$ and $g_{\mathrm{os}}$ ). Thus, for example, you need both $g_{m} R_{\mathrm{L}}$ and $G_{\text {max }}$ greater than 100 for $<1 \%$ gain error or you need to use some tricks, such as an active load, a cascode connection, or a " $g_{m}$ enhancer." Looking back to the tutorial source follower progression in Figure 3.43, that is the reason for the use of an active load and a cascode connection in circuit H. Table 3.1 lists measured values of $G_{\text {max }}$ for common JFETs. For further enlightenment read the exposé in $\S 3 x .4$.

[^135]
### 3.3.3 Transconductance versus drain current

Recall that transconductance $\left(g_{m} \equiv i_{\mathrm{d}} / v_{\mathrm{gs}}\right.$, the change of drain current with gate-to-source voltage) is the natural measure of FET gain. It is analogous to the Ebers-Moll view of bipolar transistors, where $g_{m}=q I_{\mathrm{C}} / k T=I_{\mathrm{C}} / V_{\mathrm{T}}$. Generally speaking, at any given drain current an FET will have lower transconductance than a BJT. Starting at the lowest drain currents (recall §3.3.1 and Figure 3.52), the transconductance in the FET subthreshold region is proportional to drain current (like a BJT), but somewhat less than a BJT operating at the same current; see Figure 3.53. If you write $g_{m}=I_{\mathrm{D}} / n V_{\mathrm{T}}$, typical JFETs have $n$ values in the range of 1.05 to 3 , as can be seen in the measured data of Figure 3.54 (and similar expanded plots in Chapter $3 x$, see §3x.2).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0201.jpg?height=534&width=808&top_left_y=909&top_left_x=119)

Figure 3.53. Transconductance versus drain current: in the subthreshold region an FET's transconductance is proportional to current (like a BJT); at normal currents where $I_{\mathrm{D}} \propto\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$ it goes like $\sqrt{I_{\mathrm{D}}}$; then at still higher operating currents it flattens toward a maximum.

At higher currents, in the FET's "quadratic region" of drain current where $I_{\mathrm{D}} \propto\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$, the transconductance becomes proportional to the square root of drain current, falling away below the BJT's increasing ( $\propto I_{\mathrm{C}}$ ) transconductance. At still higher currents the transconductance flattens further. For JFETs the story ends here; but for MOSFETs (where you can bring the gate voltage high enough to reach constant maximum drain current), the transconductance heads back down, for example with the LND150 whose $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ curve is plotted in Figure 3.9.

It's not hard to measure transconductance directly - see §3x. 3 for circuit details of one simple method (where the secret sauce is a cascode stage to clamp the drain voltage). We used that circuit to measure the transconductance of
some sixty JFETs, at drain currents going from $1 \mu \mathrm{~A}$ to 30 mA in half-decade steps.

Figure 3.54 shows measured transconductance versus drain current, for a few representative JFETs. ${ }^{60}$ At higher currents the transconductance is approximately proportional to the square root of drain current (thus proportional to $V_{\mathrm{GS}}-V_{\mathrm{th}}$ ). And, even though these curves go down "only" to $1 \mu \mathrm{~A}$, most of the JFETs (the four upper curves) are already well into the sub-threshold region (with transconductance proportional to drain current) down at that current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0201.jpg?height=613&width=807&top_left_y=691&top_left_x=966)

Figure 3.54. Measured low-frequency transconductance for some representative $n$-channel JFETs. See also the analogous plot in §3x.2.

So, what's going on with the PN4117-19? Well, these are very small JFETs (you can tell by their very low $I_{\mathrm{DSs}}$ values), so even at a drain current of $1 \mu \mathrm{~A}$ the current density is high enough to bring them over into their quadratic region. Put another way, in the preceding discussion we should have been referring to "current density" (rather than simple drain current) as the measure of whether a given JFET is in its subthreshold region or its quadratic region.

Note that this holds also for MOSFETs: a large power MOSFET (with drain current ratings in the hundreds of amps) will be running in its subthreshold region if used in a linear circuit application. ${ }^{61}$ As we'll see in §3.6.3, this has an important effect on thermal stability when multiple MOSFETs are connected in parallel in power applications, because in the subthreshold region MOSFETs have a positive thermal coefficient of drain current with temperature;

[^136]this can cause serious mischief when not fully appreciated by the circuit designer.

#### A. Transconductance within a JFET family

From Figure 3.54 and the preceding discussion it would appear that you cannot really predict a JFET's transconductance at any given operating current; that graph shows a 50:1 variation of $g_{m}$ at a given current. Worse still, the data of Figure 3.51 suggests that you cannot even predict with any reasonable certainty the operating current of a given JFET part type for a given gate bias (or vice-versa).

As it turns out, the situation is not so bleak. Within a family (or extended family) of similar JFETs the transconductance depends primarily (and predictably) upon drain current, even though the corresponding gate voltage may be all over the map. Take a look at Figure 3.55, which shows measured drain current curves for a varied selection of seven 2N5486 JFETs (manufactured over a period of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0202.jpg?height=937&width=802&top_left_y=1021&top_left_x=216)

Figure 3.55. Measured drain current versus gate-source voltage for a collection of seven 2N5486 JFETs of varying vintages and manufacturers (along with three smaller JFET types, indicated with dashed lines), plotted on both log and square-root axes, illustrating the wide spread of threshold voltages $V_{\text {th }}$ (the straight-line extrapolation of the latter's curves). Compare the large spread seen here with Figure 3.56, where the same set of JFETs exhibit only minor variations in transconductance at any given drain current.

35 years ${ }^{62}$ ), along with a sample of lower-current siblings (2N5484 and 2N5485) and a related cousin (SST4416, also featured for RF applications, and with similar low capacitance and comparable range of $I_{\mathrm{DSS}}$ ).

These measured curves exhibit a wide variation of behavior for this selection of parts (there's a 3:1 spread of $V_{\mathrm{GS}(\mathrm{off})}$, and a $5: 1$ spread of $I_{\mathrm{DSS}}$ ), suggesting a similar unpredictability of transconductance gain. ${ }^{63}$ But that suggestion would be misleading. When you measure their transconductances, you get the curves of Figure 3.56: within this deliberately varied selection of ten related parts there's at most a $\pm 20 \%$ peak variation of transconductance at a given drain current.

The moral: within a JFET family of similar part types, the drain current (at whatever gate voltage is needed to get that current) is reasonably predictive of the transconductance. And the practical consequence is that a JFET amplifier circuit will have reasonably predictable gain if it is arranged with bias feedback to set the drain current to a desired value (which should be chosen no greater than the specified minimum IDSs, unless you are willing to sort your incoming parts).

But a piece of advice: for better gain predictability in JFET amplifiers it's a good idea (a) to use some source degeneration (§3x.4), preferably in combination with a
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0202.jpg?height=593&width=772&top_left_y=1303&top_left_x=1086)

Figure 3.56. Measured transconductance versus drain current for the same set of JFETs as in Figure 3.55.

[^137]transconductance-boosting enhancer circuit, or (b) to use overall feedback with enough minimum loop gain (with worst-case $g_{m}$ ) to ensure the gain accuracy you need (as in Figures 3.31, 3.34, and 3.37).

### 3.3.4 Transconductance versus drain voltage

The transconductance of a FET at a given drain current is relatively independent of drain voltage, except for drain-tosource voltages below a volt or two. This contrasts with its strong dependence on drain current. See the discussion in Chapter $3 x$ ( $\S 3 x .2$, with measured data).

### 3.3.5 JFET capacitance

Just as with bipolar transistors (and, later, MOSFETs), the capacitance seen between the terminals of a JFET depends on the (reverse) bias; this is often called a "nonlinear capacitance" and decreases markedly with increasing reversebias. Figure 3.57 shows datasheet plots of feedback and input capacitances for two common $n$-channel JFETs. These values - just a few picofarads - are typical of small-signal JFETs and quite a bit smaller than you see in power MOSFETs (compare with Figure 3.100 on page 197). JFETs are usually symmetrical, but owing to the larger reverse bias, the gate-drain capacitance is smaller than the gate-source capacitance. ${ }^{64}$ That's a good thing, of course, because the Miller effect multiplies the effect of $C_{\text {rss }}$ in a commonsource amplifier without cascode.

Manufacturers generally provide plots of capacitance versus $V_{\mathrm{GS}}$, and sometimes also versus $V_{\mathrm{DS}}$ or $V_{\mathrm{DG}}$. But you get only one set of plots for a family of parts, even though their $I_{\mathrm{DSS}}$ specs may range over a factor of ten or more; one is left wondering if their capacitances are correlated with their $I_{\text {DSs }}$ values, thus suggesting that capacitance data should be considered only a rough guide to reality.

### 3.3.6 Why JFET (versus MOSFET) amplifiers?

We've devoted considerable space in this chapter to junction FETs (JFETs), a topic that often receives minimal discussion in standard references, in which the emphasis is on insulated-gate FETs (i.e., MOSFETs). We'll soon shift the focus toward the latter, for good reasons: small integrated MOSFETs are dominant in (a) low-voltage and low-power analog circuits (op-amps, portable electronics, RF circuits,

[^138]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0203.jpg?height=427&width=807&top_left_y=210&top_left_x=964)

Figure 3.57. Input and feedback capacitance of JFETs.
and the like); (b) analog switching; (c) logic circuits, microprocessors, and memory; and, in the form of discrete packaged power transistors, (d) power switching and linear power applications. These are all hot topics in contemporary electronics, and MOSFETs are the dominant species of transistor on the planet, by a huge margin.

Before moving on, though, it is worth emphasizing that JFETs are the device of choice for analog circuits that demand a combination of high input impedance, low noise, and good accuracy; this in addition to their niche applications as two-terminal current sources, voltage-variable resistors, and constant- $R_{\mathrm{ON}}$ analog switches.

The previous examples of amplifiers, followers, and current sources illustrate many of the JFET's virtues. Going beyond this first look at JFETs, Chapter $3 x$ includes some advanced material, and Chapter 8 discusses the important topic of noise, complete with measured data. To get a preview of the latter, look at Figure 3.58, where we've plotted the measured noise voltage density of three favorite "jellybeans": the 2N3904 npn bipolar transistor, the 2N5457
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0203.jpg?height=547&width=802&top_left_y=1647&top_left_x=974)

Figure 3.58. Noise voltage of three popular jellybeans, illustrating the poor low-frequency noise properties of MOSFETs.

JFET and the 2N7000 MOSFET. These parts make no pretense of premium membership; they cost a pittance, ${ }^{65}$ and they're not aimed at low-noise applications. But they illustrate an important trend: MOSFETs are inherently noisy at low frequencies, by as much as 40 dB relative to their BJT and JFET cousins. ${ }^{66}$ Don't use them for low-level audio applications - but power MOSFETS can be used for the muscular output stage of an audio amplifier.

## 3.4 FET switches

The two examples of FET circuits that we gave at the beginning of the chapter were both switches: a logicswitching application and a linear signal-switching circuit. These are among the most important FET applications, and they exploit the FET's unique characteristics: high gate impedance and bipolarity resistive conduction clear down to zero volts. In practice you usually use MOSFET integrated circuits (rather than discrete transistors ${ }^{67}$ ) in all digital logic and linear-switch applications, and it is only in power switching applications that you ordinarily resort to discrete FETs. Even so, it is essential (and fun!) to understand the workings of these chips; otherwise you're almost guaranteed to fall prey to some mysterious circuit pathology.

### 3.4.1 FET analog switches

A common use of FETs, particularly MOSFETs, is as analog switches. Their combination of low ON-resistance (all the way to zero volts), extremely high OFF resistance, low leakage currents, and low capacitance makes them ideal as voltage-controlled switch elements for analog signals. An ideal analog, or linear, switch behaves like a perfect mechanical switch: in the ON state it passes a signal through to a load without attenuation or nonlinearity; in the OFF state it is an open circuit. It should have negligible capacitance to ground and negligible coupling from the signal applied to the control input.

Let's look at an example (Figure 3.59). $Q_{1}$ is an $n$ channel enhancement-mode MOSFET, and it is nonconducting when the gate is grounded or negative. In that state the drain-source resistance ( $R_{\text {off }}$ ) is typically more

[^139]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0204.jpg?height=290&width=541&top_left_y=215&top_left_x=1199)

Figure 3.59. nMOS analog switch, with body terminal and diode shown.
than $10,000 \mathrm{M}$, and no signal gets through (though at high frequencies there will be some coupling through drainsource capacitance; more on this later). Bringing the gate to +15 V puts the drain-source channel into conduction, typically $20-200 \Omega$ in FETs intended for use as analog switches. The gate signal level is not at all critical, as long as it is sufficiently more positive than the largest signal (to maintain $R_{\mathrm{ON}}$ low), and it could be provided from digital logic circuitry (perhaps using a FET or BJT to generate a full-supply swing) or even from an op-amp running from a +15 V supply. Swinging the gate negative (as from a bipolarity op-amp output) doesn't hurt, and in fact has the added advantage of allowing the switching of analog signals of either polarity, as will be described later. Note that the FET switch is a bidirectional device; signals can go either way through it. Ordinary mechanical switches work that way, too, so it should be easy to understand.

The circuit as shown will work for positive signals up to about 10 V ; for larger signals the gate drive is insufficient to hold the FET in conduction ( $R_{\text {ON }}$ begins to rise), and negative signals would cause the FET to turn on with the gate grounded (it would also forward-bias the channelbody junction). If you want to switch signals that are of both polarities (e.g., signals in the range -10 V to +10 V ), you can use the same circuit, but with the gate driven from -15 V (OFF) to +15 V (ON); the body terminal should then be tied to -15 V .

With any FET switch it is important to provide a load resistance in the range of 1 k to 100 k in order to reduce capacitive feedthrough of the input signal that would otherwise occur during the off state. The value of the load resistance is a compromise: low values reduce feedthrough, but they begin to attenuate the input signal because of the voltage divider formed by $R_{\mathrm{ON}}$ and the load. Because $R_{\mathrm{ON}}$ varies over the input signal swing (from changing $V_{\mathrm{GS}}$ ), this attenuation also produces some undesirable nonlinearity. Excessively low load resistance appears at the switch input, of course, loading the signal source as well. Several possible solutions to this problem (multiple-stage switches, $R_{\mathrm{ON}}$
cancellation) are shown in §3.4.2 and in the discussion of rail-to-rail op-amps in Chapter $4 x$. An attractive alternative is to use a second FET switch section to connect the output to ground when the series FET is off, thus effectively forming a single-pole double throw (SPDT) switch (more on this in the next section).

#### A. CMOS linear switches

Frequently it is necessary to switch signals that may go nearly to the supply voltages. In that case the simple $n$ channel switch circuit just described won't work, because the gate is not forward-biased at the peak of the signal swing. The solution is to use paralleled complementary MOSFET (CMOS) switches (Figure 3.60). The triangular symbol is a digital inverter, which we'll discuss shortly; it inverts a HIGH input to a Low output, and vice versa. When the control input is high, $Q_{1}$ is held on for signals from ground to within a few volts of $+V_{\mathrm{DD}}$ (where $R_{\mathrm{ON}}$ starts increasing dramatically). $Q_{2}$ is likewise held ON (by its grounded gate) for signals from $+V_{D D}$ to within a few volts of ground (where its $R_{\mathrm{ON}}$ increases dramatically). Thus signals anywhere between $+V_{\mathrm{DD}}$ and ground are passed through with low series resistance (Figure 3.61). Bringing the control signal to ground turns off both FETs, providing an open circuit. The result is an analog switch for signals all the way from ground to $+V_{\mathrm{DD}}$. This is the basic construction of the classic 4066 CMOS "transmission gate." It is bidirectional, like the switches described earlier: either terminal can be the input.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0205.jpg?height=308&width=513&top_left_y=1448&top_left_x=264)

Figure 3.60. CMOS analog switch.
There is a variety of integrated circuit CMOS analog switches available, with different operating voltage ranges and with various switch configurations (e.g., several independent sections with several poles each). Going back to the prehistoric, there's the classic CD4066 "analog transmission gate," which belongs to the original 4000 series of digital CMOS logic and that acts as an analog switch for signals between ground and a single positive supply. ${ }^{68}$

[^140]More commonly, though, you'll choose a dedicated analog switch IC, for example a member of the industry-standard DG211 family. These parts (and their many variations; see Table 3.3 on page 176) are particularly convenient to use: they accept logic-level ( $0 \mathrm{~V}=$ LOW, $>2.4 \mathrm{~V}=\mathrm{HIGH}$ ) control signals, they will handle analog signals to $\pm 15 \mathrm{~V}$ (compared with only $\pm 7.5 \mathrm{~V}$ for the 4000 series), they come in a variety of configurations, and they have relatively low ON resistance ( $25 \Omega$ or less for some members of these families, and down to a fraction of an ohm for lower voltage switches). Analog Devices, Intersil, Maxim, VishaySiliconix, and other manufacturers offer a nice range of analog switches.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0205.jpg?height=348&width=443&top_left_y=818&top_left_x=1151)

Figure 3.61. ON-resistance of the CMOS analog switch.

#### B. JFET analog switches

Although most available analog switches are built with a pair of paralleled MOSFETs of complementary polarities - the CMOS architecture just described - it is possible to build analog switches with JFETs, and there are some advantages.

The basic circuit (Figure 3.62) uses a single $n$-channel $\mathrm{JFET}, Q_{1}$, as the analog switch. Its conduction is controlled by a transistor switch, $Q_{2}$, which pulls the gate down to a large negative voltage ( -15 V , say) to cut off conduction in the JFET (switch OFF). Shutting off $Q_{2}$ lets the gate float to the source voltage, putting the (depletion-mode) JFET into full conduction (switch ON). The gate resistor $R_{1}$ is made deliberately large so that the output signal line does not see significant loading in the OFF state; its value is a compromise, because a larger resistance incurs a longer turn-on delay. With a low-impedance signal source (e.g., the output of an op-amp) it may be preferable to put the resistor on the input side (i.e., feed the signal in from the right).

Because there is only a single $n$-channel JFET, this switch cannot accept input signals all the way to the negative supply: signal voltages that come closer to the negative
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0206.jpg?height=343&width=351&top_left_y=221&top_left_x=447)

Figure 3.62. JFET analog switch.
supply than the FET's $V_{\mathrm{GS}(\text { off })}$ will bring it back into conduction. ${ }^{69}$ There is no such limitation at the positive end.

A nice feature of this JFET analog switch is the constancy of $R_{\text {ON }}$ with signal level: because the gate stays at the source voltage, there is no variation of $R_{\text {ON }}$ with signal voltage; the JFET does not even know that the signal is varying! This nice characteristic is on display in Figure 3.63, which compares a plot of $R_{\text {ON }}$ versus $V_{\text {sig }}$ for a JFET analog switch (SW06) with that of the DG211 CMOS switch. ${ }^{70}$

In practice it's inconvenient to have to drive the switch control with a signal near the negative supply rail (and dou-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0206.jpg?height=545&width=800&top_left_y=1207&top_left_x=220)

Figure 3.63. Contrasted with a CMOS analog switch like the DG211 (solid curves, shown for different supply voltages), the JFET analog switch maintains admirably flat $R_{\mathrm{ON}}$ over signal level.

[^141]bly so for CMOS switches). Instead, you would probably use a level-shifting circuit so a logic-level input that goes between 0 V and +3 V , say, would activate the switch. Figure 3.64 shows a simple way to do that, using comparators with "open-collector" outputs ( $\$ 12.3$ ) to drive the gates of discrete JFET switches. For integrated analog switches, this sort of control signal circuitry is ordinarily built in. The SW06 JFET analog switch (and the nearly extinct DG180189 family from Vishay-Siliconix) includes such drivers, along with some other elegant tricks. ${ }^{71}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0206.jpg?height=580&width=802&top_left_y=659&top_left_x=1068)

Figure 3.64. A comparator with open collector outputs, powered from +5 V and -18 V , converts a 0 -to- 3 V logic-level input into a JFET gate drive that swings to -18 V . This method is used in some of Agilent's digital multimeters (see "Designs by the Masters," 13.8.6) to accommodate analog signals over a full $\pm 12 \mathrm{~V}$ range. The added diodes allow a control signal to drive more than one JFET switch.

JFET analog switches are inherently more rugged than their CMOS cousins, for which performance-degrading protection circuits are required for robustness against overvoltage faults. They do suffer from high charge injection, however (see §3.4.2E). Despite their nice features, integrated JFET switches and multiplexers (see next subsection) are almost extinct, with fine examples like the SW-01, SW-7510, and MUX-08 series from Precision Monolithics (now Analog Devices) gone forever (but happily the SW06 lives on!).

#### C. Multiplexers

A nice application of FET analog switches is the "multiplexer" (or MUX), a circuit that allows you to select any of several inputs, as specified by a digital control signal.

[^142]The analog signal present on the selected input will be passed through to the (single) output. Figure 3.65 shows the basic scheme. Each of the switches SW0 through SW3 is a CMOS analog switch. The "select logic" decodes the address and enables (jargon for "turns on") the addressed switch only, disabling the remaining switches. Such a multiplexer is usually used in conjunction with digital circuitry that generates the appropriate addresses (lots more in Chapters 10 and 11). A typical situation might involve a data-acquisition instrument in which a number of analog input voltages must be sampled in turn, converted to digital quantities, and used as input to some computation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0207.jpg?height=529&width=608&top_left_y=751&top_left_x=219)

Figure 3.65. Analog multiplexer.

Because analog switches are bidirectional, an analog multiplexer such as this is also a "demultiplexer": a signal can be fed into the "output" and will appear on the selected "input." When we discuss digital circuitry in Chapters 10 and 11 , you will see that an analog multiplexer such as this can also be used as a "digital multiplexer-demultiplexer," because logic levels are, after all, nothing but voltages that happen to be interpreted as binary 1 s and 0 s .

Typical of analog multiplexers are the industry-standard DG408-09 and DG508-09 series (and their many improved versions), 8 - or 16 -input MUX circuits that accept logic-level address inputs and operate with analog voltages up to $\pm 15 \mathrm{~V}$. The 4051-4053 devices in the CMOS digital family are analog multiplexers-demultiplexers with up to 8 inputs, but with 15 Vpp maximum signal levels; they have a $V_{\text {EE }}$ pin (and internal level shifting) so that you can use them with bipolarity analog signals and unipolarity (logiclevel) control signals. We are especially fond of the lowvoltage ' 4053 series, with three SPDT switches. Our interest is evidently shared by others, with a large number of interesting parts available - see Table 13.7 (4053-style SPDT Switches) on page 917.

#### D. Other analog switch applications

Voltage-controlled analog switches form essential building blocks for some of the op-amp circuits we'll see in the next chapter - integrators, sample-and-hold circuits, and peak detectors. For example, with op-amps we will be able to build a "true" integrator (unlike the approximation to an integrator we saw in §1.4.4): a constant input generates a linear ramp output (not an exponential), etc. With such an integrator you must have a method to reset the output; a FET switch across the integrating capacitor does the trick. We won't try to describe these applications here. Because op-amps form essential parts of the circuits, they fit naturally into the next chapter. Great things to look forward to!

### 3.4.2 Limitations of FET switches

Analog switches aren't perfect - they have nonzero resistance when ON, and nonzero leakage when OFF, as well as capacitive feedthrough and charge injection during changes in switch state. You can see some of the variety in Table 3.3 on page 176). Let's take a look at these limitations.

#### A. Voltage range and latchup

Analog switches and multiplexers come in three broad voltage ranges: (a) "standard" parts (which might better be called "high-voltage"), which handle signals over the full traditional op-amp voltage range of $\pm 15 \mathrm{~V}$; (b) reducedvoltage parts ("midvoltage") that can handle $\pm 7.5 \mathrm{~V}$ (or 0 to +15 V ) signals; and (c) low-voltage parts intended for applications in which the signal swing does not exceed $\pm 3 \mathrm{~V}$ (or 0 to +6 V ). In all cases, analog switches operate properly (and with specified $R_{\mathrm{ON}}$ ) with input signals that go all the way to the positive and negative supply voltages (with the exception of JFET switches like the SW06, for which the operating signal voltage range does not reach the positive supply).

However, input signals beyond the supply rails are another story. All CMOS integrated circuits have some form of input protection circuit, because otherwise the gate insulation is easily destroyed (see $\S 3.5 .4 \mathrm{H}$ on handling precautions). The usual protection network is shown in Figure 3.66. Although it may use distributed diodes, the network is equivalent to clamping diodes to $V_{\mathrm{SS}}$ and to $V_{\mathrm{DD}}$, combined with resistive current limiting. If you drive the inputs (or outputs) more than a diode drop beyond the supply voltages, the diode clamps go into conduction, making the inputs (or outputs) look like a low impedance to the respective supplies. Worse still, the chip can be driven into "SCR latchup," a terrifying (and destructive)
condition we'll describe in more detail in §10.8. For now, all you need to know about it is that you don't want it! SCR latchup is triggered by input currents (through the protection network) of roughly 20 mA or more. Thus you must be careful not to drive the analog inputs as much as a diode drop beyond the rails. ${ }^{72}$ This means, for instance, that for most parts you must be sure the power supply voltages are applied before any signals that have significant drivecurrent capability; alternatively, you can use series diodes in the supply lines, so that input signals applied before the dc power do not produce input current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0208.jpg?height=294&width=746&top_left_y=695&top_left_x=247)

Figure 3.66. CMOS input-output protection networks. The series resistor at the output is often omitted.

The trouble with diode-resistor protection networks is that they compromise switch performance by increasing $R_{\mathrm{ON}}$, shunt capacitance, and leakage. A different approach makes use of "dielectric isolation" to eliminate SCR latchup without the serious performance compromises inherent in traditional protection networks. Both methods result in a "protected" (or fault-protected) analog switch, in which you may safely overdrive the inputs without damage. Note, however, that the output does not follow the input beyond the rails. ${ }^{73}$

For example, the MAX4508 multiplexer adds fault protection to the standard DG508A 8-input analog multiplexer, making it tolerant to $\pm 30 \mathrm{~V}$ input swings; it has

[^143]an $R_{\mathrm{ON}(\mathrm{typ})}$ of $300 \Omega$. The AD7510DI-series of "Protected Analog Switches" from Analog Devices uses dielectric isolation to achieve input signal fault protection to $\pm 25 \mathrm{~V}$ beyond the power supplies, while maintaining a respectable $75 \Omega R_{\mathrm{ON}(\mathrm{typ})}$ in the normal operating signal range. Watch out, though - fault protection is the exception in the analog switch arena, and most analog switch ICs are not forgiving!

Maxim offers a nice outboard solution that you can put in front of an unprotected switch (or any other analog component), in the form of its multichannel "signal-line protector" ICs (the three- and eight-channel MAX4506-07). ${ }^{74}$ These accept input signal swings to $\pm 36 \mathrm{~V}$ (whether powered or unpowered), are free of latchup regardless of power sequencing, and they pass through signals that are properly within the supply limits while clamping their outputs to the supply rails (which can be $\pm 8 \mathrm{~V}$ to $\pm 18 \mathrm{~V}$ split supplies, or $\mathrm{a}+9$ to +36 V single supply) when there's an input beyond the rails. They even have the grace to open-circuit the input when thus overdriven - see Figure 3.67. The price you pay (above their literal $\$ 4$ and $\$ 6$ cost, respectively) is an ONresistance in the range of $50-100 \Omega$ (depending as usual on total supply voltage) and an input capacitance of 20 pF (thus a rolloff at $\sim 100 \mathrm{MHz}$ ).

#### B. ON-resistance

CMOS switches operated from a relatively high supply voltage ( $\pm 15 \mathrm{~V}$, say) will have low $R_{\mathrm{ON}}$ over the entire signal swing, because one or the other of the transmission FETs will have a forward gate bias of at least half the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0208.jpg?height=465&width=585&top_left_y=1431&top_left_x=1177)

Figure 3.67. Maxim's MAX4506-7 fault-protected "Signal-Line Protectors" prevent signal swings beyond the rails, both clamping the output and disconnecting the input when overdriven. The series analog switches are normally ON, but both are switched OFF if $V_{\text {IN }}$ goes beyond either rail, controlled by logic shown in the more complete MAX4508 datasheet.

[^144]Table 3.3 Analog Switches
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0209.jpg?height=1661&width=1580&top_left_y=241&top_left_x=118)

Notes: (a) listed within categories by decreasing Ron; all are CMOS except SW06; parts in bold italic are widely used "jellybeans." (b) numerals represent quantity of each switch type in a single package; letters refer to explanatory footnotes for successively numbered parts. (c) $V_{\text {neg }}$ at least $-15 \mathrm{~V}, V_{\text {pos }}$ at least +40 V , total no more than 200 V . (d) T=TTL thresholds; $\mathrm{V}_{\mathrm{L}}=e x t e r n a l$ logic threshold supply; V+="CMOS" threshold, depends on positive analog supply voltage. (e) $\mathrm{P}=$ parallel logic inputs; $\mathrm{I}=\mathrm{I}^{2} \mathrm{C}$ serial; $\mathrm{S}=\mathrm{SPI}$ serial. (g) 50 mV glitch. (h) 0.1 dB to $14 \mathrm{MHz},-95 \mathrm{~dB}$ xtalk at $20 \mathrm{KHz} \& R_{\mathrm{L}}=10 \mathrm{k}, \mathrm{THD}+\mathrm{N}=0.014 \%\left(R_{\mathrm{L}}=1 \mathrm{k}, f=1 \mathrm{kHz}\right.$ ). ( k ) second $\mathrm{p} / \mathrm{n}$ is make-before-break. ( m ) min or max. ( n ) higher $\mathrm{p} / \mathrm{n}$ is $\approx 50 \%$ more. (o) switch OFF. (s) SC-70. (u) SPDT are break-before-make unless noted otherwise. (v) $84=8: 1$ \& dual 4:1; 842=8:1, dual 4:1, \& triple 2:1. all dual 4:1 have single 2-bit address. (w) $4 x N C, 4 x N O, 2$ each. (x) $2 x N O, 2 x N C$, 1 each. (y) 4xNO, 2 each. (z) $4 x N O, 4 x N O, 2$ each.
Comments: (1) Supertex HV2203. (2) 1 pA typ. (3) 3 pA typ; $I_{\mathrm{s}}=10 \mu \mathrm{~A}$ typ. MAX308-09 is similar. (4) $8 \mathrm{kV} \mathrm{HBM} E S D$. (5) $0.4 \Omega @ \mathrm{~V}_{\mathrm{S}}=+3 \mathrm{~V}$; 400mA; -3dB/50@@18MHz. (6) low Ron, e.g. speaker switch. (7) -3dB @350MHz, -90 dB xtalk@10MHz. (8) 250 MHz ; ext gain set. (9) -3 dB at $4 \mathrm{GHz},-30 \mathrm{~dB}$ xtalk at 4 GHz . (10) clickless.
supply voltage. However, when operated with lower supply voltages, the switch's $R_{\mathrm{ON}}$ value will rise, the maximum occurring when the signal is about halfway between the supply and ground (or halfway between the supplies, for dual-supply voltages). Figure 3.68 shows why. As $V_{\mathrm{DD}}$ is reduced, the FETs begin to have significantly higher ON-resistance (especially near $V_{\mathrm{GS}}=V_{\mathrm{DD}} / 2$ ), because enhancement-mode FETs can have a $V_{\mathrm{GS}(\mathrm{th})}$ of at least a few volts, and a gate-source voltage of as much as 5 to 10 volts may be required to achieve low $R_{\mathrm{ON}}$. Not only will the parallel resistances of the two FETs rise for signal voltages between the supply voltage and ground, but also the peak resistance (at half $V_{\mathrm{DD}}$ ) will rise as $V_{\mathrm{DD}}$ is reduced, and for sufficiently low $V_{\mathrm{DD}}$ the switch will become an open circuit for signals near $V_{\mathrm{DD}} / 2$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0210.jpg?height=345&width=468&top_left_y=876&top_left_x=386)

Figure 3.68. CMOS analog switch $R_{\mathrm{ON}}$ increases at low supply voltage.

There are various tricks used by the designers of analog switch ICs to keep $R_{\text {ON }}$ low and approximately constant (for low distortion) over the signal swing. For example, the original 4016 analog switch used the simple circuit of Figure 3.60 , producing $R_{\mathrm{ON}}$ curves that look like those in Figure 3.69. In the improved 4066 switch, the designers added a few extra FETs so that the $n$-channel body voltage follows the signal voltage, producing the $R_{\mathrm{ON}}$ curves of Figure 3.70. The "volcano" shape, with its depressed central
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0210.jpg?height=458&width=683&top_left_y=1776&top_left_x=281)

Figure 3.69. ON-resistance for 4016 CMOS switch.
$R_{\text {ON }}$, replaces the "Everest" shape of the 4016. Improved switches, like the industry standard DG408-09, intended for serious analog applications, succeed even better, with low and flat $R_{\text {ON }}$ curves that deviate less than $10 \%$ or so over the signal voltage range. This is often achieved at the expense of increased "charge transfer" (see the later section on glitches).

Looking through manufacturers' selection tables for analog switches, you'll find standard-voltage units with $R_{\text {ON }}$ as low as several ohms and flatness to a few tenths of an ohm; low-voltage switches can be found with $R_{\text {ON }}$ as low as $0.25 \Omega$, and flatness of $0.03 \Omega$. This static performance comes at a real cost though, namely, high capacitance and high charge injection (see discussion below, and Table 3.3 on the preceding page). If your application requires low distortion into moderate load impedances, the better approach may be to choose a switch with excellent "ON-resistance flatness" spec ( $\left.R_{\mathrm{FLAT}(\mathrm{ON})}\right)$, and accept a higher overall $R_{\mathrm{ON}}$ with its lower capacitance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0210.jpg?height=473&width=697&top_left_y=1024&top_left_x=1121)

Figure 3.70. ON-resistance for the improved 4066 CMOS switch; note change of scale from previous figure.

Keep in mind, too, that in some cases you can finesse the problem altogether with a different choice of circuit configuration, as in Figure 3.71, which shows three approaches to a circuit that selects one of two input signals. Circuit A's gain is $R_{2} /\left(R_{1}+R_{\mathrm{ON}}\right)$, so a variation of $R_{\mathrm{ON}}$ with signal amplitude produces changes of gain, and thus nonlinearity. Circuit B is better, because the switch output is held at ground by feedback around the op-amp; but the ONresistance still reduces the gain somewhat, degrading the circuit's precision. Circuit C is blissfully unaware of $R_{\mathrm{ON}}$, owing to the op-amp's very high input impedance; it's the most linear and precise of all.

This lesson can be applied to other circuit configurations as well. As an example, take a look at Figure 3.84 on page 183, where an analog multiplexer is used to select an amplifier's overall voltage gain. In the circuit of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0211.jpg?height=817&width=741&top_left_y=219&top_left_x=201)

Figure 3.71. Finessing $R_{\text {ON }}$ variation in analog switches: three ways to select between a pair of input signals, with an op-amp to buffer the output.

Figure 3.84A the multiplexer's $R_{\mathrm{ON}}$ is in series with the selected resistor, and represents an error term (both in gain and nonlinearity); by contrast, in the circuit of Figure 3.84B the switch's $R_{\mathrm{ON}}$ is irrelevant, owing to the opamp's essentially infinite ( $>10^{12} \Omega$ ) input impedance.

Another trick exploits the use of two identical (or closely-similar) JFET switches to largely cancel the effects of $R_{\mathrm{ON}}$. See Chapter $4 x$ 's section "JFET linear switch with $R_{\text {ON }}$ compensation" for an explanation and illustration of this elegant technique.

#### C. Speed

High-voltage FET analog switches have ON-resistances $R_{\text {ON }}$ generally in the range of 20 to $200 \Omega .{ }^{75}$ In combination with substrate and stray capacitances, this resistance forms a lowpass filter that limits operating speeds to frequencies of the order of 10 MHz or less (Figure 3.72). FETs with lower $R_{\mathrm{ON}}$ tend to have larger capacitances (up to 50 pF or more), so no gain in speed results (unless the designer has made other design tradeoffs). Much of the rolloff is due to protection components - current-limiting series resistance and capacitance of shunt diodes.

[^145]However, low-voltage analog switches do better in terms of bandwidth (as is usually the case with smallergeometry semiconductors): a contemporary $\pm 2.5 \mathrm{~V}$ ana$\log$ switch like the popular ADG719 has $2.5 \Omega$ of $\mathrm{ON}-$ resistance, 27 pF of capacitance, and 400 MHz bandwidth. There is also a class of analog switches and multiplexers targeted specifically at video and RF applications. These include both passive ("unbuffered") MUX/switches, and MUX/switches combined with an amplifier ("active" or "buffered"). Active MUX/switches operate on +5 V or $\pm 5 \mathrm{~V}$ supplies and have fixed voltage gains of either $\times 1$ or $\times 2$ (the latter are intended for driving a $50 \Omega$ or $75 \Omega$ transmission line through a series matching resistor, which attenuates the output by a factor of 2 ); in some cases you set the gain with an external resistor pair. An example of the latter is the AD8174 4-input multiplexer, with a bandwidth of 270 MHz at gains of +1 or +2 (at higher gains the bandwidth drops, e.g., to 55 MHz at $G=+10$ ).

For specialized applications you can get some really fast analog switches, for example the ADG918-19 listed in Table 3.3 on page 176 , which is usable to 2 GHz (it's down 3 dB at 4 GHz ). Parts like these are used in wireless applications, for example, to switch between two signal sources in "diversity reception" or to route gigahertz signals through a choice of filter paths. To reduce crosstalk, these wideband switches usually employ a T-switch topology (see Figure 3.77 in the next subsection).

$$
C_{\text {in }}=5 \mathrm{pF} \overbrace{\text { input }}^{R_{\mathrm{ON}}=300 \Omega} \mathrm{C}_{\mathrm{out}}=22 \mathrm{pF} \quad f_{3 \mathrm{~dB}} \approx \frac{1}{2 \pi R_{\mathrm{ON}} C_{\mathrm{out}}}=24 \mathrm{MHz}
$$

Figure 3.72. The parasitic $R C$ 's of a CMOS switch limit the analog signal bandwidth.

#### D. Capacitance

FET switches exhibit capacitance from input to output $\left(C_{\mathrm{DS}}\right)$, from channel to ground $\left(C_{\mathrm{D}}, C_{\mathrm{S}}\right)$, from gate to channel, and from one FET to another within one IC package $\left(C_{\mathrm{DD}}, C_{\mathrm{SS}}\right)$; see Figure 3.73. Let's look at the effects.

#### $C_{\mathrm{DS}}$ : capacitance from input to output

Capacitance from input to output causes signal coupling in an OFF switch, rising at high frequencies. Figure 3.74 shows the effect for the popular DG211 and DG411 series. Note the characterization with a $50 \Omega$ load, common in RF circuits, but much lower than normal for low-frequency signals, for which a typical load impedance is 10 k or more. Even with a $50 \Omega$ load, the feedthrough becomes
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0212.jpg?height=513&width=713&top_left_y=218&top_left_x=261)

Figure 3.73. Capacitances between isolated sections of the AD7510 quad analog switch cause signal crosstalk.
significant at high frequencies ( 1 pF has a reactance of 5 k at 30 MHz , giving -40 dB of feedthrough). And, of course, there is significant attenuation (and nonlinearity) driving a $50 \Omega$ load, because for these parts $R_{\mathrm{ON}}$ is typically $45 \Omega$ and $17 \Omega$, respectively. With a 10 k load the feedthrough situation is much worse, of course.

Exercise 3.5. Calculate the feedthrough into 10 k at 1 MHz , assuming $C_{\mathrm{DS}}=1 \mathrm{pF}$.

In most low-frequency applications capacitive feedthrough is not a problem. If it is, the best solution is to use a pair of cascaded switches (Figure 3.75) or, better still, a combination of series and shunt switches, enabled alternately (Figure 3.76). The series cascade doubles the attenuation (in decibels) at the expense of additional $R_{\mathrm{ON}}$, whereas the series-shunt circuit (effectively an SPDT configuration) reduces feedthrough by dropping the effective load resistance to $R_{\mathrm{ON}}$ when the series switch
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0212.jpg?height=480&width=802&top_left_y=1668&top_left_x=219)

Figure 3.74. High-frequency feedthrough in analog switches. There is less feedthrough with a low load resistance and less still with a "T-switch" configuration.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0212.jpg?height=230&width=592&top_left_y=219&top_left_x=1181)

Figure 3.75. Cascaded analog switches for reduced feedthrough.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0212.jpg?height=287&width=555&top_left_y=563&top_left_x=1197)

Figure 3.76. SPDT analog switch configuration for reduced feedthrough.
is off. Some commercial analog switches are built with a T-network of three switches (Figure 3.77) to achieve low feedthrough for signals going in either direction; from the outside you can't even tell that they've used this trick, except by noticing the excellent isolation specifications as in Figure 3.74 (unless, of course, they brag about it on the datasheet).

Exercise 3.6. Recalculate switch feedthrough into 10 k at 1 MHz , assuming $C_{\mathrm{DS}}=1 \mathrm{pF}$ and $R_{\mathrm{ON}}=50 \Omega$, for the configuration of Figure 3.76 .

Most CMOS SPDT switches have controlled break-before-make (BBM) characteristics so that the signal sources are not momentarily connected during switching. In some cases, however, you need the reverse, i.e., make-before-break (MBB), for example in a gain-selecting feedback circuit like Figure 3.84B. To deal with this, some CMOS switches are available in both flavors, for example the ADG619 and ADG620 (BBM and MBB, respectively, as noted in Table 3.3).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0212.jpg?height=322&width=473&top_left_y=1875&top_left_x=1238)

Figure 3.77. A T-switch further reduces high-frequency feedthrough.

#### $C_{\mathrm{D}}, C_{\mathrm{S}}$ : capacitance to ground

Shunt capacitance to ground leads to the high-frequency rolloff mentioned earlier. The situation is worst with a high-impedance signal source, but even with a stiff source the switch's $R_{\mathrm{ON}}$ combines with the shunt capacitance at the output to make a lowpass filter. The following problem shows how it goes.

Exercise 3.7. An AD7510 (here chosen for its complete capacitance specifications, shown in Figure 3.73) is driven by a signal source of 10 k , with a load impedance of 100 k at the switch's output. Where is the high-frequency -3 dB point? Now repeat the calculation, assuming a perfectly stiff signal source and a switch $R_{\mathrm{ON}}$ of 75 ohms.

#### Capacitance from gate to channel

Capacitance from the controlling gate to the channel causes a different effect, namely, the coupling of nasty little transients into your signal when the switch is turned on or off. This subject is worth some serious discussion, so we'll defer it to the next section on glitches.

#### $C_{\mathrm{DD}}, C_{\mathrm{SS}}$ : capacitance between switches

If you package several switches on a single piece of silicon the size of a grain of rice, it shouldn't surprise you if there is some coupling between channels ("crosstalk"). The culprit, of course, is cross-channel capacitance. The effect increases with frequency and with signal impedance in the channel to which the signal is coupled. Here's a chance to work it out for yourself.

Exercise 3.8. Calculate the coupling, in decibels, between a pair of channels with $C_{\mathrm{DD}}=C_{\mathrm{SS}}=0.5 \mathrm{pF}$ (Figure 3.73) for the source and load impedances of the previous exercise. Assume that the interfering signal is 1 MHz . In each case calculate the coupling for (a) OFF switch to OFF switch, (b) OFF switch to ON switch, (c) ON switch to OFF switch, and (d) ON switch to ON switch.

It should be obvious from this example why most broadband RF circuits use low signal impedances, usually $50 \Omega$. If crosstalk is a serious problem, don't put more than one signal on one chip.

#### E. Glitches and charge injection

During turn-on and turn-off transients, FET analog switches can do nasty things. The control signal being applied to the gate(s) can couple capacitively to the channel(s), putting ugly transients on your signal. The situation is most serious if the signal is at high impedance levels. Multiplexers can show similar behavior during transitions of the input address as well as a momentary connection between inputs if the turn-off delay exceeds the turn-on delay
(i.e., MBB). A related bad habit is the propensity of some switches (e.g., the 4066) to short the input to ground momentarily during changes of state.

Let's look at this problem in a bit more detail. Figure 3.78 shows a typical waveform you might see at the output of an $n$-channel MOSFET analog switch circuit, similar to Figure 3.59, with an input signal level of zero volts and an output load consisting of 10k in parallel with 20 pF , realistic values for an analog switch circuit. The handsome transients are caused by charge transferred to the channel, through the gate-channel capacitance, at the transitions of the gate. The gate makes a sudden step from one supply voltage to the other, in this case between $\pm 15 \mathrm{~V}$ supplies, transferring a slug of charge

$$
Q=C_{\mathrm{GC}}\left[V_{\mathrm{G}}(\text { finish })-V_{\mathrm{G}}(\text { start })\right]
$$

Here, $C_{\mathrm{GC}}$ is the gate-channel capacitance, typically around 5 pF . Note that the amount of charge transferred to the channel ("charge injection") depends only on the total voltage change at the gate, not on its rise time. Slowing down the gate signal gives rise to a smaller-amplitude glitch of longer duration, with the same total area under its graph. Lowpass filtering of the switch's output signal has the same effect. Such measures may help if the peak amplitude of the glitch must be kept small, but in general they are ineffective in eliminating gate feedthrough. In some cases the gatechannel capacitance may be predictable enough for you to cancel the spikes by coupling an inverted version of the gate signal through a small adjustable capacitor.

The gate-channel capacitance is distributed over the length of the channel, which means that some of the charge is coupled back to the switch's input. As a result, the size of the output glitch depends on the signal-source impedance and is smallest when the switch is driven by a voltage source. Of course, reducing the size of the load impedance will reduce the size of the glitch, but this also loads the source and introduces error and nonlinearity because of finite $R_{\mathrm{ON}}$. Finally, all other things being equal, a switch with smaller gate-channel capacitance will introduce smaller
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0213.jpg?height=284&width=526&top_left_y=1914&top_left_x=1112)

Figure 3.78. Charge-transfer glitches, on a greatly expanded scale.
switching transients, although you pay a price in the form of increased $R_{\mathrm{ON}}$.

Figure 3.79 shows an interesting comparison of gateinduced charge transfers for a collection of analog switches, including JFETs. For the CMOS switches the internal gate signals are making a full rail-to-rail swing (e.g., $\Delta V=30 \mathrm{~V}$ for switches running from $\pm 15 \mathrm{~V}$ ); for the JFET switch the gate swings from -15 V to the signal voltage. The JFET switch shows a strong dependence of glitch size on signal, because the gate swing is proportional to the level of the signal above -15 V . Well-balanced CMOS switches have relatively low feedthrough because the charge contributions of the complementary MOSFETs tend to cancel out (one gate is rising while the other is falling). Just to give scale to these figures, it should be pointed out that 30 pC corresponds to a 3 mV step across a $0.01 \mu \mathrm{~F}$ capacitor. That's a rather large filter capacitor, and you can see that this is a real problem, since a 3 mV glitch is pretty large when dealing with low-level analog signals.

In Figure 3.80 we've plotted, on an expanded scale, the charge injection scene for a selection of analog switches that exhibit particularly low charge injections. Switches optimized for low charge injection will usually brag about it on the datasheet's headline. For example, the Analog
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0214.jpg?height=881&width=807&top_left_y=1315&top_left_x=219)

Figure 3.79. Charge transfer for various FET linear switches as a function of signal voltage, taken from the respective datasheets.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0214.jpg?height=945&width=805&top_left_y=219&top_left_x=1072)

Figure 3.80. Need an analog switch with low charge injection? Here are some candidates, plotted on a greatly expanded scale. The three dotted curves are for the DG4051 with $\pm 5 \mathrm{~V},+5 \mathrm{~V}$, and +3 V supplies. Check the datasheet for analogous plots for the DG4053 triple SPDT switch.

Devices ADG1221-series datasheet shouts, in bold letters, "Low Capacitance, Low Charge Injection, $\pm 15$ V/+12 V $i$ CMOS $^{\circledR}$ Dual SPST Switches"; quite a mouthful, but quite a switch!

As might be expected, switches with lower ONresistance generally exhibit greater charge injection. Figure 3.81 shows this trend, in a scatterplot of datasheet values of $Q_{\mathrm{inj}}$ versus $R_{\mathrm{ON}}$ for the low-voltage CMOS analog switches currently offered by Analog Devices.

#### F. Other switch limitations

Some additional characteristics of analog switches that may or may not be important in any given application are switching time, settling time, BBM delay, channel leakage current (both ON and OFF), device quiescent current, input current during overvoltage, $R_{\mathrm{ON}}$ matching among multiple channels, and temperature coefficient of $R_{\mathrm{ON}}$. We'll show unusual restraint by ending the discussion at this point, leaving the reader to look into these details when the circuit application demands it.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0215.jpg?height=493&width=753&top_left_y=218&top_left_x=144)

Figure 3.81. Scatterplot of specified charge injection versus ONresistance for Analog Devices' low-voltage analog switches, illustrating the $R_{\mathrm{ON}}$ versus $Q_{\mathrm{inj}}$ tradeoff.

### 3.4.3 Some FET analog switch examples

As we indicated earlier, many of the natural applications of FET analog switches are in op-amp circuits, which we treat in the next chapter. In this section we show a few switch applications that do not require op-amps, to give a feeling for the sorts of circuits you can use them in.

#### A. Switchable RC lowpass filter

Figure 3.82 shows how you could make a simple $R C$ lowpass filter with selectable 3 dB points. We've used a multiplexer to select one of four preset resistors, using a 2 bit (digital) address. We chose to put the switch at the input, rather than after the resistors, because there is less charge injection at a point of lower signal impedance. Another possibility, of course, is to use FET switches to select the capacitor. To generate a very wide range of time constants you might have to do that, but the switch's finite $R_{\text {ON }}$ would limit attenuation at high frequencies, to a maximum of $R_{\mathrm{ON}} / R_{\text {series }}$. We've also indicated a unity-gain buffer, following the filter, since the output impedance is high. You'll see how to make "perfect" followers (precise gain, high $Z_{\text {in }}$, low $Z_{\text {out }}$, and no $V_{\mathrm{BE}}$ offsets, etc.) in the next chapter. Of course, if the amplifier that follows the filter has high input impedance, you don't need the buffer.

Figure 3.83 shows a simple variation in which we've used four independent switches, rather than a 4 -input multiplexer. With the resistors scaled as shown, you can generate 16 equally spaced 3 dB frequencies by turning on binary combinations of the switches. ${ }^{76}$

[^146]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0215.jpg?height=364&width=711&top_left_y=221&top_left_x=1017)

Figure 3.82. Analog-MUX selectable $R C$ lowpass filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0215.jpg?height=409&width=575&top_left_y=688&top_left_x=1085)

Figure 3.83. $R C$ lowpass filter with choice of 15 equally spaced cutoff frequencies.

Exercise 3.9. What are the 3 dB frequencies for this circuit? Estimate the gain-switching glitch amplitude, assuming a charge injection specification of 20 pC , distributed equally to the input and output switch terminals, and a signal source of low impedance.

#### B. Switchable gain amplifier

Figure 3.84 shows how you can apply the same idea of switching resistors to produce an amplifier of selectable gain. Although this idea is a natural for op-amps, we can use it with the emitter-degenerated amplifier. We used a constant-current sink as emitter load to permit gains much less than unity. We then used the multiplexer to select one of four emitter resistors. Note the blocking capacitor, needed to keep the quiescent current independent of gain.

In Circuit A the switch's $R_{\mathrm{ON}}$ value is part of the gain equation. By contrast, in Circuit B the switch selects a voltage-divider tap and presents it to a high impedance opamp input, so the switch's $R_{\mathrm{ON}}$ doesn't affect the gain accuracy. Other (more complex) examples of this approach are found in Figures 5.59, 5.62, and 5.80.
$f_{3 \mathrm{~dB}}=1 / 2 \pi R_{p} C=G_{p} / 2 \pi C$. Then it's easy, because the conductance of resistors in parallel is the sum of their individual conductances. So for this circuit $f_{3 \mathrm{~dB}}=n G_{80 k} / 2 \pi C=199 n \mathrm{~Hz}$, where $G_{80 \mathrm{k}}=12.5 \mu \mathrm{~S}$, $C=10 \mathrm{nF}$, and $n$ is the integer [1..15] represented by the selected switches $A_{n}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0216.jpg?height=636&width=1242&top_left_y=218&top_left_x=428)

Figure 3.84. A. An analog multiplexer selects appropriate emitter degeneration resistors to achieve decade-switchable gain. B. A similar technique, but with the versatile "op-amp" building block (the hero of Chapter 4).

#### C. Sample-and-hold

Figure 3.85 shows how to make a "sample-and-hold" (S/H) circuit, which comes in handy when you want to convert an analog signal to a stream of digital quantities ("analog-todigital conversion") - you've got to hold each analog level steady while you figure out how big it is. The circuit is simple: a unity-gain input buffer generates a low-impedance copy of the input signal, forcing it across a small capacitor. To hold the analog level at any moment, you simply open the switch. The high input impedance of the second buffer (which should have FET input transistors to keep input current near zero) prevents loading of the capacitor, so it holds its voltage until the FET switch is again closed.

Exercise 3.10. The input buffer must supply current to keep the capacitor following a varying signal. Calculate the buffer's peak
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0216.jpg?height=488&width=733&top_left_y=1746&top_left_x=256)

Figure 3.85. Sample-and-hold.
output current when the circuit is driven by an input sinewave of 1 V amplitude at 10 kHz .

You can do considerably better by closing a feedback loop around the S/H circuit; take a look at §4.5.2. Better still, buy a complete integrated circuit S/H (e.g., the AD783 has an internal hold capacitor, settles to $0.01 \%$ in $0.25 \mu \mathrm{~s}$, and droops less than $0.02 \mu \mathrm{~V} / \mu \mathrm{s}$ ) - let someone else do the hard work!

#### D. Flying-capacitor voltage converter

Here's a nice way (Figure 3.86) to generate a needed negative power-supply voltage in a circuit that is powered by a single positive supply. The pair of FET switches on the left connects $C_{1}$ across the positive supply, charging it to $V_{\text {in }}$, while the switches on the right are kept open. ${ }^{77}$ Then the input switches are opened, and the switches on the right are closed, connecting charged $C_{1}$ across the output, transferring some of its charge onto $C_{2}$. The switches are diabolically arranged so that $C_{1}$ gets turned upside down, generating a negative output! This particular circuit, often referred to as a charge-pump dc-dc converter, originated as the Intersil 7660 voltage converter chip, and is widely available in improved variants, including voltage-doubling versions and regulated versions. You find them, also, as built-in portions of larger integrated circuits that require dual supply

[^147]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0217.jpg?height=445&width=761&top_left_y=221&top_left_x=140)

Figure 3.86. Flying-capacitor voltage inverter.
voltages, for example RS-232C serial-port drivers. We'll visit these devices in more detail in §9.6.3.

#### E. Digital potentiometer

It's nice to be able to turn a pot electrically - for example, to adjust the volume control of a television set by the remote control "clicker." This kind of application is common, and the semiconductor industry has responded with a variety of electrically settable pots, known variously as EEPOT, $E^{2}$ POT, or just plain digital pot. A digital pot consists of a long resistor chain, with an array of FET switches that connects the selected tap to the output pin (Figure 3.87); the tap is selected by a digital input (Chapters 10 and onward). ${ }^{78}$ Digital pots come in single, dual, and multiple units; many have "nonvolatile" memory, to retain the position of the pot after power has been turned off. Some have nonlinear taps, for example for audio volume controls, for which it's best to have equal step sizes in decibels (that is, each step produces the same fractional increase in voltage-divider ratio). Note that, whatever the configuration, the switch's $R_{\mathrm{ON}}$ appears as a series resistance at the output ("wiper") pin.

As an example, the Analog Devices website lists some 50 digital potentiometers, with from 32 to 1024 steps ( 256 step models seem to be the most popular), and with one to six channels (singles and duals seem most popular); they use a serial data connection (only two or three pins are needed, regardless of the length of the control data), and they average about $\$ 1$ (1000-piece quantity). The selection from Maxim/Dallas includes linear and log taper units (the term taper predates digital pots and refers to the resistance versus shaft rotation characteristic of a pot; the log taper is

[^148]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0217.jpg?height=384&width=795&top_left_y=221&top_left_x=975)

Figure 3.87. An IC "digital potentiometer." Internal digital logic turns on one of the $n$ analog switches to select a tap along the chain of $n-1$ fixed resistors.
for audio applications), again in single and multiple units, and with up to 1024 steps per unit. And at the bottom of Intersil's selection table, after all the usual digital pots, you'll even find digital capacitors! ${ }^{79}$

### 3.4.4 MOSFET logic switches

The other kinds of FET switch applications are logic and power switching circuits. The distinction is simple: in analog signal switching you use a FET as a series switch, passing or blocking a signal that has some range of analog voltage. The analog signal is usually a low-level signal at insignificant power levels. In logic switching, on the other hand, MOSFET switches open and close to generate full swings between the power supply voltages. The "signals" here are really digital, rather than analog - they swing between the power supply voltages, representing the two states HIGH and Low. In-between voltages are not useful or desirable; in fact, they're not even legal! Finally, "power switching" refers to turning on or off the power to a load such as a lamp, relay coil, or motor winding; in these applications, both voltages and currents tend to be large. We'll take logic switching first.

Figure 3.88 shows the simplest kind of logic switching with MOSFETs: both circuits use a resistor as load and perform the logical function of inversion - a HIGH input generates a Low output, and vice versa. The $n$-channel version pulls the output to ground when the gate goes HIGH, whereas the $p$-channel version pulls the resistor HIGH for grounded (LOW) input. Note that the MOSFETs in these circuits are used as common-source inverters rather than as source followers. In digital logic circuits like these, we are usually interested in the output voltage ("logic level") produced by a certain input voltage; the resistor serves merely

[^149]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0218.jpg?height=330&width=622&top_left_y=216&top_left_x=344)

Figure 3.88. nMOS and pMOS logic inverters, with resistive "pullups".
as a passive drain load, to make the output swing to the drain supply when the FET is off. If, on the other hand, we replace the resistor with a lightbulb, relay, print-head hammer, or some other hefty load, we've got a power-switching application (Figure 3.3). Although we're using the same "inverter" circuit, in the power-switching application we're interested instead in turning the load on and off.

#### A. CMOS inverter

The nMOS and pMOS inverters of the preceding circuits have the disadvantage of drawing current in the on state and having relatively high output impedance in the OFF state. You can reduce the output impedance (by reducing $R$ ), but only at the expense of increased dissipation, and vice versa. Except for current sources, of course, it's never a good idea to have high output impedance. Even if the intended load is high impedance (another MOSFET gate, for example), you are inviting capacitive noise pickup problems, and you will suffer reduced switching speeds for the ON-to-OFF ("trailing") edge (because of stray loading capacitance). In this case, for example, the nMOS inverter with a compromise value of drain resistor, say 10 k , would produce the waveform shown in Figure 3.89.

The situation is reminiscent of the single-ended emitter follower in §2.4.1, in which quiescent power dissipation and power delivered to the load were involved in a similar compromise. The solution there - the push-pull configuration - is particularly well suited to MOSFET switching. Look at Figure 3.90, which you might think of as a pushpull switch: input at ground cuts off the bottom transistor and turns on the top transistor, pulling the output HIGH. A HIGH input ( $+V_{\mathrm{DD}}$ ) does the reverse, pulling the output to ground. It's an inverter with low output impedance in both states, and no quiescent current whatsoever. It's called a CMOS (complementary MOS) inverter, and it is the basic structure of all digital CMOS logic, the logic family that has become universal in large and very-large scale integrated circuits (LSI, VLSI), and has largely replaced earlier logic families (with names like transistor-transistor logic,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0218.jpg?height=716&width=573&top_left_y=218&top_left_x=1183)

Figure 3.89. High off-impedance in the nMOS inverter causes long rise times and susceptibility to capacitively-coupled noise.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0218.jpg?height=285&width=453&top_left_y=1082&top_left_x=1243)

Figure 3.90. CMOS logic inverter and circuit symbol.
TTL) based on bipolar transistors. Note that the CMOS inverter is two complementary MOSFET switches in series, alternately enabled, whereas the CMOS analog switch (treated earlier in the chapter) is two complementary MOSFET switches in parallel, enabled simultaneously.

Exercise 3.11. The complementary MOS transistors in the CMOS inverter are both operating as common-source inverters, whereas the complementary bipolar transistors in the push-pull circuits of §2.4.1 (e.g., Figure 2.69) are (noninverting) emitter followers. Try drawing a "complementary BJT inverter" analogous to the CMOS inverter. Why won't it work?

#### B. CMOS gates

We'll be seeing much more of digital CMOS in the chapters on digital logic and microprocessors (Chapters 1014). For now, it should be evident that CMOS is a lowpower logic family (with zero quiescent power) with highimpedance inputs, and with stiff outputs that swing the full supply range. Before leaving the subject, however, we can't resist the temptation to show you one additional CMOS
circuit (Figure 3.91). This is a logic NAND gate, whose output goes Low only if input A and input B are both High. The operation is surprisingly easy to understand: if A and B are both HIGH, series nMOS switches $Q_{1}$ and $Q_{2}$ are both on, pulling the output stiffly to ground; pMOS switches $Q_{3}$ and $Q_{4}$ cooperate by being ofF; thus, no current flows. However, if either A or B (or both) is Low, the corresponding pMOS transistor is ON, pulling the output HIGH; since one (or both) of the series chain $Q_{1} Q_{2}$ is OFF, no current flows.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0219.jpg?height=381&width=699&top_left_y=654&top_left_x=171)

Figure 3.91. CMOS NAND gate and circuit symbol.
This is called a NAND gate because it performs the logical AND function, but with inverted ("NOT") output - it's a NOT-AND, abbreviated NAND. Although gates and their variants are properly a subject for Chapter 10 , you will enjoy trying your hand at the following problems.

Exercise 3.12. Draw a CMOS AND gate. Hint: AND = NOT NAND.

Exercise 3.13. Draw a NOR gate: the output is Low if either A or B (or both) is HIGH.

Exercise 3.14. You guessed it - draw a CMOS or gate.
Exercise 3.15. Draw a 3 -input CMOS NAND gate.
The CMOS digital logic we'll be seeing later is constructed from combinations of these basic gates. The combination of very low-power dissipation and stiff rail-to-rail output swing makes CMOS logic the family of choice for most digital circuits, accounting for its popularity. Furthermore, for micropower circuits (such as wristwatches and small battery-powered instruments), it's the only game in town.

Lest we leave the wrong impression, however, it's worth noting that CMOS logic is not zero power. There are two mechanisms of current drain:
(a) During transitions, a CMOS output must supply a transient current $I=C d V / d t$ to charge any capacitance it sees (Figure 3.92). You get load capacitance both from wiring ("stray" capacitance) and from the input capacitance of ad-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0219.jpg?height=443&width=794&top_left_y=207&top_left_x=978)

Figure 3.92. Capacitive charging current. The average supply current is proportional to switching rate, and equals $C V f$.
ditional logic that you are driving. In fact, because a complicated CMOS chip contains many internal gates, each driving some on-chip internal capacitance, there is some current drain in any CMOS circuit that is making transitions, even if the chip is not driving any external load. Not surprisingly, this "dynamic" current drain is proportional to the rate at which transitions take place.
(b) The second mechanism of CMOS current drain is shown in Figure 3.93: as the input jumps between the supply voltage and ground, there is a region where both MOSFETs are conducting, resulting in large current spikes from $V_{\mathrm{DD}}$ to ground. This is sometimes called "class-A current," "shoot-through," or "power-supply crowbarring." You will see some consequences of this in Chapters 10-12. As long as we're dumping on CMOS, we should mention that an additional disadvantage of CMOS (and, in fact, of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0219.jpg?height=603&width=511&top_left_y=1522&top_left_x=1099)

Figure 3.93. When the input gate voltage of a CMOS inverter is intermediate between $V_{\mathrm{DD}}$ and ground, both MOSFETs are partially conducting, causing "class-A conduction," also known as "shootthrough" current.
all MOSFETs) is their vulnerability to damage from static electricity. We'll have more to say about this in $\S 3.5 .4 \mathrm{H}$.

## 3.5 Power MOSFETs

MOSFETs work well as saturated switches, as we suggested with our simple circuit in §3.1.1B. Power MOSFETs are now available from many manufacturers, making the advantages of MOSFETs (high input impedance, easy paralleling, absence of "second breakdown") applicable to power circuits. Generally speaking, power MOSFETs are easier to use than conventional bipolar power transistors. However, there are some subtle effects to consider, and cavalier substitution of MOSFETs in switching applications can lead to prompt disaster. We've visited the scenes of such disasters and hope to avert their repetition. Read on for our handy guided tour.

FETs were feeble low-current devices, barely able to run more than a few tens of milliamps, until the late 1970s, when the Japanese introduced "vertical-groove" MOS transistors. Power MOSFETs are now made by all the manufacturers of discrete semiconductors (e.g., Diodes-Inc, Fairchild, Intersil, IR, ON Semiconductor, Siliconix, Supertex, TI, Vishay, and Zetex, along with European companies like Amperex, Ferranti, Infineon, NXP, and ST, and many of the Japanese companies such as Renesas and Toshiba); they are called, variously, VMOS, TMOS, vertical DMOS, and HEXFET. Even in conventional transistor power packages such as TO-220, TO-247, and D-PAK they can handle surprisingly high voltages (up to 1500 V or more), and peak currents over 1000 amps (continuous currents of 200 A ), with $R_{\mathrm{ON}}$ below $0.001 \Omega$. Small-power MOSFETs sell for much less than a dollar, and they're available in all the usual transistor packages. You can also get arrays (multiple MOSFETs) in standard multipin IC packages such as the traditional dual in-line package (DIP) and the smaller surface-mount varieties such as SOT-23, SOIC, and TSOP. Ironically, it is now discrete low-level MOSFETs that are hard to find, there being no shortage of power MOSFETs; Table 3.4a on page 188 lists a selection of small $n$-channel MOSFETs up to 250 V , Table 3.4 b on pages 189-191 lists other $n$-channel MOSFET sizes and voltages, and Table 3.6 on page 210 has a nice selection of depletion-mode power MOSFETs. There are additional types listed in the MOSFET tables in Chapter $3 x$.

### 3.5.1 High impedance, thermal stability

Two important advantages of the power MOSFET compared with the bipolar power transistor, are (a) its extremely high input impedance (essentially infinite at dc),
and (b) its inherent thermal stability. As simple as these might seem, there's more to say, and some important cautions.

#### A. Input impedance

First, the "infinite" input impedance holds only at dc because of substantial input capacitance, which can run to $1000-10,000 \mathrm{pF}$ in typical power MOSFETs. In addition, for switching applications you have also to worry about feedback capacitance, i.e., drain-to-gate capacitance (also called reverse transfer capacitance, $C_{\mathrm{rss}}$ ), because the Miller effect (\$2.4.5) boosts the effective value by the voltage gain. In $\S 3.5 .4$ we'll discuss this further and display some waveforms showing how the Miller effect fights your efforts to bring about rapid switching. Jumping to the bottom line, you may have to supply several amperes of gate drive current to switch power loads in the tens of nanoseconds that MOSFETs can inherently achieve - hardly the characteristics of an infinite input-impedance device!

#### B. Thermal stability

Second, there are two mechanisms affecting thermal stability in MOSFETs, namely an increase in $R_{\mathrm{ON}}$ with increasing temperature, and, at the higher end of the transistor's drain current only, a decrease in drain current (at constant $V_{\mathrm{GS}}$ ) with increasing temperature; see Figure 3.14 and Figures 3.115, and 3.116 in §3.6.3. This latter effect is very important in power circuits and is worth understanding: the large junction area of a power transistor (whether BJT or FET) can be thought of as a large number of small junctions in parallel (Figure 3.94), all with the same applied voltages. In the case of a bipolar power transistor, the positive temperature coefficient of collector current at fixed $V_{\mathrm{BE}}$ (approximately $+9 \% /{ }^{\circ} \mathrm{C}$, see §2.3) means that a local hot spot in the junction will have a higher current density, thus producing additional heating. At sufficiently high $V_{\mathrm{CE}}$ and $I_{\mathrm{C}}$, this "current hogging" can cause local thermal runaway. As a result, bipolar power transistors are limited to a "safe operating area" (on a plot of collector current versus collector voltage) smaller than that allowed by transistor power dissipation alone. The important point here is that the negative temperature coefficient of MOS drain current, when operating at relatively high currents, prevents these junction hot spots entirely. MOSFETs also have no second breakdown, and their safe operating area (SOA) is limited only by power dissipation (see Figure 3.95, where we've compared the SOAs of an npn and an nMOS power transistor of the same $I_{\max }, V_{\max }$, and $\left.P_{\text {diss }}\right)$. This is one reason MOSFETs are favored in linear power applications such as audio power amplifiers.

Table 3.4a MOSFETs - Small $n$-channel (to 250V), and p-channel (to 100V)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0221.jpg?height=1825&width=1651&top_left_y=200&top_left_x=121)

This table shows selected representative MOSFETs. The left nMOS column lists TO-92 and small surface-mount parts. The right column lists all pMOS parts up to 100 V . The lists are sorted by decreasing switch spec, $R_{\mathrm{DS}(\mathrm{ON})}$. Ignore parts with inadequate $V_{\mathrm{DSS}}$, and evaluate parts with a good switch $I_{\mathrm{D}}$ spec margins. Study candidate datasheets for viability. Amplifiers and linear regulators rely on the $P_{\mathrm{D}}$ spec. But $R_{\Theta \mathrm{JC}}=125^{\circ} \mathrm{C} / P_{\mathrm{D}}$, and the junction temp will be $T_{\mathrm{J}}=T_{\mathrm{A}}+P_{\mathrm{D}}\left(R_{\Theta \mathrm{JC}}+R_{\Theta \mathrm{JA}}\right)$, where the latter term is your heatsink thermal path. Both $R_{\Theta}$ terms vary widely for different packages, and the $P_{\mathrm{D}}$ spec is useful only in that context. You may find that high-voltage parts have lower $R_{\Theta \mathrm{JC}}$.

Table 3.4b $n$-channel Power MOSFETs, 55 V to $4500 \mathrm{~V}^{\mathrm{a}}$ (page 1 of 3 )
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0222.jpg?height=1468&width=1666&top_left_y=205&top_left_x=213)

Notes: (a) sorted by voltage groups, then by descending RDS(on); parts with rated below 55 V are not included; many MOSFETs have an alphanumeric part-number scheme, e.g., $10 \mathrm{N60}$, where 10 is the continuous current capability, N means $n$-channel, and the last number is $V_{\text {DSS }} / 10$, so 60 means 600 volts; for these parts a prefix letter usually indicates the package type. (*) same as row above. (b) the maximum continuous current with $T_{\mathrm{C}}=25^{\circ} \mathrm{C}$ (manifestly impossible), assuming $T_{J}=150^{\circ} \mathrm{C}$; in some cases the current is limited by the package (bonding wires). (c) $P_{\text {diss }}$ for $T_{\text {case }}=25^{\circ} \mathrm{C}$ from datasheet. (e) at $T_{J}=25^{\circ} \mathrm{C}$. (k) parts in italics have super-junction technology, specs are at $V_{\mathrm{DS}}=50$ or 100 V . (m) max. ( $\left.\mathbf{n}\right) \mathrm{Cr}=\mathrm{Cree}, \mathrm{F}=$ Fairchild, $\mathrm{Inf}=\mathrm{Infineon} \mathrm{IR}=$,International Rectifier, $\mathrm{Ix}=\mathrm{IXYS}, \mathrm{N}=\mathrm{NXP}$, $\mathrm{R}=$ Renesas, $\mathrm{ST}=\mathrm{STMic}$ roelectronics, $\mathrm{Su}=$ Supertex, $\mathrm{To}=$ Toshiba, $\mathrm{V}=$ Vishay. (p) package types (check datasheet to see which pkgs the mfgr offers for that part); plastic power types with three leads are (largest first): TO-264 with 0.215" lead spacing (to match TO-3 center hole and insulated side mounting notches), TO-247 (same spacing, optional center hole), TO-3P (same spacing and center hole, both to match TO-3), TO-220 (smaller with 0.2" tab with hole, 0.1 " lead spacing, very popular); the I2-PAK (TO-262) is a "sawed-off TO-220" stand-up part with 0.1" pitch (three leads plus tab), while the D2-PAK (TO-263) is an SMT version (2 leads plus tab); the I-PAK (TO-251) is a smaller version of the I2-PAK (i.e., stand-up, 3 leads plus tab, 0.09" pitch), with its corresponding D-PAK (TO-252) SMT version (2 leads plus tab); SOT-223 three leads 0.09 " spacing with short tab; power SO-8P is similar to SOIC-8 with a metal "power pad"; LFPAK=SOT669 has SO-8 footprint replacing 4 pins with drain tab; the SOT-227 package measures $1 \times 1.5 \mathrm{in}$, has four \#4 captive-nut spade-lug lead connections, and a super-useful insulated metal heat-sink plate. (q) qty 100. (r) RDS typ for $T_{J}=25^{\circ} \mathrm{C}$; if hot, scale by 1.5 to $2 x$ for low-voltage parts, or by 2.2 to 3.5 x for high-voltage parts, see Chapter 3 x . (s) total gate charge to VGS; gate switching loss $=Q_{\mathrm{G}} V_{\mathrm{GS}} f$. (s2) drain capacitive switching loss $=C_{\mathrm{Oss}} V_{\mathrm{DS}}{ }^{2} f$. (t) typical. (v) at the $V_{\mathrm{GS}}$ at which $R_{\mathrm{DS}}(\mathrm{on})$ is specified. (w) newer - N version costs less, but has higher $R_{\theta J C}$. ( $\mathbf{x}$ ) this is a silicon-carbide ( SiC ) rather than silicon MOSFET; these have lower capacitance but require higher gate voltages. (y) est'd year-of-introduction; see "A 30-year MOSFET Saga" in chapter $3 x$. (z) guideline conservative estimate, saturated switch at $V_{\mathrm{GS}}, T_{\mathrm{C}}=70^{\circ} \mathrm{C}$.

Usage comments: - when scanning the list for low $C_{\text {oss }}$, or maximum power, or low $R_{\text {on }}$, etc., you may find a better part for your spec, with much higher $V_{D}$ DSS than required -- especially true for high-power capability, a linear servo or pass transistor. - 500 V parts have been superceded by 600 V parts by many manufacturers. - linear apps often need power dissipation capability, this is often better with older large-die parts; newer designs use narrow V-grooves to achieve low $R_{\mathrm{DS}(\mathrm{on})}$, and therefore require much less die area. There are good candidates in the table.

Table 3.4b $n$-channel Power MOSFETs, 55 V to $4500 \mathrm{~V}^{\mathrm{a}}$ (page 2 of 3 )
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0223.jpg?height=1929&width=1596&top_left_y=270&top_left_x=151)

Table 3.4b $n$-channel Power MOSFETs, 55 V to $4500 \mathrm{~V}^{\mathrm{a}}$ (page 3 of 3 )
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0224.jpg?height=1837&width=1680&top_left_y=283&top_left_x=206)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0225.jpg?height=312&width=815&top_left_y=219&top_left_x=123)

Figure 3.94. A large-junction-area transistor can be thought of as many paralleled small-area transistors.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0225.jpg?height=800&width=736&top_left_y=692&top_left_x=155)

Figure 3.95. Power MOSFETs do not suffer from second breakdown: comparing safe operating areas (SOAs) of a 160 W BJT (MJH6284) and MOSFET (RFP40N10).

This negative temperature coefficient ("tempco") of $I_{D}$ (at fixed $V_{\mathrm{GS}}$ ) has produced some bad advice in the amplifier community, in particular the statement that it's always OK to connect a set of power MOSFETs in parallel without the current-equalizing "emitter-ballasting" resistors that are necessary with bipolar transistors. ${ }^{80}$ You could do that, if the MOSFETs were to be operated in the high-current regime where you get the stabilizing negative tempco. But in practice you usually can't operate up there anyway, because of power-dissipation limitations that we'll see in §9.4.1A. And at the lower currents where the tempco is positive and destabilizing, one of a set of paralleled

[^150]MOSFETs will tend to hog the current and suffer excessive power dissipation, often leading to early failure. The solution is to use a small source-ballasting resistor in each of the paralleled MOSFETs (which should be of the same type, and from the same manufacturer), chosen to drop about a volt at the operating current.

By contrast, you can parallel power MOSFETs in switching applications. That's because the MOSFET is here operated in the ohmic region of low $V_{\mathrm{DS}}$ (characterized by approximately constant resistance $R_{\mathrm{ON}}$, as opposed to the higher-voltage "current-saturation" region where the transistor is characterized by approximately constant $I_{D}$ ): it is the positive tempco of $R_{\mathrm{ON}}$ that stabilizes the current sharing in paralleled power MOSFETs. No ballasting resistors are needed, or even desirable. We'll say more about this in §3.6.3.

### 3.5.2 Power MOSFET switching parameters

Most power MOSFETs are enhancement type, available in both $n$ - and $p$-channel polarities. Relevant parameters are the breakdown voltage $V_{\text {DSS }}$ (ranging from 12 V to 4.5 kV for $n$-channel, and to 500 V for $p$-channel); the channel on-resistance $R_{\mathrm{DS}(\text { on })}$ (as low as $0.8 \mathrm{~m} \Omega$ ); the current- and power-handling ability (as much as 1000 A and 1000 W ); and the gate capacitances $C_{\mathrm{rss}}$ and $C_{\mathrm{iss}}$ (as much as 2000 pF and $20,000 \mathrm{pF}$, respectively).

We need to rain on this parade! These impressively high current and power ratings are usually specified at $25^{\circ} \mathrm{C}$ case temperature, allowing the junction temperature to rise to $175^{\circ} \mathrm{C}$ (while the impressively low $R_{\text {on }}$ is specified at $25^{\circ} \mathrm{C}$ junction temperature!). Unless you're resident at the South Pole, these are completely unrealistic conditions during continuous high-power switching. ${ }^{81}$ See the discussion in §3.5.4D.

### 3.5.3 Power switching from logic levels

You often want to control a power MOSFET from the output of digital logic. Although there are logic families that generate swings of 10 V or more (the "legacy" 4000series CMOS), the most common logic families (known generically as CMOS) use supply voltages of $+5,+3.3$, or +2.5 V , and generate output levels close to that voltage or to ground (HIGH and LOW, respectively). ${ }^{82}$ Figure 3.96

[^151]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0226.jpg?height=1462&width=1478&top_left_y=213&top_left_x=307)

Figure 3.96. MOSFETs can switch power loads when driven from digital logic levels. See also Figure 3.106 on page 204.
shows how to switch loads from these logic families. In the first circuit (Figure 3.96A), the +5 V gate drive will fully turn on a garden-variety MOSFET, so we chose the 2N7000, an inexpensive transistor (\$0.04 in quantity!) that specifies $R_{\mathrm{ON}}<5 \Omega$ at $V_{\mathrm{GS}}=4.5 \mathrm{~V}$. The diode protects against inductive spike (§1.6.7). The series gate resistor, though not essential, is a good idea, because MOSFET drain-gate capacitance can couple the load's inductive transients back to the delicate CMOS logic (more on this soon).

For variety, in the second circuit (Figure 3.96B) we've used the $p$-channel MTP50P03HDL, driving a load returned to ground. In a commonly used technique called
power switching, the "load" could be additional circuitry, powered up electrically on command. The ' 50 P 03 specifies a maximum $R_{\mathrm{ON}}$ of $0.025 \Omega$ at $V_{\mathrm{GS}}=-5 \mathrm{~V}$ and can handle a 50 amp load current; for lower $R_{\mathrm{ON}}$ you could select the IRF7410 ( $0.007 \Omega, 16 \mathrm{~A}, \$ 1.50)$; see Table 3.4a on page 188.

Lower voltage logic is increasingly popular in digital circuits. The switching configurations of Figures 3.96A \& B can be used for lower voltages, but be sure to use MOSFETs with specified "logic thresholds." For example the $20 \mathrm{~V} 16 \mathrm{~A} n$-channel FDS6574A from Fairchild specifies a maximum $R_{\mathrm{ON}}$ of $0.009 \Omega$ at a paltry $V_{\mathrm{GS}}$ of
1.8 V , and its $p$-channel FDS6575 sibling specs $0.017 \Omega$ maximum at a $V_{\mathrm{GS}}$ of -2.5 V ; they cost about $\$ 1.25$ in small quantities. When choosing low-threshold MOSFETs, watch out for misleading specifications. For example, the IRF7470 MOSFET specifies " $V_{\mathrm{GS}(\mathrm{th})}=2 \mathrm{~V}(\mathrm{max})$," which sounds good until you read the fine print ("at $I_{\mathrm{D}}=0.25 \mathrm{~mA}$ "). It takes considerably more gate voltage than $V_{\mathrm{GS}(\mathrm{th})}$ to turn a MOSFET on fully (see Figure 3.115 on page 212). However, the circuit will work OK, because the IRF7470 further specifies " $R_{\mathrm{ON}}(\max )=30 \mathrm{~m} \Omega$ at $V_{\mathrm{GS}}=$ 2.8 V ""

The next two circuits show another way to handle the lower drive voltages from low-voltage logic. In Figure 3.96 C we've used a switched npn current sink to generate a "high-side" gate drive for a $p$-channel powerswitching MOSFET. Note that if the current sink were replaced with a bipolar switch, the circuit would fail immediately for switched voltages greater than the gate-source breakdown voltage. In Figure 3.96D an integrated MOSFET and high-side driver (from Infineon's "PROFET" line of smart high-side power switches) is used to switch truly prodigious currents - up to 165 A for this particular device. ${ }^{83}$ They make it easy to drive from logic levels, by including internal voltage level translation circuitry, and a charge pump (§9.6.3) for the high-side gate drive. You can also get high-side driver ICs for use with an external $n$-channel MOSFET, for example the LM9061 shown in Figure 3.96F. This particular driver also has an internal charge pump to generate the gate voltage for the external nMOS power switch $Q_{1}$; the gate currents are modest, so the switching speeds are relatively slow. This driver also includes a protection scheme for $Q_{1}$ that senses $V_{\mathrm{DS}(\mathrm{ON})}$, shutting off drive if the MOSFET's forward drop exceeds a threshold (set by $R_{\text {set }}$ ), with a delay (to accommodate higher inrush currents) set by $C_{\text {delay }}$.

Finally, Figure 3.96E shows how you can sidestep this issue entirely and ensure healthy gate drive voltage and current, by using a "MOSFET gate driver" chip like the TC4420. It accepts logic-level input (threshold guaranteed less than +2.4 V ), and produces a muscular full-swing output with internal push-pull MOSFETs of its own (Figure 3.97). It can source or sink several amperes of gate current, ensuring fast switching with the large capacitive loads that power MOSFETs present (see §3.5.4B). The tradeoff here is cost (about $\$ 1$ ) and complexity. Table 3.8 on page 218 lists a selection of nice gate-driver ICs. We'll see these again in detail in Chapter $9 x$ ("High-side Cur-

[^152]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0227.jpg?height=285&width=634&top_left_y=207&top_left_x=1058)

Figure 3.97. A MOSFET driver like the TC4420 accepts logic-level input signals and generates a fast ( $\sim 25 \mathrm{~ns}$ ), high-current ( $\pm 6 \mathrm{~A}$ ), full-swing output. The TC4429 is similar, but with inverted output.
rent Sensing") and in Chapter 12 (§12.4) in the context of controlling external loads from logic-level signals, and in §12.7 in connection with opto-isolated MOSFET drivers.

#### A. Some more MOSFET switching examples

The more, the merrier: let's look at a few more circuits that take advantage of the MOSFET's combination of low $R_{\mathrm{ON}}$ and negligible gate current. We'll keep the descriptions mercifully brief.

#### Pulse stretcher

Figure 3.98A is drop-dead simple: MOSFET switch $Q_{1}$, driven with a short positive pulse, discharges capacitor $C_{1}$, making the output go to the positive rail (here +5 V ); when the capacitor charges up to the switching threshold of the output inverter (which can be another nMOS transistor or a logic inverter) the output returns to zero. Note that the timing begins at the trailing edge of the input. See §2.2.2 for some fancier discrete circuits that generate an output pulse width insensitive to the input pulse duration. And in Chapter 7 we go into greater detail ( $\$ 87.2 .1$ and 7.2.2), including integrated timing circuits such as the monostable multivibrator (also called a "one-shot").

#### Relay driver

An electromechanical relay (more detail in Chapter 1x) switches its contacts in response to an energizing current in the coil. The latter has some rated voltage that is guaranteed to switch the contacts and hold them in the energized position. For example, the relays specified in Figure 3.98B have a coil rating of +5 Vdc , at which they draw 185 mA (i.e., a coil resistance of $27 \Omega$ ). ${ }^{84}$ In some sense the rated voltage is a compromise: enough to operate the relay reliably, but without excessive current. But you can cheat a bit and get faster closure if you overdrive the coil momentarily,
${ }^{84}$ There's more: it specifies a "must operate" coil voltage of 3.75 V and a "must release" voltage of 0.5 V . Lots of specs, too, about the switched contacts: configuration, voltage and current ratings, endurance, and so on.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0228.jpg?height=1613&width=751&top_left_y=206&top_left_x=244)

Figure 3.98. Useful - and simple - MOSFET applications: A. pulse stretcher; B. relay driver, with initial pulsed overdrive; C. programmable voltage supply with disable control.
as shown in the figure. Here $Q_{2}$ applies 12 V for an initial $\sim 0.1 \mathrm{~s}$, after which $Q_{1}$ sustains the by-now firmly closed contacts with the rated 5 V across the coil. Diode $D_{1}$ provides a conduction path for the inductive current at release, with series resistor $R_{3}$ allowing $\sim 20 \mathrm{~V}$ during current decay for faster release (see the discussion in Chapter $1 x$ to to understand why this is a good thing).

#### Control of a programmable supply

It's nice to control things remotely, with a brainy computer in charge. You might assemble (or buy) a voltage source that accepts a low-level analog input, in the manner of Figure 3.98C, in which the "A" symbol represents a dc amplifier that outputs a voltage $V_{\text {out }}=A V_{\text {in }}$, perhaps capable of substantial output current as well. But it's always good to provide a way to disable external control, so things don't go nuts when the computer crashes or is booting up (or gets taken over by an evildoer). The figure shows a simple way to implement a manual DISABLE control (which duplicates the external DISABLE input); might as well have a manual voltage mode as well, as shown.

#### On/Off battery control

It's convenient to power battery-operated instruments with a 9 volt battery: easy to get; provides plenty of voltage headroom; can be used to create a split supply, see §4.6.1B; but you've got to conserve the battery's vital juices, which run out after about 500 mAh .

Figure 3.99 shows some ways to implement power switching with MOSFETs. Circuit A is the classic flipflop (two buttons: SET, and RESET; it's called an "SR flipflop"). The OFF button shuts off $Q_{2}$, whose drain goes HIGH, holding $Q_{1}$ on and simultaneously holding pass transistor $Q_{3}$ off; you can easily make yourself believe that the on button does the opposite (and you would be right). Two buttons are OK (though we can do better, stay tuned), but this circuit has the disadvantage of drawing current in either state. You could minimize the standby current by using a $10 \mathrm{M} \Omega$ resistor for $R_{1}$, say; then it draws $1 \mu \mathrm{~A}$ when off, which calculates out to a 50 -year battery lifetime - far longer than its $\sim 5$ year shelf life.

But there's a better way. Look at Circuit B, where the complementary pair flip-flop $Q_{1} Q_{2}$ draws no current (other than nanoamp-scale leakage) in the OFF state. The next step is Circuit C (also zero power when OFF), which achieves the minimum button count, in which a single pushbutton acts as an ON/OFF "toggle." This circuit is a bit tricky, because you have to juggle several time constants appropriately. ${ }^{85}$ But the basic concept is simple, and elegant: charge a capacitor from the inverted output of the flip-flop's control input, then momentarily connect the charged capacitor to the control input to make it toggle.

[^153]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0229.jpg?height=950&width=1460&top_left_y=206&top_left_x=211)

Figure 3.99. ON/OFF battery power control with MOSFETs (no fancy integrated circuits allowed!): A. Classic flip-flop enables p-channel series switch; separate ON and OFF buttons. B. Ditto, but zero power when off. C. Single button toggles power ON/OFF; zero power when off. For each MOSFET two choices are listed: the upper is a TO-92 through-hole type, the lower a SOT23 surface-mount type. D. "Five minutes of power" (approximately); zero power when off. The $p$-channel MOSFET pass transistors can be as large as you need, see Table 3.4a.

Finally, for the forgetful we suggest something like Circuit $D$, a one-button control that turns off automatically (to zero power) after roughly five minutes. Here $Q_{1} Q_{2}$ form a complementary flip-flop, held in the ON state by ac coupling through $C_{1}$; once on the latter discharges through $R_{1}$, with a time constant of 330 s . This is an approximation to the actual shutoff time interval, which is set in detail by the ratio of $Q_{2}$ 's gate switching voltage to the actual battery voltage. ${ }^{86}$ There's a bit of complexity here, in the form of the zener $Z_{1}$, which was forced upon us by the need to keep $Q_{3}$ fully on during the critical interval when the flip-flop is deciding to switch OFF. We chose a BJT (rather than a MOSFET) for $Q_{1}$ because of its well-defined turnon voltage; even so, there are the usual headaches here, caused by the uncertainty in gate threshold voltages of $Q_{2}$ and $Q_{3}$.

In all four of the circuits in Figure 3.99 you can use as large a $p$-channel pass transistor as needed; see Table 3.4a on page 188 for suggestions. But remember that

[^154]large MOSFETs have high input capacitance $C_{\text {iss }}$, which slows down switching. As an example, if you were to use an SUP75P05 $p$-channel MOSFET in circuit D , you'd benefit from a very low $8 \mathrm{~m} \Omega$ on-resistance, but you would have to contend with its substantial 8500 pF value of $C_{\text {iss }}$ (thus nearly 10 ms gate turn-off time constant $R_{4} C_{\text {iss }}$ ). In these circuits that would not matter. Note that a transistor like the SUP75P05 can switch 50 A , and dissipates about one watt when passing 10 A with a full 10 V gate drive (recall $R_{\mathrm{ON}}$ rises with temperature, at $75^{\circ} \mathrm{C}$ it's about $10 \mathrm{~m} \Omega$ ); at most a small 2 W clip-on heatsink is needed (see §9.4.1). ${ }^{87}$

### 3.5.4 Power switching cautions

As nice as MOSFETs are, designing circuits with them is not entirely simple, owing to numerous details that can bedevil you. We simply summarize some of the important issues here and delve further into power switching in Chapter $3 x$ and Chapter 9.

[^155]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0230.jpg?height=554&width=1519&top_left_y=213&top_left_x=286)

Figure 3.100. Interelectrode capacitances in two power MOSFETs, from graphical data in their respective datasheets. The feedback capacitance $C_{\text {rss }}$, though smaller than the input capacitance $C_{\text {iss }}$, is effectively multiplied by the Miller effect and typically dominates in switching applications.

#### A. MOSFET gate capacitance

Power MOSFETs have essentially infinite input resistance, but they have plenty of input capacitance and also feedback capacitance, such that fast switching may require literally amperes of gate drive current. ${ }^{88}$ Although you may not care about speed in many applications, you still have to worry, because low gate drive current causes dramatically higher power dissipation (from the $V I \Delta t$ product during extended switching transitions); it may also permit oscillations during the slow transition. The various interelectrode capacitances are nonlinear and increase with decreasing voltage, as shown in Figure 3.100. The capacitance from gate to ground (called $C_{\text {iss }}$ ) requires an input current of $i=C_{\mathrm{iss}} d V_{\mathrm{GS}} / d t$, and the (smaller) feedback capacitance (called $C_{\mathrm{rss}}$ ) produces an input current $i=C_{\mathrm{rss}} d V_{\mathrm{DG}} / d t$. The latter usually dominates in a common-source switch, because $\Delta V_{\mathrm{DG}}$ is usually much larger than the $\Delta V_{\mathrm{GS}}$ gate drive, effectively multiplying the feedback capacitance by the voltage gain (Miller effect). A nice way to look at this is in terms of gate charge, next.

#### B. Gate charge

In a common-source switch, charging of the gate-source and gate-drain capacitances require an input gate driving current whenever the gate voltage is changing. Additionally, during drain voltage transitions the Miller effect contributes additional gate current. These effects are often plotted as a graph of "gate charge versus gate-source voltage," as in Figure 3.101.

The initial slope is the charging of $C_{\mathrm{iss}}$. The horizontal portion begins at the turn-on voltage, where the rapidly

[^156]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0230.jpg?height=624&width=794&top_left_y=943&top_left_x=1067)

Figure 3.101. Gate charge versus $V_{\mathrm{GS}}$. The newer small-geometry ("shrunk-die") IRF520N has a lower threshold voltage, but comparable gate charge. Note in all cases the larger capacitance (reduced slope of $V_{\mathrm{GS}}$ versus $Q_{\mathrm{g}}$ ) to the right of the "Miller shelf," the result of larger interelectrode capacitances at low $V_{\mathrm{DS}}$ (Figure 3.100).
falling drain forces the gate driver to supply additional charge to $C_{\text {rss }}$ (Miller effect). If the feedback capacitance were independent of voltage, the length of the horizontal portion would be proportional to initial drain voltage, after which the curve would continue upward at the original slope. In fact, the "nonlinear" feedback capacitance $C_{\text {rss }}$ rises rapidly at low voltage (Figure 3.100), which means that most of the Miller effect occurs during the low-voltage

[^157]portion of the drain waveform. ${ }^{89}$ This explains the change in slope of the gate charge curve, as well as the fact that the length of the horizontal portion is almost independent of initial drain voltage. ${ }^{90}$

We hooked up a common-source MOSFET switch and drove the gate with a constant-current drive step, producing the "textbook" traces in Figure 3.102 (hey, this is a textbook, right?). With constant gate drive current, the horizontal (time) axis is proportional to gate charge, in this case $3 \mathrm{nC} / \mathrm{div}$. Here you can see clearly the three regions of gate activity: in region 1 the gate is charging up to the threshold voltage; in region 2 the gate voltage is clamped at the voltage that produces drain currents from 0 to 40 mA ( 40 V positive rail, 1 k load resistor); after the drain is brought to ground the gate resumes its upward voltage ramp, but with reduced slope (owing to increased input capacitance at zero drain voltage).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0231.jpg?height=475&width=749&top_left_y=959&top_left_x=146)

Figure 3.102. Gate charge. Waveforms of an IRLZ34N $n$-channel MOSFET, wired as a common-source switch ( 1 k load to +40 V ), with 0.75 mA gate drive. The horizontal scale of $4 \mu \mathrm{~s} /$ div therefore corresponds to $3 \mathrm{nC} /$ div of gate charge.

Notice also that the drain voltage trace is curved, caused by the increasing drain-gate capacitance as it heads toward ground: with constant applied input $I_{\mathrm{G}}$, the increasing $C_{\mathrm{rss}}$ mandates decreasing $d V_{\mathrm{D}} / d t$ (to keep the product, i.e., the feedback current, equal to the input current).

The Miller effect and gate charge in MOSFET switches

[^158]are no laughing matter - they seriously limit switching speed, and you may need to supply hundreds of milliamps, or even amps, to get fast transitions times in a hefty power switch. For example, the robust IRF1405 featured earlier has $Q_{\mathrm{g}} \sim 100 \mathrm{nC}$; so, to switch it on in 10 ns requires $I=Q_{\mathrm{g}} / t=10$ amperes $!^{91}$

On a more modest scale, imagine driving a humble 2N7000 switch from a $0 \rightarrow 5 \mathrm{~V}$ square wave, perhaps from the output of some digital logic. Figure 3.103 shows what happens if you drive the gate through a 10k resistor. Miller is the killer here, causing $\sim 2 \mu$ s transition times in a transistor which the datasheet says can switch 200 times faster ( 10 ns ). Of course, the datasheet also says $R_{\mathrm{GEN}}=25 \Omega \ldots$ and they mean it!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0231.jpg?height=404&width=753&top_left_y=818&top_left_x=996)

Figure 3.103. A $2 N 7000$ MOSFET switch ( 1 k load to +50 V ), whose gate is driven by a 5 V (logic-level) voltage step through a 10k series resistor. The Miller effect stretches the switching time to $\sim 2 \mu \mathrm{~s}$. Horizontal scale: $2 \mu \mathrm{~s} / \mathrm{div}$.

There's plenty more to say about gate charge in MOSFETs: dependence on load current, the shape of the "Miller plateau," variations among MOSFET types, and measurement techniques. This is discussed in detail in the advanced material in Chapter 3x.

#### C. MOSFET drain capacitances

In addition to the gate-to-ground capacitance $C_{\mathrm{iss}}$, MOSFETs also have a gate-drain feedback capacitance $C_{\mathrm{dg}}$ (usually called $C_{\mathrm{rss}}$ ), and an output capacitance (called $C_{\mathrm{oss}}$ ) that is the combined capacitances from drain to gate $C_{\mathrm{dg}}$ and drain to source $C_{\mathrm{ds}}$. As just seen, the effect of the feedback capacitance $C_{\mathrm{rss}}$ is evident in the gate-charge waveforms in Figure 3.102. The output capacitance is important, too: it is the capacitance that must be charged and discharged
${ }^{91}$ Quite often it is the output transition time that you care about; that is, the time spent just in region 2 (apart from the delay time in region 1, or the gate overcharging time in region 3); for this reason MOSFET datasheets separately specify $Q_{\mathrm{gd}}$, the gate-to-drain "Miller" charge. For the IRF1405, for example, $Q_{\mathrm{gd}}=62 \mathrm{nC}$, thus requiring a gate input current of 6.2 A to bring about a 10 ns transition time.
each switching cycle, which, if not reactively recycles, consumes power $P=C_{\mathrm{oss}} f V_{\mathrm{DD}}^{2}$, which can become significant at high switching frequencies. See $\S \S 9.7 .2 \mathrm{~B}$ for details.

#### D. Current and power ratings

MOSFET datasheets specify a maximum continuous drain current, but this is done assuming an unrealistic $25^{\circ} \mathrm{C}$ case temperature. It is calculated from $I_{\mathrm{D}(\text { max })}^{2} R_{\mathrm{DS}(\mathrm{ON})}=P_{\text {max }}$, substituting a maximum power (see §9.4) $P_{\max } R_{\Theta \mathrm{JC}}=\Delta T_{\mathrm{JC}}=150^{\circ} \mathrm{C}$, where they have assumed $T_{\mathrm{J}(\max )}=175^{\circ} \mathrm{C}$ (thus a $150^{\circ} \mathrm{C} \Delta T_{\mathrm{JC}}$ ), and they use the value of $R_{\mathrm{DS}(\mathrm{ON})}$ (max) at $175^{\circ} \mathrm{C}$ from an $R_{\mathrm{DS}}$ tempco plot (e.g., see Figure 3.116). That is, $I_{\mathrm{D}(\max )}=\sqrt{\Delta T_{\mathrm{JC}} / R_{\mathrm{OJC}} R_{\mathrm{ON}}}$. Some datasheets list power and drain current at a more realistic $75^{\circ} \mathrm{C}$ or $100^{\circ} \mathrm{C}$ case temperature. This is better, but you don't really want to run your MOSFET junction at $175^{\circ} \mathrm{C}$, so we recommend using a still lower maximum $I_{D}$ rating for continuous current, and corresponding dissipated power.

#### E. Body diode

With rare exceptions ${ }^{92}$ power MOSFETs have the body connected to the source terminal. Because the body forms a diode with the channel, this means that there is an effective diode between drain and source (Figure 3.104) (some manufacturers even draw the diode explicitly in their MOSFET symbol so that you won't forget). This means that you cannot use power MOSFETs bidirectionally, or at least not with more than a diode drop of reverse drain-source voltage. For example, you couldn't use a power MOSFET to zero an integrator whose output swings both sides of ground, and you couldn't use a power MOSFET as an ana$\log$ switch for bipolarity signals. This problem does not occur with integrated circuit MOSFETs (analog switches, for example), where the body is connected to the most negative power-supply terminal.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0232.jpg?height=147&width=312&top_left_y=1707&top_left_x=469)

Figure 3.104. Power MOSFETs connect body to source, forming a drain-source diode.

The MOSFET's body diode exhibits the same reverserecovery effect as ordinary discrete diodes. If biased into forward conduction, it will require some duration of reversed current flow to remove the stored charge, ending with a sharp "snap-off." This can cause curious misbehavior, analogous to the rectifier snap-off transients discussed

[^159]in the colorfully-named section "Transformer + rectifier + capacitor = giant spikes!" in Chapter $9 x .{ }^{93}$

#### F. Gate-source breakdown

Another trap for the unwary is the fact that gate-source breakdown voltages ( $\pm 20 \mathrm{~V}$ is a common figure) are lower than drain-source breakdown voltages (which range from 20 V to more than 1000 V ). This doesn't matter if you're driving the gate from the small swings of digital logic, but you get into trouble immediately if you think you can use the drain swings of one MOSFET to drive the gate of another.

#### G. Gate protection

As we discuss next, all MOSFET devices are extremely susceptible to gate oxide breakdown, caused by electrostatic discharge. Unlike JFETs or other junction devices, in which the junction avalanche current can safely discharge the overvoltage, MOSFETs are damaged irreversibly by a single instance of gate breakdown. For this reason it is a good idea to use a series gate resistor of 1 k or so (assuming that speed is not an issue), particularly when the gate signal comes from another circuit board. This greatly reduces the chances of damage; it also prevents circuit loading if the gate is damaged, because the most common symptom of a damaged MOSFET is substantial dc gate current. ${ }^{94}$ You can get additional protection by using a pair of clamp diodes (to $V+$ and to ground), or a single clamp zener to ground, downstream of the gate resistor (which can then be of much lower resistance, or omitted altogether); but note that a zener clamp adds some input capacitance. ${ }^{95}$ It's also a good idea to avoid floating (unconnected) MOSFET

93 This can be a serious problem in certain types of switching circuits, where inductive currents continue to flow after termination of switch conduction. It can be addressed by adding an external diode between drain and source, which will be in parallel with the MOSFET's intrinsic drain-source diode. You can use a Schottky diode for voltages below roughly 60 V , but at higher voltages even Schottky diodes have too much voltage drop and thus fail to take over from the FET's intrinsic diode. To deal with this there are power MOSFETs available that include special soft-recovery diodes in their design. These diodes have low reverse-recovery-charge $Q_{\mathrm{rr}}$, and hence faster recovery time $t_{\mathrm{rr}}$, so they don't get stuffed with as much charge from this persistent inductive current. They may also have a slower snapoff, further reducing the spike energy.
${ }^{94}$ A MOSFET with damaged gate may exhibit drain conduction when it should be in a non-conducting state: leakage current from drain to (damaged) gate brings the drain down to a voltage that produces the $V_{\mathrm{GS}}$ corresponding to the drain current.
${ }^{95}$ Power MOSFETs used to incorporate internal zener protection, but now it's rare: the zener itself became a dominant failure mechanism! MOSFETs with internal gate zener diodes are marked in the "Gate zener" column of Table 3.4 b on page 189 .
gates, which are susceptible to damage when floating (there is then no circuit path for static discharge, which otherwise provides a measure of safety). This can happen unexpectedly if the gate is driven from another circuit board. A good practice is to connect a pull-down resistor (say 100k to 1 M ) from gate to source of any MOSFETs whose gates are driven from an off-card signal source. This also ensures that the MOSFET is in the off state when disconnected or unpowered.

#### H. MOSFET handling precautions

The MOSFET gate is insulated by a layer of glass $\left(\mathrm{SiO}_{2}\right) \mathrm{a}$ hundred nanometers thick (less than a wavelength of light). As a result, it has very high resistance, and no resistive or junction-like path that can discharge static electricity as it is building up. In a classic situation you have a MOSFET (or MOSFET integrated circuit) in your hand. You walk over to your circuit, stick the device into its socket, and turn on the power, only to discover that the FET is dead. You killed it! You should have grabbed onto the circuit board with your other hand before inserting the device. This would have discharged your static voltage, which in winter can reach thousands of volts. ${ }^{96}$ MOS devices don't take kindly to "carpet shock," which is officially called electrostatic discharge (ESD). For purposes of static electricity, you can be approximated by the "human body model" (HBM), which is 100 pF in series with $1.5 \mathrm{k} ;{ }^{97}$ in winter your capacitance may charge to 10 kV or more with a bit of shuffling about on a fluffy rug, and even a simple arm motion with shirt or sweater can generate a few kilovolts. Here are some scary-looking numbers:

| Typical Electrostatic Voltages ${ }^{\mathrm{a}}$ |  |  |  |
| :--- | ---: | ---: | :---: |
|  | Electrostatic Voltage |  |  |
|  | $10 \%-20 \%$ | $65 \%-90 \%$ |  |
| Action | humidity | humidity |  |
| Walk on carpet | 35,000 | 1,500 |  |
| Walk on vinyl floor | 12,000 | 250 |  |
| Work at bench | 6,000 | 100 |  |
| Handle vinyl envelope | 7,000 | 600 |  |
| Pick up poly bag | 20,000 | 1,200 |  |
| Shift position on foam chair | 18,000 | 1,500 |  |
| (a) adapted from Motorola Power MOSFET Data Book. |  |  |  |

96 "Smokey, my friend, you are entering a world of pain."
${ }^{97}$ A bit simplistic, though. The HBM, charged to 2.5 kV , peaks at 1.7 A , with a time constant of 150 ns . There are other models, for example the "machine" model (several cycles of 12 kHz , up to 6 A ), or the "charge device model" (CDM), which recognizes that a portion of a charged object with less series resistance can discharge directly into the circuit with 6 A pulses 2 ns wide. See also §12.1.5.

Although any semiconductor device can be clobbered by a healthy spark, MOS devices are particularly susceptible because the energy stored in the gate-channel capacitance, when it has been brought up to breakdown voltage, is sufficient to blow a hole through the delicate gate oxide insulation. (If the spark comes from your finger, your additional 100 pF only adds to the injury.) Figure 3.105 (from a series of ESD tests on a power MOSFET ${ }^{98}$ ) shows the sort of mess this can make. Calling this "gate breakdown" gives the wrong idea; the colorful term "gate rupture" might be closer to the mark!

The electronics industry takes ESD very seriously. It is probably the leading cause of nonfunctional semiconductors in instruments fresh off the assembly line. Books are published on the subject, and you can take courses on it. ${ }^{99}$ MOS devices, as well as other susceptible semiconductors ${ }^{100}$ should be shipped in conductive foam or bags, and you have to be careful about voltages on soldering irons, etc., during fabrication. It is best to ground soldering irons, table tops, etc., and use conductive wrist straps. In addition, you can get "antistatic" carpets, upholstery, and even clothing (e.g., antistatic smocks containing $2 \%$ stainless steel fiber). A good antistatic workstation includes humidity control, air ionizers (to make the air slightly conductive, which keeps things from charging up), and educated workers. In spite of all this, failure rates increase dramatically in winter.

Once a semiconductor device is safely soldered into its circuit, the chances for damage are greatly reduced. In addition, most small-geometry MOS devices (e.g., CMOS digital integrated circuits, but not power MOSFETs) have protection diodes in the input gate circuits. Although the internal protection networks of resistors and clamping diodes (or sometimes zeners) compromise performance somewhat, it is often worthwhile to choose those devices because of the greatly reduced risk of damage by static electricity. In the case of unprotected devices, for example power MOSFETs, small-geometry (low current) devices tend to be the most troublesome, because their low input capacitance is easily brought to high voltage when it comes in contact with a charged 100 pF human. Our personal experience with the small-geometry VN13 MOSFET

[^160]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0234.jpg?height=728&width=1202&top_left_y=233&top_left_x=445)

Figure 3.105. Scanning electron micrograph of a 6 amp MOSFET destroyed by 1 kV charge on "human body equivalent" (1.5k in series with 100 pF ) applied to its gate. (Courtesy of Motorola, Inc.)
was been so dismal in this regard that we stopped using it in production instruments.

It is hard to overstate the problem of gate damage caused by breakdown in MOSFETs. Chip designers realized the seriousness of the problem, and routinely rate the "ESD tolerance" of their devices. Typically MOS ICs survive 2 kV , applied with the HBM of a charged 100 pF capacitor in series with a 1.5 k resistor, and the datasheet will say so. Devices that might be exposed to external impulses (e.g., interface and line drivers) are sometimes rated to 15 kV (for example, Maxim RS-422/485 and RS-232 interface chips with an "E" suffix, and many of the analogous parts from other manufacturers).

See also the discussion of input protection in Chapter 12 (§12.1.5).

#### I. MOSFETs in parallel

Sometimes you need to use several power transistors in parallel, either to handle greater currents or to be able to dissipate more power, or both. As we discussed earlier, bipolar transistors, owing to their $+9 \% /{ }^{\circ} \mathrm{C}$ tempco of collector current with temperature, need emitter-ballasting resistors to ensure that the current is distributed equally among the participating transistors. For MOSFETs, as we mentioned in §3.5.1, the situation is different: sometimes you can connect them in parallel without any resistors (e.g., as saturated switches), and sometimes you can't (as linear power devices ${ }^{101}$ ). There's also the related topic of thermal run-

[^161]away. These are important topics, and deserve the more extended discussion in §3.6.3.

### 3.5.5 MOSFETs versus BJTs as high-current switches

Power MOSFETs are attractive alternatives to conventional power BJTs most of the time. They're comparable in price, simpler to drive, and they don't suffer from second breakdown and consequently reduced safe-operating-area (SOA) constraints (Figure 3.95).

Keep in mind that, for small values of drain voltage, an ON MOSFET behaves like a small resistance $\left(R_{\mathrm{ON}}\right)$, rather than exhibiting the finite saturation voltage $\left(V_{\mathrm{CE}(\mathrm{sat})}\right)$ of its bipolar transistor cousin. This can be an advantage, because the "saturation voltage" goes clear to zero for small drain currents. There is a general perception that MOSFETs don't saturate as well at high currents, but our research shows this to be largely false. In the following table we've chosen comparable pairs ( $n p n$ versus $n$-channel MOSFET), for which we've looked up the specified $V_{\mathrm{CE}(\mathrm{sat})}$ or $R_{\mathrm{DS}(\mathrm{ON})}$. The low-current MOSFET is comparable to its "small-signal" npn cousin, but in the range of $6-10 \mathrm{~A}$ and $0-100 \mathrm{~V}$, the MOSFET does better. Note particularly that very large base currents are needed to bring the bipolar power transistor into good saturation - $10 \%$ or more of the collector current (thus as much as $1 \mathrm{~A}!$ ) - compared with the (zero-current) 10 volt bias at which MOSFETs are usually specified. Note also that
high-voltage MOSFETs (say, $\mathrm{B} V_{\mathrm{DS}}>200 \mathrm{~V}$ ) tend to have larger $R_{\mathrm{DS}(\mathrm{ON})}$, with larger temperature coefficients, than the lower-voltage units; here IGBTs excel over MOSFETs above 300 to 400 volts. We've listed capacitances in the table, because power MOSFETs traditionally had more capacitance than BJTs of the same rated current. In some applications (particularly if switching speed is important) you might want to consider the product of capacitance and saturation voltage as a figure of merit.

| BJT-MOSFET-IGBT Comparison ${ }^{\mathrm{a}}$$V_{\text {sat }}$ |  |  |  | $\begin{gathered} C_{r}{ }^{\mathrm{b}} \\ (\mathrm{pF}) \end{gathered}$ | price |
| :---: | :---: | :---: | :---: | :---: | :---: |
| class | part\# | $\begin{gathered} \hline 25^{\circ} \mathrm{C} \\ \text { (V) } \end{gathered}$ | $\begin{gathered} 125^{\circ} \mathrm{C} \\ \text { (V) } \end{gathered}$ |  |  |
| $\begin{aligned} & 60 \mathrm{~V}, \\ & 0.5 \mathrm{~A} \end{aligned}$ | 2N4401 ${ }^{\text {N }}$ | 0.75 | 0.8 | 8 | \$0.06 |
|  | 2N7000 ${ }^{\text {V }}$ | 0.6 | 0.95 | 25 | \$0.09 |
| $\begin{array}{r} 60 \mathrm{~V}, \\ 6 \mathrm{~A} \end{array}$ | TIP42A ${ }^{N}$ | 1.5 | 1.7 | 50 | \$0.63 |
|  | IRFZ34E ${ }^{\text {V }}$ | 0.25 | 0.43 | 50 | \$1.03 |
| $\begin{array}{r} 100 \mathrm{~V} \\ 10 \mathrm{~A} \end{array}$ | TIP142 ${ }^{\text {D }}$ | 3.0 | 3.8 | low | \$1.11 |
|  | IRF540N ${ }^{V}$ | 0.44 | 1.0 | 40 | \$0.98 |
| $\begin{array}{r} 400 \mathrm{~V}, \\ 10 \mathrm{~A} \end{array}$ | 2N6547 N | 1.5 | 2.5 | 125 | \$2.89 |
|  | FQA30N40 ${ }^{\text {V }}$ | 1.4 | 3.2 | 60 | \$3.85 |
| $\begin{array}{r} 600 \mathrm{~V}, \\ 10 \mathrm{~A} \end{array}$ | STGP10NC60 | $1.75$ |  | 12 | \$0.86 |
| (a) $I_{\mathrm{B}}=I_{\mathrm{C}} / 10, V_{\mathrm{GS}}=10 \mathrm{~V}$, except $I_{\mathrm{B}}=I_{\mathrm{C}} / 250$ for Darlington. <br> (b) $C_{\mathrm{ob}}$ or $C_{\mathrm{rss}}$. <br> (D) Darlington. (I) IGBT. (N) npn BJT. (V) vertical nMOS. |  |  |  |  |  |

Remember that power MOSFETs can be used as BJT substitutes for linear power circuits, for example audio amplifiers and voltage regulators (we'll treat the latter in Chapter 9). Power MOSFETs are also available as $p$ channel devices, although there tends to be a much greater variety available among the (better-performing) $n$-channel devices. The available $p$-channel MOSFETs go only to 500 V (or occasionally 600 V ), and generally cost more for comparable performance in some parameters ( $V_{\mathrm{DS}(\max )}$ and $I_{\mathrm{D}(\max )}$, say), with reduced performance in other parameters (capacitance, $R_{\mathrm{ON}}$ ). Here, for example, are specifications for a pair of complementary MOSFETs from Fairchild, matched in voltage and current ratings, and packaged in the same TO-220 power package.

|  | $n$-channel | $p$-channel |
| :---: | :---: | :---: |
| parameter | FQP9N25 | FQP9P25 |
| $V_{\max }$ | 250 V | 250 V |
| $I_{\max }$ | 9.4 A | 9.4 A |
| $R_{\mathrm{ON}}(\max )$ | $0.42 \Omega$ | $0.62 \Omega$ |
| $C_{\mathrm{rss}}($ typ $)$ | 15 pF | 27 pF |
| $C_{\text {iss }}$ typ $)$ | 540 pF | 910 pF |
| $Q_{\mathrm{g}}($ typ $)$ | 15.5 nC | 29 nC |
| $T_{\mathrm{JC}}(\max )$ | $1.39^{\circ} \mathrm{C} / \mathrm{W}$ | $1.04^{\circ} \mathrm{C} / \mathrm{W}$ |
| Price (qty 1 k$)$ | $\$ 0.74$ | $\$ 0.97$ |

Note that the $p$-channel device, having been fabricated with a larger area to achieve comparable $I_{\mathrm{D}(\max )}$, winds up with inferior (i.e., larger) capacitance, gate charge, $R_{\mathrm{ON}}$, and pricing. It is also slower and has lower transconductance, according to the datasheet. Paradoxically, the $p$-channel device has improved thermal conductivity (see §9.4.1A), presumably resulting from the larger required chip size.

### 3.5.6 Some power MOSFET circuit examples

Enough theory! Let's look at a few circuit examples with power MOSFETs.

#### A. Some basic power switches

Figure 3.106 shows six ways to use a MOSFET to control the dc power to some subcircuit that you want to turn on and off. If you have a battery-operated instrument that needs to make some measurements occasionally, you might use Circuit A to switch the power-hungry microprocessor off except during those intermittent measurements. Here we've used a pMOS switch, turned on by a 1.5 V logic swing to ground; the particular part shown is specified for low gate voltage, in particular $R_{\mathrm{ON}}=17 \mathrm{~m} \Omega$ (max) at $V_{\mathrm{GS}}=-1.5 \mathrm{~V}$. The " 1.5 V logic" is micropower CMOS digital circuitry, kept running even when the microprocessor is shut off (remember, CMOS logic has zero static dissipation).

An important point: you have to worry about proper switch operation at lower voltages, if the " 1.5 V supply" is in fact an alkaline battery, with an end-of-life voltage of $\sim 1.0 \mathrm{~V}$. In that case you may be better off using a pnp transistor - see the discussion in "Low-voltage switching: MOS versus BJT" in Chapter $3 x$.

In the second circuit (B), we're switching dc power to a load that needs +12 V at considerable current; maybe it's a radio transmitter, or whatever. Because we have only a 3.3 V logic swing available, we've used a small npn current sink to generate an 8 V negative-going swing (relative to +12 V ) to drive the pMOS gate. Note the high-value
collector resistor, perfectly adequate here because the pMOS gate draws no dc current (even a beefy 10 A brute), and we don't need high switching speed in an application like this.

The third circuit (C) is an elaboration of circuit B, with short-circuit current limiting courtesy of the pnp transistor. That's always a good idea in power-supply design for example, it's impressively easy to slip with the oscilloscope probe. In this case, the current limiting also prevents momentary short-circuiting of the +12 V supply by the initially uncharged bypass capacitor. See if you can figure out how the current limiting circuit works.

Exercise 3.16. How does the current-limiting circuit work? How much load current does it allow?

An interesting detail: in Circuits B and C we could have hooked up the driver transistor as a switch (instead of a current source), omitting the emitter resistor and adding a current-limiting base resistor of 100 k or so. But that circuit would create problems if you attempted to operate the circuit from a higher supply voltage, owing to the limited gate breakdown voltages of MOSFETs ( $\pm 20 \mathrm{~V}$ or less). It would also defeat the current-limit scheme of Circuit C. You could fix those problems by adding a resistor directly in series with the collector, tailoring its value for correct gate drive; but the current-source scheme we've used solves these problems automatically, and it can be used to switch 24 or 48 V with no component changes.
Exercise 3.17. You have a dc source using full-wave rectified 120 Vac . Design a 155 to 175 V version of Figure 3.106C to pulse 0.5 A into a flash string consisting of 38 white LEDs in series. Explain your choice for $R_{1}$ and $R_{2}$ and the ratio $R_{2} / R_{1}$. Select $Q_{1}$ and $Q_{2}$ and evaluate their power dissipation. Use Table 2.1 on page 74 , along with the MOSFET tables in this chapter. Extra credit: evaluate $Q_{2}$ 's worst-case heating with a 10 ms maximum flash length (hint: use the datasheet's plot of "Transient Thermal Impedance").

There is still a problem (uh, an "issue"?) with Circuit C, namely the large power dissipation in pass transistor $Q_{2}$ under fault conditions such as a shorted output. The bruteforce approach (which we've adopted more often than we care to admit) is to use a husky MOSFET with enough heatsinking to handle $P=V_{\mathrm{IN}} I_{\text {lim }}$; that works OK for modest voltages and currents. Better to add foldback current limiting, as in Figure 12.45C on page 823. But ideally we'd want something like a pass transistor with internal thermal limiting. ${ }^{102}$ That's one benefit of devices like that in Circuit E .

[^162]A popular alternative, at least for low voltage switching, is the use of a low $R_{\mathrm{ON}}$ analog switch (recall Table 3.3 on page 176), as in Circuit D. The switch listed there operates with power-supply voltages from 1.1 V to 4.5 V , with a worst-case $R_{\mathrm{ON}}$ that is plenty good enough to power loads up to 100 mA or so. It may seem strange to be using an analog switch, designed with complementary $n$-channel and $p$-channel MOSFETs for good signal properties over the full rail-to-rail range, as a simple positive-voltage power switch; but these things are inexpensive, and they take care of the logic interfacing and other details for you, so why not?

In Circuit E we've shown the interesting alternative of an $n$-channel MOSFET switch, for which you need to generate a gate drive that is more positive than the input supply voltage, preferably by a healthy 10 volts or so. You can get "high-side driver" ICs for this job, in varieties that cope with speed and voltage tradeoffs (for example the LM9061 in Figure 3.96; see also §§3.5.3, 12.4.2, 12.4.4, and Table 12.5 on page 826). Here we've gone a step further, using a high-side driver that includes the power MOSFET as well. It gets its gate drive signal with an internal oscillator and charge-pump converter (of the sort we saw in §3.4.3D). This particular device is intended for low-voltage operation, and includes internal current limiting and overtemperature protection.

Why bother with all this, when a $p$-channel MOSFET is easier to drive? Although the use of an nMOS switch with high-side drive does add complexity, it benefits from the better characteristics and much wider variety of $n$-channel MOSFETs; it is generally the preferred scheme.

Finally, Circuit F shows how to switch a negative supply rail to a load; it's analogous to Circuit B, but with an $n$ channel switch and a grounded-base pnp transistor to convert a positive logic level into a sourcing current that creates a 10 V gate swing across $R_{2}$. You can (and probably should) add current limiting in the manner of Circuit C.

#### B. Floating power switches

Sometimes you need to switch a voltage (and its load) that's "floating" far from ground. For example, you might want to test the pulsed power capability of a resistor while sensing the current at the low side; or you might want to make millisecond-scale pulsed measurements of a transistor to circumvent heating effects; or you might want a general-purpose floating two-terminal switch that can handle ac or dc. In such situations you can't use the basic ground-referenced schemes of Figure 3.106. Figure 3.107 shows two straightforward approaches, both using an optoisolator (§12.7) to convey the switching command from its ground-referenced home to the floating switch circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0237.jpg?height=899&width=1654&top_left_y=206&top_left_x=125)

Figure 3.106. dc power switching with MOSFETs.

In Circuit A the gates of a pair of series-connected $n$-channel power MOSFETs are driven by a push-pull BJT follower that receives its base drive signal from a self-generating ("photovoltaic") optocoupler, $U_{2}$. The latter uses a series-connected photovoltaic stack to generate a floating $\sim 8 \mathrm{~V}$ signal in response to a 10 mA LED input drive current (see Figure 12.91, and discussion in §1x.7), with some internal circuitry to enhance the turn-off time. The gate driver pair $Q_{1} Q_{2}$ could be omitted at the expense of greater switching time (see below). These drivers reduce the effective load capacitance of the MOSFETs by a factor of beta, so that the resulting switching times (with typical power MOSFETs for $Q_{3}$ and $Q_{4}$ ) are limited by the optocoupler's intrinsic speed, of order $200 \mu \mathrm{~s}$.

Of course the gate drivers $Q_{1}$ and $Q_{2}$ need a floating voltage source, here provided by a second inexpensive optovoltaic generator $U_{1}$, which need not be fast (assuming the circuit is not operated at a rapid switching rate) since it serves only to keep $C_{1}$ charged to $\sim 8 \mathrm{~V}$. You can substitute a floating 9 V battery for $U_{1}$ : it can provide lots more current than $U_{1}$ 's feeble $\sim 20 \mu \mathrm{~A}$ output, but of course you have to replace it from time to time (an alkaline 9 V " 1604 "-style battery is good for about 500 mAh , and has a shelf life of 5 years or so). This circuit can switch either polarity - when ON, the series MOSFETs sum to $2 R_{\text {ON }}$ (the body diodes conduct only during ON-OFF transitions, or
at very high currents). Note that this circuit is an "unprotected" switch - there's no provision for current or power limiting of the output transistors.

Circuit B addresses this vulnerability and leverages the benefits of the BTS555 integrated protected switch. Here we've taken the simple approach of a floating 9 V battery to supply its internal circuitry's operating power ( $15 \mu \mathrm{~A}$ typical when off, 1 mA on). This thing is protected against pretty much anything bad that you can throw at it. Its switching speed is comparable to that of Circuit A (typically $300 \mu \mathrm{~s}$ on, $100 \mu \mathrm{~s}$ off), and it's good for lots of current ( 100 A or more); but it's limited to 34 V across its switch terminals. See §12.4.4 for more details, and Table 12.5 on page 826 for additional component suggestions.

Returning to Circuit A in Figure 3.107, what sort of performance can you get with readily available $n$-channel MOSFETs? Here's a selection of candidates (see Table 3.5 on page 206), culled from the many thousands of possibilities, ${ }^{103}$ spanning the full range of voltages. ${ }^{104}$

Several trends are clearly evident:

[^163]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0238.jpg?height=848&width=1656&top_left_y=209&top_left_x=218)

Figure 3.107. Floating MOSFET power switches: A. bipolarity, unprotected; B. unipolarity, limited voltage, protected.
(a) There's a severe tradeoff of $R_{\mathrm{ON}}$ versus voltage rating - for the listed types the ON-resistance spans a $\sim 100,000$ : 1 range over the $\sim 100: 1$ voltage range.
(b) You also pay a price, literally, for very high-voltage parts; for example, the listed 4.5 kV part costs $\$ 22$.
(c) Higher current parts have greater output capacitance (which is what you see across the switch terminals when OFF), even here where we've carefully selected parts to minimize the $R_{\mathrm{ON}} C_{\text {oss }}$ figure-of-merit tradeoff. They also have larger input capacitance and gate charge, which are relevant to switching speed.
(d) And, important data is missing! You need to go to the datasheets for important information such as thermal resistance, pulse current and pulse energy specifications, gate charge, and the like. The data presented here are at most advisory, and you need to use detailed specifications in the circuit context to predict actual performance. For example, the "maximum pulsed current" specs generally apply to pulse lengths somewhat shorter than this circuit can produce; and the $R_{\mathrm{ON}}$ spec assumes 10 V of gate drive, also somewhat greater than we have here.

Let's finish this example by estimating the switching speed of the circuit of Figure 3.107A. Imagine we want 600 V capability and choose the middle-of-the-road FCP22N60N, a MOSFET that delivers a good combination

[^164]of ON-resistance and capacitance at modest cost (about \$5, qty 100). For switching speed the relevant parameter here is gate charge ( $Q_{\mathrm{GS}}+Q_{\mathrm{GD}}$ ), approximately 25 nC according to tabulated and graphical data. That must be supplied by the isolating driver $U_{2}$, boosted by the current gain $\beta$ of $Q_{1}$ and $Q_{2}$. From $U_{2}$ 's datasheet we can estimate the output sourcing current (from its "Typical Response Time" plot) as approximately $3 \mu \mathrm{~A}$. If for the moment we imagine that $Q_{1}$ and $Q_{2}$ were omitted, with $U_{2}$ driving the MOSFET gates directly, the turn-on time would be $t \approx Q_{\text {gate }} / I_{\mathrm{U} 2}$, or 8.3 ms . Now magically restore the BJT drivers, and the estimated switching time drops by a factor of beta; for typical $\beta \sim 200$ it becomes $\sim 40 \mu \mathrm{~s}$. ${ }^{105}$

Not so fast! Look again at the datasheet for $U_{2}$, you'll find that the turn-on time bottoms out at about $100 \mu \mathrm{~s}$; likewise, its intrinsic turn-off time is about $350 \mu \mathrm{~s}$, even with small load capacitance. Those numbers dominate the performance of Circuit A, for nearly every MOSFET listed, assuming of course that the BJT driver $Q_{1} Q_{2}$ is included. If you can tolerate slower switching, you can simplify things by omitting the drivers and their floating power source.

If you need faster switching, there are many integrated high-side driver chips that can do the job, for example the series of "high-voltage gate-driver ICs" from Interna-

[^165]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0239.jpg?height=479&width=1451&top_left_y=212&top_left_x=226)

Figure 3.108. Ambient-light-controlled power switch.

Table 3.5 MOSFET switch candidates ${ }^{\mathrm{a}}$

| Part \# | $I_{\mathrm{D}(\max )}^{\mathrm{b}}$ |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: |
|  | $B V_{D S}$ <br> (V) | pulse <br> (A) | cont <br> (A) | $2 R_{\mathrm{ON}}{ }^{\mathrm{C}}$ | $\begin{gather*} C_{\text {oss }}{ }^{\mathrm{t}} \\ (\mathrm{pF}) \end{gather*}$ |
| IXTT02N450\$\$ | 4500 | 0.6 | 0.2 | 960 | 19 |
| IXTH02N250\$ | 2500 | 0.6 | 0.2 | 770 | 9 |
| STW4N150 | 1500 | 12 | 2 | 10 | 120 |
| IXTP3N120 | 1200 | 12 | 3 | 6.5 | 100 |
| IXFH16N120P\$ | 1200 | 35 | 10 | 1.7 | 390 |
| IRFBG20 | 1000 | 5.6 | 1 | 16 | 52 |
| IRFBG30 | 1000 | 12 | 2 | 8 | 140 |
| IXFH12N100\$ | 1000 | 48 | 5 | 2 | 320 |
| IPP60R520CP | 650 | 17 | 4 |  | 32 |
| FCP22N60N | 600 | 66 | 12 | 0.28 | 76 |
| FCH47N60N ${ }^{\$}$ | 600 | 140 | 30 | 0.1 | 200 |
| IRF640N | 200 | 72 | 12 | 0.24 | 190 |
| FQP50N06L | 60 | 210 | 25 | $0.08^{\text {d }}$ | 450 |
| IRLB3034 | 40 | 1400 | 125 | $0.003^{\text {e }}$ | 2000 |
| FDP8860 | 30 | 1800 | 100 | $0.004^{\text {d }}$ | 1700 |

Notes: (a) all are in TO-220 or TO-247 pkgs. (b) italics designate maximum pulsed drain current, for pulse width specified in the part's datasheet (e.g., 80 4 s ); boldface designates maximum continuous drain current at $T J=70^{\circ} \mathrm{C}$. (c) at $V_{G S}=10 \mathrm{~V}$, unless marked otherwise. (d) at $V G S=5 \mathrm{~V}$. (e) at $V_{\mathrm{Gs}}=4.5 \mathrm{~V}$. (t) typ. (\$) not inexpensive. (\$\$) expensive.
tional Rectifier. These use internal high-voltage transistors to send the control signals up to the high side, with maximum voltage ratings most commonly of 600 V . These typically have switching times in the range of 100 ns to $1 \mu \mathrm{~s}$. They are intended for cyclic applications such as pulse-width-modulated bridge drivers and use high-side charge pumps to develop the over-the-rail gate drive voltage; but you can adapt them for pulsed applications by substituting a flying 9 V battery, as we've done here. See Chapter 3x's
table "High-voltage Half-Bridge Drivers," and the section on "High-side high-voltage switching" in Chapter $9 x$.

Another class of ICs that can be used in applications like this is typified by Avago's ACPL-300 series of "gate drive optocouplers," which combine an optocoupler and isolated push-pull output stage. For example, the ACPLW343's output stage can source or sink 3 A (minimum), with 40 ns rise and fall times (into a load of 25 nF in series with $10 \Omega$ ), and isolation good to 2 kV . You have to supply $15-30 \mathrm{~V}$ isolated dc for the output stage, ${ }^{106}$ in the manner of Figure 3.107B, with the usual bypass capacitor (for peak output currents); the quiescent current is 2 mA , good for 200 hours of operation if you use a pair of 9 V batteries. See $\S 12.7 .3$ and Figure 12.87 for additional circuit discussion and suggestions.

#### C. Some unusual switching examples

#### Light-at-night

Figure 3.108A shows a simple MOSFET switching example, one that takes advantage of the high gate impedance. You might want to turn on exterior lighting automatically at sunset. The photoresistor has low resistance in sunlight, high resistance in darkness. You make it part of a resistive divider, driving the gate directly (no dc loading!). The light goes on when the gate voltage reaches the value that produces enough drain current to close the relay. Sharp-eyed readers may have noticed that this circuit is not particularly precise or stable; that's OK, because the photoresistor undergoes an enormous change in resistance (from 10k to 10M, say) when it gets dark. Note that the MOSFET may have to dissipate some power during the time the gate bias is inching up, since we're operating in the linear region;

[^166]but it's switching only a relay, not the power load, so this is of little concern. The circuit's lack of a precise and stable threshold means that the light may turn on a few minutes early or late - again, no big deal. But an additional worry is the behavior of the relay, which is not happy with a marginal coil-driving voltage (which holds the contacts closed with less than the rated mechanical force, thus potentially shortening the relay's life; see the discussion of relays in Chapter 9x).

These problems are remedied in Figure 3.108B, where a pair of cascaded MOSFETs delivers much higher gain, augmented by some positive feedback through the 10 M resistor; the latter adds hysteresis, which causes the circuit to snap on regeneratively as it reaches threshold.

#### Hefty piezo driver

Figure 3.109 shows a real power MOSFET job: a 200 watt amplifier to drive a piezoelectric underwater transducer at 200 kHz . We've used a pair of hefty nMOS transistors, driven alternately to create ac drive in the (high-frequency) transformer primary. The series inductor in the secondary resonates with the transducer's capacitance to step up the voltage across the piezo to several kilovolts. The TC4425A is a handy "3A Dual High-Speed Power MOSFET Driver" (like the TC4420 in Figure 3.97), which takes a logiclevel input ( $0 \mathrm{~V}=$ Low, $\geq 2.4 \mathrm{~V}=\mathrm{HIGH}$ ), and generates a full-swing ( 0 to $+V_{\mathrm{DD}}$ ) output pair, one inverted and the other noninverted; see Table 3.8 on page 218. It's needed to overcome capacitive loading, since the MOSFETs must be turned on fully in a fraction of a microsecond. The diodes shunted across the series gate resistors cause a rapid turnoff to prevent undesirable conduction overlap of the power transistors.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0240.jpg?height=516&width=805&top_left_y=1709&top_left_x=220)

Figure 3.109. MOSFET piezo power driver.

### 3.5.7 IGBTs and other power semiconductors

The contemporary power MOSFET is a versatile transistor for both power switching applications (e.g., dc power control, or dc-dc switching converters), and for linear power applications (such as audio amplifiers). But there are some drawbacks and some useful alternatives.

#### A. Insulated-gate bipolar transistor (IGBT)

The IGBT is an interesting MOSFET-bipolar hybrid, most simply described as an integrated complementary-Darlington-like (Sziklai) connection of an input MOSFET with a power bipolar transistor (Figure 3.110). So it has the input characteristics of a MOSFET (zero dc gate current), combined with the output characteristics of a power bipolar transistor; note, however, that it cannot saturate to less than $V_{\mathrm{BE}}$. Unlike MOSFETs, IGBTs do not have an intrinsic reverse diode, so inductive ringing, etc., can easily exceed the reverse voltage rating (e.g., 20 V ). Many IGBTs include an internal "anti-parallel" diode to protect against this problem. ${ }^{107}$
<img class="imgSvg" id = "m2y4u42rov7fadsxir" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDJyb3Y3ZmFkc3hpciIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTkzIDg5LjI1MDAxODM2NDg5MDA0IiBzdHlsZT0id2lkdGg6IDE5My4xMTkyMDA4NzY4MTQ1NXB4OyBoZWlnaHQ6IDg5LjI1MDAxODM2NDg5MDA0cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDJyb3Y3ZmFkc3hpci0xIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeTE9IjIxLjAwMDAzNjcyOTgwMTQ4IiB4Mj0iMTUxLjExOTIwMDg3NjgxNDU1IiB5Mj0iMzYuNzUwMDU1MDk0Njk4NjUiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDJyb3Y3ZmFkc3hpci0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjQ1MjU4NDgyNjMwODQ1IiB5MT0iMzAuMjY0NjU0MjUzMzk0NDgyIiB4Mj0iMTE4LjI3NjQzMzQ4NDA1NTY2IiB5Mj0iMTcuNjY0NjY4OTQ1MzE3OTE0Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQycm92N2ZhZHN4aXItNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTE9IjM2Ljc1MDAxODM2NDg5NzE3IiB4Mj0iMTIzLjgzOTQxMTI2MDU5MTI5IiB5Mj0iMjEuMDAwMDM2NzI5ODAxNDgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDJyb3Y3ZmFkc3hpci03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijk2LjU1OTU3OTIzMjQ0NjUiIHkxPSI2OC4yNTAwMTgzNjQ4OTAwNCIgeDI9Ijk2LjU1OTYwMDQzODQwNzI3IiB5Mj0iMzYuNzUwMDE4MzY0ODk3MTciPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDJyb3Y3ZmFkc3hpci05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjY5LjI3OTgxMDgyMjE4NDAyIiB5MT0iMjEiIHgyPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTI9IjM2Ljc1MDAxODM2NDg5NzE3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQycm92N2ZhZHN4aXItMTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNDIiIHkxPSIzNi43NDk5ODE2MzUwOTU2OSIgeDI9IjY5LjI3OTgxMDgyMjE4NDAyIiB5Mj0iMjEiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxtYXNrIGlkPSJ0ZXh0LW1hc2stbTJ5NHU0MnJvdjdmYWRzeGlyIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjxjaXJjbGUgY3g9Ijk2LjU1OTU3OTIzMjQ0NjUiIGN5PSI2OC4yNTAwMTgzNjQ4OTAwNCIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48Y2lyY2xlIGN4PSI0MiIgY3k9IjM2Ljc0OTk4MTYzNTA5NTY5IiByPSI3Ljg3NSIgZmlsbD0iYmxhY2siPjwvY2lyY2xlPjwvbWFzaz48c3R5bGU+CiAgICAgICAgICAgICAgICAuZWxlbWVudC1tMnk0dTQycm92N2ZhZHN4aXIgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQycm92N2ZhZHN4aXIgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTJ5NHU0MnJvdjdmYWRzeGlyKSI+PGxpbmUgeDE9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeTE9IjIxLjAwMDAzNjcyOTgwMTQ4IiB4Mj0iMTUxLjExOTIwMDg3NjgxNDU1IiB5Mj0iMzYuNzUwMDU1MDk0Njk4NjUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQycm92N2ZhZHN4aXItMScpIj48L2xpbmU+PGxpbmUgeDE9Ijk2LjQ1MjU4NDgyNjMwODQ1IiB5MT0iMzAuMjY0NjU0MjUzMzk0NDgyIiB4Mj0iMTE4LjI3NjQzMzQ4NDA1NTY2IiB5Mj0iMTcuNjY0NjY4OTQ1MzE3OTE0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MnJvdjdmYWRzeGlyLTMnKSI+PC9saW5lPjxsaW5lIHgxPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTE9IjM2Ljc1MDAxODM2NDg5NzE3IiB4Mj0iMTIzLjgzOTQxMTI2MDU5MTI5IiB5Mj0iMjEuMDAwMDM2NzI5ODAxNDgiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQycm92N2ZhZHN4aXItNScpIj48L2xpbmU+PGxpbmUgeDE9Ijk2LjU1OTU3OTIzMjQ0NjUiIHkxPSI2OC4yNTAwMTgzNjQ4OTAwNCIgeDI9Ijk2LjU1OTYwMDQzODQwNzI3IiB5Mj0iMzYuNzUwMDE4MzY0ODk3MTciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQycm92N2ZhZHN4aXItNycpIj48L2xpbmU+PGxpbmUgeDE9IjY5LjI3OTgxMDgyMjE4NDAyIiB5MT0iMjEiIHgyPSI5Ni41NTk2MDA0Mzg0MDcyNyIgeTI9IjM2Ljc1MDAxODM2NDg5NzE3IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0MnJvdjdmYWRzeGlyLTknKSI+PC9saW5lPjxsaW5lIHgxPSI0MiIgeTE9IjM2Ljc0OTk4MTYzNTA5NTY5IiB4Mj0iNjkuMjc5ODEwODIyMTg0MDIiIHkyPSIyMSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDJyb3Y3ZmFkc3hpci0xMScpIj48L2xpbmU+PC9nPjxnPjx0ZXh0IHg9IjE1MS4xMTkyMDA4NzY4MTQ1NSIgeT0iMzYuNzUwMDU1MDk0Njk4NjUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyMy44Mzk0MTEyNjA1OTEyOSIgeT0iMjEuMDAwMDM2NzI5ODAxNDgiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijk2LjU1OTYwMDQzODQwNzI3IiB5PSIzNi43NTAwMTgzNjQ4OTcxNyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iOTEuMzA5NTc5MjMyNDQ2NSIgeT0iNzMuNTAwMDE4MzY0ODkwMDQiIGNsYXNzPSJlbGVtZW50LW0yeTR1NDJyb3Y3ZmFkc3hpciIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGx0cjsKICAgICAgICAgICAgIj48dHNwYW4+TzwvdHNwYW4+PHRzcGFuIHN0eWxlPSJ1bmljb2RlLWJpZGk6IHBsYWludGV4dDsiPkg8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSI5Ni41NTk1NzkyMzI0NDY1IiB5PSI2OC4yNTAwMTgzNjQ4OTAwNCIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNjkuMjc5ODEwODIyMTg0MDIiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI0Ny4yNSIgeT0iNDEuOTk5OTgxNjM1MDk1NjkiIGNsYXNzPSJlbGVtZW50LW0yeTR1NDJyb3Y3ZmFkc3hpciIgZmlsbD0iY3VycmVudENvbG9yIiBzdHlsZT0iCiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICAgICB3cml0aW5nLW1vZGU6IGhvcml6b250YWwtdGI7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiBtaXhlZDsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IHJ0bDsgdW5pY29kZS1iaWRpOiBiaWRpLW92ZXJyaWRlOwogICAgICAgICAgICAiPjx0c3Bhbj5GPC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjM2Ljc0OTk4MTYzNTA5NTY5IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0240.jpg?height=241&width=228&top_left_y=1119&top_left_x=1457)

Figure 3.110. IGBT symbol and simplified equivalent circuit showing the optional "anti-parallel" diode.

Nearly all available IGBTs come in the nMOS-pnp polarity only, and thus behave as $n$-type devices. ${ }^{108}$ They are generally high-voltage and high-power devices, available in discrete transistor power packages like the TO-220, TO247, and in surface-mount packages like the D2 ${ }^{2}$ PAK and SMD-220, with ratings to 1200 V and 100 A . For higher currents you can get them in larger rectangular power "modules," with higher voltage ratings and with current ratings to 1000 A or more.

IGBTs excel in the arena of high voltage switching, because high-voltage MOSFETs suffer from greatly increased $R_{\mathrm{ON}}$ : an approximate rule-of-thumb for MOSFETs is that the $R_{\mathrm{ON}}$ increases as the square of the voltage

[^167]rating. ${ }^{109}$ For example, let us compare two power products from International Rectifier (along with a BJT of comparable ratings):

|  |  | MOSFET | IGBT | BJT |
| ---: | :---: | :---: | :---: | :---: |
| Type |  | IRFPG50 | IRG4PH50S | TT2202 |
| $V_{\max }$ |  | 1000 V | 1200 V | 1500 V |
| $I_{\max }$ | dc | 6.1 A | 57 A | 10 A |
|  | pulse | 24 A | 114 A | 25 A |
| $R_{\mathrm{ON}}($ typ $)$ | $25^{\circ} \mathrm{C}$ | $1.5 \Omega$ | - | - |
|  | $150^{\circ} \mathrm{C}$ | $4 \Omega$ | - | - |
| $V_{\mathrm{ON}}$ | $25^{\circ} \mathrm{C}$ | 23 V | 1.2 V | 1 V (@8 A) |
| $(t y p, 15 \mathrm{~A})$ | $150^{\circ} \mathrm{C}$ | 60 V | 1.2 V | 1 V (@8 A) |

These are comparably priced (about \$5) and packaged (TO-247), have similar input characteristics ( 2.8 nF and 3.6 nF input capacitance), and the resulting saturation voltages $V_{\mathrm{ON}}$ when switching 15 A are shown for the same full input drive of $V_{\text {in }}=+15 \mathrm{~V}$. The IGBT is the clear winner in this high-voltage and high-current regime. ${ }^{110}$ And, when compared with a power BJT, it shares the MOSFET advantage of high static input impedance (though still exhibiting the drastically reduced dynamic input impedance during switching, as we saw in §3.5.4B). The BJT does have the advantage of lower saturation voltage (the IGBT's $V_{\mathrm{ON}}$ is at least $V_{\mathrm{BE}}$ ) and lower drive voltage (see the figure in Chapter 3x's section 'Power transistors for linear amplifiers"), at the expense of a high static driving current; the latter drawback is exacerbated at high currents, where BJT beta drops rapidly. A saturated BJT also suffers from slow recovery owing to stored charge in the base region.

With the very high voltages and currents encountered with IGBTs, it is mandatory to include fault protection in the circuit design: an IGBT that may be required to switch up to a 50 A load from a 1000 V supply will be destroyed in milliseconds if the load becomes short-circuited, owing to the 50 kW (!) power dissipation. The usual method is to shut off the drive if $V_{\mathrm{CE}}$ has not dropped to just a few volts after $5 \mu \mathrm{~s}$ or so of input drive (see Figure 12.87B). We'll revisit these three power transistor technologies in Chapter 3x.

#### B. Thyristors

For the utmost in really high-power switching (we're talking kiloamperes and kilovolts), the preferred devices are

[^168]the thyristor family, which include the unidirectional "silicon controlled rectifiers" (SCRs) and the bidirectional "triacs." These three-terminal devices behave somewhat differently from the transistors we've seen (BJTs, FETs, and IGBTs): once triggered into conduction by a small control current (a few milliamps) into their control electrode (the gate), they remain ON until external events bring the controlled current (from anode to cathode) to zero. They are used universally in house-current lamp dimmers, where they are switched on for a fraction of each half-cycle of ac line voltage, thus varying the conduction angle.

Thyristors are available in ratings from 1 A to many thousands of amperes, and voltage ratings from 50 V to many kilovolts. They come in small transistor packages, the usual transistor power packages, larger modules, and really scary "hockey puck" packages that are capable of switching megawatts. These are hefty devices; you can hurt yourself just by dropping one on your foot.

## 3.6 MOSFETs in linear applications

Although we dealt extensively with linear applications in this chapter's treatment of JFETs, our discussion of MOSFETs has concentrated almost entirely on switching applications. Lest we leave the wrong impression, we address in this section some applications of discrete power MOSFETs to linear applications, particularly those that benefit from their unique properties. See also additional applications to linear voltage regulators in Chapter 9 (e.g., Figures 9.17, $9.20,9.104,9.110$, and 9.113), and advanced material in §3x.5.

### 3.6.1 High-voltage piezo amplifier

A nice application of MOSFETs as linear amplifiers takes advantage of available types with high voltage ratings, and their immunity to second breakdown. Ceramic piezoelectric transducers are often used in optical systems to produce controlled small motions; for example, in adaptive optics you might use a piezoelectrically controlled "rubber mirror" to compensate for local variations in the index of refraction of the atmosphere. Piezo transducers are nice to use, because they're very stiff. Unfortunately, they may require as much as a kilovolt of drive to produce significant motions. Furthermore, they're highly capacitive - typically $0.01 \mu \mathrm{~F}$ or more - and have mechanical resonances in the kilohertz range, thus presenting a nasty load. We needed dozens of such driver amplifiers, which for some reason cost a few thousand dollars apiece if you buy them commercially.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0242.jpg?height=863&width=1541&top_left_y=214&top_left_x=275)

Figure 3.111. 1 kV low-power piezo driver with totem-pole output stage. A similar design is used for the high-voltage regulated dc supply shown in Figure 9.110.

We solved our problem with the circuit shown in Figure 3.111. The IRFBG20 is an inexpensive ( $\sim$ \$2) MOSFET, good for 1 kV and 1.4 A ; the similar FQD2N100 $(1 \mathrm{kV}, 1.6 \mathrm{~A})$ costs about $\$ 0.85$. The first transistor is a common-source inverting amplifier, driving a source follower with active current-sink load. The npn transistor is a current limiter and can be a low-voltage unit, since it floats on the output. One subtle feature of the circuit is the fact that it's actually push-pull, even though it looks single-ended: you need plenty of current ( 20 mA ) to push $10,000 \mathrm{pF}$ around at $2 \mathrm{~V} / \mu \mathrm{s}$; the output transistor can source current, but the pulldown resistor can't sink enough (look back to §2.4.1, where we motivated pushpull with the same problem). In this circuit the driver transistor is the pull-down, with conduction through the gatesource diode! ${ }^{111}$ The rest of the circuit involves feedback with op-amps, a forbidden subject until the next chapter; in this case the magic of feedback makes the overall circuit linear ( 100 V of output per volt of input), whereas without it the output voltage would depend on the (nonlinear) $I_{\mathrm{D}^{-}}$ versus- $V_{\mathrm{GS}}$ characteristic of the input transistor. A nice improvement to this circuit consists of replacing the $660 \mathrm{k} \Omega$ 3 W pullup resistor (whose current drops at high output

[^169]voltages, e.g., to 0.15 mA at 900 V ) with a depletion-mode MOSFET current source set to, say, 0.25 mA . See the discussion below (§3.6.2C, and also Figure 3.23, Table 3.6, and §§9.3.14C and $3 x .6$ ).

For a detailed analysis of a precision high-voltage amplifier with bipolarity output capability, see the section with that name in Chapter $4 x$. For an analysis of relevant issues, such as MOSFET transconductance at low currents, see $\S 3 x .5 .2$, and for the response of a MOSFET source follower into a capacitive load see §3x.8.

Exercise 3.18. Modify this circuit so the high-voltage output can be turned on and off, under control of an input signal ( 0 V for off, +3 V for on).

### 3.6.2 Some depletion-mode circuits

Depletion-mode MOSFETs are the neglected siblings of the far more popular enhancement-mode MOSFETs. They can do some nice tricks, though, that are worth knowing about. And they are available in high voltage (to 1 kV ) and high current (to 6 A) varieties. Table 3.6 on the following page lists nearly all available parts of this somewhat rarefied species. Here are some applications that exploit their property of conduction at zero gate voltage.

Table 3.6 Depletion-mode $n$-channel MOSFETs

|  |  | Available packages |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# | Manuf | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0243.jpg?height=132&width=278&top_left_y=322&top_left_x=477) |  |  |  |  |  |  |  | $\begin{gathered} B V_{\mathrm{Ds}} P_{\mathrm{D}}{ }^{c} \\ (\mathrm{~V}) \end{gathered}$ |  | $\frac{I_{D}}{\min }$ | s <br> max <br> (mA) | $R_{\mathrm{ON}}{ }^{\mathrm{t}}$ <br> @VGS= <br> ( $\Omega$ ) | $\begin{gathered} g_{m}{ }^{\mathrm{t}} \\ (\mathrm{mS}) \end{gathered}$ | @ID <br> (A) | $\begin{gathered} \frac{V_{\mathrm{G}}}{\min } \\ (\mathrm{~V}) \end{gathered}$ | (th) <br> max <br> (V) | Ciss <br> typ <br> (pF) | Coss Crss <br> typ typ <br> (pF) (pF) |  | $\operatorname{Cost}^{y}$ <br> \$US |
| small, RF |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| BF998 | NXP | - | f | - | - | - | - | - | - | 12 | - | 2 | 18 | - | 24 | 0.01 | - | -2 | 2.1 | 1.1 | 0.025 | - |
| BF999 | Vishay | - | $\cdot$ | - | - | - | - | - | - | 20 | - | 5 | 18 | - | 16 | 0.01 | - | -2.5 | 2.5 | 1.0 | 0.025 | - |
| small |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  | - |
| DN2470K4 S | Supertex | - | - | - | - | - | - | - | $\cdot$ | 700 | 2.5 | 50 |  | $42^{\mathrm{m}}$ | $100^{n}$ | 0.1 | -1.5 | $-3.5$ | 540 | 60 | 25 | 0.81 |
| BSS126 | Infineon | - | $\cdot$ | - | - | - | - | - | - | 600 | 0.5 | 7 | - | 320 | 17 | 0.01 | -2.7 | -1.6 | 21 | 2.4 | 1 | 0.13 |
| BSP135 | Infineon | - | - | - | $\cdot$ | - | - | - | - | 600 | 1.8 | 20 | - | 30 | 160 | 0.1 | -1.8 | -1.0 | 98 | 8.5 | 3.4 | 1.38 |
| LND150 S | Supertex | $\checkmark$ | k | $\cdot$ - | - | - | - | - | - | 500 | 0.7 | 1 | 3 | 850 | 2 | 0.001 | -1.0 | -3 | 7.5 | 2 | 0.5 | 0.58 |
| DN3145 S | Supertex | - | - | $\cdot$ - | - | - | - | - | - | 450 | 1.3 | 120 | - | 60 | $140^{\text {n }}$ | 0.1 | -1.5 | $-3.5$ | 120 | 15 | 10 | 0.68 |
| DN3545 S | Supertex | $\cdot$ | - | $\checkmark$ | - | - | - | - | - | 450 | 1.6 | 200 | - | 20 m | $150^{\text {n }}$ | 0.1 | -1.5 | $-3.5$ | 360 | 40 | 15 | 0.74 |
| DN2540 S | Supertex | $\cdot$ | - | $\diamond$ | - | $\cdot$ | - | - | - | 400 | 1.6 | 150 | - | 17 | 325 | 0.1 | -1.5 | $-3.5$ | 200 | 12 | 1 | 0.81 |
| DN3135 S | Supertex | - |  | $\diamond$ | - | - | - | - |  | 350 | 1.3 | 180 | - | $35^{\mathrm{m}}$ | 140 | 0.1 | -1.5 | $-3.5$ | 60 | 6 | 1 | 0.62 |
| CPC3720C | Clare | - | - | $\cdot$ | - | - | - | - | - | 350 | 1.6 | 130 | - | $22^{\mathrm{m}}$ | 225 | 0.1 | -1.6 | -3.9 | 70 | 20 | 10 | 0.37 |
| CPC5603C | Clare | - | - | - | $\cdot$ | - | - | - | - | 415 | 2.5 | 130 | - | $14^{\mathrm{m}}$ | - | - | -3.6 | -2 | 300 | - | - | 0.69 |
| CPC5602C | Clare | - | - | - | $\cdot$ | - | - | - | - | 350 | 2.5 | 130 | - | $14^{\mathrm{m}}$ | - | - | -3.6 | -2 | 300 | - | - | 0.60 |
| DN3535 S | Supertex | - | - | $\cdot$ | - | - | - | - | - | 350 | 1.6 | 200 | - | $10^{\mathrm{m}}$ | $200^{n}$ | 0.1 | -1.5 | $-3.5$ | 360 | 40 | 10 | 0.68 |
| BSS139 | Infineon | - | $\cdot$ | - | - | - | - | - | - | 250 | 0.4 | 30 | - | 12.5 | 130 | 0.08 | -1.4 | - | 60 | 6.7 | 2.6 | 0.57 |
| BSP129 | Infineon | - | - | - | $\cdot$ | - | - | - | - | 240 | 1.8 | 50 | - | 6.5 | 360 | 0.28 | -2.1 | $-1.0$ | 82 | 12 | 6 | 0.47 |
| DN3525N8 S | Supertex | - | - | $\cdot$ - | - | - | - | - | - | 250 | 1.6 | 300 | - | $6^{\text {m }}$ | $225^{\text {n }}$ | 0.15 | -1.5 | -3.5 | 270 | 20 | 5 | 0.66 |
| CPC3703 | Clare | - | - | $\cdot$ | - | - | - | - | - | 250 | 1.6 | 300 | - | $4^{\text {m }}$ | $225^{\text {n }}$ | 0.1 | -1.6 | -3.9 | 327 | 51 | 27 | 0.57 |
| BSP149 | Infineon | - | - | - | $\cdot$ | - | - | - | - | 200 | 1.8 | 140 | - | 1.7 | 800 | 0.48 | -1.8 | -1.0 | 326 | 41 | 17 | 0.80 |
| BSS159 | Infineon | - | $\cdot$ | - | - | - | - | - | - | 50 | 0.4 | 70 | - | 4 | 160 | 0.16 | $-2.5$ | 0.0 | 70 | 15 | 6 | 0.31 |
| large |  |  |  |  |  | see | no | ot |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| IXTx01N100D ${ }^{\text {X }}$ | IXYS | - | - | - | - P | P | - | - | Y | 1000 | 25 | 10 |  | 90 | 150 | 0.1 | -2.5 | - | 120 | 25 | 5 | 0.75 |
| IXTx08N100D2 ${ }^{x}$ | IXYS | - | - | - | - P | P | - | - | Y | 1000 | 60 | 10 |  | 21 m | 560 | 0.4 | -2 | -4 | 325 | 24 | 6.5 | 0.69 |
| IXTx1R6N100D2 ${ }^{x}$ | IXYS | - | - | - | - P | P | - | - | Y | 1000 | 100 | 10 |  | 21 m | 1100 | 0.8 | -2.5 | -4.5 | 645 | 43 | 11 | 1.66 |
| IXTx3N100D2 ${ }^{\text {X }}$ | IXYS | - | - | - | P | P | - | A | - | 1000 | 125 | 3000 | - | $5.5^{\mathrm{m}}$ | 4200 | 3 | -2.5 | -4.5 | 1020 | 68 | 17 | 2.11 |
| IXTx6N100D2 ${ }^{\text {X }}$ | IXYS | - | - | - | - P | P | H | A | - | 1000 | 300 | 6000 | - | $5.5^{\mathrm{m}}$ | 4200 | 3 | -2.5 | -4.5 | 2650 | 167 | 41 | 4.66 |
| IXTx02N50D2 ${ }^{\text {X }}$ | IXYS | - | - | - | - P | P | - | - | Y | 500 | 25 | 25 |  | 20 | 150 | 0.2 | -2 | -5 | 120 | 25 | 5 | 1.05 |
| IXTx08N50D2 ${ }^{\text {X }}$ | IXYS | - | - | - | - P | P | - | A | - | 500 | 60 | 800 | - | $4.6^{\text {m }}$ | 570 | 0.4 | -2 | -4 | 312 | 35 | 11 | 1.62 |
| IXTx1R6N50D2 ${ }^{\text {X }}$ | IXYS | - | - | - | - P | P | - | - | Y | 500 | 100 | 160 |  | 2.3 | 1750 | 0.8 | -2 | -4 | 645 | 65 | 17 | 1.66 |
| IXTx3N50D2 ${ }^{x}$ | IXYS | - | - | - | - P | P | - A | A | - | 500 | 125 | 160 |  | 1.5 | 2100 | 1.5 | -2 | -4 | 1070 | 102 | 24 | 2.13 |
| IXTx6N50D2 ${ }^{x}$ | IXYS | - | - | - | P | P | H | A | - | 500 | 300 | 6000 | 枵 | $0.5^{\mathrm{m}}$ | 4500 | 3 | -2 | -4 | 2800 | 255 | 64 | 4.66 |
| IXTH20N50D ${ }^{\text {X,e }}$ | e IXYS | - | - | - | - | - H | H | - | - | 500 | 400 |  | $0^{\text {te }}$ | $0.5^{\mathrm{m}}$ | 7500 | 10 | -1.5 | $-3.5$ | 2500 | 400 | 100 | 8.61 |

Notes: (c) $P_{D}$ at $T_{C}=25^{\circ} \mathrm{C}$, for package marked $\diamond$. (e) the IXTH20N50D delivers most of its current capability in the enhancement-mode region. (f) has two gates, 4-lead SOT-143 package. (g) SC-70 package. (k) unusual pinout; also try LND250K1. (m) maximum. (n) minimum. (s) SKY part's full name: SKY65050-372LF. (t) typical. (x) substitute the letter listed in the package column for the " $x$ " in the part number; for example, IXTP01N100D is a TO-220 package. (y) quantity 100.

#### A. Input protection

Low-level circuits (such as sensitive amplifiers) don't like to be driven beyond their power supply rails. One simple protection scheme uses a series resistor at the input, with a pair of downstream clamp diodes to the amplifier's supply rails. That's OK for small overdrive; but it's unsatisfac-
tory if the input may go to a few hundred volts (think powerline!), because the large resistor value ( $\sim 100 \mathrm{k}$ or so, to limit the fault current and dissipated power) compromises the signal bandwidth and noise. Figure 3.112 shows how to use a pair of depletion-mode MOSFETs (instead of a large resistor) as the series element. The particular part shown
is small (SOT23, SOT89, or TO-92), inexpensive (\$0.60), and able to withstand momentary inputs to $\pm 500 \mathrm{~V}$. The pair looks like a series resistance of $\sim 1.7 \mathrm{k}\left(\mathrm{twice} R_{\mathrm{DS}(\mathrm{ON})}\right)$ until the input goes beyond the amplifier's rails, whereupon it limits the current through the clamp diodes to $\sim 2 \mathrm{~mA}$. See some subtleties in "A Riff on Robust Input Protection" (§5.15.5).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0244.jpg?height=346&width=679&top_left_y=531&top_left_x=283)

Figure 3.112. Protecting a low-level input from outrageous overvoltage "faults." Under normal conditions the series-connected depletion-mode MOSFETs $Q_{1}$ and $Q_{2}$ (with their intrinsic body diodes shown) conduct with an effective series resistance of $R_{\mathrm{ON}} \sim 1 \mathrm{k} \Omega$ each. An input signal beyond the amplifier's $\pm 15 \mathrm{~V}$ rails is clamped by diodes $D_{1}$ or $D_{2}$, with $Q_{1}$ and $Q_{2}$ safely limiting the clamp current to their $I_{\mathrm{DSS}} \sim 2 \mathrm{~mA}$. See also Figure 5.81.

#### B. HV capacitor discharge

Human contact with a circuit at a few hundred volts can be, well, a shocking experience. That's why it's considered good manners to arrange things so that storage capacitors charged to such voltages are discharged promptly after power is removed. Capacitors, after all, have pretty good memory - they can stay charged for hours, or even years (that's how bits are stored in "flash memory," see §14.4.5).

The traditional approach is to put a "bleeder" resistor across the storage capacitor, sized to discharge it in $\sim 10 \mathrm{~s}$ or so. Good enough. But it is not really satisfactory when you have a large-value capacitor, for example one used to store the energy for a short-duration high-voltage pulse generator. Figure 3.113 shows such an application, with a $100 \mu \mathrm{~F}$ storage capacitor charged to +400 V by a lowpower dc-dc converter (say 10 W ), the latter powered from a low-voltage dc supply that also powers the other pulsegenerator circuitry.

What you'd like is a bleeder resistor that is connected only when the external power is removed. Here depletionmode MOSFET $Q_{1}$ is held in the nonconducting state when the supply is powered $\left(V_{G S}=-9 \mathrm{~V}\right)$, but is sent into conduction ( $V_{\mathrm{GS}} \approx 0.6 \mathrm{~V}$ ) when the +12 V is absent. It's rated at $500 \mathrm{~V}, 3 \mathrm{~A} I_{\mathrm{DSS}}(\mathrm{min})$, and costs about $\$ 2$. (You can get depletion-mode MOSFETs up to 1 kV .) We don't need 3 A (which would discharge $100 \mu \mathrm{~F}$ in just 13 ms ); but we do need a MOSFET large enough to absorb the stored energy,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0244.jpg?height=399&width=797&top_left_y=209&top_left_x=1076)

Figure 3.113. Depletion-mode MOSFET $Q_{1}$ discharges the $100 \mu \mathrm{~F}$ high voltage capacitor $C_{1}$ when power is removed; when powered it is inactive.
here 8 joules - this part can absorb a $25-50 \mathrm{~J}$ pulse without exceeding $T_{\mathrm{J}(\max )}$ (see Chapter $\left.9 x\right)$. Follower $Q_{2}$ boosts the discharge current, which otherwise would be just a few milliamps (set by bleeder $R_{2}$ ).

#### C. Current source

Depletion-mode power MOSFETs make excellent 2terminal current sources, capable of high voltages (to 1000 V for some parts, see Table 3.6) and many watts of power dissipation. They extend the basic idea, seen earlier with JFETs (\$3.2.2, Figures 3.20 and 3.23), to higher voltage and power levels. Because these applications are associated with power, we defer the discussion to Chapter 9 (§9.3.14C), where you can see that the circuits are the same as with JFETs (Figure 9.36), and you can delight in curves of measured current versus voltage (Figures 9.40 and 9.41 ). ${ }^{112}$ Such a depletion-mode MOSFET current source is ideal for an application like the highvoltage piezo driver we just saw (\$3.6.1), where it can replace the primitive 660 k power-resistor pullup and thereby supply approximately constant driver-stage drain current over the signal swing.

#### D. Extending regulator $V_{\text {IN }}$

Sometimes you need to extend the permissible range of dc input voltage to some low-voltage device. Figure 3.114A shows an example: a linear voltage regulator (§9.3) that provides +3.3 V (for example) from a higher dc input. Such regulators have limited maximum input voltage range perhaps +20 to +30 V (if made with BJTs), or as little as +6 V (if made with CMOS). Here the $n$-channel depletionmode MOSFET $Q_{1}$ is wired as a follower, providing at the regulator's input a voltage that is greater than $V_{\text {OUT }}$ by the

[^170]magnitude of its $V_{\mathrm{GS}}$; for the IXTP08N50 $V_{\mathrm{GS}}$ is between -2 and -4 V , so the regulator's input is held between 2 and 4 V above its output. The circuit's input voltage can go to +500 V ( $Q_{1}$ 's rated maximum), with due regard to heat dissipation of course. The resistor $R_{\text {CL }}$ protects $Q_{1}$ by setting a rough current limit. You can play the same trick with a constant-current regulator (Figure 3.114B). For details see the fuller discussion in Chapter 9 (§9.13.2). See also §3x. 6 for a discussion of the use of depletion-mode MOSFETs as current sources, especially at high voltages.

### 3.6.3 Paralleling MOSFETs

You sometimes hear the statement that power MOSFETs can be paralleled directly (without ballasting resistors in the source leads), because their negative temperature coefficient of $I_{\mathrm{D}}$ at fixed $V_{\mathrm{GS}}$ guarantees automatic redistribution of drain currents in a paralleled array. Furthermore, the story goes, the same property prevents thermal runaway.

### A. As switches - Yes!

Power MOSFETs exhibit negative tempco of $I_{\mathrm{D}}$ - but only at high drain currents (or, more accurately, at relatively
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0245.jpg?height=869&width=677&top_left_y=1198&top_left_x=182)

Figure 3.114. A. A high voltage depletion-mode MOSFET extends the input voltage range of a series voltage regulator. B. An analogous circuit for a current source. For good performance at high frequencies $C_{1}$ should be small, or even eliminated altogether. See Figure 9.104, where the is are dotted, ts are crossed, and all is explained.
large values of $V_{\mathrm{GS}}$ ), as seen in Figure 3.115. For switching applications, in which you are operating at essentially zero $V_{\mathrm{DS}}$ (limited by $R_{\mathrm{ON}}$ ), the large gate drive puts the device into the region of negative $I_{\mathrm{D}}$ tempco, so you can (and should) simply tie multiple MOSFETs in parallel, with no ballasting resistors. ${ }^{113}$ Here $R_{\text {ON }}$ increases with increasing temperature (Figure 3.116), and the parallel connection shares drain current (and power) properly.

The positive tempco of $R_{\mathrm{ON}}$, though helpful for parallel
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0245.jpg?height=547&width=774&top_left_y=622&top_left_x=991)

Figure 3.115. Transfer characteristics ( $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ ) for the IRF1405 $n$-channel power MOSFET. Note that the temperature coefficient is positive except at the highest drain currents ( $>175 \mathrm{~A}$ ); for linear applications you would rarely exceed 10 A of drain current.
operation of MOSFET switches, creates a new problem, namely the possibility of thermal runaway. See §3.6.4.

#### B. In linear power circuits - No!

Here the situation is more complicated: in most linear applications (e.g., audio power amplifiers, in which there is substantial voltage $V_{\mathrm{DS}}$ across the transistor) you are operating in the positive tempco region of relatively low drain currents - because otherwise the power dissipation ( $I_{\mathrm{D}} V_{\mathrm{DS}}$ ) would be much greater than allowable by thermal considerations (i.e., excessive junction temperature; see §9.4.1A). For example, the transistor of Figure 3.115 is limited to 200 watt dissipation at a case temperature of $75^{\circ} \mathrm{C}$; so, in a circuit with 25 V across it, the average drain current is limited to 8 A , in which $I_{\mathrm{D}}$ has a large positive tempco. So, for practical linear applications - in which you operate

[^171]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0246.jpg?height=477&width=705&top_left_y=213&top_left_x=260)

Figure 3.116. on-resistance increases with increasing temperature: $R_{\mathrm{ON}}$ versus temperature for the IRF1405 $n$-channel power MOSFET.
with substantial $V_{\mathrm{DS}}$ - unequal current sharing of paralleled MOSFETs is in fact exacerbated. And, because you're using multiple transistors exactly because a single one won't handle the power, the circuit is in serious trouble; a single transistor will likely hog an excessive share of the current, putting its dissipation well over the limit set by thermal resistance and heatsinking.

#### Source-ballast resistors

The solution is to add small ballasting resistors in the individual source leads, chosen roughly so that the voltage drop across them is at least comparable to the scatter in gatesource operating voltages (Figure 3.117A). We've found that a few tenths of a volt drop is frequently adequate for MOSFETs of a given type, from a single manufacturing batch or from transistors selected for matched $V_{\mathrm{GS}},{ }^{114}$ however, the datasheet specs would suggest (conservatively) larger drops - a volt or two at full operating current. Unless you are willing to worry about matched transistors (both during initial construction, and later replacement), you should take the conservative approach to produce a robust design, with source-ballasting resistors sized to drop a volt or two at the currents where power dissipation becomes important.

This example illustrates a frequent designer's quandary, namely a choice between a conservative circuit that meets the strict worst-case design criterion, and is therefore guaranteed to work, and a better-performing circuit design that doesn't meet worst-case specifications, but is overwhelmingly likely to function without problems. There are times when you will find yourself choosing the latter, ignoring the little voice whispering into your ear.

[^172]
#### Active feedback

This current-matching problem exemplifies a typical circuit tradeoff of robustness versus performance: a conservatively large ballast drop produces increased $R_{\mathrm{ON}}$ and power dissipation. As is often the case, a clever circuit can recover the lost benefits.

Figure 3.117B shows a nice solution, another in our "Designs from the Masters" series; just a snippet this time, but a valuable snippet. The small current-sense resistors in the MOSFET source leads provide active feedback through a primitive differential amplifier. Compared with a conservative source-ballasting circuit (Figure 3.117A), in which the source resistors are chosen to provide a 2 V drop (at a nominal 1 A per transistor operating current), the active circuit uses much smaller $0.1 \Omega$ sense resistors, providing 100 mV of drop, which is applied to the $n p n$ differential pair to adjust the gate voltages as needed to equalize the source currents. This circuit requires larger gate drive voltage, which is seldom a problem; in exchange, it minimizes the voltage drop and impedance in the MOSFET's high-current path. This scheme is well suited to relatively slow circuits, for example the series pass element in a linear power supply. Note that this arrangement is easily expanded to any number of MOSFETs. ${ }^{115}$

There's a pleasant exception to this general characteristic of positive $I_{D}$ tempco in power MOSFETs: lateral devices (as opposed to the vertical structure of nearly all power MOSFETs) exhibit negative tempco beginning at very low gate voltage (and very low $I_{\mathrm{D}}$ ); see Figure 3.118. Lateral power MOSFETs do not attain the high breakdown voltage and low $R_{\text {ON }}$ ratings of vertical power MOSFETs, but they are favored in linear power applications such as audio amplifiers for their linearity and thermal stability. A popular choice is the 2SK1058 ( $n$-channel) and 2SJ162 ( $p$ channel) complementary pair from Renesas (Hitachi), limited to 160 V and 7 A ; their $R_{\mathrm{ON}}$ is an unimpressive $\sim 1 \Omega$. This is not of great concern in the linear amplifier context, where they do not operate near voltage-saturation; but it's high enough that you often see several of them used in parallel. See the section "Power transistors for linear amplifiers" in Chapter $3 x$ for further discussion.

The positive tempco of $I_{\mathrm{D}}$ in power MOSFETs creates an additional problem, namely the possibility of thermal runaway.
115 We found this cute circuit trick used in some HP (subsequently Agilent, now Keysight) E3610-series linear power supplies. It's much simpler than using individual op-amps to bias each transistor, as some MOSFET manufacturers suggest. A different way to benefit from the higher power-dissipation capability of multiple transistors is to wire them in series, see for example Figure 9.111. A series connection guarantees equal current distribution.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0247.jpg?height=512&width=1148&top_left_y=203&top_left_x=375)

Figure 3.117. Paralleling power MOSFETs: A. with source ballasting resistors; B. with sense resistors and active feedback.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0247.jpg?height=557&width=721&top_left_y=818&top_left_x=160)

Figure 3.118. Transfer characteristics ( $I_{\mathrm{D}}$ versus $V_{\mathrm{GS}}$ ) for the 2SK1058 lateral $n$-channel power MOSFET, popular for use in high fidelity audio power amplifiers. Here the temperature coefficient is negative over most of the operating region.

### 3.6.4 Thermal runaway

Up to now, we've avoided the R-word, because "thermal runaway" is quite independent of whether transistors are used in parallel; it refers particularly to circuit configurations in which the power dissipation produces a rise in temperature that in turn raises the power that must be dissipated. Two important examples are the push-pull linear amplifier and the saturated power switch.

#### A. Push-pull power amplifier

In the class-AB push-pull power amplifier, commonly used in audio output stages, the push-pull pair is biased with substantial quiescent current (typically $\sim 100 \mathrm{~mA}$ ) to preserve linearity during waveform crossover. The quiescent current varies with temperature because both $I_{\mathrm{D}}$ (with MOSFETs) and $I_{\mathrm{C}}$ (with bipolar transistors) have positive
temperature coefficients at constant drive voltage. Depending on the circuit configuration and the degree of heatsinking, the output transistors may or may not reach a stable temperature; if they don't, you've got thermal runaway (independent of whether or not you've paralleled multiple transistors).

We saw this earlier in §2.4.1B, where we introduced the push-pull audio power amplifier built with complementary bipolar transistors. Because bipolar transistors have a positive tempco of collector current at fixed $V_{\mathrm{BE}},{ }^{116}$ the usual approach is to bias the bases apart with a voltage source that tracks the tempco of the output stage $V_{\mathrm{BE}}$ 's - typically by using diodes or transistor base-emitter junctions, thermally coupled to the output stage heatsink - often in conjunction with small emitter resistors in the output stage (Figure 3.119B).

Power MOSFETs in linear push-pull amplifiers present the same problem, because they are operated in the region of positive tempco of $I_{\mathrm{D}}$ (§3.6.3B). You can use the same trick (bias generator with tracking negative tempco, perhaps in combination with small-value output-stage source resistors; see the section "Power transistors for linear amplifiers" in Chapter 3x). However, the problem is nicely finessed by using lateral power MOSFETs, whose negative tempco of $I_{\mathrm{D}}$ (Figure 3.118) beginning at $I_{\mathrm{D}} \approx 100 \mathrm{~mA}$ guarantees no thermal runaway. The usual approach is to bias the output stage gates apart with a (settable) constant dc voltage, as shown in Figure 3.119, bypassed at signal frequencies. ${ }^{117}$ The bias is typically set for a quiescent current $I_{\mathrm{Q}}$ close to the zero-tempco crossover $(100 \mathrm{~mA}$ for

[^173]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0248.jpg?height=567&width=1682&top_left_y=206&top_left_x=205)

Figure 3.119. Thermal stability in push-pull power amplifiers - simplified output stage configurations. A. Fixed $V_{\mathrm{BE}}$ biasing promotes runaway, owing to positive $I_{C}$ tempco in bipolar output stage. B. Tracking thermally-coupled bias generator tames runaway. C. Stable quiescent current in lateral MOSFETs biased at fixed $V_{\mathrm{GS}}$; no thermal compensation is needed.
the 2SK1058/2SJ162 complementary pair), ensuring that $I_{\mathrm{Q}}$ remains relatively constant as the amplifier warms up. ${ }^{118}$

#### B. Saturated switch

It's widely believed that MOSFETs are immune to thermal runaway when used for power switching. The thought process goes like this: "These puppies have really low $R_{\mathrm{ON}}$ when driven to full conduction, so they hardly need any heatsinking; besides, if they do heat up (while carrying some large but bounded current), the thing will stabilize at some elevated temperature, because the power carried off by the heatsink increases roughly proportional to the rise above ambient temperature, and eventually catches up to the power being dissipated; plus, hey, these things are tough!"

Nice thoughts. But the reality can be different. That's because $R_{\text {ON }}$ isn't constant, but increases with temperature (Figure 3.116); so the switch dissipates more power as it heats up, and, if the heatsink is too small, the heat it carries off may never catch up - in which case the process runs away!

To lend some perspective: you don't need to have actual thermal runaway to cause overheating and destruction - an undersized heatsink ${ }^{119}$ will do the job just fine by al-
allowable junction temperature; no ballasting resistors would be needed for the MOSFET version.
118 Because lateral MOSFETs may be hard to get, a regular power MOSFET can be used in place of the BJT " $V_{\mathrm{BE}}$ diode" (as in Figure 3.119B) to bias a complementary pair of ordinary power MOSFETs. This approach prevents thermal runaway because the tempco of a MOSFET is higher at low currents than at high currents, see Figure 3.115.
${ }^{119}$ Or none at all! The impressive $I_{\mathrm{D}(\max )}$ ratings on the datasheet could
lowing the junction temperature to soar above $T_{\mathrm{J}(\max )}$. And, as we'll see shortly, the better approach is to reduce power dissipation by reducing $R_{\mathrm{ON}}$, rather than by piling on larger heatsinks. With this cautionary comment, let's see how actual thermal runaway could occur in an ill-advised design.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0248.jpg?height=575&width=789&top_left_y=1202&top_left_x=1075)

Figure 3.120. Thermal runaway in a MOSFET switch. The curved line plots maximum on-resistance and corresponding power dissipation at 50 A for an IRF3205 n-channel power MOSFET. The straight lines plot power removed by three choices of heatsink thermal resistance $R_{\text {®JA }}$. Thermal runaway occurs with the smallest heatsink, where there is no graphical intersection.

Figure 3.120 shows an easy graphical way to see what's happening and to figure out how much heatsink you need to

[^174]prevent runaway (and, by the way, to keep the junction temperature $T_{\mathrm{J}}$ below the specified $\left.T_{\mathrm{J}(\max )}\right)$. We begin by plotting the datasheet's $R_{\mathrm{ON}}$ versus temperature for an inexpensive power MOSFET (their graph tops out at $175^{\circ} \mathrm{C}$, because that is the maximum rated junction temperature; we took the liberty of extending the graph another $75^{\circ}$ ). Then we use that to evaluate the power dissipation, as $P_{\text {diss }}=$ $I^{2} R_{\mathrm{ON}}$; for our chosen 50 A drain current we got the values marked on the right-hand axis. Finally, we plot separately the power carried off by four values of heatsink "thermal resistance" $R_{\Theta \mathrm{JA}}$ (given by $P_{\text {diss }}=\left(T_{\mathrm{J}}-T_{\mathrm{A}}\right) / R_{\Theta \mathrm{JA}}$ ), assuming an ambient temperature of $T_{\mathrm{A}}=25^{\circ} \mathrm{C}$ (plenty of discussion of this in §9.4.1A).

The heatsinks carry off an amount of power proportional to the temperature rise above ambient, as plotted; the transistor generates power according to its graph. The intersection (if any!) is the equilibrium temperature, which in this case is about $45^{\circ} \mathrm{C}$ or $75^{\circ} \mathrm{C}$, for the two larger heatsinks. But the smallest heatsink has no intersection - it cannot carry off as much heat as the transistor generates, at any temperature: thermal runaway! In real life you should assume that the ambient temperature will be higher (equipment is put into racks, or stacked with other equipment; and, you can have hot weather!): you would do this by sliding the heatsink curves to the right.

From this simple example you might conclude that larger heatsinks are the right cure for thermal runaway in saturated switching applications. But look again at the numbers: we're switching 50 A with an $R_{\mathrm{ON}}$ of order $10-$ $15 \mathrm{~m} \Omega$ - that's a 0.5 to 0.75 V drop, and 25 to 40 W dissipation. At these sorts of currents we really should be using a larger transistor, or several in parallel, to reduce $R_{\mathrm{ON}}$ (and therefore the dissipated power). The "maximum $I_{D}$ " specification (here 110 A ) looks pretty good on a datasheet, but is not a realistic guide to appropriate dc operation of the part. In this example a better choice would be a low $R_{\text {ON }}$ part like the FDB8832 ${ }^{120}$ with $R_{\mathrm{ON}}=2.3 \mathrm{~m} \Omega$ (max) at $25^{\circ} \mathrm{C}$, and with a typical on voltage of 115 mV at 50 A and power dissipation of 5.8 W . ${ }^{121}$ This is a 30 V part (high-voltage MOSFETs have higher $R_{\mathrm{ON}}$ ); if you wanted to switch somewhat higher voltages with low $R_{\mathrm{ON}}$ and $P_{\mathrm{D}}$, your choices are to use a high-power MOSFET module ${ }^{122}$ or (less expensive) several conventional MOSFETs in parallel. For voltages above 400 V or so the transistor of choice is the IGBT (insulated-gate bipolar transistor; see

[^175]§3.5.7A), which has the input properties of a MOSFET and the output properties of a BJT. An example is the Mitsubishi CM1200HC-50H, rated at 2500 V and 1200 A : at full current it saturates at just 3 V (equivalent to a $2.5 \mathrm{~m} \Omega$ ON-resistance). That's pretty good...but that works out to 3.6 kilowatts dissipation! (These things are used for power switching in applications like electric locomotives.)

Lest we leave the wrong impression, we hasten to point out that thermal calculations and heatsink selection need not require the kind of graphical plotting we've done here (in which we were interested primarily in the possibility of true thermal runaway). More simply, you can just apply a safety factor $m$ to the datasheet's $25^{\circ} \mathrm{C} R_{\mathrm{ON}}$ value to get a reasonable estimate of $R_{\mathrm{ON}}$ at the maximum junction temperature $\left(150^{\circ} \mathrm{C}\right)$; from that you get

$$
\begin{equation*}
T_{\mathrm{J}} \approx T_{\mathrm{A}}+I_{\mathrm{D}}^{2} \cdot m R_{\mathrm{ON}(25 \mathrm{C})} \cdot R_{\Theta \mathrm{JA}} \tag{3.15}
\end{equation*}
$$

The multiplier $m$ varies somewhat with the voltage rating of the MOSFET; based on data from many datasheets (see the graph and discussion in the section "MOSFET ON-resistance versus temperature" in Chapter 3x), it ranges from roughly $m \approx 1.5$ (for low-voltage MOSFETs) to roughly $m \approx 2.5$ (for high-voltage MOSFETs). As a practical rule-of-thumb, you'll be safe if you use $m=2$ for MOSFETs rated to 100 V and $m=2.5$ for those of higher voltages (at least to 1 kV ).

#### C. Second breakdown and safe operating area

It's worth emphasizing a related thermal effect ("second breakdown") that was discussed earlier in §3.5.1B: power transistors fail (usually ${ }^{123}$ ) if operated beyond their maximum voltage, their maximum current, or their maximum junction temperature (the latter dependent on power dissipation, pulse duration, heatsink thermal resistance, and ambient temperature; see §9.4.2). The boundaries define the safe operating area, or SOA, for example as shown in Figure 3.95. Bipolar transistors suffer from an additional failure mode known as second breakdown, an incompletely understood instability characterized by local heating, reduction of the breakdown voltage, and, often, destruction of the junction. It is second breakdown that imposes the additional constraint on the bipolar SOAs in Figure 3.95. Happily, MOSFETs are less likely to suffer from second breakdown, which contributes to their popularity in power circuits. ${ }^{124}$ Note that for both kinds of transistors the maximum current and power limits are higher for short pulses.

[^176]Table 3.7 Junction Field-Effect Transistors (JFETs) ${ }^{\mathrm{a}}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0250.jpg?height=1792&width=1503&top_left_y=242&top_left_x=213)
(a) listed generally by increasing loss, but also by part number within a family (e.g., J105-J113); see also Table 8.2 for noise parameters.
(b) for families of related parts, boldface designates the family matriarch. (c) usually specified at $\mathrm{I}_{\mathrm{D}}=1 \mathrm{nA}$ or 10 nA , though sometimes at $10 \mu \mathrm{~A}$ or even $200 \mu \mathrm{~A}$ (e.g., for the J105-J113 "switches"); it doesn't much matter, given the wide range of specified VGS(off). (d) see the accompanying pinout figure; all JFETs appear to be symmetric (source and drain are interchangeable), but italic designates a datasheet pinout in which the $S$ and $D$ terminals are interchanged. (e) $G_{m a x}=g_{m} / \mathrm{g}$ os , the maximum grounded-source voltage gain into a current source as drain load; listed values measured at $\mathrm{I}_{\mathrm{D}}=1 \mathrm{~mA}$ and $\mathrm{V}_{\mathrm{DS}}=5 \mathrm{~V}$, unless noted otherwise. $\mathrm{G}_{\max }$ is proportional to $\mathrm{V}_{\mathrm{DS}}$, and for most $\mathrm{JFETs} \mathrm{G}_{\max }$ is relatively constant over varying $\mathrm{I}_{\mathrm{D}}$. Use tabulated $\mathrm{G}_{\max }$ to find $\mathrm{g}_{\mathrm{s}}=\mathrm{g}_{\mathrm{m}} / \mathrm{G}_{\text {max. }}$ ( m ) maximum. ( p ) several PDIP-8 pkgs available. ( r ) at $\mathrm{I}_{\mathrm{D}}=30 \mu \mathrm{~A}$. ( s ) at $\mathrm{I}_{\mathrm{D}}=300 \mu \mathrm{~A}$. (t) typical. (v) variant of "F" pinout: G and D terminals interchanged. (z) at IDSs.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0251.jpg?height=1674&width=1480&top_left_y=158&top_left_x=117)

Notes: (a) sorted by family, within family sorted by lout; except for ZXGD3000-series, all devices swing rail-to-rail, or nearly so. (b) into Cload at $V_{S}=12 V$. (c) input gate with inv and non-inv inputs. (d) $A=A n a l o g$ Devices; $D=D i o d e s, I n c ; F=F a i r c h i l d ; I N=I n t e r s i l ;$ IR=International Rectifier; IX=Ixys/Clare; L=LTC; MA=Maxim; MC=Microchip; MI=Micrel; O=OnSemiconductor;
S=STMicroelectronics; $\mathrm{TI}=$ Texas Instruments. (e) 1A source, 2A sink. (f) 3A source, 5A sink. (g) 3A source, 7A sink. (h) 1.3 A source, 7.6 A sink. (k) 37 xxx for 0 to $70^{\circ} \mathrm{C}, 27 \mathrm{xxx}$ for $-40^{\circ} \mathrm{C}$ to $105^{\circ} \mathrm{C}$. (n) see part-specific comments. (o) XOR input sets optional invert. (p) $\mathrm{C}=\mathrm{CMOS}$; $\mathrm{C} 5=5 \mathrm{~V}$ CMOS; F=flexible, set by $V_{\text {ref }}-$ and $V_{\text {ref }}$ input pins; T=TTL.
Comments: (A) suffix specifies logic threshold. (B) includes 3.3 VDO output. (C) 2 ns td channel match. (D) 1 ns td channel match. (E) dual inv+en, dual non-inv+en, dual inputs. (F) source-resistor current-sense input terminal, suitable for driving an IGBT. (G) industry std, many mfgrs. (H) dual inv, dual non-inv, or one each. (J) for 8 -pin pkgs, $n$ - and $p$-ch drains on separate pins. (K) $t_{r}, t_{f}=50 \mathrm{~ns}$ into 68 nF . (L) output swing to neg rail, can be 5 V below logic gnd. (M) $n$ - and $p$-ch drains on separate pins. (N) resistor-programmed edge-delay timers; 2-input AND signal inputs. (O) ISL89163-65 same, but include enable inputs; ISL89166-68 same, but include resistor-programmed edge-delay timer inputs. (P) overtemp protection and output. (R) full p/n is IXDx6..., where $x=N, I, D$ and $F$ for non-inv, inv, dual non-inv+en, or one of each. (S) series is one each high-current high-gain npn and pnp transistor emitter-followers for pullup and down.

### Review of Chapter 3

An A-to-Z summary of what we have learned in Chapter 3. This summary reviews basic principles and facts in Chapter 3, but it does not cover application circuit diagrams and practical engineering advice presented there.

#### ๆA. FETs.

In Chapter 3 we explored the world of Field-Effect Transistors, or FETs. FETs have a conducting channel with terminals named Drain and Source. Conduction in the channel is controlled by an electric field created by a third Gate electrode (§3.1). As with bipolar transistors (BJTs), FETs are transconductance devices (see $\Psi G$ below), which means the drain current (assuming sufficient drain-to-source voltage) is controlled by the gate voltage.

#### ||B. $n$-channel and $p$-channel.

Like BJTs with their npn and $p n p$ types, FETs come in both $n$ - and $p$-channel polarities (\$3.1.2). In either case the channel conductance increases if the gate voltage is taken toward the drain voltage. For example, for an $n$-channel FET with a positive drain voltage, the channel can be turned on with a sufficient positive-going voltage, and cutoff with a sufficient negative-going voltage. That's not to say the $n$ channel device requires positive and negative voltages to turn on and off. A threshold voltage $V_{\mathrm{th}}$ can be defined where the FET is just slightly turned on, and the channel responds to gate voltages above and below $V_{\text {th }}$ for control.

#### IC. Enhancement and Depletion Modes.

See Figure 3.8. Enhancement-mode devices have a high enough threshold voltage $V_{\mathrm{th}}$ that they are nonconducting (i.e., off) when their gate voltage is at $V_{\mathrm{GS}}=0 \mathrm{~V}$. To bring such a FET into conduction, the gate of is brought positive (if $n$-channel) or negative (if $p$-channel). Depletion-mode devices, by contrast, have their threshold voltage well into the "off" direction, thus they are conducting (i.e., on) with their gate-voltage at $V_{\mathrm{GS}}=0 \mathrm{~V}$. Thus for example you must apply a considerable negative gate voltage $V_{\mathrm{GS}}$ to turn off an $n$-channel depletion-mode FET. See Figure 3.9 where drain current versus gate voltage is shown for a selection of $n$-channel devices. FETs can be fabricated with the transfer curve shifted left or right (more about this in $\llbracket \mathrm{H}$ below). Figures 3.10 and 3.11 show convenient maps of the FET types.

#### ID. MOSFETs and JFETs.

In metal-oxide FETs (MOSFETs) the gate electrode is fully insulated from the channel, and can be taken positive or
negative, typically up to $\pm 20 \mathrm{~V}$. In junction FETs (JFETs) the semiconductor gate contacts the channel and acts as a diode junction, so it is insulated only in the reverse direction. Therefore JFETs are necessarily depletion mode devices; one cannot make an enhancement-mode JFET. Figures 3.6 and 3.7 show FET symbols.

#### IIE. FET Characteristics, Gate and Drain.

See Figure 3.13. A FET's channel conductance and current is controlled primarily by its gate voltage, but it's also affected by the drain voltage $V_{\mathrm{DS}}$. At very low drain voltages the channel acts like a resistor, whose value is controlled by the gate ( $\S 3.1 .2$ and §3.2.7); this is called the linear region. At higher drain voltages the drain current levels off, being controlled by the gate voltage and only weakly dependent upon drain voltage; this is called the saturated region. In the saturated region the FET drain acts like a current source (or sink), and the device is characterized by its transconductance $g_{m}$ (see $\mathbb{I}[\mathrm{G}$ below). MOSFETs are often used as switches. In this mode of operation a large gate voltage (e.g., 10 V ) is applied to make the channel resistance low enough to approximate a closed switch. More on FET switches in sections $\frac{1}{2} \mathrm{O}-\mathrm{Q}$ below.

#### IF. Square-law.

Over a large region of gate voltages greater than $V_{\mathrm{th}}$, and for drain voltages above a volt or so (i.e., in the saturated region), a FET's drain current behaves like a square-law device; that is, its drain current is proportional to the square of the excess gate-drive voltage $\left(V_{\mathrm{GS}}-V_{\mathrm{th}}\right)^{2}$, see Figure 3.14 and eq'n 3.2. This is sometimes called the quadratic region. The threshold voltage $V_{\mathrm{th}}$ is generally determined with an extrapolated $\sqrt{I_{\mathrm{D}}}$ plot, as the figure shows. For $V_{\mathrm{GS}}$ below threshold the FET is in the subthreshold region; see III below.

#### IG. Transconductance and Amplifiers.

Transconductance $g_{m}$ is the change in output drain current caused by a change in gate voltage: $g_{m}=i_{\mathrm{D}} / v_{\mathrm{GS}}$ (the lowercase $i$ and $v$ signify small signals). Common-source FET amplifiers (\$3.2.3, Figures 3.28 and 3.29) have voltage gain $G=-g_{m} R_{\mathrm{D}}$, where $R_{\mathrm{D}}$ is the drain load resistance. In contrast to BJTs (where $g_{m} \propto I_{\mathrm{C}}$ ), the transconductance of FETs rises only as $\sqrt{I_{\mathrm{D}}}$ in the important quadratic region; see Figures 3.53 and 3.54. As a consequence FET amplifiers with resistive drain loads have lower gain when designed to operate at higher current, because $R_{\mathrm{D}}$ is generally chosen inversely proportional to drain current. The FET's internal output resistance also acts as a load resistance, thus
limiting gain (" $G_{\max }$ ") even with an ideal current-source drain load; see §3.3.2 eq'n 3.13, and Table 3.1.

When used as a follower, an FET has an output impedance $r_{\text {out }}=1 / g_{m}$, see $\llbracket \mathrm{K}$ below.

#### 1H. Biasing JFET Amplifiers.

JFETs are well suited for making signal amplifiers (by contrast there are few viable small discrete MOSFETs), and they work especially well in low-noise amplifiers. But there's one very painful issue analog designers face: the uncertain value of the gate operating voltage for any given part. Scanning the min and max columns for $V_{\mathrm{GS}(\mathrm{off})}$ in the JFET Table 3.1 on page 141, we see values for a particular JFET that range from -1 V to -7 V , or -0.4 V to -4 V . The latter is a 10:1 ratio! Figure 3.17 shows $V_{\mathrm{GS}}$ histograms for 300 parts, 100 each for three different JFET types in a family. Here we see gate voltage spreads of about 1 V , which you might rely upon if you buy a batch of parts from one manufacturer and measure them. But, caution: Figures 3.51 and 3.52 show how the same part type may vary when purchased from different manufacturers. To deal with the uncertainty, special biasing schemes are often required in FET amplifier circuits. Figures 3.25 and 3.41 show examples of the load-line concept for analyzing amplifier biasing.

#### III. Subthreshold Region.

The simple FET formula of eq'n 3.2 predicts zero drain current when the gate voltage reaches threshold $\left(V_{\mathrm{GS}}=V_{\mathrm{th}}\right)$. In reality the drain current is not zero, and transitions smoothly to a subthreshold region (see Figure 3.16) where the FET looks more like a BJT, with its exponential EbersMoll characteristic (§2.3.1). In this region (where $I_{\mathrm{D}}$ rises exponentially with $V_{\mathrm{GS}}$ ) we're glad to see a higher $g_{m} \propto I_{\mathrm{D}}$; but sadly the FET proportionality constant is usually $2 \times$ to $5 \times$ smaller than for BJTs, see Figure 3.53.

#### †J. Self-biased Amplifiers.

Depletion-mode MOSFETs (and all JFETs) operate with a reverse voltage on their gates, which allows them to be self-biased (§3.2.6A). The source terminal is "higher" than the gate terminal, so a source resistor connected between them sets the drain current to $I_{\mathrm{D}}=V_{\mathrm{GS}} / R$. This is also a convenient way to make a 2-terminal current source, but the tolerance will be poor due to the wide variability in $V_{\mathrm{GS}}$, see $\mathbb{T H}$. Alternately the $V_{\mathrm{GS}}$ voltage available at the source pin may be used to operate a current-setting IC like the LM334.

#### ๆK. Source Followers.

Source followers (§3.2.6), Figure 3.40 have a nominal gain of 1, analogous to the BJT emitter follower. Because of their lower $g_{m}$, however, they have considerably higher output resistance, $r_{\text {out }}=1 / g_{m}$, so the ideal unity gain is reduced by load resistance, see eq'n 3.7.

#### IL. FETs as Variable Resistors.

At low drain voltages $\left(V_{\mathrm{DS}} \ll V_{\mathrm{GS}}\right)$ FETs act as variable resistors programmed by the gate voltage. Because the slope varies with $V_{\mathrm{DS}}$, however, the resistance is somewhat nonlinear. But there's a simple trick to linearize this resistance, by exploiting the quadratic behavior of FETs, see Figures 3.46 and 3.47.

#### ПM. FET Gate Current.

The gate of a JFET forms a diode junction with the channel; it's normally reverse-biased, with some non-zero dc leakage current (§3.2.8). This current roughly doubles for every $10^{\circ} \mathrm{C}$ temperature increase; furthermore it increases dramatically at high drain currents and drain voltages due to impact ionization, see Figure 3.49. MOSFET gates do not suffer from either of these leakage-current-increasing effects. In contrast to the generally negligible dc gate leakage, the input capacitance $C_{\text {iss }}$ of FETs (which can be quite high, many hundreds of pF for large power MOSFETs) often presents a substantial ac load. Use a gate-driver chip (Table 3.8) to provide the high transient currents needed for rapid switching.

#### ๆN. JFET Switches.

JFETs can be used as analog-signal switches, as in the $n$ channel switch of Figure 3.62. The switch is OFF when the gate is taken at least $V_{\mathrm{th}}$ below than the most negative input signal. To turn the switch ON the gate voltage must be allowed to equal the source. JFETs are symmetrical, so e.g., for an n-channel part, the "source" would be the most negative pin. Large-die JFETs work well as power switches up to 100 mA ; Table 3.1 lists parts with $R_{\mathrm{ON}}$ as low as $3 \Omega$.

#### ПО. CMOS Switches.

CMOS signal switches are made with a parallel pair of complementary $n$ - and $p$-channel MOSFETs. This reduces $R_{\text {ON }}$ as shown in Figure 3.61, and beneficially causes cancellation of most of the injected charge transfer (§3.4.2E), see Figure 3.79. The injected charge scales roughly inversely proportional to $R_{\mathrm{ON}}$ (Figure 3.81), so there's a tradeoff between desirably low on-resistance and desirably low self-capacitance. As an example, Table 3.3 lists a switch with an impressive $R_{\mathrm{ON}}=0.3 \Omega$ - but it's burdened
with a whopping 300 pF of self-capacitance. A T-switch configuration can be used to reduce the signal feedthrough at high-frequencies, see Figure 3.77.

#### ๆP. CMOS Logic Gates.

See Figure 3.90. A series pair of complementary ( $n$ - and $p$-channel) small-geometry MOSFETs between the positive rail and ground forms the simplest logic inverter (Figure 3.90); more switches can be arranged to make CMOS logic gates (e.g., Figure 3.91, §3.4.4), with the attractive property of nearly zero static power, except when switching. CMOS logic is covered extensively in Chapters 10 and 12 , and is the basis for all contemporary digital processors.

#### IQ. MOSFET Power Switches.

Most power MOSFETs (\$3.5) are enhancement type, available in both $n$ - and $p$-channel polarities. They are very popular for use as high-current high-voltage power switches. A few relevant parameters are the breakdown voltage $V_{\text {DSS }}$ (ranging from 20 V to 1.5 kV for $n$-channel, and to 500 V for $p$-channel); the channel on-resistance $R_{\mathrm{DS}(\text { on })}$ (as low as $2 \mathrm{~m} \Omega$ ); the power-handling ability (as high as 1000 W with the case held unrealistically at $25^{\circ} \mathrm{C}$ ); and the gate capacitance $C_{\text {iss }}$ (as high as $10,000 \mathrm{pF}$ ), which must be charged and discharged during MOSFET switching, see IIS below. Table 3.4a lists representative small-package $n$ channel parts rated to +250 V and $p$-channel parts of all sizes to -100 V ; Table 3.4 b extends the $n$-channel selection to higher voltage and current; more complete tables are found in Chapter $3 x$.

#### ףR. Maximum Current.

MOSFET datasheets list a maximum continuous rated current, specified however at an unrealistic $25^{\circ} \mathrm{C}$ case temperature. This is calculated from $I_{\mathrm{D}(\max )}^{2} R_{\mathrm{DS}(\mathrm{ON})}=P_{\max }$, substituting a maximum power $P_{\max } R_{\Theta \mathrm{JC}}=\Delta T_{\mathrm{JC}}=150^{\circ} \mathrm{C}$ (see §9.4), where they have assumed $T_{\mathrm{J}(\max )}=175^{\circ} \mathrm{C}$ (thus a $150^{\circ} \mathrm{C} \Delta T_{\mathrm{JC}}$ ), and they use the value of $R_{\mathrm{DS}(\mathrm{ON})}(\max )$ at $175^{\circ} \mathrm{C}$ from an $R_{\mathrm{DS}}$ tempco plot (e.g., see Figure 3.116). That is, $I_{\mathrm{D}(\max )}=\sqrt{\Delta T_{\mathrm{JC}} / R_{\Theta \mathrm{JC}} R_{\mathrm{ON}}}$. Some datasheets show the calculation for a more realistic $75^{\circ} \mathrm{C}$ or $100^{\circ} \mathrm{C}$ case temperature. Even so, you don't really want to run your MOSFET junction at $175^{\circ} \mathrm{C}$, so we recommend using a lower maximum continuous $I_{\mathrm{D}}$ and corresponding $P_{\text {diss }}$.

#### IS. Gate Charge.

The capacitances in power MOSFETs that slow down switching are most easily analyzed with gate-charge plots, like Figure 3.101. First consider turn-ON: as current flows
into the gate capacitance $C_{\text {iss }}+C_{\text {rss }}$ (dominated by $C_{\text {iss }}$ ) the gate voltage rises. There is a switching delay, because the FET's drain remains off until the gate voltage is high enough for the FET to sink the drain current. Then the drain voltage starts to fall, as seen in Figures 3.102 and 3.103. The falling drain creates a reverse gate current $I=C_{\mathrm{rss}} \mathrm{d} V_{\mathrm{D}} / \mathrm{d} t$ that prevents further increase in the gate voltage. Put another way, the falling slewrate $\mathrm{d} V_{\mathrm{D}} / \mathrm{d} t=I_{\mathrm{G}} / C_{\mathrm{rss}}$ is set by the gate current available to charge the feedback (Miller) capacitance $C_{\mathrm{rss}}$. When $V_{\mathrm{DS}}$ reaches zero the gate resumes charging, now at a slower rate because the $C_{\text {rss }}$ contribution to total gate capacitance is larger at $V_{\mathrm{DS}}=0$, see Figure 3.100). The MOSFET does not reach its intended low value of $R_{\mathrm{DS}(\mathrm{ON})}$ until the gate attains its full drive voltage. Turn-off proceeds similarly. MOSFET datasheets include values for $C_{\text {iss }}$ and $C_{\text {rss }}$, but the latter is typically at $V_{\mathrm{DS}}=25 \mathrm{~V}$, so you need to go to the datasheet plots of capacitances versus drain voltage.

#### qT T. MOSFET Gate Damage.

MOSFET gates typically have $\pm 20 \mathrm{~V}$ to $\pm 30 \mathrm{~V}$ maximum ratings, beyond which the very thin metal-oxide gatechannel insulator can be permanently damaged, see Figure 3.105. Be sure to discharge static charge before installation of discrete MOSFETs and MOS ICs.

#### IU. FET versus BJT for Power Switching.

See §3.5.4H; see also IIZ below.

#### IV. MOSFET Switch Polarity.

Both $n$ - and $p$-channel polarities of MOSFETs can be used to switch a voltage, see Figure 3.106 where most of the circuits show a conventional approach with a $p$-channel FET switching a positive voltage. But circuit E shows an $n$-channel FET doing the same task, with an additional voltage source powering the gate (the better-performing $n$-channel FET is preferred if it can be easily used, see §3.1.2). Figure 3.107 illustrates the use of photodiodes to power the high-side gates, to make "floating" switches.

#### ףW. Power MOSFET Amplifiers.

Unlike bipolar power transistors, power MOSFETs have a wide safe-operating area (SOA) and do not suffer from second breakdown (see Figure 3.95), which is due to a localized thermal-runaway heating problem. Figure 3.119 shows typical class-AB biasing techniques necessary for use in linear power amplifiers.

ПX. Depletion-mode Power MOSFETs.
Although most power MOSFETs are enhancement-mode types, $n$-channel depletion-mode types are available; $\S 3.5 .6 \mathrm{D}$ shows some applications. See also Table 3.6 on page 210.

#### TY. Paralleling Power MOSFETs.

When used as switches, yes, but when used in power amplifiers, no, at least not without high-value source-ballast resistors! Figure 3.117B shows an elegant active-feedback
workaround for use with regulator pass elements.

IZ. IGBTs.
IGBTs are an alternative to power MOSFETs, see §3.5.7 where we show a comparison between power MOSFETs, IGBTs and BJTs. They're primarily useful at voltages above 300 V and switching rates below 100 kHz , though there are some nice IGBTs for use at RF, for example the IRGB4045, good for 150 W or more at 20 MHz .

# 4. OPERATIONAL AMPLIFIERS

## 4.1 Introduction to op-amps - the "perfect component"

In the previous three chapters we learned about circuit design with "discrete components," both active and passive. Our basic building blocks were transistors, both bipolar (BJT) and field-effect (FET), along with the resistors, capacitors, and other components that are needed to set bias, couple and block signals, create load impedances, and so on.

With those tools we have gone quite far. We've learned how to design simple power supplies, signal amplifiers and followers, current sources, dc and differential amplifiers, analog switches, power drivers and regulators, and even some rudimentary digital logic.

But we've also learned to struggle with imperfections. Voltage amplifiers suffer from nonlinearity (a groundedemitter amplifier with a 1 mV input signal has $\sim 1 \%$ distortion), which you can trade off against voltage gain (by adding emitter degeneration); differential amplifiers have input unbalance, typically tens of millivolts (with bipolar transistors), ten times more with discrete junction-FETs (JFETs); in bipolar design you have to worry about input current (often substantial), and the ever-present $V_{\mathrm{BE}}$ and its variation with temperature; in FET design you trade absence of input current for unpredictability of $V_{G S}$; and so on.

We've seen hints that things can be better, in particular the remarkable linearizing effects of negative feedback (\$2.5.3), and its ability to make overall circuit performance less dependent on component imperfections. It is negative feedback that gives the emitter-degenerated amplifier its linearity advantage over the grounded-emitter amplifier (at the cost of voltage gain). And in the high-loop-gain limit, negative feedback promises circuit performance largely independent of transistor imperfections.

Promised, but not yet delivered: the high-gain amplifier blocks we need to get high loop gain in a feedback arrangement still involve substantial design efforts - the hallmark of complex circuits implemented with discrete (as opposed to integrated) components.

With this chapter we enter the promised land! The opamp is, essentially, a "perfect part": a complete integrated amplifier gain block, best thought of as a dc-coupled differential amplifier with single-ended output, and with extraordinarily high gain. It also excels in precise input symmetry and nearly zero input current. Op-amps are designed as "gain engines" for negative feedback, with such high gain that the circuit performance is set almost entirely by the feedback circuitry. Op-amps are small and inexpensive, and they should be the starting point for nearly every analog circuit you design. In most op-amp circuit designs we're in the regime where they are essentially perfect: with them we will learn to build nearly perfect amplifiers, current sources, integrators, filters, regulators, current-tovoltage converters, and a host of other modules.

Op-amps are our first example of integrated circuits many individual circuit elements, such as transistors and resistors, fabricated and interconnected on a single "chip" of silicon. ${ }^{1}$ Figure 4.1 shows some IC op-amp packaging schemes.

### 4.1.1 Feedback and op-amps

We first met negative feedback in Chapter 2, where we saw that the process of coupling the output back, in such a way as to cancel some of the input signal, improved characteristics such as linearity, flatness of response, and predictability. As we saw quantitatively, the more negative feedback that is used, the less the resultant amplifier characteristics depend on the characteristics of the open-loop (no-feedback) amplifier, ultimately depending only on the properties of the feedback network itself. Operational amplifiers are typically used in this high-loop-gain limit, with open-loop voltage gain (no feedback) of a million or so.

A feedback network can be frequency-dependent, to produce an equalization amplifier (for example the

[^177]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0257.jpg?height=603&width=795&top_left_y=206&top_left_x=123)

Figure 4.1. Op-amps (and other linear ICs) come in a bewildering variety of "packages," most of which are represented in this photograph. Top row, left to right: 14-pin plastic dual in-line package (DIP), 8-pin plastic DIP ("mini-DIP"). Middle row: 14-pin thin-shrink small-outline package (TSSOP), 8-pin small-outline package (SO8), 8-pin TSSOP (" $\mu \mathrm{MAX}$ "). Bottom row: 5 -pin small-outline transistor package (SOT23), 6-ball chip-scale package (CSP - top and bottom views), 5 -pin SC-70. The 14-pin packages hold quad opamps (i.e., four independent op-amps), the 8 -pin packages hold duals, and the rest are singles. (TSSOP and smaller packages courtesy of Travis Eichhorn, Maxim Semiconductor.)
treble and bass "tone control" stage of amplification that you find in most audio systems); or it can be amplitudedependent, producing a nonlinear amplifier (a popular example is a logarithmic amplifier, built with feedback that exploits the logarithmic $V_{\mathrm{BE}}$ versus $I_{\mathrm{C}}$ of a diode or transistor). It can be arranged to produce a current source (nearinfinite output impedance) or a voltage source (near-zero output impedance), and it can be connected to generate very high or very low input impedance. Speaking in general terms, the property that is sampled to produce feedback is the property that is improved. Thus, if you feed back a signal proportional to the output current, you will generate a good current source.

As we remarked in $\S 2.5 .1$, feedback can be arranged intentionally to be positive, for example to make an oscillator, or, as we'll see later, to make a Schmitt trigger circuit. That's the good kind of positive feedback. The bad kind occurs, uninvited (and unwelcome), when a negativefeedback circuit is burdened with sufficient accumulated phase shifts at some frequency to produce overall positive feedback, and oscillations. This can occur for a variety of reasons. We'll discuss this important subject, and see how to prevent unwanted oscillations by frequency compensation, the topic of $\S 4.9$ at the end of the chapter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0257.jpg?height=116&width=216&top_left_y=223&top_left_x=1267)

Figure 4.2. Op-amp symbol.

Having made these general comments, we now look at a few feedback examples with op-amps.

### 4.1.2 Operational amplifiers

The operational amplifier is a very high-gain dc-coupled differential amplifier with a single-ended output. You can think of the classic long-tailed pair (§2.3.8) with its two inputs and single output as a prototype, although real opamps have much higher gain (typically $10^{5}$ to $10^{6}$ ) and lower output impedance, and they allow the output to swing through most or all of the supply range (you often use a split supply, for example $\pm 5 \mathrm{~V}$ ). Operational amplifiers are available in literally thousands of types, with the universal symbol shown in Figure 4.2, where the $(+)$ and $(-)$ inputs do as expected: the output goes positive when the noninverting input $(+)$ goes more positive than the inverting input $(-)$, and vice versa. The $(+)$ and $(-)$ symbols don't mean that you have to keep one positive with respect to the other, or anything like that; they just tell you the relative phase of the output (which is important to keep negative feedback negative). Using the words "noninverting" and "inverting," rather than "plus" and "minus" helps avoid confusion. Power-supply connections are frequently not displayed, and there is no ground terminal. Operational amplifiers have enormous voltage gain, and they are never (well, hardly ever) used without feedback. Think of an opamp as fodder for feedback. The open-loop gain is so high that, for any reasonable closed-loop gain, the characteristics depend on only the feedback network. Of course, at some level of scrutiny this generalization must fail. We will start with a naïve view of op-amp behavior and fill in some of the finer points later, when we need to.

There are literally thousands of different op-amps available, offering various performance tradeoffs that we will explain later (look ahead to Tables 4.2a,b, 5.5, or 8.3 if you want to see a small sample of what's available). A very good all-around performer is the popular LF411 ("411" for short), originally introduced by National Semiconductor. Like many op-amps, it is a wee beastie packaged in the so-called mini-DIP (dual in-line package) or SOIC (smalloutline IC), and it looks as shown in Figure 4.3. It is inexpensive (less than \$1) and easy to use; it comes in an improved grade (LF411A) and also in a version containing
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0258.jpg?height=410&width=818&top_left_y=221&top_left_x=204)

Figure 4.3. Mini-DIP and SOIC packages.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0258.jpg?height=432&width=682&top_left_y=748&top_left_x=276)

Figure 4.4. Pin connections for LF411 op-amp in 8-pin DIP.
two independent op-amps (LF412, called a "dual" opamp). We will adopt the LF411/LF412 throughout this chapter as our "standard" op-amp, and we recommend it (or perhaps the versatile LMC6482) as a good starting point for your circuit designs.

Inside the 411 is a piece of silicon containing 24 transistors ( 21 BJTs, 3 FETs), 11 resistors, and 1 capacitor. (You can look ahead to Figure 4.43 on page 243 to see a simplified circuit diagram of its innards.) The pin connections are shown in Figure 4.4. The dot in the upper-lefthand corner, or notch at the end of the package, identifies the end from which to begin counting the pin numbers. As with most electronic packages, you count pins counterclockwise, viewing from the top. The "offset null" terminals (also known as "balance" or "trim") have to do with correcting (externally) the small asymmetries that are unavoidable when making the op-amp. More about this later in the chapter.

### 4.1.3 The golden rules

Here are the simple rules for working out op-amp behavior with external negative feedback. They're good enough for almost everything you'll ever do.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0258.jpg?height=284&width=427&top_left_y=220&top_left_x=1261)

Figure 4.5. Inverting amplifier.
First, the op-amp voltage gain is so high that a fraction of a millivolt between the input terminals will swing the output over its full range, so we ignore that small voltage and state golden rule I.
I. The output attempts to do whatever is necessary to make the voltage difference between the inputs zero.

Second, op-amps draw very little input current (about 50 pA for the inexpensive JFET-input LF411, and often less than a picoamp for MOSFET-input types); we round this off, stating golden rule II.
II. The inputs draw no current.

One important note of explanation: golden rule I doesn't mean that the op-amp actually changes the voltage at its inputs. It can't do that. (How could it, and be consistent with golden rule II?) What it does is "look" at its input terminals and swing its output terminal around so that the external feedback-network brings the input differential to zero (if possible).

These two rules get you quite far. We illustrate with some basic and important op-amp circuits, and these will prompt a few cautions listed in §4.2.7.

## 4.2 Basic op-amp circuits

### 4.2.1 Inverting amplifier

Let's begin with the circuit shown in Figure 4.5. The analysis is simple, if you remember your golden rules.

1. Point $B$ is at ground, so rule I implies that point $A$ is also.
2. This means that (a) the voltage across $R_{2}$ is $V_{\text {out }}$ and (b) the voltage across $R_{1}$ is $V_{\text {in }}$.
3. So, using rule II, we have $V_{\text {out }} / R_{2}=-V_{\text {in }} / R_{1}$.

In other words, the voltage gain ( $G_{V} \equiv V_{\text {out }} / V_{\text {in }}$ ) is

$$
\begin{equation*}
G_{V}=-R_{2} / R_{1} \tag{4.1}
\end{equation*}
$$

Later you will see that it's sometimes better not to ground $B$ directly, but through a resistor - but don't worry about that now.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0259.jpg?height=297&width=460&top_left_y=219&top_left_x=298)

Figure 4.6. Noninverting amplifier.

Our analysis seems almost too easy! In some ways it obscures what is actually happening. To understand how feedback works, just imagine some input level, say +1 volt. For concreteness, imagine that $R_{1}$ is 10 k and $R_{2}$ is 100 k . Now, suppose the output decides to be uncooperative, and sits at zero volts. What happens? $R_{1}$ and $R_{2}$ form a voltage divider, holding the inverting input at +0.91 volts. The op-amp sees an enormous input unbalance, forcing the output to go negative. This action continues until the output is at the required -10.0 volts, at which point both opamp inputs are at the same voltage, namely ground. Similarly, any tendency for the output to go more negative than -10.0 volts will pull the inverting input below ground, forcing the output voltage to rise.

What is the input impedance? Simple. Point $A$ is always at zero volts (it's called a virtual ground). So $Z_{\text {in }}=R_{1}$. At this point you don't yet know how to figure the output impedance; for this circuit, it's a fraction of an ohm.

Note that this analysis is true even for dc - it's a dc amplifier. So if you have a signal source that has a dc offset from ground (collector of a previous stage, for instance), you may want to use a coupling capacitor (sometimes called a blocking capacitor, since it blocks dc but couples the signal). For reasons you will see later (having to do with departures of op-amp behavior from the ideal), it is usually a good idea to use a blocking capacitor if you're interested only in ac signals anyway.

This circuit is known as an inverting amplifier. Its one undesirable feature is the low input impedance, particularly for amplifiers with large (closed-loop) voltage gain, where $R_{1}$ tends to be rather small. That is remedied in the next circuit (Figure 4.6).

### 4.2.2 Noninverting amplifier

Consider Figure 4.6. Again, the analysis is simplicity itself:

$$
V_{A}=V_{\mathrm{in}}
$$

But $V_{A}$ comes from a voltage divider: $V_{A}=V_{\text {out }} R_{1} /\left(R_{1}+\right.$ $R_{2}$ ). Set $V_{A}=V_{\text {in }}$, and you get a voltage gain of

$$
\begin{equation*}
G_{V}=1+R_{2} / R_{1} \tag{4.2}
\end{equation*}
$$

This is a noninverting amplifier. In the approximation we are using, the input impedance is infinite (with the JFETinput 411 it would be $10^{12} \Omega$ or more; a BJT-input op-amp will typically exceed $10^{8} \Omega$ ). The output impedance is still a fraction of an ohm. As with the inverting amplifier, a detailed look at the voltages at the inputs will convince you that it works as advertised.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0259.jpg?height=774&width=595&top_left_y=628&top_left_x=1080)

Figure 4.7. Amplifiers for ac signals: A. ac-coupled noninverting amplifier, B. blocking capacitor rolls off the gain to unity at dc.

#### A. An ac amplifier

The basic noninverting amplifier, like the inverting amplifier earlier, is a dc amplifier. If the signal source is accoupled, you must provide a return to ground for the (very small) input current, as in Figure 4.7A. The component values shown give a voltage gain of 10 and a low-frequency 3 dB point of 16 Hz .

If only ac signals are being amplified, it is often a good idea to "roll off" the gain to unity at dc, especially if the amplifier has large voltage gain, to reduce the effects of finite "input offset voltage" (§4.4.1A). The circuit in Figure 4.7 B has a low-frequency 3 dB point of 17 Hz , the frequency at which the impedance of the capacitor $C_{1}$ equals $R_{1}$, or 2.0 k . Note the large capacitor value required. For noninverting amplifiers with high gain, the capacitor in this ac amplifier configuration may be undesirably large. In that
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0260.jpg?height=226&width=424&top_left_y=221&top_left_x=408)

Figure 4.8. Op-amp follower.
case it may be preferable to omit the capacitor and trim the offset voltage to zero, as we will discuss later. An alternative is to raise $R_{1}$ and $R_{2}$, perhaps using a $T$ network for the latter (Figure 4.66 on page 259).

In spite of its desirable high input impedance, the noninverting amplifier configuration is not necessarily to be preferred over the inverting amplifier configuration in all circumstances. As we will see later, the inverting amplifier puts less demand on the op-amp, and therefore gives somewhat better performance. In addition, its virtual ground provides a handy way to combine several signals without interaction. Finally, if the circuit in question is driven from the (stiff) output of another op-amp, it makes no difference whether the input impedance is 10 k (say) or infinity, because the previous stage has no trouble driving it in either case.

### 4.2.3 Follower

Figure 4.8 shows the op-amp version of an emitter follower. It is simply a noninverting amplifier with $R_{1}$ infinite and $R_{2}$ zero (gain $=1$ ). An amplifier of unity gain is sometimes called a buffer because of its isolating properties (high input impedance, low output impedance).

### 4.2.4 Difference amplifier

The circuit in Figure 4.9A is a difference amplifier (sometimes called a differential amplifier) with gain $R_{2} / R_{1}$. This circuit requires precise resistor matching to achieve high common-mode rejection ratios (CMRR). You may be lucky and find a batch of $100 \mathrm{k} 0.01 \%$ resistors at an electronics flea market or surplus outlet; otherwise you can buy precision resistor arrays, with close matching of ratios and temperature coefficients. ${ }^{2}$ All your difference amplifiers

[^178]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0260.jpg?height=650&width=659&top_left_y=218&top_left_x=1141)

Figure 4.9. Classic difference amplifier: A. Op-amp with matched resistor ratios. B. Integrated version, with uncommitted "sense" and "reference" pins. In the best grade (INA105A) the resistor ratio is matched to better than $0.01 \%$, with a temperature coefficient better than $5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$.
will have unity gain, but that's easily remedied with further (single-ended) stages of gain. If you can't find good resistors (or even if you can!), you should know that you can buy this circuit as a convenient packaged difference amplifier, with well-matched resistors; examples are the INA105 or AMP03 $(G=1)$, INA106 ( $G=10$ or 0.1 ), and INA117 or AD629 ( $G=1$ with input dividers; input signals to $\pm 200 \mathrm{~V}$ ) from TI/Burr-Brown and Analog Devices (many more are listed in Table 5.7 on page 353). The unitygain INA105 configuration is shown in Figure 4.9B, with its uncommitted "sense" and "reference" pins. You get the classic difference amplifier by connecting sense to the output and ref to ground. But the additional flexibility lets you make all sorts of nifty circuits, such as a precision unitygain inverter, noninverting gain-of-2 amplifier, and noninverting gain-of-0.5 amplifier. We treat difference amplifiers in greater detail in $\S 5.14$.

Exercise 4.1. Show how to make these three circuits with an INA105.

There are, in addition, more sophisticated differential amplifier configurations, known officially as "instrumentation amplifiers"; they are discussed in detail in $\S \S 5.15$ and 5.16, along with a listing in Table 5.8 on page 363.
formance: their best resistor arrays specify worst-case ratio tracking to $0.001 \%$, and tracking temperature coefficient (tempco) to $\pm 0.1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0261.jpg?height=327&width=383&top_left_y=219&top_left_x=329)

Figure 4.10. Basic op-amp current source (floating load). $V_{\text {in }}$ might come from a voltage divider, or it could be a signal that varies with time.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0261.jpg?height=613&width=713&top_left_y=719&top_left_x=169)

Figure 4.11. Current source with grounded load and floating power supply.

### 4.2.5 Current sources

The circuit in Figure 4.10 approximates an ideal current source, without the $V_{\mathrm{BE}}$ offset of a transistor current source. Negative feedback results in $V_{\text {in }}$ at the inverting input, producing a current $I=V_{\text {in }} / R$ through the load. The major disadvantage of this circuit is the "floating" load (neither side grounded). You couldn't generate a usable sawtooth wave with respect to ground with this current source, for example. One solution is to float the whole circuit (power supplies and all) so that you can ground one side of the load (Figure 4.11). The circuit in the box is the previous current source, with its power supplies shown explicitly. $R_{1}$ and $R_{2}$ form a voltage divider to set the current. If this circuit seems confusing, it may help to remind yourself that "ground" is a relative concept. Any one point in a circuit could be called ground. This circuit is useful for generating currents into a load that is returned to ground, but it has the disadvantage that the control input is now floating, so you cannot program the output current with an in-
put voltage referenced to ground. In addition, you've got to make sure that the floating power supply is truly floating - for example, you'd have trouble making a microamp dc current source this way if you tried to use a standard wall-plug-powered dc power supply, because capacitance between windings in its transformer would introduce reactive currents, at the 60 Hz line frequency, that might well exceed the desired microamp output current; one possible solution would be to use batteries. Some other approaches to this problem are presented in Chapter 9 (§9.3.14) in the discussion of constant-current power supplies. ${ }^{3}$

#### A. Current sources for loads returned to ground

With an op-amp and external transistor it is possible to make a simple high-quality current source for a load returned to ground; a little additional circuitry makes it possible to use a programming input referenced to ground (Figure 4.12). In the first circuit, feedback forces a voltage $V_{\mathrm{CC}}-V_{\mathrm{in}}$ across $R$, giving an emitter current (and therefore an output current) $I_{E}=\left(V_{\mathrm{CC}}-V_{\mathrm{in}}\right) / R$. There are no $V_{\mathrm{BE}}$ offsets, or their variations with temperature, with $I_{\mathrm{C}}$, with $V_{\mathrm{CE}}$, etc., to worry about. The current source is imperfect (ignoring op-amp errors: $I_{\mathrm{B}}, V_{\mathrm{OS}}$ ) only insofar as the small base current may vary somewhat with $V_{\mathrm{CE}}$ (assuming the op-amp draws no input current), not too high a price to pay for the convenience of a grounded load; a Darlington for $Q_{1}$ would reduce this error considerably. This error comes about, of course, because the op-amp stabilizes the emitter current, whereas the load sees the collector current. A variation of this circuit, using a MOSFET instead of a bipolar transistor, avoids this problem altogether, since FETs draw no dc gate current (but large power MOSFETs have plenty of input capacitance, which can cause problems; see the comment at the end of this subsection).

With this circuit the output current is proportional to the voltage drop below $V_{\mathrm{CC}}$ applied to the op-amp's noninverting input; in other words, the programming voltage is referenced to $V_{\mathrm{CC}}$, which is fine if $V_{\text {in }}$ is a fixed voltage generated by a voltage divider, but an awkward situation if an external input is to be used. This is remedied in the second circuit, in which a similar current source with an npn transistor is used to convert an input voltage (referenced to ground) to a $V_{\mathrm{CC}}$-referenced input to the final current

[^179]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0262.jpg?height=1147&width=723&top_left_y=202&top_left_x=261)

Figure 4.12. Current sources for grounded loads that don't require a floating power supply. The op-amps may need to have rail-to-rail input and output capability (RRIO); see text.
source; for the latter we've used a $p$-channel MOSFET for variety (and to eliminate the small base-current error you get with bipolar transistors). Op-amps and transistors are inexpensive. Don't hesitate to use a few extra components to improve performance or convenience in circuit design.

One important note about these circuits: at low output currents the voltage across the emitter (or source) resistors may be quite small, which means that the op-amps must be able to operate with their inputs near or at the positive supply voltage. For example, in the circuit of Figure 4.12B IC ${ }_{2}$ needs to operate with its inputs close to the positive supply rail. Don't assume that a given op-amp will do this, without explicit permission from the datasheet! The LF411's datasheet waffles a bit on this, but grudgingly admits that it will work, albeit with degraded performance, with the inputs at the positive rail. (It will not, however, work down to the negative rail; but with $\mathrm{IC}_{1}$ powered from split supply voltages there's no problem there.) By contrast, opamps like the LMC7101 or LMC6482 guarantee proper
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0262.jpg?height=522&width=795&top_left_y=206&top_left_x=1077)

Figure 4.13. FET-bipolar current source suitable for high currents.
operation all the way to (and a bit beyond) the positive rail (see the "Swing to supplies?" column in Table 4.2a on page 271). Alternatively, the op-amp could be powered from a separate $V_{+}$voltage higher than $V_{\mathrm{CC}}$.

Exercise 4.2. What is the output current in the last circuit for a given input voltage $V_{\text {in }}$ ? (Did we get it right in the figure?)

Figure 4.13 shows an interesting variation on the op-amp-transistor current source. Although you can get plenty of current with a simple power MOSFET, the high interelectrode capacitances of high-current FETs may cause problems. When a relatively low-current MOSFET ${ }^{4}$ is combined with a high-current npn power transistor, this circuit has the advantage of zero base current error (which you get with FETs) along with much smaller input capacitance. In this circuit, which is analogous to the "complementary Darlington" (or Sziklai circuit; see §2.4.2A), bipolar transistor $Q_{2}$ kicks in when the output current exceeds about 20 mA .

Lest we leave the wrong impression, we emphasize that the simpler MOSFET-only circuit (in the manner of Figure 4.12 B ) is a preferable configuration, given the major drawback of power BJTs, namely their susceptibility to "second breakdown" and consequent limit on safe operating area (as we saw in $\S 3.5 .1 \mathrm{~B}$, see particularly Figure 3.95). Big power MOSFETs have large input capacitance, so in such a circuit you should use a network like Figure 4.13's $R_{3} C_{1}$ to prevent oscillation.

#### B. Howland current source

Figure 4.14 shows a nice "textbook" current source. If the resistors are chosen so that $R_{3} / R_{2}=R_{4} / R_{1}$, then it can be shown that $I_{\text {load }}=-V_{\text {in }} / R_{2}$.

Exercise 4.3. Show that the preceding result is correct.

[^180]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0263.jpg?height=371&width=707&top_left_y=223&top_left_x=167)

Figure 4.14. Howland current source.

This sounds great, but there's a hitch: the resistor ratios must be matched exactly; otherwise it isn't a perfect current source. Even so, its performance is limited by the op-amp's common-mode rejection ratio (CMRR, §2.3.8). For large output currents the resistors must be small, and the compliance is limited. Also, at high frequencies (where the loop gain is low, as we'll learn shortly) the output impedance can drop from the desired value of infinity to as little as a few hundred ohms (the op-amp's open-loop output impedance). These drawbacks limit the applicability of this clever circuit.

You can convert this circuit into a noninverting current source by grounding $R_{1}$ (where $V_{\text {in }}$ is shown) and applying the control input voltage $V_{\text {in }}$ instead to $R_{2}$.

Figure 4.15 is a nice improvement on the Howland circuit, because the output current is sourced through a sense resistor $R_{\mathrm{S}}$ whose value you can choose independently of the matched resistor array (with resistor pairs $R_{1}$ and $R_{2}$ ). The best way to understand this circuit is to think of $\mathrm{IC}_{1}$ as a difference amplifier whose output sense and reference connections sample the drop across $R_{\mathrm{S}}$ (i.e., the current); the latter is buffered by follower $\mathrm{IC}_{2}$ so there is no current error.

For this configuration you can exploit the internal precision matched resistors in an integrated difference amplifier: use something like an INA106 for $R_{1}, R_{2}$, and $\mathrm{IC}_{1}$, wired "backwards" (for $G=0.1$ ) to reduce the drop across the sense resistor. See $\S 5.14$ and Table 5.7 on page 353.

### 4.2.6 Integrators

Op-amps allow you to make nearly perfect integrators, without the restriction that $V_{\text {out }} \ll V_{\text {in }}$. Figure 4.16 shows how it's done. Input current $V_{\text {in }} / R$ flows through $C$. Because the inverting input is a virtual ground, the output voltage is given by

$$
V_{\mathrm{in}} / R=-C\left(d V_{\text {out }} / d t\right)
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0263.jpg?height=386&width=616&top_left_y=220&top_left_x=1080)

GND.
Figure 4.15. Bipolarity current source-sink.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0263.jpg?height=243&width=422&top_left_y=710&top_left_x=1156)

Figure 4.16. Integrator.
or

$$
\begin{equation*}
V_{\text {out }}(t)=-\frac{1}{R C} \int V_{\text {in }}(t) d t+\text { const. } \tag{4.3}
\end{equation*}
$$

The input can, of course, be a current, in which case $R$ is omitted.

As an example, if we choose $R=1 \mathrm{M}$ and $C=0.1 \mu \mathrm{~F}$ in this circuit, then a constant dc input of +1 V produces $1 \mu \mathrm{~A}$ of current into the summing junction, hence an output voltage that is ramping downward at $d V_{\text {out }} / d t=-V_{\text {in }} / R C=$ $-10 \mathrm{~V} / \mathrm{s}$. To say it algebraically, for a constant $V_{\text {in }}$ or con$\operatorname{stant} I_{\text {in }}$,

$$
\Delta V_{\text {out }}=-\frac{V_{\text {in }}}{R C} \Delta t=-\frac{I_{\mathrm{in}}}{C} \Delta t
$$

We rigged up the integrator of Figure 4.16, with $R=1 \mathrm{M} \Omega$ and $C=1 \mathrm{nF}$, and drove it with the simple test waveform shown in Figure 4.17. Without having taken a math class, the thing knows calculus!

Sharp-eyed readers may have noticed that this circuit doesn't have any feedback at dc, and so there's no way for it to have a stable quiescent point: for any nonzero input voltage $V_{\text {in }}$, the output is going somewhere! As we'll see shortly, even with $V_{\text {in }}$ exactly at zero volts, the output tends to wander off, owing to op-amp imperfections (non-zero input current, and "offset voltage"). These latter problems can be minimized by careful choice of op-amp and circuit values; but even so you usually have to provide some way to reset the integrator. Figure 4.18 shows how this is commonly done, either with a reset switch (both discrete JFET and integrated CMOS analog switch examples are shown)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0264.jpg?height=411&width=771&top_left_y=223&top_left_x=229)

Figure 4.17. Integrator waveforms. The output can go anywhere it wants to, unlike our simple $R C$ "integrator" of §1.4.4. Horizontal: $10 \mathrm{~ms} / \mathrm{div}$.
or with a large-value feedback resistor across the integrating capacitor. Closing a reset switch ${ }^{5}$ (Figures 4.18A,B) zeroes the integrator by rapidly discharging the capacitor, while allowing perfect integration when open. The use of a feedback resistor (Figure 4.18D) produces stable biasing by restoring feedback at dc (where the circuit behaves like a high-gain inverting amplifier), but the effect is to roll off the integrator action at very low frequencies, $f<1 / R_{f} C$. An additional series analog switch at the input (Figure 4.18C) lets you control the intervals during which the integrator is active; when that switch is open the integrator output is frozen at its last value.

You don't have to worry about zeroing the integrator, of course, if it's part of a larger circuit that does the right thing. We'll see a beautiful example shortly (§4.3.3), namely an elegant triangle-wave generator, in which an untamed integrator is just what you want.

This first look at the op-amp integrator assumes that the op-amp is perfect, in particular that (a) the inputs draw no current, and (b) the amplifier is balanced with both inputs at precisely the same voltage. When our op-amp honeymoon is over we'll see that real op-amps do have some input current (called "bias current," $I_{\mathrm{B}}$ ), and that they exhibit some voltage imbalance (called "offset voltage," $V_{\text {OS }}$ ). These imperfections are not large - bias currents of picoamps are routine, as are offset voltages of less than a millivolt - but they can cause problems with circuits like integrators, in which the effect of a small error grows with time. We'll deal with these essential topics later in the chapter (§4.4), after you're comfortable with the basics.

[^181]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0264.jpg?height=1330&width=654&top_left_y=213&top_left_x=1142)

Figure 4.18. Op-amp integrators with reset switches.

### 4.2.7 Basic cautions for op-amp circuits

- In all op-amp circuits, golden rules I and II (§4.1.3) are obeyed only if the op-amp is in the active region, i.e., inputs and outputs are not saturated at one of the supply voltages.

For instance, overdriving one of the amplifier configurations will cause output clipping at output swings near $V_{\mathrm{CC}}$ or $V_{\mathrm{EE}}$. During clipping, the inputs will no longer be maintained at the same voltage. The op-amp output cannot swing beyond the supply voltages (typically it can swing only to within 2 V of the supplies, though certain op-amps are designed to swing all the way to one supply or the other, or to both; the latter are known as "rail-torail output" op-amps). Likewise, the output compliance of an op-amp current source is set by the same limitation.

The current source with floating load (Figure 4.10), for instance, can put a maximum of $V_{\mathrm{CC}}-V_{\text {in }}$ across the load in the "normal" direction (current in the same direction as applied voltage) and $V_{\text {in }}-V_{\mathrm{EE}}$ in the reverse direction. ${ }^{6}$

- The feedback must be arranged so that it is negative. This means (among other things) that you must not mix up the inverting and noninverting inputs. We'll learn later that you can get yourself into similar problems if you rig up a feedback network that has lots of phase shift at some frequency.
- There must always be feedback at dc in an op-amp circuit. Otherwise the op-amp is guaranteed to go into saturation.

For instance, we were able to put a capacitor from the feedback network to ground in the noninverting amplifier (to reduce gain to 1 at dc, Figure 4.7B), but we could not similarly put a capacitor in series between the output and the inverting input. Likewise, an integrator will ultimately saturate without some additional circuitry such as a reset switch.

- Some op-amps have a relatively small maximum differential-input voltage limit. The maximum voltage difference between the inverting and noninverting inputs may be limited to as little as 5 volts in either polarity. Breaking this rule will cause large input currents to flow, with degradation or destruction of the op-amp.
- Op-amps are high-gain devices, often having plenty of gain even at radiofrequencies, where the inductances in the power-rail wiring can lead to instabilities in the amplifiers. We solve this issue with mandatory (we mean it!) bypass capacitors on the op-amp supply rails. ${ }^{7}$ Note: The figures in this chapter and elsewhere (and generally in the real world) do not show bypass capacitors, for simplicity. You have been warned.

We take up some more issues of this type in $\S 4.4$, and again in Chapter 5 in connection with precision circuit design.
${ }^{6}$ The load could be rather strange, e.g., it might contain batteries, requiring the reverse sense of voltage to get a forward current; the same thing might happen with an inductive load driven by changing currents.
${ }^{7}$ When we were young we were taught that each op-amp needed its own set of bypass capacitors. But with experience we've come to realize that one pair of capacitors can work to stabilize nearby op-amps. Furthermore, local wiring inductance with multiple sets of bypass capacitors can lead to resonances, which allow one op-amp to interfere with another. For example, if $L=25 \mathrm{nH}$ and $C=0.01 \mu \mathrm{~F}$, then $f_{\mathrm{LC}}=10 \mathrm{MHz}$, and $X_{\mathrm{LC}}=1.6 \Omega$. The impedance peak at resonance will be $Q$ times higher. You can solve this problem by adding an additional parallel lossy bypass capacitor, such as a small electrolytic. Its equivalent series resistance, of order $0.5 \Omega$ or more, acts to damp the resonant $Q$.

## 4.3 An op-amp smorgasbord

In the following examples we skip the detailed analysis, leaving that fun for the reader.

### 4.3.1 Linear circuits

#### A. Optional inverter

The circuits in Figure 4.19 let you invert, or amplify without inversion, by flipping a switch. The voltage gain is either +1 or -1 , depending on the switch position. The "switches" can be CMOS analog switches ${ }^{8}$, which let you control the sense of inversion with a (digital) signal. The clever variation of Figure 4.20 lets you vary the gain continuously from follower to inverter. And when the pot $R_{1}$ is at mid-position, the circuit does nothing at all!

Exercise 4.4. Show that the circuits in Figure 4.19 work as advertised.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0265.jpg?height=685&width=483&top_left_y=971&top_left_x=1131)

Figure 4.19. Optional inverters; $G= \pm 1.0$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0265.jpg?height=268&width=450&top_left_y=1764&top_left_x=1147)

Figure 4.20. Follower-to-inverter: continuously adjustable gain from $G=+1$ to $G=-1$.

[^182]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0266.jpg?height=350&width=537&top_left_y=218&top_left_x=323)

Figure 4.21. Op-amp follower with bootstrap.

#### B. Follower with bootstrap

As with transistor amplifiers, the bias path can compromise the high input impedance you would otherwise get with an op-amp, particularly with ac-coupled inputs, for which a resistor to ground is mandatory. If that is a problem, the bootstrap circuit shown in Figure 4.21 is a possible solution. As in the transistor bootstrap circuit (\$2.4.3), the $0.1 \mu \mathrm{~F}$ capacitor makes the upper 1 M resistor look like a high-impedance current source to input signals. The lowfrequency rolloff for this circuit will begin at about 10 Hz , dropping at 12 dB per octave for frequencies somewhat below this. ${ }^{9}$ This circuit may exhibit some frequency peaking, analogous to the Sallen-and-Key circuit of §4.3.6; this can be tamed by adding a resistor of $1-10 \mathrm{k}$ in series with the feedback capacitor.

The very low input current (and therefore high input impedance) of FET-input op-amps generally make bootstrapping unnecessary; you can use 10 M or larger resistors for the input bias path in ac-coupled amplifiers.

#### C. Ideal current-to-voltage converter

Remember that the humble resistor is the simplest $I$-to- $V$ converter. However, it has the disadvantage of presenting a nonzero impedance to the source of input current; this can be fatal if the device providing the input current has very little compliance or does not produce a constant current as the output voltage changes. A good example is a photovoltaic cell, a diode junction that has been optimized as a light detector. Even the garden-variety signal diodes you use in circuits have a small photovoltaic effect (there are amusing stories of bizarre circuit behavior finally traced to this effect). Figure 4.22 shows the good way to convert current to voltage while holding the input strictly at ground. The inverting input is a virtual ground; this is fortunate, because a photovoltaic diode can generate only a few tenths

[^183]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0266.jpg?height=312&width=511&top_left_y=219&top_left_x=1219)

Figure 4.22. Photodiode amplifier.
of a volt. This particular circuit has an output of 1 volt per microamp of input current. (With BJT-input op-amps you sometimes see a resistor connected between the noninverting input and ground; its function will be explained shortly in connection with op-amp shortcomings.)

Of course, this transresistance configuration can be used equally well for devices that source their current from some positive excitation voltage, such as $V_{\mathrm{CC}}$. Photodiodes and phototransistors (both devices that source current from a positive supply when exposed to light) are often used this way (Figure 4.23). The photodiode has lower photocurrent, but excels in linearity and speed; very fast photodiodes can operate at gigahertz speeds. By contrast, the phototransistor has a considerably higher photocurrent (owing to transistor beta, which boosts the native collector-to-base photocurrent), with poorer linearity and speed. You can even get photo-Darlingtons, which extend this trend.

In real-world applications it is usually necessary to include a small capacitor across the feedback resistor, to ensure stability (i.e., prevent oscillation or ringing). This is because the capacitance of the detector, in combination with the feedback resistor, forms a lowpass filter; the resulting lagging phase shift at high frequencies, combined with the op-amp's own lagging phase shift (see §4.9.3), can add up to $180^{\circ}$, thus producing overall positive feedback, and thus oscillation. We treat this interesting problem in some detail in Chapter $4 x$ ("Transresistance amplifiers"); be sure to read that section carefully if you are building amplifiers for photodiodes. (And analogous stability problems occur, for similar reasons, when you drive capacitive loads with op-amps; see §4.6.1B).

Exercise 4.5. Use a 411 and a 1 mA (full scale) meter to construct a "perfect" current meter (i.e., one with zero input impedance) with 5 mA full scale. Design the circuit so that the meter will never be driven more than $\pm 150 \%$ full scale. Assume that the 411 output can swing to $\pm 13$ volts ( $\pm 15 \mathrm{~V}$ supplies) and that the meter has $500 \Omega$ internal resistance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0267.jpg?height=1302&width=535&top_left_y=204&top_left_x=258)

Figure 4.23. Photodiode amplifiers with reverse bias: A. Phototransistor; note base terminal is not used. B. Photodiode. C. Phototransistor used as photodiode; for variety we show it current sinking. D. Phototransistor with load resistor driving voltage follower.

#### D. Summing amplifier

The circuit shown in Figure 4.24 is just a variation of the inverting amplifier. Point $X$ is a virtual ground, so the input current is $V_{1} / R_{1}+V_{2} / R_{2}+V_{3} / R_{3}$. With equal resistor values you get $V_{\text {out }}=-\left(V_{1}+V_{2}+V_{3}\right)$. Note that the inputs can be positive or negative. Also, the input resistors need not be equal; if they're unequal, you get a weighted sum. For instance, you could have four inputs, each of which is +1 volt or zero, representing binary values $1,2,4$, and 8 . By using input resistors of $10 \mathrm{k}, 5 \mathrm{k}, 2.5 \mathrm{k}$, and 1.25 k , you will get a negative output in volts equal to the binary count input. This scheme can be easily expanded to several dig-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0267.jpg?height=261&width=527&top_left_y=209&top_left_x=1104)

Figure 4.24. Summing amplifier.
its. It is the basis of digital-to-analog conversion, although a different input circuit (an $R-2 R$ ladder) is usually used.

Exercise 4.6. Show how to make a two-digit digital-to-analog converter (DAC) by appropriately scaling the input resistors in a summing amplifier. The digital input represents two digits, each consisting of four lines that represent the values $1,2,4$, and 8 for the respective digits. An input line is either at +1 volt or at ground, i.e., the eight input lines represent $1,2,4,8,10,20,40$, and 80 . With $\pm 15 \mathrm{~V}$ supplies, the op-amp's outputs generally cannot swing beyond $\pm 13$ volts; you will have to settle for an output in volts equal to one-tenth the value of the input number.

#### E. Power booster

For high output current, a power transistor follower can be hung on an op-amp output (Figure 4.25). In this case a noninverting amplifier has been drawn, though a follower can be added to any op-amp configuration. Notice that feedback is taken from the emitter; thus feedback enforces the desired output voltage in spite of the $V_{\mathrm{BE}}$ drop. This circuit has the usual problem that the follower output can only source current. As with transistor circuits, the remedy is a push-pull booster (Figure 4.26). We'll see later that the limited speed with which the op-amp can move its output (slew rate) seriously limits the speed of this booster in the crossover region, creating distortion. For slow-speed applications you don't need to bias the push-pull pair into quiescent conduction, because feedback will take care of most of the crossover distortion. Complete power booster ICs are available, e.g. the LT1010 and BUF633/4. These
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0267.jpg?height=368&width=504&top_left_y=1857&top_left_x=1100)

Figure 4.25. Single-ended emitter follower boosts op-amp output current (sourcing only).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0268.jpg?height=356&width=635&top_left_y=217&top_left_x=264)

Figure 4.26. Push-pull follower boosts op-amp output current, both sourcing and sinking. You commonly see a small resistor ( $\sim 100 \Omega$ ) connected between the bases and emitters to reduce crossover nonlinearity by maintaining feedback throughout the signal swing. See Figure 2.71 for improved output-stage biasing.
are unity-gain push-pull amplifiers capable of 200 mA of output current, and operation to $20-100 \mathrm{MHz}$ (see $\S 5.8 .4$, and also the discussion (and table) of unity-gain buffers in Chapter $4 x$.); they are carefully biased for low open-loop crossover distortion, and include on-chip protection (current limit, and often thermal shutdown as well). As long as you ensure that the op-amp driving them has significantly less bandwidth, you can include them inside the feedback loop without any worries. ${ }^{10}$

#### Feedback and the push-pull booster

The push-pull booster circuit illustrates nicely the linearizing effect of negative feedback. We hooked up an LF411 op-amp as a noninverting unity-gain follower, driving a BJT push-pull output stage, and we loaded the output with a $10 \Omega$ resistor to ground. Figure 4.27 shows the output signals at the op-amp and at the load, with an input sinewave of 1 V amplitude at 125 Hz . For the upper pair of traces we (foolishly) took the feedback from the op-amp's output, which produced a fine replica of the input signal; but the load sees severe crossover distortion (from the $2 V_{\mathrm{BE}}$ dead zone). With the feedback coming from the push-pull output (where the load is connected) we get what we want, as seen in the lower pair of traces. The op-amp cleverly creates an exaggerated waveform to drive the push-pull follower, with precisely the right shape to compensate for the crossover.

Figure 4.28 shows what these waveforms look like when we try driving an actual loudspeaker, a load that is more complicated than a resistor (because it's both a "motor" and a "generator," it exhibits resonances and other nasty properties; it's also got a reactive crossover network, and

[^184]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0268.jpg?height=470&width=779&top_left_y=219&top_left_x=1080)

Figure 4.27. Feedback cures crossover distortion in the push-pull follower. Vertical: $1 \mathrm{~V} / \mathrm{div}$; horizontal: $2 \mathrm{~ms} /$ div.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0268.jpg?height=481&width=802&top_left_y=831&top_left_x=1068)

Figure 4.28. Same as Figure 4.27, but loaded with a loudspeaker of $6 \Omega$ nominal impedance.
an inductive coil to propel the cone). Once again, the magic of feedback does the job, this time with an op-amp output that is charmingly unsymmetrical. ${ }^{11}$

#### F. Power supply

An op-amp can provide the gain for a feedback voltage regulator (Figure 4.29). The op-amp compares a sample of the output with the zener reference, changing the drive to the Darlington "pass transistor" as needed. This circuit supplies a stable 10 volt output ("regulated"), at up to 1 amp load current. Some notes about this circuit:

[^185]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0269.jpg?height=632&width=751&top_left_y=207&top_left_x=142)

Figure 4.29. Voltage regulator.

- The voltage divider that samples the output could be a potentiometer, for adjustable output voltage.
- For reduced ripple at the zener, the 10 k resistor should be replaced with a current source. Another approach is to bias the zener from the output; that way you take advantage of the regulator you have built. Caution: when using this trick, you must analyze the circuit carefully to be sure it will start up when power is first applied.
- We used a rail-to-rail op-amp, which can swing its output to the positive rail, ${ }^{12}$ so that the input voltage can go as low as +12 V without putting the Darlington pass transistor into saturation. With a 411, by contrast, you would have to allow another $1.5-2 \mathrm{~V}$ of margin, because the opamp's output cannot get closer than that to the positive supply rail.
- The circuit as drawn could be damaged by a temporary short circuit across the output, because the op-amp would attempt to drive the Darlington pair into heavy conduction. Regulated power supplies should always have circuitry to limit "fault" current (see §9.1.1C for more details).
- Without the "compensation capacitor" $C_{\mathrm{C}}$ the circuit would likely oscillate when the dc output is bypassed (as it would be when powering a circuit) because of the additional lagging phase shift. Capacitor $C_{\mathrm{C}}$ ensures stability into a capacitive load, a subject we'll visit in $\S \S 4.6 .1 \mathrm{~B}$, 4.6.2, and 9.1.1C.
- Integrated circuit voltage regulators are available in tremendous variety, from the time-honored 723 to the

12 Our suggested LT1637 is a 44-volt "over-the-top" op-amp that exhibits strikingly higher input-bias currents when its input is near the positive rail (as much as $I_{\mathrm{B}}=20 \mu \mathrm{~A}$, about 100 times its normal bias current). The LT1677, with $I_{\mathrm{B}}=0.2 \mu \mathrm{~A}$, might be a better choice.
convenient 3-terminal adjustable regulators with internal current limit and thermal shutdown (see §9.3). These devices, complete with temperature-compensated internal voltage reference and pass transistor, are so easy to use that you will almost never use a general-purpose op-amp as a regulator. The exception might be to generate a stable voltage within a circuit that already has a stable powersupply voltage available.

In Chapter 9 we discuss voltage regulators and power supplies in detail, including special ICs intended for use as voltage regulators.

### 4.3.2 Nonlinear circuits

#### A. Comparator - an introduction

It is quite common to want to know which of two signals is larger, or to know when a given input signal exceeds a predetermined voltage. For instance, the usual method of generating triangle waves is to supply positive or negative currents into a capacitor, reversing the polarity of the current when the amplitude reaches a preset peak value. Another example is a digital voltmeter. In order to convert a voltage to a number, the unknown voltage is applied to one input of a comparator, with a linear ramp (capacitor + current source) applied to the other. A digital counter counts cycles of an oscillator during the time that the ramp is less than the unknown voltage and displays the result when equality of amplitudes is reached. The resultant count is proportional to the input voltage. This is called single-slope integration; in most sophisticated instruments a dual-slope integration is used (Chapter 13).

The simplest form of comparator is a high-gain differential amplifier, made either with transistors or with an opamp (Figure 4.30). In this circuit there's no feedback - the op-amp goes into positive or negative saturation according to the difference of the input voltages. Because of the enormous voltage gain of op-amps (typically $10^{5}-10^{6}$ ), the inputs will have to be equal to within a fraction of a millivolt in order for the output not to be saturated. Although an ordinary op-amp can be used as a comparator (and frequently is), there are special ICs intended for use as comparators. They let you set the output voltage levels independently of the voltages used to power the comparator (e.g., you can have output levels of 0 V and +5 V from a comparator powered from $\pm 15 \mathrm{~V}$ ); and they are generally much faster, because they are not trying to be op-amps, i.e., linear amplifiers intended for use with negative feedback. We'll talk about them in detail in Chapter 12 (§§12.1.7 and 12.3, and Table 12.2).).
<img class="imgSvg" id = "m2y4u43mk6miiglzjpg" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDNtazZtaWlnbHpqcGciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDIwMSAxMjcuMTc3MTU2MDM4NTc0OTkiIHN0eWxlPSJ3aWR0aDogMjAxLjM1NjcwNDkyOTUyNTk2cHg7IGhlaWdodDogMTI3LjE3NzE1NjAzODU3NDk5cHg7IG92ZXJmbG93OiB2aXNpYmxlOyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDNtazZtaWlnbHpqcGctMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjguNDMxMTc4NDYxOTQ5NTciIHkxPSI0Mi41ODcwNDE3NjQ2Njk2NjQiIHgyPSIxNTkuMzU2NzA0OTI5NTI1OTYiIHkyPSIzNi41OTg1Njg0NDQ3NjMyIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iOTEuMTU2NTE2NDMyNzc3ODkiIHkxPSI2MC4wNTU0MzgzNzQzNzk2MDUiIHgyPSIxMjguNDMxMTc4NDYxOTQ5NTciIHkyPSI0Mi41ODcwNDE3NjQ2Njk2NjQiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDNtazZtaWlnbHpqcGctNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMDIuNjE5NDUwMzY1ODkyMTYiIHkxPSIzNy4zMzQ4MDQ2NjAyODc0OSIgeDI9IjEyOC40MzExNzg0NjE5NDk1NyIgeTI9IjQyLjU4NzA0MTc2NDY2OTY2NCI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0M21rNm1paWdsempwZy03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjcwLjEyMjgwMDIwNTc4MTk0IiB5MT0iMzUuMTkwMDcwNzc0NTEyMzgiIHgyPSI5MS4xNTY1MTY0MzI3Nzc4OSIgeTI9IjYwLjA1NTQzODM3NDM3OTYwNSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0M21rNm1paWdsempwZy05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjkxLjE1NjUxNjQzMjc3Nzg5IiB5MT0iNjAuMDU1NDM4Mzc0Mzc5NjA1IiB4Mj0iMTEwLjY4MjYzMTM3ODAzOTU2IiB5Mj0iNzcuNzI1ODM2MjYxNjA3MSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0M21rNm1paWdsempwZy0xMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI3MC4xMjI4MDAyMDU3ODE5NCIgeTE9IjM1LjE5MDA3MDc3NDUxMjM4IiB4Mj0iMTAyLjYxOTQ1MDM2NTg5MjE2IiB5Mj0iMzcuMzM0ODA0NjYwMjg3NDkiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDNtazZtaWlnbHpqcGctMTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTAyLjYxOTQ1MDM2NTg5MjE2IiB5MT0iMzcuMzM0ODA0NjYwMjg3NDkiIHgyPSIxMTAuNjgyNjMxMzc4MDM5NTYiIHkyPSI3Ny43MjU4MzYyNjE2MDcxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTE1IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iMjEiIHgyPSI3MC4xMjI4MDAyMDU3ODE5NCIgeTI9IjM1LjE5MDA3MDc3NDUxMjM4Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTE3IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjExMC42ODI2MzEzNzgwMzk1NiIgeTE9Ijc3LjcyNTgzNjI2MTYwNzEiIHgyPSIxMjQuMjAxOTY1NzkwMjMyOTIiIHkyPSIxMDYuMTc3MTU2MDM4NTc0OTkiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxtYXNrIGlkPSJ0ZXh0LW1hc2stbTJ5NHU0M21rNm1paWdsempwZyI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0id2hpdGUiPjwvcmVjdD48Y2lyY2xlIGN4PSIxNTkuMzU2NzA0OTI5NTI1OTYiIGN5PSIzNi41OTg1Njg0NDQ3NjMyIiByPSI3Ljg3NSIgZmlsbD0iYmxhY2siPjwvY2lyY2xlPjxjaXJjbGUgY3g9IjQyIiBjeT0iMjEiIHI9IjcuODc1IiBmaWxsPSJibGFjayI+PC9jaXJjbGU+PGNpcmNsZSBjeD0iMTI0LjIwMTk2NTc5MDIzMjkyIiBjeT0iMTA2LjE3NzE1NjAzODU3NDk5IiByPSI4LjUzMTI1IiBmaWxsPSJibGFjayI+PC9jaXJjbGU+PC9tYXNrPjxzdHlsZT4KICAgICAgICAgICAgICAgIC5lbGVtZW50LW0yeTR1NDNtazZtaWlnbHpqcGcgewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMnk0dTQzbWs2bWlpZ2x6anBnIHsKICAgICAgICAgICAgICAgICAgICBmb250OiA4LjRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICA8L3N0eWxlPjxnIG1hc2s9InVybCgjdGV4dC1tYXNrLW0yeTR1NDNtazZtaWlnbHpqcGcpIj48bGluZSB4MT0iMTI4LjQzMTE3ODQ2MTk0OTU3IiB5MT0iNDIuNTg3MDQxNzY0NjY5NjY0IiB4Mj0iMTU5LjM1NjcwNDkyOTUyNTk2IiB5Mj0iMzYuNTk4NTY4NDQ0NzYzMiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDNtazZtaWlnbHpqcGctMScpIj48L2xpbmU+PGxpbmUgeDE9IjkxLjE1NjUxNjQzMjc3Nzg5IiB5MT0iNjAuMDU1NDM4Mzc0Mzc5NjA1IiB4Mj0iMTI4LjQzMTE3ODQ2MTk0OTU3IiB5Mj0iNDIuNTg3MDQxNzY0NjY5NjY0IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0M21rNm1paWdsempwZy0zJykiPjwvbGluZT48bGluZSB4MT0iMTAyLjYxOTQ1MDM2NTg5MjE2IiB5MT0iMzcuMzM0ODA0NjYwMjg3NDkiIHgyPSIxMjguNDMxMTc4NDYxOTQ5NTciIHkyPSI0Mi41ODcwNDE3NjQ2Njk2NjQiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTUnKSI+PC9saW5lPjxsaW5lIHgxPSI3MC4xMjI4MDAyMDU3ODE5NCIgeTE9IjM1LjE5MDA3MDc3NDUxMjM4IiB4Mj0iOTEuMTU2NTE2NDMyNzc3ODkiIHkyPSI2MC4wNTU0MzgzNzQzNzk2MDUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTcnKSI+PC9saW5lPjxsaW5lIHgxPSI5MS4xNTY1MTY0MzI3Nzc4OSIgeTE9IjYwLjA1NTQzODM3NDM3OTYwNSIgeDI9IjExMC42ODI2MzEzNzgwMzk1NiIgeTI9Ijc3LjcyNTgzNjI2MTYwNzEiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTknKSI+PC9saW5lPjxsaW5lIHgxPSI3MC4xMjI4MDAyMDU3ODE5NCIgeTE9IjM1LjE5MDA3MDc3NDUxMjM4IiB4Mj0iMTAyLjYxOTQ1MDM2NTg5MjE2IiB5Mj0iMzcuMzM0ODA0NjYwMjg3NDkiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTExJykiPjwvbGluZT48bGluZSB4MT0iMTAyLjYxOTQ1MDM2NTg5MjE2IiB5MT0iMzcuMzM0ODA0NjYwMjg3NDkiIHgyPSIxMTAuNjgyNjMxMzc4MDM5NTYiIHkyPSI3Ny43MjU4MzYyNjE2MDcxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0M21rNm1paWdsempwZy0xMycpIj48L2xpbmU+PGxpbmUgeDE9IjQyIiB5MT0iMjEiIHgyPSI3MC4xMjI4MDAyMDU3ODE5NCIgeTI9IjM1LjE5MDA3MDc3NDUxMjM4IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0M21rNm1paWdsempwZy0xNScpIj48L2xpbmU+PGxpbmUgeDE9IjExMC42ODI2MzEzNzgwMzk1NiIgeTE9Ijc3LjcyNTgzNjI2MTYwNzEiIHgyPSIxMjQuMjAxOTY1NzkwMjMyOTIiIHkyPSIxMDYuMTc3MTU2MDM4NTc0OTkiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQzbWs2bWlpZ2x6anBnLTE3JykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTU1LjQxOTIwNDkyOTUyNTk2IiB5PSI0MS44NDg1Njg0NDQ3NjMyIiBjbGFzcz0iZWxlbWVudC1tMnk0dTQzbWs2bWlpZ2x6anBnIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbHRyOwogICAgICAgICAgICAiPjx0c3BhbiBzdHlsZT0iCiAgICAgICAgICAgICAgICB1bmljb2RlLWJpZGk6IHBsYWludGV4dDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogbHItdGI7CiAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogbm9ybWFsOwogICAgICAgICAgICAgICAgdGV4dC1hbmNob3I6IHN0YXJ0OwogICAgICAgICAgICAiPlkxOTwvdHNwYW4+PC90ZXh0Pjx0ZXh0IHg9IjE1OS4zNTY3MDQ5Mjk1MjU5NiIgeT0iMzYuNTk4NTY4NDQ0NzYzMiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTI4LjQzMTE3ODQ2MTk0OTU3IiB5PSI0Mi41ODcwNDE3NjQ2Njk2NjQiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjkxLjE1NjUxNjQzMjc3Nzg5IiB5PSI2MC4wNTU0MzgzNzQzNzk2MDUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjcwLjEyMjgwMDIwNTc4MTk0IiB5PSIzNS4xOTAwNzA3NzQ1MTIzOCIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNDcuMjUiIHk9IjI2LjI1IiBjbGFzcz0iZWxlbWVudC1tMnk0dTQzbWs2bWlpZ2x6anBnIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogcnRsOyB1bmljb2RlLWJpZGk6IGJpZGktb3ZlcnJpZGU7CiAgICAgICAgICAgICI+PHRzcGFuIHN0eWxlPSIKICAgICAgICAgICAgICAgIHVuaWNvZGUtYmlkaTogcGxhaW50ZXh0OwogICAgICAgICAgICAgICAgd3JpdGluZy1tb2RlOiBsci10YjsKICAgICAgICAgICAgICAgIGxldHRlci1zcGFjaW5nOiBub3JtYWw7CiAgICAgICAgICAgICAgICB0ZXh0LWFuY2hvcjogc3RhcnQ7CiAgICAgICAgICAgICI+WTE5PC90c3Bhbj48L3RleHQ+PHRleHQgeD0iNDIiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMDIuNjE5NDUwMzY1ODkyMTYiIHk9IjM3LjMzNDgwNDY2MDI4NzQ5IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMTAuNjgyNjMxMzc4MDM5NTYiIHk9Ijc3LjcyNTgzNjI2MTYwNzEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyNC4yMDE5NjU3OTAyMzI5MiIgeT0iMTExLjQyNzE1NjAzODU3NDk5IiBjbGFzcz0iZWxlbWVudC1tMnk0dTQzbWs2bWlpZ2x6anBnIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbHRyOwogICAgICAgICAgICAiPjx0c3BhbiBzdHlsZT0iCiAgICAgICAgICAgICAgICB1bmljb2RlLWJpZGk6IHBsYWludGV4dDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogbHItdGI7CiAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogbm9ybWFsOwogICAgICAgICAgICAgICAgdGV4dC1hbmNob3I6IG1pZGRsZTsKICAgICAgICAgICAgIj5BbDwvdHNwYW4+PHRzcGFuIHN0eWxlPSJ1bmljb2RlLWJpZGk6IHBsYWludGV4dDsiPkg8dHNwYW4gYmFzZWxpbmUtc2hpZnQ9InN1YiIgY2xhc3M9InN1Yi1tMnk0dTQzbWs2bWlpZ2x6anBnIj4yPC90c3Bhbj48L3RzcGFuPjwvdGV4dD48dGV4dCB4PSIxMjQuMjAxOTY1NzkwMjMyOTIiIHk9IjEwNi4xNzcxNTYwMzg1NzQ5OSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PC9nPjwvc3ZnPg=="/>

Figure 4.30. Comparator: an op-amp without feedback.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0270.jpg?height=282&width=726&top_left_y=448&top_left_x=257)

Figure 4.31. Comparator without hysteresis produces multiple transitions from noisy input signal.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0270.jpg?height=445&width=809&top_left_y=877&top_left_x=218)

Figure 4.32. Positive feedback prevents multiple comparator transitions. A. Comparator without feedback. B. Schmitt trigger configuration uses positive feedback to prevent multiple output transitions. Special comparator ICs are generally preferable, and are drawn with the same symbol.

#### B. Schmitt trigger

The simple comparator circuit in Figure 4.30 has two disadvantages. For a very slowly varying input, the output swing can be rather slow. Worse still, if the input is noisy, the output may make several transitions as the input passes through the trigger point (Figure 4.31). Both these problems can be remedied by use of positive feedback (Figure 4.32). The effect of $R_{3}$ is to make the circuit have two thresholds, depending on the output state. In the example shown, the threshold when the output is at ground (input high) is 4.76 volts, whereas the threshold with the output at +5 volts is 5.0 volts. A noisy input is less likely to produce multiple triggering (Figure 4.33). Furthermore, the positive feedback ensures a rapid output transition, regardless of the speed of the input waveform. (A small "speed-up" capacitor of $10-100 \mathrm{pF}$ is often connected across $R_{3}$ to enhance switching speed still further.) This configuration is known
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0270.jpg?height=228&width=739&top_left_y=218&top_left_x=1100)

Figure 4.33. Hysteresis tames noise-prone comparator.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0270.jpg?height=269&width=549&top_left_y=570&top_left_x=1200)

Figure 4.34. Output versus input ("transfer function") for Schmitt trigger.
as a Schmitt trigger, a function that we saw earlier in a discrete transistor implementation (Figure 2.13).

The output depends both on the input voltage and on its recent history, an effect called hysteresis. This can be illustrated with a diagram of output versus input, as in Figure 4.34. The design procedure is easy for Schmitt triggers that have a small amount of hysteresis. Use the circuit of Figure 4.32B. First choose a resistive divider ( $R_{1}$, $R_{2}$ ) to put the threshold at approximately the right voltage; if you want the threshold near ground, just use a single resistor from noninverting input to ground. Next, choose the (positive) feedback resistor $R_{3}$ to produce the required hysteresis, noting that the hysteresis equals the output swing, attenuated by a resistive divider formed by $R_{3}$ and $R_{1} \| R_{2}$. Finally, if you are using a comparator with "open-collector" output, you must add an output pullup resistor small enough to ensure a nearly full supply swing, taking account of the loading by $R_{3}$ (read about comparator outputs in $\S 12.3$, and see Table 12.2). For the case in which you want thresholds symmetrical about ground, connect an offsetting resistor of appropriate value from the noninverting input to the negative supply. You may wish to scale all resistor values to keep the output current and impedance levels within a reasonable range.

#### C. Power-switching driver

The output of a comparator or Schmitt trigger switches abruptly between high and low voltages; it's not a continuous (or "linear") signal. You might want to use its output to turn a substantial load on or off. Examples might be a relay, laser, or motor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0271.jpg?height=762&width=767&top_left_y=216&top_left_x=137)

Figure 4.35. Power switching with an op-amp; A. With bipolar npn; note base current limit and reverse protection, B. With power MOSFET; note simplified drive circuit.

For loads that are either on or off, a switching transistor can be driven from a comparator or op-amp. Figure 4.35A shows how. Note the diode to prevent reverse base-emitter breakdown (op-amps powered from dual supply rails easily swing more than the -6 V base-emitter breakdown voltage); it would be omitted if the op-amp's negative supply were no more than -5 V . The TIP3055 is a jellybean classic power transistor for noncritical high-current applications, though you'll find plenty of variety of available types with improved maximum voltage, current, power dissipation, and speed (see the listing in Table 2.2 on page 106). A Darlington can be used if currents greater than about 1 amp need to be driven.

In general, however, you're better off using an $n$-channel power MOSFET, in which case you can dispense with the resistor and diode altogether (Figure 4.35B). The IRF520 ${ }^{13}$ is a near-classic - but the variety of readily available power MOSFETs is overwhelming (see Table 3.4); in general you trade off high breakdown voltage against low ONresistance.

When switching external loads, don't forget to include a reverse diode if the load is inductive (§1.6.7).

[^186]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0271.jpg?height=295&width=593&top_left_y=220&top_left_x=1076)

Figure 4.36. Simple active half-wave rectifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0271.jpg?height=343&width=711&top_left_y=647&top_left_x=1017)

Figure 4.37. Effect of finite slew rate on the simple active rectifier.

#### D. Active rectifier

Rectification of signals smaller than a diode drop cannot be done with a simple diode-resistor combination. As usual, op-amps come to the rescue, in this case by putting a diode in the feedback loop (Figure 4.36). For $V_{\text {in }}$ positive, the diode provides negative feedback; the circuit's output follows the input, coupled by the diode, but without a $V_{\mathrm{BE}}$ drop. For $V_{\text {in }}$ negative, the op-amp goes into negative saturation and $V_{\text {out }}$ is at ground. $R$ could be chosen smaller for lower output impedance, with the tradeoff of higher opamp output current. A better solution is to use an op-amp follower at the output, as shown, to produce very low output impedance regardless of the resistor value.

There is a problem with this circuit that becomes serious with high-speed signals. Because an op-amp cannot swing its output infinitely fast, the recovery from negative saturation (as the input waveform passes through zero from below) takes some time, during which the output is incorrect. It looks something like the curve shown in Figure 4.37. The output (heavy trace) is an accurate rectified version of the input (light trace), except for a short time interval after the input rises through zero volts. During that interval the op-amp output is racing up from saturation near $-V_{E E}$, so the circuit's output is still at ground. A general-purpose opamp like the 411 has a slew rate (maximum rate at which the output can change) of $15 \mathrm{~V} / \mu \mathrm{s}$; recovery from negative saturation therefore takes about $1 \mu \mathrm{~s}$ (when operating from $\pm 15 \mathrm{~V}$ supplies), which may introduce significant output
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0272.jpg?height=305&width=713&top_left_y=220&top_left_x=261)

Figure 4.38. Improved active half-wave rectifier.
error for fast signals. A circuit modification improves the situation considerably (Figure 4.38).
$D_{1}$ makes the circuit a unity-gain inverter for negative input signals. $D_{2}$ clamps the op-amp's output at one diode drop below ground for positive inputs, and since $D_{1}$ is then back-biased, $V_{\text {out }}$ sits at ground. The improvement comes because the op-amp's output swings only two diode drops as the input signal passes through zero. Because the opamp output has to slew only about 1.2 volts instead of $V_{\mathrm{EE}}$ volts, the "glitch" at zero crossings is reduced more than 10 -fold. This rectifier is inverting, incidentally. If you require a noninverted output, attach a unity-gain inverter to the output.

The performance of these circuits is improved if you choose an op-amp with a high slew rate. Slew rate also influences the performance of the other op-amp applications we've discussed, for instance the simple voltage amplifier circuits. Shortly we'll take a closer look at the ways in which real op-amps depart from the ideal - input current, offset voltage, bandwidth and slew rate, and so on - because you need to know about those limitations if you want to design good circuits. With that knowledge we'll also look at some active full-wave rectifier circuits to complement these half-wave rectifiers. ${ }^{14}$ First, though, we'd like to demonstrate some of the fun of designing with op-amps by showing a few real-world circuit examples.

### 4.3.3 Op-amp application: triangle-wave oscillator

These op-amp circuit fragments that we've been exploring - amplifiers, integrators, Schmitt triggers, etc. - are interesting enough; but the real excitement in circuit design comes when you creatively put pieces together to make a complete "something." A nice example that we can handle now is a triangle-wave oscillator. Unlike any other circuits so far, this one has no input signal; instead it creates an output signal, in this case a symmetrical triangle wave of

[^187]1 volt amplitude. As a by-product you also get a square wave, for free. (We'll see many more examples of oscillators in Chapter 7).

The idea is first to use an integrator (with a constantdc input voltage) to generate a ramp; we need to turn the ramp around when it reaches its $\pm 1 \mathrm{~V}$ limits, so we let the integrator output (the ramp) drive a Schmitt trigger, with thresholds at $\pm 1 \mathrm{~V}$. The output of the Schmitt, then, is what ought to determine the direction of the ramp. Aha! Just use its output (which switches between the supply rail voltages) as the input to the integrator.

Figure 4.39 shows a circuit implementation. It's easiest to start with $\mathrm{IC}_{2}$, which is wired as a noninverting Schmitt trigger (it looks like an inverting amplifier, but it's not note that feedback goes to the non-inverting input), for a reason we'll see soon. This configuration is used less frequently than the conventional inverting circuit of Figure 4.32B, because of its lower input impedance (and substantial input current reversal at threshold). Importantly, the LMC6482 has rail-to-rail output swing, so with $\pm 5 \mathrm{~V}$ power supplies its thresholds are at $\pm 1 \mathrm{~V}$, set by a 5:1 ratio of $R_{3}$ to $R_{2}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0272.jpg?height=483&width=805&top_left_y=1172&top_left_x=1072)

Figure 4.39. Triangle-wave oscillator.

The Schmitt's $\pm 5 \mathrm{~V}$ output is the input to the integrator $\mathrm{IC}_{1}$. We chose $C_{1}$ to be a convenient value of $0.01 \mu \mathrm{~F}$, then calculated $R_{1}$ to ramp through 2 V in a half period $(0.5 \mathrm{~ms})$, using $5 \mathrm{~V} / R_{1}=I_{\mathrm{in}}=C_{1}[d V / d t]_{\mathrm{ramp}}$. The calculated resistor value of $125 \mathrm{k} \Omega$ (in the figure we show the nearest standard 1\% "E96" resistor value; see Appendix C) came out reasonable, given real-world op-amp characteristics, as we'll learn later in the chapter. If it hadn't, we would have changed $C_{1}$; this is typically how you get to your final circuit component values.

Exercise 4.7. Confirm that value of $R_{1}$ is correct, and that the Schmitt trigger thresholds are at $\pm 1 \mathrm{~V}$.

Now the reason for connecting $\mathrm{IC}_{2}$ as a noninverting Schmitt trigger becomes clear: if $\mathrm{IC}_{2}$ 's output is at -5 V , say, then the triangle wave is ramping upward toward the Schmitt's +1 V threshold, at which point the Schmitt's output will switch to +5 V , reversing the cycle. If we had instead used the more conventional inverting Schmitt configuration, the oscillator would not oscillate; in that case it would "latch up" at one limit, as you can verify by walking through one cycle of operation.

The expressions for output frequency and amplitude are shown in the figure. It's interesting to note that the frequency is independent of supply voltage; but if you alter the resistor ratio $R_{2} / R_{3}$ to change the output amplitude, you will also change the frequency. Sometimes it is good to develop algebraic expressions for circuit operation, to see such dependencies. Here's how it goes in this case:

$$
\begin{align*}
& \frac{d V}{d t}=\frac{I}{C}=\frac{V_{\mathrm{S}} / R_{1}}{C_{1}}, \\
& \text { so } \quad \Delta t=C_{1} \frac{R_{1}}{V_{\mathrm{S}}} \Delta V, \\
& \text { but } \Delta V=2 \frac{R_{2}}{R_{3}} V_{S} \text {, } \\
& \text { so } \quad \Delta t=2 C_{1} R_{1} \frac{R_{2}}{R_{3}}, \\
& \text { and so, finally, } \quad f=\frac{1}{2 \Delta t}=\frac{1}{4 R_{1} C_{1}} \frac{R_{3}}{R_{2}} \text {. } \tag{4.4}
\end{align*}
$$

Note how $V_{\mathrm{s}}$ cancelled in the fourth step, leading to an output frequency independent of supply voltage.

A warning: it's easy to be dazzled by the apparent power of mathematics and quickly to fall in love with "algebraic circuit design." Our stern advice in this matter (and you can quote us on it) is:

Resist the temptation to take refuge in equations as a substitute for understanding how a circuit really works.

### 4.3.4 Op-amp application: pinch-off voltage tester

Here's another nice application of op-amps: suppose you want to measure a batch of JFETs in order to put them into groups that are matched in pinch-off voltage $V_{\mathrm{GS}}$ (off) (sometimes called $V_{P}$, see $\S 3.1 .3$ ). This is useful because the large spread of specified $V_{\mathrm{P}}$ sometimes makes it difficult to design a good amplifier. ${ }^{15}$ We'll assume that you want to find the gate-source back-bias that results in a drain

[^188]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0273.jpg?height=475&width=792&top_left_y=219&top_left_x=941)

Figure 4.40. Simple pinch-off voltage tester.
current of $1 \mu \mathrm{~A}$ with the drain at +10 V and the source grounded.

If you didn't know about op-amps, you could imagine (a) grounding the source, (b) hooking up a sensitive current meter from the drain to $\mathrm{a}+10 \mathrm{~V}$ supply, and then (c) adjusting the gate voltage with a variable negative supply to a value that produces $1 \mu \mathrm{~A}$ of measured drain current.

Figure 4.40 shows a better way. The device under test (you'll often see the acronym DUT) has its drain tied to +10 V ; but the source lead, instead of being grounded, is tied to the inverting input (virtual ground) of an op-amp whose noninverting input is grounded. The op-amp controls the gate voltage, thus holding the source at ground. Because the source is pulled down to -10 V through a 10 M resistor, the source current (and therefore the drain current) is $1 \mu \mathrm{~A}$. The op-amp's output is the same as the gate voltage, so the output of this circuit is the pinch-off voltage you wanted to know.

A few details:

- We chose power supply voltages of $\pm 10 \mathrm{~V}$ for the op-amp to make the rest of the circuit simpler, since we wanted to measure $V_{\mathrm{P}}$ with +10 V on the drain. That's OK , because most op-amps work well over a range of supply voltages (in fact, the trend is toward lower operating voltages, driven by the market for battery-powered consumer devices). But if you have only $\pm 15 \mathrm{~V}$ available, you would have to generate +10 V within your circuit, either with a voltage divider, a zener, or a 3-terminal voltage regulator (see Chapter 9).
- We put a 100 k resistor $\left(R_{1}\right)$ as protection in series with the gate to prevent any significant gate current from flowing during plug-in transients, etc. This can introduce a lagging phase shift around the loop at high frequencies (as can the rather large pull-down resistor $R_{2}$ ), so we added a small feedback capacitor $C_{1}$ to maintain stability.

We talk about this business of stability toward the end of the chapter, in §4.9.

- For this circuit to work properly, it's important that the op-amp's inverting input not load the source terminal, for example by drawing anything approaching a microamp of current. As we'll learn shortly, this is not always the case. For this example our general-purpose 411 op-amp, with its JFET input transistors, is fine (with input currents in the picoamperes); but an op-amp that uses bipolar transistors for its input stage would generally have input currents in the 10's to 100's of nanoamps, and should be avoided for a low-current application like this.
- The drain current at which pinch-off voltage is specified is not always $1 \mu \mathrm{~A}$. You'll see $V_{\mathrm{GS}(\text { off })}$ specified at values of drain current ranging from 1 nA to tens of microamps, depending on the size of the JFET, and the whim of the manufacturer. (In an informal survey of datasheets we found 1 nA to be the most popular, followed by $1 \mu \mathrm{~A}$, 10 nA , and 0.5 nA , with five other values used occasionally.) It would be easy to modify the circuit to accommodate higher test currents; but to go to 10 nA , say, you would need a $1 \mathrm{G} \Omega$ resistor for $R_{2}$ ! In that case a better solution is to return the pull-down resistor to a lower voltage, say -0.1 V , which you could generate with a voltage divider from the -10 V negative supply. You'd have to worry again about op-amp input currents with such a small test current.
Exercise 4.8. Show how to make the pinch-off tester operate from $\pm 15 \mathrm{~V}$ supplies, with the measurement still made at $V_{\mathrm{D}}=+10 \mathrm{~V}$; assume that the largest resistor value available is $10 \mathrm{M} \Omega$.

Exercise 4.9. Modify the pinch-off tester circuit of Figure 4.40 so that you can measure $V_{\mathrm{GS}}$ at three values of drain current, namely $1 \mu \mathrm{~A}, 10 \mu \mathrm{~A}$, and $100 \mu \mathrm{~A}$, by setting a 3-position switch. Assume that the largest resistor value you can conveniently get is $10 \mathrm{M} \Omega$.

Exercise 4.10. Now change the circuit so that it measures $V_{\mathrm{GS}(\mathrm{off})}$ at $I_{\mathrm{D}}=1 \mathrm{nA}$. Assume you can get $100 \mathrm{M} \Omega 5 \%$ resistors.

### 4.3.5 Programmable pulse-width generator

When triggered by a short input pulse, the circuit in Figure 4.41 generates an output pulse ${ }^{16}$ whose width is set by 10-turn pot $R_{1}$. Here's how it works.
$\mathrm{IC}_{1}, \mathrm{IC}_{2}$, and $Q_{1}$ form a current source that charges timing capacitor $C$, as we'll detail below. $\mathrm{IC}_{3}$ is a versatile timer IC, whose many exploits we will enjoy in Chapter 7. It holds $C$ discharged (through a saturated MOSFET

[^189]switch whose drain drives the DIS pin to ground) and simultaneously holds the output at ground, until it receives a negative-going trigger pulse at its TRIG input pin; at that point it releases DIS and switches its output to $V_{+}$, in this case +5 V .

The current source now charges $C$ with a positive-going ramp, according to $I=C d V / d t$. This continues until the capacitor voltage, which also drives $\mathrm{IC}_{3}$ 's TH input, reaches a voltage equal to $2 / 3$ of the supply voltage, $V_{\mathrm{TH}}=\frac{2}{3} V_{+}$; at this point $\mathrm{IC}_{3}$ abruptly pulls DIS back to ground, simultaneously switching its output to ground. This completes the cycle.

The current source is an elegant circuit. We want to source a current into the capacitor, with compliance from ground to at least $+3.3 \mathrm{~V}(2 / 3$ of $+5 \mathrm{~V})$, with linear control by a pot that returns to ground. For reasons we'll see presently, we want the programmed current proportional to the supply voltage $V_{+}$. In this circuit $Q_{1}$ is the current source, with $\mathrm{IC}_{2}$ controlling its base to hold its emitter at $+5 \mathrm{~V} . \mathrm{IC}_{1}$ is an inverting amplifier referenced to +5 V ; it pivots its output to a voltage that exceeds +5 V by an amount proportional to the current flowing through $R_{1}$ and $R_{2}$. That excess voltage appears across $R$, generating the output current. You'll know you understand how it works by doing the following problem.

Exercise 4.11. Calculate the current sourced by $Q_{1}$ by calculating the output voltage of IC ${ }_{1}$ as a function of $R_{\mathrm{X}}$ (the sum of $R_{1}$ and $R_{2}$ ), $R_{3}$, and $V_{+}$. Now use it to calculate the output pulse width, knowing that $\mathrm{IC}_{3}$ switches when the voltage at TH reaches $\frac{2}{3} V_{+}$.

This circuit is an illustration of the use of ratiometric techniques: for a given setting of $R_{1}$, both the capacitor charging current $I$ and the timer IC threshold voltage $V_{\mathrm{TH}}$ individually depend on supply voltage $V_{+}$; but their variation is such that the final pulse width $T$ does not depend on $V_{+}$. That is why the current source was designed with $I \propto V_{+}$. The use of ratiometric techniques is an elegant way to design circuits with excellent performance, often without requiring precise control of power-supply voltages.

### 4.3.6 Active lowpass filter

The simple $R C$ filters we saw back in Chapter 1 have a soft rolloff; that is, their response versus frequency does not progress sharply from a passband to a stopband. Perhaps surprisingly, this behavior cannot be remedied by simply cascading multiple stages, as we'll see in detail in Chapter 6 (and particularly in connection with active filters, §6.3). Much better filter performance can be achieved if
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0275.jpg?height=639&width=1131&top_left_y=216&top_left_x=381)

Figure 4.41. Pulse generator with programmable width.
you include both inductors and capacitors, or, equivalently, if you "activate" the filter design by using op-amps.

Figure 4.42 shows an example of a simple and even partly intuitive filter. This configuration is known as a Sallen-and-Key filter, after its inventors. The unity-gain amplifier can be an op-amp connected as a follower, or a unity-gain buffer IC, or just an emitter follower. This particular filter is a second-order lowpass filter. Note that it would be simply a pair of cascaded passive $R C$ lowpass filters, except for the fact that the bottom of the first capacitor is bootstrapped by the output. It is easy to see that at high frequencies (well beyond $f=1 / 2 \pi R C$ ) it falls off just like a cascaded $R C$, i.e., at $-12 \mathrm{~dB} /$ octave, because the output is essentially zero (and therefore the first capacitor's lower end is effectively grounded). As we lower the frequency and approach the passband, however, the bootstrap action tends to reduce the attenuation, thus giving a sharper "knee" to the curve of response versus frequency. We've plotted the response versus frequency, with three "tunings" of the $R$ and $C$ values. ${ }^{17}$

Of course, such hand-waving cannot substitute for honest analysis, which luckily has been done for a prodigious variety of nice filters. And contemporary generalpurpose SPICE-based analog simulation tools, or special filter analysis software, let you design and view filter response curves with relative ease.

[^190]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0275.jpg?height=914&width=820&top_left_y=956&top_left_x=957)

Figure 4.42. Sallen-and-Key active lowpass filter: A. Schematic; B. frequency response, compared with a cascade of two passive $R C$ sections.

## 4.4 A detailed look at op-amp behavior

We've hinted that op-amps aren't perfect, and that the performance of circuits such as active rectifiers and Schmitt triggers is limited by op-amp speed, or "slew rate." For those applications a high-speed op-amp is often required.

But slew rate is just one of a half-dozen important parameters of op-amps, which include input offset voltage, input bias current, input common-mode range, noise, bandwidth, output swing, and supply voltage and current. To state the situation fairly, op-amps are remarkable devices, with nearideal performance for most applications you are likely to encounter. To put it quantitatively, think of the difficulty of designing, with discrete transistors and other components, a high-gain dc differential amplifier that has an input current less than a picoamp, an offset from perfect balance less than a millivolt, a bandwidth of several megahertz, and that operates with its inputs anywhere between the two supply voltages. You can get such an op-amp for a dollar; it comes in a tiny package measuring $1.5 \mathrm{~mm} \times 3 \mathrm{~mm}$, and it draws less than a milliamp.

But op-amps do have performance limitations - that's why there are literally thousands of available types - and in general you're faced with a tradeoff: you can get much lower bias current (for example), at the expense of offset voltage. A good understanding of op-amp limitations and their influence on circuit design and performance will help you choose your op-amps wisely and design with them effectively.

To motivate the subject, imagine that you've been asked to design a dc amplifier, so that small voltages $(0-10 \mathrm{mV})$ can be seen on a handsome analog meter scale. And it should have at least $10 \mathrm{M} \Omega$ input resistance, and be accurate to $1 \%$ or so. No problem, you say...I'll just use the non-inverting amplifier configuration (to get high input resistance), with lots of gain ( $\times 1000$, say, so 10 mV is amplified to 10 V ). Speed is not an issue, so you don't worry about slew rate. With supreme confidence you draw up the circuit (with an LF411 op-amp), your technician builds it, and $\ldots$ your boss fires you! The thing was a disaster: it read $20 \%$ of full-scale with no input attached, and it drifted like crazy when carried outside. It does work OK - as a paperweight. ${ }^{18}$

To get started, look at Figure 4.43, a simplified schematic of the LF411. Its circuit is relatively straightforward, in terms of the kinds of transistor circuits we discussed in the last two chapters. It has a JFET differential input stage, with current-mirror active load, buffered with an npn follower (to prevent loading of the high-gain input stage) driving a grounded-emitter $n p n$ stage (with currentsource active load). This drives the push-pull emitter follower output stage ( $Q_{7} Q_{8}$ ), with current-limiting circuitry

[^191]( $R_{5} Q_{9}$ and $R_{6} Q_{10}$ ) to protect against output short-circuit. ${ }^{19}$ The curious feedback capacitor $C_{\mathrm{C}}$ ensures stability; we'll learn about it later. This circuit displays the internal circuitry characteristic of the typical op-amp, and from it we can see how and why op-amp performance departs from ideal.

Exercise 4.12. Explain how the current-limiting circuitry in Figure 4.43 works. What is the maximum output current?

Exercise 4.13. Explain the function of the two diodes in the output stage.

Let's look at these problems, what the consequences are for circuit design, and what to do about it.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0276.jpg?height=810&width=799&top_left_y=794&top_left_x=1070)

Figure 4.43. Simplified schematic of the LF411 op-amp.

### 4.4.1 Departure from ideal op-amp performance

The ideal op-amp has these characteristics:

- Input current $=0$ (input impedance $=\infty$ ).
- $V_{\text {out }}=0$ when both inputs are at precisely the same voltage (zero "offset voltage").
- Output impedance $($ open loop $)=0$.
- Voltage gain $=\infty$.
- Common-mode voltage gain $=0$.

19 The LF411's detailed schematic reveals a more elaborate negative current-limit configuration; check it out on the datasheet, to see if you can understand how it works.

- Output can change instantaneously (infinite slew rate).
$\cdot$ Absence of added "noise."
All of these characteristics should be independent of temperature and supply voltage changes.

In the following paragraphs we describe how real opamps depart from these ideals. As you struggle through the fact-filled sections, you may want to refer to Table 4.1 to maintain perspective. Tables $4.2 \mathrm{a}, \mathrm{b}, 5.5$, and 8.3 may be helpful also, for seeing some actual numbers. And we'll revisit these in more detail in Chapter 5 ( $\S 5.7$ and 5.8) in connection with the design of precision circuits.

#### A. Input offset voltage

Op-amps don't have perfectly balanced input stages, owing to manufacturing variations. The problem is worse with FETs, with their poorer matching of input thresholds. If you connect the two op-amp inputs together to create exactly zero differential input signal, the output will usually saturate at either $V_{+}$or $V_{-}$(you can't predict which). The difference in input voltages necessary to bring the output to zero is called the input offset voltage, $V_{\mathrm{OS}}$ (it's as if there were a battery of that voltage in series with one of the inputs). Typical offset voltages are around 1 mV , but "precision" op-amps can have offset voltages as small as $10 \mu \mathrm{~V}$. Some op-amps make provision for trimming the input offset voltage to zero. For a 411 you attach a 10k pot between pins 1 and 5 ("offset trim" in Figure 4.43), with the wiper connected to $V_{\mathrm{EE}}$, and adjust for zero offset; the effect is to unbalance deliberately the current mirror to compensate for the offset.

#### B. Offset voltage drift

Of greater importance for precision applications is the drift of the input offset voltage with temperature and time, since any initial offset could be manually trimmed to zero. A 411 has a typical offset voltage of 0.8 mV ( 2 mV maximum), with a tempco of $\Delta V_{\mathrm{OS}} / \Delta T=7 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ and unspecified coefficient of offset drift with time. The OP177A, a precision op-amp, is laser-trimmed for a maximum offset of 10 mi crovolts, with a temperature coefficient of $0.1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}(\max )$ and long-term drift of $0.2 \mu \mathrm{~V} /$ month (typical) - roughly a hundred times better in both offset and tempco.

#### C. Input current

The input terminals sink (or source, depending on the opamp type) a small current called the input bias current, $I_{\mathrm{B}}$, which is defined as half the sum of the input currents with the inputs tied together (the two input currents are approximately equal and are simply the base or gate currents of
the input transistors). For the JFET-input 411 the bias current is typically $50 \mathrm{pA}(200 \mathrm{pA} \max )$ at room temperature (but as much as 4 nA at $70^{\circ} \mathrm{C}$ ), while a typical BJT-input op-amp like the OP27 has a bias current of 15 nA , varying little with temperature. As a rough guide, BJT-input opamps have bias currents in the tens of nanoamps, whereas JFET-input op-amps have input currents in the tens of picoamps (i.e., 1000 times lower), and MOSFET-input opamps have input currents of typically a picoamp or less. Generally speaking, you can ignore input current with FET op-amps, but not with bipolar-input op-amps. ${ }^{20}$

The significance of input bias current is that it causes a voltage drop across the resistors of the feedback network, bias network, or source impedance. How small a resistor this restricts you to depends on the dc gain of your circuit and how much output variation you can tolerate. For example, an LF412's maximum input current of 200 pA means that you can tolerate resistances (seen from the input terminals) up to $\sim 5 \mathrm{M} \Omega$ before you have to worry about it at the 1 mV level.

We will see more about how this works later. If your circuit is an integrator, bias current produces a slow ramp even when there is no external input current to the integrator.

Op-amps are available with input bias currents down to a nanoamp or less for bipolar-transistor-input circuit types, or down to a fraction of a picoamp $\left(10^{-6} \mu \mathrm{~A}\right)$ for MOSFET-input circuit types. The very lowest bias currents are typified by the BJT-input LT1012, with a typical input current of 25 pA , the JFET-input OPA129, with an input current of 0.03 pA , and the MOSFET LMC6041, with an input current of 0.002 pA . At the other end, very fast BJT op-amps like the THS4011/21 ( $\sim 300 \mathrm{MHz}$ ) have input currents of $3 \mu \mathrm{~A}$. In general, BJT op-amps intended for highspeed operation have higher bias currents.

#### D. Input offset current

Input offset current is a fancy name for the difference of the input currents between the two inputs. Unlike input bias current, the offset current, $I_{\mathrm{OS}}$, is a result of manufacturing variations, since an op-amp's symmetrical input circuit would otherwise result in identical bias currents at the two inputs. The significance is that, even when it is driven by identical source impedances, the op-amp will see unequal voltage drops and hence a difference voltage between its inputs. You will see shortly how this influences design.

Typically, the offset current is somewhere between one-

[^192]Table 4.1 Op-amp Parameters ${ }^{a}$

| Parameter | bipolar (BJT) |  | JFET-input |  | cMOS |  | Units |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | jellybean | premium | jellybean | premium | jellybean | premium |  |
| $V_{\text {os }}$ (max) | 3 | 0.025 | 2 | 0.1 | 2 | 0.1 | mV |
| TCV ${ }_{\text {os }}$ (max) | 5 | 0.1 | 20 | 1 | 10 | 3 | $\mu \mathrm{V} /{ }^{\circ} \mathrm{C}$ |
| ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0278.jpg?height=50&width=99&top_left_y=510&top_left_x=451) | 50nA | 25pA | 50pA | 40fA | 1pA | 2fA | @ $25^{\circ} \mathrm{C}$ |
| en (typ) | 10 | 1 | 20 | 3 | 30 | 7 | nV/VHz @ 1kHz |
| $f_{\text {T }}$ (typ) | 2 | 2000 | 5 | 400 | 2 | 10 | MHz |
| SR (typ) | 2 | 4000 | 15 | 300 | 5 | 10 | V/us |
| $V_{\text {S }}(\mathrm{min})^{\mathrm{b}}$ | 5 | 1.5 | 10 | 5 | 2 | 1 | V |
| $V_{\text {s }}(\max )^{\text {b }}$ | 36 | 44 | 36 | 36 | 15 | 15 | V |

Notes: (a) typical and "best" values of important op-amp performance parameters. (b) total supply: $V_{+}-V_{-}$.
Typical and "best" values of important op-amp performance parameters. In this chart we list values for run-of-the-mill ("jellybean") parts, and for the best op-amp you can get for each individual parameter. That is, you cannot get a single op-amp that has the combination of excellent performance shown in any of the "premium" columns. In this chart you can clearly see that bipolar op-amps excel in precision, stability, speed, wide supply voltage range, and noise, at the expense of bias current; JFET-input types are intermediate, with CMOS op-amps displaying the lowest bias current.
half and one-tenth the bias current. For the 411, $I_{\text {offset }}=$ 25 pA , typical. However, for bias-compensated op-amps (like the OPA177), the specified offset current and bias current are comparable, for reasons we'll see in the advanced Chapter 5.

#### E. Input impedance

Input impedance refers to the small-signal ${ }^{21}$ differential input resistance (impedance looking into one input, with the other input grounded), which is usually much less than the common-mode resistance (a typical input stage looks like a long-tailed pair with current source). For the FET-input 411 it is about $10^{12} \Omega$, whereas for BJT-input op-amps like the LT1013 it is about $300 \mathrm{M} \Omega$. Because of the input bootstrapping effect of negative feedback (it attempts to keep both inputs at the same voltage, thus eliminating most of the differential-input signal), $Z_{\text {in }}$ in practice is raised to very high values and usually is not as important a parameter as input bias current.

#### F. Common-mode input range

The inputs to an op-amp must stay within a certain voltage range, typically less than the full supply range, for proper operation. If the inputs go beyond this range, the gain of the op-amp may change drastically, even reversing sign! For a 411 operating from $\pm 15$ volt supplies, the guaranteed common-mode input range is $\pm 11$ volts minimum.

[^193]However, the manufacturer claims that the 411 will operate with common-mode inputs all the way to the positive supply, though performance may be degraded. Bringing either input down to the negative supply voltage causes the amplifier to go berserk, with symptoms like phase reversal ${ }^{22}$ and output saturation to the positive supply. From the circuit in Figure 4.43 you can see why the LF411 cannot possibly operate with input voltages to the negative rail, because that would put the source terminals of the input JFET pair below the negative rail, taking them out of the active region. This is discussed further in Chapter $4 x$, along with some good war stories.

There are many op-amps available with common-mode input ranges down to the negative supply, e.g., the bipolar LT1013 and the CMOS TLC2272 and LMC6082; these are often referred to as "single-supply op-amps" or "groundsensing op-amps" (see §4.6.3). There are also some opamps whose common-mode input range includes the positive supply, e.g., the JFET LF356. With the trend toward lower supply voltages for battery-powered equipment, opamp designers have come up with varieties that accommodate input signals over the full range between supply voltages; these are called rail-to-rail, because supply voltages

[^194]are often called supply rails. ${ }^{23}$ Examples are the CMOS LMC6482 and TLV2400 series, and the bipolar LM6132, LT1630, and LT6220 series. These have the additional nice feature of being able to swing their outputs all the way to the rails (see the subsection on output swing below). These would seem to be ideal op-amps; however, as we discuss in $\S \S 5.7,5.9$, and 5.10 , rail-to-rail op-amps typically make compromises that affect other characteristics, notably offset voltage, output impedance, and supply current. There are, in addition, a few (very few) op-amps that operate properly for input voltages above the positive rail (for example, the "over-the-top" LT1637, listed in Table 4.2a on page 271).

In addition to the operating common-mode range, there are maximum allowable input voltages beyond which damage will result. For the 411 they are $\pm 15$ volts (but not to exceed the negative supply voltage, if it is less).

#### G. Differential input range

Some bipolar op-amps allow only a limited voltage between the inputs, sometimes as small as $\pm 0.5$ volt, although most are more forgiving, permitting differential inputs nearly as large as the supply voltages. Exceeding the specified maximum can degrade or destroy the op-amp.

#### H. Output swing versus load resistance

The LF411, typical of many op-amps, cannot swing its output closer than a volt or two from either supply rail, even when lightly loaded ( $R_{L}>5 \mathrm{k}$, say). That's because the output stage is a push-pull emitter follower, so even a full rail-to-rail drive to its bases would leave the output a diode drop short of both rails; the drive circuitry has its own difficulties getting close to the rails as well, and the currentlimit sense resistors $R_{5}$ and $R_{6}$ impose an additional voltage drop, which accounts for the shortfall.

For low values of load resistance, the internal currentlimit circuit will set the maximum swing. For example, the 411 can swing its output to within about 2 volts of $V_{\mathrm{CC}}$ and $V_{\text {EE }}$ into load resistances greater than about 1 k . Load resistances significantly less than that will permit only a small swing. This is frequently shown on datasheets as a graph of peak-to-peak output voltage swing $V_{\mathrm{om}}$ as a function of

[^195]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0279.jpg?height=506&width=618&top_left_y=206&top_left_x=1061)

Figure 4.44. Maximum peak-to-peak output swing versus load (LF411).
load resistance, or sometimes just a few values for typical load resistances. Figure 4.44 shows the datasheet's graph for the LF411. Many op-amps have asymmetrical output drive capability, with the ability to sink more current than they can source (or vice versa). For that reason you often see maximum output swing plotted, versus load current, as separate curves for output sourcing and sinking current into a load. Figure 4.45 shows such graphs for the LF411.

Some op-amps can produce output swings all the way down to the negative supply (e.g., the bipolar LT1013 and CMOS TLC2272), a particularly useful feature for circuits operated from a single positive supply, because output swings all the way to ground are then possible. Finally, opamps with CMOS transistor outputs in a common-source amplifier configuration ${ }^{24}$ (e.g., the LMC6xxx series) can swing all the way to both rails. For such op-amps a much more useful graph plots how close the output can get to each power-supply rail as a function of load current (both sourcing and sinking). An example is shown in Figure 4.46 for the CMOS rail-to-rail LMC6041. Note the effective use of log-log axes, so you can read off accurately the fact that this op-amp can swing to within 1 mV of the rails when supplying $10 \mu \mathrm{~A}$ of output current, and that its output resistance is approximately $80 \Omega$ (sinking) and $100 \Omega$ (sourcing). You can find bipolar op-amps that share this property, without the limited supply voltage range of the CMOS opamps (usually $\pm 8 \mathrm{~V}$ max), for example, the LM6132/42/52 family and the LT1636/7.

#### I. Output Impedance

Output impedance $R_{\mathrm{o}}$ means the op-amp's intrinsic output impedance without feedback (see Figure 2.90). For the 411 it is about $40 \Omega$, but with some low-power op-amps it can

[^196]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0280.jpg?height=491&width=683&top_left_y=219&top_left_x=281)

Figure 4.45. Maximum output voltage (both sourcing and sinking) versus load current (LF411). The maximum output current capability decreases by $\sim 25 \%$ at $T_{\mathrm{J}}=125^{\circ} \mathrm{C}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0280.jpg?height=616&width=680&top_left_y=896&top_left_x=280)

Figure 4.46. Maximum swing (as $\Delta \mathrm{V}$ from the respective rails) versus load current for a CMOS rail-to-rail output op-amp. The solid curves are measured values; you can't always trust datasheets in this case the datasheet's sourcing curve (dashed curve) is evidently in error.
be as high as several thousand ohms, a characteristic shared by some op-amps with rail-to-rail outputs. Feedback lowers the output impedance into insignificance (or raises it, for a current source), by a factor of the loop gain $A B$ (see $\S 2.5 .3 \mathrm{C}$ ); so what usually matters more is the maximum output current, with typical values of $\pm 20 \mathrm{~mA}$ or so (but much higher for the rarified group of "high current" opamps, see Table 4.2 b on page 272).

#### J. Voltage gain, bandwidth, and phase shift

Typically the voltage gain $A_{\mathrm{vo}}$ (sometimes called $A_{\mathrm{VOL}}, A_{\mathrm{V}}$, $G_{\mathrm{V}}$, or $G_{\mathrm{VOL}}$ ) at dc is 100,000 to $1,000,000$ (often specified
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0280.jpg?height=685&width=797&top_left_y=206&top_left_x=1073)

Figure 4.47. LF411 gain versus frequency ("Bode plot").
in decibels, thus 100 dB to 120 dB ), dropping to unity gain at a frequency (called $f_{\mathrm{T}}$, or sometimes gain-bandwidth product, GBW), most often in the range of 0.1 MHz to 10 MHz . This is usually given as a graph of open-loop voltage gain as a function of frequency, on which the $f_{\mathrm{T}}$ value is clearly seen; see, for example, Figure 4.47, which shows the curve for our favorite LF411.

For internally compensated op-amps this graph is simply a 6 dB /octave rolloff beginning at some fairly low frequency (for the 411 it begins at about 10 Hz ), an intentional characteristic necessary for stability, as we'll see in §4.9. This rolloff (the same as a simple $R C$ lowpass filter) results in a constant $90^{\circ}$ lagging phase shift from input to output (open-loop) at all frequencies above the beginning of the rolloff, increasing to $120^{\circ}$ to $160^{\circ}$ as the open-loop gain approaches unity. Because a $180^{\circ}$ phase shift at a frequency where the voltage gain equals 1 will result in positive feedback (oscillations), the term "phase margin" is used to specify the difference between the phase shift at $f_{\mathrm{T}}$ and $180^{\circ}$.

There's a price to pay for greater bandwidth $f_{\mathrm{T}}$, namely, higher transistor operating currents, and therefore higher op-amp supply currents. You can get op-amps with supply currents of less than $1 \mu \mathrm{~A}$, but they have $f_{\mathrm{T}}$ 's down around 10 kHz ! In addition to high supply currents, very fast opamps can have relatively high input bias currents, often more than a microamp, owing to their bipolar input stages operating at high collector current. Don't use fast op-amps if you don't need them - in addition to the drawbacks just mentioned, their high gain at high frequency makes it easier for your circuit to oscillate.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0281.jpg?height=406&width=795&top_left_y=205&top_left_x=123)

Figure 4.48. The maximum slew rate of a sinewave, $\mathrm{SR}=2 \pi A f$, occurs at the zero crossings.

#### K. Slew rate

The op-amp "compensation" capacitance (discussed further in §4.9.2) and small internal drive currents act together to limit the rate at which the output can change, even when a large input unbalance occurs. This limiting speed is usually specified as slew rate or slewing rate (SR). For the 411 it is $15 \mathrm{~V} / \mu \mathrm{s}$; low-power op-amps typically have slew rates less than $1 \mathrm{~V} / \mu \mathrm{s}$, whereas a high-speed op-amp might slew at hundreds of volts per microsecond. The slew rate limits the amplitude of an undistorted sine-wave output swing above some critical frequency (the frequency at which the full supply swing requires the maximum slew rate of the op-amp), thus the "output voltage swing as a function of frequency" graph (seen in datasheets; see for example Figure 4.54). A sine wave of frequency $f$ hertz and amplitude $A$ volts requires a minimum SR of $2 \pi A f$ volts per second, with the peak slewing occurring at the zero crossings (Figure 4.48). Figure 4.49 shows a 'scope trace illustrating realworld "slew-rate distortion."

For externally compensated op-amps, the slew rate depends on the compensation network used. In general, it will be lowest for "unity-gain compensation," increasing to perhaps 30 times faster for $\times 100$ gain compensation. This is discussed further in $\S 4.9 .2 \mathrm{~B}$ and in Chapter $4 x .{ }^{25}$ As with gain-bandwidth product $f_{\mathrm{T}}$, higher SR op-amps run at higher supply currents.

An important note: slew rate is ordinarily specified for a unity-gain configuration (i.e., a follower) with a full-swing step input. So there's is a large differential drive at the opamp's input, which really gets the currents flowing in there. The slew rate will be considerably less for a small input, say 10 mV .

[^197]LT1013

Figure 4.49. Slew-rate-induced distortion. This scope trace of an LT1013 op-amp follower, for which the datasheet specifies a typical SR of $0.4 \mathrm{~V} / \mu \mathrm{s}$, shows the input and output waveforms for a sinewave whose peak SR is $0.6 \mathrm{~V} / \mu \mathrm{s}(A=6.0 \mathrm{~V}, f=15.4 \mathrm{kHz})$; also shown is a slower sinewave, which overlays its (identical) output $(A=6.0 \mathrm{~V}, f=11 \mathrm{kHz}$ : $\mathrm{SR}=0.4 \mathrm{~V} / \mu \mathrm{s})$. Scales: $2 \mathrm{~V} / \mathrm{div}, 10 \mu \mathrm{~s} / \mathrm{div}$.

#### L. Temperature dependence

Most of these parameters have some temperature dependence. However, this usually doesn't make any difference, since small variations in gain, for example, are almost entirely compensated by feedback. Furthermore, the variations of these parameters with temperature are typically small compared with the variations from unit to unit.

The exceptions are input offset voltage and input offset current; these input errors will matter, particularly if you've trimmed the offsets approximately to zero, and will cause drifts in the output. When high precision is important, a low-drift "instrumentation" op-amp should be used, with external loads kept above 10k to minimize the horrendous effects on input-stage performance caused by temperature gradients. We will have much more to say about this subject in Chapter 5.

#### M. Supply voltage and current

Traditionally, most op-amps were designed for $\pm 15 \mathrm{~V}$ power supplies, with a smattering of "single-supply" opamps that operated on single supplies (i.e., $+V$ and ground), typically from +5 V to +15 V . The traditional split-supply op-amps were somewhat flexible; for example, the third-generation LF411 accepts supplies from $\pm 5 \mathrm{~V}$ to $\pm 18 \mathrm{~V}$. Most of these early op-amps ran at supply currents of a few milliamps.

There has been an important trend to lower-current and especially lower-voltage operation to accommodate battery-powered equipment. So, for example, it is now common to see op-amps that operate with total supply voltages (the span from $V_{+}$to $V_{-}$) of 5 V , or even 3 V , and run on supply currents of $10 \mu \mathrm{~A}$ to $100 \mu \mathrm{~A}$. These are usually
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0282.jpg?height=394&width=506&top_left_y=219&top_left_x=367)

Figure 4.50. Inverting amplifier.
built with $100 \%$ CMOS circuitry, but there are some bipolar designs as well. These are usually rail-to-rail output stages - obviously such op-amps cannot afford the luxury of the "no-closer-than-2-volts-from-either-rail" mantra!

When considering these op-amps, watch out for unusually low maximum supply voltage restrictions. Many such op-amps are limited to as little as 10 V total supply (i.e., $\pm 5 \mathrm{~V}$ ), and an increasing number are limited to 5 volts or less. Also, note that an op-amp with microamp quiescent current will necessarily draw plenty of current if you ask it to supply that amount of current to an attached load; output current doesn't come out of thin air.

#### N. Miscellany: CMRR, PSRR, $e_{\mathrm{n}}, i_{\mathrm{n}}$

For completeness, we should mention here that op-amps are also limited in common-mode rejection ratio (CMRR) and power-supply rejection ratio (PSRR), i.e., their incomplete rejection of common-mode input variations and power-supply fluctuations. This becomes more important at high frequencies, where the loop gain is decreasing and where the compensation capacitor $C_{\mathrm{C}}$ couples negative-rail fluctuations into the signal chain.

In addition, op-amps are not noiseless - they introduce both voltage noise $\left(e_{\mathrm{n}}\right)$ and current noise $\left(i_{\mathrm{n}}\right)$ at their input. These become significant limitations primarily in connection with precision circuits and low-noise amplifiers, and they will be treated in Chapters 5 and 8.

### 4.4.2 Effects of op-amp limitations on circuit behavior

Let's go back and look at the inverting amplifier with these limitations in mind. We'll see how they affect performance, and we'll learn how to design effectively in spite of them. With the understanding we'll get from this example, you should be able to handle other op-amp circuits. Figure 4.50 shows the circuit again.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0282.jpg?height=325&width=427&top_left_y=220&top_left_x=1261)

Figure 4.51. Op-amp noninverting amplifier with finite open-loop gain.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0282.jpg?height=684&width=605&top_left_y=684&top_left_x=1172)
$\begin{array}{rr}\text { GMD } & Z_{\text {out }}=\frac{Z \text { (open-loop) }}{1+A B} \\ \text { B. } \quad\left(B=\frac{R_{1}}{R_{1}+R_{2}}\right)\end{array}$
Figure 4.52. Input and output impedances: A. transresistance amplifier, B. inverting voltage amplifier.

#### A. Open-loop gain

Finite open-loop gain affects bandwidth, input and output impedances, and linearity. We saw this earlier, in the context of discrete transistor amplifiers, when we introduced negative feedback in Chapter 2 (§2.5.3). That material forms an essential background to what follows here; be sure to review it if you are foggy on this stuff.

#### Bandwidth

Because of finite open-loop gain, the voltage gain of the amplifier with feedback (closed-loop gain) will begin dropping at a frequency where the open-loop gain approaches $R_{2} / R_{1}$ (Figure 4.47). For garden-variety op-amps like the 411, this means that you're dealing with a relatively lowfrequency amplifier; the open-loop gain is down to 100 at

40 kHz , and $f_{\mathrm{T}}$ is 4 MHz . Note that the closed-loop gain is always less than the open-loop gain, so the overall amplifier will exhibit a noticeable falloff of gain at a fraction of $f_{\mathrm{T}}$. Recall from Chapter 2 that the closed-loop gain of the noninverting amplifier in Figure 4.51 is given by

$$
G=\frac{A}{1+A B}
$$

where $B$ is the fraction of the output fed back, in this case $B=R_{1} /\left(R_{1}+R_{2}\right)$. The output will therefore be down 3 dB at the frequency where the magnitude of the loop gain $A B$ is unity (i.e., where the magnitude of the open-loop gain $A$ equals the desired closed-loop gain $1 / B$ ), approximately 40 kHz for the LF411. ${ }^{26}$

Back in $\S 4.2 .5$ we remarked that op-amp current sources rely on the op-amp's voltage gain (thus loop gain) to raise its inherently low output resistance $R_{\mathrm{o}}$ (of order $\sim 100 \Omega$, see Figure 5.20), and that the decrease of open-loop gain with increasing frequency degrades the current-source's output impedance. This can be made quantitative: $Z_{\text {out }}$ at increasing frequencies is of the form $R_{\mathrm{O}} \cdot f_{\mathrm{T}} / f$.

#### Output impedance

Finite loop gain also affects the input and output impedances of a closed-loop op-amp circuit. Feedback can extract a sample of the output voltage (e.g., the noninverting voltage amplifiers we've been considering) or the output current (e.g., an op-amp current source). For voltage feedback the op-amp's open-loop output impedance is lowered by a factor of $1+A B$, bringing typical open-loop output impedances of tens to hundreds of ohms down to milliohms (for large loop gain), but rising back up to openloop values as the loop gain falls to unity at higher frequencies.

This linear rise in closed-loop output impedance is nicely illustrated in Figure 4.53, adapted from the LT1055 datasheet. You can see how greater loop gain (feedback configured for lower closed-loop gain) produces correspondingly lower output impedance; and you can see the linear rise up to the op-amp's native $R_{\text {out }}$ (sometimes designated $r_{\mathrm{o}}$ ), here about $60 \Omega$. Note also that an impedance that rises linearly with frequency is like an inductor. And, in fact, that's just what the output looks like for signals in this frequency range. This can have important conse-

[^198]quences, for example, creating a series $L C$ resonant circuit when the op-amp's load is capacitive.

The effect of the lowered loop gain (at high frequencies) is to degrade the beneficial effects of negative feedback. So a voltage amplifier suffers from increased output impedance, as we've seen. And the reverse is true for an amplifier with feedback that senses output current: here feedback normally acts to raise the native output impedance by a factor of loop gain (that's good: you want high output impedance in a current source), which then drops back to its open-loop values as the loop gain falls. Some op-amps (most notably those with rail-to-rail outputs) use an output stage with intrinsically high output impedance; for these op-amps a high loop gain is essential to achieve low output impedance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0283.jpg?height=550&width=598&top_left_y=878&top_left_x=1073)

Figure 4.53. An op-amp's closed-loop output impedance rises approximately linearly with frequency over a large portion of its bandwidth, thus behaving like an inductance $L_{\text {out }} \approx r_{0} G_{\mathrm{CL}} / 2 \pi f_{\mathrm{T}}$. After the loop gain drops to unity, $Z_{\text {out }}$ looks like the op-amp's open-loop output resistance $r_{0}$. These curves were adapted from the LT1055 datasheet.

#### Input impedance

The input impedance of a noninverting amplifier is raised by a factor of $1+A B$ from its open-loop value, a matter usually of little consequence because of the high native input impedances of op-amps.

The inverting amplifier circuit is different from the noninverting circuit and has to be analyzed separately. It's best to think of it as a combination of an input resistor driving a shunt feedback stage (Figure 4.52). The shunt stage alone has its input at the "summing junction" (the inverting input of the amplifier), where the currents from feedback and input signals are combined (this amplifier connection is really a "transresistance" configuration; it converts a current
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0284.jpg?height=493&width=609&top_left_y=218&top_left_x=318)

Figure 4.54. Peak-to-peak output swing versus frequency (LF411).
input to a voltage output). Feedback reduces the impedance looking into the summing junction, $R_{2}$, by a factor of $1+A$ (see if you can prove this). In cases of very high loop gain, the input impedance is reduced to a fraction of an ohm, a good characteristic for a current-input amplifier.

The classic op-amp inverting amplifier connection is a combination of a shunt feedback transresistance amplifier and a series input resistor, as in the figure. As a result, the input impedance equals the sum of $R_{1}$ and the impedance looking into the summing junction. For high loop gain, $R_{\text {in }}$ approximately equals $R_{1}$.

It is a straightforward exercise to derive an expression for the closed-loop voltage gain of the inverting amplifier with finite loop gain. The answer is

$$
\begin{equation*}
G=-A(1-B) /(1+A B) \tag{4.5}
\end{equation*}
$$

where $B$ is defined as before, $B=R_{1} /\left(R_{1}+R_{2}\right)$. In the limit of large open-loop gain $A, G=-1 / B+1$ (i.e., $G=$ $-R_{2} / R_{1}$ ).

Exercise 4.14. Derive the foregoing expressions for input impedance and gain of the inverting amplifier.

#### Linearity

In the limit of infinite loop gain, a feedback circuit's behavior depends on only the feedback network; the native nonlinearities of the op-amp (e.g., voltage dependence of gain, crossover distortion, and so on) are compensated by feedback. These defects reappear as loop gain is reduced, for example at higher frequencies. It is for this reason that you have to choose your op-amps with care, for example if you want to design low-distortion audio amplifier circuits. Op-amps intended for this sort of application have carefully designed output stages, and often they specify distor-
tion as a function of frequency and gain. An example is the excellent AD797, which specifies a maximum distortion of $0.0003 \%$ at 20 kHz and 3 V (rms) output.

#### B. Slew rate

Because of limited slew rate, the maximum undistorted sinewave output swing drops above a certain frequency. Figure 4.54 shows the curve for a 411 , with its $15 \mathrm{~V} / \mu \mathrm{s}$ slew rate. For slew rate $S$, the output amplitude is limited to $A(\mathrm{pp}) \leq S / \pi f$ for a sinewave of frequency $f$, thus explaining the $1 / f$ dropoff of the curve. The flat portion of the curve reflects the power-supply limits of output voltage swing. An easy formula to remember is ${ }^{27}$

$$
\begin{equation*}
S_{\min }=\omega A=2 \pi f A \tag{4.6}
\end{equation*}
$$

where $S_{\min }$ is the minimum required SR for a sinewave of amplitude $A$ (that's half the peak-to-peak amplitude: $A_{\mathrm{PP}}=$ $2 A$ ) and angular frequency $\omega$; recall that $\omega=2 \pi f$. As an aside, the slew-rate limitation of op-amps can be usefully exploited to filter sharp noise spikes from a desired signal, with a technique known as nonlinear lowpass filtering: if the slew rate is deliberately limited, the fast spikes can be dramatically reduced with little distortion of the underlying signal.

#### C. Output current

Because of limited output-current capability, an op-amp's output swing is reduced for small load resistances, as we saw in Figure 4.44. For precision applications it is a good idea to avoid large output currents in order to prevent onchip thermal gradients produced by excessive power dissipation in the output stage.

#### D. Offset voltage

Because of input offset voltage, a zero input produces an output ${ }^{28}$ of $V_{\text {out }}=G_{\mathrm{dc}} V_{\mathrm{OS}}=\left(1+R_{2} / R_{1}\right) V_{\mathrm{OS}}$. For an inverting amplifier with a voltage gain of 100 built with a 411, the output could be as large as $\pm 0.2$ volt when the input

[^199]is grounded ( $V_{\mathrm{OS}}=2 \mathrm{mV}$ max). Solutions: (a) If you don't need gain at dc, use a capacitor to drop the gain to unity at dc, as in Figure 4.7B. In this case you could do that by capacitively coupling the input signal. (b) Trim the voltage offset to zero with the manufacturer's recommended trimming network. (c) Use an op-amp with smaller $V_{\text {OS }}$. (d) Trim the voltage offset to zero with an external trimming network, as for example in §4.8.3 (see Figure 4.91).

#### E. Input bias current

Even with a perfectly trimmed op-amp (i.e., $V_{\mathrm{OS}}=0$ ), our inverting amplifier circuit will produce a nonzero output voltage when its input terminal is connected to ground. That is because the finite input bias current, $I_{\mathrm{B}}$, produces a voltage drop across the resistors, which is then amplified by the circuit's voltage gain. In this circuit the inverting input sees a driving impedance of $R_{1} \| R_{2}$, so the bias current produces a voltage $V_{\text {in }}=I_{\mathrm{B}}\left(R_{1} \| R_{2}\right)$, which is then amplified by the gain at dc, $1+R_{2} / R_{1}$ (see footnote 28); the result is an output error voltage of $V_{\text {out }}=I_{\mathrm{B}} R_{2}$.

With FET-input op-amps the effect is usually negligible, but the substantial input current of bipolar op-amps (and also current-feedback op-amps; see Chapter $4 x$ ) can cause real problems. For example, consider an inverting amplifier with $R_{1}=10 \mathrm{k}$ and $R_{2}=1 \mathrm{M}$; these are reasonable values for an audiofrequency inverting stage, where we might like to keep $Z_{\text {in }}$ at least 10 k . If we chose the low-noise bipolar NE5534 ( $I_{\mathrm{B}}=2 \mu \mathrm{~A}$, max), the output (for grounded input) could be as large as $100 \times 2 \mu \mathrm{~A} \times 9.9 \mathrm{k}$, or 1.98 volt $\left(G_{\mathrm{dc}} I_{\mathrm{B}} R_{\text {unbalance }}\right)$, which is unacceptable. By comparison, for our jellybean LF411 (JFET-input) op-amp, the corresponding worst-case output (for grounded input) is 0.2 mV ; for most applications this is negligible, and in any case is dwarfed by the $V_{\text {OS }}$-produced output error ( 200 mV , worstcase untrimmed, for the LF411).

There are several solutions to the problem of biascurrent errors. If you must use an op-amp with large bias current, it is a good idea to ensure that both inputs see the same dc driving resistance, as in Figure 4.55. In this case, 91 k is chosen as the parallel resistance of 100 k and 1 M . In addition, it is best to keep the resistance of the feedback network small enough so that bias current doesn't produce large offsets; typical values for the resistance seen from the op-amp inputs are 1 k to 100 k or so. A third cure involves reducing the gain to unity at dc, as in Figure 4.7B.

In most cases, though, the simplest solution is to use opamps with negligible input current. Op-amps with JFETor MOSFET-input stages generally have input currents in the picoamp range (watch out for its rapid rise versus temperature, though, roughly doubling every $10^{\circ} \mathrm{C}$ ),
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0285.jpg?height=309&width=521&top_left_y=218&top_left_x=1066)

Figure 4.55. With bipolar op-amps, use a compensation resistor to reduce errors caused by input bias current.
and many modern bipolar designs use superbeta transistors or bias-cancellation schemes to achieve bias currents nearly as low and decreasing slightly with temperature. With these op-amps, you can have the advantages of bipolar op-amps (precision, low noise) without the annoying problems caused by input current. For example, the precision low-noise bipolar OP177 has $I_{\mathrm{B}}<2 \mathrm{nA}$, and the bias-compensated bipolar LT1012 has $I_{\mathrm{B}}= \pm 25 \mathrm{pA}$ (typ). Among inexpensive FET op-amps, the JFET LF411 has $I_{\mathrm{B}}=50 \mathrm{pA}($ typ $)$, and the MOSFET TLC270 series, priced under a dollar, has $I_{\mathrm{B}}=1 \mathrm{pA}(\mathrm{typ})$.

#### F. Input offset current

As we just described, it is usually best to design circuits so that circuit impedances, combined with op-amp bias current, produce negligible errors. However, occasionally it may be necessary to use an op-amp with high bias current, or to deal with signals of extraordinarily high Thévenin impedances. Examples of high-bias-current amplifiers are current-feedback op-amps (e.g., the AD844), low-noise $\left(e_{n}\right)$ op-amps (e.g., the AD797), and wideband op-amps (e.g., the LM7171), each with input currents of several microamps.

In these cases the best you can do is to balance the dc driving resistances seen by the op-amp at its input terminals. There will still be some error at the output ( $G_{\mathrm{dc}} I_{\mathrm{offset}} R_{\mathrm{source}}$ ) that is due to unavoidable asymmetry in the op-amp input currents. In general, $I_{\text {offset }}$ is smaller than $I_{\text {bias }}$ by a factor of 2 to 20 (with bipolar op-amps generally showing better matching than FET op-amps).

#### G. Limitations imply tradeoffs

In the preceding paragraphs we discussed the effects of op-amp limitations, taking the example of the simple inverting voltage amplifier circuit. Thus, for example, opamp input current caused a voltage error at the output. In a different op-amp application you may get a different effect; for example, in an op-amp integrator circuit, a finite input current produces an output ramp (rather than a
constant) with zero applied input. As you become familiar with op-amp circuits you will be able to predict the effects of op-amp limitations in a given circuit and therefore choose which op-amp to use in a given application. In general, there is no "best" op-amp (even when price is no object): for example, op-amps with the very lowest input currents (MOSFET types) generally have larger voltage offsets and greater noise, and vice versa. Good circuit designers choose their components with the right tradeoffs to optimize performance, without going overboard on unnecessary "gold-plated" parts.

To help put this discussion of "op-amp realities" into perspective, you may want to look again at Table 4.1 on page 245 , where we've summarized the kinds of performance you can expect from op-amps that might be described as average, or "jellybean" (for example, the LF412 is a jellybean JFET op-amp), and from those that are among the best available ("premium") for each given parameter. Sadly, you can't get an op-amp that combines all the characteristics in a "premium" column; engineering is the art of compromise.

The limitations of op-amp performance we have talked about will have an influence on component values in nearly all circuits. For instance, the feedback resistors must be large enough so that they don't load the output significantly, but they must not be so large that input bias current produces sizable offsets. High impedances in the feedback network cause both loading effects, and destabilizing phase shifts, from stray capacitances; they also increase susceptibility to capacitive pickup of interfering signals. These tradeoffs typically dictate resistor values of 2 k to 100 k with general-purpose op-amps.

Similar sorts of tradeoffs are involved in almost all electronic design, including the simplest circuits constructed with transistors. For example, the choice of quiescent current in a transistor amplifier is limited at the high end by device dissipation, increased input current, excessive supply current, and reduced current gain, whereas the lower limit of operating current is limited by leakage current, reduced current gain, and reduced speed (from stray capacitance in combination with the high resistance values). For these reasons you typically wind up with collector currents in the range of a few tens of microamps to a few tens of milliamps (higher for power circuits, sometimes a bit lower in "micropower" applications), as mentioned in Chapter 2.

In later chapters we look more carefully at some of these problems in order to convey a good understanding of the tradeoffs involved.

Exercise 4.15. Draw a dc-coupled inverting amplifier with a gain
of 100 and $Z_{\text {in }}=10 \mathrm{k}$. Include compensation for input bias current and show offset voltage trimming network ( 10 k pot between pins 1 and 5 , wiper tied to $V_{-}$). Now add circuitry so that $Z_{\text {in }} \geq$ $10^{8} \Omega$.

### 4.4.3 Example: sensitive millivoltmeter

To put flesh on these bones, let's look at a very simple design example - a dc amplifier with lots of gain, high input impedance, and (for variety in today's too-digital world) an analog zero-center panel meter readout. We'll aim for $\pm 10 \mathrm{mV}$ full-scale sensitivity, and 10 megohms input impedance.

Figure 4.56 shows the initial design, where we assume we've got $\pm 5 \mathrm{~V}$ supplies available (more on this later), and we use a noninverting gain of 100 to produce a $\pm 1 \mathrm{~V}$ opamp output at fullscale. That drives a $100-0-100 \mu \mathrm{~A}$ zerocenter meter movement, which we decorate with a relabeled scale that reads " $-10 \mathrm{mV} \cdots 0 \cdots 10 \mathrm{mV}$."
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0286.jpg?height=419&width=828&top_left_y=1053&top_left_x=1058)

Figure 4.56. Sensitive millivoltmeter with analog readout; see text for choice of $I_{1}$.

It looks simple, and it is. But it won't work well if we're not careful. Imagine we choose our default LF411 for IC $\mathrm{C}_{1}$, figuring that the low bias current of a JFET-input op-amp is just what we need. We short the input leads together and find to our horror that the meter reads way off center, as much as $\pm 2 \mathrm{mV}$. That's because the 411 has $V_{\mathrm{OS}}=2 \mathrm{mV}$ (max). Ideally we'd like the thing to read zero with the input leads shorted or open, where "zero" might realistically mean no more than $1 \%$ of the full-scale reading.

OK, we add an offset trimmer and adjust it until the output reads zero with shorted input. We leave it on the bench, go to lunch, then come back and find it now reads -0.2 mV with shorted input. That's because it sat in the sun, warmed up by $10^{\circ} \mathrm{C}$, and therefore drifted by $200 \mu \mathrm{~V}$ (the LF411 has a temperature coefficient of offset voltage $\mathrm{TCV}_{\mathrm{OS}}=20 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$, max). Well, we won't use it in the sun!

So, we wait for it to cool down, and note with satisfaction that it reads zero again.

Now we go to test it on a voltage divider, but we find that when we remove the short (test leads open circuited) the meter reads +2 mV ! This time the problem is bias current, specified as 200 pA (max) at room temperature. That's not much current, but it develops $2000 \mu \mathrm{~V}$ across the 10 M input resistor, which the meter dutifully reports as an input.

We could solve the $V_{\mathrm{OS}}$ problem with a precision bipolar op-amp, but we'd be in worse trouble with $I_{\mathrm{B}}$. We need an op-amp with $V_{\mathrm{OS}}<100 \mu \mathrm{~V}$ and $I_{\mathrm{B}}<10 \mathrm{pA}$. The solution is a precision FET-input op-amp, for example, the OPA336 ( $125 \mu \mathrm{~V}$ untrimmed, and 10 pA ), which is just about good enough without trimming, and certainly fine if we're willing to trim the initial offset.

A better solution here is to use a "chopper" op-amp like the LTC1050C or AD8638 (see Table 5.6). These are sometimes called "zero-drift," or "auto-zeroing" amplifiers. We'll learn about them shortly, and in more detail in the next chapter; for now all you need to know is that they offer specifications like $V_{\mathrm{OS}}<5 \mu \mathrm{~V}$, $\mathrm{TC} V_{\mathrm{OS}}<0.05 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$, and $I_{\mathrm{B}}<50 \mathrm{pA}$ (those are, in fact, the worst-case specs for the LTC1050 in its inexpensive C-suffix grade).

A final thought: having a calibration adjustment is OK if you're building just a few of these things. But in production it would be nice to avoid manual calibration steps. An elegant circuit solution that circumvents calibration is to use a current-sensing resistor on the low side of the meter. We include this feature when we revisit this example early in Chapter 5 (§5.2), in a more rigorous approach to precision design.

### 4.4.4 Bandwidth and the op-amp current source

Back in $\S 4.2 .5$ we remarked that op-amp current sources rely on the op-amp's voltage gain (thus loop gain) to raise its inherently low output resistance $R_{\mathrm{o}}$ (of order $\sim 100 \Omega$, see Figure 5.20), and that the decrease of open-loop gain with increasing frequency degrades the current-source's output impedance. Put another way, the op-amp current source is a peculiar circuit, because an op-amp virtue (inherently low output impedance, i.e., a voltage source) becomes a vice, which must be punished with the cudgel of plentiful loop gain. This can be made quantitative: because of finite bandwidth $f_{\mathrm{T}}$, the output impedance of an opamp current source at increasing frequencies is of the form $R_{0} \cdot f_{\mathrm{T}} / f$, dropping ultimately to the op-amp's native output resistance $R_{\mathrm{O}}$ at the unity-gain frequency $f_{\mathrm{T}}$.

Likewise, finite slew rate affects the current-source's output impedance, making it look like a shunt capacitance.

Here's how to think about it: an ideal current source with a real capacitive load slews at a rate $S=d V / d t=I / C$; so a current source that is afflicted with a maximum slew rate $S$ looks like an ideal current source burdened with an effective shunt capacitance $C_{\text {eff }}=I_{\text {out }} / S$. For example, a 10 mA current source made with an op-amp of slew rate $1 \mathrm{~V} / \mu \mathrm{s}$ has an effective capacitive load of 10 nF ; this is rather large, compared even with a large MOSFET.

## 4.5 A detailed look at selected op-amp circuits

The performance of the next few circuits is affected significantly by the limitations of op-amps; we will go into a bit more detail in their description.

### 4.5.1 Active peak detector

There are numerous applications in which it is necessary to determine the peak value of some input waveform. The simplest method is a diode and capacitor (Figure 4.57). The highest point of the input waveform charges up $C$, which holds that value while the diode is back-biased.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0287.jpg?height=166&width=351&top_left_y=1167&top_left_x=1197)

Figure 4.57. Passive peak detector.
This method has some serious problems. The input impedance is variable and is very low during peaks of the input waveform. Also, the diode drop makes the circuit insensitive to peaks less than about 0.6 volt, and inaccurate (by one diode drop) for larger peak voltages. Furthermore, since the diode drop depends on temperature and current, the circuit's inaccuracies depend on the ambient temperature and on the rate of change of output; recall that $I=C(d V / d t)$. An input emitter follower would improve the first problem only.

Figure 4.58A shows a better circuit, which exhibits the benefits of feedback. By taking feedback from the voltage at the capacitor, the diode drop doesn't cause any problems. The sort of output waveform you might get is shown in Figure 4.59.

Op-amp limitations affect this circuit in three ways.
(a) A finite op-amp slew rate causes a problem, even with relatively slow input waveforms. To understand this, note that the op-amp's output goes into negative saturation when the input is less positive than the output
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0288.jpg?height=677&width=753&top_left_y=220&top_left_x=205)

Figure 4.58. A. Op-amp peak detector (more accurately, a "peak tracker"). B. Improved peak tracker responds to short peaks, because the input op-amp does not have to slew from negative saturation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0288.jpg?height=353&width=718&top_left_y=1142&top_left_x=261)

Figure 4.59. Peak detector output waveform.
(try sketching the op-amp voltage on the graph; don't forget about diode forward drop). So the op-amp's output has to race back up to the output voltage (plus a diode drop) when the input waveform next exceeds the output. At slew rate $S$, this takes roughly $\left(V_{\text {out }}-V_{-}\right) / S$, where $V_{-}$is the negative supply voltage. Improved circuit 4.58B solves this problem.
(b) Input bias current causes a slow discharge (or charge, depending on the sign of the bias current) of the capacitor. This is sometimes called "droop," and it is best avoided by using op-amps with very low bias current. For the same reason, the diode must be a low-leakage type (e.g., the FJH1100, with less than 1 pA reverse current at 20 V , an "FET diode" such as the PAD5, or a diode-connected JFET such as the 2N4417; see the diode discussion in Chapter $1 x$ ), and the follow-
ing stage must also present high impedance (ideally it should also be an FET or FET-input op-amp).
(c) The maximum op-amp output current limits the rate of change of voltage across the capacitor, i.e., the rate at which the output can follow a rising input. Thus the choice of capacitor value is a compromise between low droop and high output slew rate.

For instance, a $1 \mu \mathrm{~F}$ capacitor used in this circuit with the common LM358 (which would be a poor choice because of its high bias current) would droop at $d V / d t=I_{\mathrm{B}} / C=$ $0.04 \mathrm{~V} / \mathrm{s}$ (using the "typical" value $I_{\mathrm{B}}=40 \mathrm{nA}$; the worstcase value of $I_{\mathrm{B}}=500 \mathrm{nA}$ produces a droop of $0.5 \mathrm{~V} / \mathrm{s}$ ) and would follow input changes only up to $d V / d t=I_{\text {output }} / C=$ $0.02 \mathrm{~V} / \mu \mathrm{s}$. This maximum follow rate is much less than the op-amp's slew rate of $0.5 \mathrm{~V} / \mu \mathrm{s}$, being limited by the maximum output current of 20 mA driving $1 \mu \mathrm{~F}$. By decreasing $C$ you could achieve greater output slewing rate, at the expense of greater droop. A more realistic choice of components would be the popular TLC2272 MOSFET-input opamp as driver and output follower (1 pA typical bias current) and a value of $C=0.01 \mu \mathrm{~F}$. With this combination you would get a droop of only $0.0001 \mathrm{~V} / \mathrm{s}$ and an overall circuit slew rate of $2 \mathrm{~V} / \mu \mathrm{s}$. For even better performance, use a MOSFET op-amp like the LMC660 or LMC6041, with a typical input current of 2 femtoamps. Capacitor leakage (or diode leakage or both) may then limit performance even if unusually good capacitors are used, e.g., polystyrene or polypropylene (see Chapter $1 x$ ). ${ }^{29}$

#### A. Resetting a peak detector

In practice it is usually desirable to reset the output of a peak detector in some way. One possibility is to put a resistor across the peak-hold capacitor so that the circuit's output decays with a time constant $R C$. In this way it holds only the most recent peak values. A better method is to put a transistor switch across $C$; a short pulse to the base then zeros the output. An FET switch is often used instead. For example, in Figure 4.58 you could connect an $n$-channel MOSFET such as a 2N7000 across $C$; bringing the gate

[^200]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0289.jpg?height=1392&width=843&top_left_y=208&top_left_x=80)
B. LF398 (integrated circuit S/H)

GND
Figure 4.60. Sample-and-hold: A. Standard configuration, with exaggerated waveform; B. LF398 single-chip S/H.
momentarily positive then zeros the capacitor voltage. An integrated CMOS analog switch (such as the MAX318, with a small series resistor to limit the current) can be used instead of a discrete nMOS (n-type metal-oxide semiconductor) transistor.

### 4.5.2 Sample-and-hold

Closely related to the peak detector is the "sample-andhold" (S/H) circuit (sometimes called "follow-and-hold"). These are especially popular in digital systems in which you want to convert one or more analog voltages to num-
bers so that a computer can digest them: the favorite method is to grab and hold the voltage(s), then do the digital conversion at your leisure. The basic ingredients of an S/H circuit are an op-amp and an FET switch; Figure 4.60 A shows the idea. $\mathrm{IC}_{1}$ is a follower to provide a low-impedance replica of the input. CMOS analog switch $S_{1}$ passes the signal through during "sample" and disconnects it during "hold." Whatever signal was present when $S_{1}$ was turned OFF is held on capacitor $C . \mathrm{IC}_{2}$ is a high-input-impedance follower (FET inputs), so that capacitor current during "hold" is minimized. The value of $C$ is a compromise: leakage currents in $S_{1}$ and the follower cause $C$ 's voltage to"droop" during the hold interval according to $d V / d t=I_{\text {leakage }} / C$. Thus $C$ should be large to minimize droop. But $S_{1}$ 's ON-resistance forms a lowpass filter in combination with $C$, so $C$ should be small if high-speed signals are to be followed accurately. $\mathrm{IC}_{1}$ must be able to supply $C$ 's charging current ( $I=C d V / d t$ ) and must have sufficient slew rate to follow the input signal. In practice, the slew rate of the whole circuit will usually be limited by IC ${ }_{1}$ 's output current and $S_{1}$ 's ON-resistance.

Exercise 4.16. Suppose $\mathrm{IC}_{1}$ can supply 10 mA of output current and $C=0.01 \mu \mathrm{~F}$. What is the maximum input slew rate the circuit can accurately follow? If $S_{1}$ has $50 \Omega$ oN resistance, what will be the output error for an input signal slewing at $0.1 \mathrm{~V} / \mu \mathrm{s}$ ? If the combined leakage of $S_{1}$ and $\mathrm{IC}_{2}$ is 1 nA , what is the droop rate during the "hold" state?

For both the S/H circuit and the peak detector, an opamp drives a capacitive load. When designing such circuits, make sure you choose an op-amp that is stable at unity gain when loaded by the capacitor $C$. Some op-amps, (e.g., the LT1457, a member of Linear Technology's "CLOAD" ${ }^{\mathrm{TM}}$ stable" op-amps) are specifically designed to drive large $(0.01 \mu \mathrm{~F})$ capacitive loads directly. Some other tricks you can use are discussed in §4.6.1B and in Chapter $4 x$.

You don't have to design S/H circuits from scratch, because there are nice monolithic ICs that contain all the parts you need. National's LF398 is a popular part, containing the FET switch and two op-amps in an inexpensive (\$1.25) 8-pin package. Figure 4.60B shows how to use it. Note how feedback closes the loop around both op-amps. There are plenty of fancy S/H chips available, if you need better performance than the LF398 offers. For example, the AD783 from Analog Devices includes an internal capacitor and guarantees a maximum acquisition time of $0.4 \mu \mathrm{~s}$ for $0.01 \%$ accuracy following a 5 volt step.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0290.jpg?height=366&width=527&top_left_y=220&top_left_x=369)

Figure 4.61. Active clamp.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0290.jpg?height=294&width=731&top_left_y=690&top_left_x=252)

Figure 4.62. Finite slew-rate causes clamp output "glitches".

### 4.5.3 Active clamp

Figure 4.61 shows a circuit that is an active version of the clamp function we discussed in Chapter 1. For the values shown, $V_{\text {in }}<+10$ volts puts the op-amp output at positive saturation, and $V_{\text {out }}=V_{\text {in }}$. When $V_{\text {in }}$ exceeds +10 volts the diode closes the feedback loop, clamping the output at 10 volts. In this circuit, op-amp slew-rate limitations allow small glitches as the input reaches the clamp voltage from below (Figure 4.62).

Exercise 4.17. The active clamp in Figure 4.61 suffers from a slew-rate speed limitation similar to that of the peak tracker of Figure 4.58A. Figure out an improvement to the clamp circuit, analogous to the trick used in Figure 4.58B.

### 4.5.4 Absolute-value circuit

The circuit shown in Figure 4.63 gives a positive output equal to the magnitude of the input signal; it is a full-wave rectifier. As usual, the use of op-amps and feedback eliminates the diode drops of a passive full-wave rectifier.

You can imagine situations in which you want an output proportional to the logarithm of the absolute value. A simple circuit change might be to substitute a diode (or transistor with base tied to collector) for the feedback resistor of the second op-amp, exploiting the Ebers-Moll relation between diode voltage and summing-junction current. As we will see in Chapter $4 x$, this is the basis of the logarithmic amplifier; the circuit needs a few
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0290.jpg?height=422&width=799&top_left_y=207&top_left_x=1075)

Figure 4.63. Active full-wave rectifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0290.jpg?height=488&width=529&top_left_y=713&top_left_x=1210)

Figure 4.64. Another full-wave rectifier; note that ground is the negative supply voltage for $\mathrm{IC}_{2}$.
additional components, however, to compensate for the temperature coefficient of $V_{\mathrm{BE}}$.

Exercise 4.18. Figure out how the circuit in Figure 4.63 works. Hint: apply first a positive input voltage and see what happens; then do negative.

Figure 4.64 shows another absolute-value circuit. It is readily understandable as a simple combination of an optional inverter $\left(\mathrm{IC}_{1}\right)$ and an active clamp $\left(\mathrm{IC}_{2}\right)$. For negative input levels the clamp holds point $X$ at ground, making $\mathrm{IC}_{1}$ a unity-gain inverter; for positive input levels, the clamp is out of the circuit, with its output at negative saturation, making $\mathrm{IC}_{1}$ a follower. Thus the output is equal to the absolute value of the input voltage. By running $\mathrm{IC}_{2}$ from a single positive supply, you avoid problems of slew-rate limitations in the clamp, since its output moves over only one diode drop. Note that no great accuracy is required of $R_{3}$.

### 4.5.5 A closer look at the integrator

We introduced the op-amp integrator in $\S 4.2 .6$, before dealing with input bias current and offset voltage. One problem with that circuit (Figure 4.16) is that the output tends
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0291.jpg?height=820&width=667&top_left_y=202&top_left_x=187)

Figure 4.65. Integrator errors: bias current and offset voltage.
to wander off, even with the input grounded, because of op-amp offsets and bias current (there's no feedback at dc, which violates the third item in §4.2.7). This problem can be minimized by using a FET op-amp for low input current and offset, trimming the op-amp input offset voltage, and using large $R$ and $C$ values. Furthermore, in applications in which the integrator is zeroed periodically by closing a switch placed across the capacitor (Figures 4.18A-C), only the drift over short time scales matters.

It's worth looking at this in a bit more detail. Look at the integrator in Figure 4.65, shown with a choice of voltage input $V_{\text {in }}$ (which, in the absence of op-amp errors, produces a current into the summing junction of $I=V_{\text {in }} / R$ ), or a current input $I_{\text {in }}$ (in which case you omit the input resistor $R$ ). The ideal integrator produces an output

$$
V_{\text {out }}(t)=-\frac{1}{C} \int I_{\text {in }}(t) d t=-\frac{1}{R C} \int V_{\text {in }}(t) d t
$$

It's easy enough to figure out the effect of the op-amp's input errors $I_{\mathrm{B}}$ and $V_{\mathrm{OS}}$. Let's first take the case of an integrator circuit with current input. ${ }^{30}$ The op-amp's bias current $I_{\mathrm{B}}$ adds (or subtracts) from the true input current $I_{\mathrm{in}}$; in the absence of any external input current the integrator's output would ramp at a rate $d V_{\text {out }} / d t=I_{\mathrm{B}} / C$. The effect of op-amp input offset voltage, on the other hand, is simply

[^201]to offset the output voltage by $V_{\mathrm{OS}}$, without ramping; ${ }^{31}$ so, when you reset the integrator by shorting the feedback capacitor $C$, the output goes to a voltage equal to $V_{\mathrm{OS}}$ rather than zero.

Let's look at some actual values. In Figure 4.65 we've chosen, rather arbitrarily, values of $0.1 \mu \mathrm{~F}$ for $C$ and (for voltage input) $1 \mathrm{M} \Omega$ for $R$. So a positive input current of $1 \mu \mathrm{~A}$ produces an output ramp of $-10 \mathrm{~V} / \mathrm{s}$. If we were to choose the precision bipolar OP27E, its relatively high input current of $\pm 40 \mathrm{nA}$ (max) would cause an output ramp of as much as $d V_{\text {out }} / d t=I_{B} / C= \pm 0.4 \mathrm{~V} / \mathrm{s}$.

This isn't good, particularly if you want to integrate for a few seconds or more. So let's fix things by choosing an op-amp that excels in low bias current, for example the CMOS LMC6041A (the suffixes denote the particular grade; we've chosen the best in all cases). It has a specified maximum bias current of 4 pA over its temperature range (but an astounding 32 "typical" value of 2 fA , or $2 \times 10^{-15} \mathrm{~A}$ ). Now the worst-case output ramp, in the absence of any input signal current, is reduced to $d V_{\text {out }} / d t=I_{\mathrm{B}} / C= \pm 40 \mu \mathrm{~V} / \mathrm{s}$. The "typical" ramping rate is 2000 times smaller, if the specs can be believed; that's a mere $0.02 \mu \mathrm{~V} / \mathrm{s}$.

At this point, the lesson seems to be that the best opamp for any integrator is the one with the smallest bias current $I_{\mathrm{B}}$. But, alas, life is more complicated. In particular, if the integrator is wired for voltage input, with a series input resistor $R$, then the op-amp's offset voltage $V_{\mathrm{OS}}$ now produces a ramp when the input to the circuit is held at ground. Imagine the input is grounded ( $V_{\mathrm{in}}=0$ ), and think about it this way: the op-amp strives to align its inputs with a voltage $V_{\text {OS }}$ between them; that small voltage then produces a current $I=V_{\mathrm{OS}} / R$ through the input resistor. That current has to come through the feedback capacitor, that is, the output must ramp to produce the current needed to satisfy the op-amp's twisted belief that its inputs should differ by $V_{\mathrm{OS}}$. Another way to say it is that the current acts just like an input current of $I=-V_{\mathrm{OS}} / R$.

Now the choice of op-amp is not so clear! Look at Figure 4.65 again. The CMOS op-amp with its very low bias current has a pretty large offset voltage, $V_{\mathrm{OS}}=3 \mathrm{mV}$ (max). So in this circuit it can produce an equivalent input current of $3 \mathrm{nA}(3 \mathrm{mV}$ across $1 \mathrm{M} \Omega)$; that's nearly a thousand times

[^202]larger than the worst-case contribution of its bias current, and it's getting into the same ballpark as the input current of the OP27E bipolar op-amp we considered first.

If minimum drift is needed with these particular circuit values, the solution is to choose an op-amp with the best compromise of low bias current and low offset voltage; to be precise, it should have the minimum value of the total worst-case error current $I_{\mathrm{E}}=I_{\mathrm{B}}+V_{\mathrm{OS}} / R$. A good choice would be the bipolar OP97E, a precision (low-offset) opamp with internal bias-cancellation circuitry. It sports maximum values of $I_{\mathrm{B}}=0.1 \mathrm{nA}$ and $V_{\mathrm{OS}}=25 \mu \mathrm{~V}$; the corresponding worst-case current error is $I_{\mathrm{E}}=0.125 \mathrm{nA}$, which is 25 times better than that of the LMC6041A and 320 times better than that of the OP27.

Note that the relative contribution of $V_{\mathrm{OS}}$ and $I_{\mathrm{B}}$ to integrator error is scaled by the value of $R$. So you can simply choose a larger resistor value if you have an op-amp with excellent $I_{\mathrm{B}}$ but only modest $V_{\mathrm{OS}}$.

If the residual drift of an integrator circuit is still too large for a given application, or if long-term accuracy is unimportant, one solution is to put a large resistor $R_{2}$ across $C$ to provide dc feedback for stable biasing, as shown in Figure 4.18D. The effect is to roll off the integrator action at very low frequencies, $f<1 / R_{2} C$. The feedback resistor may become rather large in this sort of application. Figure 4.66 shows a trick for producing the effect of a large feedback resistor using smaller values in any op-amp circuit. In this case - an inverting amplifier circuit - the feedback network behaves like a single $10 \mathrm{M} \Omega$ resistor, thus producing a voltage gain of -100 . This technique has the advantage of using resistors of convenient values without the problems of stray capacitance, etc., that occur with very large resistor values. Note that this "T-network" trick may increase the effective input offset voltage if used in a transresistance configuration (§4.3.1C). For example, the circuit of Figure 4.66, driven from a high-impedance source (e.g., the current from a photodiode, with the input resistor omitted), has an output offset of 100 times $V_{\text {OS }}$, whereas the same circuit with a $10 \mathrm{M} \Omega$ feedback resistor has an output equal to $V_{\mathrm{OS}}$ (assuming the offset that is due to input current is negligible).

### 4.5.6 A circuit cure for FET leakage

Sometimes a circuit technique is so elegant and fascinating that we feel compelled to tell others about it. That's the case for the circuit in this section, brought over and updated from our 2nd edition. Read it and delight in its cleverness; but then check our remarks in the concluding paragraph.

In the integrator with a FET reset switch (Figure 4.18),
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0292.jpg?height=366&width=530&top_left_y=220&top_left_x=1184)

Figure 4.66. "T-network" simulates large-value resistor (here $10 \mathrm{M} \Omega$ ).
drain-source leakage sources a small current into the summing junction even when the FET is OFF. With an ultra-low-input-current op-amp and low-leakage capacitor, this can be the dominant error in the integrator. For example, the excellent LMC6001A JFET-input "electrometer" op-amp has a maximum input current of 0.025 pA , and a high-quality $0.1 \mu \mathrm{~F}$ metallized Teflon or polystyrene capacitor specifies leakage resistance as $10^{7}$ megohms, minimum. Thus the integrator, exclusive of reset circuit, keeps stray currents at the summing junction below 1 pA (for a worst-case 10 V full-scale output), corresponding to an output $d V / d t$ of less than $0.01 \mathrm{mV} / \mathrm{s}$. Compare this with the leakage contribution of a MOSFET such as the SD210 (enhancement mode), which specifies a maximum leakage current of 10 nA at $V_{\mathrm{DS}}=10 \mathrm{~V}$ and $V_{\mathrm{GS}}=-5 \mathrm{~V}$ ! In other words, the reset FET can contribute up to 10,000 times as much leakage as everything else combined.

Figure 4.67 shows a clever circuit solution. Although both $n$-channel MOSFETs are switched together, $Q_{1}$ is switched with gate voltages of 0 and +15 volts so that gate leakage (as well as drain-source leakage) is entirely eliminated during the OFF state (zero gate voltage). In the ON state the capacitor is discharged as before, but with twice $R_{\mathrm{ON}}$. In the OFF state, $Q_{2}$ 's small leakage passes to ground through $R_{2}$ with negligible drop. There is no leakage current at the summing junction because $Q_{1}$ 's source, drain, and substrate are all at the same voltage. (Sharpeyed readers may have noticed that the virtual ground at the op-amp's inverting input is imperfect to the extent of its offset voltage $V_{\mathrm{OS}} .{ }^{33}$ This can be trimmed to eliminate completely any leakage current from $Q_{1}$.)

The ultimate limit to capacitor "droop" in this circuit, once FET switch leakage has been eliminated, is set by the op-amp's input current and by the capacitor's selfdischarge. The capacitor shown has a specified ${ }^{34}$ leakage

[^203]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0293.jpg?height=526&width=615&top_left_y=209&top_left_x=218)

Figure 4.67. MOSFET leakage defeated by clever circuit.
resistance of $10^{7} \mathrm{M} \Omega$, i.e., $10^{13} \Omega$. The resulting leakage currents, of order $10^{-16} \mathrm{~A}$ (following reset), are entirely negligible compared with op-amp bias currents. For the opamp shown, the specified bias current is 25 fA maximum (10 fA typ) at $25^{\circ} \mathrm{C}$; that bias current produces a maximum droop of $0.25 \mu \mathrm{~V} / \mathrm{s}$. There are no op-amps with lower specified maximum bias current currently available; but you can find op-amps whose "typical" bias current is lower for example, the LMC6041, an inexpensive op-amp whose datasheet proclaims $I_{\mathrm{B}}=2 \mathrm{fA}$ (typ) at $25^{\circ} \mathrm{C}$ (no maximum is given at room temperature; $I_{\mathrm{B}}=4 \mathrm{pA}$ max over the full temperature range). What is one to make of an op-amp whose typical input current is 2000 times smaller than the guaranteed maximum? Just that the manufacturer knows that it's very good, but it's too painful to test in production. You'd do well to use these inexpensive units in such a circuit if you're willing to screen the op-amps yourself; otherwise pay the bounty for a unit that has a guaranteed limit (but note that the LMC6001A, such a unit, has a typi$\mathrm{cal} I_{\mathrm{B}}$ that is five times higher than that of the less expensive LMC6041).

When designing circuits where low input current is needed, watch out for temperature effects: all FET opamps (both JFET and CMOS types) exhibit dramatic increases in input current with rising temperature, typically doubling each $10^{\circ} \mathrm{C}$; the LMC6001A's guaranteed maximum bias current jumps from 25 fA at $25^{\circ} \mathrm{C}$ to 2000 fA at $85^{\circ} \mathrm{C}$. At high temperatures, the input (leakage) currents

[^204]of FET op-amps may often be higher than the input (bias) currents of low- $I_{\mathrm{B}}$ bipolar types; that is because leakage currents rise exponentially with temperature, whereas transistor bias currents remain roughly constant (or decrease slightly). Look back at Figure 3.48 for a good illustration; see also Figures 5.6 and 5.38.

It may be difficult to find discrete low-capacitance MOSFETs with substrate pins; currently the SD210 family (with SST-prefix SMT versions) is available from Linear Systems (Fremont, CA). The two-switch T-configuration is sound, though it may be challenging to find suitable switch components without substrate-diode conduction, etc. These MOSFETs work well, but if they become "unobtanium" we suggest you modify the circuit to use JFETs, in the manner of Figure 5.5.

### 4.5.7 Differentiators

Differentiators are similar to integrators, but with $R$ and $C$ reversed (Figure 4.68). Because the inverting input is at ground, the rate of change of input voltage produces a current $I=C\left(d V_{\text {in }} / d t\right)$ and hence an output voltage

$$
\begin{equation*}
V_{\mathrm{out}}=-R C \frac{d V_{\mathrm{in}}}{d t} \tag{4.7}
\end{equation*}
$$

Differentiators are bias stable, but they generally have problems with noise and instabilities at high frequencies because of the op-amp's high gain and internal phase shifts. For this reason it is necessary to roll off the differentiator action at some maximum frequency. The usual method is shown in Figure 4.69. The choice of the rolloff components $R_{1}$ and $C_{2}$ depends on the noise level of the signal and the bandwidth of the op-amp, with larger values providing greater stability and less noise, at the expense of differentiator bandwidth. A minimum recommended value for $R_{1}$ is given by $R_{1}=0.5 \sqrt{R_{2} / C_{1} f_{\mathrm{T}}} ; C_{2}$ can be added for further noise reduction, with a starting value of $C_{2} \approx C_{1} R_{1} / R_{2}$. At high frequencies $\left(f \gg 1 / 2 \pi R_{1} C_{1}\right)$ this circuit becomes an integrator because of $R_{1}$ and $C_{2}$. We'll explain what's going on here in more detail in §4.9.3.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0293.jpg?height=215&width=320&top_left_y=2015&top_left_x=1215)

Figure 4.68. Op-amp differentiator (noisy, probably unstable!).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0294.jpg?height=302&width=568&top_left_y=221&top_left_x=346)

Figure 4.69. Adding $R_{1}$ and $C_{2}$ stabilizes the basic op-amp differentiator (consisting of $C_{1}, R_{2}$, and the op-amp); they also reduce high-frequency noise.

## 4.6 Op-amp operation with a single power supply

Op-amps don't require $\pm 15$ volt regulated supplies. They can be operated from split supplies of lower voltages ${ }^{35}$ or from unsymmetrical supply voltages (e.g, +12 and -3 ), as long as the total supply voltage $\left(V_{+}-V_{-}\right)$is within specifications (see Table 4.1 on page 245 for generic values, and Tables 4.2a,b on pages 271-272 for specific parts). Unregulated supply voltages are often adequate because of the high "power-supply rejection ratio" you get from negative feedback (for the 411 it's 90 dB typ). But there are many occasions when it would be nice to operate an op-amp from a single supply, say +9 volts. This can be done with ordinary op-amps by generating a "reference" voltage above ground, if you are careful about minimum supply voltages, output-swing limitations, and maximum common-mode input range.

In many cases, however, you can simplify these circuits by taking advantage of a class of op-amps designed for single supply operation. With characteristic directness, engineers call these "single-supply op-amps." Their common feature is that both their input common-mode range and their output swing extends to the negative supply rail (i.e., ground, when run from a single positive supply). A subclass of these can swing their outputs to both supplies ("rail-to-rail outputs"), and some of those even permit input swings to both rails ("rail-to-rail I/O"). Keep in mind, though, that operation with symmetrical split supplies should be considered the normal op-amp technique for most applications.

[^205]
### 4.6.1 Biasing single-supply ac amplifiers

For a general-purpose op-amp like the 411, the inputs and output can typically swing to within about 1.5 volts of either supply. With $V_{-}$connected to ground, you can't have either of the inputs or the output at ground; that is, it won't work properly if you drive the inputs to ground, and it simply cannot swing its output to ground.

Thus one reason why the circuit in Figure 4.70 won't work is that the ac-coupled low-level signal from the microphone is centered on ground, where the op-amp will not work. But even if the op-amp's input common-mode range included the negative rail (ground, here), we'd still be in trouble, because in this circuit the amplified output would also be centered on ground (so that it would have to swing both above and below ground). It is important to understand that this problem with the output cannot be solved in this manner - an op-amp simply cannot swing beyond its supply rails. Even an op-amp with rail-to-rail inputs and outputs would not work.

Exercise 4.19. Draw a sketch of the output waveform from the circuit of Figure 4.70, when driven with a 10 mV input sinewave, assuming that the op-amp is of the special class with rail-to-rail inputs and outputs.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0294.jpg?height=345&width=552&top_left_y=1241&top_left_x=1221)

Figure 4.70. Defective single-supply microphone amplifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0294.jpg?height=498&width=631&top_left_y=1705&top_left_x=1159)

Figure 4.71. A reference voltage at $\frac{1}{2} V_{+}$(created by divider $R_{1} R_{2}$ ) allows single-supply operation with an ordinary op-amp.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0295.jpg?height=751&width=1208&top_left_y=204&top_left_x=345)

Figure 4.72. Biasing schemes for single-supply operation A. Common reference (also known, confusingly, as a "virtual ground") for multiple stages; note bypass capacitor. B. Follower generates low-impedance reference. C. The reference can serve as the return path for feedback, with significant signal currents. D. Zener-type fixed voltage reference.

#### A. Reference voltage

One solution is to generate a reference voltage somewhere between ground and the positive supply (e.g. at half of $V_{+}$) to bias the op-amp for successful operation (Figure 4.71). This circuit is an audio amplifier with 40 dB gain. Choosing $V_{+}=12 \mathrm{~V}$ and $V_{\text {ref }}=0.5 \mathrm{~V}_{+}$gives an output swing of about 9 volts pp before the onset of clipping. Capacitive coupling is used at the input and output to block the dc level, which equals $V_{\text {ref }}$. The optional resistors should be used if this circuit connects to the outside world; they ensure that there is no dc voltage at the input and output, which prevents loud clicks and pops when external stuff is connected.

The reference voltage can be generated at the op-amp input with a simple resistive divider, as shown. If the circuit requires several op-amp stages, it is simpler to generate a common reference, with a single bias resistor to each stage, as in Figure 4.72A. Be sure to bypass the reference, to prevent signal coupling. You can also buffer the reference with a follower (Figure 4.72B), which is particularly useful if any significant dc or signal currents flow through that path, as in Figure 4.72C. Note that the follower can be any ordinary op-amp, because it is operating with a midsupply signal. In this circuit the reference voltage doesn't have to be half of the supply voltage; it may be best to split the supply unsymmetrically, to allow maximum signal swing. In some instances it may be preferable to put it at a fixed voltage from one rail, using an IC zener-like fixed
reference, as in Figure 4.72D; that rail is then a regulated supply with respect to the common reference.

Contemporary circuit design is moving to lower supply voltages, often in the form of a single positive supply. For operation with a single +5 V supply, for example, a conventional op-amp like the 411 simply will not do: Not only can its outputs not swing typically closer than 1.5 V to the supply rails; in fact, it is not even specified for operation from a total supply voltage of less than 10 V . So for such circuits you should use op-amps designed for low-voltage operation. These are often called "single-supply" op-amps and come in several forms, some of which include specified operation of both inputs and outputs down to the negative rail; others feature output swings to both rails, of which a subset permits both inputs and outputs to go to both rails. We'll deal with these shortly, in §4.6.3.

#### B. Supply splitter

The circuit in Figure 4.72C suggests a different approach to operation with a battery. Instead of piping a line called $V_{\text {ref }}$ around as a signal common, with the negative battery terminal called ground, why not ground the "reference" output, effectively splitting the single supply into a positivenegative pair? This is a common technique in battery operated equipment, and is shown in Figure 4.73. The battery voltage is split by the resistive divider, which feeds a follower to generate a low-impedance common voltage. To
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0296.jpg?height=348&width=626&top_left_y=201&top_left_x=325)

Figure 4.73. Op-amp split-supply generator. A follower generates a low-impedance mid-battery output voltage, which becomes circuit ground.
the outside world that common voltage is "ground," with both ends of the battery floating.

The output should be bypassed, as always, to maintain low-impedance supply rails, relative to ground, at signal frequencies. That is necessary because ground is usually the common return for filters, biasing networks, loads, etc. Look at almost any normal split-supply circuit and you'll find dc and signal currents flowing into and out of ground.

This raises an interesting problem, which we discuss in detail in Chapter $4 x$ and in 89.1 .1 C , namely that the op-amp's output resistance, in combination with the bypass capacitor, creates a lagging phase shift at high frequencies that can cause the feedback loop to go into oscillation. Some op-amps are designed to circumvent this problem, for example the LT1097 shown in the figure (whose datasheet states that it is stable with any capacitive load). Even so, this circuit exhibits a peak in its output impedance versus frequency (Figure 4.74), and a related effect, namely, a ringing transient with that same characteristic frequency (Figure 4.75); you can think of these effects as the not-quite-banished ghost of an oscillation. As the figures show, a small series damping resistor at the opamp's output (Figure 4.76A) effectively stops this resonant behavior, at the expense of an increase in dc output impedance.

If increased output impedance is undesirable (which often it is not), another approach is to take "slow" feedback downstream of the damping resistor (which preserves accurate dc performance, i.e., low dc output impedance), with a parallel "fast" feedback path from the upstream side (Figure 4.76B) to prevent ringing. You can see the result in Figure 4.75 , where we used $R_{1}=2.7 \Omega, R_{2}=10 \mathrm{k}$, and $C=2.7 \mathrm{nF}$ : the initial transient looks just like that with a $2.7 \Omega$ damping resistor, but then returns to the correct dc level because dc feedback is taken from the point of load. A third possibility is to "overcompensate" the op-amp, for which the LT1097 provides hospitality in the form of a convenient "overcomp" pin; adding a capacitor to ground from this
pin increases the phase margin by shifting the dominant pole downward in frequency (§4.9).

There's a nice integrated solution from Texas Instruments, the TLE2425 and TLE2426 "rail-splitter" ICs. These come in a convenient 3-terminal TO-92 (small transistor) package, draw less than 0.2 mA quiescent current, are stable into any capacitive load greater than $0.33 \mu \mathrm{~F}$, and can source or sink an unbalanced current of 20 mA (Figure 4.77). The TLE2426 splits the rails $50 \%$ with an internal resistive divider, whereas the TLE2425 uses an internal voltage reference to put the output common 2.50 V above the negative rail.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0296.jpg?height=468&width=721&top_left_y=817&top_left_x=1109)

Figure 4.74. One effect of the capacitive load is a bump in the output impedance, which is greatly reduced with a $5 \Omega$ damping resistor; see text.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0296.jpg?height=527&width=777&top_left_y=1517&top_left_x=1081)

Figure 4.75. Measured output voltage transient of the rail-splitter circuit of Figure 4.76 A caused by a 4.5 mA load current step, with several values of series damping resistor. The latter eliminates ringing, at the expense of dc output impedance. An alternative is the "split-feedback" scheme of Figure 4.76B. Scales: $5 \mathrm{~mA} / \mathrm{div}$ and $10 \mathrm{mV} / \mathrm{div}$; $40 \mu \mathrm{~s} / \mathrm{div}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0297.jpg?height=555&width=632&top_left_y=207&top_left_x=184)

Figure 4.76. Stabilizing the split-supply generator: A. Decoupling resistor, B. Decoupling resistor with fast and slow feedback paths.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0297.jpg?height=309&width=815&top_left_y=922&top_left_x=118)

Figure 4.77. Integrated 3-terminal rail splitter.

### 4.6.2 Capacitive loads

This particular example of a supply-splitter illuminates a more general problem, namely, the effect of capacitive loading at the output of any op-amp circuit. Although we'll deal with this further in the advanced Chapter $4 x$, it's important to appreciate now the causes, and cures, because it can cause mischief in even the simplest of op-amp circuits.

Let's say you build a little box, with some op-amps inside and the output(s) brought out through the ever-popular BNC panel connectors. It's easy to forget that something like a length of shielded cable - say a 2 m BNC cable going from an output connector to some other instrument has plenty of capacitance: the standard RG-58 shielded cable patch cords have 100 pF per meter (see Appendix H). So an innocuous connecting cable alone loads the op-amp's output with 200 pF . That's sometimes enough to make an op-amp follower oscillate (we rig up just such a demonstration in our circuit design class, where an LF411 follower screams loudly when asked to drive 8 ft of cable). And even if it doesn't break into oscillation, it will likely exhibit response peaks at high frequencies, evident as overshoot and ringing.

The causes are the same as with the supply splitter: the capacitive load creates a lagging phase shift, and it's within the feedback loop. ${ }^{36}$

And the possible cures are the same (Figure 4.78); taking the figure's circuits in order (A-E):

- You can add a small series resistor (perhaps $25-100 \Omega$ ) at the op-amp's output, outside the feedback loop. (It's quite common to see a $50 \Omega$ output resistor, which forms a matched source to " $50 \Omega$ cable"; see Appendix H.) This is OK , and easy; but it does mean that feedback does not act on the actual output signal, which may be significant with nasty loads, or at high frequencies, etc.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0297.jpg?height=1245&width=552&top_left_y=755&top_left_x=1099)

Figure 4.78. Driving capacitive loads.

[^206]- You can split the feedback loop, as shown, so that feedback comes directly from the op-amp's output at high frequencies, where instability lurks. And at lower frequencies the feedback accurately controls the signal seen by the load. This is not really a compromise, because those high frequencies are exactly where the thing would oscillate anyway if you were to allow feedback from the load.
- You can reduce the loop gain, for example by increasing the closed-loop gain, to regain stability.
- You can seek an op-amp that guarantees stability into the range of load capacitances you expect. Many op-amps provide good data in the form of plots of "Stability versus Capacitive Load." Figure 4.79 shows an example, taken from the datasheet for the LMC6482.
- You can add a unity-gain buffer, with its low native output impedance, either within or outside the feedback loop. If you add it inside the loop, you need to worry about phase shifts introduced by the buffer; it should have significantly higher $f_{\mathrm{T}}$ than the op-amp, and it's often a good idea to include a $50-100 \Omega$ series resistor at the buffer's input (not shown). You may need to rolloff the op-amp's response with a small capacitor, as in Figure 4.87 on page 274.


### 4.6.3 "Single-supply" op-amps

As we just remarked, some op-amps are designed specifically to allow inputs and outputs to go to the negative rail. These are called "single-supply" (or "ground-sensing") opamps, the idea being that their negative rail is actually tied to ground. The input range actually extends slightly below ground, typically to -0.3 V . In some cases the outputs can swing also to the positive rail ("rail-to-rail output"), and a subset of these permits input swings to (and slightly be-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0298.jpg?height=483&width=718&top_left_y=1713&top_left_x=258)

Figure 4.79. Stability versus capacitive load for a LMC6482 opamp follower with $R_{\text {load }}=2 \mathrm{k}$ and $\pm 7.5 \mathrm{~V}$ supplies.
yond) both rails ("rail-to-rail input"). Linear Technology has introduced an exotic new twist - op-amps that permit input swings well beyond the positive rail (they call them "Over-The-Top ${ }^{\mathrm{TM}}$ " amplifiers).

These amplifiers can simplify single-supply circuits because you don't need a midsupply reference, rail splitter, etc. But you have to remember that the output cannot go below ground - so you can't build an audio amplifier like Figure 4.70, whose output would need to swing both sides of ground. Before looking at the characteristics of these op-amps in more detail, let's look at a design example.

#### A. Example: single-supply photometer

Figure 4.80 shows a typical example of a circuit for which single-supply operation is convenient. We discussed a similar circuit earlier under the heading of current-to-voltage converters (and we will go further in Chapter $4 x$ ). Because a photocell circuit might well be used in a portable lightmeasuring instrument, and because the output is known to be positive only, this is a good candidate for a batteryoperated single-supply circuit. $R_{1}$ sets the full-scale output at 5 volts for an input photocurrent of $0.5 \mu \mathrm{~A}$. The small feedback capacitor is added to ensure stability, as we'll explain in §4.9.3. No offset voltage trim is needed in this circuit, since the worst-case untrimmed offset of 10 mV corresponds to a negligible $0.2 \%$ of full-scale meter indication. The TLC27L1 is an inexpensive micropower ( $10 \mu \mathrm{~A}$ supply current) CMOS op-amp with input and output swings to the negative rail. Its low input current ( 0.6 pA , typ, at room temperature ${ }^{37}$ ) makes it good for low-current applications like this. If you choose a bipolar op-amp for this kind of low signal-current circuit, better performance at
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0298.jpg?height=427&width=680&top_left_y=1577&top_left_x=1137)

Figure 4.80. Single-supply photometer.

[^207]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0299.jpg?height=350&width=422&top_left_y=218&top_left_x=325)

Figure 4.81. Photodiode amplifier with simple bias current cancellation.
low light levels results if the photodiode is connected as in the circuit shown in Figure 4.81.

It's worth noting that the "current budget" of this circuit is dominated by the output current that drives the meter, which can go as high as $500 \mu \mathrm{~A}$. It's easy to overlook a point like that, blithely assuming that the battery need provide only the op-amp's $10 \mu \mathrm{~A}$ quiescent current. At $10 \mu \mathrm{~A}$ a standard 9 V battery lasts 40,000 hours ( 5 years), whereas with continuous operation at $500 \mu \mathrm{~A}$ it would last a month.

#### B. Single-supply op-amp innards

It's helpful to look at the circuitry of a typical single-supply op-amp, both to understand how these types achieve operation to one or both rails, and also to appreciate some of the subtleties and pitfalls of designing them into your circuits. Figure 4.82 is a simplified schematic of the very popular TLC270 series of CMOS single-supply op-amps. The input stage is a $p$-channel MOSFET differential amplifier with current-mirror active load. The use of enhancementmode $p$-channel input transistors lets the inputs go to the negative rail (and a bit beyond, until the omnipresent input protection diodes begin to conduct), but prevents input operation to the positive rail (because there would be no forward gate-source voltage).

Unlike the classic conventional op-amp with its pushpull follower output stage (Figure 4.43), this output stage is unsymmetrical: an $n$-channel follower $Q_{6}$ for the pullup and another $n$-channel common-source amplifier $Q_{7}$ for the pull-down. That's done because a follower at $Q_{7}$ (which would have to be p-channel) could not pull all the way down, given that its lowest gate drive voltage is ground. This unsymmetrical output requires the common-source driver $Q_{5}$ for $Q_{6}$ 's gate, with matching threshold voltages for $Q_{5}$ and $Q_{7}$ to set the output-stage quiescent current. The feedback capacitor $C_{\text {comp }}$ is for frequency compensation (see §4.9.2). This output stage can saturate at ground, with an impedance of $Q_{7}$ 's $R_{\mathrm{ON}}$; but it can't reach $V_{+}$, because $Q_{6}$ is an $n$-channel MOSFET follower.

Exercise 4.20. What sets the source voltage of $Q_{1}$ and $Q_{2}$ when the inputs are approximately at ground? And what determines the high end of the input range? Why is the latter always below $V_{+}$?

Exercise 4.21. What sets the maximum positive voltage to which $Q_{6}$ can pull the output, assuming the op-amp is lightly loaded?

This same output-stage structure - follower pullup with amplifier pull-down - can be built with bipolar transistors; an example is the popular LT1013/LT1014 singlesupply dual-quad op-amps, improved variants of the classic LM358/LM324 op-amps. A note of caution: don't make the mistake of assuming that you can make any op-amp's output work down to the negative rail simply by providing an external current sink. In most cases the circuitry driving the output stage does not permit that. Look for explicit permission in the datasheet!

One way to achieve rail-to-rail outputs - i.e., operation to both supply rails - is to replace the $n$-channel follower pullup $Q_{6}$ in Figure 4.82 with a $p$-channel common-source amplifier; then each transistor can saturate to its respective rail. This requires some driver circuitry changes, of course. An analogous circuit can be built with bipolar transistors common emitter pnp pullup and npn pull-down. Contemporary examples include the CMOS TLC2270, LMC6000, and MAX406 series, and the bipolar LM6132, LT1881, and MAX4120 series. As we'll see in Chapter $4 x$, there are other ways to make single-supply and rail-to-rail outputs. These amplifiers differ in important ways, and you must watch out for misleading statements about output swing to the negative rail (ground).

These output stages are pretty straightforward, and not surprising. But they don't generalize to the input stage. How, indeed, can you possibly achieve rail-to-rail input capability? To complete the picture without going into any
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0299.jpg?height=534&width=809&top_left_y=1664&top_left_x=968)

Figure 4.82. Simplified schematic of the TLC271-series singlesupply op-amp.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0300.jpg?height=575&width=1165&top_left_y=218&top_left_x=466)

Figure 4.83. Precision voltage-controlled waveform generator.
detail, the trick is to design an amplifier with two independent input stages, one $p$-channel (or $p n p$ ) and the other $n$-channel (or npn). We talk about them, and some other nifty tricks (such as putting on-chip voltage generators to create bias supplies beyond the rails, in combination with a conventional op-amp like Figure 4.43), in Chapter $4 x$. Single-supply op-amps are indispensable in batteryoperated equipment.

### 4.6.4 Example: voltage-controlled oscillator

Figure 4.83 shows a clever circuit, borrowed from the application notes of several manufacturers. $\mathrm{IC}_{1}$ is an integrator, rigged up so that the capacitor current ( $V_{\text {in }} / 15 \mathrm{k}$ ) changes sign, but not magnitude, when $Q_{1}$ conducts. $\mathrm{IC}_{2}$ is connected as a Schmitt trigger, with thresholds at one-third and two-thirds of $V_{\text {ref }}$. The $n$-channel MOSFET $Q_{1}$ is here used as a switch, pulling the bottom side of $R_{4}$ to ground when $\mathrm{IC}_{2}$ 's output is HIGH and leaving it open-circuited when the output is LOW.

A nice feature of this circuit is its operation from a single positive supply. The TLV3501 is a CMOS comparator with rail-to-rail output swing, which means that the output of the Schmitt goes all the way from $V_{\text {ref }}$ to ground; this ensures that the thresholds of the Schmitt don't drift, as they would with an op-amp of conventional output-stage design, with its ill-defined limits of output swing. In this case the result is stable frequency and amplitude of the triangle wave. Note that the frequency depends on only the ratio $V_{\text {in }} / V_{\text {ref }}$; this means that if $V_{\text {in }}$ is generated from $V_{\text {ref }}$ by a resistive divider (made from some sort of resistive transducer, say), the output frequency won't vary with $V_{\text {ref }}$, only with changes in resistance. This is another example
of ratiometric techniques; circuit designers like to use this trick to minimize dependence on power-supply voltages.

Some additional points.

- Both the frequency conversion coefficient and the output swing amplitude are set by the reference voltage that powers $\mathrm{IC}_{2}\left(V_{\text {ref }}\right)$, in this case a precise and stable +5.00 V provided by the 3 -terminal voltage reference $\mathrm{IC}_{3}$. This voltage could be left unregulated if the control voltage is arranged to be proportional to it, as described above. The output amplitude would, however, still be dependent on that supply rail. The solution just shown is preferable.
- The integrator op-amp, $\mathrm{IC}_{1}$, is a "precision" op-amp, with a maximum offset voltage of $60 \mu \mathrm{~V}$. It was chosen to provide accurately proportional frequency down near zero volts input. You can think of this instead in terms of dynamic range of the frequency control: input offset voltage in the integrator op-amp produces an error in frequency equivalent to a value of $V_{\text {in }}$ of twice that offset voltage (because of the divider $R_{2} R_{3}$ ); to say it another way, at an input voltage $V_{\text {in }} \approx 2 V_{\mathrm{OS}}$, the output frequency will be in error by $100 \%$ (it could be as large as twice the programmed frequency and as low as zero). So the ratio of maximum to minimum frequency is roughly equal to $V_{\mathrm{ref}} / V_{\mathrm{OS}}$. The LT1077C shown in the figure provides a dynamic range of nearly 100,000:1 (the ratio $V_{\text {ref }} / V_{\text {OS }}=5 \mathrm{~V} / 60 \mu \mathrm{~V}$ ).
- The integrator op-amp must operate down to zero volts input; i.e., it must be a "single-supply" (or "groundsensing") op-amp, of which the LT1077C is an example.
- Input current $I_{\mathrm{B}}$ of the integrator op-amp also causes an error, most serious when the control voltage $V_{\text {in }}$ is near zero volts. The LT1077C has well-matched inputs with $I_{\mathrm{B}}(\max )=11 \mathrm{nA}$, which causes a worst-case error
equivalent to about $30 \mu \mathrm{~V}$ of unbalance when it flows through the network of unequal input resistors. This is smaller than the error contribution that is due to worstcase $V_{\mathrm{OS}}$; the combination results in a worst-case equivalent error of $90 \mu \mathrm{~V}$, or a dynamic range (untrimmed) of 50,000:1. The fact that offset voltage effects dominate over bias current effects is no accident: that is why the resistor values $R_{1}-R_{4}$ were chosen as small as they are (and the capacitor value $C_{1}$ was then chosen to produce the desired frequency range).
- The LT1077C could be trimmed to extend the dynamic range; ultimately it is drift in $V_{\mathrm{OS}}$ and $I_{\mathrm{B}}$ (over time and temperature) that set the circuit's overall stability near zero frequency.
- The TLV3501 is an unusually fast ( 4.5 ns ) comparator with rail-to-rail output swing. However, its supply voltage is limited to +5.5 V maximum. If you wanted to run that portion of the circuit at a higher voltage, you could substitute a fast rail-to-rail op-amp like the CA3130. The latter part has been around a long time and is nearing extinction; ${ }^{38}$ but it excels in speed for a low-power op-amp because it is uncompensated (see $\S 4.9 .2 \mathrm{~B}$ ). It would not be suitable for the input op-amp, however, because it is not stable as an integrator, for reasons we will see shortly. It also has large input offset voltage.
- Another possibility is to replace the Schmitt trigger circuit with a CMOS 555-type timer IC, for example, an ICL7555. These have stable input thresholds at one-third and two-thirds of the supply rail, and rail-to-rail fast output swing.
- Switch alternatives: IC switches like the SD210 or 74HC4066 (the latter belongs to the 74HC family of digital logic) could replace the discrete MOSFET $Q_{1}$; their lower capacitance would improve operation at high frequencies.
- Another possibility, if power consumption matters more than maximum frequency or dynamic range, is to use low-power CMOS rail-to-rail op-amps for both ICs, for example, a TLC2252 dual op-amp ( $35 \mu \mathrm{~A}$ per channel). In this case scale up the resistor values, particularly in the input stage, because CMOS op-amps have negligible input current for this application.
- If the use of a dual op-amp in a single package seems particularly appealing, then a good overall choice is the bipolar LM6132, with rail-to-rail inputs and outputs and a slew rate of $14 \mathrm{~V} / \mu \mathrm{s}$; in the same family you can get faster op-amps (LM6142, LM6152), at the cost of higher input and supply currents.

[^208]- An elegant single-IC solution is the use of a combination op-amp-comparator-reference IC like the MAX951. We looked around for a way to use such a chip here, but, alas, we couldn't squeeze the excellent performance of Figure 4.83 out of any of the combination chips currently available, nor from special-purpose timers like the LTC699x-series (§7.1.4B). This illustrates the circuit performance advantage you get if you can combine the best available ICs for the given task, rather than having to accept a pre-assembled combination.

Exercise 4.22. Derive the expression for output frequency shown in Figure 4.83. Along the way, verify that the Schmitt thresholds and integrator currents are as advertised.

### 4.6.5 VCO implementation: through-hole versus surface-mount

Traditionally, electronic components were made with wire leads sticking out the ends (e.g., "axial-lead" resistors and capacitors), or rows of pins sticking down (e.g., ICs with DIP - "dual in-line" - packaging). Contemporary practice has shifted strongly toward "surface-mount" components, in which the connections are made directly to contacts on a ceramic or plastic package. See, for example, the photographs of resistors in Chapter 1 (Figure 1.2), of op-amps earlier in this chapter (Figure 4.1), or of small logic (Figure 10.23) in Chapter 10.

The good news is that surface-mount technology (SMT) lets you make smaller gadgets; and it is better electrically as well, because of reduced inductances in the smaller packages.

The bad news is that SMT makes it difficult to wire up a circuit on the spur of the moment on a prototype "breadboard" (of either the solder-in or plug-in style), an exercise that is fast and easy with through-hole components. The problem is compounded by the fact that many new highperformance components (e.g., op-amps) are available only in surface-mount packages.

In a nutshell, your choices boil down to (a) sticking with through-hole components (if you can get the parts you need) and enjoying the easy prototyping and ability to build a one-off gadget quickly; (b) going with the flow, and using mostly SMT components, laying out a printed circuit board for each circuit you want to build; or (c) trying to retain the best of both worlds by prototyping with through-hole components, where available, and using SMT adapters (or "carriers") for the SMT components that you cannot get in through-hole packages. The latter are tiny circuit boards on which you solder an SMT component, whose leads connect
to a row of pins, producing a faux through-hole component. We've struggled with this whole business and have concluded that this last option, though attractive in principle, is fast fading away, because of the decreasing availability of through-hole components.

To give a glimpse of the tradeoffs, we laid out the voltage-controlled oscillator (VCO) circuit of Figure 4.83 on printed-circuit boards, exploring the alternatives of (a) through-hole components, (b) relatively large SMT components, and (c) small SMT components. Figure 4.84 shows them at actual size; we've shown only the component outlines and "pads" (metal foil patterns that make the connections to the components). For the through-hole board we used standard DIP op-amp and comparator and axial-lead $1 / 4$-watt resistors; for the large SMT we used SOIC-8 opamp and comparator and 0805 SMT resistors; and for the small SMT we used SOT-23 op-amp and comparator and the smaller 0603 resistors. ${ }^{39}$ The latter is 4.5 times smaller than the through-hole board. And there is no penalty in performance; in fact, smaller components generally deliver somewhat better performance owing to smaller parasitic inductances.

### 4.6.6 Zero-crossing detector

This example illustrates the use of a single-supply comparator, a close kin to the single-supply op-amp. Like the latter, it will operate with input signals all the way to the lower supply rail, which often is ground. The circuit, shown in Figure 4.85, generates an output square wave for use with 5 V "TTL" logic ( 0 to +5 V range) from an input wave of any amplitude up to 150 volts rms. The LM393 is a comparator IC (like the TLV3501 we used in the last example), specialized for this sort of application; it cannot be used as an amplifier, in the manner of an op-amp, because its internal phase shifts are not tailored ("compensated," see §4.9) to permit feedback without oscillation. It also has an "open-collector" output, which you must pull up externally to a supply rail, as shown. Its internal circuit is shown in Figure 4.86; note the overall similarity to an op-amp (Figure 4.43), with the important omission of the compensation capacitor $C_{\mathrm{C}}$, and the lack of a "pullup" transistor at the output. We treat comparators in more detail in §12.3.

[^209]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0302.jpg?height=675&width=552&top_left_y=220&top_left_x=1196)

Figure 4.84. Printed-circuit layouts for the VCO of Figure 4.83. The use of small surface-mount components reduces the board area to $22 \%$ of the analogous board using through-hole components. Additional benefits are a greater selection of available parts, and better electrical performance.

Resistor $R_{1}$, combined with $D_{1}$ and $D_{2}$, limits the input swing to -0.6 volt to +5.6 volts, approximately; its power rating is set by the maximum rms input voltage. Resistive divider $R_{2} R_{3}$ is necessary to limit negative swing to less than 0.3 volt, the limit for a 393 comparator. $R_{5}$ and $R_{6}$ provide hysteresis for this Schmitt trigger circuit, with $R_{4}$ setting the trigger points symmetrically about ground. The input impedance is nearly constant because of the large $R_{1}$ value relative to the other resistors in the input attenuator. A 393 is used because its inputs can go all the way to ground, making single-supply operation simple.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0302.jpg?height=529&width=802&top_left_y=1730&top_left_x=1068)

Figure 4.85. Zero-crossing level detector with input protection.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0303.jpg?height=534&width=799&top_left_y=218&top_left_x=116)

Figure 4.86. Schematic of the LM393 single-supply comparator.

Exercise 4.23. Verify that the trigger points are at $\pm 100 \mathrm{mV}$ at the input signal.

Some additional points.

- The vintage LM393 severely limits the allowable swing below ground, because the output will switch polarity if the input goes below -0.3 V , a pathology tactfully called phase reversal in the datasheet. That is prevented here by diode $D_{1}$ and divider $R_{2} R_{3}$; alternatively the low side of $D_{1}$ could be biased a diode drop above ground, as in Figure 5.81. Resistor $R_{3}$ could be omitted if a modern comparator like the LT1671 were used; the latter also has internal active pullup to +5 V , so you would omit pull-up resistor $R_{7}$ as well.
- We intentionally set the Schmitt thresholds symmetrically around ground, but that may not be the best choice. For example, you might want output transitions accurately synchronized with the exact zero crossings of the input waveform. Omitting $R_{4}$ would set the negativegoing input threshold exactly at 0 V ; alternatively, you could set the positive-going threshold to 0 V with a properly-chosen value for $R_{4}$ (test your understanding with Exercise 4.24).
- By using capacitive feedback only (omitting $R_{5}$ ), you can have both thresholds at 0 V with some of the benefits of hysteresis. In this case, the hysteresis is transient, with a time constant $\tau=C_{1} R_{6}$, by which time you are assuming the input waveform will have left the threshold region. So, for example, if you were using this circuit to sense zero crossings of a 60 Hz sinewave, you might choose $C_{1}=0.1 \mu \mathrm{~F}$ for a 0.5 ms time constant (but see next item). The drawback is that you're making assumptions about the input's minimum slew rate and maximum zero-crossing frequency. You could imagine a more elaborate scheme, with additional comparators, such that the input threshold is restored to 0 V after the input wave-
form passes a second higher threshold. This design challenge would yield a precise zero-crossing circuit (for both waveform slopes) with no restrictions on input speed, etc.
- Be careful if you decide to increase the value of the speed-up capacitor $C_{1}$ - this capacitor causes a negativegoing transient at the inverting input of the comparator, and if the capacitor is much larger than a few picofarads you may cause phase reversal at the comparator's output (a pathology of many comparators, including the LM393). In that case it's best to use a modern comparator whose datasheet specifically brags that it is free of phase reversal; an example is the MAX989.

Exercise 4.24. What value of $R_{4}$ in Figure 4.85 puts the positivegoing input threshold at 0 V ?

Exercise 4.25. Try designing a hysteretic circuit, with several comparators, such that both thresholds are precisely at 0 V , under the assumption that the input waveform always travels a minimum of 50 mV beyond ground before coming back.

### 4.6.7 An op-amp table

We've collected in Table 4.2a on the facing page a representative selection of useful op-amps, including many of our favorites. You can get an idea of the price and performance of parts that are in wide use. Better yet, use this table as a starting point in your next design! More comprehensive op-amp tables are located in the chapter on precision design (Table 5.4, High-speed op-amps; Table 5.5, Precision op-amps; Table 5.6, Auto-zero op-amps), and in the chapter on noise (Table 8.3, Low-noise op-amps).

## 4.7 Other amplifiers and op-amp types

In this first op-amp chapter we've met the "standard" splitsupply op-amp, implemented variously with bipolar transistors, JFETs and MOSFETs. We've also seen examples of single-supply op-amps, some with rail-to-rail outputs (and even rail-to-rail inputs).

There are other choices, some of which we'll look at in Chapters $4 x$ and 5. It's worth listing them here, because one or more of them may be the best solution to a design problem that looks initially like it needs an op-amp.

#### Current-feedback op-amps

These look a lot like ordinary ("voltage-feedback") opamps, but differ by having a low-impedance inverting input terminal that is a current summing junction. They excel in wideband circuits with moderate to high voltage gain; see the discussion in Chapter $4 x$.
Table 4.2a Representative Operational Amplifiers (see also Tables 5.2-5.6 and 8.3)

| Part \# ${ }^{\text {a }}$ | Package |  |  | Total Supply |  | $I_{Q}$ <br> typb <br> (mA) | $\begin{gathered} f_{\mathrm{T}} \\ \text { typ } \\ (\mathrm{MHz}) \end{gathered}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0304.jpg?height=94&width=111&top_left_y=1211&top_left_x=364) | $V_{\text {os }}$ max $(\mu \mathrm{V})$ | $I_{\text {bias }}$ typ (nA) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0304.jpg?height=104&width=107&top_left_y=916&top_left_x=366) | Swing to supplies?$\frac{\mathrm{IN}}{+-} \frac{\mathrm{OUT}}{+-}$ | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | \#/pkg | 응 | qty 25 <br> (\$US) | min <br> (V) | max <br> (V) |  |  |  |  |  |  |  |  |
| LM358, 324 | 2,4 | $\cdot$ $\cdot$ - | 0.16 | 3 | 32 | 1 | 1 | 0.5 | 7000 | 45 | 40 | - $\cdot$ - $\cdot$ | single-supply jellybean |
| LT1013, 1014 | 2,4 | $\cdot$ $\cdot$ - | 1.30 | 4 | 44 | 0.7 | 0.8 | 0.4 | 40 | 12 | 22 | - $\cdot$ - $\cdot$ | precision single-supply |
| LT1077A | 1 | $\cdot$ $\cdot$ - | 4.11 | 2.2 | 44 | 0.05 | 0.23 | 0.08 | 40 | 7 | 27 | - $\cdot$ - $\cdot$ | low-power bipolar, also OP193 |
| LMC6482A, 84A | 2,4 | $\cdot$ $\cdot$ - | 1.73 | 3 | 16 | 1.3 | 1.5 | 1.3 | 750 | 20fA | 37 | $\cdot$ | CMOS jellybean, LMC7101 SOT-23 |
| TLC2272A, 74 | 2,4 | $\cdot$ $\cdot$ - | 1.57 | 4 | 16 | 2.2 | 2.2 | 3.6 | 950 | 0.001 | 9 | - $\cdot$ $\cdot$ $\cdot$ | CMOS |
| LMC6442A | 2 | $\cdot$ $\cdot$ - | 2.00 | 2.2 | 16 | 0.002 | 0.01 | 0.004 | 3000 | 5fA | 170 | $\cdot$ | micro-power! |
| LMC6041, 42, 44 | 1,2,4 | $\cdot$ $\cdot$ - | 1.48 | 4.5 | 16 | 0.02 | 0.08 | 0.015 | 3000 | 2fA | 83 | - $\cdot$ $\cdot$ $\cdot$ |  |
| LMC6081A, 82, 84 | 1,2,4 | $\cdot$ - - | 2.72 | 4 | 16 | 0.45 | 1.3 | 1.5 | 350 | 10fA | 22 | - $\cdot$ $\cdot$ $\cdot$ | for low power, LMC6061 has $I_{\mathrm{Q}}=20 \mu \mathrm{~A}$ |
| TLV2401, 02 | 1,2 | - $\cdot$ $\cdot$ | 1.42 | 2.5 | 16 | 0.0009 | 0.005 | 0.002 | 1200 | 0.1 | 500 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ | pico-power, operates to $V_{\mathrm{Cc}}+5 \mathrm{~V}$ |
| LMC7101A | 1 | - - $\cdot$ | 0.93 | 2.7 | 16 | 0.5 | 1 | 1 | 3000 | 0.001 | 37 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ | similar to LMC6482 |
| LF411, 412C | 1,2 | $\cdot$ $\cdot$ - | 0.72 | 7 | 36 | 4.5 | 3 | 13 | 2000 | 0.05 | 18 | - - - - | JFET, TI, dual cheaper than single |
| LF347B | 4 | $\cdot$ $\cdot$ - | 0.58 | 7 | 36 | 8 | 3 | 13 | 5000 | 0.05 | 18 | $\cdot$ - - - | low cost JFET, 15¢ per op-amp |
| LT1057A, 1058 | 2,4 | $\cdot$ $\cdot$ - | 6.30 | 7 | 40 | 3.4 | 5 | 24 | 450 | 0.05 | 13 | - - - - | improved LF412, also see AD712 |
| OPA727, 2727 | 1,2 | - $\cdot$ - | 2.58 | 4 | 13 | 4.3 | 20 | 30 | 150 | 0.085 | 6 | - $\cdot$ $\cdot$ $\cdot$ | e-trim CMOS |
| OPA376, 2376 | 1,2 | - $\cdot$ $\cdot$ | 2.03 | 2.2 | 7 | 0.76 | 5.5 | 2 | 25 | 0.2pA | 7.5 | - $\cdot$ $\cdot$ $\cdot$ | e-trim CMOS |
| TLC272C, 274C | 2,4 | $\cdot$ $\cdot$ - | 0.69 | 3 | 16 | 1.4 | 2.2 | 5.3 | 10 mV | 0.1pA | 27 | - $\cdot$ - $\cdot$ | consider TLV27x family |
| OPA129B | 1 | $\cdot$ $\cdot$ - | 10.15 | 10 | 36 | 1.2 | 1 | 2.5 | 2000 | 30fA | 17 | - - - - | electrometer, mass spec, pH probe |
| LT1012A | 1 | $\cdot$ $\cdot$ - | 5.11 | 2.4 | 40 | 0.37 | 0.4 | 0.2 | 25 | 0.025 | 14 | - - - - | low $I_{B}$ bipolar |
| LTC1050C | 1 | $\cdot$ - - | 4.30 | 6 | 18 | 1.1 | 2.5 | 4 | 5 | 0.01 | $1.6 \mu \mathrm{~V}^{\mathrm{C}}$ | - $\cdot$ $\cdot$ | chopper |
| LT1637 | 1 | $\cdot$ - - | 2.32 | 2.7 | 44 | 0.19 | 1 | 0.35 | 350 | 20 | 27 | + $\cdot$ $\cdot$ | "over-the-top": $V_{\text {in }}$ to $V_{\text {EE }}+44 \mathrm{~V}$ |
| LT1097 | 1 | $\cdot$ $\cdot$ - | 2.33 | 2.6 | 40 | 0.35 | 0.7 | 0.2 | 50 | 0.04 | 14 | - - - - | CLOAD stable, comp pin |
| OPA177 | 1 | $\cdot$ $\cdot$ - | 2.30 | 6 | 44 | 1.5 | 0.6 | 0.3 | 60 | 0.5 | 7 | - - - - | improved OP-07 |
| OPA277, 2277, 4227 | 1,2,4 | $\cdot$ $\cdot$ - | 3.60 | 4 | 36 | 0.8 | 1 | 0.8 | 20 | 0.5 | 8 | - - - - | improved OP-07, see also OPA227 |
| LM6132A, 34 | 2,4 | $\cdot$ - - | 2.92 | 2.7 | 35 | 0.8 | 11 | 14 | 2000 | 110 | 27 | $\cdot$ | early RRIO |
| AD797A | 1 | $\cdot$ - - | 8.36 | 10 | 36 | 8.2 | 80 | 20 | 80 | 250 | 0.9 | - - - - | low distortion, low noise |
| ADA4000-1, 2, 4 | 1,2,4 | - $\cdot$ $\cdot$ | 1.46 | 8 | 36 | 1.3 | 5 | 20 | 1700 | 0.005 | 16 | $\cdot$ - - - | JFET |
| LT6220, 21, 22 | 1,2,4 | - $\cdot$ | 2.61 | 2.5 | 12.6 | 0.9 | 60 | 20 | 200 | $15^{\text {h }}$ | 10 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ |  |
| OPA627A | 1 | $\cdot$ - - | 24.50 | 9 | 36 | 7 | 16 | 55 | 250 | 0.002 | 5.6 | - - - - | low-noise JFET |
| OPA657 | 1 | - $\cdot$ $\cdot$ | 12.90 | 8 | 13 | 14 | 1600 | 700 | 1800 | 0.002 | 4.8 | - - - - | fast JFET |
| OPA454 | 1 | - $\cdot$ - | 4.88 | 10 | 120 | 3.2 | 2.5 | 13 | 4000 | 0.002 | 35 | - $\cdot$ - - | high voltage, also OPA445 miniDIP |
| THS4011, 12 | 1,2 | $\cdot$ $\cdot$ - | 5.60 | 9 | 33 | 7.8 | 290 | 310 | 6000 | 2000 | 7.5 | - - - - | fast VFB ${ }^{\text {; }}$; THS4021/22 decomp, G>10 |
| LM7171A | 1 | - $\cdot$ - | 3.60 | 8 | 36 | 6.5 | 200 | 4100 | 4000 | 2700 | 14 | - - | CFB $^{\text {e }}, 100 \mathrm{~mA}$ output current |
| EL5165 | 1 | - $\cdot$ $\cdot$ | 2.32 | 5 | 12.6 | 5 | 1400 | 6000 | 5000 | 8500 | 1.7 | - | CFB ${ }^{\text {e }}$ |
| AD8011 | 1 | $\cdot$ $\cdot$ - | 3.98 | 3 | 12.6 | 1 | $570^{\text {d }}$ | 3500 | 5000 | 5000 | 2 | - - - | low-power two-stage CFB |
| Notes: (a) Italicized part numbers have corresponding number of op-amps per package. (b) quiescent current per package, for the boldface part number (that with the least number of op-amps; e.g.,1mA for the LM358). (c) peak-to-peak noise voltage. (d) GBW for $\mathrm{GV}=10$. (e) $\mathrm{VFB}=\mathrm{voltage}$ feedback, $\mathrm{CFB}=\mathrm{current}$ feedback. (h) rises to 250nA at the negative rail. |  |  |  |  |  |  |  |  |  |  |  |  |  |

Table 4.2b Monolithic Power and High-Voltage Op-Amps ${ }^{a}$

| Type | Mfg | Total supply |  |  |  |  | $\begin{gathered} f_{\mathrm{T}} \\ \text { typ } \\ (\mathrm{MHz}) \end{gathered}$ | Slew rate typ (V/ / s ) | Iout(max) typ (A) | $P_{\text {diss }}$ <br> ( $50^{\circ} \mathrm{C}$ ) <br> max <br> (W) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0305.jpg?height=197&width=65&top_left_y=247&top_left_x=1255) |  | Package | Cost qty 25 (\$US) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0305.jpg?height=158&width=48&top_left_y=286&top_left_x=1697) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  | Diff'l input $^{b}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0305.jpg?height=65&width=50&top_left_y=306&top_left_x=769) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0305.jpg?height=79&width=60&top_left_y=291&top_left_x=1309) |  |  |  |  |  |  |  |  |
|  |  | $\begin{gathered} \hline \min ^{\prime} \\ \text { (V) } \end{gathered}$ | max <br> (V) |  | typ <br> (mA) |  |  |  |  |  |  | 岀 華 |  |  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0305.jpg?height=70&width=60&top_left_y=369&top_left_x=1309) |
| Iow power |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LME49726 | TI | 2.5 | 6 | 0.7 | full | $\cdot$ - | 6.8 | 3.7 | 0.35 | $1^{\text {u }}$ | - | - - | MSOP | 1.29 | A |
| OPA567 | TI | 2.7 | 7.5 | 3.4 | full | - - | 1.2 | 1.2 | 2.2 | $12.5^{\text {n }}$ | $\cdot$ | $\cdot$ $\cdot$ | QFN | 5.53 | B |
| OPA569 | TI | 2.7 | 7.5 | 3.4 | full | $\cdot$ - | 1.2 | 1.2 | 2.2 | $25^{n}$ | $\cdot$ |  | SO-20 | 7.41 | B,C |
| AD8010 | Analog | 10 | 12.6 | 16 | 1.2 | - - | 230 | 800 | 0.2 | $1.3^{\text {u }}$ | - - | - - | SO-16 | 6.69 | D |
| LM6171 | TI | 5 | 36 | 2.5 | 10 | - - | 100 | 3000 | 0.12 | 0.7 | - - | - - | DIP, SO | 4.27 | E |
| LTC2057HV | LTC | 4.8 | 65 | 0.8 | full | - - | 1.5 | 0.45 | 0.02 | low | - | - - | SO-8 | 3.32 | F |
| ADA4700 | Analog | 10 | 100 | 1.7 | full | - - | 3.5 | 20 | 0.03 | 2.5 | $\cdot$ - | - - | SO-8 | 6.00 |  |
| OPA445 | TI | 20 | 100 | 4.2 | 80 | - - |  | 10 | 0.015 | 0.6 | - | - - | DIP, SO-8 | 10.07 | G |
| OPA454 | TI | 10 | 100 | 3.2 | fullg |  | 2.5 | 13 | 0.12 | $7.5^{n}$ | $\cdot$ - | - $\cdot$ | SO-8 | 6.09 |  |
| LTC6090 | LTC | 9.5 | 140 | 2.8 | full | - - | 12 | 21 | 0.05 | $15^{n}$ | $\cdot$ - | - $\cdot$ | SO,TTSOP | 4.87 | H |
| medium power |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| L2720W | ST | 4 | 28 | 10 | full | - - | 1.2 | 2 | 1 | 5 | $\cdot$ - | - - | SO-16 | 1.02 | I |
| ISL1532A | Intersil | 10 | 30 | $3.5^{\circ}$ | full | - - | 50 | 400 | 1 | 1 | - | - $\cdot$ | SSOP-20 | $1.43^{r}$ | J |
| THS3120 | TI | 9 | 33 | 7 | 4 | - - | 130 | 900 | 0.47 | $15^{n}$ | - - | - $\cdot$ | MSOP-8 | 5.57 | K |
| LT1794 | LTC | 10 | 36 | 26 | full | - - | 200 | 600 | 0.72 | $25^{n}$ | $\cdot$ - | - $\cdot$ | SO-20 | 8.09 | J |
| LT1206 | LTC | 10 | 36 | $12^{\circ}$ | full | - $\cdot$ | 60 | 900 | 0.5 | $15^{\text {p }}$ | - | - $\cdot$ | DIP,TO-220 | 5.88 | K,L |
| LT1210 | LTC | 8 | 36 | 35 | full | $\cdot$ | 35 | 900 | 2 | $15^{p}$ | - | - $\cdot$ | TO-220-7 | 8.75 | K,M |
| L272 | FSC | 4 | 40 | 8 | full | - - | 0.35 | 1 | 1 | 5 | $\cdot$ - | - - | DIP, SO-16 | 2.08 | N |
| PA75 | Apex | 5 | 40 | 8 | full | - - | 1.4 | 1.4 | 2.5 | 19 | - | - - | TO-220-7 | 28.88 | O |
| TDA7256 | ST | 10 | 50 | 80 | full | - - | 9 | 10 | 3 | 35 | $\cdot$ | - $\cdot$ | TO-220-11 | 3.42 | P |
| LM1875 | TI | 16 | 60 | 70 | full | - - | 5.5 | 8 | 4 | 25 | - | - - | TO-220-5 | 2.75 | P |
| OPA552 | TI | 8 | 60 | 7 | full | $\cdot$ | 12 | $24{ }^{\text {d }}$ | 0.2 | $25^{p}$ | $\cdot$ | - - | DIP, DDPak | 5.70 | Q |
| LM675 | TI | 20 | 60 | 18 | full | - - | 5.5 | 8 | 3 | 40 | - | - - | TO-220-5 | 4.82 | R |
| OPA547 | TI | 8 | 60 | 10 | full | - - | 1 | 6 | 0.5 | 25 | $\cdot$ | - $\cdot$ | TO-220-7 | 9.57 | S |
| OPA548 | TI | 8 | 60 | 17 | full | - - | 1 | 10 | 3 | 30 | - | - $\cdot$ | TO-220-11 | 13.22 | S |
| OPA549 | TI | 8 | 60 | 26 | full | - - | 0.9 | 9 | 8 | 53 | $\cdot$ | - $\cdot$ | TO-220-11 | 20.65 | S |
| OPA453 | TI | 20 | 80 | 4.5 | full |  | 7.5 | $23^{\text {d }}$ | 0.05 | 25 | $\cdot$ | - - | TO-220-7 | 5.50 | T |
| OPA541 | TI | 20 | 80 | 20 | full | - - | 2 | 10 | 10 | 90 | - | - - | TO-3, SIP-11 | 19.28 |  |
| LM3886 | TI | 18 | $84^{\text {s }}$ | 50 | 60 | - - | 8 | 19 | 11.5 | 75 | - | - $\cdot$ | TO-220-11 | 5.94 | P |
| TDA7293 | ST | 24 | 120 | 30 | 30 | - - | - | 15 | 6.5 | 75 | $\cdot$ - | - $\cdot$ | TO-220-15 | 5.49 | P |
| higher voltage |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| PA340 | Apex | 20 | 350 | 2.2 | 16 | $\cdot$ | 10 | $32^{k}$ | 0.06 | 16 | $\cdot$ | - - | DDPak-7 | 21.45 | U |
| PA90 | Apex | 30 | 400 | 10 | 20 | - $\cdot$ | 100 | $300^{\text {e }}$ | 0.2 | 18 | - | - - | SIP-12 +tab | $188.00^{v}$ | U |
| PA15 | Apex | 100 | 450 | 2.0 | 25 | $\cdot$ $\cdot$ | 5.8 | 20 | 0.2 | $18^{n}$ | - | - - | SIP-10 | $185.00^{v}$ | U |
| PA98 | Apex | 30 | 450 | 21 | 25 |  | 100 | $1000^{\text {e }}$ | 0.2 | 18 | - | - - | SIP-12 +tab | $272.00^{V}$ | U |
| PA97 | Apex | 100 | 900 | 0.6 | 20 |  | 1 | $8^{\text {e }}$ | 0.01 | $3^{n}$ | - | - - | SIP-12 | $176.00^{V}$ | V |

Notes: (a) within categories, sorted by maximum voltage, then output current; the Apex parts are hybrid, and neither PCB nor instrument-box types are listed. (b) not to exceed total supply voltage. (c) $P_{\text {diss }}$ with case at $T_{\mathrm{C}}=50 \mathrm{C}$, based on $R_{\theta \mathrm{JC}}$. (d) when comp for $G>10$. (e) when comp for $G>100$. ( g ) internal JFETs limit current to 4 mA . ( h ) see notes. ( k ) for $C_{C}=4.7 \mathrm{pF}, G \geq 10$. ( n ) provided you can get the heat out of the package! (o) adjustable. (p) power package. (r) qty 1k. (s) 94 V w/o signal. (u) to ambient. (v) unit qty; see distributor prices (and your banker) for larger qty.

Comments: (A) dual, RRO. (B) RRIO. (C) with current monitor. (D) video. (E) VFB with CFB. (F) auto-zero, $4 \mu \mathrm{~V}$. (G) has $V_{\text {os }}$ trim; also in TO-99. (H) dual='6091. (I) update of L272. (J) dual, ADSL driver. (K) current-feedback, CFB. (L) can drive 10nF capacitive loads. (M) 1.1A min.
(N) Fairchild's version. ( O ) amp+buffer. (P) audio amplifier. (Q) slower OPA551 for $G=1$. (R) classic workhorse. (S) current-limit adjustment with resistor or external current. (T) slower OPA452 for $G=1$. (U) MOSFET output. (V) "inexpensive."

#### "Zero-drift" op-amps

These unusual op-amps, which include auto-zero and chopper-stabilized amplifiers, are tailored for precision (low-VOS) applications. They use internal MOS switches to measure and correct for input offset error. These are the only amplifiers with values of
untrimmed $V_{\text {OS }}$ down to $5 \mu \mathrm{~V}$ or less. See Table 5.6 on page 335.

High-voltage, high-power op-amps
You can get op-amps with maximum output currents of 25 amps or more, or with power supply voltages to 1 kV or

#### "Here Yesterday, Gone Today"

In its untiring quest for better and fancier chips, the semiconductor industry can sometimes cause you great pain. It might go something like this: you've designed and prototyped a wonderful new gadget; debugging is complete, and you're ready to go into production. When you try to order the parts, you discover that a crucial IC has been discontinued by the manufacturer! An even worse nightmare goes like this: customers have been complaining about late delivery on some instrument that you've been manufacturing for many years. When you go to the assembly area to find out what's wrong, you discover that a whole production run of boards is built, except for one IC that "hasn't come in yet." You then ask purchasing why they haven't expedited the order; turns out they have, just haven't received it. Then you learn from the distributor that the part was discontinued six months ago and that none is available!

Why does this happen, and what do you do about it? We've generally found four reasons that ICs are discontinued.

1. Obsolescence: Much better parts come along, and it doesn't make much sense to keep making the old ones. This has been particularly true with digital memory chips (e.g., small static RAMs and EPROMs, which are superseded by denser and faster versions each year), though linear ICs have not entirely escaped the purge. In these cases there is often a pin-compatible improved version that you can plug into the old socket.
2. Not selling enough: Perfectly good ICs sometimes disappear. If you are persistent enough, you may get an explanation from the manufacturer - "there wasn't enough demand," or some such story. You might characterize this as a case of "discontinued for the convenience of the manufacturer." We've been particularly inconvenienced by Harris's discontinuation of their splendid

HA4925 - a fine chip, the fastest quad comparator, now gone, with no replacement anything like it. In our first edition we reported that Harris also discontinued the HA2705 - another great chip, the world's fastest lowpower op-amp, gone without a trace! Since that time, Maxim came out with the MAX402, similarly a fast low-power op-amp. Lots of us used it; then - whammo - can't get it! Sometimes a good chip is discontinued when the wafer fabrication line changes over to a larger wafer size (e.g., from the original $3^{\prime \prime}$ diameter wafer to a $5^{\prime \prime}$ or $6^{\prime \prime}$ wafer).
3. Lost schematics: You might not believe it, but sometimes the semiconductor house loses track of the schematic diagram of some chip and can't make any more! This apparently happened with the Solid State Systems SSS-4404 CMOS 8-stage divider chip.
4. "Upgraded" production line: Sometimes a manufacturer will replace older test equipment (which may have been working just fine) with the latest and greatest new stuff. Problem is, the programs to run the new testers aren't finished yet. So, the wafer line could be making lots of chips ... but there's no way to test them. This scenario appears to have played out in the case of the magnificent OPA627, one of our all-time favorites (there was nearly a year in which you couldn't get these puppies, but, thankfully, it's back in production).
5. Manufacturer out of business: This also happened to the SSS-4404! If you're stuck with a board and no available IC, you've got several choices. You can redesign the board (and perhaps the circuit) to use something that is available. This is probably best if you're going into production with a new design or if you are running a large production of an existing board. A cheap and dirty solution is to make a little "daughterboard" that plugs into the empty IC socket and includes whatever it takes to emulate the nonexistent chip. Although this latter solution isn't terribly elegant, it gets the job done.
more! These are specialized (and expensive) devices, extremely useful for applications such as piezo drivers, servo drivers, and so on. See Table 4.2 b on the facing page for some favorites.

#### Micropower op-amps

At the other end of the spectrum, you can get op-amps with quiescent currents as low as a microamp or less. These things aren't blazingly fast - the LMC6442, with
$I_{\mathrm{Q}}=10 \mu \mathrm{~A}$ per amplifier, has an $f_{\mathrm{T}}$ of 10 kilohertz, and a slew rate ${ }^{40}$ of $0.004 \mathrm{~V} / \mu \mathrm{s}$ - but they do let you run a portable instrument just about forever on a single battery.

#### Instrumentation amplifiers

These are integrated differential amplifiers with settable voltage gain. They contain several op-amps internally and

[^210]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0307.jpg?height=1146&width=1633&top_left_y=213&top_left_x=130)

Figure 4.87. Laboratory dc amplifier with output offset. Op-amp power supply connections and bypass capacitors are not shown explicitly, a common practice in circuit schematics.
excel in stability and common-mode rejection. Instrumentation amplifiers are discussed in §5.15.

Video and radiofrequency amplifiers
Specialized amplifiers for use with video signals, or with communications signals at frequencies from 10 MHz to 10 GHz , are widely available as fixed-gain amplifier modules. At these frequencies you generally don't use op-amps.

#### Dedicated amplifier variants

Microphone preamps, speaker amplifiers, stepping motor drivers, and the like are available as customized ICs with superior characteristics and ease of use.

## 4.8 Some typical op-amp circuits

### 4.8.1 General-purpose lab amplifier

Figure 4.87 shows a dc-coupled "decade amplifier" with settable gain, bandwidth, and wide-range dc output offset.
$\mathrm{IC}_{1}$ is a low-noise JFET-input op-amp with noninverting gain from unity $(0 \mathrm{~dB})$ to $\times 100(40 \mathrm{~dB})$ in accurately calibrated 10 dB steps; a vernier is provided for variable gain. $\mathrm{IC}_{2}$ is an inverting amplifier; it allows offsetting the output over a range of $\pm 10$ volts, accurately calibrated by the 10 turn pot $R_{16}$ by injecting current into the summing junction. $C_{3}-C_{5}$ set the high-frequency rolloff, because it is often a nuisance to have excessive bandwidth (and noise). $\mathrm{IC}_{5}$ is a power booster for driving low-impedance loads or cables; it can provide $\pm 150 \mathrm{~mA}$ output current.

Some interesting details: a $10 \mathrm{M} \Omega$ input resistor is small enough, since the bias current of the OPA627 is 10 pA (maximum, at room temperature), thus producing a 0.1 mV error with open input. $R_{2}$, in combination with clamp diodes $D_{1}$ and $D_{2}$, limits the input voltage at the op-amp to the range $V_{-}-0.6 \mathrm{~V}$ to $V_{+}+0.6 \mathrm{~V}$. With the protection components shown, the input can go to $\pm 150$ volts without damage. The JFET-input OPA627 was chosen for its combination of low input current ( $I_{\mathrm{B}}=1 \mathrm{pA}$, typ $)$, modest pre-
cision $\left(V_{\mathrm{OS}}=100 \mu \mathrm{~V}\right.$, max), low noise ( $e_{\mathrm{n}}=5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, typ), and wide bandwidth ( $f_{\mathrm{T}}=16 \mathrm{MHz}$, typ); the latter is needed to preserve some loop gain at the high-frequency end of the instrument $(100 \mathrm{kHz})$ when running at full gain $(40 \mathrm{~dB})$.

The output stage is an inverter with a unity-gain power buffer inside the feedback loop. The vintage LT1010 has plenty of slew rate, bandwidth, and muscle, with less than $10 \Omega$ open-loop output impedance (which of course is lowered by feedback; see $\S 2.5 .3 \mathrm{C}$ ). Both it and the OPA627 have enough slew rate ( $75 \mathrm{~V} / \mu$ s and $55 \mathrm{~V} / \mu \mathrm{s}$, respectively) to generate a full $\pm 15 \mathrm{~V}$ output swing at the full 100 kHz bandwidth of the instrument. A power buffer like this is good for isolating capacitive loads from the op-amp (more on this in Chapter $4 x$; see also $\S \S 4.6 .1 \mathrm{~B}$ and 4.6.2); furthermore, it takes the heat when driving a hefty load, which keeps $\mathrm{IC}_{2}$ cool, an important consideration with precision (low- $V_{\mathrm{OS}}$ ) op-amps. It takes lots of drive compared with an op-amp - up to 0.5 milliamp - but that's no problem when you're driving it with an op-amp.

The offset circuit consists of a precision LT1027 3terminal voltage reference IC. We'll learn more about these in Chapter 9 ; they generate a highly stable voltage output when powered from a noncritical dc rail that is at least 2 volts higher than their specified output voltage. This particular part comes in several grades, the best of which (LT1027A) has a maximum error of 1 mV , and is guaranteed to drift less than $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$; for this application we'd save some money by choosing the inexpensive " $D$ " grade $\left(5.0 \mathrm{~V} \pm 2.5 \mathrm{mV} ; 5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}\right)$. The OP177 is a highly stable precision op-amp ( $V_{\mathrm{OS}}<10 \mu \mathrm{~V}$, $\mathrm{TC} V_{\mathrm{OS}}<0.1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ in its best grade) that provides a stable offsetting voltage. Capacitor $C_{6}$ bypasses noise on the reference voltage, and $C_{7}$ and $C_{8}$ reduce amplifier noise by limiting the bandwidth of the amplifiers. For a dc application like this you don't need, and don't want, lots of bandwidth. We'll talk in detail about this sort of precision design in Chapter 5.

Some additional points.

- In a circuit like this the input protection network can limit the ultimate bandwidth, because $R_{2}$ forms a lowpass filter in combination with the combined input capacitance of $\mathrm{IC}_{1}$, diode capacitance, and associated wiring capacitance. In this case the total capacitance is approximately 12 pF , which puts the 3 dB point at 300 kHz , well above the 100 kHz high-frequency limit of the instrument. To use a similar protection circuit in a wideband amplifier, you could reduce the value of $R_{2}$, put a small capacitor ( 47 pF , say) across it, or both. You could also use clamp diodes with lower capacitance, for example a 1N3595 or a PAD5 (see Chapter $1 x$ ).
- A really useful general-purpose laboratory amplifier should have true differential inputs. This is best done with an instrumentation amplifier, rather than an op-amp; see §5.15. Here we've compromised with a "pseudodifferential" configuration, in which the input common terminal (which is the return path for feedback), floating from circuit ground with a $100 \Omega$ resistor, is allowed to accommodate a small amount of signal from the input source. A better arrangement, though still not symmetrically differential, is shown in Figure 4.88, where a difference amplifier $\left(\mathrm{IC}_{7}\right)$ uses the floating input common as a reference. Note the use of a chassis-isolated BNC panel connector.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0308.jpg?height=373&width=779&top_left_y=783&top_left_x=1080)

Figure 4.88. Difference amp cancels error from signal on input common.

- In many situations it is preferable to introduce the dc offset at the input rather than at the output. Then you can change gain, without adjusting the offset, to zoom in on a portion of the input signal. This requires a much larger range of offset voltage, and other circuit changes as well. We'll see an example in Chapter 5.
- Watch out for op-amps that exhibit phase reversal when their inputs go more than 0.3 V below $V_{-}$; in such cases a restrictive input clamp must be used to prevent negative swings below that limit. This is a common defect of many op-amps, which the excellent OPA627 does not share.
- Contemporary instrumentation usually provides for remote operation, with digital control from a computer. This circuit, however, uses mechanical controls for gain, bandwidth, and offset. You could replace the mechanical switches with analog switches, and use a DAC to generate the offset, to adapt this instrument to digital control.
- The rolloff capacitors $C_{3}-C_{5}$ close the loop around the output amplifier pair $\left(\mathrm{IC}_{2}+\mathrm{IC}_{5}\right)$ at high frequencies, which is beneficial in terms of reducing noise. But it also promotes instability, owing to the combined phase shifts of the two amplifiers. This arrangement is still OK, though, as long as the bandwidth of buffer $\mathrm{IC}_{5}$ is much greater than that of amplifier $\mathrm{IC}_{2}$.

But that is not the case here: the OPA627 op-amp has a unity gain bandwidth of $f_{\mathrm{T}}=16 \mathrm{MHz}$, at which it specifies a $75^{\circ}$ phase margin. But the LT1010 buffer adds about $50^{\circ}$ of additional lagging phase shift, pushing the amplifier close to instability (see $\S 4.9$ for an explanation of phase margin and stability). The solution here is to use a small feedback capacitor around the op-amp ( $\left.4.7 \mathrm{pF}, C_{2}\right)$, which closes the high-frequency feedback path directly. This rolls off its gain to unity at about 1 MHz , at which frequency the buffer contributes less than $5^{\circ}$ additional lagging phase shift.

Exercise 4.26. Check that the gain is as advertised. How does the variable-offset circuitry work? At what frequency would the slew-rate-limited output swing drop below $\pm 15 \mathrm{~V}$ ?

### 4.8.2 Stuck-node tracer

Here's a nice example of an op-amp circuit with nonlinear feedback. A tricky troubleshooting problem is a so-called stuck node, in which there is a short somewhere on a circuit board. It may be an actual short-circuit in the wiring itself, or it may be that the output of some device (for example a digital logic gate, see Chapter 10) is held in a fixed state. It's hard to find, because anywhere you look on that line, you measure zero volts to ground.

A technique that does work, however, is to use a sensitive voltmeter to measure voltage drops along the stuck trace. A typical signal trace on a printed-circuit board might be $0.010^{\prime \prime}$ wide and $0.0013^{\prime \prime}$ thick ( 1 ounce per square foot), which has a resistance along the trace of $53 \mathrm{~m} \Omega / \mathrm{in}$. So if there's a device holding the line to ground somewhere and you inject a diagnostic current of 10 mA dc somewhere else, there will be a voltage drop of $530 \mu \mathrm{~V}$ per inch in the direction of the stuck node.

Let's design a stuck-node tracer. It should be battery powered so that it can float anywhere on the powered circuit under test. It should be sensitive enough to indicate a drop of as little as $\pm 100 \mu \mathrm{~V}$ on its zero-center meter, with larger meter deflections for larger drops. Ideally it should have a nonlinear scale, so that even for voltage drops of tens of millivolts the meter will not go off scale. And with some care it should be possible to design a circuit that draws so little battery current that we can omit the on/off switch: 9 V batteries or AA-size cells give nearly their full shelf life of several years at continuous drain currents of less than $20 \mu \mathrm{~A}$ (they have capacities of about 500 mAh and 2500 mAh , respectively).

With a floating supply provided by batteries, the simplest circuit is a high gain inverting amplifier driving a
zero-center meter (Figure 4.89). Because the input and output are both intrinsically bipolarity, it's probably best to use a pair of AA cells, running the op-amp from $\pm 1.5$ volt unregulated supplies. The back-to-back Schottky diodes reduce the gain gracefully at large output swings and prevent pegging; Figure 4.90 plots the resulting meter deflection versus $V_{\text {in }}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0309.jpg?height=409&width=700&top_left_y=528&top_left_x=1017)

Figure 4.89. Stuck-node tracer: high-gain floating dc amplifier with nonlinear feedback.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0309.jpg?height=465&width=684&top_left_y=1089&top_left_x=1033)

Figure 4.90. Stuck-node tracer achieves large dynamic range through nonlinear feedback.

The major difficulty in this design is in achieving an input offset of less than $100 \mu \mathrm{~V}$ while maintaining micropower current drain, all with supply voltages of just $\pm 1.5$ volts. The OP193 is specified to operate down to 2 V total supply voltage, and its output stage swings to the negative rail and to within a volt of the positive rail. In its best grade (" $E$ " suffix) its offset voltage is $75 \mu \mathrm{~V}$, maximum. Its quiescent current of just $15 \mu \mathrm{~A}$ ensures that the batteries will last their full shelf life, since that current would provide continuous operation for over 150,000 hours from a 2500 mAh battery.

Some additional points.

- One subtle problem with this circuit is that an alkaline battery at the end of its life is down to about 1.0 V
terminal voltage; so you would have insufficient headroom to provide full-scale positive output voltage $(+0.5 \mathrm{~V})$, given the all-npn output stage. A solution is to use a higher battery voltage (e.g., 3 V lithium cells, or multiple alkaline 1.5 V AA cells). But operation from a single pair of AA cells is an elegance worth preserving. In this case you would do better to use an op-amp with true rail-to-rail output, for example, the CMOS OPA336. The latter has a quiescent current of $20 \mu \mathrm{~A}$, operates down to 2.3 V total supply voltage, and has an untrimmed offset voltage of $125 \mu \mathrm{~V}$. Its input voltage range goes to the negative rail and to within 1 volt of the positive rail; the latter is fine here, because we have chosen an inverting amplifier configuration with both inputs at 0 V .
- We rather artificially constrained the circuit design by choosing a zero-center analog meter and then insisting on using just a pair of AA alkaline cells. In real life you'd probably be happier with an audio output, with the pitch increasing with input voltage drop; then you could keep your eye on the circuit as you probe around. For this job you'd probably use a simple current-controlled oscillator, built with an op-amp relaxation oscillator or a 555-type timer IC (Chapter 7); for a noncritical application you don't need the linearity and stability of the VCO we designed in Figure 4.83.
- Don't forget the "rail-splitter" techniques we discussed in $\S 4.6 .1 \mathrm{~B}$; you can always use those tricks to create a split plus and minus rail, for example, from a single 9 V battery. With $\pm 4.5 \mathrm{~V}$ rails, you have a much wider range of op-amps to choose from. We were forced to choose from a rather small selection that run on 2 V total supply, draw only tens of microamps supply current, and have "precision" low input offset voltage. Once you have 5 V total supply available (a 9 V battery is down to 6 V at the end of its life), there are literally hundreds of available op-amps, dozens of which run on micropower current drain and have precision low offsets. See, for example, Table 5.5 on page 320.


### 4.8.3 Load-current-sensing circuit

Figure 4.91 shows a hefty ( 10 kW !) power supply driving a 100 amp load; the illustrated circuit provides a voltage output proportional to load current, for use with a current regulator, metering circuit, or whatever. The output current is sensed with a current shunt, a calibrated manganinmetal 4-terminal power resistor $R_{\mathrm{S}}$, of resistance $0.0005 \Omega$, whose "Kelvin connection" of four leads ensures that the sensed voltage does not depend on a low-resistance bond to the sensing terminals (as would be the case if you tried
to do the same thing with a conventional 2-terminal resistor). The voltage drop goes from 0 to 50 mV , with probable common-mode offset caused by the effects of resistance in the ground lead (note that the power supply is connected to chassis ground at the output). For that reason the op-amp is wired as a differential amplifier, with a gain of 200 . Voltage offset is trimmed externally with $R_{8}$, as the venerable LM358A doesn't have internal trimming circuitry. A zener reference with a few percent stability is adequate for trimming, because the trimming is itself a small correction (you hope!). The supply voltage, $V_{+}$, could be unregulated, since the power-supply rejection of the op-amp is more than adequate, 85 dB (typ) in this case.

Some additional points.

- Chassis ground and circuit ground would be connected together, somewhere. But there could easily be a volt or so separating circuit ground from the sensing point along the high-current negative return, because of the very large currents flowing. For that reason we connected the negative supply lead of the op-amp to the more negative end of the current-shunt output. This ensures that the commonmode voltage appearing at the op-amp input never goes below its negative rail; it is a "single-supply" op-amp, with operating common-mode range to its negative rail.
- Low offset voltage is important in this application; for example, to achieve $1 \%$ accuracy in a current measurement made at $10 \%$ of full-scale load current (i.e., a 10 A load, producing a sense voltage of 5 mV ) requires an offset voltage no greater than $50 \mu \mathrm{~V}$ ! We chose the vintage LM358A for our initial design, because it costs only 20 cents. But its poor untrimmed offset ( 3 mV , max) necessitates external manual trimming; and its lack of external trim terminals forced us to use lots of components. The need for manual trimming might not seem important if you're just building one of these for your lab; but in production it's an extra step, requiring a test setup and procedure, as well as additional parts inventory, etc.
- So, you might choose instead the LT1006, a single opamp that lets you trim externally with a single 10k pot. However, its improved performance ( $V_{\mathrm{OS}}=80 \mu \mathrm{~V}$, max, untrimmed) in the least expensive grade -40 times better than the LM358A - means that you hardly need to trim at all. Carrying this idea further, you could choose instead the LT1077A, a single-supply op-amp with $40 \mu \mathrm{~V}$ maximum untrimmed offset; it too can be trimmed externally.
- For the utmost in accuracy you should use a chopper-stabilized ("zero-drift") op-amp, for example the LTC1050C. It has $5 \mu \mathrm{~V}$ maximum offset voltage in the cheapest grade (combined with sub-nanoamp input
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0311.jpg?height=743&width=1162&top_left_y=215&top_left_x=368)

Figure 4.91. High-power current-sensing amplifier.
bias current, which doesn't matter here). This op-amp includes on-chip capacitors for its chopper, and operates from a single-supply (with input common-mode range to the negative rail), just like the LM358. Its $5 \mu \mathrm{~V}$ offset voltage corresponds to $1 \%$ accuracy at $1 \%$ of full scale; that's a dynamic range of $10,000: 1$, not bad for a simple circuit. See Table 5.6 on page 335 for auto-zero op-amp choices.

- Finally, an interesting design alternative is to do high-side current sensing. That is, the shunt is connected instead to the out+ power terminal. This has the advantage of keeping all the circuit grounds (power supply, and load) connected together. We'll see how to do this in the advanced Chapter $9 x$.


### 4.8.4 Integrating suntan monitor

We nerds don't ordinarily go to the beach. But when we do, we like to rely on some electronics to tell us when to turn over. What we want to monitor, of course, is the integrated dose of tan-producing (UV-rich) sunlight.

There are many ways to accomplish this; in fact, we'll revisit this task when we turn to mixed-signal (analog + digital) electronics (in Chapter 13), and again when we're looking for nifty things to do with microcontrollers (in Chapter 15). Here we want to show how an op-amp integrator can be used to build a suntan monitor circuit.

The idea is to integrate (accumulate) the photocurrent from a sensor whose output is proportional to the intensity
of tanning sunlight. We'll imagine that we have a photodiode, optically filtered to pass only the UV rays of interest, with an output short-circuit current of $\sim 1 \mathrm{nA}$ (nominal) in full sunlight; we'll assume that the photocurrent might range down to a tenth of this value, or so, in hazy sun.

#### A. First try: direct integration

The circuit in Figure 4.92 is a reasonable first try. It uses a single-supply CMOS micropower op-amp ( $10 \mu \mathrm{~A}$ per amplifier), powered from a 9 V battery, to integrate the (negative) photocurrent. A nanoamp produces a positive-going ramp of $0.5 \mathrm{mV} / \mathrm{s}$ at the op-amp's output, which we connect to a Schmitt trigger comparator with settable positive threshold. The LM385-2.5Z micropower two-terminal (zener-type) voltage reference then gives us a range of 0 to 1.5 hours ( $\sim 5000 \mathrm{~s}$ ) full sunlight equivalent (let's call it "FSE"), at which point the comparator output goes to ground, driving the piezo alarm. The latter draws 15 mA , a substantial battery load, but it is very loud, so even a dozing nerd will quickly enough shut the thing off (via the "reset" button). This circuit draws about $50 \mu \mathrm{~A}$ when integrating, good for about 8000 hours of operation (a 9 V battery has a capacity of 500 mAh at low drain). 8000 hours is about a year, so that's a lot of tanning; the battery will die of old age first.

Exercise 4.27. The LM385 requires a minimum of $10 \mu \mathrm{~A}$ of current for proper operation. What does the circuit provide, at the end of battery life ( 6 V )?
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0312.jpg?height=593&width=786&top_left_y=221&top_left_x=227)

Figure 4.92. Integrating suntan monitor, first try.

Exercise 4.28. How much hysteresis does Schmitt trigger $\mathrm{IC}_{2}$ provide? How will that affect the operation?

#### B. Second try: two-step conversion

One problem with the last circuit is that the unfiltered photodiode current is at least a few microamps, in direct sunlight. Trying to cut down the light by a factor of a thousand is risky, because you get light leaks, etc., that cause large errors.

The circuit in Figure 4.93 fixes that, by first converting the photocurrent (however large its magnitude) to a voltage, then integrating that in a second stage where we can choose an input resistor to generate a current in the nanoamp range. Now, however, we've got to use split supplies. That's because whichever polarity we choose for the transresistance (current to voltage) amplifier's output (by connecting the photodiode appropriately), the subsequent integrator's output will be the opposite polarity; integrators invert. In our circuit we used a 2.5 V reference to split the 9 V battery; most of the current in the circuit is between the positive and negative rails, so the reference needs less than $20 \mu \mathrm{~A}$ of bias. ${ }^{41}$ In this circuit we've shown a two-pole power switch, wired so the integrating capacitor is held reset until power is turned on.

The integrator output triggers a Schmitt comparator, as before, driving the mighty-lunged piezo screamer. Note that its large drive current is rail-to-rail; it does not pass through our ground reference. The circuit's operating cur-

[^211]rent is about $60 \mu \mathrm{~A}$, good for nearly a year of continuous operation.

A final note: the LMC6044 is a quad, rail-to-rail output, micropower op-amp ( $10 \mu \mathrm{~A} /$ amplifier). So if a stiff ground reference were needed, the unused op-amp section could be configured as in Figure 4.73, with the stabilizing trick of Figure 4.76A.

#### C. The "Mark-III" suntan integrator

It's always fun to see how elegantly you can shrink down circuit complexity. In this case there's a nice trick you can use to eliminate the two-stage integration, namely, a "current divider." Figure 4.94 shows how it's done: the photocurrent drives a pair of resistors, bridging the same voltage (because the inverting input is a virtual ground); the current divides proportional to the relative conductance, in this case in the ratio of $1000: 1$ if pot $R_{2}$ is turned to minimum resistance. That means that a photocurrent of $1 \mu \mathrm{~A}$ would inject a current of 1 nA into the integrator. If you prefer, you can think of the circuit as a resistive load ( $R_{1}$ in series with $R_{2}$, which easily dominates $R_{3}$ ), which develops a voltage $V_{\text {in }}=I_{\text {diode }}\left(R_{1}+R_{2}\right)$; that voltage is the input to the integrator, via $R_{3}$. Because the voltage developed by the photocurrent can range up to nearly a volt, it's necessary to back-bias the detector diode, in this case with a forward-biased diode $D_{2}$, which generates a -0.4 V rail.

The integrator's positive-going output ramp drives Schmitt comparator $\mathrm{A}_{2}$, with fixed comparison voltage provided by reference $D_{1}$. Its output drives the by-now usual piezo alarm.

Now for the elegance: it turns out you can get, packaged in a single small IC, a combination op-amp, comparator, and voltage reference. The MAX951 shown is just one of several such offerings, and it fills the bill here. It is because of the internal connection of $D_{1}$ and $\mathrm{IC}_{2}$ 's inverting input that we were forced to put the suntan control at the input, rather than at the comparator.

A few additional comments.

- The accuracy of the current divider depends on the accuracy of the virtual ground. The op-amp shown has a maximum offset voltage of 3 mV , so at $10 \%$ full sunlight and with the control set to minimum resistance (maximum bake cycle), the error is about $30 \%$ ( 10 mV signal, 3 mV offset). In other words, the circuit elegance involves a compromise in performance, relative to the more straightforward (some might say heavy-handed) approach in Figure 4.93, where the error is about $3 \%$ at minimum sunlight.
- Diode $D_{2}$ will be forward biased by the IC's quiescent
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0313.jpg?height=746&width=1578&top_left_y=209&top_left_x=160)

Figure 4.93. Integrating suntan monitor, second try; FSE is "full sunlight equivalent." A. Schematic. B. Spectral response of the Hamamatsu G5842 photodiode, whose short-circuit photocurrent in sunlight is about $1 \mu \mathrm{~A}$.
current of $7 \mu \mathrm{~A}$ as long as the photocurrent is less than this value. Thus the biasing resistor $R_{6}$ can be omitted unless a maximum photocurrent of more than about $5 \mu \mathrm{~A}$ is anticipated.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0313.jpg?height=496&width=831&top_left_y=1298&top_left_x=110)

Figure 4.94. Integrating suntan monitor, third try. $\mathrm{A}_{1}, \mathrm{~A}_{2}$, and $D_{1}$ all live inside a MAX951 multifunction chip. $A_{2}$ is a comparator.

- The MAX951 has a specified operating voltage range of 2.7 V to 7 V . The low-voltage operation is a pleasant bonus; but for this particular IC it also means that we cannot run directly from a 9 V battery, unless we use a voltage regulator (see Chapter 9) to reduce the supply voltage to 7 V or less. This illustrates an important lesson, namely, that you have to watch out for low maximum supply-voltage ratings when using ICs intended for low-voltage operation. It also illustrates the trend of IC
manufacturers toward lower supply voltages for their new product designs.


## 4.9 Feedback amplifier frequency compensation

We first met feedback in Chapter 2 (§2.5), where we saw its beneficial effects on stability and predictability of amplifier gain, and the reduction of an amplifier's inherent nonlinearities. We saw, also, how it affects input and output impedances of amplifiers: for example, by sensing output voltage, and using series feedback at the input, the input impedance is raised and the output impedance is lowered, both by a factor of the loop gain. All is not rosy, though: the combination of gain with feedback creates the possibility of oscillation. Here, in the context of op-amps, we continue the treatment of negative feedback, looking at the important subject of frequency compensation - the business of preventing oscillation in amplifiers with negative feedback. The material in $\S 2.5$ is a necessary background for the sections that follow.

Let's begin by looking at a graph of open-loop voltage gain versus frequency for several op-amps: you'll typically see something like the curves in Figure 4.95. From a superficial look at such a Bode plot (a log-log plot of openloop gain and phase versus frequency) you might conclude that the OP27 is an inferior op-amp, since its open-loop gain drops off so rapidly with increasing frequency. In fact, that rolloff is built into the op-amp intentionally and is
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0314.jpg?height=552&width=751&top_left_y=221&top_left_x=244)

Figure 4.95. Open-loop gain versus frequency for three similar opamps.
recognizable as the same $-6 \mathrm{~dB} /$ octave curve characteristic of an $R C$ lowpass filter. The OP37, by comparison, is identical to the OP27 except that it is decompensated (and similarly for the discontinued ${ }^{42}$ HA-5147). Op-amps are most often internally compensated, with decompensated and uncompensated varieties sometimes available. Let's take a look at this business of frequency compensation.

### 4.9.1 Gain and phase shift versus frequency

An op-amp (or, in general, any multistage amplifier) will begin to roll off at some frequency because of the lowpass filters formed by signals of finite source impedance driving capacitive loads within the amplifier stages. For instance, it is common to have an input stage consisting of a differential amplifier, perhaps with current-mirror load (see the LF411 schematic in Figure 4.43), driving a commonemitter second stage. For now, imagine that the capacitor labeled $C_{\mathrm{C}}$ in that circuit is removed. The high output impedance of the input stage $Q_{2}$, in combination with the combined capacitance seen at its output, forms a lowpass filter whose 3 dB point might fall somewhere in the range of 100 Hz to 10 kHz .

The decreasing reactance of this capacitance with increasing frequency gives rise to the characteristic $6 \mathrm{~dB} /$ octave rolloff: at sufficiently high frequencies (which may be below 1 kHz ), the capacitive loading dominates the collector load impedance, resulting in a voltage gain $G_{\mathrm{V}}=g_{m} X_{\mathrm{C}}$, i.e., the gain drops off as $1 / f$. It also produces a $90^{\circ}$ lagging phase shift at the output relative to the input signal. (You can think of this as the tail of an $R C$ low-

[^212]pass filter characteristic, where $R$ represents the equivalent source impedance driving the capacitive load. However, it is not necessary to have any actual resistors in the circuit.)

In a multistage amplifier there will be additional rolloffs at higher frequencies, caused by lowpass filter characteristics in the other amplifier stages, and the overall open-loop gain will look something like that shown in Figure 4.96. The open-loop gain begins dropping at $6 \mathrm{~dB} /$ octave at some low frequency $f_{1}$, because of capacitive loading of the firststage output. It continues dropping off with that slope until an internal $R C$ of another stage rears its ugly head at frequency $f_{2}$, beyond which the rolloff goes at $12 \mathrm{~dB} /$ octave, and so on.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0314.jpg?height=514&width=679&top_left_y=776&top_left_x=1130)

Figure 4.96. Multistage amplifier: gain versus frequency.
What is the significance of all this? Remember that an $R C$ lowpass filter has a phase shift that looks as shown in Figure 4.97. Each lowpass filter within the amplifier has a similar phase-shift characteristic, so the overall phase
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0314.jpg?height=633&width=615&top_left_y=1607&top_left_x=1167)

Figure 4.97. Bode plot: gain and phase versus frequency.
shift of the hypothetical amplifier will be as shown in Figure 4.98.

Now here's the problem: if you were to connect this amplifier as an op-amp follower, for instance, it would oscillate. That's because the open-loop phase shift reaches $180^{\circ}$ at some frequency at which the gain is still greater than 1 (negative feedback becomes positive feedback at that frequency). That's all you need to generate an oscillation, as any signal whatsoever at that frequency builds up each time around the feedback loop, just like a public address system with the gain turned up too far.

#### A. Stability criterion

The criterion for stability against oscillation for a feedback amplifier is that its open-loop phase shift must be less than $180^{\circ}$ at the frequency at which the loop gain is unity. This criterion is hardest to satisfy when the amplifier is connected as a follower, since the loop gain then equals the open-loop gain, the highest it can be. Internally compensated op-amps are designed to satisfy the stability criterion even when connected as followers; thus they are stable when connected for any closed-loop gain with a simple resistive feedback network. As we hinted earlier, this is accomplished by deliberately modifying an existing internal rolloff in order to put the 3 dB point at some low frequency, typically 1 Hz to 20 Hz . Let's see how that works.

### 4.9.2 Amplifier compensation methods

#### A. Dominant-pole compensation

The goal is to keep the open-loop phase shift much less than $180^{\circ}$ at all frequencies for which the loop gain is greater than 1. Assuming that the op-amp may be used as a follower, the words "loop gain" in the last sentence can be replaced with "open-loop gain." The easiest way to do this is to add enough additional capacitance at the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0315.jpg?height=447&width=752&top_left_y=1784&top_left_x=142)

Figure 4.98. Gain and phase in a multistage amplifier.
point in the circuit that produces the initial $6 \mathrm{~dB} /$ octave rolloff, so that the open-loop gain drops to unity at about the 3 dB frequency of the next "natural" $R C$ filter. In this way the open-loop phase shift is held at a constant $90^{\circ}$ over most of the passband, increasing toward $180^{\circ}$ only as the gain approaches unity. Figure 4.99 shows the idea. Without compensation, the open-loop gain drops toward 1, first at $6 \mathrm{~dB} /$ octave, then at $12 \mathrm{~dB} /$ octave, etc., resulting in phase shifts of $180^{\circ}$ or more before the gain has reached 1. By moving the first rolloff down in frequency (forming a "dominant pole"), the rolloff is controlled so that the phase shift begins to rise above $90^{\circ}$ only as the open-loop gain approaches unity. Thus, by sacrificing open-loop gain, you buy stability. Because the natural rolloff of lowest frequency is usually caused by the Miller effect in the stage driven by the input differential amplifier, the usual method of dominant-pole compensation consists simply of adding additional feedback capacitance around the second-stage transistor, so the combined voltage gain of the two stages is $g_{m} X_{\mathrm{C}}$ or $g_{m} / 2 \pi f C_{\text {comp }}$ over the compensated region of the amplifier's frequency response (Figure 4.100). In practice, Darlington-connected transistors would probably be used for both stages.

By putting the dominant-pole unity-gain crossing at the 3 dB point of the next rolloff, you get a phase margin of about $45^{\circ}$ in the worst case (follower), since a single $R C$ filter has a $45^{\circ}$ lagging phase shift at its 3 dB frequency, i.e., the phase margin equals $180^{\circ}-\left(90^{\circ}+45^{\circ}\right)$, with the $90^{\circ}$ coming from the dominant pole.

An additional advantage of using a Miller-effect pole for
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0315.jpg?height=707&width=661&top_left_y=1529&top_left_x=1042)

Figure 4.99. "Dominant-pole" compensation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0316.jpg?height=493&width=759&top_left_y=223&top_left_x=243)

Figure 4.100. Classic op-amp input stage with compensation.
compensation is that the compensation is inherently insensitive to changes in voltage gain with temperature or manufacturing spread of gain: higher gain causes the feedback capacitance to look larger, moving the pole downward in frequency in exactly the right way to keep the unity-gain crossing frequency unchanged. In fact, the actual 3 dB frequency of the compensation pole is quite irrelevant; what matters is the point at which it intersects the unity-gain axis (Figure 4.101).

#### B. Decompensated and uncompensated op-amps

If an op-amp is used in a circuit with closed-loop gain greater than unity (i.e., not a follower), it is not necessary to put the pole (the term for the "corner frequency" of a lowpass filter, see Chapter $1 x$ ) at such a low frequency as the stability criterion is relaxed because of the lower loop gain. Figure 4.102 shows the situation graphically.

For a closed-loop gain of 30 dB , the loop gain (which is the ratio of the open-loop gain to the closed-loop gain) is less than for a follower, so the dominant pole can be placed at a higher frequency. It is chosen so that the openloop gain reaches 30 dB (rather than 0 dB ) at the fre-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0316.jpg?height=360&width=593&top_left_y=1792&top_left_x=321)

Figure 4.101. The compensation capacitor is chosen to set the open-loop unity-gain frequency; the low-frequency gain is unimportant.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0316.jpg?height=432&width=774&top_left_y=218&top_left_x=1082)

Figure 4.102. Stability is easier to achieve with larger closed-loop gain.
quency of the next natural pole of the op-amp. As the graph shows, this means that the open-loop gain is higher over most of the frequency range, and the resultant amplifier will work at higher frequencies. Some op-amps are available in "decompensated" (a better word might be "undercompensated") versions, which are internally compensated for closed-loop gains greater than some minimum $\left(A_{\mathrm{V}}>5\right.$ in the case of the OP37); these specify a minimum closed-loop gain, and require no external capacitor. Another example is the THS4021/2, a decompensated version $\left(G_{V} \geq 10\right)$ of the unity-gain stable THS4011/2. These are really speedy op-amps, with an $f_{\mathrm{T}}$ of 300 MHz (for the "slow" THS4011/2), and greater than 1 GHz for the THS4021/2. For the decompensated versions the manufacturer (TI) supplies recommended external capacitance values (sometimes in combination with a resistor; see below) for a selection of minimum closed-loop gains. ${ }^{43}$ Decompensated or uncompensated op-amps are worth using if you need the added bandwidth and your circuit operates at high gain; see Chapter $4 x$ for further discussion.

Some intuition: it may at first seem paradoxical that an op-amp circuit configured for a low-gain circuit is more prone to oscillation than one configured for high-gain. But it makes sense: the better stability of an op-amp connected for a closed-loop gain of $G_{\mathrm{CL}}=100(40 \mathrm{~dB})$, say, comes about because the feedback network (resistive divider) attenuates signals by a factor of 100 . So it's harder to sustain an oscillation going around the loop, compared with a follower (in which the feedback has unity gain).

[^213]
#### C. Pole-zero compensation

It is possible to do a bit better than with dominant-pole compensation by using a compensation network that begins dropping ( $6 \mathrm{~dB} /$ octave, a "pole") at some low frequency, then flattens out again (it has a "zero") at the frequency of the second natural pole of the op-amp. In this way the amplifier's second pole is "cancelled," giving a smooth $6 \mathrm{~dB} /$ octave rolloff up to the amplifier's third pole. Figure 4.103 shows a frequency-response plot. In practice, the zero is chosen to cancel the amplifier's second pole; then the position of the first pole is adjusted so that the overall response reaches unity gain at the frequency of the amplifier's third pole. A good set of datasheets for an opamp with external compensation will often give suggested component values (an $R$ and a $C$ ) for pole-zero compensation, as well as the usual capacitor values for dominantpole compensation. Moving the dominant pole downward in frequency actually causes the second pole of the amplifier to move upward somewhat in frequency, an effect known as "pole splitting." The frequency of the cancelling zero is then chosen accordingly.

### 4.9.3 Frequency response of the feedback network

In all of the discussion thus far we have assumed that the feedback network has a flat frequency response; this is usually the case, with the standard resistive voltage divider as a feedback network. However, there are occasions when some sort of equalization amplifier is desired (integrators and differentiators are in this category) or when the frequency response of the feedback network is modified to improve amplifier stability. In such cases it is important to remember that the Bode plot of loop gain versus frequency is what matters, rather than the curve of open-loop gain. To make a long story short, the curve of ideal closed-loop
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0317.jpg?height=455&width=805&top_left_y=1742&top_left_x=118)

Figure 4.103. Cancelling the amplifier's second pole in "pole-zero" compensation.
gain versus frequency should intersect the curve of openloop gain, with a difference in slopes of $6 \mathrm{~dB} /$ octave. As an example, it is common practice to put a small capacitor (a few picofarads) across the feedback resistor in the usual inverting or noninverting amplifier. Figure 4.104 shows the circuit and Bode plot.

The amplifier would have been close to instability with a flat feedback network since the loop gain would have been dropping at nearly $12 \mathrm{~dB} /$ octave where the curves meet. The capacitor causes the loop gain to drop at $6 \mathrm{~dB} /$ octave near the crossing, guaranteeing stability. This sort of consideration is very important when designing differentiators because an ideal differentiator has a closed-loop gain that rises at 6 dB /octave; it is necessary to roll off the differentiator action at some moderate frequency, preferably going over to a $6 \mathrm{~dB} /$ octave rolloff at high frequencies. Integrators, by comparison, are very friendly in this respect, owing to their $6 \mathrm{~dB} /$ octave closed-loop rolloff. It takes real talent to make a low-frequency integrator oscillate!

Exercise 4.29. Show on a Bode plot that the value of stabilizing resistor $R_{1}$ in Figure 4.69 stops the differentiator action (i.e., flattens the curve of closed-loop gain) before the crossing point of open-loop and closed-loop gains. Explain our value of minimum recommended resistance $R_{1}$.

#### A. What to do

In summary, you are generally faced with the choice of internally compensated or uncompensated op-amps. It is simplest to use the compensated variety, and that's the usual choice. You might begin by considering the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0317.jpg?height=708&width=621&top_left_y=1521&top_left_x=1062)

Figure 4.104. A small feedback capacitor enhances stability.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0318.jpg?height=909&width=1448&top_left_y=216&top_left_x=322)

Figure 4.105. Output amplifier for 60 Hz power source. The push-pull output transistors $Q_{1}$ and $Q_{2}$ are power Darlingtons in a plastic power package.
conventional LF411 (JFET, $\pm 5 \mathrm{~V}$ to $\pm 15 \mathrm{~V}$ supply) or an improved version (the LT1057), or the rail-to-rail input and output LMC6482 (CMOS, +3 V to +15 V supply), or perhaps the accurate and quiet LT1012, all internally compensated for unity gain. If you need greater bandwidth or slew rate, look for a faster compensated op-amp (see Table 4.2a on 271 for some choices). If it turns out that nothing is suitable and the closed-loop gain is greater than unity (as it usually is), you can use a decompensated (or uncompensated) op-amp, perhaps with an external capacitor as specified by the manufacturer for the gain you are using. Using our previous example, the popular OP27 low-noise precision op-amp (unity-gain-compensated) has $f_{\mathrm{T}}=8 \mathrm{MHz}$ and a slew rate of $2.8 \mathrm{~V} / \mu \mathrm{s}$; it is available as the decompensated OP37 (minimum gain of 5), with $f_{\mathrm{T}}=63 \mathrm{MHz}$ and a slew rate of $17 \mathrm{~V} / \mu \mathrm{s} .{ }^{44}$

#### B. Example: precision 60 Hz power source

Uncompensated op-amps, or op-amps with a compensation pin, also give you the flexibility of overcompensating, a

[^214]simple solution to the problem of additional phase shifts introduced by other stuff in the feedback loop. Figure 4.105 shows an example. This is a low-frequency amplifier designed to generate a precise and stable 115 volt ac power output from a variable frequency 60 Hz low-level sinewave input. ${ }^{45}$ The op-amp is wired as an ac-coupled noninverting amplifier, with its output driving a Darlington push-pull emitter-follower output stage $Q_{1} Q_{2}$, which in turn drives the low-voltage winding of a small power transformer, $T_{1}$, whose windings are in the ratio of $6.3 \mathrm{~V}: 115 \mathrm{~V}$. In this way we generate 115 V ac output without high-voltage op-amps or transistors. Of course, we pay the price in proportionally higher drive current; here the transistors need to supply about $3 \mathrm{~A}(\mathrm{rms})$ to produce a 15 W output.

To generate low distortion and a stable output voltage under load variations, we want to take feedback from the actual 115 V output sinewave. It is highly desirable, however, to keep the output fully isolated from circuit ground. So we use a second transformer $T_{2}$ to produce a lowvoltage replica of the 115 V output waveform, which is
${ }^{45}$ The original design was used to drive an astronomical telescope at sidereal (star-tracking) rate. Interesting trivia: contrary to popular belief, the Earth turns on its axis once every 23 hours, 56 minutes, and 4.1 seconds; figure out why it isn't 24:00:00!
then fed back via $R_{3}$ to give the needed voltage gain of 6 . Because of the unacceptably large phase shifts of the transformers at high frequencies, the circuit is rigged up so that at higher frequencies - above $\sim 3 \mathrm{kHz}$ - the feedback comes from the low-voltage input to the transformer (via $C_{1}$ ). Even though high-frequency feedback is taken directly from the push-pull output, there are still phase shifts associated with the reactive load (the transformer primary, a motor attached to the output, etc.) seen by the transistors. To ensure good stability, even with reactive loads at the 115 volt output, the op-amp can be overcompensated with a small capacitor, as shown. (The unusual LT1097 obligingly provides a pin for overcompensation.) The loss of bandwidth that results is unimportant in a low-frequency application like this.

The function of $R_{4}$ and $C_{2}$ may be puzzling: this bit of circuitry provides a dc feedback path for the op-amp, by averaging (lowpass filtering) the dc level applied to $T_{1}$, which then feeds back via the floating winding of $T_{2}$. We chose $C_{2}$ large enough so its impedance at 60 Hz is small compared with the 50 k feedback resistor; then we chose $R_{4}$ for adequate smoothing consistent with stability.

The performance of this amplifier is quite satisfying. Figure 4.106 shows the output regulation, i.e., the change of rms output amplitude versus load. For comparison we show the comparable curve when feedback is taken exclusively from the driving winding of $T_{1}$, from which you can see that the desired feedback path improves output amplitude regulation, under load variations from zero to full power, from a mediocre $10 \%$ to just $0.2 \%$. The output sinewave is very clean, with measured distortion well below $1 \%$ under all load conditions, including driving a synchronous motor (which represents a reactive load).

An application such as this represents a compromise,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0319.jpg?height=514&width=759&top_left_y=1677&top_left_x=141)

Figure 4.106. Measured output voltage versus load for 60 Hz power source.
because ideally you would like to have plenty of loop gain to stabilize the output voltage against variations in load current. But a large loop gain increases the tendency of the amplifier to oscillate, especially if a reactive load is attached. This is because the reactive load, in combination with the transformer's finite output impedance, causes additional phase shifts within the low-frequency feedback loop. Because this circuit was built to power a telescope's synchronous driving motors (highly inductive loads), the loop gain was intentionally kept low.

Some additional points.

- With power electronics you should design conservatively so that a fault condition (e.g., too heavy a load, or even a short-circuit) doesn't destroy the device. Here we've used the simplest current-limiting method - a pair of small resistors in the collectors of the drive stage - because we didn't want to clutter the diagram (and it worked well enough, anyway!). There are better ways, though, for example, by adding a pair of transistors to rob base current when the output current (as sensed by a series resistor) exceeds a preset limit; such a scheme is commonly used within the integrated circuitry of op-amps themselves see Figure 4.43. As we'll explain in $\S 9.13 .3$, there are still better protective circuits. The problem with simple current-limiting protection is that a short-circuit load would cause the transistors to experience the limit current with the full supply voltage across them; the resulting power dissipation is far greater than the maximum under ordinary operation, which requires conservative heatsinking and component selection. Foldback current limiting would be better, though a bit more complicated.
- A push-pull follower with the bases tied together has a crossover region in which the feedback loop is effectively broken (see §2.4.1A). With Darlington transistors the crossover region is four $V_{\mathrm{BE}}$ 's, about 2.5 V . The resistor $R_{2}$ in Figure 4.105 ensures that there is always some linear coupling from the op-amp to $T_{1}$, to prevent the feedback loop from rattling around under light load. Better still would be diode biasing, in the manner of Figures 2.71 or 2.72 ; see also the discussion of push-pull follower output stages in Chapter $2 x$.
- There is an elegant way to use a normal $\pm 15 \mathrm{~V}$ op-amp to generate larger voltage swings, by replacing the emitter followers in Figure 4.105 with a "pseudo-Darlington" configuration with modest noninverting gain (also known as a "series feedback pair," see §2.5.5C), say a factor of 5. Then you can run the power output stage from a $\pm 75 \mathrm{~V}$ supply while powering the op-amp from conventional $\pm 15 \mathrm{~V}$.


#### C. Motorboating

In ac-coupled feedback amplifiers, stability problems can also crop up at very low frequencies, because of the accumulated leading phase shifts caused by several capacitively coupled stages. Each blocking capacitor, in combination with the input resistance (from bias strings and the like), causes a leading phase shift that equals $45^{\circ}$ at the low-frequency 3 dB point and approaches $90^{\circ}$ at lower frequencies. If there is enough loop gain, the system can go into a low-frequency oscillation picturesquely known as "motorboating." With the widespread use of dc-coupled amplifiers, motorboating is almost extinct. However, oldtimers can tell you some good stories about it.


### Review of Chapter 4

An A-to-O summary of what we have learned in Chapter 4. This summary reviews basic principles and facts in Chapter 4 , but it does not cover application circuit diagrams and practical engineering advice presented there.

#### IA. The Ideal Op-amp.

In Chapter 4 we explored the world of Operational Amplifiers ("Op-amps"), universal building blocks of analog circuits. A good op-amp approaches the ideal of an infinitegain wideband noiseless dc-coupled difference amplifier with zero input current and zero offset voltage. Op-amps are intended for use in circuits with negative feedback, where the feedback network determines the circuit's behavior. Op-amps figure importantly in the topics of Chapter 5 (Precision Circuits), Chapter 6 (Filters), Chapter 7 (Oscillators and Timers), Chapter 8 (Low-Noise Techniques), Chapter 9 (Voltage Regulation and Power Conversion), and Chapter 13 (Digital Meets Analog).

#### |B. The "Golden Rules."

At a basic level (and ignoring imperfections, see $\pi I K-M$ below), an op-amp circuit with feedback can be simply understood by recognizing that feedback from the output operates to (I) make the voltage difference between the inputs zero; and, at the same level of ignoration, (II) the inputs draw no current. These rules are quite helpful, and for dc (or low-frequency circuits) they are in error only by typical offset voltages of a millivolt or less (rule I), and by typical input currents of order a picoamp for FET types or tens of nanoamps for BJT types (rule II).

#### IC. Basic Op-amp Configurations.

In $\S 4.2$ and $\S 4.3$ we met the basic linear circuits (detailed in TIID-F below): inverting amplifier, non-inverting amplifier (and follower), difference amplifier, current source (transconductance, i.e., voltage-to-current), transresistance amplifier (i.e., current-to-voltage), and integrator. We saw also two important non-linear circuits: the Schmitt trigger, and the active rectifier. And in $\S 4.5$ we saw additional circuit building blocks: peak detector, sample-and-hold, active clamp, active full-wave rectifier (absolute-value circuit), and differentiator.

#### 1D. Voltage Amplifiers.

The inverting amplifier (Figure 4.5) combines input current $V_{\text {in }} / R_{1}$ and feedback current $V_{\text {out }} / R_{2}$ into a summing junction; it has voltage gain $G_{\mathrm{V}}=-R_{2} / R_{1}$ and input impedance $R_{1}$. In the noninverting amplifier (Figure 4.6) a fraction of
the output is fed back to the inverting input; it has voltage gain $G_{\mathrm{V}}=1+R_{2} / R_{1}$ and near-infinite input impedance. For the follower (Figure 4.8) the feedback gain is unity, i.e., the resistive divider is replaced by a connection from output to inverting input. The difference amplifier (Figure 4.9) uses a pair of matched resistive dividers to generate an output $V_{\text {out }}=\left(R_{2} / R_{1}\right) \Delta V_{\text {in }}$; its input impedance is $R_{1}+R_{2}$, and its common-mode rejection depends directly on the accuracy of the resistor matching (e.g., $\sim 60 \mathrm{~dB}$ with $\pm 0.1 \%$ resistor tolerance). Difference amplifiers are treated in greater detail in $\S 5.14$. A pair of input followers can be used to achieve high input impedance, but a better 3-op-amp configuration is the instrumentation amplifier, see $\S 5.15$.

#### ПE. Integrator and Differentiator.

The integrator (Figure 4.16) looks like an inverting amplifier in which the feedback resistor is replaced by a capacitor; thus the input current $V_{\text {in }} / R_{1}$ and feedback current $C d V_{\text {out }} / d t$ are combined at the summing junction. Ignoring the imperfections in $\mathbb{K}$ below, the integrator is "perfect," thus any non-zero average dc input voltage will cause the output to grow and eventually saturate. The integrator can be reset with a transistor switch across the feedback capacitor (Figure 4.18); alternatively you can use a large shunt resistor to limit the dc gain, but this defeats the integrator operation at low frequencies $\left(f \lesssim 1 / R_{\mathrm{f}} C\right)$. The integrator's input impedance is $R_{1}$.

The op-amp differentiator (Figure 4.68) is a similar configuration, but with $R$ and $C$ interchanged. Without additional components (Figure 4.69) this configuration is unstable (see $\mathbb{T I O}$, below).

IF. Transresistance and Transconductance Amplifiers.
By omitting the input resistor, an inverting voltage amplifier becomes a transresistance amplifier ${ }^{46}$, i.e., a current-to-voltage converter (Figure 4.22). Its gain is $V_{\text {out }} / I_{\mathrm{in}}=-R_{\mathrm{f}}$, and (ignoring imperfections) the impedance at its input (which drives the summing junction) is zero. Capacitance at the input creates issues of stability, bandwidth, and noise; see $\S 8.11$ and the discussion in Chapter $4 x$. Transresistance amplifiers are widely used in photodiode applications.

A transconductance amplifier (Figures 4.10-4.15) converts a voltage input to a current output; it is a voltagecontrolled current source. The simplest form uses an opamp and one resistor (Figure 4.10), but works only with a floating load. The Howland circuit and its variations (Figures 4.14 and 4.15) drive a load returned to ground, but

[^215]their accuracy depends on resistor matching. Circuits with an external transistor (Figures 4.12 and 4.13) drive loads returned to ground, do not require resistor matching, and, in contrast to the other circuits, benefit from the intrinsically high output impedance of the transistor. In Chapter $4 x$ we describe a nice variation on the transistor-assisted current source that achieves both high speed and bipolarity output (i.e., sinking and sourcing)

#### |G. Nonlinear Circuits: Peak Detector, S/H, Clamp, Rectifier.

Because of their high gain, op-amps provide accuracy to nonlinear functions that can be performed with passive components alone; in these circuits one or more diodes select the regions in which feedback acts. The peak detector (Figure 4.58) captures and holds the highest (or lowest) voltage since the last reset; the sample-and-hold $(\mathrm{S} / \mathrm{H})$ circuit (Figure 4.60) responds to an input pulse by capturing and holding the value of an input signal voltage; the $a c$ tive clamp (Figure 4.61) bounds a signal to a maximum (or minimum) voltage; the active rectifier creates accurate half-wave (Figures 4.36 and 4.38) or full-wave (Figures 4.63 and 4.64 ) outputs. In practice the performance of these circuits is limited by the finite slew rate and output current of real op-amps (see $\llbracket$ IM, below).

#### IH. Positive Feedback: Comparator, Schmitt Trigger, and Oscillator.

If the feedback path is removed, an op-amp acts as a comparator, with the output responding (by saturating near the corresponding supply rail) to a reversal of differential input voltage of a millivolt or less (Figure 4.32A). Adding some positive feedback (Figure 4.32B) creates a Schmitt trigger, which both speeds up the response and also suppresses noise-induced multiple transitions. Op-amps are optimized for use with negative feedback in linear applications (notably by a deliberate internal $-6 \mathrm{~dB} /$ octave rolloff "compensation," see $\llbracket$ ( O below), so special comparator ICs (lacking compensation) are preferred, see $\S 12.3$ and Tables 12.1 and 12.6. A combination of positive feedback (Schmitt trigger) and negative feedback (with an integrator) creates an oscillator (Figure 4.39), a subject treated in detail in Chapter 7.

#### qII. Single-Supply and Rail-to-rail Op-amps.

For some op-amps both the input common-mode range and the output swing extend all the way down to the negative rail, making them particularly suited for operation with a single positive supply. Rail-to-rail op-amps allow input swings to both supply rails, or output swings to both rails,
or both; see Table 4.2a. The latter are especially useful in circuits with low supply voltages.

#### IIJ. Some Cautions.

In linear op-amp circuits, the Golden Rules (see $\llbracket \mathrm{B}, \mathrm{above}$ ) will be obeyed only if (a) feedback is negative and (b) the op-amp stays in the active region (i.e., not saturated). There must be feedback at dc, or the op-amp will saturate. Power supplies should be bypassed. Stability is degraded with capacitive loads, and by lagging phase shifts in the feedback path (e.g., by capacitance at the inverting terminal). And, most important, real op-amps have a host of limitations (IIIIK-N, below) that bound attainable circuit performance.

#### IK. Departures from Ideal Behavior.

In the real world op-amps are not perfect. There is no "best" op-amp, thus one must trade off a range of parameters: input imperfections (offset voltage, drift, and noise; input current and noise; differential and common-mode range), output limitations (slew rate, output current, output impedance, output swing), amplifier characteristics (gain, phase shift, bandwidth, CMRR and PSRR), operating characteristics (supply voltage and current), and other considerations (package, cost, availability). See §4.4, Tables 4.1, 4.2 a , and 4.2 b , the more extensive tables in Chapters 5, and 8 , and IIIL-N below.

#### IL. Input Limitations.

The input offset voltage ( $V_{\mathrm{os}}$ ), ranging from about $25 \mu \mathrm{~V}$ ("precision" op-amp) to 5 mV , is the voltage unbalance at the input terminals. It's an important parameter for precision circuits, and circuits with high closed-loop dc gain; the error seen at the output is $G_{\mathrm{CL}} V_{\mathrm{os}}$ ). Some op-amps provide pins for external trimming of offset voltage (e.g., see Figure 4.43).

The offset voltage drift, or tempco ( $\mathrm{TCV}_{\mathrm{os}}$, or $\left.\Delta V_{\mathrm{os}} / \Delta T\right)$, is the temperature coefficient of offset voltage; it ranges from about $0.1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ ("precision" op-amp) to $10 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$. Even if you're lucky and have an op-amp with low $V_{\text {os }}$ (or you've trimmed it to zero), $\mathrm{TC} V_{\text {os }}$ represents the growth of offset with changing temperature.

The input noise voltage density $\left(e_{\mathrm{n}}\right)$ represents a noisy voltage source in series with the input terminals. It ranges from about $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (low-noise bipolar op-amp) to $100 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ or more (micropower op-amps). Noise voltage is important in audio and precision applications.

The input bias current $\left(I_{\mathrm{B}}\right)$ is the (non-zero) dc current at the input terminals. It ranges from a low of about 5 fA (CMOS low-bias op-amps, and "electrometer" op-amps) to

50 nA (typical ${ }^{47}$ BJT op-amps) to a high of $10 \mu \mathrm{~A}$ (wideband BJT-input op-amps). Bias current flowing through the circuit's dc source resistance causes a dc voltage offset; it also creates a current error in integrators and transresistance amplifiers.

The input noise current $\left(i_{n}\right)$ is the equivalent noise current added at the input. For most op-amps ${ }^{48}$ it is simply the shot noise of the bias current $\left(i_{n}=\sqrt{2 q I_{B}}\right)$; it ranges from about $0.1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (CMOS low-bias op-amps, "electrometer" op-amps) to $1 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ (wideband BJT op-amps). Input noise current flowing through the circuit's ac source impedance creates a noise voltage, which can dominate over $e_{\mathrm{n}}$. The ratio $r_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$ is the op-amp's noise resistance; for signal source impedances greater than $r_{\mathrm{n}}$ the current noise dominates.

Op-amps function properly when both inputs are within the input common-mode voltage range $\left(V_{\mathrm{CM}}\right)$, which may extend to the negative rail ("single-supply" op-amps), or to both rails ("rail-to-rail" op-amps). Beware: many op-amps have a more restricted input differential voltage range, sometimes as little as just a few volts.

#### ПM. Output Limitations.

The slew rate (SR) is the op-amp's $d V_{\text {out }} / d t$ with an applied differential voltage at the input. It is set by internal drive currents charging the compensation capacitor, and ranges from about $0.1 \mathrm{~V} / \mu \mathrm{s}$ (micropower op-amps) to $10 \mathrm{~V} / \mu \mathrm{s}$ (general purpose op-amps) to $5000 \mathrm{~V} / \mu \mathrm{s}$ (highspeed op-amps). Slew rate is important in high-speed applications generally, and in large-swing applications such as $\mathrm{A} / \mathrm{D}$ and D/A converters, S/H and peak detectors, and active rectifiers. It limits the large-signal output frequency: a sinewave of amplitude $A$ and frequency $f$ requires a slew rate of $\mathrm{SR}=2 \pi A f$; see Figure 4.54.

Op-amps are small devices, with output current deliberately limited to prevent overheating; see for example Figure 4.43, where $R_{5} Q_{9}$ and $R_{6} Q_{10}$ limit the output sourcing and sinking currents to $I_{\mathrm{lim}}=V_{\mathrm{BE}} / R \approx 25 \mathrm{~mA}$, illustrated in Figure 4.45. If you need more output current, there are a few high-current op-amps available; you can also add an external unity-gain power buffer like the LT1010 ( $I_{\text {out }}$ to $\pm 150 \mathrm{~mA}$ ), or a discrete push-pull follower.

The open-loop output impedance of an op-amp is generally in the neighborhood of $100 \Omega$, which is reduced by the loop gain to fractions of an ohm at low frequencies. Because an op-amp's open-loop gain $G_{\text {OL }}$ falls as $1 / f$ over

[^216]most of its bandwidth (see $\mathbb{T O}$ below), however, the circuit's closed-loop output impedance rises approximately proportional to frequency; it looks inductive (Figure 4.53).

In general the output swing for an op-amp like Figure 4.43 extends only to within a volt or so from either rail. Many CMOS and other low-voltage op-amps, however, specify unloaded rail-to-rail output swings, see Figure 4.46.

Op-amps can be grouped into several supply voltage ranges: "low-voltage" op-amps have a maximum total supply voltage (i.e., $V_{+}-V_{-}$) around 6 V , and generally operate down to 2 V ; "high-voltage" op-amps allow total supply voltages to 36 V , and generally operate down to $5-10 \mathrm{~V}$. In between there is a sparse class of what might be called "mid-voltage" op-amps, with total supply voltages in the neighborhood of $10-15 \mathrm{~V}$. See Table 5.5. There are also op-amps that are truly high-voltage (to hundreds of volts), see Table 4.2b.

#### IN. Gain, Phase Shift, and Bandwidth.

Op-amps have large dc open-loop gain $G_{\mathrm{OL}(\mathrm{dc})}$, typically in the range of $10^{5}-10^{7}$ (the latter being typical of "precision" op-amps, see Chapter 5). To ensure stability (see $\mathbb{T I O}$, below) the op-amp's open-loop gain falls as $1 / f$, reaching unity at a frequency $f_{\mathrm{T}}$ (see Figure 4.47). This limits the closed-loop bandwidth to $\mathrm{BW}{ }_{\mathrm{CL}} \approx f_{\mathrm{T}} / G_{\mathrm{CL}}$. Over most of the operating frequency range the op-amp's open-loop phase shift is $-90^{\circ}$, eliminated in the closed-loop response by feedback.

#### ПO. Feedback Stability, "Frequency Compensation," and Bode Plots

Finally, negative feedback can become positive feedback, promoting instability and oscillations, if the accumulated phase shift reaches $180^{\circ}$ at a frequency at which the loop gain is $\geq 1$. This topic is foreshadowed in $\S 4.6 .2$ in connection with capacitive loads, and it is discussed in detail in $\S 4.9$. The basic technique is dominant-pole compensation, in which a deliberate $-6 \mathrm{~dB} /$ octave (i.e., $\propto 1 / f$ ) rolloff is introduced within the op-amp in order to bring the gain down to unity at a frequency lower than that at which additional unintended phase shifts rear their ugly heads (Figure 4.99). Most op-amps include such compensation internally, such that they are stable at all closed-loop gains (the unity-gain follower configuration is most prone to instability, because there is no attenuation in the feedback path). "Decompensated" op-amps are less aggressively compensated, and are stable for closed-loop gains greater than some minimum (often specified as $G>2,5$, or 10 ;

Figure 4.95). Compensated op-amps exhibit an open-loop lagging phase shift of $90^{\circ}$ over most of their frequency range (beginning as low as 10 Hz or less). Thus an external feedback network that adds another $90^{\circ}$ of lagging phase shift at a frequency where the loop gain is unity will cause oscillation.

A favorite tool is the Bode Plot, a graph of gain (log) and phase (linear) versus frequency (log); see Figure 4.97. The stability criterion is that the difference of slopes between the open-loop gain curve and the ideal closed-loop gain curve, at their intersection, should ideally be $6 \mathrm{~dB} /$ octave, but in no case as much as $12 \mathrm{~dB} /$ octave.

# 5. PRECISION CIRCUITS

In the preceding chapters we dealt with many aspects of analog circuit design, including the circuit properties of passive devices, transistors, FETs, and op-amps, the subject of feedback, and numerous applications of these devices and circuit methods. In all our discussions, however, we have not yet addressed the question of the best that can be done, for example, in minimizing amplifier errors (nonlinearities, drifts, etc.) and in amplifying weak signals with minimum degradation by amplifier "noise." In many applications these are the most important issues, and they form an important part of the art of electronics. Therefore, in this chapter, we look at methods of precision circuit design (deferring the issue of noise in amplifiers to Chapter 8).

## Chapter overview

This is a big chapter - and an important one. It deals with a range of topics, which need not be read in order. As guidance, we offer this outline: we start with a careful examination of errors in circuits made with operational amplifiers, and explore the use of an error budget. We explore issues of unspecified parameters and "typical" versus "worst-case" component errors, and discuss ways to deal with them. Along the way we deal with some neglected topics such as diode leakage at the sub-picoamp level, "memory effect" in capacitors, distortion and gain nonlinearity, and an elegant way to remedy phase error in amplifiers. We discuss op-amp distortion in detail, with comparative graphs and test circuits.

Next we discuss the dark side of rail-to-rail op-amps: their open-loop output impedance, and input commonmode crossover errors. We provide detailed selection tables for precision, chopper and high-speed op-amps, and comparative graphs charting their noise, bias current, and distortion. We show how to interpret the multitude of opamp parameters, and we discuss the tradeoffs you'll have to make.

For those working in the low microvolt and nanovolt territory, we show the devastating effects of $1 / f$ noise, and how auto-zero (AZ) op-amps solve this problem; but there's a tradeoff - the current noise of these devices that is often overlooked. As an interlude we look in some de-
tail at the cleverness of the front-end stage of an exemplary precision digital multimeter.

Then we advance to difference and instrumentation amplifiers - these go to the head of the class both in terms of digging out a difference signal in the presence of commonmode input, and in terms of gain accuracy and stability. We show their internal designs and how they're used, with extensive tables and graphs comparing popular parts. Finally we take up fully differential amplifiers - these have differential inputs and outputs, and an output "commonmode control" input pin. Once again, we organize tables, internal circuit diagrams, and guidance for their use with high-performance ADCs.

For readers looking for the basics, this chapter can be skipped over in a first reading. Its material is not essential for an understanding of later chapters.

## 5.1 Precision op-amp design techniques

In the field of measurement and control there is often a need for circuits of high precision. Control circuits should be accurate, stable with time and temperature, and predictable. The usefulness of measuring instruments likewise depends on their accuracy and stability. In almost all electronic subspecialties we always have the desire to do things more accurately - you might call it the joy of perfection. Even if you don't always actually need the highest precision, you can still delight in a full understanding of what's going on.

### 5.1.1 Precision versus dynamic range

It is easy to get confused between the concepts of precision and dynamic range, especially because some of the same techniques are used to achieve both. Perhaps the difference can best be clarified by some examples: a 5-digit multimeter has high precision; voltage measurements are accurate to $0.01 \%$ or better. Such a device also has wide dynamic range; it can measure millivolts and volts on the same scale. A precision decade amplifier (one with selectable gains of 1,10 , and 100 , say) and a precision voltage reference may
have plenty of precision, but not necessarily much dynamic range. An example of a device with wide dynamic range but only moderate accuracy might be a 6-decade logarithmic amplifier (log-amp) built with carefully trimmed opamps but with components of only $5 \%$ accuracy; even with accurate components a log-amp might have limited accuracy because of lack of log conformity (at the extremes of current) of the transistor junction used for the conversion, or because of temperature-induced drifts.

Another example of a wide-dynamic-range instrument (greater than 10,000:1 range of input currents) with only moderate accuracy requirement ( $1 \%$ ) is the coulomb meter described in $\S 9.26$ of the previous edition of this book. It was originally designed to keep track of the total charge put through an electrochemical cell, a quantity that needs to be known only to approximately $5 \%$ but that may be the cumulative result of a current that varies over a wide range. It is a general characteristic of wide-dynamic-range design that input offsets must be carefully trimmed in order to maintain good proportionality for signal levels near zero; this is also necessary in precision design, but, in addition, precise components, stable references, and careful attention to every possible source of error must be used to keep the sum total of all errors within the so-called error budget.

### 5.1.2 Error budget

A few words on error budgets. There is a tendency for the beginner to fall into the trap of thinking that a few strategically placed precision components will result in a device with precision performance. On rare occasions this will be true. But even a circuit peppered with $0.01 \%$ resistors and expensive op-amps won't perform to expectations if somewhere in the circuit there is an input offset current multiplied by a source resistance that gives a voltage error of 10 mV , for example. With almost any circuit there will be errors arising all over the place, and it is essential to tally them up, if for no other reason than to locate problem areas where better devices or a circuit change might be needed. Such an error budget results in rational design, in many cases revealing where an inexpensive component will suffice, and eventually permitting a careful estimate of performance.

To add some spice to the subject, we note that there is some controversy in the engineering community surrounding this business of error budgets. One camp (which we might characterize as strict constructionists) insists that you allow for the true worst case, or you are guilty of violating good engineering practice. For example, if there are

18 gain-determining resistors of $\pm 1 \%$ tolerance in a circuit, then the guaranteed performance must be specified as $\pm 18 \%$. The response of the other camp (which we might characterize as pragmatists) is "balderdash - it's overly constraining to allow an extremely unlikely possibility to limit the performance of a circuit design; and one can deal with such eventualities with component test procedures, finished circuit performance testing, and so on." We'll revisit this controversy (and take sides in the debate) after running through an introductory example.

## 5.2 An example: the millivoltmeter, revisited

To motivate the discussion of precision circuits, let's revisit a circuit from the previous chapter. There we flirted, briefly, with issues of precision in $\S 4.4 .3$, mostly to illustrate the effects of input offset voltage $V_{\mathrm{OS}}$ and input bias current $I_{\mathrm{B}}$ in a low-level dc application (a $0-10 \mathrm{mV}$ millivoltmeter with $10 \mathrm{M} \Omega$ input resistance ${ }^{1}$ ). Back then, with wide-eyed naivety, we were astonished to see that our trusty LF411 op-amp was wholly inadequate to the task; it had way too much offset, and too much input current as well. We found a solution in the form of either a precision low-bias op-amp (an OPA336) or a chopper (also known as "auto-zeroing") amplifier (an LTC1050).

As we'll soon see, our celebration of that "solution" was premature: we pronounced victory with an op-amp whose $I_{\mathrm{B}}$ alone caused the maximum allowable zero-input error of $1 \%$. A careful design must take into account the cumulative effect of multiple sources of error.

### 5.2.1 The challenge: $10 \mathrm{mV}, 1 \%, 10 \mathrm{M} \Omega, 1.8 \mathrm{~V}$ single supply

To make the problem more interesting, let's further constrain the specifications. This time we'll ask that the $0-$ 10 mV meter operate from a single +3 V battery (either a lithium cell or a pair of alkaline AAA cells); that forces us to worry about "single-supply" operation, in which the op-amp must work down to zero volts at both input and output. Furthermore, it must work down to the end-of-life voltage of alkaline cells, which you see stated variously as $1.0 \mathrm{~V} /$ cell, or $0.9 \mathrm{~V} /$ cell; that means operation down to +1.8 V total supply voltage. And, as before, let's require an input resistance of $10 \mathrm{M} \Omega$ and insist that it indicates 0 mV ( $\pm 1 \%$ of full scale) when the input is either shorted

[^217]or open. Note that this "zero-error" specification is different from a full-scale accuracy ("scale error") specification: we might be happy with $\pm 5 \%$ full-scale accuracy, but we'd be most unhappy with a meter that reads $5 \%$ of full scale (here 0.5 mV ) when there's nothing connected to it.

Following the suggestion from last chapter's design, let's use current-sensing feedback, so the design is independent of the internal resistance of the analog meter. Figure 5.1 shows the circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0327.jpg?height=468&width=768&top_left_y=613&top_left_x=134)

Figure 5.1. Accurate millivoltmeter powered with single lithium cell. The input protection clamp uses low-leakage diode-connected PN4117 JFETs.

### 5.2.2 The solution: precision RRIO current source

We use a precise current-sensing resistor $R_{4}$, in this case a $0.1 \% 100 \Omega$ resistor. Sounds exotic, but in fact these things are commonplace: the ever-helpful DigiKey website shows over 100,000 in stock, from five different suppliers, at prices down to $\$ 0.20$ (in quantities of 10 ). Note the routing of the input common ("-" terminal) connection directly to the low side of the sense resistor, a precaution that becomes increasingly important with small-value sense resistors, in which the wiring resistance of the ground return may add significant error. ${ }^{2}$ Because the meter likely presents an inductive load (it's a moving coil in a magnetic field, which is both inductive in its own right and reactive through its motor-like electromechanical properties), we took the precaution of dividing the feedback path in the usual way (through $R_{5}$ at low frequencies, $C_{1}$ at high frequencies; see for example Figure 4.76). The 10k output resistor $R_{3}$ limits meter current for off-scale inputs.

The more challenging parts of this design are the input

[^218]protection network (which we blithely ignored in Chapter 4's example), and, most critically, the choice of op-amp. First, the protection network: the requirements seem easy - clamp to a nondestructive op-amp input voltage (during input overvoltages), and draw less than $\sim 10 \mathrm{pA}$ leakage current at the full-scale input voltage ( 10 mV ), in both forward and reverse directions. (That amount of diode current would reduce the input resistance by $1 \%$.) As it turns out, the datasheets don't ordinarily tell you how much current a diode draws at very low voltages. But if you go measure it, you'll be surprised at what you find (Figure 5.2). Everyone's favorite jellybean signal diode (1N914, 1N4148) is rather leaky, looking roughly like a $10 \mathrm{M} \Omega$ resistor at low voltages. ${ }^{3}$ There are some specialized low-leakage diodes like the (somewhat hard to get) PAD-1 or PAD-5 that do much better; but you can do as well by using a diodeconnected low-leakage JFET like the $n$-channel PN4117 (i.e., tie the source and drain together to form the cathode, and use the gate as the anode), or you can just use the diode terminal pairs from an ordinary $n p n$ transistor. ${ }^{4}$ In this circuit the upstream 10 k resistor $R_{2}$ limits the clamp current, while having no effect on the circuit accuracy.

And now for the op-amp. This was the stumbling block in Chapter 4, and it has gotten only more difficult here, with the single low-voltage supply. We can separate the errors into a "zero" error and an overall scale factor error. The latter is the easy part: the circuit's gain is accurately determined, so we merely require an accurate meter movement (if we don't want any trim adjustments; or we could reduce the sense resistor and add a resistor to produce a trimmable gain greater than unity). It's the "zero" requirement that is the tough part, because of the high sensitivity plus the high mandated input resistance. We require a worst-case combined effect of input offset and bias current of $100 \mu \mathrm{~V}$ and 10 pA individually. That is, each alone would cause a zero error of $0.1 \mathrm{mV}\left(V_{\mathrm{err}}=V_{\mathrm{OS}}+I_{\mathrm{B}} R_{1}\right)$, so each must be smaller so that the worst-case combination meets specifications.

We looked at some promising contemporary op-amp offerings, which we've listed (along with the usual suspects) in Table 5.1 on page 296. The inexpensive jellybeans in the

[^219]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0328.jpg?height=593&width=761&top_left_y=206&top_left_x=239)

Figure 5.2. Diode datasheets are often skimpy with data like this, showing the low end of the current versus forward applied voltage. See Chapter $1 x$ for lots more detail.
first three rows are hopeless for this job, with both offset voltage and bias current far worse than required (listed in the bottom row). And they all fail to operate at +1.8 V ; and the first two fail the "single-supply" requirement. So much for el-cheapo op-amps.

The LPV521 is characteristic of the new breed of "low-voltage, low-bias, low-power" op-amps. It does those things just fine, but, in common with many CMOS opamps, its $V_{\text {OS }}$ specs are only so-so. It's possible to do considerably better. For example, the CMOS precision OPA336 was our hero earlier; but look - its worse-case $I_{B}$ consumes our entire error budget, and it would require $V_{\mathrm{OS}}$ trimming anyway, which is not so easily done in a singlesupply setup (unlike our friend the LF411, this op-amp has no trim pins). We brushed off such niceties earlier; but this time let's accept full responsibility for producing products that meet specs. That means adopting some serious worstcase discipline.

What choices are left? Most designers would reach for an auto-zero (chopper) amplifier for a precision application that does not require bandwidth and that is tolerant of noise. The best candidate we found is the ADA4051, with excellent $V_{\text {OS }}$ specs, but five times too much $I_{\mathrm{B}}$, if you believe the "maximum" specs. (Competing auto-zero amplifiers had greater bias current, greater minimum supply voltage, or both.) The last two op-amps are contemporary CMOS op-amps that qualify as "precision," owing to careful design and production-line offset trimming. Both meet the error budget goals (but see below). We chose the AD8603 because it meets the 1.8 V supply spec, and as a bonus it operates at $35 \%$ the supply current of the LTC6078
(a dual op-amp, with no single version we could find). ${ }^{5}$ As listed in Table 5.5, the AD8603 runs at $40 \mu \mathrm{~A}$ quiescent current, and has $1 \mathrm{pA}(\max )$ input current and $50 \mu \mathrm{~V}$ (max) offset voltage at $25^{\circ} \mathrm{C}$.

Are we done? Not quite. The specs in the table are for operation at $25^{\circ} \mathrm{C}$. It can get plenty warmer, with impressive increases in bias current for CMOS devices (for which the "bias" current is leakage current). Manufacturers will ordinarily provide worst-case (and sometimes typical) values at the high end of the operating temperature range (e.g., $85^{\circ} \mathrm{C}$ for "industrial" temperature range devices). For our chosen AD8603 they specify $I_{\mathrm{B}}(\max )=50 \mathrm{pA}$ at $85^{\circ} \mathrm{C}$. No worst-case data for intermediate temperatures are given; but that value is consistent with a doubling every $10^{\circ} \mathrm{C}$, so we can be confident that the circuit will meet specs ${ }^{6}$ up to $50^{\circ} \mathrm{C}$. It's worth noting that manufacturers are sometimes rather lazy in setting worst-case leakage specs, as for example with the LPV521 in the table, whose ratio of "maximum" to "typical" $I_{\mathrm{B}}$ is 100:1. One industry guru attributes that to an unwillingness to test production parts to a tighter spec.
Exercise 5.1. We designed a $\pm 10 \mathrm{mV}$ meter in Chapter 4 (Figure 4.56), but our design in Figure 5.1 is unipolar (i.e., 0 to +10 mV ). Your boss has asked you to modify the design for $\pm 10 \mathrm{mV}$ capability, using a $\pm 100 \mu \mathrm{~A}$ zero-center meter and retaining the feature of operating with either a single lithium cell (or pair of AAA alkaline cells). Hint: you may wish to look at the AD8607 dual member of the AD8603 op-amp family. Extra credit: after finishing, you decide to impress your boss by enhancing the design so it will work with a $0-100 \mu \mathrm{~A}$ meter.

## 5.3 The lessons: error budget, unspecified parameters

From this rather simple first example we've learned some important basic principles: (a) first, you've got to identify and quantify the sources of error within a circuit in order to create an error budget; and (b) strict worst-case design requires that all components (passive and active) be operated within their datasheet specifications, and that the effects of

[^220]Table 5.1 Millivoltmeter Candidate Op-amps

| Part \# | $\begin{aligned} & \text { 莒 } \\ & \underline{\underline{n}} \end{aligned}$ | $v_{\text {os }}$ |  | $I_{\text {bias }}$ |  | $V_{\mathrm{cm}}$ neg lim (V) | $v_{\text {out }}$ | $V_{\text {S }}$ (total) |  | $\begin{gathered} I_{\mathrm{s}} \\ \text { typ } \\ (\mu \mathrm{A}) \end{gathered}$ | $\begin{gathered} \text { Price } \\ 100 \mathrm{pc} \\ \text { (\$) } \end{gathered}$ | Notes |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  | typ <br> ( $\mu \mathrm{V}$ ) |  |  |  |  |  |  | max <br> (V) |  |  |  |
| uA741 | BJT | 2000 | 6000 | 80k | 500k | 2 | 1.5V from rails | 10 | 40 | 1500 | 0.27 | old HV BJT |
| LF411 | JFET | 800 | 2000 | 50 | 200 | 3 | 1.5V from rails | 10 | 40 | 1800 | 0.88 | HV JFET |
| LM358A | BJT | 2000 | 3000 | 45k | 100k | 0 | 0 to $V_{+}-1.2 \mathrm{~V}$ | 3 | 32 | 500 | 0.21 | old HV SS |
| LPV521 | CMOS | 100 | 1000 | 0.01 | 1 | -0.1 | R-R | 1.8 | 5.5 | 0.5 | 1.05 | low-bias LV RRIO |
| OPA336 | CMOS | 60 | 125 | 1 | 10 | -0.2 | R-R | 2.3 | 5.5 | 20 | 1.70 | chap 4 "solution" |
| ADA4051 | CMOS | 2 | 17 | 5 | 50 | 0 | R-R | 1.8 | 5 | 15 | 2.20 | LV auto-zero RRIO |
| LTC6078 | CMOS | 7 | 25 | 0.2 | 1 | 0 | R-R | 2.7 | 5.5 | 110 | 1.75 | LV low- $I_{B}$ low- $V_{\text {OS }}$ RRIO dual |
| AD8603 | CMOS | 12 | 50 | 0.2 | 1 | $-0.3$ | R-R | 1.8 | 5 | 40 | 1.40 | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0329.jpg?height=55&width=315&top_left_y=797&top_left_x=1380) |
| Ckt Limit |  | - | 100 | - | 10 | 0 | 0 to anything | 1.8 | >3.6 |  |  | must budget contributions |

their guaranteed worst-case errors be added (as unsigned magnitudes) to determine the overall circuit's performance.

So far, so good; and in this example the op-amp choice allowed us to meet (and exceed) our target zero-error specifications ( $1 \%$ of full scale, with input open or shorted), even under guaranteed worst-case values of $I_{\mathrm{B}}$ and $V_{\mathrm{OS}}$.

#### A. Unspecified parameters: a pragmatic approach

But, looking a little closer, we've also seen in this design example that an unspecified parameter (forward diode current at low voltages, $0-10 \mathrm{mV}$ ) figured into the overall error. ${ }^{7}$ What should one do under such circumstances?

The authors belong to the camp of "pragmatists" on this matter: first, you may have to be creative in reading the datasheet (as we did in the case of op-amp input current), particularly when the manufacturer's worst-case numbers represent a statement that "I don't want to test this parameter, so I'll put a conservative guess in the datasheet'; this is particularly relevant with parameters like leakage current, where the limits of automated test equipment (ATE) and testing time constraints encourage conservative worst-case datasheet specifications. Second, you may have to do some testing ${ }^{8}$ of poorly specified (or unspecified) parameters (as we did with forward diode current). It may be sufficient to establish that the circuit effects of the unspecified parameter are completely insignificant (as here, when the current through the clamp diodes was less than 0.01 pA , or three orders of magnitude below budget); or, if it's a closer call,

[^221]you may have to set up a testing regime of incoming components to ensure that you meet specs. And third, you may have to deal with a situation in which there are many components contributing to the overall error budget by simply validating the performance of the overall circuit, subassembly, or complete instrument at final test.

This approach may appear cavalier. But the fact is that there are many situations in which you simply cannot meet challenging specifications while staying within the published worst-case specifications (or lack of specifications). Two examples help make this point: one of the authors designed and manufactured a line of batterypowered oceanographic instruments, intended for longduration (from weeks to as long as a year) submerged observations and data logging. A typical instrument might have 200 or more 4000B-series CMOS ICs. The datasheet lists the $25^{\circ} \mathrm{C}$ quiescent current ${ }^{9}$ as " $0.04 \mu \mathrm{~A}$ (typ), $10 \mu \mathrm{~A}$ (max)." Great. So 200 of these puppies probably draw a total of $8 \mu \mathrm{~A}$, but they could draw (in a wildly improbable scenario) as much as 2 mA . A year's worth of operation would require 70 mAh (using typical values), but, under strict worst-case rules, we would have to allow for 17.5 Ah (amp-hours). Here's the rub: the substantial battery pack for these volume-constrained deep submergeable pressure housings provided only 5 Ah of capacity (with some safety margin of derating). And $80 \%$ of the battery capacity was budgeted for the sensors and recorders. So strict worst-case design would require quadrupling the battery pack (and

[^222]expanding the pressure case), or, alternatively, removing a substantial volume of the instrumentation payload. The solution was (and still is) obvious: build the subcircuits, and test them for conforming quiescent current. They invariably worked just fine, and the testing served mostly to identify modules in which there was a defective component, usually caused by improper handling of the sensitive CMOS components.

A second example is a commercial instrument, namely a sensitive electrometer from Keithley. These things will measure currents down to femtoamps ( $10^{-15} \mathrm{~A}$ ), which requires a front-end stage of extraordinarily low bias current. They accomplish this with a JFET follower matched pair as input stage to a conventional precision op-amp, in a current-to-voltage configuration (the input is a summing junction, at zero volts). And to keep the gate current low, they operate the JFETs at a very low drain voltage of just +0.55 V , with the source terminal sitting just a fraction of a volt below the drain. Now, nowhere in the JFET datasheet will you find anything telling you what happens at such low voltages; and they won't tell you what the gate leakage is likely to be. You can throw up your hands and say that such an instrument cannot be made. Or you can do what Keithley did, which is to find a good source of JFETs and qualify them with in-house testing so that you can get on with the job.

Both examples illustrate that there are situations in which you simply cannot meet your design requirements while staying within the manufacturer's published worstcase specs. Having said that, we note that there are some engineers who will not deviate from strict worst-case specified component parameters in their circuit designs. They don't want to use special parts, and they won't touch such stuff with a 10 -foot (3m) pole. We invite you to choose what you would do.

## 5.4 Another example: precision amplifier with null offset

Having warmed up with the millivoltmeter, let's tackle a more complex design, one in which there are multiple error challenges. We describe the design choices and errors of this particular circuit within the framework of precision design in general, thus rendering painless what could otherwise become a tedious exercise.

We designed a precision amplifier (Figure 5.3) that lets you "freeze" the value of the input signal, amplifying any subsequent changes from that level by gains of exactly 1 , 10 , or 100 . This might come in particularly handy in an experiment in which you wish to measure a small change in
some quantity (e.g., light transmission or RF absorption) as some condition of the experiment is varied. It is ordinarily difficult to get accurate measurements of small changes in a large dc signal, owing to drifts and instabilities in the amplifier. In such a situation a circuit of extreme precision and stability is required.

Here we show the example of a strain gauge sensor, which consists of a strain-sensitive resistive bridge whose elements change resistance (slightly!) in response to mechanical strain. A common resistance value is $350 \Omega$; and the sensitivity is such that, when biased with +5 V , the differential output voltage across the bridge changes by $\pm 10 \mathrm{mV}$ in response to the rated full-scale mechanical strain. ${ }^{10}$ This small differential voltage sits on a dc level of +2.5 V , so you've got to begin with a good differential amplifier.

An important note at the outset: digital techniques offer an attractive alternative to the purely analog circuitry used here. A skilled designer would likely make use of precision analog/digital conversion techniques, perhaps in a hybrid implementation (in which a stable DAC is used to create the nulling signal within an analog circuit like ours), or perhaps in an all-digital scheme that relies on the intrinsic precision of a high resolution ADC alone. ${ }^{11}$ Regardless, our all-analog example offers a smorgasbord of important lessons in precision design. But the reader can confidently look forward to exciting revelations in chapters to come.

### 5.4.1 Circuit description

The front-end begins with an instrumentation amplifier $U_{1}$, a configuration of three op-amps that we'll talk about later (§5.15); these are differential-input amplifiers that excel in achieving high common-mode rejection, and allow gain selection with a single resistor (one or more are often provided internally). Here we've selected one with a good combination of low input current, offset drift, and noise, for reasons we'll explain later. Its gain of $\times 100$ is followed with a noninverting $\times 10$ gain stage $\left(U_{2}\right)$, for an overall gain of $\times 1000$; that produces a full-scale output of $\pm 10 \mathrm{~V}$ as input to the nulling circuitry $\left(U_{3}-U_{5}\right)$. If the input signal were single ended (e.g., from a thermocouple, photosensor, microwave absorption detector, or whatever), you would omit $U_{1}$, bringing in the signal at point " X ," and adjusting the gain of $U_{2}$ accordingly.

[^223]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0331.jpg?height=856&width=1621&top_left_y=220&top_left_x=133)

Figure 5.3. Autonulling dc laboratory amplifier. Gain-setting resistors are $0.1 \%$ tolerance.

The nulling circuitry works as follows: the amplifier stage $U_{3}$ is configured in the inverting configuration, permitting a dc offset according to a current added to the summing junction. Nulling takes place when relay (switch) $S_{3}$ is activated by a logic HIGH to coil driver $Q_{1}$ 's gate. Then $U_{4}$ charges the analog "memory" capacitor $\left(C_{1}\right)$ as necessary to maintain zero output. No attempt is made to follow rapidly changing signals, because in the sort of application for which this was designed the signals are essentially dc , and some averaging is a desirable feature. When the switch is opened, the voltage on the capacitor remains stable, resulting in an output signal from $U_{3}$ proportional to the wanderings of the input thereafter. The gain about the input null level can be increased in decade steps (switch $S_{2}$ ) to expand changes; the gain of the nulling integrator is switched accordingly to keep the feedback bandwidth constant. Switch $S_{1}$ selects the full-scale nulling range ( $100 \%$, $20 \%$, or none).

There are a few additional features that we should describe before going on to explain in detail the principles of precision design as applied here: (a) $U_{5}$, in addition to providing the needed inversion of the nulling level, participates in a first-order leakage-current compensation scheme: the tendency of $C_{1}$ to discharge slowly through its own leakage ( $\geq 100,000 \mathrm{M} \Omega$, corresponding to a time constant of $\geq 3$ days) is compensated by a small charging cur-
rent through $R_{10}$ proportional to the voltage across $C_{1}$; and (b) integrator $U_{4}$ was selected for very low input current $I_{\mathrm{B}}$ (to minimize droop during "hold"), for which the tradeoff is relatively poor offset voltage $V_{\mathrm{OS}}$; so we added an external offset trim $\left(R_{11}-R_{13}\right)$. This is not terribly critical, in any case, because an offset here merely causes a nonzero null of the same magnitude.

## 5.5 A precision-design error budget

For each category of circuit error and design strategy, we will devote a few paragraphs to a general discussion, followed by illustrations from the preceding circuit. Circuit errors can be divided into the categories of (a) errors in the external network components, (b) op-amp (or amplifier) errors associated with the input circuitry, and (c) opamp errors associated with the output circuitry. Examples of the three are resistor tolerances, input offset voltage, and errors that are due to finite slew rate, respectively.

Let's start by setting out our error budget. It is based on a desire to keep input drift (from temperature and powersupply variations) down to the $10 \mu \mathrm{~V}$ level, and nulled drift (primarily from capacitor "droop," along with temperature and supply variations) below $1 \mu \mathrm{~V} / \mathrm{min}$ (referred to the input, or RTI). As with any budget, the individual items are arrived at by a process of tradeoffs, based on what can be
done with available technology. In a sense the budget represents the end result of the design, rather than the starting point. However, it will aid our discussion to have it now.

It's important to understand that the items in such a budget come from several sources: (a) parameters that are specified in the datasheet; (b) estimates of poorly specified (or unspecified) parameters; and (c) parameters that you may not even realize are important. ${ }^{12}$ We might paraphrase these, respectively, as the knowns, the known unknowns, and the unknown unknowns.

### 5.5.1 Error budget

These are all in the form of worst-case voltage errors (at $25^{\circ} \mathrm{C}$ ) referred to the instrument input.

1. $\times 100$ Difference amplifier $\left(U_{1}:\right.$ LT1167A)

| Offset voltage | $40 \mu \mathrm{~V}$ |
| :--- | :--- |
| Noise voltage $(0.1-10 \mathrm{~Hz})$ | $0.28 \mu \mathrm{Vpp}($ typ -no "max" spec) |
| Temperature | $0.3 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ |
| Power supply | $28 \mathrm{nV} / 100 \mathrm{mV}$ change |
| Input offset current $\times R_{\mathrm{s}}$ | $0.11 \mu \mathrm{~V} / 350 \Omega$ of $R_{\mathrm{S}}$ |

2. $\times 10$ Gain amplifier $\left(U_{2}\right.$ : OPA277)

| Offset voltage | $0.5 \mu \mathrm{~V}$ |
| :--- | :--- |
| Temperature | $10 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ |
| Time | $2 \mathrm{nV} / \mathrm{month}$ (typ - no "max" spec) |
| Power supply | $1 \mathrm{nV} / 100 \mathrm{mV}$ change |
| Bias current | $0.3 \mu \mathrm{~V}$ |
| Load-current heating | 5 nV at full scale ( $5 \mathrm{~mW}, 0.1^{\circ} \mathrm{C} / \mathrm{mW}$ ) |

3. Output amplifier ( $U_{3}$ : OPA277)

| Offset voltage | 50 nV |
| :--- | :--- |
| Temperature | $1 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ |
| Time | $0.2 \mathrm{nV} /$ month (typ - no "max" spec) |
| Power supply | $0.1 \mathrm{nV} / 100 \mathrm{mV}$ change |
| Bias current | 30 nV |
| Load-current heating | 5 nV at full scale ( $1 \mathrm{k} \Omega$ load) |

12 We discovered an example of the latter while measuring femtoamp leakage currents in a nice shielded test enclosure: after the box had been opened to change anything inside, it took quite a while for the measurements to settle down. Turns out that the process of moving things caused some rearrangement of surface charge on the Tefloninsulated wires, with a long relaxation time. Pease talks about this in his article "What's All This Teflon Stuff, Anyhow?" - see the footnote references in $\S 5.10 .7$. We've experienced a similar bizarre manifestation with analog panel meters, where a swipe of the hand across the glass face can cause the needle to move way upscale. . . and stay there!
4. Hold amplifier ( $U_{4}:$ OPA129)

| $U_{4}$ offset tempco | $10 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ |
| :--- | :--- |
| Power supply | $10 \mathrm{nV} / 100 \mathrm{mV}$ change |
| Capacitor droop | $0.4 \mu \mathrm{~V} / \mathrm{min}$ |

(see current error budget)
Charge transfer $\quad 1.1 \mathrm{nV}$
Current errors through $C_{1}$ (needed for the preceding voltage error budget) are as follows:

Capacitor leakage
Maximum (uncompensated) ( 100 pA$)$
Typical (compensated) $\quad 10 \mathrm{pA}$
$U_{4}$ input current $\quad 0.25 \mathrm{pA}$
$U_{4}$ 's nulled $V_{\mathrm{OS}} / R_{10} \quad 0.1 \mathrm{pA}$
Relay $S_{3}$ OFF leakage $\quad 10 \mathrm{pA}(1 \mathrm{pA}$ typ)
Printed-circuit-board leakage 5.0 pA
Not bad, though you could complain about the $40 \mu \mathrm{~V}$ input offset - but we'd reply that a few tens of microvolts of static offset is of no concern in a nulling instrument, it's only the drift (with time and temperature) that matters. The various items in the budget will make sense as we discuss the choices faced in this particular design. We organize these by the categories of circuit errors listed earlier: network components, amplifier input errors, and amplifier output errors.

We'll address these errors quantitatively, in the context of Figure 5.3, beginning in $\S 5.7 .6$, after looking at error sources a bit more generally in the next section.

## 5.6 Component errors

The degrees of precision of reference voltages, current sources, amplifier gains, etc., all depend on the accuracy and stability of the resistors used in the external networks. Even where precision is not involved directly, component accuracy can have significant effects, e.g., in the commonmode rejection of a differential amplifier made from an opamp (see §§4.2.4 and 5.14), where the ratios of two pairs of resistors must be accurately matched. The accuracy and linearity of integrators and ramp generators depend on the properties of the capacitors used, as do the performances of filters, tuned circuits, etc. As we will see presently, there are places where component accuracy is crucial, and there are other places where the particular component value hardly matters at all.

Components are generally specified with an initial accuracy, as well as the changes in value with time (stability) and temperature. In addition, there are specifications of voltage coefficient (nonlinearity) and bizarre effects such as "memory" and dielectric absorption (for capacitors). Complete specifications also include the effects
of temperature cycling and soldering, shock and vibration, short-term overloads, and moisture, with well-defined conditions of measurement. In general, components of greater initial accuracy will have their other specifications correspondingly better, in order to provide an overall stability comparable to the initial accuracy. However, the overall error that is due to all other effects combined can exceed the initial accuracy specification. Beware!

As an example, RN55C 1\% tolerance metal-film resistors have the following specifications: temperature coefficient (tempco), $50 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ over the range $-55^{\circ} \mathrm{C}$ to $+175^{\circ} \mathrm{C}$; soldering, temperature, and load cycling, $0.25 \%$; shock and vibration, $0.1 \%$; moisture, $0.5 \%$. By way of comparison, the legacy 5\% carbon-composition resistors (Allen-Bradley type CB ) have these specifications: tempco, $3.3 \%$ over the range $25-85^{\circ} \mathrm{C}$; soldering and load cycling, $+4 \%,-6 \%$; shock and vibration, $\pm 2 \%$; moisture, $+6 \%$. From these specs it should be obvious why you can't just select (using an accurate digital ohmmeter) carbon resistors that happen to be within $1 \%$ of their marked value for use in a precise circuit, but are obliged to use $1 \%$ resistors (or better) designed for long-term stability as well as initial accuracy. For the utmost in precision it is necessary to use ultra-precise resistors or resistor arrays, such as Susumu's RG-series of SMT (surfacemount technology) resistors (tolerance to $0.02 \%$, tempco to $5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ ), Vishay's MPM-series metal-film networks (absolute tolerance to $0.05 \%$, matched to $0.01 \%$; absolute tempco to $25 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, matching tempco to $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ ), or their even better "Bulk Metal Foil" types (absolute tolerance to $0.005 \%$, matched to $0.001 \%$; absolute tempco to $0.2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, matching tempco to $0.1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ ).

### 5.6.1 Gain-setting resistors

In the preceding circuit (Figure 5.3), $0.1 \%$ resistors are used in the gain-setting network, $R_{1}-R_{4}$, for accurately predictable gain. As we'll see shortly, the value of $R_{3}$ is a compromise, with small values reducing offset current error in $U_{3}$ but increasing heating and thermal offsets in $U_{2}$. Note that $1 \%$ resistors are used in the offset attenuator network, $R_{5}-R_{13}$; here absolute accuracy is irrelevant, and the stability of $1 \%$ metal-film resistors is altogether adequate.

### 5.6.2 The holding capacitor

#### A. Leakage

The largest error term in this circuit, as the error budget shows, is capacitor leakage in the holding capacitor, $C_{1}$. Capacitors intended for low-leakage applications give a leakage specification, sometimes as a leakage resistance,
sometimes as a time constant (megohm-microfarads). In this circuit $C_{1}$ must have a value of at least a few microfarads in order to keep the charging rate from other current error terms small (see budget). In that range of capacitance, film capacitors (polystyrene, polypropylene, and polyester) have the lowest leakage. Polypropylene capacitors (from manufacturers such as Epcos, Kemet, Panasonic, Vishay, and Wima, generally with voltage ratings of $200-600 \mathrm{~V}$ ) often have dc leakage specified in units of megohm-microfarads, with values in the range of 10,000$100,000 \mathrm{M} \Omega \mu \mathrm{F}$; thus for a capacitance of $2.2 \mu \mathrm{~F}$ this amounts to a parallel equivalent leakage resistance of at least 4.5-45 G $\Omega$.

Even so, and adopting a plausible value of, say, $100 \mathrm{G} \Omega$, that's equivalent to a leakage current of 100 pA at full output $(10 \mathrm{~V})$, corresponding to droop rates of roughly $3 \mathrm{mV} / \mathrm{min}$ at the output, the largest error term by far. For that reason we added the leakage-cancellation scheme described earlier. It is fair to assume that the effective leakage can be reduced to $10 \%$ of the capacitor's worst-case leakage specification (in practice, we can probably do much better). No great stability is required in the cancellation circuit, given the modest demands made of it. As we will see later when we discuss voltage offsets, $R_{10}$ is kept intentionally large so that input voltage offsets in $U_{4}$ aren't converted to a significant current error.

#### B. Dielectric absorption

We're not done with the capacitor, yet. An important effect, quite apart from resistive leakage, is capacitor "memory," officially known as dielectric absorption. ${ }^{13}$ This is the tendency of capacitors to return, to some extent, to a previous state of charge, as shown in the measured data of Figure 5.4 (each capacitor was held at +10 V for a day or more, then discharged to 0 V for 10 s , then open-circuited and observed while it did its thing); see also the discussion in §§1x.3, 4.5.1, 4.5.6, and 13.8.4.

### 5.6.3 Nulling switch

In the previous edition of this book, the analogous circuit (Figure 7.1, page 393) used MOSFETs (instead of relay $S_{3}$ ) to activate the nulling circuit. That choice provided plenty of education, because we had to worry about (a) MOSFET channel leakage, devastatingly large at about $\sim 1 \mathrm{nA}$, and (b) gate charge injection, of order 100 pC in that circuit. The solutions there were (a) the use of a series-connected

[^224]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0334.jpg?height=751&width=1685&top_left_y=206&top_left_x=201)

Figure 5.4. Capacitors exhibit memory effect (dielectric absorption), a tendency to return to a previous state of charge. This is highly unhelpful in applications (such as analog sample-and-hold) in which a capacitor is used to retain an analog voltage. A. linear plot, showing the basic effect; B. log-log plot, revealing four decades of dirty laundry. Teflon is the uncontested winner; but it's hard to find, so the plastic film types (PS and PP) are generally your best choice. Ceramic COG can be excellent, but beware brand variations.

MOSFET pair, such that the downstream MOSFET had all four terminals (source, drain, gate, and substrate) ordinarily at zero volts, and (b) a sufficiently large holding capacitor such that the error was negligible, along with the observation that charge transfer was not of great concern because it resulted in a small offset of the auto-zero.

This time we have taken a more pragmatic (but less educational) approach, by using instead a small signal relay. The Coto $9202-12$ is a small ( $4 \mathrm{~mm} \times 6 \mathrm{~mm} \times 18 \mathrm{~mm}$ ) shielded relay, energized by 12 Vdc at 18 mA , with a specified OFF resistance of $10^{12} \Omega$ minimum ( $10^{13} \Omega$ typical). The worst-case $R_{\text {off }}$ value corresponds to a droop rate of $0.3 \mathrm{mV} / \mathrm{min}$, but ten times less for "typical" $R_{\text {off }}$. Relays isolate better than transistor switches (higher $R_{\text {off }}$ and lower $C_{\text {off }}$, here $<1 \mathrm{pF}$ ), and they have better on performance as well (lower $R_{\text {on }}$ than a low-capacitance analog switch, here $<0.15 \Omega$ ).

Of course, there is capacitance between the coil and the contacts, and thus an opportunity for the same sort of charge transfer as with a MOSFET switch (where the full-swing transitions at the gate couple capacitively to the drain and source). As we remarked in Chapter 3 (§3.4.2E), the total charge transferred is independent of the transition time and depends only on the total control-voltage swing and the coupling capacitance: $\Delta Q=C_{\text {coup }} \Delta V_{\text {control }}$. In this circuit, charge transfer results in a simple voltage error of the auto-zero, because the charge is converted to a volt-
age in the holding capacitor $C_{1}$. It's easy to estimate the error: the Coto relay specifies a coil-to-contact capacitance of 0.2 pF (for our grounded-shield configuration), and thus a corresponding charge transfer of $\Delta Q=2.4 \mathrm{pC}$ when the 12 V coil is energized. ${ }^{14}$ That produces a voltage step of $\Delta V_{\mathrm{C}}=\Delta Q / C_{1}=1.1 \mu \mathrm{~V}$ across the $2.2 \mu \mathrm{~F}$ capacitor $C_{1}$. This is completely within our error budget; in fact, we've likely overestimated the effect, because our calculation assumed that the entire coil undertook a 12 V step, whereas the average step is half that value.

For readers who harbor a deep-seated dislike of mechanical relays, we show in Figure 5.5 a switch implementation with series-connected JFETs. During HOLD the JFET gates are back-biased to -5 V , by the somewhat tortured level-shifting circuit $Q_{1}-Q_{4}$. The reader is invited to estimate the magnitude of droop (use the datasheet's $I_{\mathrm{D}(\mathrm{off})}=0.1 \mathrm{pA}$ ) and of charge injection (use the datasheet's $C_{\mathrm{rss}}=0.3 \mathrm{pF}$ ) for this circuit.

## 5.7 Amplifier input errors

The deviations of op-amp input characteristics from the ideal that we discussed in Chapter 4 (finite values of input impedance and input current, voltage offset, commonmode rejection ratio, and power-supply rejection ratio, and

[^225]Table 5.2 Representative Precision Op-amps

| ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0335.jpg?height=73&width=42&top_left_y=295&top_left_x=304) | Supply ${ }^{p}$ |  | Input Current@25º C |  | Offset Voltage |  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0335.jpg?height=155&width=64&top_left_y=280&top_left_x=931) | $e_{n}$ <br> @1kHz <br> typ <br> (nV/ $\sqrt{ } \mathrm{Hz}$ ) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0335.jpg?height=100&width=93&top_left_y=335&top_left_x=1079) | Slew typ <br> (V/ $/ \mathrm{s}$ ) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0335.jpg?height=134&width=195&top_left_y=305&top_left_x=1242) | Cost qty 25 <br> (\$US) |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# $\stackrel{\text { \% }}{\text { \% }}$ | Range <br> (V) | $\begin{gathered} \mathrm{I}_{\mathrm{Q}} \\ (\mathrm{~mA}) \end{gathered}$ | $\begin{gathered} \hline \text { typ } \\ \text { (pA) } \end{gathered}$ | $\begin{aligned} & \max \\ & (\mathrm{pA}) \end{aligned}$ | $\begin{aligned} & \hline \text { typ } \\ & (\mu \mathrm{V}) \end{aligned}$ | $\begin{gathered} \max \\ (\mu \mathrm{V}) \end{gathered}$ | typ <br> $\left(\mu \mathrm{V} /{ }^{\circ} \mathrm{C}\right)$ |  |  |  |  |  |  | Comments |
| bipolar |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LT1077A 1 | 2.2-44 | 0.05 | 7nA | $9 n A$ | 9 | 40 | 0.4 | 97 | 27 | 0.23 | 0.08 | - | 3.84 | single-supply |
| LT1013 2,4 | 3.4-44 | 0.35 | 12nA | 20 nA | 40 | 150 | 0.4 | 100 | 22 | 0.7 | 0.4 | - $\cdot$ - $\cdot$ - $\cdot$ | 3.13 | single-supply |
| OPA277P 1,2,4 | 4-36 | 0.79 | $0.5 n A$ | 1nA | 10 | 20 | 0.1 | 130 | 8 | 1 | 0.8 | - - - - $\cdot$ | 3.17 | improved OP-27 |
| LT1012AC 1 | 8-40 | 0.37 | 25pA | 0.1 nA | 8 | 25 | 0.2 | 114 | 14 | 0.5 | 0.2 | - - - - $\cdot$ | 5.11 | superbeta, comp |
| LT1677 1 | 3-44 | 2.8 | 2nA | 20nA | 20 | 60 | 0.4 | 109 | 3.2 | 7.2 | 2.5 | $\cdot$ | 3.07 | or AD8675, 0.5nA |
| $\begin{aligned} & \text { LT1468 } 1 \\ & \text { JFET } \end{aligned}$ | 7-36 | 3.9 | 3nA | 10nA | 30 | 75 | 0.7 | 96 | 5 | 90 | 23 | $\cdot$ | 4.26 | 0.7ppm distortion |
| LF412A ${ }^{\text {b }}$ 1,2 | 12-44 | 1.8 | 50 | 200 | 500 | 1000 | - | 80 | 25 | 4 | 15 | - - - - - $\cdot$ | 4.47 | '411A Vos $<0.5 \mathrm{mV}$ |
| $\begin{gathered} \text { OPA827 } \\ \text { CMOS } \end{gathered}$ | 8-40 | 4.8 | 15 | 50 | 75 | 150 | 1.5 | 104 | 3.8 | 22 | 28 | - - - - - - | 9.00 | $0.1-10 \mathrm{~Hz}: 0.25 \mu \mathrm{Vpp}$ |
| LMC6482A ${ }^{\text {b }}$ 2,4 | 3-16 | 0.5 | 0.02 | 4 | 110 | 750 | 1 | 70 | 37 | 1.5 | 1.3 | $\cdot$ $\cdot$ $\cdot$ | 1.88 | LMC7101 = SOT23 |
| MAX4236A 1 | 2.4-6 | 0.35 | 1 | 500 | 5 | 20 | 0.6 | 84 | 14 | 1.7 | 0.3 | - $\cdot$ $\cdot$ - - | 1.78 | shdn, '37 decomp |
| OPA376 1,2,4 auto-zero | 2.2-7 | 0.76 | 0.2 | 10 | 5 | 25 | 0.26 | 76 | 7.5 | 5.5 | 2 | $\cdot$ $\cdot$ $\cdot$ - | 1.32 | etrim |
| AD8628 1,2,4 | 2.7-6 | 0.85 | 30 | 100 | 1 | 5 | 0.002 | 120 | 22 | 2.5 | 1 | - $\cdot$ $\cdot$ - - | 1.92 | SOIC-8, SOT23-5 |

Notes: (a) boldface indicated number in a package for the part \# listed. (b) not precision, listed for comparison. (p) IQ, typical, per amplifier.
their drifts with time and temperature) generally constitute serious obstacles to precision circuit design, and they force trade-offs in circuit configuration, component selection, and the choice of a particular op-amp. The point is best made with examples, as we will do shortly. Note that these errors, or their analogs, exist for amplifiers of discrete design as well.

While reading through the following discussion, you may find it helpful to refer to Tables 5.2 and 5.3 where we list ten favorite precision op-amps (plus two inexpensive and not-precision comparees). Those listings add quantitative flesh to a somewhat abstract set of bony teachings.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0335.jpg?height=559&width=776&top_left_y=1690&top_left_x=135)

Figure 5.5. Electronic switch replacement of mechanical relay $S_{3}$ in Figure 5.3. A lot of work, and no improvement in performance.

### 5.7.1 Input impedance

Let's discuss briefly the error terms just listed. The effect of finite input impedance is to form voltage dividers in combination with the source impedance driving the amplifier, reducing the gain from the calculated value. Most often this isn't a problem, because the input impedance is bootstrapped by feedback, raising its value enormously. As an example, the OPA277P precision op-amp (with BJT-input, not FET-input stage) has a typical "differential-mode input impedance," of $100 \mathrm{M} \Omega$. In a circuit with plenty of loop gain, feedback raises the input impedance to the datasheet's "common-mode input impedance" $250,000 \mathrm{M} \Omega$. If that's not good enough, FET-input op-amps have astronomical values of $R_{\text {in }}$, for example $10^{13} \Omega$ (differential) and $10^{15} \Omega$ (common-mode) for the OPA129 that's used in this circuit.

### 5.7.2 Input bias current

More serious is the input bias current. Here we're talking about currents measured in nanoamps, and this already produces voltage errors of microvolts for source impedances as small as $1 \mathrm{k} \Omega$. Again, FET op-amps come to the rescue, but with generally increased voltage offsets as part of the bargain. Bipolar superbeta op-amps such as the LT1012 can also have surprisingly low input currents. As an example, compare the OPA277 precision bipolar op-amp with the LT1012 (bipolar, optimized for low bias current), the OPA124 (JFET, precision and low bias), the OPA129 (ultra-low-bias JFET), and the LMC6001 (CMOS, lowestbias op-amp); these are some of the best you can get at the

| Part \# | Nine Low-input-current Op-amps |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | Supply |  | Input current$\qquad$ |  | $V_{\mathrm{os}}$ <br> max <br> ( $\mu \mathrm{V}$ ) | TCV |  |
|  | $V_{\text {total }}$ <br> (V) | $\begin{gathered} I_{Q} \\ (\mu \mathrm{~A}) \end{gathered}$ | $\begin{aligned} & \text { typ } \\ & \text { (pA) } \end{aligned}$ | max <br> (pA) |  | $\begin{gathered} \text { typ } \\ \left(\mu \vee /{ }^{\circ} \mathrm{C}\right) \end{gathered}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0336.jpg?height=70&width=92&top_left_y=323&top_left_x=915) |
| bipolar |  |  |  |  |  |  |  |
| OPA277P | 10-36 | 790 | 500 | 1000 | 20 | 0.1 | 0.15 |
| superbeta |  |  |  |  |  |  |  |
| LT1012AC | 8-40 | 370 | 25 | 100 | 25 | 0.2 | 0.6 |
| AD706 | 4-36 | 750 | 50 | 200 | 100 | 0.2 | 1.5 |
| JFET |  |  |  |  |  |  |  |
| OPA124PB | 10-36 | 2500 | 0.35 | 1 | 250 | 1 | 2 |
| OPA129B | 10-36 | 1200 | 0.03 | 0.1 | 2000 | 3 | 10 |
| MOSFET |  |  |  |  |  |  |  |
| MAX9945 | 4.8-40 | 400 | 0.05 | - | 5000 | 2 | - |
| CMOS, Iow-voltage |  |  |  |  |  |  |  |
| LMP7721 | 1.8-6 | 1300 | 0.003 | 0.02 | 150 | 1.5 | 4 |
| LMC6001A | 5-16 | 450 | 0.01 | 0.025 | 350 | 2.5 | 10 |
| ADA4530-1 | 4.5-16 | 900 | <0.001 | 0.02 | 50 | 0.13 | 0.5 |

time of writing, and we've chosen the best grade of each one (Table 5.3; and see also Table 5.5 on pages 320-321 for greater detail, along with a wider selection of precision op-amps with low offset voltage; as well as relevant tables in Chapter 4x).

Well-designed FET amplifiers have extremely low bias currents, but with much larger offset voltages, compared with the precision OPA277. Because the offset voltage can always be trimmed, what matters more is the drift with temperature. In this case the FET amplifiers are 4 to 20 times worse. The op-amp with the lowest input current uses MOSFETs for the input stage. MOSFET op-amps are popular because of the proliferation of inexpensive units like TI's TLC270 series, as well as the ultra-low-bias-current devices like National's LMC6000-series parts. However, in contrast to JFETs or bipolar transistors, MOSFETs can have very large drifts of offset voltage with time, an effect that is discussed below. So the improvement in current errors you buy with a FET op-amp can be wiped out by the larger voltage error terms. With any circuit in which bias current can contribute significant error, it is often wise to ensure that both op-amp input terminals see the same dc source resistance (see, e.g., Figure 4.55); then the op-amp's offset current becomes the relevant specification. But be aware that a number of precision op-amps use a "biascompensation" scheme to cancel (approximately) the input current in order to make that error term smaller (look back at Exercise 2.24 on page 125 to see how it's done). With op-amps of this type you generally don't gain anything by matching the dc resistances seen by the two inputs, as the residual bias current and the offset current are comparable, in a bias-compensated op-amp.

#### A. Variation with temperature

One additional point to keep in mind when using FET-input op-amps is that the input "bias" current is actually gate
leakage current, and it rises dramatically with increasing temperature: it roughly doubles for every $10^{\circ} \mathrm{C}$ increase in chip temperature, as seen in Figure 5.6. Because FET opamps often run warm (our jellybean LF412, for example, dissipates 100 mW when run from $\pm 15 \mathrm{~V}$ supplies), the actual input current may be considerably higher than the $25^{\circ} \mathrm{C}$ figures you see on the datasheet. ${ }^{15}$ By contrast, the input current of a BJT-input op-amp is actual base current, relatively constant with temperature. So a FET-input opamp with impressive input-current specs on paper may not give such an improvement over a good superbeta bipolar unit. As the graph shows, for example, the LT1057 JFETinput op-amp with its $\sim 3 \mathrm{pA}$ input current (at $25^{\circ} \mathrm{C}$ ) will have an input current of about 100 pA at $75^{\circ} \mathrm{C}$ chip temperature, which is higher than the input current of the superbeta LT1012 at the same temperature. And our jellybean LF412 JFET op-amp has an input current that is comparable to that of the LT1012 at $25^{\circ} \mathrm{C}$ and many times higher at elevated temperatures.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0336.jpg?height=705&width=812&top_left_y=1033&top_left_x=1066)

Figure 5.6. Op-amp input current versus temperature, plotted from datasheet values. See also Figures 5.38 and 3.48. JFET-input opamps are indicated in plain ("roman") type, BJT op-amps are italic, CMOS op-amps are bold, and auto-zero op-amps are bold slant.

[^226]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0337.jpg?height=940&width=1276&top_left_y=214&top_left_x=311)

Figure 5.7. Op-amp input current (at $25^{\circ} \mathrm{C}$ ) versus common-mode input voltage, plotted over their operating range from datasheet values; BJT op-amps with rail-to-rail input stages ("BJT RR-input") undergo an abrupt reversal of input-current polarity.

#### B. Variation with common-mode input voltage

Finally, a very important caution: when comparing op-amp input currents, watch out for some op-amp designs whose $I_{\mathrm{B}}$ depends on the input voltage. This behavior is common in op-amps that are designed to operate over a rail-to-rail input (RRI) range, both FET-input and (especially) BJTinput types. The spec sheet usually lists $I_{\mathrm{B}}$ only at zero volts (or mid-supply), but a good datasheet will show curves as well. See Figure 5.7 for some typical $I_{\mathrm{B}}$ versus $V_{\text {in }}$ behavior. The good performance of the OPA129 and OPA627 in this regard is due in part to their use of cascode input stages. The LMP7721 stands out not only for its 20 fA maximum input current, but for its prize-winning trajectory on this graph.

### 5.7.3 Voltage offset

Voltage offsets at the amplifier input are obvious sources of error. Op-amps differ widely in this parameter, ranging from "precision" op-amps offering worst-case $V_{\text {OS }}$ values generally in the 10s of microvolts to ordinary jellybean opamps like the LF412 with $V_{\text {OS }}$ values of $2-5 \mathrm{mV}$. At the time of writing, ${ }^{16}$ the champion (by a slim margin) in the

[^227](nonchopper, see below) world of low offsets is the bipolar OPA277P ( $\pm 20 \mu \mathrm{~V}$, max ), which, astonishingly, is equaled by the CMOS MAX4236A (though the latter's drift is $12 \times$ worse, as one might expect).

Although many good single op-amps (but not duals or quads) have offset-adjustment terminals, it is still wise to choose an amplifier with inherently low initial offset $V_{\text {OS }}$ max, for several reasons. First, op-amps designed for low initial offset tend to have correspondingly low offset drift with temperature and with time. Second, a sufficiently precise op-amp eliminates the need for external trimming components (a trimmer takes up space, needs to be adjusted initially, and may change with time). Third, offset voltage drift and common-mode rejection are degraded by the unbalance caused by an offset-adjustment trimmer.

Figure 5.8 illustrates how a trimmed offset has larger drifts with temperature. It shows also how the offset adjustment is spread over the trimmer pot rotation, with best

[^228]resolution near the center, especially for large values of trimmer resistance. Finally, you'll generally find that the recommended external trimming network provides far too much range, making it nearly impossible to trim $V_{\text {OS }}$ down to a few microvolts; even if you succeed, the adjustment is so critical it won't stay trimmed for long. Another way to think about it is to realize that the manufacturer of a precision op-amp has already trimmed the offset voltage, in a custom test jig using "laser-zapping" techniques; you may be unable to do any better yourself. Our advice is (a) to use precision op-amps for precision circuits, and (b) if you must trim them further, arrange a narrow-range trim circuit similar that shown in Figure 5.3, with values adjusted to produce a full-scale range of $\pm 50 \mu \mathrm{~V}$, linear in trimmer rotation (e.g., $R_{11}=33 \Omega$ and $R_{12}=10 \mathrm{M}$ ). Figure 5.9 shows how to arrange narrow-range external offset trims for both inverting and noninverting amplifier configurations.

Because voltage offsets can be trimmed to zero, what ultimately matters is the drift of offset voltage with time, temperature, and power-supply voltage. Designers of precision op-amps work hard to minimize these errors. You get the best performance from bipolar-input (as opposed to FET) op-amps in this regard, but input-current effects may then dominate the error budget. As shown in Table 5.2 on page 302 the best op-amps keep drifts below $1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$; the OPA277P typifies the best drift specification (for a nonchopper op-amp): $\Delta V_{\mathrm{OS}}=0.2 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$, max.

Another factor to keep in mind is the drift caused by self-heating of the op-amp when it drives a low-impedance load. It is often necessary to keep the load impedance above 10k to prevent large errors from this effect. As usual, that may compromise the next stage's error budget from the effects of bias current! We'll see just such a problem in
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0338.jpg?height=529&width=797&top_left_y=1669&top_left_x=219)

Figure 5.8. Typical op-amp offset versus offset-adjustment potentiometer rotation for several temperatures.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0338.jpg?height=537&width=407&top_left_y=219&top_left_x=1077)
A. Inverting
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0338.jpg?height=532&width=430&top_left_y=221&top_left_x=1484)
B. Non-inverting

Figure 5.9. Narrow-range external trimming networks for precision op-amps.
this design example. For applications in which drifts of a few microvolts are important, the related effects of thermal gradients (from nearby heat-producing components) and thermal emf's (from voltages across junctions of dissimilar metals) become important. This will come up again when we discuss the ultraprecise chopper-stabilized amplifier in §5.11.

An important caution: when datasheets specify the particular measurement conditions for a parameter like $V_{\mathrm{OS}}$, they mean it! A sobering example is shown in Figure 5.10, a plot of $V_{\mathrm{OS}}$ versus $V_{\mathrm{CM}}$ for the AD8615 op-amp, whose datasheet declares (on the front page) "Low offset voltage: $65 \mu \mathrm{~V}$ max," but whose tabular data reveal that the measurement conditions are " $V_{\mathrm{CM}}=0.5 \mathrm{~V}$ and 3.0 V ."

### 5.7.4 Common-mode rejection

Insufficient common-mode rejection ratio (CMRR) degrades circuit precision by effectively introducing a voltage offset as a function of dc level at the input. This effect is usually negligible, because it is equivalent to a small gain change, and in any case it can be overcome by choice of configuration: an inverting amplifier is insensitive to op-amp CMRR, in contrast with a noninverting amplifier. However, in "instrumentation amplifier" applications you are looking at a small differential signal riding on a large dc offset, and a high CMRR is essential. In such cases you have to be careful about circuit configurations and, in addition, you must choose an op-amp with a highCMRR specification. Once again, a superior op-amp like the OPA277 can solve your problems, with a CMRR (min)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0339.jpg?height=554&width=773&top_left_y=218&top_left_x=139)

Figure 5.10. This op-amp specifies a maximum offset voltage of $\pm 60 \mu \mathrm{~V}$. But it also specifies the following conditions: $V_{\mathrm{s}}=3.5 \mathrm{~V}$, and $V_{\mathrm{CM}}=0.5 \mathrm{~V}$ or 3.0 V . Moral: don't ignore the footnotes!
at dc of 130 dB , compared with our jellybean LF411's meager specification of 70 dB . We discuss high-gain differential and instrumentation amplifiers later in the chapter, beginning at §5.13.

### 5.7.5 Power-supply rejection

Changes in power-supply voltage cause small op-amp errors. As with most op-amp specifications, the power-supply rejection ratio (PSRR) is referred to a signal at the input. For example, the OPA277 has a specified PSRR of 126 dB at dc, meaning that a 1 volt change in one of the powersupply voltages causes a change at the output equivalent to a change in the differential input signal of $0.5 \mu \mathrm{~V}$.

The PSRR drops with increasing frequency, approximately tracking the behavior of the open-loop gain, and a graph documenting this scurrilous behavior is often given on the datasheet. For example, the PSRR (relative to the negative rail) of our favorite OPA277 begins dropping at 1 Hz and is down to 95 dB (typ) at 60 Hz and 50 dB at 10 kHz . This rarely presents a problem, because powersupply noise is also decreasing at higher frequencies if you have used good bypassing. However, 120 Hz ripple could present a problem if an unregulated supply is used.

It is worth noting that the PSRR will not, in general, be the same for the positive and negative supplies. Thus the use of dual-tracking regulators doesn't necessarily bring any benefits. Note also that PSRR is often specified for $G=1$, and can be considerably worse at higher gains; in fact, op-amps have been found that exhibit gain (!) from one rail to the output at moderate gain settings.

### 5.7.6 Nulling amplifier: input errors

Now we're ready to embark on a detailed discussion of the most serious error issues in the amplifier of Figure 5.3. The circuit begins with an optional precision instrumentation amplifier front-end $U_{1}$ (more in §5.15), here chosen for its stable and accurate differential gain of $100 \times$, low input current, and adequately low noise $(9 n V / \sqrt{\mathrm{Hz}}$ typ at 10 Hz ). Its worst-case offset voltage and tempco ( $\pm 40 \mu \mathrm{~V}$, $0.3 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ ) specs are a factor of two worse than a precision op-amp like the OPA277 (in the best grade), but its 120 dB (min) CMRR as a difference amplifier, combined with $0.08 \%$ worst-case gain accuracy, $50 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max) gain tempco, and low-voltage noise, make it a good frontend for a low-level bridge application like this. Although not important with the low source impedance in this example, its input current is satisfyingly low for a BJT-input amplifier, at just 0.35 nA max. ${ }^{17}$

For single-ended inputs $U_{1}$ is omitted, and the signal is brought in at point " $\times$ " (add a $470 \Omega$ series resistor, with a pair of low-leakage clamp diodes - see Figure 5.2 - to the rails, for overdrive protection). The OPA277's accuracy and stability rule here, though it is tempting to consider substituting a FET-input part; but the $\gtrsim 10 \times$ poorer $V_{\text {OS }}$ tempco specification more than offsets the advantage of low input current, except with sources of very high impedance. The OPA277's 1 nA (max) bias current gives an error of $1 \mu \mathrm{~V} / 1 \mathrm{k} \Omega$ source impedance, whereas the best-in-class JFET OPA627B (at \$35 apiece!), though providing negligible current error with its 5 pA (max) input current, would exhibit voltage offset drifts as large as $3 \mu \mathrm{~V} / 4^{\circ} \mathrm{C}$ $\left(4^{\circ} \mathrm{C}\right.$ is considered a typical laboratory ambient temperature range of variation). In this circuit one could happily add an offset trim to $U_{2}$, preferably in the manner of Figure 5.9. As mentioned earlier, feedback bootstraps the input impedance to $250 \mathrm{G} \Omega$ and eliminates any gain errors from finite source impedance, up to $25 \mathrm{M} \Omega$ (for a gain error less than $0.01 \%$ ).
$U_{2}$ drives an inverting amplifier $\left(U_{3}\right)$, with $R_{3}$ chosen as a compromise between heat-produced thermal offsets in $U_{2}$ and bias-current offset errors in $U_{3}$. The value chosen keeps heating down to 5 mW (at 7.5 V output, the worst case), which works out to a temperature rise of $0.8^{\circ} \mathrm{C}$ (the op-amp has a thermal resistance $R_{\Theta \text { JA }}$ of about $0.15^{\circ} \mathrm{C} / \mathrm{mW}$, see $\S 9.4$ ), with a consequent maximum voltage offset of $\Delta V_{\mathrm{OS}}=T C V_{\mathrm{OS}} \Delta T=0.12 \mu \mathrm{~V}$. The $11 \mathrm{k} \Omega$

[^229]source impedance seen by $U_{3}$ results in an error due to biascurrent offset, but, with $U_{3}$ inside a feedback loop with $U_{4}$ and $U_{5}$ trimming the overall offset to zero, all that matters is the drift in the current error term. The OPA277 provides a graph of typical bias-current change with temperature (not often specified by manufacturers), from which the error result of $0.2 \mu \mathrm{~V} / 4^{\circ} \mathrm{C}$ in the error budget is calculated. Reducing the value of $R_{3}$ would improve this term, at the expense of the heating term in $U_{2}$.

The dc input impedance of $U_{3}$ comes closer to presenting a problem. To estimate the error, we compare $U_{3}$ 's differential input impedance of $100 \mathrm{M} \Omega$ with the worst-case (i.e., with gain set for $\times 100$ ) impedance seen driving its input. The latter is just the feedback resistance (1M) divided by the loop gain $G_{\mathrm{OL}} / G_{\mathrm{CL}}$, thus $10 \Omega$. So the worst-case loading effect is 1 part in $10^{7}$, three orders of magnitude less than $0.01 \%$ error. This is one of the toughest examples we could think of, and even so the op-amp input impedance presents no problem, thus demonstrating that, in general, you can ignore the effects of op-amp input impedances.

Drifts in offset voltage in both $U_{2}$ and $U_{3}$ over time, temperature, and power-supply variations affect the final error equally and are tabulated in the budget. It is worth pointing out that they are all automatically cancelled at each "zeroing" cycle, and only short-term drifts matter anyway. These errors are all in the microvolt range, thanks to a good choice of op-amp. $U_{4}$ has larger drifts, but it must be a FET type to keep capacitor current small, as already explained. Note that errors in $U_{4}$ 's output are amplified by the gain setting of $U_{3}$; thus they are specified as input errors in the budget.

Note the general philosophy of design that emerges from this example: you work at the problem areas, choosing configurations and components as necessary to reduce errors to acceptable values. Tradeoffs and compromises are involved, with some choices depending on external factors (e.g., the use of a FET-input op-amp for $U_{2}$ would be preferable for source impedances greater than about $10 \mathrm{k} \Omega$ ).

## 5.8 Amplifier output errors

As we discussed in Chapter 4, op-amps have some serious limitations associated with the output stage. Limited slew rate, output crossover distortion ( $\$ 2.4 .1 \mathrm{~A}$ ), and finite openloop output impedance can all cause trouble, and they can cause precision circuits to display astoundingly large errors if not taken into account.

### 5.8.1 Slew rate: general considerations

As we mentioned in §4.4.1K, an op-amp can swing its output voltage only at some maximum rate. This effect originates in the frequency-compensation circuitry of the opamp, as we will soon explain in a bit more detail. One consequence of a finite slew rate is to limit the output swing at high frequencies to a maximum of $V \mathrm{pp}=S / \pi f$, as shown in §4.4.2 and plotted here in Figure 5.11.

A second consequence is best explained with the help of a graph of slew rate versus differential-input signal (Figure 5.12). The point to be made here is that a circuit that demands a substantial slew rate must operate with a substantial voltage error across the op-amp's input terminals. This can be disastrous for a circuit that pretends to be highly precise: the feedback loop is in error, more so as the output slews more rapidly, thus producing a distorted output waveform. (Look ahead at the measured distortion plots in Figure 5.19 on page 311 to see this effect, for example in the LT 1013 for which $S=0.8 \mathrm{~V} / \mu \mathrm{s}$.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0340.jpg?height=580&width=805&top_left_y=1052&top_left_x=1067)

Figure 5.11. Maximum output swing versus frequency.
Let's look at the innards of an op-amp in order to get some understanding of the origin of slew rate (see $\S 4 x .9$ for a more extensive discussion). The vast majority of opamps can be summarized with the notional "Widlar circuit" shown in Figure 5.13. A differential input stage, ${ }^{18}$ loaded with a current mirror, drives a stage of large voltage gain with a compensation capacitor from output to input. The output stage is a unity-gain push-pull follower. The compensation capacitor $C$ is chosen to bring the open-loop gain of the amplifier down to unity before the phase shifts

[^230]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0341.jpg?height=568&width=794&top_left_y=221&top_left_x=121)

Figure 5.12. A substantial differential-input voltage is required to produce the full op-amp slew rate, as shown in these measured data. For BJT-input op-amps it takes $\sim 60 \mathrm{mV}$ to reach full slew rate; for JFETs and MOSFETs it's more like a volt.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0341.jpg?height=821&width=798&top_left_y=990&top_left_x=147)

Figure 5.13. Typical op-amp internal compensation scheme.
caused by the other amplifier stages have become significant. That is, $C$ is chosen to put $f_{\mathrm{T}}$, the unity-gain bandwidth, near the frequency of the next amplifier rolloff pole, as described in $\S 4.9$. The input stage has very high output impedance, and it looks like a current source to the next stage.

The op-amp is slew-rate limited when the input signal drives one of the differential-stage transistors nearly to cutoff, driving the second stage with the total emitter current
$I_{\mathrm{E}}$ of the differential pair. For a BJT input stage this occurs with a differential input voltage of about 60 mV , at which point the ratio of currents in the differential stage is $10: 1$. At this point $Q_{5}$ is slewing its collector as rapidly as possible, with all of $I_{\mathrm{E}}$ going into charging $C$. The transistor $Q_{5}$ and $C$ thus form an integrator, with a slew-rate-limited ramp as output. It's not hard to derive an expression for the slew rate, knowing how bipolar transistors work - see the discussion in $\S 4 x .9$. The bottom line is that the classic BJTinput op-amp circuit of Figure 5.13 has a slew rate $S$ given by $S \approx 0.3 f_{\mathrm{T}}$.

To get a higher slew rate, then, you can choose an opamp with greater bandwidth $f_{\mathrm{T}}$; if you are operating at closed-loop gains greater than unity, you can use a decompensated op-amp (with its higher $f_{\mathrm{T}}$ value). But there are ways (as explained in $\S 4 x .9$ ) to beat the limit $S \approx 0.3 f_{\mathrm{T}}$ (which assumed a unity-gain-compensated op-amp with a BJT differential input configured for maximum gain, i.e., with $R_{\mathrm{E}}=0$ ). Namely: (a) use an op-amp with reduced input-stage transconductance (either a FET-input op-amp or a BJT-input op-amp with emitter degeneration); (b) use an op-amp with a different input-stage circuit, specifically designed for enhanced slew rate - examples are the "crosscoupled transconductance reduction" technique (used in the TLE2142 family; see the cross-coupled input stage circuit shown in $\S 4 x .9$ ), and the Butler "wide dynamic range transconductance stage" (used for example in the OP275 and OP285; see the Butler input stage circuit in $\S 4 x .9$ ); (c) use a current-feedback (CFB) op-amp, or a CFB variant (with a buffered inverting input) that mimics an ordinary voltage-feedback (VFB) op-amp.

These tricks work. If we define an enhancement factor $m$ (i.e., $S=0.3 m f_{\mathrm{T}}$ ), the LF411 (with JFET input) plotted in Figure 5.12 has $m=12$, compared with the bipolar LT1007 ( $m=1.0$ ); the TLE2141 (with cross-coupled BJT input stage) has $m=25$, and the OP275/285 (with Butler input stages) have $m=8$; the LT1210 (a CFB op-amp) has $m=55$ with the recommended feedback resistor; and the LT1351 (a CFB in VFB's clothing) has $m=220$.

For a deeper look at slew rate, turn to the extended discussion in Chapter $4 x$ (§4x.9).

### 5.8.2 Bandwidth and settling time

Slew rate measures how rapidly the output voltage can change. The op-amp slew-rate specification usually assumes a large differential input voltage ( 60 mV or more), which (in spite of its potential for creating output distortion) is not unreasonable, given that an op-amp whose output isn't where it's supposed to be will have its input driven
hard by feedback, assuming a reasonable amount of loop gain. Of perhaps equal importance in high-speed precision applications is the time required for the output to get where it's going following an input change. This settling-time specification (the time required to get within the specified accuracy of the final value and stay there; see Figure 5.14) is always given for devices such as digital-to-analog converters, where precision is the name of the game, but it is not normally specified for op-amps.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0342.jpg?height=573&width=662&top_left_y=614&top_left_x=286)

* sometimes defined to $V_{\text {out }}=$ logic threshold, or to $V_{\text {out }}=0.5 V_{\text {final }}$

Figure 5.14. Settling time defined.
We can estimate op-amp settling time by considering first a different problem, namely, what would happen to a perfect voltage step somewhere in a circuit if it were followed by a simple $R C$ lowpass filter (Figure 5.15). It is a simple exercise to show that the filtered waveform has the settling times shown. This is a useful result, because you often limit bandwidth with a filter to reduce noise (more on that later in the chapter). To extend this simple result to an op-amp, just remember that a compensated op-amp has a $6 \mathrm{~dB} /$ octave rolloff over most of its frequency range, just like a lowpass filter. When connected for closed-loop gain $G_{\text {CL }}$, its "bandwidth" (the frequency at which the loop gain drops to unity) is approximately given by

$$
f_{3 \mathrm{~dB}}=f_{\mathrm{T}} / G_{\mathrm{CL}}
$$

As a general result, a system of bandwidth $B$ has response time $\tau \approx 1 /(2 \pi B)$; thus the equivalent "time constant" of the op-amp is

$$
\tau \approx G_{\mathrm{CL}} / 2 \pi f_{\mathrm{T}}
$$

The settling time is then roughly $5-10 \tau$.
Let's try our prediction on a real case. The TLE2141
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0342.jpg?height=364&width=675&top_left_y=216&top_left_x=1137)

Figure 5.15. Settling time of an $R C$ lowpass filter.
from TI is a precision fast-settling op-amp, with an $f_{\mathrm{T}}$ of 5.9 MHz . Our simple formula then estimates the invertingconfiguration (i.e., $G=2$ ) response time to be 54 ns , thus a settling time of 378 ns ( $7 \tau)$ to $0.1 \%$. This is in good agreement with the datasheet's value of 340 ns .

There are several points worth making: (a) our simple model gives us only a lower bound for the actual settling time in a real circuit; you should always check the slew-rate-limited rise time, which may dominate. (b) Even if slew rate is not a problem, the settling time may be much longer than our idealized "single-pole" model, depending on the op-amp's compensation and phase margin. (c) The op-amp will settle more quickly if the frequency compensation scheme used gives a plot of open-loop phase shift versus frequency that is a nice straight line on a $\log -\log$ graph (as in Figure 5.17); op-amps with wiggles in the phase-shift graph are more likely to exhibit overshoot and ringing, as in the upper waveform shown in Figure 5.14. (d) A fast settling time to $1 \%$, say, doesn't necessarily guarantee a fast settling time to $0.01 \%$, since there may be a long tail (Figure 5.16). (e) There's no substitute for an actual settling-time specification from the manufacturer.

Table 5.4 lists a selection of high-speed op-amps suitable for applications that demand high $f_{\mathrm{T}}$, high slew rate, fast settling time, and reasonably low offset voltage.

### 5.8.3 Crossover distortion and output impedance

Some op-amps (for example the classic single-supply LM324/358) use a simple push-pull follower output stage, without biasing the bases two diode drops apart, as we discussed in §2.4.1. This leads to "class-B" distortion near zero output, because the driver stage has to slew the bases through $2 V_{\mathrm{BE}}$ as the output current passes through zero (Figure 5.18). This crossover distortion can be substantial, particularly at higher frequencies where the loop gain is reduced; see the measured data in Figure 5.19. It is greatly reduced in op-amp designs that bias the output

Table 5.4 Representative High-speed Op-amps ${ }^{\times}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0343.jpg?height=1041&width=1672&top_left_y=283&top_left_x=113)

Notes: (a) boldface indicates number in a package for the part number listed. (b) for $\mathrm{G}<20$ use ext $C_{\mathrm{C}}$ chosen to set $f_{3 \mathrm{~dB}}=200 \mathrm{MHz}$. (c) 15 mA sinking, 47mA sourcing. (d) for DIP-8 see OPA637. (e) OPA699 decomp. (g) at G=10. (m) max. (n) distortion plot for OPA699. (p) $I_{Q}$, typical, per amplifier. ( r ) at 1 kHz . ( x ) see also the fast op-amp table in Chapter $4 x$.
push-pull pair into slight conduction ("class-AB"), for example the LT1013, which is an improved version of the LM324. The right choice of op-amp can have enormous impact on the performance of low-distortion audio amplifiers. Perhaps this problem has contributed to what the audiophiles refer to as "transistor sound." Some modern opamps, particularly those intended for audio applications, are designed to produce extremely low crossover distortion. Examples are the LT1028, the AD797, and the excellent "LME49000" series from NSC, e.g., the LME49710. The latter, for example, has less than $0.0001 \%$ distortion over the full audio band of $20-20 \mathrm{kHz}$. (That's the claim, anyway; we may be overly gullible!) These amplifiers all have very low noise voltage, as well; the LT1028, for example, vies for the title of world noise-voltage champion, with $e_{\mathrm{n}}=1.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}(\max )$ at 10 Hz . See the expanded plots of op-amp distortion in Figures 5.43 and 5.44, where various op-amps compete for the title of king of low distortion. High-voltage op-amps have an advantage below

10 kHz , whereas the low-voltage types have an advantage above 200 kHz .

The open-loop output impedance of a typical splitsupply op-amp is highest when the output is near ground, because the output transistors are operating at their lowest current into the (ground-returned) load. The output impedance also rises at high frequency as the transistor gain drops off, and it may rise slightly at very low frequencies because of thermal feedback on the chip.

It is easy to neglect the effects of finite open-loop output impedance, thinking that feedback will cure everything. But when you consider that some op-amps have open-loop output impedances of a few hundred ohms, it becomes clear that the effects may not be negligible, especially at low to moderate loop gains. Figures 5.20 and 5.21 shows some typical graphs of op-amp output impedance, both with and without feedback.

The finite output impedance contributes also to instability when driving capacitive loads, as we discussed in
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0344.jpg?height=746&width=651&top_left_y=216&top_left_x=297)

Figure 5.16. A. The slewing decreases when input error approaches 60 mV . B. Settling to high precision can be surprisingly lengthy.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0344.jpg?height=596&width=779&top_left_y=1248&top_left_x=225)

Figure 5.17. OP-42 gain and phase versus frequency.
§4.6.2, owing to the additional lagging phase shift within the feedback loop that is created by $R_{\text {out }}$ in combination with $C_{\text {load }}$. Several common solutions were shown in Figure 4.78 , including a split feedback path or the inclusion of a unity-gain buffer within the loop. The latter is worth a mention here.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0344.jpg?height=356&width=791&top_left_y=210&top_left_x=1079)

Figure 5.18. Crossover distortion in class-B push-pull output stage.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0344.jpg?height=565&width=807&top_left_y=702&top_left_x=1068)

Figure 5.19. Measured harmonic distortion versus frequency for several popular op-amps (1 Vrms output, unloaded). See also Figures 5.43 and 5.44.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0344.jpg?height=557&width=802&top_left_y=1433&top_left_x=1073)

Figure 5.20. Measured open-loop output impedance versus frequency for a selection of op-amps. Parts shown in bold have CMOS output circuits. * With output pulldown resistor.

### 5.8.4 Unity-gain power buffers

If the technique of split feedback paths is unacceptable, one solution is to add a unity-gain high-current buffer inside
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0345.jpg?height=542&width=799&top_left_y=216&top_left_x=121)

Figure 5.21. Closed-loop output impedance versus frequency for the LF411 and LT1007 op-amps, from manufacturers' datasheets.
the loop, as, for example, in the general-purpose laboratory amplifier of Figure 4.87. The LT1010 in that circuit has adequate bandwidth ( $>10 \mathrm{MHz}$ ) in which it adds little phase shift; thus it can be within the feedback loop with a small amount of external compensation.

These "power boosters" can, of course, be used for loads that require high current (for example, driving a terminated coax cable), regardless of whether or not there are problems with capacitance. And unity-gain buffers are useful even with loads of only moderate current, in the context of precision circuit design, because they prevent thermal drifts by keeping the heat out of the low-offset amplifier. You can see a couple of examples of power boosters in Figures 5.47 and 13.119, as well as in the discussion in Chapter $4 x$.

### 5.8.5 Gain error

There's one more error that arises from finite open-loop gain, namely, an error in closed-loop gain owing to finite loop gain.

We calculated in Chapter 2 (\$2.5.2) the expression for closed-loop gain in a feedback amplifier, $G=A /(1+A B)$, where $A$ is the open-loop gain and $B$ is the "gain" of the feedback network. You might think that the $A \geq 100 \mathrm{~dB}$ or so of op-amp open-loop gain is plenty, but when you try to construct extremely precise circuits you are in for a surprise. From the preceding gain equation it is easy to show that the "gain error," defined as

$$
\delta_{\mathrm{G}}=\text { gain error } \equiv \frac{G_{\text {ideal }}-G_{\text {actual }}}{G_{\text {ideal }}}
$$

is just equal to $1 /(1+A B)$ and ranges from 0 for $A=\infty$ to $1(100 \%)$ for $A=0$.

Exercise 5.2. Derive the foregoing expression for gain error.
The resulting frequency-dependent gain error is far from negligible. For instance, an LF411 with its 106 dB of lowfrequency open-loop gain will have a gain error of $0.5 \%$ at low frequencies when configured for a closed-loop gain of 1000 . Worse yet, the open-loop gain drops $6 \mathrm{~dB} /$ octave above 20 Hz , so our amplifier would have a gain error of a whopping $10 \%$ at 500 Hz ! Figure 5.22 plots calculated gain error versus frequency for the OPA277, with its extraordinary 140 dB of low-frequency open-loop gain, when configured for closed-loop gains of 100 and 1000. It should be obvious that you need plenty of gain and a high $f_{\mathrm{T}}$ to maintain accuracy at even moderate frequencies.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0345.jpg?height=473&width=786&top_left_y=794&top_left_x=977)

Figure 5.22. OPA277 gain error.
We plotted these curves from the graph of open-loop gain versus frequency given in the datasheet. Even if your op-amp datasheet provides a curve, it's best to work backward from the specified $f_{\mathrm{T}}$ (i.e., the datasheet's GBW; see Figure 5.42 and associated discussion) and dc open-loop gain, figuring the open-loop gain at the frequency of interest, and thus the gain error (as above) as a function of frequency. This procedure yields

$$
\delta_{\mathrm{G}}=\frac{1}{1-j B f_{\mathrm{T}} / f} \approx \frac{f}{B f_{\mathrm{T}}},
$$

where $B$ is, as usual, the gain of the feedback network, and the approximation is valid for the useful case $B f_{\mathrm{T}} / f \gg 1$. Of course, in some applications, such as filters, $B$ may also depend on frequency.

Exercise 5.3. Derive the foregoing result for $\delta_{\mathrm{G}}(f)$.

### 5.8.6 Gain nonlinearity

Op-amps have lots of open-loop gain at low frequencies, and the excess ( $G_{\mathrm{OL}} / G_{\mathrm{CL}}$ ) is the loop-gain feedback mechanism that contributes to accuracy and the reduction of the op-amp's intrinsic nonlinearities, as discussed first
in §2.5.3. Ideally, then, we want lots of open-loop gain in a precision circuit. And that's why auto-zero amplifiers ( $\$ 5.11$ ) and precision op-amps are built with high open-loop gains, for example $\sim 160 \mathrm{~dB}$ for the auto-zero LMP2021, and $\sim 150 \mathrm{~dB}$ for the precision LT1007.

For accuracy, then, we want lots of loop gain. For purposes of linearity, however, it's OK to have less loop gain - what matters more is the intrinsic linearity of the opamp, combined with an open-loop gain characteristic that changes linearly (if at all) with output swing. The intrinsic linearity is strongly influenced by the output-stage design, particularly when the amplifier is driving a load: crossover distortion is always bad, as is an output stage that is asymmetric in its source/sink capabilities (like the LM358, with a Darlington npn pullup and single pnp pull-down). And a poor layout within the chip can create nonlinearities from the thermal offsets produced by local heating when driving a load.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0346.jpg?height=904&width=689&top_left_y=979&top_left_x=278)

Figure 5.23. Low-frequency gain nonlinearity test circuit. A. Notional: an auxiliary amplifier makes visible the $\mu \mathrm{V}$-scale differential input voltage versus output swing. B. Circuit used by Pease for measurements in AN-1485 (see footnote on the current page).

In a nice set of measurements, Bob Pease ${ }^{19}$ explored the low-frequency gain nonlinearity of a selection of op-amp

[^231]types (sadly, none from other manufacturers), operating as unity-gain inverters with a full-swing output; he made measurements both when the op-amps were unloaded, and when they were driving a $1 \mathrm{k} \Omega$ load. The basic scheme is shown in Figure 5.23A, where a 'scope looks at the amplifier input error versus output swing. For Pease's actual measurements he used the subtle variant in Figure 5.23B, in which the op-amp amplifies its error by $\times 1000$, delivering the bad news directly.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0346.jpg?height=341&width=802&top_left_y=651&top_left_x=1068)

Figure 5.24. Gain nonlinearity traces for two op-amps with outputstage deficiencies. In these $x-y$ displays the vertical axis shows the (small) differential input signal required to produce the (full-swing) output signal indicated on the horizontal axis. To estimate gain error, divide the vertical deviation from a best-fit straight line by the full-swing output.

The sorts of things you see (with a loaded op-amp) are shown in Figure 5.24, where we've sketched Pease's traces for the aforementioned LM358 (afflicted with asymmetric source/sink) and the LM8262 (fast, but afflicted with some crossover distortion). An exemplary op-amp like the very low distortion LM4562 presents an ideal nearly-horizontal straight line. The LF411 (single) and LF412 (dual), our JFET jellybeans, show an interesting contrast: according to Pease, the LF411 chip layout is sub-optimal (in terms of gain and thermal effects), with great effort rewarded by better results in the dual LF412.

Here are some of his summary results for op-amps driving a somewhat lighter load $(4 \mathrm{k} \Omega$ ). In general, the measured gain nonlinearity, when unloaded, was far smaller than these listed values. Keep in mind that these measurements were made at very low frequencies (generally just a few hertz), where the loop gain is maximum.
(or, "What's All this Output Impedance Stuff, Anyhow?"). Gain nonlinearity data can be found in some datasheets, for example the AD620 instrumentation amplifier.

| HV BJT $\left(V_{\text {sig }}= \pm 10 \mathrm{~V}\right)$ |  |
| :--- | ---: |
| LM8262 | 12 ppm |
| LM358 | 1 ppm |
| LF411 | 1.4 ppm |
| LF412 | 0.3 ppm |
| LM4562 | 0.025 ppm |

xover dist.
asym. output stage poor layout - thermal better layout pro-audio, $G_{\mathrm{OL}}=10^{7}$

| CMOS R | $= \pm 4 \mathrm{~V})$ |  |
| :---: | :---: | :---: |
| LMC6482 | 1.1 ppm | jellybean |
| LMC6062 | 0.2 ppm | precision |

$\frac{\text { CMOS auto-zero }\left(V_{\text {sig }}= \pm 2 \mathrm{~V}\right)}{0.2 \mathrm{ppm}}$ precision

### 5.8.7 Phase error and "active compensation"

We've talked mostly about the gain error caused by limited op-amp bandwidth (and therefore falling loop gain with increasing frequency). But limited loop gain also produces phase error, which can be important in applications such as video, interferometry, and so on. And the effect is not at all negligible - recall (§1.7.9) that a single $R C$-like rolloff creates a phase shift of $\sim 6^{\circ}$ at a frequency of $f_{\mathrm{C}} / 10$, and $\sim 0.6^{\circ}$ at $f_{\mathrm{C}} / 100$; the latter is two full decades below the -3 dB breakpoint. If we model an op-amp's rolloff of open-loop gain similarly (a "single-pole" rolloff), we can expect comparable phase shifts.

In this approximation, the resultant phase shift for an op-amp voltage amplifier is thus given by

$$
\phi=\tan ^{-1}\left(\frac{f}{f_{\mathrm{C}}}\right) \approx \frac{f}{f_{\mathrm{C}}}(\text { radians }),
$$

where the -3 dB breakpoint $f_{\mathrm{C}}$ is the frequency at which the loop gain has fallen to unity: $f_{\mathrm{C}}=f_{\mathrm{T}} / G_{\mathrm{CL}}$. Here $G_{\mathrm{CL}}$ is the closed-loop gain (as set by the feedback network), and $f_{\mathrm{T}}$ is the gain-bandwidth product (GBW) of the op-amp (for a single-pole rolloff that's the same as the frequency at which the open-loop gain is unity; but for typical opamps, with more complicated rolloffs, you want to use the GBW figure). Multiply by $57.3(180 / \pi)$ to get the answer in degrees. The approximate result (the last expression) is reasonably accurate for small-to-moderate phase shifts, up to 0.5 radian, say.

There are several ways to address this problem. The simplest is to use an amplifier of greater bandwidth. If you don't want to (or cannot) do that, another possibility is to introduce an $R C$ network in the feedback path to cancel the phase error (in $s$-plane language, you are introducing a zero to cancel a pole). This can be effective, but requires
"tuning" of the compensation network to match the frequency response of the particular op-amp specimen itself; and because the op-amp's characteristics change with temperature, the network must do likewise. A third possibility is to cascade two stages, each configured for lower gain (and therefore smaller phase error).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0347.jpg?height=516&width=692&top_left_y=482&top_left_x=1052)

Figure 5.25. Phase-error reduction by means of "active compensation," exploiting the closely matched frequency responses of dual op-amp pair $A_{1}$ and $A_{2}$.

But an elegant solution is active compensation, a clever technique that uses a second matching op-amp to create a replica of the error, which can then be subtracted from the main amplifier. Figure 5.25 shows how this can be done. ${ }^{20}$ The bandwidth of the main amplifier is unchanged, but its phase error is reduced dramatically, as shown in the SPICE simulation and measured data of Figure 5.26. There is some peaking in the amplitude response - about +3 dB at the frequency at which the phase error is $45^{\circ}$ - but generally insignificant within the frequency range over which the phase error is small (e.g., +0.1 dB at $f=0.1 f_{\mathrm{T}} / G_{\mathrm{CL}}$ ). A circuit configured for low closed-loop gain will generally exhibit greater peaking. ${ }^{21}$ Under the assumption that the

[^232]amplifiers are matched, it can be shown that this technique produces a phase shift given approximately by
$$
\phi \approx\left(\frac{f}{f_{\mathrm{C}}}\right)^{3} \text { (radians) }
$$
again accurate for small-to-moderate phase shifts ( $\lesssim 30^{\circ}$, say, i.e., the small-angle approximation).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0348.jpg?height=491&width=771&top_left_y=545&top_left_x=232)

Figure 5.26. SPICE simulation and measured data of the phase shift versus frequency for the circuit of Figure 5.25, implemented with an LF412 dual JFET op-amp. For comparison the analogous data are plotted for both a single $G=10$ stage and for a cascade of two stages, each with $G=\sqrt{10}$. The measured part's $f_{\mathrm{C}}$ was 295 kHz , somewhat lower than the SPICE model's 350 kHz .

Real op-amps are not perfectly matched. To see how a mismatch in $f_{\mathrm{T}}$ affects the phase compensation, we ran a SPICE simulation with an $f_{\mathrm{T}}$ mismatch of $\pm 10 \%$ (Figure 5.27). Evidently our test-bench part, chosen quite at random (dip fingers into parts bin, grasp first part touched, extract, measure), has a considerably better $f_{\mathrm{T}}$ matching, as suggested by Wong: "Monolithically matched dual or quad op-amps can provide the frequency-matching characteristics (to within $1 \%$ to $2 \%$ ) necessary for the success of the active-feedback approach." ${ }^{22}$

It's interesting to compare predicted phase shifts for several scenarios mentioned at the outset: (a) a single amplifier of given bandwidth (call it $f_{\mathrm{T} 0}, 3 \mathrm{MHz}$ for the LF412), configured for a closed-loop gain $G=10$; (b) two cascaded stages, each with $G=\sqrt{10}$; (c) the active compensation method of Figure 5.25; and (d) a single amplifier of greater bandwidth ( $10 f_{\mathrm{T} 0}$, say). Here are the calculated results:

[^233]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0348.jpg?height=411&width=772&top_left_y=223&top_left_x=1081)

Figure 5.27. Active compensation of phase error requires matched op-amp bandwidths, as seen in this SPICE simulation for which the $f_{\mathrm{T}}$ of the compensation op-amp $A_{2}$ has been varied $\pm 10 \%$ relative to that of the signal path op-amp $A_{1}$.

|  | Single, <br> $G=10$ | 2-stage, <br> each $G=\sqrt{10}$ | Active, <br> comp | Single, <br> $f_{\mathrm{T}}=10 f_{\mathrm{T} 0}$ |
| ---: | :---: | :---: | :---: | :---: |
| $0.001 f_{\mathrm{T} 0}$ | $-0.57^{\circ}$ | $-0.36^{\circ}$ | $-0.00006^{\circ}$ | $-0.006^{\circ}$ |
| $0.003 f_{\mathrm{T} 0}$ | $-1.7^{\circ}$ | $-1.1^{\circ}$ | $-0.0015^{\circ}$ | $-0.17^{\circ}$ |
| $0.01 f_{\mathrm{T} 0}$ | $-5.7^{\circ}$ | $-3.6^{\circ}$ | $-0.06^{\circ}$ | $-0.57^{\circ}$ |
| $0.03 f_{\mathrm{T} 0}$ | $-17.2^{\circ}$ | $-10.9^{\circ}$ | $-1.5^{\circ}$ | $-1.7^{\circ}$ |
| $0.1 f_{\mathrm{T} 0}$ | $-45^{\circ}$ | $-36^{\circ}$ | $-45^{\circ}$ | $-5.7^{\circ}$ |

It's clear that the remarkable (and underutilized) technique of active compensation represents an efficient use of resources. The noninverting $G=2$ case looks especially useful, e.g., to drive backterminated $75 \Omega$ video cables. ${ }^{23}$

## 5.9 RRIO op-amps: the good, the bad, and the ugly

In Chapter 4 (§§4.4.1, 4.4.2, and 4.6.3) we introduced rail-to-rail op-amps, including (a) op-amps that operate properly with common-mode inputs over the full supply voltage range (RRI), (b) op-amps that can swing their outputs over the full supply range (RRO), and (c) op-amps that can do both (RRIO). With lower supply voltages increasingly in vogue, you see many new op-amps with these desirable capabilities.

Desirable, but to be used with caution. These benefits come at a cost, which we'll discuss here in the context of precision design (with further discussion in Chapter $4 x$ ). In circuits that strive for accuracy there are some hidden compromises in the designs of these op-amps about which the datasheet may be, uh, understated (or completely silent). Here are the important ones.

[^234]
### 5.9.1 Input issues

#### A. Input-current crossover

Most RRI op-amps use a complementary pair of differential input stages, with their inputs driven in parallel, to handle the full supply voltage range (Figure 5.28). This causes a shift in input current because the signal path changes from one pair to the other, as seen clearly in Figure 5.7 (particularly the BJT-input RRI op-amps: LT1630, LM6132). An abrupt change in input current causes input errors from finite driving impedance. Some RRI opamps avoid this problem by using an on-chip charge pump to generate a supply voltage beyond the rail, so a single input amplifier allows rail-to-rail inputs. Examples are the OPA360-series, ${ }^{24}$ the AD8505 and ADA4505, the MAX4162-series, and the MAX4126-series. Except for the BJT-input MAX4126, these all use MOS inputs.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0349.jpg?height=409&width=743&top_left_y=918&top_left_x=149)

Figure 5.28. A typical rail-to-rail input circuit consists of a pair of complementary differential amplifiers, with downstream circuity to select the active pair's output.

In situations where you need RRO but don't need full rail-to-rail input (a voltage amplifier with $G>2$, say), be sure to consider an RRO op-amp with input extending to the negative rail only (sometimes called "ground sensing"). Note also that, by using an op-amp in an inverting circuit configuration, you avoid this problem completely (but you probably would not choose an RRI op-amp for such a configuration anyway).

#### B. Input offset-voltage crossover

The dual input stages of RRI op-amps cause similar mischief in terms of their input offset voltage $V_{\mathrm{OS}}$, as seen in Figure 5.29. The abrupt change can occur close to either end of the supply range, as seen in the LMP7701 and LMP7731 op-amps from the same manufacturer. These curves were adapted from their respective datasheets,

[^235]which typically display a figure showing a tangle of overlapping curves measured on multiple op-amp samples (if they're willing to show any data at all about this seamy topic). Here you can see by comparison the uncomplicated (and downright boring) behavior of an RRI op-amp with an on-chip charge pump powering a single input amplifier. This variation of $V_{\mathrm{OS}}$ with $V_{\mathrm{CM}}$ is not only undesirable, it is also unpredictable, as you can see in Figure 5.30.

This problem is nicely circumvented by the use of an inverting configuration, which holds constant the commonmode input voltage. More generally, always consider using an inverting configuration to prevent any circuit misbehavior caused by op-amp dependence on $V_{\mathrm{CM}} .{ }^{25}$

The OPA350 datasheet shows a nice example (Figure 5.31) of input crossover effects in RRI op-amps, namely a 17 dB increase in audio distortion in a $G=1$ follower when the 3 Vpp sinewave input is shifted upward to enter the crossover region. ${ }^{26}$ The same graph illustrates nicely how increased closed-loop gain causes increased distortion owing to decreased loop gain.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0349.jpg?height=554&width=797&top_left_y=1070&top_left_x=969)

Figure 5.29. Op-amps with rail-to-rail inputs usually exhibit a shift of $V_{\mathrm{OS}}$ as the input voltage passes control from one input pair to the other. The OPA369 circumvents this by using a single input pair, powered beyond the rail by an on-chip charge pump.

### 5.9.2 Output issues

#### A. Output impedance

The output stage of a conventional (not RRO) op-amp is ordinarily a complementary push-pull follower (or some
${ }^{25}$ As Jim Williams liked to say, "Use an inverting configuration, unless you can't."
${ }^{26}$ See also Bonnie Baker's article (in the Baker's Best series) "Where did all that racket come from?" in EDN Magazine, 23 April 2009, available at edn.com.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0350.jpg?height=552&width=799&top_left_y=221&top_left_x=218)

Figure 5.30. The shift of offset voltage in an RRI op-amp can be unpredictable (even as to the sign of the effect!), as seen in these data, adapted from the unusually forthcoming manufacturer's datasheet.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0350.jpg?height=496&width=756&top_left_y=997&top_left_x=244)

Figure 5.31. Distortion versus frequency for the OPA350 RRIO opamp. The two lowest curves show the dramatic increase in distortion when the input signal enters the input crossover region. Increasing closed-loop gain causes further distortion because of reduced loop gain.
variation thereupon), biased with some conduction overlap to prevent crossover distortion at mid-supply (see §5.8.3). By contrast, the output complementary pair in an RRO opamp is configured as a push-pull common-source amplifier; see Figure 5.32. That's necessary for the output to reach the rails (absent a second set of beyond-the-rails supply voltages). But it creates problems, owing to its inherently high output impedance.

The high $Z_{\text {out }}$ means that the output-stage gain (and therefore the loop gain) depends on the value of load resistance; and a capacitive load creates large phase shifts, compromising the loop stability (see, for example, Figure 4.79). These problems are addressed in part by use of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0350.jpg?height=652&width=366&top_left_y=220&top_left_x=1077)
A. Follower (not RRO)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0350.jpg?height=429&width=336&top_left_y=446&top_left_x=1531)

Figure 5.32. The classic (not rail-to-rail) op-amp output stage is a push-pull unity-gain follower with inherently low output impedance, biased (via $Q_{4} Q_{5}$ ) to suppress crossover distortion; it has straightforward biasing and current limiting. By contrast, a rail-to-rail output stage (usually implemented in CMOS) is a push-pull commonsource amplifier ( $G>1$ ) with inherently high output impedance; it requires considerable trickery in its biasing and current limiting.
internal feedback around the output stage (the capacitors in Figure 5.32B), so that the gain and output impedances are reasonably well controlled except at low frequencies - see for example Figures 5.33 and 5.34. ${ }^{27}$

#### B. Saturation at the rails

Some "rail-to-rail output" op-amps (in particular, those with a BJT output stage) don't quite make it the last few millivolts; that's because the output transistor's saturation voltage is not zero. (This is not usually a problem with MOSFET outputs, which look like an $R_{\text {on }}$ to one rail or the other when driven full range.) Usually this doesn't matter, because what you care about most is getting full use of a limited supply voltage (when operating with low-voltage supplies). But it does matter, for example, if you've got a single-supply setup in which the op-amp is driving an ADC whose conversion range goes clear down to ground.

In such a case be sure to check the specifications. Some

[^236]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0351.jpg?height=486&width=710&top_left_y=224&top_left_x=165)

Figure 5.33. The low-frequency gain of rail-to-rail output op-amps may depend strongly on load resistance, as seen here for the LMC6482.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0351.jpg?height=496&width=736&top_left_y=892&top_left_x=155)

Figure 5.34. For some RRO op-amps the open-loop output impedance rises markedly at low frequencies, owing to internal capacitive negative feedback around the output stage that becomes ineffective at low frequencies. But, not to worry, there's lots of loop gain at low frequencies in typical op-amp applications.

RRO op-amps will warn you that the output will not reach the negative rail (e.g., 10 mV for the bipolar LT6003); others will instruct you to add an external pull-down resistor or current sink (e.g., the bipolar LT1077, which saturates to 3 mV with no pull-down, and 0.1 mV with a $5 \mathrm{k} \Omega$ pull-down). Op-amps with clean MOSFET saturation will tell you not to worry - the unloaded output will go all the way to ground (e.g., $\lesssim 0.1 \mathrm{mV}$ for the CMOS AD8616 or AD8691).

#### C. Distortion

The rail-to-rail output stage (Figure 5.32B) presents real challenges to the chip designer when it comes to quiescent biasing and reduction of crossover distortion. Despite heroic efforts, these amplifiers generally perform some 20-

40 dB worse than their conventional (non-RRO) counterparts in terms of distortion, as seen in the pair of plots in Figures 5.43 (non-RRO) and 5.44 (mostly RRO); ${ }^{28}$ see also the SPICE plots in $\S 4 x .11$.

#### D. Monticelli's output circuit

An elegant RRO circuit solution was devised by Monticelli, ${ }^{29}$ and it is shown here in simplified form in Figure 5.35 (there's a full discussion in $\S 4 x .11$ ). It has the effect of biasing the push-pull pair $Q_{1} Q_{2}$ in such a way that there is current overlap at crossover, and, better still, there is continuing current through both transistors throughout the output swing. We might call this "push-pull class-A" mode (though it seems to have been named already: "classAA"). It is used, for example, in the CMOS OPA365 and in the BJT OPA1641. And it works - these parts have -114 dB and -126 dB harmonic distortion, respectively.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0351.jpg?height=560&width=509&top_left_y=955&top_left_x=1118)

Figure 5.35. The Monticelli rail-to-rail output circuit.
Here's a capsule description of the Monticelli circuit's operation: first, think of $Q_{3}$ and $Q_{4}$ each as unity-gain current amplifiers whose source terminal is the "summing
${ }^{28}$ In fairness, we note that some of the poorer "distortion" results (which are actually THD $+\mathrm{N}-$ distortion plus noise) may be due to the lower supply voltages of the RRO op-amps, necessitating lower signal levels, thus causing noise to loom larger.
${ }^{29}$ See his patent US4570128, and his IEEE JSSC paper (SC-21, \#6, 1986), in which he says "The output stage (Figure 8) must solve a level shifting problem that has plagued rail-to-rail designs for some time. Elaborate solutions have been proposed that combine multiple embedded feedback loops that are in effect op amps within op amps. To succeed as a general-purpose quad, a simpler solution had to be found." Although originally developed at NSC, this circuit (or close variations) is popular with op-amp designers at Analog Devices and at TI (even before it swallowed NSC).
junction" (because the gate is held at fixed voltage). Now imagine an increasing input signal current, which reduces the net current sunk at $Q_{4}$ 's source. This reduces its $V_{\mathrm{GS}}$, which increases $Q_{2}$ 's $V_{\mathrm{GS}}$, thereby increasing the output pull-down current. Meanwhile, the reduced drain current in $Q_{4}$ causes less of $Q_{3}$ 's source current to be diverted, thus increasing the $V_{\mathrm{GS}}$ of $Q_{3}$; that causes a reduction in $Q_{1}$ 's $V_{\mathrm{GS}}$, and therefore a lower output pullup current. The overall quiescent current is set by the dc bias applied to $Q_{3}$ and $Q_{4}$. So it's a nicely balanced circuit, with a single-ended current input and a push-pull current output.

This is one cool circuit! In $\S 4 x .11$ there's a more complete description, including SPICE simulations of a BJT implementation, and comparison with a conventional (not rail-to-rail) class-AB push-pull emitter follower. This inherently symmetrical circuit also works well with differential current drives to the drains of both $Q_{3}$ and $Q_{4}$, a configuration you'll often see.

## 5.10 Choosing a precision op-amp

If there's no such thing as a perfect operational amplifier, then that's especially true for precision op-amps. Although sufficient perfection may be achieved in a few parameters, the design tradeoffs required for achieving this invariably degrade other parameters. For example, if we need a very quiet medium-frequency op-amp, a world-class quiet IC, we won't be able to enjoy world-class low-input-bias currents. ${ }^{30}$ That's because the amplifier will use bipolar input transistors, which will have to be operated at fairly high collector currents, and you know what that means for the base currents (e.g., look at the LT1028). Another example: if we want micropower operating current, we won't be able to enjoy world-class fast settling time, because we won't be able to have a high $f_{\mathrm{T}}$ and fast slew rates; that takes power, and lots of it.

In this section we take an in-depth look at the process of choosing a precision op-amp that is right for the job at hand, linked closely to a broad selection of exemplary parts in Tables 5.5 (pages 320-321) and 5.6 (on page 335). If you've got a circuit design that you've been struggling with, this section should hit the spot. The nitty-gritty level of detail that follows is essential to the careful design that distinguishes an excellent circuit from a compromiseridden also-ran. For the casual reader, on the other hand,

[^237]the level of detail in the following treatment may be, well, "not superficial enough." ${ }^{31}$

As we begin our tour of precision op-amp parameters and their significance, we invite you to bury yourself in the data. With your circuit design goals in mind, start with an important op-amp parameter and look for the best choices. After zeroing in on a winning value, you can examine other parameters for that op-amp: do some of the other parameters for our winning op-amp now look like poor choices? Maybe your op-amp isn't a winner after all. Or perhaps you've got to return to your design goals and adjust them in accordance with reality, and repeat the process. Remember always that "engineering is the art of compromise."

### 5.10.1 "Seven precision op-amps"

Seven is a nice number, and, in preparation for the extended discussion of the very practical issue of choosing a precision op-amp, we provide in Table 5.5 (pages 320321) a comparison of the important specifications for an updated listing of seven of our favorite precision op-amps. The problem is, we just couldn't restrict ourselves to a mere seven - it's closer to seven dozen! Spend some time with it (and check off your own seven faves!) - it will give you a good feeling for the trade-offs you face in highperformance design with op-amps. Note particularly the trade-offs of offset voltage (and drift) versus input current for the best bipolar and JFET op-amps. You also get the lowest noise voltage from bipolar op-amps, trending downward with increasing bias current; we'll see why that happens later in Chapter 8 when we discuss noise. The awards for low-input current, however, always go to the FET opamps, again for reasons that will become clear later. In general, choose FET op-amps for low-input current and current noise; choose bipolar op-amps for low-input voltage offset, drift, and voltage noise.

Among FET-input op-amps, those using JFETs dominate the scene, particularly where precision combined with low noise is needed (but not all JFET op-amps: note that our jellybean favorites, the LF411/412, are not precise enough to qualify for membership in the table). That dominance is being challenged, though, by some low-voltage CMOS parts like the factory-trimmed MAX4236A and OPA376, and by parts like the TLC4501A that use tricks such as auto-zeroing at power-up. ${ }^{32}$

[^238]| Part \# |  | ev |  |  | op-a |  |  |  |  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=57&width=154&top_left_y=1364&top_left_x=223) | Noise ${ }^{t}$ |  |  | $\begin{aligned} & \text { GBW } \\ & \text { typ } \\ & \text { (MHz) } \end{aligned}$ | $\begin{aligned} & \text { Slew } \\ & \text { typ } \\ & \text { (V/ } / 4 \mathrm{~s}) \end{aligned}$ | 著 <br> ( $\mu \mathrm{s}$ ) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=68&width=138&top_left_y=852&top_left_x=239) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=254&width=130&top_left_y=577&top_left_x=247) | Cost qty 25 <br> (\$US) | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=51&width=140&top_left_y=2041&top_left_x=237) | Supply ${ }^{p}$ |  | Input Current <br> @25ºC |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=67&width=152&top_left_y=1629&top_left_x=223) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0353.jpg?height=72&width=153&top_left_y=1555&top_left_x=222) | Voltag $\frac{\Delta V}{\text { typ }}$ $\left(\frac{\mu \mathrm{V}}{{ }^{\circ} \mathrm{C}}\right)$ | e <br> os <br> max <br> $\left(\frac{\mu \mathrm{V}}{{ }^{\circ} \mathrm{C}}\right)$ |  | $\begin{gathered} V_{\mathrm{npp}} \\ \mathrm{dc}^{\mathrm{b}} \\ (\mu \mathrm{~V}) \end{gathered}$ | $e_{n}$ <br> 1kHz <br> $\left(\frac{\mathrm{nV}}{\sqrt{H z}}\right)$ | $\begin{array}{r} i_{\mathrm{n}}^{\mathrm{k},} \\ 1 \mathrm{kHz} \\ \left(\frac{\mathrm{fA}}{\sqrt{\mathrm{~Hz}}}\right) \end{array}$ |  |  |  |  |  |  |  |
| HV bipolar |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
|  | LT1077A | 1 | 2.2-44 | 0.05 | 7 nA | $9 n A$ | 9 | 40 | 0.4 | 1.6 | 97 | 0.5 | 27 | 65 | 0.23 | 0.08 | - | - low | - $\cdot$ - $\cdot$ - - $\cdot$ | 3.84 | single-supply |
|  | LT1490A | 2,4 | 2.5-44 | 0.04 | 1 nA | $8 n A$ | 110 | 500 | 2 | 4 | 84 | 1 | 50 | 15 | 0.2 | 0.07 | - | - 4.6 | $\cdot$ $\cdot$ $\cdot$ - - - $\cdot$ | 3.25 | over-the-top |
| - | AD8622A | 2,4 | 4-36 | 0.22 | 45 nA | 200 nA | 10 | 125 | 0.5 | 1.2 | 125 | 0.2 | 11 | 150 | 0.56 | 0.48 | - | - 5.5 | - - $\cdot$ - - - - - | 5.33 |  |
|  | LT1013 $^{f}$ | 2,4 | 3.4-44 | 0.35 | 12 nA | 20 nA | 40 | 150 | 0.4 | 2 | 100 | 0.55 | 22 | 70 | 0.7 | 0.4 | - | - low | - $\cdot$ - $\cdot$ - - - $\cdot$ | 3.13 | single-supply |
|  | OPA277 | 1,2,4 | 4-36 | 0.79 | 0.5 nA | 1 nA | 10 | 20 | 0.1 | 0.15 | 130 | 0.22 | 8 | 200 | 1 | 0.8 | 16 | - low | - - - - $\cdot$ - - $\cdot$ | 3.17 | improved OP-27 |
| , | TLE2141A | 1,2,4 | 4-44 | 3.5 | $0.7 \mu \mathrm{~A}$ | $1.5 \mu \mathrm{~A}$ |  | 500 | 1.7 | - | 85 | 0.5 | 10.5 | 1900 | 5.9 | 45 | 0.4 | - low | - $\cdot$ - $\cdot$ - - $\cdot$ | 1.15 | cross-coupled slew |
|  | LT1677 | 1 | 3-44 | 2.8 | $2 n A^{\text {e }}$ | $20 \mathrm{nA}^{\mathrm{e}}$ | 20 | 60 | 0.4 | 2 | 109 | 0.09 | 3.2 | 1200 | 7.2 | 2.5 | 5 | - 4.2 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ - - $\cdot$ | 3.07 | an "RRIO LT1007" |
|  | AD8675 | 1,2 | 9-36 | 2.5 | 0.5 nA | 2 nA | 10 | 75 | 0.2 | 0.6 | 114 | 0.1 | 2.8 | 300 | 10 | 2.5 | - | $\cdot$ | - - $\cdot$ $\cdot$ $\cdot$ - - - | 2.22 | 0.6 ppm dist, dual='76 |
|  | OPA2209 | 1,2,4 | 4.5-40 | 2.2 | 1 nA | 4.5 nA | 35 | 150 | 1 | 3 | 120 | 0.13 | 2.2 | 500 | 18 | 6.4 | 2.1 | 4 | - - - - - - - - | 4.04 | 0.25ppm dist, SOT23 |
|  | LT1007 ${ }^{9}$ | 1 | 4-44 | 2.7 | 10 nA | 35 nA | 10 | 25 | 0.2 | 0.6 | 117 | 0.06 | 2.5 | 400 | 8 | 2.5 | - | - - | - - - - $\cdot$ - - $\cdot$ | 2.48 | '37 decomp 60MHz |
|  | ADA4004 | 1,2,4 | 9-36 | 2.2 | 40 nA | 90 nA | 40 | 125 | 0.7 | 1 | 110 | 0.15 | 1.8 | 3500 | 12 | 2.7 | - | - - | - - - - - - - - | 4.20 | family, SOT23 |
|  | LT1468 | 1 | 7-36 | 3.9 | 3 nA | 10 nA | 30 | 75 | 0.7 | 2 | 96 | 0.3 | 5 | 600 | 90 | 23 | 0.8 | - 4 | - - - - $\cdot$ - - $\cdot$ | 4.26 | 0.7ppm dist |
|  | AD8597 | 1,2 | 9-36 | 4.8 | 40 nA | 210 nA | 10 | 120 | 0.8 | 2.2 | 120 | 0.08 | 1.1 | 4300 | 10 | 16 | 2.0 | - 12 | - - - - - - - $\cdot$ | 3.71 | 1ppm dist |
| $\square$ | LT1028A $^{\mathrm{h}}$ | 1 | 8-44 | 7.4 | 25 nA | 90 nA | 10 | 40 | 0.2 | 0.8 | 108 | 0.04 | 0.85 | 4700 | 75 | 15 | - | 5 | - - - - $\cdot$ $\cdot$ - $\cdot$ | 6.48 | lower / B than AD697 |
| HV superbeta |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| $\square$ | LT6010A ${ }^{\text {n }}$ | 1,2,4 | 2.7-40 | 0.14 | 20 | 110 | 10 | 35 | 0.2 | 0.8 | 107 | 0.4 | 14 | 100 | 0.35 | 0.11 | 45 | - 4 | - - $\cdot$ $\cdot$ - $\cdot$ - | 2.22 | replace LT1012, w/RRO |
|  | LT1012AC ${ }^{\text {m }}$ | 1 | 2.4-40 | 0.37 | 25 | 100 | 8 | 25 | 0.2 | 0.6 | 114 | 0.5 | 14 | (20) | 0.5 | 0.2 | - | - low | - - - - $\cdot$ $\cdot$ - $\cdot$ | 5.11 | has overcomp pin |
|  | OP97E | 1,2,4 | 4.5-40 | 0.40 | 30 | 100 | 10 | 25 | 0.2 | 0.6 | 114 | 0.5 | 14 | (20) | 0.9 | 0.2 | - | - low | - - - - $\cdot$ $\cdot$ - $\cdot$ | 5.52 | dual='297, quad='497 |
|  | AD706 | 2,4 | 4-36 | 0.8 | 50 | 200 | 30 | 100 | 0.2 | 1.5 | 106 | 0.5 | 15 | 50 | 0.8 | 1.5 | - | 2 | - - - - - - $\cdot$ | 4.05 | AD704 quad |
|  | LT1884A | 2,4 | 3.5-40 | 0.85 | 150 | 400 | 25 | 50 | 0.3 | 0.8 | 114 | 0.4 | 9.5 | 50 | 2 | 0.9 | 10 | - - | - - $\cdot$ - - - $\cdot$ | 5.23 | LT1882 slower, lower / B |
| HV JFET |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| $\square$ | AD795 | 1 | 8-36 | 1.3 | 1 | 2 | 100 | 500 | 3 | 10 | 90 | 1 | 9 | 0.6 | 1.6 | 1 | 11 | - 2.2 | - - - - - - - - | 7.97 | replace OPA111 |
|  | OPA124PB | 1 | 10-36 | 2.5 | 0.35 | 1 | 100 | 250 | 1 | 2 | 100 | 1.6 | 8 | 0.5 | 1.5 | 1.6 | 10 | - 3 | - - - - $\cdot$ - - $\cdot$ | 6.40 | substrate pin |
|  | OPA140 | 1,2,4 | 4.5-40 | 1.8 | 0.5 | 10 | 30 | 120 | 0.35 | 1 | 126 | 0.25 | 5.1 | 0.8 | 11 | 20 | 0.9 | - 10 | - $\cdot$ $\cdot$ - - - - | 3.75 | 0.5ppm dist |
|  | AD711C | 1,2 | 9-36 | 2.5 | 15 | 25 | 100 | 250 | 2 | 5 | 86 | 2 | 16 | 10 | 4 | 20 | 1.0 | - 5.5 | - - - - $\cdot$ - - $\cdot$ | 2.19 | AD712 low-cost dual |
|  | LT1055C ${ }^{\times}$ | 1 | 20-40 | 2.8 | 10 | 50 | 120 | 700 | 3 | 12 | 85 | 2 | 15 | 1.8 | 4.5 | 12 | 1.8 | - 4 | - - - - $\cdot$ - - $\cdot$ | 2.52 | 1057 dual, 1058 quad |
|  | ADA4000 | 1,2,4 | 5-36 | 2 | 5 | 40 | 200 | 1700 | 2 | - | 80 | 1 | 16 | 10 | 12 | 2.7 | - | - 5.5 | $\cdot$ - - - - - - - | 1.46 | jellybean, AD711 subst |
|  | OPA192 | 1,2,4 | 4.5-40 | 1 | 5 | 20 | 5 | 25 | 0.2 | 0.5 | 120 | 1.3 | 5.5 | 1.5 | 10 | 20 | 0.9 | - 0.6 | $\cdot$ $\cdot$ $\cdot$ - - - - | 3.87 | CMOS, e-Trim ${ }^{\text {TM }}$ |
|  | OPA134 | 1,2,4 | 5-36 | 4 | 5 | 100 | 500 | 2000 | 2 | - | 86 | - | 8 | 3 | 8 | 20 | 1 | $\cdot$ | - - - - $\cdot$ - - $\cdot$ | 1.60 | 0.8 ppm dist, jellybean |
|  | OPA1641 | 1,2,4 | 4.5-40 | 1.8 | 2 | 20 | 1000 | 3500 | - | - | 120 | - | 5.1 | 0.8 | 20 | 11 | - | - 8 | - $\cdot$ $\cdot$ - - - - | 2.76 | 0.5ppm dist, family |
|  | AD8620A | 1,2 | 10-27 | 2.5 | 2 | 10 | 85 | 250 | 0.5 | 1 | 90 | 1.8 | 6 | 5 | 25 | 60 | 0.6 | - 15 | - - - - - | 11.86 | caution, $\pm 12 \mathrm{~V}$ max |
|  | OPA827 | 1 | 8-40 | 4.8 | 15 | 50 | 75 | 150 | 1.5 | - | 104 | 0.25 | 3.8 | 2.2 | 22 | 28 | 0.55 | - 9 | - - - - - - - - | 9.00 | cheaper than 627 |
|  | OPA627B | 1 | 10-36 | 7 | 1 | 5 | 40 | 100 | 0.4 | 0.8 | 106 | 0.6 | 4.5 | 1.6 | 16 | 55 | 0.55 | - 7 | - - - - $\cdot$ - - $\cdot$ | 30.00 | ADA4627B 2nd-source |
|  | OPA637B | 1 | 10-36 | 7 | 1 | 5 | 40 | 100 | 0.4 | 0.8 | 106 | 0.6 | 4.5 | 1.6 | 80 | 135 | 0.45 | - 7 | - - - - $\cdot$ - - $\cdot$ | 30.00 | ADA4637B 2nd-source |
|  | AD549KH | 1 | 10-36 | 0.6 | 75 fA | 0.1 | 150 | 250 | 2 | 5 | 90 | 4 | 35 | 0.5 | 1 | 3 | 5 | 1 | - - - - $\cdot$ - - - | 28.00 | -L=60fA, TO-99 pkg |
| D | OPA129B | 1 | 10-36 | 1.2 | 30 fA ${ }^{Z}$ | 0.1 | 500 | 2000 | 3 | 10 | 80 | 4 | 17 | 0.1 | 1 | 2.5 | - | 2 | - - - - - - - $\cdot$ | 12.00 | lowest / B for HV part |
| HV chopper |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| $\square$ | LTC1150 | 1 | 4.8-32 | $0.8^{\text {S }}$ | 10 | 100 | 0.5 | 10 | 0.01 | 0.05 | 110 | 1.8 | high | (1.8) | 2.5 | 3 | - | - n | $\cdot$ | 6.00 | only HV AZ w/int caps |
| ■ | ADA4638 | 1 | 4.5-33 | 0.85 | 45 | 90 | 0.5 | 4.5 | - | 0.08 | 130 | 1.2 | 66 | 100 | 1.5 | 1.5 | 4 | - 9 | $\cdot$ - - |  | 5 kHz noise spike |
| $\square$ | OPA2188 | 1,2,4 | 4-40 | 0.42 | 160 | 850 | 6 | 25 | 0.03 | 0.09 | 120 | 0.25 | 8.8 | 750 | 2 | 0.8 | 27 | - 9.5 | - $\cdot$ $\cdot$ - - - $\cdot$ | new |  |

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0354.jpg?height=2064&width=1453&top_left_y=223&top_left_x=289)

Finally, the so-called chopper-stabilized (here and in Table 5.6 on page 335) amplifiers form the most important exception to the generalization that FET op-amps, particularly MOSFET types, suffer from larger initial offsets and much larger drifts of $V_{\text {OS }}$ with temperature and time than do bipolar-transistor op-amps. In fact, these devices (known also as auto-zero or zero-drift amplifiers) are the amplifiers with the smallest offset voltage and drift, typically in the $\pm 1 \mu \mathrm{~V}$ and $\pm 0.05 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ range. They use MOSFET analog switches and amplifiers to sense, and correct, the residual offset error of an ordinary op-amp (which itself is often built with MOSFETs, on the same chip). This is not without compromise, however: chopper-stabilized amplifiers have some unpleasant characteristics that make them unsuited for many applications, as we'll see in §5.11.

### 5.10.2 Number per package

The first column in Table 5.5 gives the choices available for the number of devices per package (the number in boldface shows which choice matches the part number). We generally list single op-amp parts, even though in practice the dual op-amps are more useful and popular (in some cases distributors don't even stock the single types). Special features such as pins for external offset-nulling, compensation, and shutdown are available only for the single op-amp package types and are indicated in the right-hand columns. Generally the specs are identical for the different dies and appear on the same datasheet, but not always.

### 5.10.3 Supply voltage, signal range

It's likely your first consideration will be supply-voltage range and signal levels. High-voltage parts (able to operate from $\pm 15 \mathrm{~V}$, i.e., 30 V total) are listed first in the table,

[^239]with parts ordered more or less by $I_{\mathrm{Q}}$, the quiescent supply current, in each category. Battery-powered applications benefit from low supply currents, but some low-drift applications do as well, because op-amp self-heating temperature effects will be less. Some parts offer a version with a power-shutdown (SHDN) pin. For example, the LT6010 current drops from $135 \mu \mathrm{~A}$ to $12 \mu \mathrm{~A}$ in shutdown (but a gotcha: the shutdown pin itself takes another $15 \mu \mathrm{~A}$ ) and it takes $25 \mu$ s to turn ON or OFF. Other parts do better, e.g., the OPA364 draws $0.9 \mu \mathrm{~A}$ when off.

Circuits operating with high-voltage supplies benefit from using high signal levels, such as $\pm 10 \mathrm{~V}$ full scale. An offset voltage, say $V_{\mathrm{OS}}=40 \mu \mathrm{~V}$, is a smaller fraction of 20 Vpp than it is of 0 to 4 V . With the exception of chopper op-amps, you don't get any offset-voltage improvement for low-voltage parts.

Low-voltage parts finish the table (most are 5.5 V maximum total supply, but some permit 11 V or higher, suitable for $\pm 5 \mathrm{~V}$ operation), but it's important to realize that many "high-voltage" parts are designed and specified to work well at low voltages, even under 3 V . Some work well with $\pm 3 \mathrm{~V}$ to $\pm 5 \mathrm{~V}$ supplies and should not be rejected simply because they can also work at higher voltages. But be warned, you need to examine the common-mode input range and output-swing range. For example, although a 44 V op-amp like the LT1490 works with 3 V supplies and allows rail-rail inputs and outputs, another fine 44 V LTC op-amp, the low-noise LT1007 (which works down to 4 V ) is limited to inputs and outputs no closer than 2 V from the rails - nearly useless when running from $\pm 2 \mathrm{~V}$. Clearly it's not meant to be a low-voltage part. Your quick guide to these issues is the "swing to supply" columns; the LT1490 has all four checks whereas the LT1007 has no checks.

### 5.10.4 Single-supply operation

If you're running with low supply voltages, you may want to use a single-supply power arrangement. Op-amps capable of single-supply use have at a minimum the ability to operate their inputs and outputs to the negative rail (i.e., ground). Many permit operation with outputs also to the positive rail, and claim rail-to-rail outputs on the front page of the datasheet. But be warned, there's usually a performance degradation when outputs are near the supply rails. Some op-amps offer zero-volt or below-the-rail operation if you add a pulldown resistor. ${ }^{33}$

Seven high-voltage op-amps on our list offer single-

[^240]supply operation; some, like the LT1013, excel at it. Two offer full rail-to-rail input-output, or RRIO, operation. The fast-slewing TLE2141 is especially interesting (fast settling, but high bias current), as is the low-noise LT1677 (lower bias current, but slow slewing and settling). All but two of the low-voltage parts offer single-supply operation.

There are some precision op-amps with low supply currents, down to $10-60 \mu \mathrm{~A}$, although this will severely limit your choices for other parameters. There's even a respectable $0.85 \mu \mathrm{~A}$ (and 1.8 V ) op-amp, the LT6003. Some op-amp types, such as the JFETs, don't offer any lowpower parts. Nonetheless you might choose one for its low noise and low bias current.

### 5.10.5 Offset voltage

Perhaps the single parameter most often associated with precision amplifiers is input-voltage error. To measure small offset voltages, use the op-amp's gain to magnify the effect, as shown in Figure 5.36. Offset voltage was our required parameter to gain entry into the table; few op-amps with maximum offset voltages above $250 \mu \mathrm{~V}$ made the grade. There are plenty of parts with $<10 \mu \mathrm{~V}$ typical offset voltages, but "typical" isn't a reliable spec when you're in the business of manufacturing precision instruments. Bipolar input stages have an advantage over JFET and CMOS in the table, but they suffer from higher input bias currents. The "superbeta" parts are a pleasant exception, especially at high temperatures (see Figure 5.38), but none of these parts has inputs that operate to either supply rail.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0356.jpg?height=246&width=572&top_left_y=1487&top_left_x=306)

Figure 5.36. Offset-voltage test circuit. The $\times 1000$ voltage gain makes submillivolt offsets in the device under test (DUT) easily measurable. Input current effects are negligible, owing to the small $(10 \Omega)$ resistances seen at the op-amp's inputs. Add a $200 \Omega$ resistor at the output if you want to drive a cable.

Many low-offset parts have disappeared since the second edition of our book, especially in the JFET category. They've become too expensive for the market and have lost the competition with low-voltage chopper and auto-zero op-amps. The latter have a few token representatives in this

[^241]table, but they have their own selection table (Table 5.6 on page 335) that you should examine if they look good for your design. They have their own problem issues, such as current noise, which we discuss in $\$ 5.11$.

Offset voltage variation with common-mode input voltage is a serious issue for some parts, especially for RRIO op-amps (see Figure 5.29), and is not addressed on the table. It's always important to follow up an initial choice from the table with a careful examination of the datasheet. For example, the OPA364 and MAX9617 use internal charge pumps to power their input stages, eliminating this problem completely.

Offset voltage drift with temperature is an important parameter when stability of measurements matters. This parameter is not production tested. The maximum drift spec may not be very reliable, and some manufacturers have stopped providing such a spec.

Offset voltage drift with time is a parameter that used to appear in precision op-amp datasheets, with values of order $300-400 \mathrm{nV} /$ month; a few high-performance parts like the LT1007 claimed $200 \mathrm{nV} /$ month, and chopper-stabilized op-amps generally claim drifts of $50 \mathrm{nV} /$ month. ${ }^{34}$ This is somewhat uncharted territory, and some people claim that drift slows with time, or perhaps it is more akin to a random walk, in either case suggesting that a drift specification should perhaps have units of $n V / \sqrt{\text { month. }}$.

### 5.10.6 Voltage noise

Voltage noise is the in-band variation of op-amp inputoffset voltage that's indistinguishable from signal. It's useful to view it as a "noise spectral density" function $e_{\mathrm{n}}(f)$, which tells you the rms noise voltage in a 1 Hz bandwidth (see $\S 8.2 .1$ ) centered at frequency $f$. Figure 5.37 shows an idealized plot of input voltage-noise density as a function of frequency for some of the op-amps in the table. For most op-amps $e_{\mathrm{n}}(f)$ is essentially flat for frequencies above its " $1 / f$ corner frequency," with $e_{\mathrm{n}}$ increasing below the corner frequency, approximately as $1 / \sqrt{f}$. (Autozero, or "chopper-stabilized," op-amps are not shown. They behave differently, because low-frequency "noise" is removed by the auto-zero process, so their $e_{\mathrm{n}}$ is flat at low frequencies. We'll discuss them shortly; see $\$ 5.11$.)

The voltage-noise column in Table 5.5 (pages 320-321) shows $e_{\mathrm{n}}$ at its commonly specified frequency of 1 kHz ,
${ }^{34}$ Although it's possible to do considerably better, for example the measured $6 \mathrm{nV} /$ month reported by Bob Pease for the LMP2011. See Table 8.3 and Figures 8.60, 8.61, 8.110, and 8.110. The IF3602 is a largegeometry dual JFET available from InterFet, shown for comparison.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0357.jpg?height=639&width=795&top_left_y=219&top_left_x=123)

Figure 5.37. Voltage noise density $e_{\mathrm{n}}$ for a selection of representative op-amps, showing the increase of noise power below the $1 / f$ corner frequency. Some op-amps that have good specs at 1 kHz don't look so good at 0.1 Hz . Figure 5.54 shows the resulting voltage noise $v_{\mathrm{n}}$ when such a noise density is integrated over frequency.
comfortably in the flat region above the $1 / f$ corner of most op-amps; $e_{\mathrm{n}}$ varies from $0.85 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the high-current LT1028 to $325 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the current-starved LT6003.

We discuss noise in greater detail below, and in Chapter 8 , but let's start with the simple relationship relating voltage-noise density $e_{\mathrm{n}}$ (given in units of $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) to the value of integrated total voltage noise $V_{\mathrm{n}}$ (in units of nV , or $\mu \mathrm{V}$; and either rms or peak-to-peak) over some frequency passband. In the flat (i.e., white noise) region of $e_{\mathrm{n}}$ at frequencies above the $1 / f$ corner, the integrated noise voltage is simply $V_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{\mathrm{BW}}$.

As we'll see, for circuits with bandwidths of $1-10 \mathrm{kHz}$ or more, the noise voltage $V_{\mathrm{n}}$ is dominated by the noise density at high frequencies. Datasheets for most op-amps give an $e_{\mathrm{n}}$ value at 1 kHz , but some also specify it at $10 \mathrm{kHz}, 100 \mathrm{kHz}$, or even 1 MHz ; and they usually provide graphical plots of $e_{\mathrm{n}}$ versus frequency. Because the integrated noise voltage is dominated by $e_{\mathrm{n}}$ at the highfrequency end of the operating range, be sure to use that value (or a frequency-weighted eyeball average) in the simple formula above. Using a high-frequency $e_{\mathrm{n}}$ value is particularly important for transimpedance amplifiers, which suffer from " $e_{\mathrm{n}} \omega C$ " current noise ( $i_{\mathrm{n}}=e_{\mathrm{n}} 2 \pi f C_{\mathrm{in}}$ ) at high frequencies.

#### A. "1/f" noise

We discuss $1 / f$ noise in greater detail in Chapter 8 (where we show how to determine the $1 / f$ noise corner, etc., in §8.13.4, but here we address the practical question "What effect do the scary-looking rising noise-density curves in Figure 5.37 have on my circuit noise?" The noise density $e_{\mathrm{n}}$ is indeed higher at low frequencies, but that density gets multiplied by a smaller frequency span. Put another way, the total noise voltage (as contrasted with the noise density $e_{\mathrm{n}}$ ) contributed by an op-amp depends both on its $e_{\mathrm{n}}$ and on the circuit's bandwidth. More precisely, the mean square noise voltage is the integral of $e_{\mathrm{n}}^{2}$ over the bandpass:

$$
v_{n}^{2}=\int_{f_{a}}^{f_{b}} e_{\mathrm{n}}^{2}(f) d f
$$

where $e_{\mathrm{n}}(f)$ is the noise spectral density (often plotted in datasheets), and the bandpass (or observation band) extends from $f_{a}$ to $f_{b}$. We then get the rms noise voltage by taking the square root of $v_{\mathrm{n}}^{2}$.

We perform the integrations and show the devastating effects of $1 / f$ noise in the integrated-noise plots later, in Figure 5.54 (in the context of auto-zero op-amps). More bandwidth means more noise, and all of the curves rise as $\sqrt{f}$ at the high end. The op-amps are ranked in order by their high-frequency $e_{\mathrm{n}}$ values; it's interesting to compare their positions in Figure 5.37 with the rankings in Figure 5.54. At the low frequency end, the noise voltage of conventional op-amps levels off, because their rising $1 / f$ noise density makes up for the reduced bandwidth, ${ }^{35}$ whereas the noise voltage of the auto-zero amplifiers continues its downward trend.

Let's use Figure 5.54 to explore a revealing example. The LT1012 has an $e_{\mathrm{n}}$ (at 1 kHz ) of $14 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and a 2.5 Hz corner frequency. ${ }^{36}$ If it were used in a precision amplifier with a high-frequency cutoff beyond 1 Hz , for example, it would be less noisy than an OPA277, even though the latter has a lower noise density at 1 kHz of $8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, because the latter has a 20 Hz noise corner (indicated by black dots). But the OPA277 wins back some respect when we see that it's dramatically quieter than a competing $9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ part, the TLC2272, which suffers from a much higher 330 Hz noise corner. ${ }^{37}$

[^242]The integrated-noise plots are revealing, but it's helpful to have a single number in the table to evaluate our op-amps. The " $V_{\mathrm{n} p}$ " parameter in the table is the peak-to-peak voltage noise over a $0.1-10 \mathrm{~Hz}$ band. This shows an op-amp's "dc noise" as seen in the flat part of the curves in Figure 5.54. The values range up to $11 \mu \mathrm{Vpp}$ (but parts like the LMC6482 avoid the competition by not listing any spec at all). The LT1028 is the winner with 35 nVpp , but the LMP7731 is a notable part at 80 nVpp , with its RRIO capabilities and its SOT-23 package. The ADA4075, with its 1 mV offset, didn't make the precision table, but its 60 nVpp noise level is attractive.

Precision op-amps that suffer from $1 / f$ noise (i.e., all except auto-zero types) have a $V_{\mathrm{n}} \mathrm{pp}$ spec whose lower frequency limit is usually 0.1 Hz . If you need a lower starting frequency (such as 0.01 Hz , used in the plots), multiply the low-frequency noise-voltage value listed by the square root of the number of additional low-end decades you want (that's an interesting $1 / f$ noise factoid). As long as the $1 / f$ corner is multiple decades higher, you can ignore the white-noise contribution to the spectrum.

The $V_{\mathrm{n}} \mathrm{pp}$ parameter is your primary clue about an opamp's long-term drift performance.

### 5.10.7 Bias current

The available input bias currents range from femtoamps to microamps (nine orders of magnitude!). In some applications this is the parameter that rules out entire classes of op-amp choices. Parts featuring very low typical input currents often have unimpressive maximum specs; this is due to the difficulty and expense of automated testing at currents below 10 pA or so. For example, the $\$ 1.88$ low-cost LMC6482A CMOS op-amp has a 20 fA "typical" spec, but the datasheet shows a 4 pA maximum value - that's $200 \times$ worse. ${ }^{38}$ However if you're willing to pay over $\$ 10$, you can get an LMP7721 with a 20 fA maximum spec.

As we've said earlier (and will say again), the "bias" current of JFET and CMOS op-amps is a leakage current, and it increases exponentially with temperature; see Figure 5.38. That's the bad news. The good news (as we've also said before) is that there are some op-amps (like the LT1012 and AD706) that have low JFET-like input currents, but which have BJT inputs and therefore enjoy better

[^243]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0358.jpg?height=593&width=812&top_left_y=221&top_left_x=1063)

Figure 5.38. Input current versus temperature for a representative set of op-amps from Table 5.5 on pages 320-321, taken from manufacturers' datasheets. See also Figures 5.6 and 3.48.
high-temperature performance and improved offset voltages and drift, see Figure 5.6.

Low-input-current op-amps generally have higher offset voltage and offset voltage drift, and they're usually more noisy. The OPA627 and ADA4627 JFET op-amps are exceptions, and they've served us well, but they're expensive. Happily the new JFET OPA827 has lower noise and offers some price relief. The AD743, not in the table because of its 1 mV offset voltage, sports a $2.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ spec. Looking at CMOS parts (which are low voltage), we find that the LMP7715 is the best low-noise contender, at $5.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, but a low-cost part like the AD8616, with 1 pA bias and $7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ noise, may offer a good compromise.

High-speed op-amps often have high input bias currents, typically 200 nA to as much as $20 \mu \mathrm{~A}$. They also tend to have high offset voltages, above 0.5 mV , so most parts in this category didn't even make it into the precision table, but appear in the high-speed op-amp category in Table 5.4 on page 310. TI's fast OPA656 and ' 657 low-voltage JFET op-amps, with 2 pA typical bias current, $290 \mathrm{~V} / \mu \mathrm{s}$ slew rate, and 20 ns settling time, demanded and were granted residence in both tables. The OPA380 is a 90 MHz opamp meant for fast transimpedance applications, featuring 50 pA and $25 \mu \mathrm{~V}$ maximum offset. This part uses an autozero circuit to achieve $25 \mu \mathrm{~V}$ offset, but avoids excess current noise with an isolating filter (Figure 5.41).

#### A. Measuring bias current

To measure input currents (or offset currents) down to the nanoamp level or so, you can use the simple circuit in Figure 5.39. For really small currents, though, you've got
to play some clever tricks: a current down in the femtoamps $\left(10^{-15} \mathrm{~A}\right)$ develops only microvolts across a gigaohm! (And you'll never see that, because offset voltages are much larger.) Instead, accumulate the tiny input current in an integrator (itself constructed with an ultra-low-input-current op-amp), as shown in Figure 5.40A. ${ }^{39}$ Here the short length of shielded cable (with Teflon dielectric) serves as the integrator's feedback capacitance $C_{1}$ (standard $50 \Omega$ coax has a capacitance of almost exactly $1 \mathrm{pF} / \mathrm{cm}$, see Appendix H). You can watch the ramp directly, or, if you want to get fancy, add a differentiator as shown.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0359.jpg?height=363&width=578&top_left_y=714&top_left_x=198)

Figure 5.39. Input current (set one of the $R_{\mathrm{s}}$ 's to zero) and input offset current ( $R_{s 1}=R_{s 2}$ ) test circuit. Use $R_{\mathrm{S}}$ values large enough so that the voltage developed across them is at least some 10s of millivolts, so that errors due to offset voltage can be ignored. Add a $200 \Omega$ resistor at the output if you want to drive a cable.

A somewhat simpler method, which has worked well for us, is to wire the op-amp as a follower, with a small capacitor from the (+) input to ground (Figure 5.40B); the op-amp's input current then generates an input ramp, faithfully reproduced at the output. At first we struggled with memory effects in mica and film capacitors, but we finally settled on an air (variable) capacitor, of the sort that were used to tune AM radios in the good ol' days. With the capacitor set to 365 pF we got an output ramp of $0.20 \mathrm{mV} / \mathrm{s}$ from an LMC6482, and thus an input current of 73 fA . You can "reset" this circuit by collapsing the supply rails. Be sure to put the whole business in a metal box: these open inputs are really sensitive beasts!

[^244]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0359.jpg?height=896&width=802&top_left_y=205&top_left_x=969)

Figure 5.40. Integrate the input current to measure in the picoamp range (and below). A. With a separate MOS-input op-amp integrator whose input current is in the low femtoamps (e.g., an LMP7721, $I_{B}=3 \mathrm{fA}$ typ, 20 fA max ). Use electromechanical relays (not MOS switches) for $S_{1}$, for example the COTO 9202 series shown in Figure 5.3. B. More simply, let the device's input current charge a small capacitor, and observe the ramp at the $G=1$ output.

### 5.10.8 Current noise

The op-amp's input current noise density $i_{\mathrm{n}}$ flows through the source impedance seen at the amplifier's input terminals, contributing an equivalent noise voltage density $i_{n} Z_{s}$; this is often negligible compared with the amplifier's $e_{\mathrm{n}}$. We can define a "noise impedance" for the op-amp, $Z_{\mathrm{n}} \equiv e_{\mathrm{n}} / i_{\mathrm{n}}$, so that we can safely ignore current noise when the source impedance $Z_{\mathrm{s}} \ll Z_{\mathrm{n}}$.

Typical $i_{\mathrm{n}}$ values range from $0.1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ to $50 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ for CMOS and JFET op-amps, and up to $5 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ for low-noise BJT-input op-amps that operate at relatively high input currents. The superbeta BJT LT1012 (with its low input current) does considerably better, at $20 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. But note that the high- $i_{\mathrm{n}}$ LT1028 is the voltage-noise winner, for which we pay the penalty of high current noise. Its noise impedance $Z_{\mathrm{n}}=850 \Omega$, which means that unusually low circuit resistances must be used, say $300 \Omega$ or less, to obtain the full benefit from its low voltage noise. By contrast, the BJT LT1013 single-supply op-amp has $Z_{\mathrm{n}}=315 \mathrm{k} \Omega$, a comfortably high value.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0360.jpg?height=695&width=807&top_left_y=221&top_left_x=211)

Figure 5.41. The OPA380 achieves $4 \mu \mathrm{~V}$ typical voltage offset using an auto-zero feature, yet it has only $10 \mathrm{f} \mathrm{A} / \sqrt{\mathrm{Hz}}$ current noise at 10 kHz . It is ideal for transimpedance applications such as the photodiode preamp shown here.

The manufacturer's spec gives the current-noise density at a high frequency like 1 kHz or 10 kHz , chosen to be well above the current-noise $1 / f$ corner frequency. The current-noise $1 / f$ corner typically comes at much higher frequencies than the voltage-noise $1 / f$ corner. For example, the OPA277 has a 20 Hz voltage-noise corner, but a 200 Hz current-noise corner; for an LT1007 it's 2 Hz and 120 Hz . The differing $1 / f$ corner frequencies mean that we'll get different $Z_{\mathrm{n}}$ values at low frequencies. Returning to the LT1028, for example, its relatively higher current noise at low frequencies lowers $Z_{\mathrm{n}}$ to $212 \Omega$ at 10 Hz . This requires that we push down further our circuit resistances for optimum performance, to $100 \Omega$ or less.

At high frequencies the current noise may consist largely of the fundamental (and unavoidable) shot noise, the statistical fluctuations of electron flow (eq'n 8.6). For an input bias (or leakage) current $I_{\mathrm{B}}$ that lower bound is $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{B}}}$; for a bias current of 10 pA that evaluates to $i_{\mathrm{n}}=1.8 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (from which you can conveniently scale up or down by the square root of $I_{\mathrm{B}}$ ). The typical and maximum bias-current specs vary widely, as we saw; evidently many manufacturers simply list the calculated shot-noise value corresponding to the typical bias-current spec. For example, the LT1013 has $I_{\mathrm{B}}=12 \mathrm{nA}$ typ, from which we can calculate a current-noise density of $62 \mathrm{fA} / \sqrt{\mathrm{Hz}}$; the manufacturer's spec is $70 \mathrm{fA} / \sqrt{\mathrm{Hz}}$.

An important exception comes in the case of BJTinput op-amps with bias-current cancellation circuits: that greatly reduces the dc input current, but not the cur-
rent noise. For example, the LT1007, with its quiet $e_{\mathrm{n}}=2.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, has a 10 nA bias-current spec, from which we calculate a shot-noise current of $56 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, but the manufacturer's spec is $i_{\mathrm{n}}=400 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. That's seven times too high! What's going on? To achieve low-noise voltage they run the input transistors at high collector currents. That creates a high base current, which would be the op-amp's input current if they hadn't used the old base-current-cancellation trick ( $\S 4$ x.10). So the dc bias current is small, but the current noise is large. The ultralow$e_{\mathrm{n}}$ LT1028 also uses bias-current cancellation, keeping its bias current down to 25 nA , but with a current noise 10 times higher than the calculated shot-noise value. And for the LT6010, whose input current is brought down to just 20 picoamps (the kind of low currents you see in FETinput op-amps), the current noise is 40 times larger than calculated shot noise.

In other words, it's important to realize that the input noise current of a bias-cancelled op-amp will be considerably larger than you would expect if you were to calculate the shot noise arising from the net (i.e., cancelled) input bias current. Rather, you need to calculate the shot noise from the uncancelled base currents (and then apply a factor of $\sqrt{2}$ to account for the additional noise in the cancellation current). For example, using the LT6010's value of $I_{\mathrm{B}}= \pm 20 \mathrm{pA}$ (typ), you'd incorrectly estimate a shot noise current of $i_{\mathrm{n}} \approx 2.5 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, whereas the datasheet lists a typical value (at 1 kHz , well above the $1 / f$ corner) of $100 \mathrm{fA} / \sqrt{\mathrm{Hz}}$; similarly for the LT1028 (which specifies $1000 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, versus the $90 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ you would incorrectly estimate from the net $I_{B}$ ). Table 5.5 does not tell you if a BJT amplifier employs bias-current cancellation, but there's a convenient bias-cancel column in the low-noise BJT op-amp Table 8.3a on page 522. Op-amps with biascurrent cancellation generally do not have rail-to-rail input stages. ${ }^{40}$
A caution: some datasheets list greatly optimistic values for $i_{\mathrm{n}}$, evidently making exactly this error. For example, the bias-cancelled LT1012's datasheet shows a typical $i_{\mathrm{n}}$ leveling off to $6 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (beyond the $1 / f$ corner), which is what you'd calculate from the specified net (i.e., cancelled) input current of $\pm 100 \mathrm{pA}$ max, whereas you would expect a value about 10 times larger (assuming the uncancelled

[^245]base current is about $100 \times$ larger). We were skeptical of the datasheet's claimed $i_{\mathrm{n}}$, so we measured it (along with others that appeared to be similarly in error), and found ${ }^{41}$ $i_{\mathrm{n}} \approx 55 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. This error shares some of the characteristics of an epidemic, having infected also the datasheets of auto-zero op-amps. For example, the exemplary AD8628A (listed in Table 5.6 on page 335) specifies an input noisecurrent density of $5 \mathrm{fA} / \sqrt{\mathrm{Hz}}$; imagine our surprise when we measured a value 30 times larger. Not to be outdone, the MCP6V06 auto-zero op-amp's specification of $0.6 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ is rather at odds with its measured $170 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. See the discussion in §§5.11.

It's important to note that, in the case of chopper and auto-zero op-amps, the input current noise spec is usually given at a low 10 Hz frequency, because that's below the region of very high switch charge-injection current noise (see $\S 3.4 .2 \mathrm{E}$ ). If you take the trouble to measure an auto-zero's input noise, you'll see something like the plots shown in Figure 5.52. This is an unfortunate situation, with insufficient guidance (and perhaps deliberate obfuscation) from manufacturers. We discuss this further in $\S 5.11$.

### 5.10.9 CMRR and PSRR

The common-mode rejection ratio, CMRR, tells how much the input offset voltage $V_{\mathrm{OS}}$ varies with common-mode input voltage. The problem, of course, is that such a change in $V_{\mathrm{OS}}$ masquerades as a change in the input signal voltage.

The CMRR values vary from 70 dB (min) for our favorite LMC6482 (an inexpensive CMOS dual op-amp), up to 130 dB for the precision OPA277. Degradation of CMRR at high frequencies often matters, and there's usually a plot in the op-amp's datasheet (check out a few for yourself, for example these two; we show CMRR plots for other types of op-amp in Figures 5.73 and 5.82). For example, the LMC6482 typical CMRR starts falling upward of 1 kHz , and it's down to 80 dB at 10 kHz . It's interesting that both the OPA277 and the AD8622 (another expensive high performer at dc) degrade to about 80 dB by 10 kHz , joining our jellybean CMOS friend. Other parts do better, such as the LT1007 (114 dB typ at 10 kHz ). And to repeat a warning we made elsewhere: the CMRR spec often applies to only a limited common-mode range; read the datasheet carefully.
Note this universal cure: a time-honored way to avoid CMRR troubles is to use an inverting configuration.

[^246]The power-supply rejection ratio, PSRR (not shown in Table 5.5 (pages 320-321) tells how much $V_{\text {OS }}$ varies with power-supply voltage. Typical dc values are $60-80 \mathrm{~dB}$ for the LMC6482, up to 130 dB for the OPA277 (but only 100 dB for the AD8622). Study your datasheets!

Frequently one rail is much worse than the other, especially for ac PSRR, because of the op-amp's compensation capacitor (see Figure 4.43, where $Q_{5}$ and $Q_{6}$ are referenced to the negative rail). For example, the OPA277 suffers by an extra 25 dB on its negative rail. The ac PSRR is significant in two regions, $100-120 \mathrm{~Hz}$ (and harmonics) for power-supply ripple, and at high frequencies for cross-talk from other circuitry.

A common defense against PSRR problems, in sensitive applications such as low-level input stages, is to add an $R C$ filter in the supply rails.

### 5.10.10 GBW, $f_{\mathrm{T}}$, slew rate and " $m$," and settling time

It's tempting to think one can never have too much GBW (gain-bandwidth product, or $f_{\mathrm{T}}$, its original name that we favor, see Figure 5.42). After all, a higher GBW means greater loop gain, and higher loop gain means lower error (gain, phase, distortion). What's more, with higher $f_{\mathrm{T}}$ we're well on our way to having a faster slew rate, via the formula $S=0.32 m f_{\mathrm{T}}$ as discussed in detail in $\S 4 x .9$.

Furthermore, a faster slew rate means a greater fullpower bandwidth (FPBW): a sinewave $V(t)=A \sin \omega t$ has a peak slew rate $S=\omega A$, so $\mathrm{FPBW}=S / \pi V$ pp. Finally, because the first step on the way to waveform settling is the slewing delay $t=\Delta V / S$, a higher $f_{\mathrm{T}}$ is an important step (and often the primary determinant), toward a faster settling-time spec. The data in Tables 5.4 (page 310), and 5.5 (pages 320-321) let you explore the essential question "what price higher bandwidth?"

#### A. An aside: GBW and $f_{\mathrm{T}}$

First, a short riff on "GBW" and " $f_{\mathrm{T}}$." Figure 5.42 shows a plot of open-loop gain versus frequency for a THS4021 wideband op-amp. This is a "decompensated" op-amp, stable for closed-loop gains $\geq 10$, with a textbook Bode plot. The term GBW properly describes the product of openloop gain times frequency in the region in which the gain is dropping at $6 \mathrm{~dB} /$ octave (i.e., $G_{\mathrm{OL}} \propto 1 / f$ ). Its extrapolation crosses the $G_{\mathrm{OL}}=0 \mathrm{~dB}$ axis at a frequency equal to GBW. At that frequency, however, the gain is less than unity, owing to the effect of additional higher-frequency poles in the amplifier. Strictly speaking, the symbol $f_{\mathrm{T}}$ is used for the (lower) frequency at which $G_{\mathrm{OL}}=1$.

But we like the simpler variable $f_{\mathrm{T}}$, and so do plenty of other folks; so it's loosely used in place of GBW. Perhaps this is excusable, given that $f_{\mathrm{T}}$ is pretty close in value to GBW for op-amps that are compensated for stability at unity gain (this describes most op-amps). In any case, unless stated otherwise, we will use $f_{\mathrm{T}}$ to mean GBW.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0362.jpg?height=562&width=779&top_left_y=497&top_left_x=228)

Figure 5.42. An op-amp's gain-bandwidth product (GBW) is the frequency at which the extrapolation of the open-loop gain curve crosses the unity-gain axis. It's often loosely called " $f_{\mathrm{T}}$ " though the latter is properly the frequency at which the closed-loop gain is unity. The arrows indicate the dominant and second poles. The data here are taken from the THS4021 datasheet, which also shows the phase shift reaching $180^{\circ}$ by 400 MHz .

#### B. Milking stools and barstools

If offset voltage is one leg of the precision op-amp stool, ${ }^{42}$ bandwidth and speed certainly comprise another. Many of the fast op-amps we wanted to include in the precision Table 5.5 (pages 320-321) were passed over because they had too much offset voltage - so some of them have gotten their own Table 5.4 (page 310). For example, in that table we have the LT6200, with 165 MHz GBW, $0.95 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and 1.0 mV of offset. It's a conventional voltage-feedback (VFB) op-amp offering $50 \mathrm{~V} / \mu \mathrm{s}$ slewing and 140 ns settling time, so whatever is wrong with it? Only $50 \mathrm{~V} / \mu \mathrm{s}$, with $m=1$ ? A limited $10 \mathrm{~V}( \pm 5 \mathrm{~V})$ supply with a high 16.5 mA current? And a very high $40 \mu \mathrm{~A}$ (!) max bias current? The point here is that there's a price to pay for high $f_{\mathrm{T}}$, and maybe this part is not so attractive after all. But at least the LT6200 has less than $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of noise,

[^247]$1 \%$ distortion at 50 MHz , and it's even RRIO to boot. ${ }^{43}$ And there's the LT6200-10 variant, with 1.6 GHz of GBW. Nice!

We did include some admirable high-speed op-amps in Table 5.5, (pages 320-321), overlooking in one case an, uh, underwhelming $V_{\mathrm{OS}}$. One such favorite of ours is the OPA656, a member of a small family of highly useful op-amps offered by the Burr-Brown division at TI: it combines 230 MHz GBW, $290 \mathrm{~V} / \mu \mathrm{s}$ slew rate, and 20 ns settling time. With its 2 pA JFET inputs having less than 3 pF of input capacitance, we readily forgive its 1.8 mV offset voltage, and we're happy enough with its $7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of input voltage noise. It is excellent for a transimpedance amplifier of the sort used with photodiodes see $\S \S 4 x .3$ and $4 x .9$. The OPA656 even has a distortion plot in Figure 5.44 (see next subsection), where we see it has less than $0.1 \%$ distortion to 10 MHz and beyond. And it has a 1.6 GHz cousin, the OPA657. When we need higher operating voltage, and crave lower $e_{\mathrm{n}}$, we turn to the $4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ OPA637; it has somewhat greater capacitance $(7 \mathrm{pF})$, and less bandwidth ( 80 MHz ). And there's the 90 MHz OPA380 shown above. Very fine products from BB/TI.

On the subject of low distortion, Linear Technology offers the LT1468 ( $90 \mathrm{MHz}, 75 \mu \mathrm{~V}$, $\pm 15 \mathrm{~V}$ supply), which claims 0.7 ppm distortion with a 10 V signal; and with its $0.8 \mu \mathrm{~s}$ settling time, it's a good candidate to feed hungry ADCs. Not to be outdone, National Semiconductor offers the LMP7717, a CMOS op-amp with an $88 \mathrm{MHz} f_{\mathrm{T}}$, yet drawing just 1 mA , working down to a 1.8 V total supply (!), and offering $1 \mathrm{pA} I_{\mathrm{B}}, 6 \mathrm{nV} / \sqrt{\mathrm{Hz}} e_{\mathrm{n}}$, and $150 \mu \mathrm{~V} V_{\mathrm{OS}}$ input specs, along with rail-to-rail outputs. Parts like these suggest that maybe we can have our speed + precision cake and eat it too.

### 5.10.11 Distortion

Although much of the precision analog-design field concerns dc and low frequencies, there are applications that require accuracy at higher speeds: audio and video, communications, scientific measurement, and so on. With falling op-amp loop gain, input errors are rising, output impedance is rising, and slew-rate limitations may come into play. We need a way to evaluate an op-amp's performance at mid to high frequencies. Some manufacturers help by providing harmonic distortion curves in their datasheets. If

[^248]it's painful going through hundreds of datasheets looking for tabulated specs to compare, it's doubly painful leafing through their back pages looking for distortion curves.

Here we provide some "value added" (hey, this book isn't cheap!) by compiling distortion plots from the datasheets of fifty selected high-performance op-amps: Figure 5.43 (for high-voltage op-amps) and Figure 5.44 for low-voltage and RR-output op-amps (including some HV types). The op-amps listed in Tables 5.4 (page 310) and 5.5 (pages 320-321) have a check in the "dist graph" column if they appear in one of these graphs. We've also measured the distortion and made plots for some popular older opamps that don't have datasheet plots; see Figure 5.19.

Burr-Brown/TI's OPA134 and OPA627, along with National Semi's LME49990 and other LME49700-series opamps, are the winners in the high-voltage category. LTC's LT1468 stands out as well. Analog Devices' AD8021 stands out at high frequencies, and they often recommend it for driving ADCs. TI's THS3061, which has an impressive $7000 \mathrm{~V} / \mu$ s slew rate, looks pretty good above 100 kHz , and as a bonus it can deliver 145 mA into $50 \Omega$. The OPA1632 and LME49724 are fully differential amplifiers, see §5.17.

The low-voltage and RR op-amp table comprises mostly parts running from $\pm 5 \mathrm{~V}$ supplies, or lower. Most of these have rail-to-rail outputs, demonstrating that RRO op-amps can compete in the precision arena. Some low-voltage opamps are at a disadvantage relative to their HV cousins, because they have to use abnormally low signal levels. Consider the graph's OPA1641 JFET winner, at 0.5 ppm . It's a high-voltage part with RR outputs, and it gets tested with 8.5 Vpp signals, a luxury not available to the low-voltage RRO parts. The OPA376 is the low-voltage winner in this category, at 3 ppm , while being tested with 2.8 Vpp . It's interesting that both of these op-amps use the Monticelli output stage (see Figure 5.35 and $\S 4 x .11$ ).

#### A. Distortion: some caveats

Some caution is advised here: it's tempting to look at the distortion plots and think that you know how the op-amps compare. But some of the distortion measurements need to be taken with more than a grain of salt, and a few caveats are in order. First, there are no de facto standards for opamp distortion, and manufacturers have chosen different operating conditions. ${ }^{44}$ Some use THD, others THD+N (total harmonic distortion plus noise), and still others may

[^249]concentrate on specific distortion products, e.g., the 2 nd or 3rd harmonic. These hidden choices affect an op-amp's standing on the charts.

Second, the distortion plots sometimes reveal artifacts of the measurement process - for example, the curves in Figures 5.43 and 5.44 begin with a flat distortion profile starting at dc, which, however, often continues well past the frequency at which we know the op-amp's open-loop gain is falling (i.e., past the primary pole). This is contrary to expectations, and likely reveals a noise-floor instrumental limitation, rather than reality; i.e., the op-amp is better than advertised.

Third, the curves ultimately show the expected rising distortion at higher frequencies; this is due to internal opamp nonlinearities and to loss of loop gain, both within and outside the op-amp. But this region is heavily dependent on signal size and on load, with varying choices by different manufacturers. At some higher frequency the upward curve may steepen sharply. This is usually due to third-harmonic distortion. We cannot generalize about where second- or third-harmonic distortion will dominate for any given opamp, but it seems that second-order distortion is the most common culprit. This is surprising, given an effort in many op-amps to fully balance the design.

Fourth, when you're in the $<10 \mathrm{ppm}$ territory all kinds of strange things can bite you. As wise guru Jim Williams once remarked, "If you think you've measured something to 1 ppm , you're probably wrong." Figure 5.45 illustrates an often-overlooked issue. Here we have a precision OPA1641 op-amp that's capable of distortion performance below 1 ppm at 1 kHz , and in noninverting mode the op-amp has just over 20 ppm of distortion at 100 kHz . It's a JFET op-amp with 8 pF of input capacitance (reasonably low, especially considering the op-amp's low $5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ noise spec). In an admirable display of candor, the datasheet warns us that "The $n$-channel JFETs in the FET input stage exhibit a varying input capacitance with applied common-mode input voltage," and it provides plots of increasing distortion arising from an input source resistance driving the op-amp's dynamically-changing capacitance. For example, with $R_{\mathrm{s}}=600 \Omega$ the 100 kHz distortion increases dramatically, to 100 ppm . They suggest carefully matched input impedances to reduce this type of distortion (an effect that is not confined to this particular op-amp: be warned!). Better yet, use the inverting configuration.

Finally, a look at the test circuit used by many manufacturers to make sub- 100 ppm distortion measurements (Figure 5.46). The trick is to reduce op-amp's loop gain by a factor of 100 , thus increasing the distortion by the same factor; the reported distortion is then gotten by dividing the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0364.jpg?height=822&width=1294&top_left_y=214&top_left_x=399)

Figure 5.43. Harmonic distortion versus frequency for a selection of "high-voltage" ( $\geq 30 \mathrm{~V}$ total supply) op-amps, from manufacturers' datasheets.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0364.jpg?height=830&width=1304&top_left_y=1192&top_left_x=394)

Figure 5.44. Harmonic distortion versus frequency for selection of "low-voltage" ( $\leq 18 \mathrm{~V}$ total supply) op-amps, from manufacturers' datasheets. Most of these have rail-to-rail output stages. See also Figure 5.19.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0365.jpg?height=493&width=769&top_left_y=223&top_left_x=136)

Figure 5.45. The variation of input capacitance with signal voltage causes additional distortion at higher frequencies, dependent on source resistance.
measured distortion by 100. But an immediate concern is the artificial nature of the test, with the op-amp seeing an artificially low source impedance. It's safe to conclude that we all can likely benefit from further work in this area. ${ }^{45}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0365.jpg?height=233&width=590&top_left_y=1077&top_left_x=223)

Figure 5.46. Distortion test circuit. With the values shown, the opamp's effective loop gain is reduced by $\times 100$. Add a series resistor at the output if driving a cable.

### 5.10.12 "Two out of three isn't bad": creating a perfect op-amp

We recognized at the outset that there's no such thing as a perfect operational amplifier - but not to fear, there is usually a workaround. If you find the input performance specs you need in one op-amp, and the output specs in another, it may be possible to combine them into a "composite amplifier" circuit that acts as a single op-amp (combining the best features of each) in your feedback loop. Or you can create a composite op-amp by adding a discrete input or output stage to the op-amp IC of your choice. If your overall feedback circuit has very high gain, such as a $G=10,000$ amplifier, you may not need to worry about compensation (e.g., see Figure 5.61). However, it's not terribly difficult to

[^250]deal with the high loop gain of a $G=1$ circuit, as we show in §4x.5.

In Chapter $4 x$ 's discussion of composite amplifiers we show a robust amplifier configuration in which the second op-amp's gain is reduced to unity at a frequency well above the first op-amp's $f_{\mathrm{T}}$, allowing loop-gain flexibility. In addition, no restrictions are placed on common-mode voltages or amplifier input connections in this approach. It's a good configuration to consider, although as often as not you'll find plenty of variations in real-world composite amplifier implementations.

#### A. Design example: precise high-current piezo positioner

A nice application for a composite amplifier is a precision microscope stage positioner, implemented with a pair of multilayer piezo elements. These devices are both swift and stiff - our chosen part, for example, is good to tens of kilohertz and tens of kilograms - and they provide stable and accurate positioning (at the nanometer scale) over their limited motion (here $6 \mu \mathrm{~m}$ ). On the down side, they present a difficult load, being highly capacitive (here $0.75 \mu \mathrm{~F}$ ) and requiring relatively high drive voltage (here 100 V fullscale).

A suitable circuit is shown in Figure 5.47. We'd like a moderately fast response, say $1 \mathrm{~V} / \mu \mathrm{s}$ slewing speed, which requires $I=C d V / d t=1.5 \mathrm{~A}$ of drive capability into the piezo pair's $1.5 \mu \mathrm{~F}$ of capacitance. Our signal source is a 16-bit DAC8831, with a +5 V full-scale output ( $R-2 R$ ladder, $R_{\text {out }}=6.25 \mathrm{k} \Omega$ ) with a fast SPI interface. Running the DAC with a 5 V reference produces a least-significant bit (LSB) step size of $76 \mu \mathrm{~V}$. Its $R_{\text {out }}$ of 6.25 k requires an opamp whose input current is less than 12 nA in order not to add error greater than an LSB. And the op-amp has to swing to +100 V while driving $1.5 \mu \mathrm{~F}$.

So, we're evidently looking for a muscular $150 \mathrm{~V}, 1.5 \mathrm{~A}$ op-amp with an input offset less than $75 \mu \mathrm{~V}$, and bias current less than 10 nA . Looking, looking... no joy! No such part is available, so we'll solve the problem by rigging up a composite amplifier with a gain of 20 . We'll specify a frequency response to 25 kHz (which is about $20 \%$ of the piezo's mechanical self resonant frequency).

For the input op-amp we chose the AD8675 from Table 5.5 (pages $320-321$ ). It has low input errors ( $75 \mu \mathrm{~V}$ and 2 nA max), and enough output swing to drive a highvoltage $G=20$ stage. For our output amplifier we chose the Apex PB51, a power driver capable of 300 V and 1.5 A (but subject to a safe-operating-area constraint, for example limited to 130 V drop when driving 2 A for 100 ms ). Its maximum input errors are $1.75 \mathrm{~V}(!)$ and $70 \mu \mathrm{~A}(!)$ - that's
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0366.jpg?height=519&width=1386&top_left_y=215&top_left_x=353)

Figure 5.47. Precision composite amplifier for driving a $1.5 \mu \mathrm{~F}$ piezo positioner: output to 100 V and 1.5 A , with $75 \mu \mathrm{~V}$ maximum offset, 2 nA maximum input current, and response to 25 kHz . The specified piezo actuator moves $6 \mu \mathrm{~m}$ per 100 V .
why they call it a driver rather than an op-amp! Its gain is set with an external resistor, here $52.3 \mathrm{k} \Omega$ (for $G=20$ ) to match the desired overall gain.

The single feedback path $R_{1} R_{2}$ sets $G=20$ for the composite amplifier. A general scheme for compensating composite amplifiers is suggested in $\S 4 x .5$. Here we use a different scheme, with $C_{2}$ isolating the input op-amp $A_{1}$ from the output amplifier $A_{2}$ at frequencies above 25 kHz . That way we don't have to worry about $A_{2}$ 's response at high frequencies, where it's struggling with its capacitive load. This is really a "custom" configuration, forced on us by the, uh, challenging load; what is has in common with other composite amplifier configurations is the single overall feedback path that determines its gain over most of its operating regime.

To get an understanding of circuit operation, imagine a 2 V input step from the DAC. This causes a 2 V step at the output of $A_{1}$ (which acts like a follower at high speeds, owing to $C_{2}$ ), which is approximately the right signal to tell $A_{2}$ to drive current into $C_{\mathrm{L}}$ and move its output by 40 volts (that's why we chose $G=20$ for the output stage). As amplifier $A_{2}$ approaches this goal, op-amp $A_{1}$ takes charge and presents correction signals to cause the output to hone in on the precise value.

A few additional circuit details: the DAC's response is slowed by $C_{1}$ to a $10 \mu \mathrm{~s}$ time constant - no point in jolting the amplifier, given its limited bandwidth. The series $R C$ across the output promotes stability, both by reducing $A_{2}$ 's open-loop gain at high frequencies and by providing lossy damping; it's widely used in audio power amplifiers. Note that substantial bypass capacitors (as much as $100 \mu \mathrm{~F}$, not shown) are needed with such large signal currents.

Further examples of the composite amplifier technique
can be found in $\S 4 x .5$ and in Figures 5.58, 5.59, 5.61, 8.49, $8.50,8.78,8.80$, and 13.48 .

And other examples of techniques that exploit the "two-out-of-three" concept of adding external amplifier blocks are (a) discrete JFET front-end for a BJT op-amp (e.g., Figure 5.58), (b) output unity-gain buffer (§5.8.4), and (c) bootstrapped power supplies to extend voltage range, or to improve CMRR (e.g., Figure 5.79). ${ }^{46}$

## 5.11 Auto-zeroing (chopper-stabilized) amplifiers

Even the best of precision low-offset op-amps cannot match the stunning $V_{\mathrm{OS}}$ performance of the so-called "chopper-stabilized" or "auto-zero" (also called "zerodrift") op-amps. Ironically, these interesting amplifiers are built with CMOS, otherwise famous for its mediocrity when it comes to offset voltage or drift. The trick here is to put a second nulling op-amp on the chip, along with some MOS analog switches and offset-error storage capacitors. One of several possible configurations is shown in Figure 5.48. The main op-amp functions as a conventional (imperfect) amplifier. The nulling op-amp's job is to monitor the input offset of the main amplifier, adjusting a slow correction signal as needed in an attempt to bring the input offset exactly to zero. Because the nulling amplifier has an offset error of its own, there is an alternating cycle of operation in which the nulling amplifier corrects its own offset

[^251]voltage. Both amplifiers have a third "nulling" input terminal, analogous to the offset trim seen in some op-amps.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0367.jpg?height=501&width=771&top_left_y=339&top_left_x=140)

Figure 5.48. The original ICL7650 and ICL7652 auto-zero ("chopper-stabilized") op-amps. Capacitors $C_{1}$ and $C_{2}$ are external.

The auto-zeroing cycle goes like this. (a) Disconnect the nulling amplifier from the input, short its inputs together, and connect its output to $C_{1}$, the holding capacitor for its correction signal; the nulling amplifier now has zero offset. (b) Now connect the nulling amplifier across the input and connect its output to $C_{2}$, the holding capacitor for the main amplifier's correction signal; the main amplifier now has zero offset (assuming that the nulling amplifier has not drifted). The MOS analog switches are controlled by an on-board oscillator, typically running in the range of $1-50 \mathrm{kHz}$.

### 5.11.1 Auto-zero op-amp properties

Auto-zero op-amps do best what they are optimized for, namely delivering $V_{\text {OS }}$ values (and tempcos) 5-50 times better than the best precision bipolar op-amp (see Table 5.6 on the next page). What's more, they do this while delivering full op-amp speed and bandwidth. ${ }^{47}$ They also have extraordinarily high open-loop gain at low frequencies (typically 130-150 dB, a consequence of their "composite amplifier architecture"); and, happily, they are inexpensive, particularly when compared with conventional precision op-amps.

That's the good news. The bad news is that auto-zero amplifiers have a number of diseases that you must watch out for. Being CMOS devices, most of them have a severely limited supply voltage - often 6 V total supply, with a

[^252]smaller selection that can run up to 15 V , and just one ${ }^{48}$ older generation part (the LTC1150) that can operate at $\pm 15 \mathrm{~V}$.

Of greater importance is the problem of clock-induced noise. This is caused by charge coupling from the MOS switches (see §3.4.2E) and can cause wicked spikes at the output. The specifications are often misleading here, because it is conventional to quote input-referred noise with $R_{\mathrm{S}}=100 \Omega$ and also to give the specification for only very low frequencies. For example, a typical input-referred noise voltage might be $0.3 \mu \mathrm{Vpp}$ (dc to 1 Hz , with $R_{\mathrm{S}}=$ $100 \Omega$ ). However, with zero input signal the output waveform might consist of a train of $5 \mu \mathrm{~s}$-wide 10 mV spikes of alternating polarity!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0367.jpg?height=800&width=807&top_left_y=860&top_left_x=969)

Figure 5.49. Output waveforms from four auto-zero op-amps, configured for $G=100$, with the input connected to ground through a $100 \Omega$ resistor. Vertical: $2 \mathrm{mV} /$ div; horizontal: $100 \mu \mathrm{~s} / \mathrm{div}$.

The internal switching also causes spikes of input current, which means that input signals of high source impedance $R_{\mathrm{S}}$ will exhibit larger input-referred spikes. Figures 5.49 and 5.50 show this behavior, measured with $R_{\mathrm{S}}$ of $100 \Omega$ and $1 \mathrm{M} \Omega$, in several auto-zero op-amps configured

[^253]| Table 5.6 <br> Part \# | Chopper and Auto-zero Op-amps |  |  |  |  |  |  |  |  | CMRRmin(dB) | Noise ${ }^{t, u}$ |  |  |  | $\begin{aligned} & \text { GBW } \\ & \text { typ } \\ & \text { (MHz) } \end{aligned}$ | Slew <br> (V/us) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0368.jpg?height=70&width=138&top_left_y=674&top_left_x=446) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0368.jpg?height=70&width=168&top_left_y=600&top_left_x=416) | Swing to Supplies? <br> IN OUT <br> + - + - | Cost qty 25 (\$US) | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | 응 <br> ㅇ |  |  | $\begin{aligned} & \text { lbias }^{\mathrm{a}} \\ & \text { @ } 25^{\circ} \mathrm{C} \end{aligned}$ |  | Offset Voltage |  |  |  |  | $\begin{aligned} & V_{\mathrm{npp}} \\ & \mathrm{dc}^{\mathrm{d}} \\ & (\mu \mathrm{~V}) \end{aligned}$ | $\begin{gathered} e_{n} \\ 1 \mathrm{kHz} \\ \left(\frac{\mathrm{nV}}{\sqrt{\mathrm{~Hz}}}\right) \end{gathered}$ | $\begin{gathered} i_{n} \\ 10 \mathrm{~Hz} \\ \left(\frac{\mathrm{fA}}{\mathrm{~Hz}}\right) \\ \hline \end{gathered}$ | HF <br> Noise <br> (>kHz) |  |  |  |  |  |  |  |
|  |  |  |  |  |  | 25 $25^{\circ} \mathrm{C}$ |  | Te |  |  |  |  |  |  |  |  |  |  |  |  |  |
|  |  | Supply <br> (V) | typ <br> ( $\mu \mathrm{A}$ ) | typ <br> (pA) | max <br> (pA) |  |  | $\begin{gathered} \text { typ } \\ \left(\mathrm{nV} /{ }^{\circ} \mathrm{C}\right) \end{gathered}$ | $\begin{aligned} & \max \\ & \text { (nV/ } \left.{ }^{\circ} \mathrm{C}\right) \end{aligned}$ |  |  |  |  |  |  |  |  |  |  |  |  |
| ADA4051-1 | 1,2 | 1.8-6 | 15 | 20 | 70 | 2 | 15 | 20 | 100 | 110 | 2 | 95 | 100 | 40 | 0.13 | 0.04 | 110 | 120 |  | 1.86 | uto-zero, -2=dual |
| OPA333 | 1,2 | 1.8-7 | 17 | 70 | 200 | 2 | 10 | 20 | 50 | 106 | 1.1 | 55 | 100 | $>20$ | 0.35 | 0.16 | 45 | 80 |  | 2.57 | uto-cal, dual=2333 |
| ISL28133 | 1,2 | 1.65-6.5 | 18 | 30 | 300 | 2 | 8 | 20 | 75 | 118 | 1.1 | 65 | 79 | 8 | 0.4 | 0.1 | 35 | ? |  | 1.69 | dual=28233 |
| OPA330 | 1,2 | 1.8-7 | 21 | 200 | 500 | 8 | 50 | 20 | 250 | 100 | 1.1 | 55 | 100 | $>20$ | 0.35 | 0.16 | 45 | 80 |  | 2.56 | auto-cal, dual=2330 |
| MAX9617 | 1,2 | 1.6-6 | 59 | 10 | 140 | 0.8 | 10 | 5 | 120 | 122 | 0.42 | 42 | 100 | 50 | 1.5 | 0.7 |  | ? |  | 1.60 | RRIO, charge pump |
| OPA378 | 1,2 | 2.2-6 | 125 | 150 | 550 | 20 | 50 | 100 | 250 | 100 | 0.4 | 20 | 200 | 15 | 0.9 | 0.4 | 9 | 4 | c $\cdot$ $\cdot$ $\cdot$ | 2.16 | auto-cal, '2378=dual |
| LTC2054 | 1,2 | 2.7-6 | 140 | 1 | 150 | 0.5 | 3 | 20 | 30 | 120 | 1.6 | 85 |  |  | 0.5 | 0.5 |  | 4000 | - $\cdot$ $\cdot$ $\cdot$ | 2.25 | dual=2055 |
| AD8538 | 1,2 | 2.7-6 | 150 | 15 | 25 | 5 | 13 | 30 | 100 | 115 | 1.2 | $52^{\text {h }}$ | - | 1,15 | 0.43 | 0.4 | 5 | 50 |  | 1.80 | self-calibrating, duals |
| MCP6V06 | 1,2 | 1.8-6.5 | 200 | 1 | - | - | 3 | - | 50 | 140 | 1.7 | 82 | (0.6) | 1 | 1.3 | 0.5 | 300 | 100 | $\cdot$ $\cdot$ $\cdot$ | 1.42 | low-cost, dual = 6V07 |
| LTC1049 | 1 | 5-16 | 200 | 15 | 50 | 2 | 10 | 20 |  | 110 | 3 | 100 | (2) | 10 | 0.8 | 0.8 | - | 6000 | - $\cdot$ $\cdot$ $\cdot$ | 2.85 | miniDIP pkg avail |
| OPA335 | 1,2 | 1.8-7 | 285 | 70 | 200 | 1 | 5 | 20 | 50 | 110 | 1.4 | 55 | 20 | 10 | 2 | 1.6 | 6 | 50 |  | 2.56 | auto-cal, dual=2335 |
| MAX4238 | 1 | 2.7-6 | 600 | 1 | - | 0.1 | 2 | 10 | - | 120 | 1.2 | 30 |  | ? | 1 | 0.35 | 1000 | 3300 | - $\cdot$ $\cdot$ $\cdot$ | 1.62 | '4239=decomp, G=5 |
| OPA734 | 1,2 | 2.7-13 | 600 | 100 | 200 | 1 | 5 | 10 | 50 | 115 | 2.5 | 135 | 40 | 17 | 2 | 1 | - | 8 | - $\cdot$ $\cdot$ | 2.56 | auto-cal, dual=2734 |
| AD8551 | 1,2,4 | 2.7-6 | 700 | 10 | 50 | 1 | 5 | 5 | 40 | 120 | 1 | 42 | (2) | 3.5 | 1.5 | 0.4 | 50 | 50 |  | 2.34 | auto-zero |
| AD8572 | 1,2,4 | 2.7-6 | 700 | 10 | 50 | 1 | 5 | 5 | 40 | 120 | 1.3 | 51 | (2) | 2.3 | 1.5 | 0.4 | - | 50 | $\cdot$ $\cdot$ $\cdot$ | 3.34 | auto-zero |
| LTC2050HV | 1 | 2.7-11 | 750 | 25 | 75 | 0.5 | 3 | - | 30 | 15 | 1.5 |  |  | ? | 3 | 2 | - | 2000 | - $\cdot$ $\cdot$ $\cdot$ | 3.20 | OK for $\pm 5 \mathrm{~V}$ supplies |
| AD8628 | 1,2,4 | 2.7-6 | 850 | 30 | 100 | 1 | 5 | 2 | 20 | 120 | 0.5 | 22 | (5) | 15 | 2.5 | 1 | - | 50 | $\cdot$ $\cdot$ $\cdot$ | 1.92 | self-cal, dual, quads |
| LMP2011 | 1,2,4 | 2.5-5.8 | 930 | 3 | - | 0.12 | 25 | 15 | - | 95 | 0.85 | $35^{\text {h }}$ | - | 25 | 3 | 4 | - | 50 | - $\cdot$ $\cdot$ | 2.55 | opper leadframe |
| TLC4501A | 1,2 | 4-6 | 1000 | 1 | 60 | 10 | 40 | 1000 |  | 90 | 1.5 | 12 | 0.6 | none | 4.7 | 2.5 | 到 | 0 | - $\cdot$ $\cdot$ | 2.88 | elf-zero at powerup |
| AD8638 | 1,2 | 5-16 | 1000 | 1.5 | 40 | 3 | 9 | 10,40 | 60 | 118 | 1.2 | 60 |  | 8 | 1.35 | 2.5 | 3 | 50 | - $\cdot$ $\cdot$ | 2.29 | self-calibrating, duals |
| LTC1050 | 1 | 4.75-16 | 1000 | 10 | 30 | 0.5 | 5 | 10 | 50 | 114 | 1.6 |  | (1.8) | 2.5 | 2.5 | 4 | - | 3000 | - $\cdot$ $\cdot$ $\cdot$ | 2.85 | avorite |
| LMP2021 | 1,2 | 2.5-5.8 | 1100 | 25 | 100 | 0.4 | 5 | 49 | 20 | 105 | 0.2 | 11 | 350 | 30 | 5 | 2.5 | - | 50 | $\cdot$ $\cdot$ $\cdot$ | 3.38 | EMI-rej, '2022=dual |
| MAX4236A ${ }^{b}$ | 1 | 2.4-6 | 350 | 1 | 500 | 5 | 20 | 600 | 2000 | 84 | 0.2 | 14 | 0.6 | none | 1.7 | 0.3 | 1 |  | - $\cdot$ $\cdot$ | 1.78 | comp low Vos CMOS |
| AD8616 ${ }^{b}$ | 1,2,4 | 2.7-6 | 1.7 | 0.2 | 1 | 23 | $60^{f}$ | 1500 | 4000 | 80 | 2.4 | 7 | 2 | none | 24 | 12 | 0.5 | 0 | $\cdot$ | 1.52 | comp CMOS |
| LT1028 ${ }^{\text {b }}$ | 1 | 8-44 | 7400 | 25nA | 95nA | 10 | 40 | 200 | 800 | 108 | 0.04 | 0.9 | 4700 | none | 75 | 15 |  | 0 |  | 6.31 | comp low-noise BJT |
| high-voltage |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LTC1150 | 1 | 4.8-32 | 800 | 10 | 60 | 0.5 | 10 | 10 | 50 | 110 | 1.8 |  | - | 0.5 | 1.8 | 1.5 | - | 20ms | - n n | 5.84 | OK for $\pm 15 \mathrm{~V}$ supplies |
| LT1012A ${ }^{b}$ | 1 | 2.4-40 | 380 | 25 | 100 | 8 | 25 | 200 | 600 | 114 | 0.5 | 14 | 20 | none | 0.8 | 0.2 | - | 0 | - - - - | 5.11 | comp low /B bipolar |
| LT1007A ${ }^{\text {b }}$ | 1 | 7-44 | 3000 | 10nA | 35nA | 10 | 25 | 200 | 1000 | 117 | 0.06 | 2.5 | 1500 | none | 8 | 1.7 | - | 0 | - - | 5.83 | comp low en bipolar |
| Notes: (a) check datasheets for plots of lbias vs common-mode input voltage. (b) conventional (not auto-zero) precision op-amps, for comparison. (c) crossover region. <br> (d) 0.01 Hz to 10 Hz . (f) at $V_{\mathrm{CM}}=0.5 \mathrm{~V}$ and 3.0 V (with $V_{\mathrm{s}}=5.5 \mathrm{~V}$ ), but as much as $400 \mu \mathrm{~V}$ near $V_{\mathrm{CM}}=2 \mathrm{~V}$. (g) $1 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ at $V_{\mathrm{s}}=2.5 \mathrm{~V}$. ( h ) $150 \mathrm{nV} / \mathrm{JHz}$ hump above 2 kHz . ( n ) near to rails w/o load. <br> (t) typical. (u) current noise values indicated with light italics should not be relied upon; measured values appear to be greater by factors of 100 or more, see discussion in Chapter 8. |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0369.jpg?height=656&width=791&top_left_y=218&top_left_x=125)

Figure 5.50. Output waveforms from three auto-zero op-amps, configured for $G=100$, with the input connected to ground through a $1 \mathrm{M} \Omega$ resistor. Vertical: $100 \mathrm{mV} /$ div.
for a voltage gain of $100 .{ }^{49}$ There is considerable variation among these parts, with the conventional auto-zero configuration (Figure 5.48, used in the LTC1150 and MCP6V06) exhibiting greater clock feedthrough compared with that of alternative designs (as in the AD8628A and LMP2021) that are intended to reduce these undesirable effects. ${ }^{50}$

The datasheets do reveal this unseemly behavior, indirectly, in plots of voltage noise versus frequency. ${ }^{51}$ Figure 5.51 shows a pair of such plots for two auto-zero products from Analog Devices: the AD8551 has a $\sim 4 \mathrm{kHz}$ fixed-frequency oscillator, whereas their AD8571 has a deliberately variable (spread-spectrum) oscillator to eliminate sharp spectral lines (which can create undesirable intermodulation with nearby signal frequencies). Note, by

49 The waveforms in the latter show 8 nApp current spikes for the LTC1150, 1 nApp noise for the MCP6V06 (despite its impressive spec: $0.6 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ at 10 Hz ), and 0.2 nApp "rumble" for the LMP2021 (which sports a $0.35 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ current-noise spec).
${ }^{50}$ From the AD8628A datasheet: "The AD8628/AD8629/AD8630 family uses both auto-zeroing and chopping in a patented ping-pong arrangement to obtain lower low frequency noise together with lower energy at the chopping and auto-zeroing frequencies, maximizing the signal-to-noise ratio for the majority of applications without the need for additional filtering. The relatively high clock frequency of 15 kHz simplifies filter requirements for a wide, useful noise-free bandwidth."
${ }^{51}$ Watch out, though, for claimed values of noise current - the low values listed in many datasheets are completely incorrect, sometimes by factors of $\times 10$ to $\times 100$, evidently having been calculated a priori as the shot noise corresponding to the dc input current; see the discussion in $\S 5.10 .8$ and in §8.9.1F.
the way, that these plots specify an input signal of zero source impedance.

It's always instructive to make some actual measure-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0369.jpg?height=562&width=756&top_left_y=375&top_left_x=994)

Figure 5.51. Spectra of noise voltage, adapted from their datasheets, for a pair of auto-zero op-amps. The AD8571 varies its oscillator frequency in order to suppress sharp spectral features.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0369.jpg?height=527&width=809&top_left_y=1142&top_left_x=963)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0369.jpg?height=496&width=807&top_left_y=1660&top_left_x=969)

Figure 5.52. Measured voltage-noise density (bottom) and current-noise density (top) for an MCP6V06 auto-zero amplifier. Switch-induced clock noise at 9 kHz (and harmonics) is prominent.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0370.jpg?height=884&width=1564&top_left_y=211&top_left_x=256)

Figure 5.53. At very low frequencies a chopper-stabilized op-amp has lower noise than a conventional op-amp, but with $100 \times$ greater bandwidth it has more noise, as seen in these measured traces. See also Figure 5.54
ments yourself, if for no other reason than for "fact checking" the manufacturer. We ran some spectral noise plots for a half-dozen auto-zero amplifiers, with a particular interest in chopper-induced narrowband noise at the clock frequency and its harmonics. For these measurements we took data with $R_{\mathrm{S}}=0$ (to reveal the input voltage noise $e_{\mathrm{n}}$ ), and then with $R_{\mathrm{s}}=1 \mathrm{M} \Omega$ (to reveal input current noise $i_{\mathrm{n}}$ ). Figure 5.52 shows the results, for one specimen from our collection of auto-zero amplifiers. The low-frequency measured $e_{\mathrm{n}}$ agrees well with the datasheet's value of $82 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, but, as noted above, the measured currentnoise density $i_{\mathrm{n}}$ is far greater than the specified value of $0.6 \mathrm{fA} / \sqrt{\mathrm{Hz}}-\mathrm{a}$ factor of $\times 400$ in this case.

For low-frequency applications you can (and should) $R C$-filter the output to a bandwidth of a few hundred hertz, which will suppress output spikes. This spiky input-current noise is also of no importance in applications with low input impedances, in integrating applications (e.g., integrating ADCs; see §13.8.3), or in applications in which the output is intrinsically slow (e.g., a thermocouple circuit with a meter at the output). In fact, if you want only very slow output response, and therefore lowpass-filter the output to extremely low frequencies (below 1 Hz ), a chopper amplifier will actually have less noise than a conventional low-noise op-amp; see Figures 5.53 and 5.54.

Another way to put it is that auto-zero amplifiers have lots of wideband voltage noise $(\sim 50 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 1 kHz , compared with just a few $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ for a good low-noise op-amp), but their noise density holds constant at very low frequencies, as contrasted with the $\sim 1 / f$ ("flicker-noise") divergence of conventional op-amps (and everything else; see Chapter 8). For example, a conventional low-noise BJT op-amp like the LT1007 has $e_{\mathrm{n}}=2.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (typ) at 1 kHz , but its noise power density rises as $1 / f$ below its "corner frequency" of 2 Hz , thus $e_{\mathrm{n}} \sim 100 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 0.001 Hz . Compare that with an auto-zero like the AD8551, with roughly flat $e_{\mathrm{n}}=42 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ : the latter will have far smaller fluctuations on time scales of minutes. In fact, the AD8551's datasheet even specifies a peak-to-peak noise voltage from " 0 Hz to 1 Hz " of $0.32 \mu \mathrm{~V}$ (typ); no conventional op-amp would dare to project its drift out to infinite time!

A final problem with auto-zero amplifiers is their unfortunate overload recovery. What happens is this: the autozeroing circuit, in attempting to bring the input difference voltage to zero, implicitly assumes there is overall feedback operating. If the amplifier's output saturates (or if there is no external circuit to provide feedback), there will be a large differential input voltage, which the nulling amplifier sees as an input offset error; it therefore blindly
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0371.jpg?height=925&width=1519&top_left_y=211&top_left_x=184)

Figure 5.54. Integrated RMS voltage noise versus amplifier bandwidth. The "zero-drift" aspect of auto-zero amplifiers causes their lowfrequency integrated noise voltage $v_{\mathrm{n}}$ to fall at low frequencies, proportional to the square root of the lowpass bandwidth. In contrast, the rising noise density $e_{\mathrm{n}} \propto 1 / \sqrt{f}$ of conventional op-amps causes a plateau in the integrated noise voltage $v_{\mathrm{n}}$ below the $1 / f$ corner frequency, as seen in these computed curves. (We chose a lower limit of 0.01 Hz , when integrating the latter because the unbounded integral is divergent. This plot lets you see the region where the auto-zero op-amp wins or loses, compared with the op-amp of your choice. You can draw in estimated plots for other parts if you know $e_{\mathrm{n}}$ and the $1 / f$ corner frequency. See §8.13.4.) See Figure 5.37 for the spectral noise-density plots behind these curves, and see Figure 8.63 for graphs of three dozen more op-amp types.
generates a large correction voltage that charges up the correction capacitors to a large voltage before the nulling amplifier itself finally saturates. Recovery is slow $-t_{\mathrm{r}}$ can extend up to several milliseconds. One "cure" is to sense when the output is approaching saturation, and clamp the input to prevent it. You can prevent saturation in chopper amplifiers (and in ordinary op-amps, as well) by bridging the feedback network with a bidirectional zener (two zeners in series), which clamps the output at the zener voltage, rather than letting it limit at the supply rail; this works best in the inverting configuration.

Alternatively, you can do an end run around this problem by choosing a part with fast recovery time, for example the OPA378 or OPA734 (with $t_{\mathrm{r}}=4 \mu \mathrm{~s}$ and $8 \mu \mathrm{~s}$, respectively).

### 5.11.2 When to use auto-zero op-amps

- Slow but accurate measurements from transducers: weigh scales, thermocouples, current shunts
- Accurate in-circuit dc conditioning, for example creating precise sets of voltages from a voltage reference
- "Normal-bandwidth" applications that want low-voltage and low- $I_{\mathrm{B}}$ CMOS, can tolerate broadband noise, require low offset voltages ( $\ll 1 \mathrm{mV}$ ), and don't want to pay the cost premium of precision CMOS op-amps.


### 5.11.3 Selecting an auto-zero op-amp

Table 5.6 on page 335 lists a nice selection of currently available auto-zero op-amps, plus a few conventional opamps for comparison. This is a good place to go first when you need an auto-zero amplifier. It's also a good place to learn about some of the common properties, and some of the quirks, of these amplifiers. Here are some comments, to get you started.
Supply voltage All but one of the parts are low voltage, $5.5-6 \mathrm{~V}$ max, and many will operate down to 2 V or less. Five can operate from $\pm 5 \mathrm{~V}$ supplies. The supply
currents range from $15 \mu \mathrm{~A}$ to 1.1 mA . The parts are listed approximately by supply current.
Input current Auto-zero amplifiers are built with CMOS, so the input currents are typically in the picoamps. We might expect the input currents to be in the single picoamp territory like other CMOS op-amps. Although there are a few parts for which this is true (e.g., MAX4238, MCP6V06 and LTC2054), most have considerably higher currents, up to 0.5 nA max, no doubt because of input-switch charge coupling. Even most conventional JFET op-amps do better except at high temperatures, where auto-zeros are usually much better. For example, $I_{\mathrm{B}}$ of the auto-zero LMP2021 typically stays below 75 pA at $125^{\circ} \mathrm{C}$ (for any commonmode voltage), compared with the (conventional) JFET OPA124 ( 0.5 nA ) and LF412 (10 nA). Auto-zero input currents are not as low as the best conventional CMOS parts (with their femtoamp currents), but considerably better than conventional precision BJT-input parts like the LT1028 or LT1007 on the table. ${ }^{52}$
Offset voltage This is where auto-zero amplifiers really shine, with maximum offset voltages ranging from $0.1-$ $5 \mu \mathrm{~V}$ typical (and $2 \mu \mathrm{~V}-25 \mu \mathrm{~V}$ maximum - in the precision design business you've often got to pay serious attention to "maximum" specifications). A few conventional (not auto-zero) parts can approach this figure ( $20 \mu \mathrm{~V}$ for the CMOS MAX4236A, $25 \mu \mathrm{~V}$ for the BJT LT1012A and LT1007), but they cannot begin to match the excellent tempco of the auto-zero parts (generally in the range of $5-20 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ ), gained, of course, by continual offset correction. Conventional op-amps also suffer from the devastating effects of $1 / f$ noise, which sets performance floors in the $10-100 \mathrm{nV}$ region; see Figure 5.54 and associated discussion.
The auto-zero amplifiers have typical offset-voltage tempco drifts from $4-100 \mathrm{nV} /{ }^{\circ} \mathrm{C}$. The maximum specs range up to $250 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ (and beyond? many parts don't list a maximum spec). The AD8628 and LMP2021 are the winners in this category. But these parts consume about 1 mA and thus can be expected to have more self-

[^254]heating of the die than say the $60 \mu \mathrm{~A}$ MAX 9617 with its $5 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ spec. No manufacturer can afford to perform temperature tests on production parts, so these specs should be taken with a grain of salt.
Is this performance believable? At the level of $\mathrm{nV} /{ }^{\circ} \mathrm{C}$ you have to worry seriously about thermocouple effects in external connections, and even within the chip's lead frame itself: typical thermal EMFs are of order 5$40 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ - that's $1000 \times$ (or more) the specified tempco of these auto-zero op-amps!
Voltage noise Auto-zero amplifiers exhibit higher broadband noise than conventional op-amps, owing to their CMOS inputs and associated switching elements. The voltage noise density $e_{\mathrm{n}}$ at 1 kHz (the usual benchmark) is of order $50-100 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, bested by many conventional CMOS parts, and all BJT parts. But, unlike conventional op-amps, the noise density does not rise at low frequencies, so the low-frequency integrated noise voltage (which you can think of as fluctuations, or drift) is better than even the best low-noise op-amps (as seen in Figures 5.53 and 5.54). Speaking approximately, the integrated-noise voltage falls as the $1 / \sqrt{t}$ (or proportional to the square root of lowpass frequency).
In addition to $e_{\mathrm{n}}$, a useful parameter in the table is the $0.1-10 \mathrm{~Hz}$ peak-peak voltage noise ( $v_{\mathrm{n}}$ ) specification. The AD8628, MAX9617, and OPA378 ${ }^{53}$ do very well with $0.5 \mu \mathrm{~V}$ to $0.4 \mu \mathrm{Vpp}$ noise specs, but the LMP2021 is the clear winner with an $e_{\mathrm{n}}$ of $11 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and a $v_{\mathrm{n}}$ of $0.26 \mu \mathrm{Vpp}$. This part is available in a convenient SOT23 package.
A note of caution, here: the very low-frequency extrapolation (i.e., long-term drift) must eventually become dominated by other drift sources (e.g., diffusion of impurities); see Bob Pease's column, "What's All This Long-Term Stability Stuff, Anyhow?" (published in Electronic Design, 20 July 2010).
Noise current The noise current density $i_{\mathrm{n}}$ must be at least the shot noise value (given by $i_{\mathrm{n}}=\sqrt{2 q I_{B}}$, with $q=1.6 \times 10^{-19} \mathrm{C}$; thus $1.8 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ for a bias current of $I_{\mathrm{B}}=10 \mathrm{pA}$ ) corresponding to the input current $I_{\mathrm{B}}$, generally in the range of a few $\mathrm{fA} / \sqrt{\mathrm{Hz}}$. In fact, for most of these parts it is much larger - by as much as factors of 10-100.
The current noise is $125 \times$ higher than shot noise for
${ }^{53}$ A favorite of Phil Hobbs, who gushes "The OPA378 is a really beautiful zero-drift chopper-CAZ mutation that doesn't exhibit switching noise, and has constant 35 nV [per root hertz] noise down to DC. I've used it in an etalon-locked diode laser for downhole applications, and it's a thing of great charm."
the LMP2021, which was the winner of the voltagenoise competition. Parts that claim to do well in this regard (i.e., with input noise current approximately equal to the calculated shot noise ${ }^{54}$ ) include the AD8572, AD8551, and LTC1050. The MCP6V06 is the winner of the current-noise competition, with $0.6 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. This spec predicts $2 \mu \mathrm{~V}$ from current noise through a $1 \mathrm{G} \Omega$ resistor in a 10 Hz bandwidth, about equal to the part's $1.7 \mu \mathrm{~V}$ voltage noise $v_{\mathrm{n}}$. The TLC4501A does equally well because it does its auto-zero only once, at powerup. But we know that the TLC4501A, unlike the MCP6V06, will do well at higher frequencies and with wider bandwidths because it has no busy auto-zero oscillator and switches. But it will do poorly at long time scales because of $1 / f$ noise and multiple sources of drift.
A caution, loyal reader, as you make your choices seven otherwise-attractive parts in the table, like the AD8538 and LMP2011, don't have any current-noise specs or plots. You may need to go to the bench to get your answer.
Slew rate and settling time For the listed parts the slew rates range from 0.04 to $2.5 \mathrm{~V} / \mu \mathrm{s}$, and the gainbandwidths range from 0.13 to 4.7 MHz . The faster parts are meant to compete for use in ordinary op-amp sockets. For these parts, the settling time $t_{\mathrm{s}}$ is dominated by slew rate. But there are anomalies, for example the MCP6V06 ${ }^{55}$ and MAX4238, whose settling times are one or two orders of magnitude longer than the competition. This may be related to recovery time - the parts with recovery times in the milliseconds have very long settling times (the MAX4238), or they aren't willing to say (five other parts).
Input voltage range Most auto-zero op-amps do not support input voltages to the positive rail (though they all are rail-to-rail output). The MCP6V06, OPA333, ISL28133, MAX9617, and most of the Analog Devices parts are notable for full rail-to-rail input operation, without $V_{\text {OS }}$ or CMRR degradation. The MAX9617 achieves this using an internal above-the-rail chargepump power supply. Note also that the $V_{\text {OS }}$ specifications may be conditioned on a restricted range of input voltage - most of the way to $V_{+}$for some, others only partway. Be sure to read the fine print in the specification! For example, the OPA335 datasheet says " $\left(V_{-}\right)-0.1 \mathrm{~V}<V_{\mathrm{cm}}<\left(V_{+}\right)-1.5 \mathrm{~V}$ " next to its 130 dB

[^255]CMRR spec, and " $V_{\mathrm{cm}}=V_{\mathrm{s}} / 2$ " next to its $1 \mu \mathrm{~V}$ offsetvoltage spec.
Packages A few of the (older) Linear Technology types are available in DIP-8 packages for easy breadboarding. Otherwise you can use a SOIC-to-DIP or SOT23-to-DIP adapter (check out offerings from Aries or Bellin Dynamic Systems).

### 5.11.4 Auto-zero miscellany

A. ac-coupled "chopper amp"

When considering auto-zeroing chopper amplifiers, be sure you don't confuse this technique with another "chopper" technique, namely the traditional low-bandwidth chopper amplifier in which a small dc signal is converted to ac ("chopped") at a known frequency, amplified in ac-coupled amplifiers, then finally demodulated by multiplying with the same waveform used to chop the signal initially (Figure 5.55). This scheme is quite different from the fullbandwidth auto-zeroing technique we've been considering, in that it rolls off at signal frequencies approaching the clock frequency, typically just a few hundred hertz. You sometimes see it used in chart recorders and other lowfrequency instrumentation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0373.jpg?height=458&width=810&top_left_y=1243&top_left_x=970)

Figure 5.55. An ac-coupled chopper amplifier.

#### B. Thermal offsets

When you build dc amplifiers with submicrovolt offset voltages, you should be aware of thermal offsets, which are little thermally driven batteries produced by the junction of dissimilar metals. You get a Seebeck-effect "thermal EMF" when you have a pair of such junctions at different temperatures. In practice you usually have joints between wires with different plating; a thermal gradient, or even a little draft, can easily produce thermal voltages of a few microvolts. Even similar wires from different manufacturers can produce thermal EMFs of $0.2 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}, 10$ to a 100 times the
typical drift spec of the auto-zero amplifiers in Table 5.6 on page 335! The best approach is to strive for symmetrical wiring and component layouts, and then avoid drafts and gradients.

Here, for approximate guidance when worrying about parasitic thermocouples, Peltier shifts, and the like, are some thermoelectric-pair voltages (from Agilent AN-1389-1):

| Copper-to- | Approx $\mu \mathrm{V} /{ }^{\circ} \mathrm{C}$ |
| ---: | :---: |
| Copper | $<0.3$ |
| $\mathrm{Cd}-\mathrm{Sn}$ solder | 0.2 |
| $\mathrm{Sn}-\mathrm{Pb}$ solder | 5 |
| Gold | 0.5 |
| Silver | 0.5 |
| Brass | 3 |
| Be-Cu | 5 |
| Aluminum | 5 |
| Kovar | 42 |
| Silicon | 500 |
| Copper oxide | 1000 |

#### C. Power-up self-calibrating op-amps

Texas Instruments has an interesting approach to circumventing clocking noise in auto-zero amplifiers, namely to do it only once! Their TLC4501 family of "Self-calibrating (Self-Cal ${ }^{\mathrm{TM}}$ ) precision CMOS rail-to-rail output operational amplifiers" comes to life at power-up, performing an auto-zero and holding the correcting offset in an on-chip DAC. The good news is that you get no chopping noise and pretty good offset specs ( $10 \mu \mathrm{~V}$ typ, $40 \mu \mathrm{~V}$ max) , at least compared with those of typical CMOS op-amps. The less good news, as you might expect, is that the drift of offset with temperature is unspectacular (you might say "worst in class"), at $\pm 1000 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ typ, compared with $\sim 20 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ for true auto-zero op-amps (see Table 5.6 on page 335).

#### D. The non-chopper competition

You can't beat the $\sim 1 \mu \mathrm{~V}$ (typ) offset specs of these autozero and chopper amplifiers, but you can do pretty well with the very best factory-trimmed precision op-amps. Bipolar op-amps like the LT1007 or LT1012 do quite well, at $10 \mu \mathrm{~V}$ (typ), and the remarkable CMOS MAX4236A has an offset spec of $5 \mu \mathrm{~V}$ typ (and $20 \mu \mathrm{~V}$ max). Note, however, that these factory-trimmed op-amps cannot come close to the drift specs of a true auto-zero: $\pm 200 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ (typ) for the bipolar types, and $\pm 600 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ for the CMOS , compared with $\sim 20 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ for true auto-zero.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0374.jpg?height=695&width=746&top_left_y=219&top_left_x=1099)

Figure 5.56. External auto-zeroing. But watch out for $U_{1}$ 's high bias current.

#### E. External auto-zero

You can use an auto-zero op-amp as an external offset trim for a conventional op-amp. This can be handy when you need a high-voltage, high-power, or high-speed opamp whose input offset is too large. Figure 5.56 shows the scheme, which works most naturally with the inverting configuration, as shown.

The (low-voltage) auto-zero op-amp $U_{2}$ is configured as an integrator, looking at the error voltage at the inverting input of the conventional op-amp $\left(U_{1}\right)$. The integrator's output is attenuated by $\times 100$ to trim the voltage at the noninverting accordingly. With the values shown, the integrator's output responds according to $d V / d t=-\Delta V / R_{\mathrm{i}} C_{i}$; thus a $10 \mu \mathrm{~V}$ error produces a $-100 \mu \mathrm{~V} /$ s integrator output and a $-1 \mu \mathrm{~V} / \mathrm{s}$ correction at the noninverting terminal of $U_{1}$. A long time constant is both desirable (op-amp offsets drift only very slowly), and necessary (to prevent loop oscillation). Here the correction range is set by divider $R_{3} R_{4}$, so that a $\pm 1 \mathrm{~V}$ integrator output produces a $\pm 10 \mathrm{mV}$ correction. The LM675 is a nice high-power op-amp (3 A output current, supply voltage to $\pm 30 \mathrm{~V}$, with sophisticated onchip safe-operating-area and thermal protection), but with a maximum offset voltage of $\pm 10 \mathrm{mV}$. The auto-zero reduces that by a factor of 1000 . Similarly, the THS4011 is a fast op-amp ( $f_{\mathrm{T}}=200 \mathrm{MHz}, \mathrm{SR}=300 \mathrm{~V} / \mu \mathrm{s}$ ) with a maximum offset voltage of $\pm 6 \mathrm{mV}$. An additional noise filter $R_{n} C_{n}$ at the output of the auto-zero, as shown, may be needed to suppress switching noise in the (slow) correction loop when this technique is used with small signals and lownoise parts like the THS4011 ( $7.5 \mathrm{nV} / \sqrt{\mathrm{Hz}})$. You can think
of this technique as a discrete implementation of the integrated scheme of Figure 5.41.

#### F. Auto-zero instrumentation amplifiers

In $\S 5.13$ we discuss instrumentation amplifiers, which are differential-input amplifiers with very high input impedance $\left(10 \mathrm{M} \Omega-10 \mathrm{G} \Omega\right.$ ), wide gain range $\left(G_{\mathrm{V}}=1-\right.$ 1000, set by internal or external gain-setting resistors), and very high CMRR at higher gains (110-140 dB at $G_{\mathrm{V}}=$ 100). These are largely built with conventional (not autozero) circuitry; but some are of the CMOS auto-zeroing flavor, with very low offset voltage and drift (to $10 \mu \mathrm{~V}$ and $20 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ max). Table 5.8 (page 363) lists a good selection of instrumentation amplifiers, which include auto-zero types such as the AD8553, AD8230, AD8293, INA333, LTC2053, and MAX4209. Some conventional instrumentation amplifiers that compete in this low-drift arena are the LTC1167/8 ( $40 \mu \mathrm{~V}, 50 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ max) and the AD 8221 ( $25 \mu \mathrm{~V}, 300 \mathrm{nV} /{ }^{\circ} \mathrm{C}$ max).

#### G. Do it yourself

If you like to get down into the guts of circuits, take a look at the LTC1043 "Precision Instrumentation Switched Capacitor Building Block." It lets you make your own high-CMRR differential amplifier. That's just one of its many tricks, which include switched-capacitor filters, oscillators, modulators, lock-in amplifiers, sample-andhold, frequency-to-voltage conversion, and "flying capacitor" voltage inversion, multiplication, and division. The datasheet makes great bedtime reading.

## 5.12 Designs by the masters: Agilent's accurate DMMs

This is another in the series of featured "Designs by the Masters," in which we take a close look at some exemplary circuit designs. Think of these as master classes in circuit design. You can learn a lot by cracking open a well-designed instrument. A fine example is provided by the excellent digital multimeters from Agilent, specifically their 34401A (6.5-digit) and 34420A (7.5-digit) benchtop meters. In Chapter 13 (§13.8.6) we discuss the precision "multislope ADC" technique they use. Here, in the context of precision analog design, we look in some detail at the clever front ends they've designed, from schematics help-
fully provided in their service manuals. ${ }^{56}$ Let's see how the real pros do it!

### 5.12.1 It's impossible!

At first glance, the task is impossible. Here's why.
Accuracy We need accuracy and linearity at the parts-per-million level, in a meter whose full-scale ranges go down to a fraction of a volt ( 100 mV for the 34401 A , 1 mV for the 34420A). That's far down in the nanovolt range.
Low noise Accuracy is useless if the instrumental noise makes successive measurements bounce around by many LSBs. So we need input voltage noise levels down at the nanovolt level for the most sensitive ranges.
High input impedance A voltmeter should have high input impedance to minimize circuit loading. So, for measurements at the ppm level, you'd like $R_{\text {in }}$ to be something like a million times as large as typical circuit impedances. That puts you in the gigaohm range, with input currents down in the picoamps.

Hence the quandary: gigaohms and picoamps means FETs. Conventional FET op-amps won't deliver this performance, though, owing to relatively large offset voltage, drift, and voltage noise. AZ op-amps (see Table 5.6 on page 335) are considerably more accurate, but they suffer from plentiful current noise. And discrete JFETs (those with large area can have very low voltage noise, less than $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) with their uncertain $I_{D}$ versus $V_{\mathrm{GS}}$ characteristics (§3.1.5) would seem to be hopeless at the fractional microvolt level. End of discussion.

### 5.12.2 Wrong - it is possible!

But it can be done. The trick is to realize that a digital instrument (with its on-board microprocessor brain) can calibrate away offsets (with a "zero" measurement) and scale errors (with a "full-scale" measurement), so that what matters is not the presence of offsets per se, but their stability (drift) during the measurement time. ${ }^{57}$ That allows the use

[^256]of discrete dual JFETs, with their unbeatable combination of low $e_{\mathrm{n}}$ and low $I_{\mathrm{B}}$, in a JFET-enhanced op-amp configuration. That way you can get the high loop gain you need for linearity, particularly in the sensitive ranges where the front-end gain is 1000 or 10,000 .

That's not the end of the story. You need precise resistor networks with low voltage coefficient, a circuit configuration that maintains its accuracy over a large common-mode input range (to $\pm 10 \mathrm{~V}$ ), and of course a voltage reference whose stability determines the instrument's overall accuracy.

### 5.12.3 Block diagram: a simple plan

These instruments leverage the power of "embedded control" (an on-board microcontroller) to deliver great performance from an architecture of great simplicity. The basic scheme (Figure 5.57) is simplicity itself: it consists of a single amplifier, configured in the familiar noninverting opamp connection, with floating ground referenced to the $(-)$ input jack. The microcontroller is the boss, here: its code implements the high-accuracy ADC (§13.8.6), and takes care of the multiple on-the-fly calibrations that are needed to wring part-per-million (or better) performance out of a collection of inexpensive parts. Let's dive into the guts of these two DMMs to see how it all works.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0376.jpg?height=458&width=804&top_left_y=1340&top_left_x=218)

Figure 5.57. The Agilent DMMs: extreme simplicity. . . at the block diagram level.

### 5.12.4 The 34401A 6.5-digit front end

The 34401A made its debut in 1991, surprising the T\&M (test and measurement) world with astonishingly good performance (resolution to 6.5 digits, measurements to 1000/s, accuracy to 20 ppm ) at an affordable price ( $\sim \$ 1 \mathrm{k})$. The input amplifier (preceded by protection circuitry, and atten-
uators for the 100 V and 1000 V ranges ${ }^{58}$ ) provides gains of $\times 100$ (100 mV range), $\times 10$ (1 V range), and $\times 1$ (10 V range) with $R_{\text {in }}>10 \mathrm{G} \Omega$; the input attenuator kicks in for the 100 V and 1000 V ranges, for which $R_{\mathrm{in}}=10 \mathrm{M} \Omega$.

The basic structure is a low-noise precision op-amp (an OP-27), driven by a JFET source-follower pair, as shown in Figure 5.58A. (The configuration in Figure 5.58B, where a JFET common-source differential amplifier replaces the follower, is used in the 34420A to provide the additional loop gain and lower voltage noise needed for its more sensitive 1 mV and 10 mV full-scale ranges). The BJT-input op-amp provides lots $(120 \mathrm{~dB})$ of stable $\left(0.2 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}\right)$ lownoise $(3 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ gain, but at a price: an unacceptable input current of $\pm 15 \mathrm{nA}$, with correspondingly high input current noise ( $1.7 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ ). The JFET follower cures problems of input current and noise, at the expense of offset stability ( $40 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ !) and significant added voltage noise $(10 \mathrm{nV} / \sqrt{\mathrm{Hz}})$. The tradeoff sounds bad - but it's good enough for this instrument. (It's not good enough for the more accurate and sensitive 34420 A, as we'll see presently.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0376.jpg?height=330&width=845&top_left_y=1100&top_left_x=1067)

Figure 5.58. Basic JFET-enhanced op-amp configurations for the Agilent DMMs: A. source follower, used in the 34401A; B. commonsource differential amplifier, used in the 34420A.

The full circuit is shown in Figure 5.59. Note first the bootstrapped drain supply for the JFET pair: $Q_{2}$ maintains a constant drain-source voltage across $Q_{1}$ (equal to $Q_{2}$ 's $V_{\mathrm{GS}}$ at the operating current, the latter held constant by the complicated-looking current sinks on $Q_{1}$ 's source terminals). This is essential, because the JFET pair $Q_{1}$ is anything but precise (would you believe, $V_{\mathrm{OS}}(\max )=40 \mathrm{mV}$ ?!), and so the variation of this mediocre offset voltage with varying input signal (thus varying $V_{\mathrm{DS}}$ ) would surely torpedo any expectation of accuracy. But by bootstrapping the drains to follow the sources, the transistors don't even know that there's any input signal variation; they don't know, so they can't mess things up. Furthermore, the low operating voltage ( $1-2 \mathrm{~V}$ ) keeps the gate leakage small

[^257]and unchanging with input voltage variations over the full $\pm 15 \mathrm{~V}$ input signal range. Clever! ${ }^{59}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0377.jpg?height=891&width=810&top_left_y=320&top_left_x=110)

Figure 5.59. Agilent 34401A frontend amplifier, capable of measurements with $0.1 \mu \mathrm{~V}$ resolution. The input is single-ended, amplified and measured with respect to the instrument's input common terminal.

The circuit's voltage gain is set accurately by the analog switch and matched resistor network, implemented in a custom gain-switching IC.

The source pull-down circuitry is a current sink pair, based on the stable +10 V reference that is used also for the downstream ADC (see §13.8.6). It's easier to understand in the redrawn form of Figure 5.60, in which only one of the current sink pair is shown and the Darlington is replaced with a single npn transistor. The left-hand opamp generates a voltage across $R_{2}$ of $V_{\mathrm{REF}} R_{2} / R_{1}$; hence the sink current shown in the figure. In its DMM, Agilent uses a matched network for $R_{2}$ and the pair of $R_{3}$ 's (one for each source pull-down). The extra resistor $R_{4}$ offsets the emitter voltage downward, to $V_{\mathrm{E}}=-V_{\mathrm{REF}} R_{4} / R_{1}$, to provide the needed compliance for input signals that range over $\pm 15 \mathrm{~V}$ ( $\pm 12 \mathrm{~V}$ operating range, plus an additional 3 V to accommodate ripple and noise). If you plug in the resistor values

[^258]from Figure 5.59, you'll find that the compliance extends down to -14 V (emitter is at -14.6 V ), and that the individual source pull-down currents are $680 \mu \mathrm{~A}$. The designers used Darlington transistors to keep the base current error small (roughly $I_{c} / 4500$, assuming a transistor beta of 200).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0377.jpg?height=483&width=758&top_left_y=503&top_left_x=950)

Figure 5.60. Agilent 34401A reference-based current sink.

### 5.12.5 The 34420A 7.5-digit frontend

With the 6.5 -digit 34401 A as a warmup, let's look at its wiser sibling, the 34420A 7.5-digit DMM. It boasts both improved resolution and greater sensitivity ( 1 mV fullscale), putting real demands on the accuracy, stability, and noise of the front end. On its most sensitive range the frontend amplifier has a gain of 10,000 (to bring the $\pm 1 \mathrm{mV}$ input to the $\pm 10 \mathrm{~V}$ ADC span), requiring lots of open-loop gain to maintain accuracy and linearity. With sensitivity and resolution comes a demand for low noise; for example, the specifications list a "DC Voltage Noise" (with 2minute averaging) of $1.5 \mathrm{nV}(\mathrm{rms})$ on the 10 mV range that's 0.15 ppm .

To meet these demands, the designers used the configuration of Figure 5.58B, in which the JFET pair is configured as a common-source differential amplifier for greater loop gain and reduced noise. The full amplifier circuit is shown in Figure 5.61.

Once again the JFETs are operated at constant current ( 2 mA each), with bootstrapped drains (held $V_{Z}-2 V_{B E}-1 \mathrm{~V}$ above the source, i.e., $V_{\mathrm{DS}} \approx 2.5 \mathrm{~V}$ ). They chose JFETs with much larger geometry for greatly reduced noise voltage (an impressively low $e_{\mathrm{n}}=0.4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 Hz ). These are monster JFETs: $I_{\mathrm{DSs}}=50 \mathrm{~mA} \mathrm{~min}$, 1000 mA max (how's that for a parameter spread?!), with an input capacitance of order 500 pF , and an unenviable offset voltage spec of $\pm 100 \mathrm{mV}$ (with no tempco
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0378.jpg?height=1161&width=804&top_left_y=208&top_left_x=218)

Figure 5.61. Agilent 34420A frontend gain block, used for measurements of 0.1 nV resolution with $G=10,000$ (gain-switching feedback shown in Figure 5.62).
specified). This latter parameter would not appear to bode well for nanovolt measurements! (As we'll see presently, there's provision for continually trimming the measured offset.) These things are brutes, but they sure are quiet. We'll return to this circuit shortly, to deal with issues of gain, bandwidth, and noise. First, though, a look at the overall gain-setting loop.

#### A. Two-stage gain-setting loop

What's shown in Figure 5.61 is the bare amplifier, which sits in the feedback and trimming circuit of Figure 5.62. The gain selection is made with two stages of precision attenuators of high stability (these are custom modules), isolated by precision op-amp $A_{1}$ whose offset can be read and cancelled as part of the measurement cycle (by comparing the amplifier's output with the two possible $G=1$ configurations). The offset of $A_{2}$ can also be measured, from the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0378.jpg?height=779&width=717&top_left_y=218&top_left_x=1116)

Figure 5.62. Agilent 34420 A range-switching feedback circuit, wrapped around the "amplifier" of Figure 5.61. See $\S 13.3 .3$ and Figure 13.15 for the leakage-correction circuit.
amplifier's output when the offset DAC is set to zero and the gain to $\times 100$.

The "offset DAC" is used to dispatch the big elephant in the room (the JFET pair's offset, which can range to $\sim 50 \mathrm{mV}$ ). This it does by generating a voltage output ( $\pm 5 \mathrm{~V}$ range), which offsets the node marked " $x$ " over a range of $\pm 50 \mathrm{mV}$. Follower $A_{2}$ replicates that offset at the bottom of the right-hand gain-setting divider, establishing an effective ground-reference point for the first-stage divider. Here's a subtle point: with a circuit of this precision (in the 1 mV range, the LSB is just 1 nV ) you have to worry about stuff you normally ignore - for example the effect of voltage drops through ground path resistance. Here the offset DAC may sink or source up to 1 mA ( 5 V across $5 \mathrm{k} \Omega$ ), which would push "ground" around by an unacceptable 100 nV if its path had, say, $0.1 \mathrm{~m} \Omega$ of resistance. That's why the designers added $A_{3}$, whose output pushes a balancing current of opposite sign into the same ground node; if that current is matched to $1 \%$, the error is reduced to 1 nV .

This raises a related point: when talking nanovolt stability, don't we have to worry about $A_{1}$ 's drift? Quite so - but the effect of splitting the gain-setting attenuator into two sections is to reduce that drift by the attenuation of the left-hand divider, i.e., $\times 100$ in the most sensitive range.

#### B. Care and feeding of the JFETs

An important rule to follow when doing low-distortion precision design using discrete transistors: use a circuit configuration that keeps the transistor's operating conditions ( $V_{\mathrm{ds}}$ and $I_{\mathrm{d}}$ ) unchanged as the input signal changes. Both of these amplifier designs carefully follow this rule, but in different ways, to achieve their good performance. Both designs also operate the JFETs at low drain-source voltages to reduce gate leakage and to minimize self-heating (see §3.2.8).

This same rule is followed (in the second design) with respect to the MC34081 JFET op-amp's input voltages, which are both pinned to $2 V_{\mathrm{BE}}+1.9 \mathrm{~V}$ below the +22 V rail. Likewise the mirror transistors see no change in voltage for a signal-input swing from -15 to +15 V . Only the feedback capacitor $C_{\mathrm{c}}$ sees a change in voltage.

Finally, despite the low $V_{\mathrm{DG}}$ operating voltage for the $Q_{1}$ JFETs, there is still an issue of small gate leakage currents to worry about. Agilent has added an input-bias-current correction circuit, with an 8 -bit DAC, to solve this problem. We discuss how this interesting circuit works in §13.3.3.

#### C. Amplifier gain: $\times 1$ to $\times 10,000$, stable to 0.1 ppm

Turning back to the amplifier (Figure 5.61), we can understand some nice subtleties. A closed-loop gain of $\times 10,000$ is needed in the 1 mV range, for which lots of open-loop gain is needed. The JFET differential amplifier provides gain ahead of the op-amp; though the gain is not easily calculated at dc (it depends on the impedance of the currentmirror drain load), we can estimate its gain-bandwidth product $f_{\mathrm{T}}$ by noting that compensation capacitor $C_{\mathrm{c}}$ makes the differential gain roll off according to $G=g_{m} X_{\mathrm{C}} / 2$, where $g_{m}$ is the transconductance of each JFET at the operating current (relay $K_{1}$ is closed for the 1 mV and 10 mV ranges, removing the $500 \Omega$ source degeneration resistors). $f_{\mathrm{T}}$ is the frequency at which the gain of the composite amplifier has fallen to unity, i.e., $f_{\mathrm{T}}=g_{m} / 4 \pi C_{\mathrm{c}}$. To estimate $g_{m}$, we note that these JFETs are operating well down in the subthreshold region (their $I_{\mathrm{DSS}}$ is typically 300 mA ), where FETs behave more like BJTs ( $I_{\mathrm{D}}$ exponential in $V_{\mathrm{GS}}$; see Figure 3.15), with their transconductance proportional to drain current and with $g_{m}$ only somewhat less than a BJT operating at the same current. For the IF3602 JFET running at $I_{\mathrm{D}}=2 \mathrm{~mA}$, then, we can estimate $g_{m} \approx 60 \mathrm{mS}$ (a BJT would have $g_{m}=40 I_{c} \mathrm{mS}$ ), thus $f_{\mathrm{T}}=1.5 \mathrm{MHz}$.

Running this backward, we find that the open-loop gain is about $10^{6}$ at 1 Hz , as seen in Figure 5.63. Source degeneration is enabled for the low-gain ranges, to maintain stability. The rolloff is easy to calculate, because the differ-
ential transconductance is reduced to $1 / 2 R_{\mathrm{S}}(1 \mathrm{mS})$, thus $f_{\mathrm{T}}=50 \mathrm{kHz}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0379.jpg?height=506&width=661&top_left_y=352&top_left_x=1042)

Figure 5.63. Differential gain for the amplifier of Figure 5.61.

#### D. Sub-nanovolt amplifier noise

Finally, the important issue of noise. This is a big deal when you're talking nanovolts; it's the reason the designers chose huge-geometry JFETs, in spite of their, uh, less-than-ideal characteristics (offset voltage, input capacitance). Noise matters most in the most sensitive range, where full scale is $1 \mathrm{mV}(1.2 \mathrm{mV}$, to be precise, owing to the $20 \%$ overrange), and the 6.5 -digit LSB is 1 nV .

There are several noise sources here. The JFETs contribute about 1 nVrms in a 3 Hz band around 1 Hz ( $e_{\mathrm{n}}=0.4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ each, multiplied by 1.4 for uncorrelated noise). To explore further the measurement fluctuations, take a look at Figure 5.54, where we show the voltage noise of various op-amps, of both conventional and chopperstabilized varieties. The traces show the integrated rms noise voltage up to a cutoff frequency ( $x$-axis), including the effect of the component's $1 / f$ noise. The IF3602 is the lowest-noise part on the graph. If we assume an integration time of 100 PLC (powerline cycles) or 1.67 s , to achieve 7.5 -digit performance, that interval corresponds to a 0.6 Hz cutoff frequency, and about 3 nV rms of noise. If we average 64 such measurements over a two-minute period, we could hope for the rms fluctuations to be reduced by $8 \times$, to about 0.4 nV . Agilent claims 1.3 nV in their datasheet, evidently allowing for some nonrandom variations and other errors.

Noise in the current sink is of lesser importance because the differential stage cancels it to a high degree; that's a good thing, because this design uses a noisy voltage reference! (the MC1403 is an early bandgap design,
with unspecified noise voltage). ${ }^{60}$ The 34420A's digitizing capability drops from 7.5 to 6.5 digits when operating faster than 20 PLC, or 1.5 readings/sec, and further drops to 5.5 digits above $25 \mathrm{rd} / \mathrm{s}$, and 4.5 digits above $250 \mathrm{rd} / \mathrm{s}$, so rising high-frequency amplifier noise wouldn't be noticed.

#### E. Going beyond the specifications

When pushing the limits of the possible, you often find that the job cannot be done while respecting worst-case component specifications. Here, for example, the critical JFET transistor pair has a worst-case specified gate leakage current of 500 pA (at $25^{\circ} \mathrm{C}$ ), whereas the instrument specifies a maximum input current of 50 pA . What to do?

If you are a major manufacturer, you can often persuade the supplier to screen parts to a tighter specification. In any case, you can do the job yourself. Be aware, though, that there's generally no guarantee of process continuity, and the availability of better-than-specified parts; worse still, the special parts you need may be discontinued altogether! One possibility, if you're willing to hazard a guess as to an instrument's long-term popularity, is to buy a lifetime supply of a critical part.

## 5.13 Difference, differential, and instrumentation amplifiers: introduction

These terms describe a class of dc-coupled amplifiers that accept a differential signal-input pair (call them $V_{\text {in }+}$ and $V_{\text {in- }}$ ), and output either a single-ended signal or a differential-output pair that is accurately proportional to the difference: $V_{\text {out }}=G_{\mathrm{V}} \Delta V_{\text {in }}=G_{\mathrm{V}}\left(V_{\text {in }+}-V_{\text {in- }}\right)$. Their shared claim to fame is high common-mode rejection, combined with excellent accuracy and stability of voltage gain. Here are their distinctive features, as commonly understood among circuit designers.

Difference amplifier differential in, single ended out; opamp plus two matched resistor pairs (Figure 4.9, §4.2.4, and Figure 5.65); CMRR 90-100 dB; accurate but low gain ( $G_{\mathrm{V}}=0.1-10$ ); input impedance $25-100 \mathrm{k}$, intended

[^259]to be driven by a low impedance; inputs typically can go beyond rails.
Instrumentation amplifier differential in, single ended out; very high input impedance ( $10 \mathrm{M} \Omega-10 \mathrm{G} \Omega$ ), wide gain range $\left(G_{\mathrm{V}}=1-1000\right)$, and very high CMRR at higher gains (110-140 dB at $G_{\mathrm{V}}=100$ ); §5.15, e.g., Figure 5.77.
Differential amplifier differential or single ended in, differential out; most are low voltage, fast settling, and wideband; ideal for twisted-pair cable drivers and fast differential-input ADCs; §5.17, e.g., Figure 5.95.

An obvious application is the recovery of a signal that is inherently differential, but that rides on some commonmode level or that is afflicted by common-mode interference. Figure 5.64 shows an example of each.

The first example is the strain gauge we saw earlier (§5.4), a bridge arrangement of resistors that converts strain (elongation) of the material to which it is attached into resistance changes; the net result is a small change in differential-output voltage when powered by a fixed dcbias voltage. The resistors all have approximately the same resistance, typically $350 \Omega$, but they are subjected to differing strains. The full-scale sensitivity is typically $\pm 2 \mathrm{mV}$ per volt, so that the full-scale output is $\pm 10 \mathrm{mV}$ for 5 V dc excitation. This small differential-output voltage (proportional to strain) rides on $\mathrm{a}+2.5 \mathrm{~V}$ dc level. The differentialinput amplifier must have extremely good CMRR in order to amplify the millivolt differential signals while rejecting the $\sim 2.5 \mathrm{~V}$ common-mode signal and its variations. For example, suppose you want a maximum error of $0.1 \%$ of full scale. That's $\pm 0.01 \mathrm{mV}$, riding on 2500 mV , which amounts to a CMRR of 250,000:1, or 108 dB . This overestimates the needed CMRR: in practice you would perform a "zero calibration," so that the CMRR need be adequate only to reject variations in the +5 V bridge bias; something like 60 dB would suffice here. ${ }^{61}$

The second example (Figure 5.64B) comes from the world of professional audio, where you encounter some pretty impressive challenges. In a concert recording situation, for example, you may have microphones hanging from a high ceiling, with connecting cables 100 m or more in length. The peak signal levels may be around a volt, dropping to a millivolt during quiet portions of the music. But you've got to keep powerline pickup and

[^260]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0381.jpg?height=429&width=1572&top_left_y=209&top_left_x=163)

Figure 5.64. Inherently differential signals, for which good common-mode rejection is required. (a) Strain gauge. (b) Audio balanced line pair.
other annoyances (e.g., switching noise from lighting dimmers) another 40 dB below that - the human ear is distressingly sensitive to extraneous sounds. Add up the dBs - we need 100,000:1 suppression of pickup ( $<10 \mu \mathrm{~V}$ )! Seems impossible; but recording engineers have been doing this successfully for decades by the simple expedient of transporting audio signals on a balanced differential pair (with a standard signal impedance of $150 \Omega$ or $600 \Omega$ ). For this they use a well-shielded twisted-pair cable, terminated in the legendary 3-pin XLR latching connector (which can take plenty of abuse - it's got a tough metal shroud, good strain relief, and so on). And to keep the signal fully balanced they use either a high-quality audio transformer or a well-designed differential-output driver (at the transmit end), and another transformer or a well-designed differential-input amplifier (at the receive end).

Lest we leave a misleading impression, we hasten to note that differential-input amplifiers are helpful also in situations in which the signals themselves are not inherently differential. Two common examples are accurate low-side current sensing (Figure 5.68a), and the use of differential-input amplifiers when sending signals between instruments (Figure 5.67). In the latter, the flexibility provided by a difference amplifier's output REF pin enables us to avoid ground loops while transporting a signal between a pair of instruments whose local grounds are not identical.

The tricks involved in making good instrumentation amplifiers and, more generally, high-gain differential amplifiers are similar to the precision techniques discussed earlier. Bias current, offsets, and CMRR errors are all important. Let's begin by discussing the design of difference amplifiers for less critical applications, working up to the most demanding instrumentation requirements and their circuit solutions.

## 5.14 Difference amplifier

Let's look first at the difference amplifier: its basic operation, some applications, a closer look at its performance parameters, and finally some clever circuit variations.

### 5.14.1 Basic circuit operation

The classic difference amplifier (Figure 5.65) consists of an op-amp with matched resistor pairs $R_{\mathrm{f}}$ and $R_{\mathrm{i}}$, for which the differential gain is

$$
G_{\mathrm{diff}} \equiv \frac{V_{\text {out }}}{V_{\mathrm{in}+}-V_{\mathrm{in}-}}=R_{\mathrm{f}} / R_{\mathrm{i}}
$$

Assuming an ideal op-amp, the common-mode rejection
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0381.jpg?height=328&width=478&top_left_y=1392&top_left_x=1103)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0381.jpg?height=192&width=295&top_left_y=1797&top_left_x=1077)

$$
G=0.5
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0381.jpg?height=241&width=302&top_left_y=1793&top_left_x=1390)
B.

Figure 5.65. Classic difference amplifier, with the resistor values used in the AD8278/9 ( $G=0.5$ or 2).
is limited by the matching of the $R_{\mathrm{f}} / R_{\mathrm{i}}$ ratio in the two paths; with discrete resistors of $1 \%$ tolerance, for example,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0382.jpg?height=712&width=1685&top_left_y=195&top_left_x=198)

Figure 5.66. The tricks that a unity-gain difference amplifier can play. Note the separate ground symbols for (D) and (E).
you could expect a CMRR of $\sim 40 \mathrm{~dB}$ at low frequencies (where the op-amp itself has a higher CMRR and where effects of capacitive imbalance are negligible). That's adequate for situations in which only a modest CMRR is needed, for example low-side current sensing. For better performance you could trim one of the resistors or use resistors of tighter tolerance (for example the commonly available $0.1 \%$ types, typically $\$ 0.10-\$ 0.20$ in 100pc quantity, or the inexpensive Susumu RG-series, with $0.05 \%$ tolerance and $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ tempco, about $\$ 1$ ); or, better, use matched resistor pairs (e.g., the not-inexpensive Vishay MPM-series, with ratio tolerances down to $0.01 \%$ and ratio tempcos to $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ or the LT5400 matched quad, with similar ratio tolerance and with ratio tempco of $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ max).

But don't get carried away... because there are plentiful offerings of complete integrated difference amplifiers of excellent performance, costing a lot less than you'll spend rolling your own. We've listed many of these in Table 5.7 on page 353. In the "normal" configuration the SENSE line is connected to the output and the REF line is connected to circuit ground. But you can run it in reverse, as shown in Figure 5.65B. To give a sense of the performance you get with these integrated difference amplifiers, the worst-case specifications for the AD8278B in the figure are gain accuracy of $\pm 0.02 \%$ (for $G=0.5$ or $G=2$ ); gain tempco of $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$; offset voltage and tempco of $100 \mu \mathrm{~V}$ and $1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$; and a CMRR of 80 dB . It costs about \$3.

### 5.14.2 Some applications

#### A. Single-ended input

It's perfectly OK to use a difference amplifier with a singleended input, for example, to get a precise and stable gain. Figure 5.66 shows some simple configurations. Note that differential nature of its inputs is not "wasted" when a difference amplifier is used as in (D) and (E), because its independent REF pin accommodates small differences in ground potential at input and output. Put another way, the output voltage, relative to its ground, is precisely $\pm 1.0$ (in this case) times the input voltage, relative to its ground.

#### B. Ground-loop isolation

This property is just what you need for the ground-loop isolating application of Figure 5.67. In the first circuit, the driver side permits its output reference to float to the potential of the (non-floating) receive side. The small-value resistor and bypass capacitor allow a small voltage difference when forced by the receive end. Both sides are happy. In the second circuit we've allowed the receive side's input common to float, as forced by the (non-floating) driver. These circuits resolve minor ground-loop problems in single-ended cable connections; but they are no substitute for the fully isolated and/or balanced approach that's needed in demanding applications like professional audio or video.

#### C. Current sensing

Figure 5.68 shows difference amplifiers used for low-side and high-side current sensing, perhaps as part of a constant-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0383.jpg?height=759&width=585&top_left_y=215&top_left_x=228)

Figure 5.67. Exploiting the REF pin to prevent powerline-frequency ground loops in connected instruments.
current control, or simply for precise load-current monitoring. At first glance it may seem unnecessary to use a difference amplifier for the low-side sensing configuration, because the sense resistor returns to circuit ground. But imagine that we're dealing with lots of power, say up to 10 A load current. We'd use a low-value precision sense resistor, perhaps $0.01 \Omega$, to keep its power dissipation below 1 W . Even though one side of it is connected to ground, it would be unwise to use a single-ended amplifier, because a connection resistance of just a milliohm would contribute $10 \%$ error! A differential-input amplifier is the solution, connected as shown to a 4-wire "Kelvin-connected" sense resistor. Note that the difference amplifier need not have particularly good CMRR, because the low side isn't moving far from ground.

The same is not true of the high-side configuration (Figure 5.68B), where the common-mode voltage is far greater than the differential voltage. Here we've specified a unitygain difference amplifier intended for high-voltage applications, which permits common-mode input voltages to $\pm 200 \mathrm{~V}$ (its internal circuit uses a 20:1 resistive divider at the front end, see §5.14.3). Let's look at the numbers: the dc voltage can range from 0 to 200 V ; so the specified minimum CMRR of $86 \mathrm{~dB}(1: 20,000)$ would interpret that as equivalent to a differential input variation of 10 mV . Is that bad? You bet! To maintain $1 \%$ accuracy of sensed current we'd need to size $R_{\mathrm{S}}$ to drop 1 V at full load current. That's a lot of "voltage burden," and it's a whopping 10 W
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0383.jpg?height=348&width=322&top_left_y=221&top_left_x=982)
A. low-side
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0383.jpg?height=266&width=409&top_left_y=303&top_left_x=1362)
B. high-side

Figure 5.68. Current sensing for measurement or control. Lowside sensing (A) is forgiving of CMRR, unlike high-side sensing (B), for which the difference amplifier shown would introduce significant error in a high-voltage and high-current supply (where only a small drop across $R_{\mathrm{S}}$ can be tolerated).
of dissipated power, if this were a powerful 10 A dc supply as in the other example. So this scheme is adequate for a low-current 200 V supply; but there are better ways to do high-side sensing, for example by floating the amplifier and relaying the output down to earth as a current or (via an opto-isolator) as a digitized quantity.

#### D. Current sources

Figure 5.69 shows how to rig up a difference amplifier so that the (differential) input signal controls the voltage drop across a series sense resistor $R_{\mathrm{s}}$; in other words, it's a current source. You're welcome to use a single-ended control input, if you want. The output current can be of either polarity, and these circuits don't know, or care, whether the load returns to ground or to some other potential.

The op-amp follower $U_{2}$ should be chosen for an input bias current that is small compared with the minimum load current, and an offset voltage that is small compared with the drop across $R_{\mathrm{S}}$ at minimum load current. You might begin by choosing $R_{\mathrm{S}}$ for $\sim 1 \mathrm{~V}$ drop at $I_{\mathrm{L}}$ (max), or smaller for high $I_{\mathrm{L}}$ (max) or for low supply voltage, then see if $R_{\mathrm{s}} I_{\mathrm{L}}(\min )$ is at least $100 \mu \mathrm{~V}$ or so. For a large dynamic range, say $I_{\mathrm{L}}(\max ) / I_{\mathrm{L}}(\min ) \geq 10^{4}$, you'll need low-offset amplifiers for both $U_{1}$ and $U_{2}$; candidates are listed in Tables 5.2 (page 302), 5.3 (page 303), 5.5 (pages 320-321) and 5.6 (page 335).

The circuit in Figure 5.69A is good for low currents. For load currents greater than $\sim 5 \mathrm{~mA}$ use a power buffer (Figure 5.69B); that can be a wideband (for stability) unity-gain IC buffer like the LT1010, or (if you need only one polarity of output current) a MOSFET or BJT follower. A favorite trick is to use a 3-terminal adjustable regulator (like an LM317) as a "power buffer," thus taking advantage of
its internal thermal and overcurrent protection. To use it this way, you drive the ADJ pin, and the out pin "follows" 1.25 V higher (should this be called a voltage leader?!). As always, feedback takes care of the offset.

We like using $G=10$ difference amplifiers, such as INA106 or INA143, connected "backwards" for $G=0.1$, because the sense voltage is then one-tenth of the programming voltage and thus doesn't eat up so much of the output compliance range. In common with other current sources whose output comes from an op-amp, these configurations become more like voltage sources at high frequencies, where op-amp compensation and slew-rate effects dominate (see $\S \S 4.2 .5$ and 4.4.4). ${ }^{62}$ Better performance at high frequencies can be gotten with an active current source based on an instrumentation amplifier, configured with an inherently high impedance output terminal, as shown in Figure 5.87 in §5.16.9.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0384.jpg?height=754&width=621&top_left_y=961&top_left_x=307)
B. "any" current, $R_{\mathrm{S}}: \mathrm{m} \Omega$ to $\mathrm{G} \Omega$

Figure 5.69. Precision current sources: $I_{\mathrm{L}}=G_{\text {diff }}\left(V_{\mathrm{A}}-V_{\mathrm{B}}\right) / R_{\mathrm{S}}$. The (bipolarity) output current in (A) is limited to $U_{1}$ 's $I_{\text {out }}$ (max). Adding a unity-gain power buffer (an IC wideband buffer, or a transistor follower) in (B) allows large output currents (follower $U_{2}$ can be omitted if $R_{\mathrm{S}}$ is less than $0.2 \Omega$ or so). These circuits don't know, or care, where the load returns.

[^261]
#### E. High-level line driver

Professional audio lives and breathes differential analog signaling, in the form of balanced lines terminated (usually) in a nominal $600 \Omega$ bridging resistance. And the levels are substantial: pro-audio equipment adopts a " 0 dB " standard of $1.23 \mathrm{Vrms},{ }^{63}$ and you'll generally see additional specified headroom of 16 dB to 20 dB without clipping. So $\mathrm{a}+20 \mathrm{~dB}$ level is 12.3 Vrms , or a differential amplitude of 17.4 V (34.8 Vpp). That requires some serious attention to line drivers, which should not compromise the low noise and distortion qualities of the program material.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0384.jpg?height=585&width=795&top_left_y=700&top_left_x=1072)

Figure 5.70. Differential high-level line driver for professional audio.

Figure 5.70 shows a nice $G=2$ circuit for the job, based around a pair of unity-gain difference amplifiers. These are implemented here with wideband op-amps of substantial output-current capability, allowing for an overall gain (differential-output voltage divided by single-ended input voltage) other than $\times 2$. The particular listed op-amps all run from supply voltages to $\pm 18 \mathrm{~V}$, producing output swings (on each line of the pair) to $\pm 15 \mathrm{~V}$ or so (significantly greater than the $\pm 9 \mathrm{~V}$ corresponding to a 20 dB pro-audio headroom). Three op-amp choices are shown, of comparable bandwidth ( $\sim 100 \mathrm{MHz}$ ) but aimed at different applications. The LM7372 is well specified out to 10 MHz and intended for video and broadcast applications, whereas the LME 49 xxx parts are optimized for audio bandwidths, with pretty impressive specifications out to 20 kHz . It's not often (more like never!) that you see amplifiers with total harmonic distortion (THD) specifications of 0.1 ppm
${ }^{63}$ The base unit for audio level is " 0 dBu ," an rms voltage corresponding to 1 mW into a $600 \Omega$ load; that works out to 0.775 Vrms. Pro-audio's 0 dB level is +4 dBu , hence 1.23 Vrms ; home audio is considerably less muscular, at -10 dBu , or 0.25 Vrms .
$(-140 \mathrm{~dB})$, here combined with very low voltage noise $(1.4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 Hz$) .{ }^{64}$

Some interesting alternatives are the DRV134 and the LME49724, which integrate a fully differential output circuit, capable of comparable performance, into one IC. The latter are examples of fully-differential amplifiers, with differential inputs as well; one input can be grounded to work with single-ended signal sources. We'll see these later, in §5.17.

#### F. Wideband analog over twisted pair

Twisted-pair network cable ("Cat-5e," etc.) is ordinarily used for digital data transmission on local area networks (LANs), but it can be used successfully for analog signals as well. The ubiquitous Cat-5e and Cat-6 cables contain four unshielded pairs (hence "UTP" - unshielded twisted pair), which interestingly are twisted with differing (incommensurate) pitches to minimize normal-mode coupling.

However, there's plenty of common-mode coupling, both between pairs and to the outside world. So you need to use a differential driver (\$5.17) combined with a difference amplifier at the far end. And, for wideband transmission over anything longer than a few inches you need to terminate the pair in its characteristic impedance of $100 \Omega$ (see Appendix H).

Figure 5.71 shows how to use a difference amplifier as an analog "line receiver" for such signals (we'll show the driving end later, in §5.17.2). This circuit comes from the AD8130's datasheet, illustrating the use of some "peaking" to compensate for the signal attenuation at high frequencies in the rather long (300m!) cable. The amplifier has $G=3$ at low frequencies, with $R_{4} C_{1}$ kicking in around 1.6 MHz (where $C_{1}$ 's reactance equals $R_{3}$ ) to boost the sagging response. The result of this simple "equalizer" is to produce an overall response flat to $\pm 1 \mathrm{~dB}$ from dc to 9 MHz . The $\times 3$ low-frequency gain is needed (a) to compensate for the signal that is lost because of the resistive divider consisting of $R_{1}$ and the cable pair's $50.5 \Omega$ round-trip resistance (a factor of 1.5), and (b) to double the output signal so it can drive a "back-terminated" video cable (see Appendix H).

### 5.14.3 Performance parameters

In the preceding sections we glossed over some important issues: input impedance (both differential and common

[^262]mode) and its effect on gain when driven with finite source impedance or its effect on CMRR when driven from an unbalanced source impedance; common-mode input range; and amplifier bandwidth and its effect on CMRR. It's time to peel the onion.

#### A. Input impedance

From Figure 5.65 it might seem that the input impedance of a difference amplifier is $R_{\mathrm{i}}$ (or maybe some multiple of that), and that all is well if the signal driving it has a source (Thev́enin) impedance $R_{\mathrm{S}}$ that is much less, perhaps our usual seat-of-the-pants criterion of $R_{\mathrm{S}} \lesssim 10 R_{\mathrm{i}}$.

Not so! These amplifiers revel in their precise gain (the selections in Table 5.7 on the next page have worst-case gain errors of $0.1 \%$ or better), and that gain accuracy is compromised unless $R_{\mathrm{S}}$ is smaller than the amplifier's $R_{\mathrm{I}}$ by at least that factor. That's because the signal's source impedance is effectively in series with $R_{\mathrm{I}}$, reducing the gain by the factor $R_{\mathrm{I}} /\left(R_{\mathrm{I}}+R_{\mathrm{S}}\right)$.

That gain reduction is actually the lesser of two problems. If you read the fine print on the datasheet, you'll discover that the excellent CMRRs of these amplifiers (surely their greatest claim to fame) is invariably specified for (drumroll) $R_{\mathrm{S}}=0 \Omega$ ! You could reasonably expect that the CMRR would be maintained if you drive both inputs with equal source impedances, because that should maintain the resistor ratio match. You could expect that, but you would be disappointed: the CMRR degrades rapidly with rising source impedances, even if they are precisely matched.

Why is that? During manufacture the internal resistors are laser trimmed, so that the ratio $R_{\mathrm{F}} / R_{\mathrm{I}}$ of the upper resistor pair precisely matches the corresponding ratio of the lower pair. The ratios are what are matched, at the expense of the absolute values; the two input resistors $R_{\mathrm{I}}$ may differ somewhat. ${ }^{65}$ So, if you drive it with a signal pair of matched source impedances $R_{\mathrm{S}}$, you get a mismatch in the feedback ratios, hence degraded CMRR. Bottom line: drive these puppies from an op-amp output, or from a signal source of very low $R_{\mathrm{S}}$ (e.g., a low-value current-sense resistor).

That's not always possible, of course. What can be done to raise the input impedance? The first thought might be simply to raise all the resistor values by some large factor. That has several drawbacks, the most serious of which are (a) the Johnson noise contribution

[^263]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0386.jpg?height=462&width=1302&top_left_y=218&top_left_x=397)

Figure 5.71. Differential line receiver for wideband analog over twisted pair. The "treble boost" provided by $C_{1} R_{4}$ compensates for the high-frequency rolloff of a 300m length of Cat-5 cable, as shown. See also Figure 5.101.

Table 5.7 Selected Difference Amplifiers

|  |  |  |  |  | Offset <br> Voltage |  | CMRR |  | Noise ${ }^{\text {k,t }}$ |  |  |  |  |  |  | Supply |  | Cost <br> (\$US) | $\frac{1}{\bar{I}}$ |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# | రᄋ | Gain | (\%) | $\begin{gathered} \pm \mathrm{max} \\ \left(\mathrm{Vapp}^{2}\right) \end{gathered}$ | $\begin{aligned} & \hline \text { typ } \\ & (\mu \mathrm{V}) \\ & \hline \end{aligned}$ | max <br> $(\mu \mathrm{V})$ | $\begin{aligned} & \hline \text { typ } \\ & \text { (dB) } \end{aligned}$ |  | き્ٍ | $Z_{\text {in }}$ <br> $(k \Omega)$ | $\begin{aligned} & d c^{0} \\ & (\mu \mathrm{~V}) \end{aligned}$ | $\left(\frac{\mathrm{nV}}{\sqrt{\mathrm{~Hz}}}\right)$ | $\begin{gathered} -3 \mathrm{~dB} \\ (\mathrm{MHz}) \end{gathered}$ | $\underset{(\mu \mathrm{s})}{0.01 \%}$ | 立 | Range <br> (V) | $\begin{gathered} I_{\mathrm{s}} \\ (\mathrm{~mA}) \end{gathered}$ |  |  | Comments |
| INA105K | A | 1.0 | 0.025 | 20 | 50 | 500 | 100 | 72 | 1 | 50 | 2.4 | 60 | 1 | 5 |  | 10-36 | 1.5 | 8.88 |  | egacy |
| AMP03 | A | 1.0 | 0.008 | 20 | 25 | 750 | 95 | 75 | 1 | 50 | 2 | $20^{\circ}$ | 3 | 1 |  | 10- | 2.5 | 5.86 |  |  |
| INA134 | A | 1.0 | 0.075 | 26 | 75 | 250 | 90 | 74 | 4 | 50 | $7^{\text {d }}$ | 52 | 3.1 | 3 |  | -36 | 2.4 | 2.36 |  |  |
| INA | A | 1.0 | 0.1 | 25 | 75 | 1500 | 90 | 74 | 4 | 50 | 2.6 | 52 | 3.1 | 3 |  | 8-36 | 2.4 | 2.36 |  | w cost |
| INA132P | A | 1.0 | 0.075 | 28 | 75 | 250 | 90 | 76 | 5 | 80 | 1.6 | $65^{\text {C }}$ | 0.3 | 88 | - | 2.7-36 | 0.16 | 4.62 |  |  |
| AD8271B | $A^{\text {m }}$ | 0.5,2 | 0.02 | $>18$ | 300 | 600 | 92 | 80 | 10 | 20 | 1.5 | 38 | 15 | 0.55 | - | -36 | 2.6 | 3.50 |  | 0.5,1,2 |
| AD82 | A | 0.5,2 | 05 | $>18$ | 200 | 1400 | 86 | 77 | 7 | 24 | ${ }_{7}$ d | 52 | 20 | 0.75 | - | 5-36 | 2.5 | 3.13 |  | ual audio, 6 ppm dist |
| THAT1206 | F | 0.50 | 0.5 | 26 | - | 10mV | 90 | 70 |  | 48 |  | $28^{\text {n }}$ | 34 |  | - | 24-40 | 4.7 | 4.75 |  | cm=10M, <6ppm dist |
| AD827 | A | 0.5,2 | 0.02 | $>18$ | 50 | 100 | 100 | 80 | 1 | 80 | 1.4 | 47 | 1 | 9 | - | -36 | 0.2 | 2.72 |  | diff $=0.5,2 ;$ dual '79 |
| INA106 | A | 10 | 0.025 | 11 | 50 | 200 | 100 | 86 | 1 | 20 | 1 | 30 | 5 | 10 |  | 10-36 | 1.5 | 11.00 |  | .10, legacy |
| INA143U | A | 10 | 0.1 | 15 | 100 | 500 | 96 | 86 | $4^{\text {h }}$ | 20 | 1 | 30 | 0.15 | 9 | - | 4.5-36 | 1.0 | 3.36 |  | 10, dual=INA2143 |
| LT1991A | $A^{m}$ | 1,4,10 | 0.06 | 27 | 15 | 50 | 100 | 77 | $8^{\text {h }}$ | 90 | 0.25 | 46 | $0.11^{f}$ | 48 | f | 2.7-40 | 0.10 | 2.50 |  | ,9,12, includes filter |
| LT1996A | $A^{m}$ | 9-117 | 0.07 | 279 | 15 | 50 | 100 | 80 |  | 339 | 0.25 | 18 | 0.04 | 85 | f | 2.7-40 | 0.10 | 5.72 |  | 27,81, includes filter |
| LT1995 | $A^{\text {m }}$ | 1-7 | 0.2 | 319 | 600 | 4000 | 87 | 75 | - | 49 | - | 14 | 32 | 0.1 | - | 2.7-40 | 7 | 3.78 |  | 2,4,4 |
| INA146 | B | $0.1^{\circ}$ | 0.1 | 100 | 1000 | 5000 | 80 | 70 | 11 | 200 | 10 | 550 | 0.55 | 80 | $\cdot$ | 4.5-36 | 0.57 | 4.25 |  | gh-voltage inputs |
| INA117P | C | 1.0 | 0.02 | 200 | 120 | 1000 | 94 | 86 | 8 | 800 | 25 | 550 | 0.2 | 10 | - | 0-36 | 1.5 | . 54 |  | gh-voltage inputs |
| AD629B | c | 1.0 | 0.03 | 270 | 100 | 500 | 96 | 86 | 6 | 800 | 15 | 550 | 0.5 | 15 | - | 5-36 | 1.2 | 7.21 |  | gh-voltage inputs |
| A149 | C | 1.0 | 0.02 | 275 | 350 | 1100 | 100 | 90 | 1 | 800 | 20 | 550 | 0.5 | 7 |  | -40 | 0.8 | 6.00 |  | gh-voltage inputs |
| AD8479 | c | 1.0 | 0.01 | 600 | 500 | 1000 | 96 | 90 | u | 2000 | 30 | 1600 | 0.13 | 11 |  | 5-36 | 0.55 | 9.66 |  | ghest CM voltage |
| AD628A low-volta | $\begin{gathered} \mathrm{C} \\ \text { taae } \end{gathered}$ | ext | 0.1 | 120 | - | 1500 | - | 75 |  | 220 | 15 | 300 | 0.6 | 40 | $\cdot$ | 4.5-36 | 1.2 | 3.36 |  | $\checkmark$ inputs, filter+gain |
| AD8275B | D | 0.2 | 0.024 | 27 | 150 | 500 | 96 | 80 | 2 | 108 | $1^{\text {ce } \mathrm{e}}$ | $40^{\text {e }}$ | 15 | 0.45 | - | 3.3-15 | 1.9 | 4.23 |  | with $V_{\text {ref }}$ /2 offset |
| AD830 | $\mathrm{E}^{\mathrm{g}}$ | 1-10 | 0.6 | 24 | 1500 | 3000 | 100 | 90 | 12 | 370 | - | 27 | 85 | 0.025 | p | 8-36 | 14 | 4.86 |  | =1+R2/R1, $V_{\text {in }}<2 \mathrm{~V}$ |
| AD8129 | $\mathrm{E}^{\mathrm{g}}$ | 10-100 | 0.6 | 20 | 200 | 800 | 105 | 92 | 12 | 1000 | - | 4.6 | 200 | 0.02 | p | 4.5-25 | 10 | 2.90 |  | =1+R2/R1, $V_{\text {in }}<2 \mathrm{~V}$ |
| AD8130 | E9 | 1-20 | 0.6 | 20 | 400 | 1800 | 105 | 90 | 12 | 6000 | - | 12.3 | 250 | 0.02 | p | 4.5-25 | 11 | 2.90 |  | $=1+R_{2} / R_{1}, V_{\text {in }}<2 \mathrm{~V}$ |
| EL5172 | $\mathrm{E}^{\mathrm{g}}$ | 1-20 | 1.5 | 20 | 7 mV | 25mV | 95 | 75 |  | 300 | - | 26 | 250 | 0.01 | p | 4.7-12 | 5.6 | 1.27 |  | G $1+R_{2} / R_{1}, V_{\text {in }}<4 \mathrm{~V}$ |
| INA152EA | A | 1.0 | 0.1 | 18 | 250 | 1500 | 94 | 80 |  | 40 | 2.4 | 87 | 0.8 | 25 | - | 2.7-20 | 0.5 | 3.60 |  | $0.5,1,2$, RRIO |
| MAX4198 | A | 1.0 | 0.1 | 0,5 | 30 | 500 | 90 | 74 | $9^{\text {h }}$ | 50 | 7.8 | 58 | 0.175 | 34 | - | 2.7-7 | 0.05 | 2.38 |  |  |

Notes: (a) maximum common-mode voltage. (b) $0.01-10 \mathrm{~Hz}$ or $0.1-10 \mathrm{~Hz}$. (c) at 100 Hz . (d) 20 to 20 kHz . (e) RTO (referred to output). (f) includes 4 pF filter caps. (g) circuit E from Fig. 5.89. (h) CMRR curve flattens at BW frequency. (k) RTI (referred to input) unless noted. (m) multiple resistors. ( n ) noise $=-107 \mathrm{dBu}, 20 \mathrm{kHz}$ BW. (o) includes extra opamp filter stage. (p) for $\mathrm{G}>1$. (q) depends on gain. (r) at 1 kHz . ( t ) typical. ( u ) between $5 \& 6$.
$\left(e_{\mathrm{n}}=0.13 R^{\frac{1}{2}} \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$, thus a devastating $130 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for resistor values of $\sim 1 \mathrm{M} \Omega$; see Chapter 8 ), and (b) the bandwidth penalty caused by distributed stray capacitances. The second thought would be to put a pair of precision op-
amp followers at the inputs. That's OK, but there's a better way still, in circuit configurations such as the "three-opamp instrumentation amplifier," in which a front-end differential stage of high CMRR and high impedance drives a
difference amplifier output stage. We'll see these wonderfully useful amplifiers a bit later.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0387.jpg?height=374&width=786&top_left_y=323&top_left_x=130)

$$
\begin{aligned}
\text { common mode: } & Z_{\text {in }}(\text { each })=(G+1) R_{\mathrm{i}} \\
& Z_{\text {in }}(\text { combined })=\frac{1}{2}(G+1) R_{\mathrm{i}} \\
\text { differential mode: } & Z_{\text {in }}(-) \equiv \frac{\Delta V}{\Delta I}=2 \frac{G+1}{2 G+1} R_{\mathrm{i}} \\
& Z_{\text {in }}(+) \equiv \frac{\Delta V_{-}}{\Delta I_{+}}=\frac{G+1}{2} R_{\mathrm{i}} \\
& \text { " } Z_{\text {in }} \equiv \frac{\Delta V}{\Delta\left(I_{-}-I_{+}\right)}=\frac{G+1}{G} R_{\mathrm{i}}
\end{aligned}
$$

Figure 5.72. The several input impedances of the difference amplifier.

Circling back around to the initial question, what exactly is the "input impedance"? There are several answers - look at Figure 5.72. By common-mode input impedance we mean the incremental impedance seen at either input ${ }^{66}$ when both are driven together. With common-mode drive the two impedances are equal (apart from minor mismatching, as described above), because the output is fixed.

The differential-input impedance is a longer story. Taken individually (by grounding the other input), the two inputs exhibit different $R_{\mathrm{in}}$ : the inverting input connects to a virtual ground by way of $R_{\mathrm{i}}$, so its $R_{\mathrm{in}}=R_{\mathrm{i}}$, whereas the noninverting input sees $R_{\text {in }}=R_{\mathrm{i}}+R_{\mathrm{f}}$. For a difference amplifier with $G=10$, for example, these differ by a factor of eleven. This is a useful result, particularly if you plan to use a difference amplifier in a single-ended configuration like Figures 5.66D and E. A purist could argue, though, that we've done it wrong: a single-ended input change is really a combination of a purely differential input plus a common-mode offset of half that value. To satisfy such a person we've calculated the expressions in Figure 5.72, based upon a "pure" (symmetrical) differential input. Even when defined this way the input impedances seen at the two inputs are different. This leads us to a final definition of

[^264]differential input impedance based on the net input-current change, as shown. Datasheets most often list this value, without explanation: you've been warned!

A final observation: you won't generally see difference amplifiers with gains greater than 10 , because $R_{\mathrm{i}}$, and therefore the differential input impedance, becomes unmanageably small. For example, to get $G=1000$ you might choose $R_{\mathrm{i}}=100 \Omega$ and $R_{\mathrm{f}}=100 \mathrm{k}$. OK, maybe you can live with $\sim 100 \Omega$ input impedance; but you'd have to match the signal source impedances to $0.001 \Omega$ in order not to degrade the CMRR. The take-away: use an instrumentation amplifier (§5.15), not a difference amplifier, for high-gain differential-input applications.

#### B. Common-mode input range

The voltage divider formed by $R_{\mathrm{i}}$ and $R_{\mathrm{f}}$ permits the standard difference amplifier to accept input signals beyond the supply rails: protection diodes are at the internal opamp inputs, so the input signals could in principle swing as far as $\pm V_{S}(G+1) / G$ with supply voltages of $\pm V_{S}$ (figure out why). For example, the AD8278 has $R_{\mathrm{i}}=40 \mathrm{k}$ and $R_{\mathrm{f}}=20 \mathrm{k}$, so it can be connected for $G=0.5$ ("normal") or $G=2$ (reversed). It specifies the common-mode input range for both gains: $-3\left(V_{S}+0.1\right)$ to $+3\left(V_{S}-1.5\right)$ for $G=0.5$ (that is, about $\pm 40 \mathrm{~V}$ with $\pm 15 \mathrm{~V}$ supplies, which can be very useful indeed!), and $-1.5\left(V_{S}+0.1\right)$ to $+1.5\left(V_{S}-1.5\right)$ for $G=2$ (i.e., $\pm 20 \mathrm{~V}$ with $\pm 15 \mathrm{~V}$ supplies). But check the specs - not all difference amplifiers let you go that far.

A few of the difference amplifiers in Table 5.7 on the preceding page) do better still; for example, the INA117 has a common-mode range of $\pm 200 \mathrm{~V}$ while maintaining a differential gain of unity. This it does by using a pair of 200:1 voltage dividers at the input to bring the $\pm 200 \mathrm{~V}$ signal within the op-amp's common-mode range of $\pm 10 \mathrm{~V}$ (the circuit is shown in Figure 5.75C). The price it pays is degraded offset and noise: typical values of $120 \mu \mathrm{~V}$ and $550 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, compared with $25 \mu \mathrm{~V}$ and $20 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the conventional AMP03. ${ }^{67}$

An important point: when using difference amplifiers with large input voltage ranges, beware of the large equivalent input errors created by imperfect common-mode rejection. For example, the AD629B specifies a typical dc CMRR of 96 dB , but you've got to consider the worstcase (minimum) value of 86 dB . With that CMRR, a 200 V

[^265]common-mode input has an input-referred differential error of 10 mV , completely swamping the 0.5 mV specified maximum offset voltage. Put another way, the error that is due to finite CMRR is larger than the specified $V_{\mathrm{OS}}$ for input $\left|V_{\mathrm{CM}}\right|>10 \mathrm{~V}$. And the situation is worse still at signal frequencies: you might imagine using such a difference amplifier for powerline current monitoring. At 60 Hz the CMRR of the INA117 (similar to that of the AD629B at dc) degrades to $66 \mathrm{~dB}(\mathrm{~min})$. So the 160 V peak powerline signal produces a huge 80 mV input error. And ideally you'd want to monitor currents on powerlines at higher voltages still, perhaps to 400 V . There are better ways to do this; take a look at $\S 13.11 .1$ if you're curious.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0388.jpg?height=496&width=799&top_left_y=790&top_left_x=218)

Figure 5.73. Common-mode rejection ratio versus frequency for the difference amplifiers in Table 5.7 on page 353 (identified in the "Curve" column).

#### C. Bandwidth

Difference amplifiers are built with op-amps, frequency compensated for stability with the by-now familiar $1 / f$ open-loop gain rolloff. As with any op-amp circuit, loop gain is responsible for good behavior and the loss of loop gain at higher frequencies not only limits the bandwidth of a difference amplifier (and its linearity, constancy of gain, low output impedance, etc.), it also degrades the allimportant CMRR. Figure 5.73 shows this behavior, for the difference amplifiers listed in Table 5.7 (page 353). Not surprisingly, amplifiers with greater closed-loop bandwidth (therefore with op-amps of greater $f_{\mathrm{T}}$ ) maintain high CMRR to higher frequencies.

Note that some amplifiers perform well near dc but poorly at high frequencies, for example classic parts like the INA105, AD829 and LT1991, whereas others not so well rated at dc may look better at high frequencies, such as the AD8271 and the MAX4198. A few are outstanding performers from dc to high frequencies, according to the
plots, such as the AD8273 ${ }^{68}$ and our favorite AD8275. The transconductance-balancing AD8129 does very well, but is limited to small inputs and high gains. This information is not shown in the datasheet specifications; it's necessary to look for performance plots to make the comparisons.

Common-mode rejection at higher frequencies is degraded also by the effects of stray inductance and by asymmetrical capacitive loading. It is necessary to balance the circuit capacitances to achieve good CMRR at high frequencies. This may require careful mirror-image placement of components. Even when so symmetrized, the decreasing input capacitive shunt reactance at higher frequencies creates an increasing sensitivity to any unbalance in signal source impedance. ${ }^{69}$

### 5.14.4 Circuit variations

#### A. Filter node

The difference amplifiers in Table 5.7 (page 353) include one (the INA146) with a node brought out for noise (lowpass) filtering of the difference stage ( $G=0.1$ ) by a capacitor to ground (Figure 5.75B). It includes a second singleended stage, with gain set by a pair of external resistors; so you can have overall gains from 0.1 to 100 . The low firststage gain gives you a large $\pm 100 \mathrm{~V}$ common-mode range, though at the expense of noise and offset.

#### B. Offset trim

Integrated difference amplifiers are factory trimmed to pretty good precision, with typical values in the $25-100 \mu \mathrm{~V}$ range (but with worst-case offsets an order of magnitude larger). As with any op-amp circuit, you can rig up an external trim, as in Figure 5.74A. Here $R_{2} R_{3}$ divides the trimmer's $\pm 15 \mathrm{~V}$ range to $\pm 1 \mathrm{mV}$ at the REF pin; $R_{1}$ balances the $10 \Omega$ added resistance to ground, to preserve the CMRR. The amplifier's gain is slightly reduced by the ratio $R_{\mathrm{f}} /\left(R_{\mathrm{f}}+R_{2}\right)$; for a typical $R_{\mathrm{f}}$ of 25 k , that's $0.04 \%$, in the same range as the amplifier's specified gain accuracy. If this bothers you, use a smaller $R_{2}$.

68 Although the datasheet graphs for the AD8273 show a best-in-class CMRR of 100 dB below 40 kHz , the tabulated typical CMRR is shown as only 86 dB . We like the plot better, but the designer may be stuck with the worst-case spec of 77 dB . Some users may want to perform incoming inspections to settle the issue.
${ }^{69}$ The professional audio people are keenly aware of these effects, and they don't mince words. As stated pithily by Whitlock and Floru in an Audio Engineering Society paper, "Noise rejection in a balanced system has absolutely NOTHING to do with signal symmetry (equal and opposite signal voltage swings). It is the balance of common-mode impedances that defines a balanced system!" [emphasis in the original].
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0389.jpg?height=889&width=1381&top_left_y=198&top_left_x=256)

Figure 5.75. Circuit configurations for the difference amplifiers in Table 5.7 on page 353 (identified in the "Config" column). The "E" form is shown in Figure 5.89. The " $C$ " form is used for high voltages (e.g., $\pm 270 \mathrm{~V}$ for the AD629B).

#### C. CMRR trim

Likewise, you can trim out residual CMRR (caused by slight mismatch of resistor ratios $R_{\mathrm{f}} / R_{\mathrm{i}}$ in the two paths) with the circuit of Figure 5.74B. It's important to limit the trim range, to permit an accurate and stable trim to something considerably better than the off-the-shelf 80 dB (worst-case) CMRR specification. You can't get any old value of trimmer, and it's best not to use values less than $100 \Omega$ (even if you can find them) if you care about stability. Here we've chosen standard resistor values and a $100 \Omega$ trimmer to produce a resistance range of $20-30 \Omega$ from the REF terminal to ground, providing a $\pm 5 \Omega$ symmetrical variation around $R_{1}$. For the 25 k resistor values of this unity-gain difference amplifier (rather typical; see Table 5.7 on page 353 ), this corresponds to a trim range adequate to null an initial CMRR of 75 dB . You can, of course, add an offset null to this circuit, as indicated.

#### D. Single-supply offset

One of the difference amplifiers in Table 5.7 (page 353) helpfully splits the reference feedback resistor into a parallel pair (Figure 5.75D), so it's easy to offset the output voltage range. For example, you could run the amplifier on a single +5 V supply, with REF2 driven from a clean reference of that same voltage. With no difference signal the output will be +2.5 V . The amplifier can accommodate in-
put signals over a $\pm 10 \mathrm{~V}$ range, and its gain of 0.2 takes $\mathrm{a} \pm 10 \mathrm{~V}$ differential input to a $0-4 \mathrm{~V}$ output. You can, of course, use a lower reference voltage. It's often convenient to use $V_{\text {ref }}=4.096 \mathrm{~V}$ when driving an ADC; this makes the step size come out in round numbers, e.g., $1 \mathrm{mV} /$ step for a 12-bit conversion.

## 5.15 Instrumentation amplifier

The difference amplifiers of the previous section are inexpensive, and fine for many applications; and they have the nice feature of accepting inputs beyond the rails. But they have limited gain $(\leq 10)$ and CMRR ( $\lesssim 85 \mathrm{~dB}$ min), their resistors make them somewhat noisy $(20 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ to $50 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), and their relatively low input resistance ( $\sim 10 \mathrm{k}$ to $\sim 100 \mathrm{k}$ ) limits their utility to situations where the driving signals are of low impedance (op-amp outputs, low- $Z$ balanced lines, low- $R$ sense resistors).

If you need lots of gain, or a high input impedance, or superior CMRR, you need something different. It's called an instrumentation amplifier. These impressive devices have input impedances upward of $10^{9} \Omega$, gains from unity to 1000 or so, low voltage noise (down to $\sim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), and worst-case CMRRs of 100-120 dB (look ahead to Table 5.8 on page 363 ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0390.jpg?height=1069&width=690&top_left_y=216&top_left_x=275)

Figure 5.74. Trimming the offset and CMRR of a difference amplifier.

### 5.15.1 A first (but naive) guess

High input impedance - that's easy, just add op-amp followers to the difference amplifier (Figure 5.76); and then the resistors $R_{\mathrm{i}}$ and $R_{\mathrm{f}}$ can be smaller, reducing their Johnson noise contribution.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0390.jpg?height=363&width=678&top_left_y=1635&top_left_x=286)

Figure 5.76. A first stab at improving the difference amplifier.
Indeed, this circuit has the enormous input impedance we expect from an op-amp follower, so there is no longer a problem from any reasonable source impedance. ${ }^{70}$ But it

[^266]does not improve the CMRR, which is still limited by the resistor ratio matching of $R_{\mathrm{f}} / R_{\mathrm{i}}$ : it's really hard to do better than 100,000:1 with on-chip laser trimming (both initial trim and stability with time and temperature). In fact, this circuit degrades the CMRR somewhat, with two more amplifiers in the signal path.

### 5.15.2 Classic three-op-amp instrumentation amplifier

The circuit in Figure 5.77 is much better. It is the standard "three-op-amp instrumentation amplifier," one of several configurations that provide the desirable combination of high CMRR, high $R_{\mathrm{in}}$, low $e_{\mathrm{n}}$, and plenty of gain when you need it. The input stage is a clever configuration of two op-amps that provides high differential gain and unity common-mode gain without requiring close resistor matching. Its differential output represents a signal with substantial reduction in the comparative common-mode signal (when configured for $G_{\text {diff }} \gg 1$ ), and it is used to drive a conventional differential amplifier circuit. The latter is usually arranged for unity gain and is used to generate a single-ended output while removing the common-mode signal.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0390.jpg?height=595&width=705&top_left_y=1238&top_left_x=1109)

Figure 5.77. The classic three-op-amp instrumentation amplifier.
It's worth looking more closely at this circuit. We've hinted that it can deliver very high CMRR and very low $e_{\mathrm{n}}$. But that is true only when configured for large differential
have matched source impedances relative to the common-mode signal, because the input capacitance of the circuit forms a voltage divider in combination with the source resistance. "High frequencies" may even mean 60 Hz and its harmonics, because common-mode ac powerline pickup is a common nuisance.
gain. To see why, imagine we configure it for $G_{\text {diff }}=1$, by omitting the gain-setting resistor $R_{\mathrm{g}}$. Then we've just got the previous circuit (Figure 5.76), i.e., a buffered unity-gain difference amplifier. It has the same limitations of CMRR (set by resistor matching) and noise (from $U_{3}$ 's resistors).

Now imagine we set $G_{\text {diff }}=100$. We would do this by choosing $R_{\mathrm{g}}$ so that $1+2 R_{\mathrm{f}} / R_{\mathrm{g}}=100$, i.e., $R_{\mathrm{g}}=$ $2 R_{\mathrm{f}} /(G-1)$. For the INA103, for example, $R_{\mathrm{f}}=3 \mathrm{k} \Omega$, so we'd use $R_{\mathrm{g}}=60.6 \Omega$. The INA103 conveniently includes a resistor of that value, ${ }^{71}$ so for $G_{\text {diff }}=100$ you need only tie a pair of pins together. Let's look again at the CMRR and noise scene.

First, the CMRR: the front end has a differential gain of 100 and a common-mode gain of unity. In other words, it passes on to the difference amplifier stage a signal that has received 40 dB of CMRR blessings. Another 80 dB of CMRR in the output stage, and we've got the promised 120 dB CMRR. These numbers are typical of available instrumentation amplifiers, as listed in Table 5.8 (page 363) and graphed in Figure 5.82. For the INA103, for example, the datasheet lists CMRR $=86 \mathrm{~dB} / 72 \mathrm{~dB}$ (typ/min) for $G=1$, and $125 \mathrm{~dB} / 100 \mathrm{~dB}(\mathrm{typ} / \mathrm{min})$ for $G=100$.

Second, the noise voltage: the output stage still contributes Johnson noise from its resistor array, along with noise inherent in its amplifier. That cannot be helped. But that noise is combined with the already-amplified input signal, so the effect, relative to the input signal (RTI), is $100 \times$ less. For the INA103, for example, the datasheet lists the noise density (typical, at 1 kHz ) as $e_{\mathrm{n}}=65 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for $G=1$ and $1.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for $G=100 .{ }^{72}$

### 5.15.3 Input-stage considerations

Several preliminary comments here on the all-important input stage (about which a well-known circuit guru remarked "instrumentation amplifiers are all about their inputs"), with more to come later in $\S 5.16$.

#### A. Resistor matching

The circuit looks handsome with its symmetrical matched $R_{\mathrm{f}}$ 's, but that requirement did not intrude in the discussion above. What is the effect of mismatched feedback resistors

[^267]in the first stage? The common-mode gain remains unity (if you tie both inputs together, both outputs follow); and the differential gain expression is the same as before, but with $2 R_{\mathrm{f}}$ not surprisingly replaced with the sum $R_{\mathrm{f} 1}+R_{\mathrm{f} 2}$. What changes, though, is that a purely differential input causes a differential output (amplified by $G_{\text {diff }}$, as before) combined with some common-mode output.

You can see how this goes by imagining that $U_{2}$ 's feedback resistor is replaced with a short and $U_{1}$ 's resistor with $2 R_{\mathrm{f}}$, and a symmetrical dc input signal $\pm \Delta V$ is applied to the inputs: $U_{2}$ 's output goes down $\Delta V$, while $U_{1}$ 's goes up $\left(1+4 R_{\mathrm{f}} / R_{\mathrm{g}}\right) \Delta V$. That's the correct differential output, but with a common-mode offset of $\left(2 R_{\mathrm{f}} / R_{\mathrm{g}}\right) \Delta V$. This is not of great concern, providing that the $R_{\mathrm{f}}^{\mathrm{g}}$ 's are reasonably matched; they do not require the precise matching needed for the output stage.

#### B. The input amplifiers

It is essential that $U_{1}$ and $U_{2}$ have excellent CMRRs in order that a purely common-mode input signal is not converted to a differential signal (which would then be passed on to the output). Stated more precisely, they must have matched CMRRs, so that the voltage across $R_{\mathrm{g}}$ accurately tracks the differential input voltage. Viewing the circuit operation more generally in this light, the input amplifiers need not have extremely low individual offset voltages - what matters is that their offset voltages are accurately matched and remain so with changes in commonmode voltage. This gives rise to several circuit variants in which the "op-amps" $U_{1}$ and $U_{2}$ are configurations with well-matched base-emitter drops between each input and the corresponding $R_{\mathrm{g}}$ pin; see for example Figure 5.88C below.

#### C. Input-stage overload

The input stage amplifiers $U_{1}$ and $U_{2}$ will clip if their outputs are forced close to their supply rails, even though the output of the full circuit ( $U_{3}$ 's output) would be expected to stay within safe bounds. Put another way, $V_{\mathrm{CM}} \pm$ $0.5 V_{\text {diff }}\left(1+2 R_{\mathrm{f}} / R_{\mathrm{g}}\right)$ must not reach either supply rail.

#### D. Signal guards

Instrumentation amplifiers are used with low-level signals, often conveyed by shielded cables to minimize noise. This adds input capacitance, thereby limiting the bandwidth (particularly with signals of moderate to high source impedance). Of perhaps greater importance, it degrades the CMRR at signal frequencies: the cable's shunt capacitance forms a voltage divider with the signal's source impedance, separately for each input; so if you have a
signal pair with unbalanced source impedances (a common situation), common-mode signal variations will create some differential signal input. ${ }^{73}$ Finally, leakage currents become significant with signals of very high ( $\mathrm{M} \Omega$ to $\mathrm{G} \Omega$ ) source impedance. A nice technique for greatly reducing both the effective cable capacitance and any leakage current is to drive the shield actively with a "guard" voltage (Figure 5.78).

If there is a common shield surrounding the signal pair, the idea is to drive it with a buffered replica of the commonmode signal, as in circuit (A); a small series resistor is generally a good idea, for stability. A grounded outer shield can be used to eliminate any noise coupling to the guard, if that becomes necessary. This circuit requires access to the first-stage outputs, which you rarely get in an integrated instrumentation amplifier. Some amplifiers oblige by including this circuitry internally and providing a "data-guard" output pin, as in (B). If not, you can derive a commonmode signal yourself, as in (C).

Common-mode guarding reduces greatly the capacitive loading of the signal pair and therefore improves the CMRR (by minimizing the conversion of common-mode to normal-mode signals). But it does not reduce the effects of cable capacitance (and leakage) on normal-mode (differential) signals themselves. To accomplish that you need to shield the signals individually, driving each shield with a replica of the signal it shields, as in circuit (D). This is the familiar "bootstrap," acting here to reduce both the capacitance and leakage current seen by each signal. It thus minimizes high-frequency rolloff, and dc error in signals of high source impedance. ${ }^{74}$ And, as with common-mode guarding, it also minimizes the degradation of CMRR by effectively eliminating the cables' capacitances.

Some instrumentation amplifiers provide these individual guard outputs, for example the INA116 shown, which is evidently intended for very low current measurements (it boasts a 3 femtoamp typical input current). If not, you can roll your own, as in circuit (E), exploiting the fact that the $R_{\mathrm{g}}$ nodes follow the inputs. A caution, though: there is no guarantee that the signals at the $R_{\mathrm{g}}$ pins are not offset from the input signals, as for example in the configurations we'll see later in Figures 5.88C and 5.89F. With such an offset the bootstrap would be effective in minimizing capacitance, but much less so for leakage currents.

[^268]
#### E. Bootstrapped power supply

Figure 5.79 shows a trick that is analogous to signal guarding (you could call it "power-supply guarding"), occasionally helpful if you need to enhance further the CMRR of an instrumentation amplifier. $U_{3}$ buffers the common-mode signal level, driving the common terminal of a small floating split supply for $U_{1}$ and $U_{2}$. This bootstrapping scheme effectively eliminates the input common-mode signal from $U_{1}$ and $U_{2}$, because they see no swing (due to commonmode signals) at their inputs relative to their power supplies. $U_{3}$ and $U_{4}$ need not be bootstrapped if this is a discrete implementation. This scheme can do wonders for the CMRR, at least at dc. At increasing frequencies you have the usual problems of presenting matched impedances to the input capacitances.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0392.jpg?height=706&width=810&top_left_y=869&top_left_x=1064)

Figure 5.79. Instrumentation amplifier with bootstrapped input power supply for high CMRR.

### 5.15.4 A "roll-your-own" instrumentation amplifier

Integrated instrumentation amplifiers are excellent performers, and you usually can save a lot of work (and expense, and PCB real estate) by taking advantage of the broad selection of available parts, for which Table 5.8 (page 363) is a good starting point. But sometimes you need additional capability, for example a wider range of gains, or precise trimming of offsets and CMRR, or protection against outrageous abuse visited upon the input terminals.

Figure 5.80 is an example (another in the series of Designs by the Masters), based upon a commercialized
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0393.jpg?height=930&width=1679&top_left_y=211&top_left_x=112)

Figure 5.78. Signal guarding for greatly reduced cable capacitance. (A)-(C) are common-mode guards; (D) and (E) are individual signal guards.
design ${ }^{75}$ from the talented John Larkin, to which we've added a few decorations. He needed a flexible front end that combined (a) overvoltage protection to $\pm 250 \mathrm{~V}$, (b) logic-switchable gains from $1 / 16$ to 256 by factors of four, (c) precision low offsets, (d) common-mode input range to $\pm 10 \mathrm{~V}$ for $G \geq 1$ and $\pm 140 \mathrm{~V}$ for $G<1$, and (e) commonmode rejection of 120 dB at high gain.

The overall structure is the familiar three-op-amp configuration, with $U_{1}$ and its symmetrical twin (not shown) as the differential front end, which drives the unity-gain difference amplifier output stage $U_{3}$. The gain is set by analog switches $U_{2}$ and its twin, which select a tap on the resistor string $R_{6}-R_{10}$. For example, when the " $\times 64$ " position is selected, $R_{\mathrm{g}}=201.1 \Omega$ and $R_{\mathrm{f}}=6.411 \mathrm{k} \Omega$, thus a gain $G_{\text {diff }}=1+2 R_{\mathrm{f}} / R_{\mathrm{g}}=64.8{ }^{76}$

There's plenty more going on, here. Let's take it from

[^269]left to right. The lossy chip inductor $L_{1}$ (these are often rated by their impedance, mostly resistive, at 100 MHz ) combined with capacitor $C_{1}$ suppresses high-frequency interference that is outside the amplifier's bandwidth but able to cause nonlinear mischief in op-amp input stages. $C_{1}$ 's value is not critical, but its tight tolerance keeps the input impedance balanced in order not to compromise highfrequency CMRR. Relays $K_{1}$ and $K_{2}$ are used for frequent in-system offset and gain calibrations, essential for establishing and maintaining gain accuracies better than $0.1 \%$ (with a circuit using $1 \%$ resistor values) and zero offsets of $10 \mu \mathrm{~V}$ or better. ${ }^{77}$ Relay $K_{3}$ switches in a $\times 16$ gain attenuation for input signals beyond $\pm 10 \mathrm{~V}$. The input impedance is then set by $R_{1}+R_{2}$, with $R_{3}$ balance trim for good CMRR. $R_{1}$ 's value is a compromise between high $R_{\text {in }}$ and bandwidth: here the 33.2 k , loaded by a downstream capacitance of $\sim 10 \mathrm{pF}$, puts the 3 dB rolloff at 500 kHz , about right for the product's 200 kHz specified bandwidth. But a higher input impedance would be nice, perhaps a nice round-number $1 \mathrm{M} \Omega$ (preferably with $R_{1}$ as a series pair

[^270]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0394.jpg?height=860&width=1624&top_left_y=218&top_left_x=234)

Figure 5.80. A "discrete" instrumentation amplifier design that combines precision, high CMRR, large common-mode voltage range, digital gain selection, and protection against $\pm 250 \mathrm{~V}$ inputs. The symmetrical path to the noninverting input of $U_{3}$ is omitted to save paper.
of 464 k , to accommodate input overvoltages without damage).

The curious $Q_{1} Q_{2}$ twins are a nice touch: these are depletion-mode high-voltage MOSFETs (see Table 3.6) from Supertex or Infineon, ${ }^{78}$ used here as a $\sim 0.5 \mathrm{~mA}$ bidirectional current limiter to protect the op-amps (whose internal clamp diodes are unfazed by a few milliamps of input current; the AD8675, for example, specifies a maximum $I_{\text {in }}$ of $\left.\pm 5 \mathrm{~mA}\right) .{ }^{79}$ Here $R_{4}$ serves to reduce the saturation current from its maximum $I_{\mathrm{DSS}}$ of 3 mA (thus 750 mW dissipation at 250 V input, too much for a little SOT23 transistor), the tradeoff being an additional $1 \mathrm{k} \Omega$ of noise-adding input resistance in series with the unavoidable $\sim 1.7 \mathrm{k}$ on-resistance of the series pair of zero-biased MOSFETs. This circuit provides a reasonable level of overdrive protection; but an abrupt input step to +500 V , say, could well couple a large enough current transient (through the

[^271]capacitance of $Q_{1}$ and $Q_{2}$ ) to damage the amplifier, or produce gate breakdown in the MOSFETs themselves.

The op-amps are precision bipolar types with inputcurrent cancellation; note the tradeoff, for the two choices, of precision versus speed and bias current. These are laser trimmed for low offset voltage and are probably good enough without human intervention; but they include offset-trimming terminals to which you can attach a trimpot as shown. That sounds like a good idea - but be cautious, because the external trimming range you get when you do that is generally too much! For the AD8675, for example, the trimmer adjusts $\pm 3500 \mu \mathrm{~V}$ (nearly 50 times the maximum untrimmed offset). So it may be a touchy (and unstable) adjustment to improve upon the already-trimmed Vos.

The analog multiplexer selects a tap on the gainsetting string, which makes the gain insensitive to the onresistance of the switches (here $\sim 100 \Omega$ ). That's the right way to do it; the wrong way would be to use a separate feedback resistor to each switch position, with $R_{10}$ connected between the common terminals of the multiplexers. The small feedback capacitor $C_{2}$ ensures stability, given the lagging phase shift within the loop contributed by the $\sim 40 \mathrm{pF}$ of switch capacitance to ground.

Finally, we arrive at our destination via the difference
amplifier $U_{3}$, chosen for its combination of gain stability (an impressive $\pm 0.0008 \%$ over temperature, typ), fast settling time ( $1 \mu \mathrm{~s}$ to $0.01 \%$, typ), and low noise $(20 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, typ). It's easy to add CMRR and offset trim as shown (see earlier discussion in §5.14.4), which matters most at low gain settings.

### 5.15.5 A riff on robust input protection

As we remarked above, a really nasty transient can ruin your whole day. Consider, for example, an input voltage step of 1 ns rise time and 350 V amplitude (the input accidentally touches a 240 Vac powerline): the $350 \mathrm{GV} / \mathrm{s}$ slew rate would force 350 mA through 1 pF ! That's bad news for the op-amp $U_{1}$, as well as for the gate insulation of $Q_{1}$ and $Q_{2}$. How can the input protection in Figure 5.80 be improved to ensure robust protection against such egregious insults? The input choke $L_{1}$ helps, providing a series impedance that rises at high frequencies. But we can do better - see Figure 5.81.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0395.jpg?height=537&width=808&top_left_y=1071&top_left_x=119)

Figure 5.81. Bulletproofing the amplifier frontend with slew-rate control, diode clamping, and input-current limiting.

The first step is to limit the incoming slew rate, with $R_{1} C_{1}$ : a 500 V step causes a maximum $d V / d t=5 \mathrm{~V} / \mathrm{ns}$ slew rate across $C_{1},{ }^{80}$ with no significant degradation of bandwidth or noise. Looking at it most simply, that maximum slew rate can produce a transient current through the drainsource capacitance $\left(C_{\mathrm{OSS}}\right)$ of at most $I=C_{\mathrm{OSS}} d V / d t=$ 10 mA , thus a drop across $R_{2}$ of at most 10 V . That is well below the gate-source rating of $\pm 20 \mathrm{~V}$; and it's a conservative estimate, because the actual gate-source voltage is

[^272]reduced further by the relatively larger gate-source capacitance ( $C_{\mathrm{ISS}}$ ).

So $Q_{1}$ and $Q_{2}$ are safe. So is the amplifier, because the worst-case 10 mA transient current is clamped by diodes $D_{1}$ and $D_{2}$ to stay strictly within the amplifier's rails: those diodes clamp to bypassed voltages that are a diode drop inside the rails, set by diodes $D_{3}$ and $D_{4}$. Note the $\sim 1.5 \mathrm{~mA}$ dc forward bias of the latter (we're assuming $\pm 15 \mathrm{~V}$ rails), maintaining their diode drop even with a continuous dc input overdrive (with corresponding current limited to less than 1 mA , owing to $Q_{1} Q_{2}$ ).

Finally, the small input resistor $R_{5}$ is added for extra insurance, to limit any input current to the op-amp if the clamped voltage were to exceed the rails. This is more important with the usual arrangement of external clamp diodes (i.e., to the rails themselves), which allows the opamp inputs to go a diode drop beyond the rails. Without the added series resistor it's then a current-divider contest between the external and the internal diodes.

This circuit looks pretty good, to us. Before shipping these to customers, though, you would be well advised to put it on the bench and beat it up, brutally. Circuits can surprise you.

## 5.16 Instrumentation amplifier miscellany

There's much to love about these amplifiers, whose nice variety is evident in the collection of Table 5.8 (with additional "programmable gain" types in Table 5.9 on pages 370-371). When you need some real performance, those tables are worth serious study! Here we collect some important advice on their care and feeding; refer often to Table 5.8 for enrichment as you read the following sections. ${ }^{81}$

### 5.16.1 Input current and noise

Instrumentation amplifiers (INAs) must condition the input signal without disturbing it; thus high input impedance $Z_{\text {in }}$, low input current $I_{\text {in }}$, and a low level of current noise $i_{\mathrm{n}}$. There's the usual tradeoff - the lower voltage offset and voltage noise of BJTs versus the lower input current and current noise of FETs. Some bipolar-input INAs (for example the LT1167/8) use the trick of bias-current cancellation to achieve sub-nanoamp input currents. Conversely, the auto-zero INAs do best in terms of offset voltage, but they pay a price in current noise and chopping artifacts.

For some amplifiers the input current noise is close to

[^273]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0396.jpg?height=2123&width=1511&top_left_y=158&top_left_x=265)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0397.jpg?height=922&width=1353&top_left_y=218&top_left_x=270)

Figure 5.82. Common-mode rejection ratio versus frequency, for the instrumentation amplifiers listed in Tables 5.8 and 5.9. The "OP296 discrete" curve is measured data of a two-op-amp discrete implementation (Figure 5.88, circuit B) shown in the AD627 instrumentation amplifier (curve 16) datasheet as testimonial to the superiority of integrated amplifiers. Curves 23a and 23b show the effect of filter choices ( 1 kHz and 10 kHz , respectively) for the same amplifier (the AD8553). The dashed line extensions indicate a region well past the amplifier's cutoff frequency.
the shot-noise limit (as in §5.10.8), but this is greatly exceeded for auto-zero amplifiers, and BJT-input amplifiers that use bias-current cancellation.

### 5.16.2 Common-mode rejection

Instrumentation amplifiers must often deal with small difference signals riding on much larger common-mode voltages, requiring a high CMRR.

To get a sense of the problem, consider an INA used with a strain-gauge bridge powered from 5 V : the INA's common-mode signal input is 2.5 V , with a typical fullscale output of 10 mV (i.e., $2 \mathrm{mV} / \mathrm{V}$ ). So a signal that is $0.1 \%$ of full-scale is just $10 \mu \mathrm{~V}$. That's -108 dB with respect to the 2.5 V common-mode signal! Just seven of the INAs in Table 5.8 meet this spec for their minimum CMRR (though all but five meet it for their typical CMRR). An amplifier that fails to meet the CMRR spec will simply exhibit an output error larger than $0.1 \%$ of full scale, entirely down to insufficient CMRR. Keep this in perspective, though: most of the INAs in the table have more than
$10 \mu \mathrm{~V}$ of input offset voltage, anyway. So we can say for many applications the listed INAs do reasonably well (and some exceptionally well), at least at dc.

#### A. CMRR versus frequency

A much more severe test of an INA's CMRR is its ability to reject common-mode signals at high frequencies. The plots in Figure 5.82 show this degradation, beginning somewhere in the range of 100 Hz to 5 kHz . In contrast to the (dc) strain-gauge application, imagine measuring the voltage across low-value current-sense resistors monitoring the windings of a three-phase motor. If the ac drive frequency is low enough (say 50 to 60 Hz ), the INA may be up to the task. But if the motor windings are driven from a pulse-width-modulated (PWM) controller, with say 40 kHz pulses, high-frequency CMRR degradation may render an INA unusable for the task. So Figure 5.82's curves may be useful not only for choosing the best INA for the job, but in fact to determine whether an INA may be used at all.

Some of the curves of CMRR versus frequency level off after falling at the usual $6 \mathrm{~dB} /$ octave. This happens because
the INA includes provision for bandwidth filtering at an internal node (with an external capacitor) that attenuates the common-mode feedthrough by the same $6 \mathrm{~dB} /$ cactave, thus cancelling out the input-stage CMRR degradation. For example, we see this for the AD8293 and AD8553 (curves 24 and 23 a ) with 1 kHz filtering, and for the latter and the INA337 (curves 23b and 10) with 10 kHz filtering. This is seen also for some micropower parts, with their very limited bandwidth, for example the MAX4194 (curve 10a), which runs at $90 \mu \mathrm{~A}$ and has a 1.5 kHz bandwidth. That's where its response falls with $G=100$. You can use this principle to advantage by adding a post filter in applications where fast response isn't necessary, for example the three-phase motor current monitor.

#### B. Case study: increasing CMRR with upstream gain

Here's a nice example from our research lab, where we needed to control the current through a magnet coil with a high degree of stability, to bring about a "Bose-Einstein condensate" of cold atoms, and (in a first experiment of its kind) slow the speed of light to that of a bicycle. ${ }^{82}$ The currents ranged up to $875 \mathrm{~A}(!)$, and we wanted something close to $\sim 10 \mathrm{ppm}$ stability in the controlled current, which was sensed with a low-side 4 -wire current shunt of $100 \mu \Omega$ resistance (thus 87.5 mV full-scale signal ${ }^{83}$ ). With such high currents flowing, we had to deal with as much as a volt or so of common-mode signal, upon which the difference signal ( 87.5 mV maximum, but often much less) was riding. To control that current to 10 ppm thus required some 140 dB of CMRR, and of course very low input offset drift. It also required a low input noise voltage, ideally less than $0.1 \mu \mathrm{Vpp}$ integrated low-frequency noise in order to achieve 10 ppm .

The combination of very high CMRR and very low noise and offset is a tall order for any instrumentation amplifier. The solution here is to put some low-noise and lowdrift gain upstream of the INA, as shown in Figure 5.83. A precision low-noise op-amp like the LT1028A (typical drift and low-frequency noise of $0.1 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ and 35 nVpp ) is wired as a $G=+51$ composite amplifier ( $\S 4 x .5$ ), within which conventional op-amp $A_{2}$ is configured with $G=5$. The compensation capacitor $C_{\mathrm{C}}$ limits the bandwidth (and therefore the noise) to about 10 kHz . The precision op-amp

[^274]is run at lower voltage to reduce thermal effects (offsetvoltage drift, thermal-gradient errors), with its $\pm 8 \mathrm{~V}$ rails regulated down (with floating 3 -terminal linear regulators) from the ground-referenced $\pm 15 \mathrm{~V}$ that powers $A_{2}$ and $A_{3}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0398.jpg?height=568&width=799&top_left_y=410&top_left_x=1075)

Figure 5.83. Current sensing with low drift and low noise. Opamps $A_{1}$ and $A_{2}$ form a composite amplifier, with a precision lownoise first stage and a noncritical second stage. The output signal provides feedback to the high-current power supply.

### 5.16.3 Source impedance and CMRR

Instrumentation amplifiers excel in high input impedance, but that does not confer automatic immunity from the effects of mismatched signal source impedances (which so severely degrade CMRR in difference amplifiers, with their relatively low input impedance; see §5.14.3A). Most datasheets are bashful about displaying their dirty laundry in this regard, so we must applaud Analog Devices' candor, as shown in Figure 5.84. Note the greater effect at higher gain settings (where there's more to lose, because the CMRR is so good), and at higher frequencies (where the amplifier's input impedance is falling, owing to capacitance).

### 5.16.4 EMI and input protection

Whether you "roll your own" or use an integrated instrumentation amplifier, you've got to think about protection both from overloads and from electromagnetic interference (EMI). An example from real life: a colleague uses temperature-monitoring thermocouples in his lab, connected with the usual unshielded wire pairs to an INA front end running at high gain. All was well until a particular switching power supply was energized, at which point the thing went haywire.

The problem, of course, was common-mode EMI, coupled onto the long unshielded cable. And the solution, in
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0399.jpg?height=496&width=775&top_left_y=219&top_left_x=138)

Figure 5.84. Instrumentation amplifier CMRR, best at high gain settings, is degraded by source-impedance mismatch.
a situation like this where you don't need bandwidth, is to filter the input aggressively, as in Figure 5.85. The diode clamps are optional, but probably a good idea if you want the amplifier to survive an unusual input event. In situations where you do need bandwidths that include interfering signals, you're unlikely to get away with unshielded cable; use shielded wiring, and pay attention to grounding paths.

It is hard to overstate the seriousness of EMI/RFI: RF signals leaking into your inputs cause rectification inside BJT op-amps, and thus dc offsets. Cables or PCB traces can exhibit narrowband (high- $Q$ ) resonances, enhancing these effects. If you notice changes of offset voltage when you grip a cable, or touch a circuit node with a pencil, or just wave your hands around, you're probably seeing RF coupling (the other possibility is a circuit oscillation). Lossy ferrite beads are excellent for attenuating RF, as well as for reducing the $Q$ of unwanted wiring resonances; but they're not a panacea, and often you need to resort to additional filtering.

### 5.16.5 Offset and CMRR trimming

Instrumentation amplifiers that provide both SENSE and REF pins (e.g., the INA103) can be externally trimmed, if needed, for both offset voltage and CMRR, as shown previously for the difference amplifier (Figure 5.74). More often you're given only the REF pin, though. That's enough to trim the offset voltage, but note that any offset applied to the REF pin must have a source impedance of no more than $\sim 10^{-6} R_{\mathrm{f}}$ (i.e., a few milliohms) in order not to compromise the amplifier's $100 \mathrm{~dB}+$ CMRR. This is best done with a precision op-amp, as in Figure 5.86.

Some INAs helpfully include output-stage offset trim terminals, to be used with an external trimpot. A few of
these (e.g., the INA110 and others) even provide separate trim pairs for the front-end and output stages.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0399.jpg?height=430&width=499&top_left_y=341&top_left_x=1123)

Figure 5.86. Trimming the offset of an INA that doesn't provide a SENSE pin, offset pins, or a buffered REF pin.

### 5.16.6 Sensing at the load

As with the difference amplifier, the REF and SENSE pins can be connected directly at the load, as in Figure 5.78(a), to eliminate errors from wiring resistance and unrelated ground currents.

### 5.16.7 Input bias path

Instrumentation amplifiers earn honest bragging rights from their very high input impedance, but, just as with opamps, you've got to provide a dc return path. If you don't, the amplifier will saturate. This occurs naturally in circuits like the strain gauge of Figure 5.64A, but not in something like a thermocouple (Figure 5.85). For the latter you can use a resistor from one of the inputs to ground (or to midsupply, for a single-supply amplifier), or you can use a bias resistor from each input to ground to preserve symmetry.

### 5.16.8 Output voltage range

If an INA is operated at low gain and with its commonmode input near the rails (but legally within the specified operating range), the internal amplifier may saturate, causing the INA's output to go to an incorrect voltage. For example, look at the "Maximum Output Voltage vs. Common-Mode Input" graph in the datasheet for the AD623 (this amplifier is like type A in Figure 5.88, except with pnp-input emitter followers). If the commonmode input is at 0 V with $G=10$ (which is legitimate), the maximum output capability is only 1.0 V ! You have been warned!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0400.jpg?height=434&width=1119&top_left_y=214&top_left_x=484)

Figure 5.85. Electromagnetic interference couples nicely into long unshielded cables, which you can think of as antennas. Use lowpass filtering at high-gain inputs, with optional diode clamping to the rails. Note the $10 \mathrm{k} \Omega$ resistor pair, to set the dc level of the floating differential input.

### 5.16.9 Application example: current source

The excellent CMRR of instrumentation amplifiers, combined with very low input capacitance (typically $\sim 2 \mathrm{pF}$ ), lets you design an active current source in which the current sense resistor rides on the high side of the output, with a "flying" INA converting its voltage drop to a ground-referenced output. Such a circuit is shown in Figure 5.87A, exploiting the $>80 \mathrm{~dB}$ CMRR of the AD8221B out to 50 kHz , where the stabilizing compensation network $R_{1} C_{\mathrm{C}}$ rolls off. The MOSFET, configured as a commonsource transconductance stage, has inherently high output impedance, which makes it possible to maintain good current-source behavior at higher frequencies. This improves upon a current-source circuit like that in Figure 5.69 (§5.14.2D), in which the performance degrades with frequency owing to the op-amp's compensation and limited slew rate. In this circuit the source-degeneration resistor $R_{3}$ acts to reduce the MOSFET transconductance, to enhance stability (some breadboard testing, with anticipated load impedances, would not be inadvisable). See Table 3.4 for selected $p$-channel MOSFETs.

For this circuit the op-amp output must be able to swing to the positive rail (the LT1490 is RRIO), and the AD8221B needs a few volts of negative supply voltage ( -3 V is adequate) because its common-mode input voltage does not extend to the negative rail. ${ }^{84}$

The AD8221B's low offset voltage ( $25 \mu \mathrm{~V}$ max) provides a large dynamic range, corresponding to an output error of just 0.25 mA out of the full-scale range of 5 A (20,000:1).

[^275]For lower output currents you can substitute a smaller bipolar transistor, as in Figure 5.87B; its lower capacitance permits greater loop bandwidth (we've configured it here as a follower). The AD8221B's low input
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0400.jpg?height=1016&width=672&top_left_y=1099&top_left_x=1133)

Figure 5.87. Precision current source with flying instrumentation amplifier. A. Power MOSFET for 5 A full-scale current, B. a small high-gain ( $\beta \sim 500$ over $0.1-50 \mathrm{~mA}$ ) BJT provides greater bandwidth.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0401.jpg?height=1083&width=1485&top_left_y=206&top_left_x=214)

Figure 5.88. Instrumentation amplifier configurations A-C, as listed in Table 5.8 (page 363). For these and other differencing circuits the "ref" pin need not be grounded.
current ( 0.4 nA max) means that you can scale down the full-scale output current range, say to $100 \mu \mathrm{~A}$ full scale.

### 5.16.10 Other configurations

The classic 3-op-amp circuit of Figure 5.77 is widely used, notably in the INAs offered by Burr-Brown/TI (recognizable by their part numbering "INAnnn"); but you'll see other circuit configurations (if you get far enough into the datasheets) representing different tradeoffs among the various performance parameters and cost. Although you can get along fine without "looking under the hood" ( most of what you need to know comes from the tabulated data), some of these configurations have unusual quirks that can catch you off-guard. For example, amplifiers with configuration E (Table 5.8 on page 363, and Figures 5.88 and 5.89) can be damaged by input voltage differentials greater than $\pm 0.5 \mathrm{~V}(!),{ }^{85}$ and the amplifiers with configuration F do not

[^276]operate with the REF tied to ground (even though intended for low-voltage single-supply operation). Quite apart from these kinds of worries, curiosity impels a brief look at these circuits.

There's a general principle in play in nearly all of these circuits ( D and E excepted): (a) the voltage across a gainsetting resistor $R_{\mathrm{g}}$ is precisely the same as the input difference voltage, creating a current $I_{\mathrm{g}}=\Delta V_{\mathrm{in}} / R_{\mathrm{g}}$; and (b) that current is used to generate an accurately proportional output voltage $V_{\text {out }} \propto I_{\mathrm{g}}$. Classic configuration A puts this in clear view: the input op-amps (or equivalent - they need not be fully featured op-amps) enforce a matched $\Delta V_{\text {in }}$ across $R_{\mathrm{g}}$, with the resultant current flowing through the two $R_{\mathrm{f}}$ 's; thus a differential output $\Delta V_{\text {out }}=\left(\Delta V_{\text {in }} / R_{\mathrm{g}}\right)\left(R_{\mathrm{g}}+2 R_{\mathrm{f}}\right)$. The
caused by excessive input current; others tolerate greater differential inputs (as much as a few volts), though most of the E-configuration parts are considerably more restrictive than those with the other circuit topologies. What matters more, from the user's point of view, is the maximum differential input without performance degradation.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0402.jpg?height=972&width=1302&top_left_y=213&top_left_x=438)

Figure 5.89. Instrumentation amplifier configurations D-F, as listed in Table 5.8 on page 363.
unity-gain difference amplifier converts this to a singleended output, with gain $G=1+2 R_{\mathrm{f}} / R_{\mathrm{g}}$.

Configuration C works similarly, but here the matched emitter followers $Q_{1} Q_{2}$ create the $\Delta V_{\text {in }}$ replica across $R_{\mathrm{g}}$, with the op-amps serving to ensure equal emitter currents (and thus no contribution to the differential output). ${ }^{86}$ In this circuit and following, $V_{\mathrm{B}}$ is a reference "bias" voltage.

One nice thing about the C and C 2 configurations is that a small RFI-defeating capacitor can be placed across base-to-emitter of the input transistors, because they're exposed pins. Keep those capacitors small -100 pF or less - so the amplifier's bandwidth and stability are not degraded. ${ }^{87}$

The clever configuration B is different: it is more economical, requiring only two op-amps and fewer trimmed

[^277]resistors, but its performance suffers, with poorer CMRR (particularly at higher frequencies). (The reader also suffers, trying to figure out how this tangle of a circuit works.) Configuration C 2 is the discrete differential-pair analog of B (just as C was for A ), with similarly underwhelming specifications.

Configuration F continues the theme of replicating $\Delta V_{\text {in }}$ across $R_{\mathrm{g}}$, with the resultant unbalanced current at $U_{1}$ 's summing junction being converted to a single-ended output. In this circuit $Q_{3}$ and $Q_{4}$ form a "folded cascode," pinning the drains of $Q_{1}$ and $Q_{2}$ while passing their currents through (offset by twice the quiescent current, thus sinking). This circuit requires accurate matching of the current sources and of the current mirror (stated more precisely, it requires constancy of the current sources and mirror over common-mode variations). Evidently that can be accomplished with good design (and the assistance of circuit tricks like the cascode), given the impressive 140 dB (typ) CMRR specification. ${ }^{88}$

[^278]Table 5.9 Selected Programmable-gain Instrumentation Amplifiers
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0403.jpg?height=539&width=1284&top_left_y=261&top_left_x=302)

Notes: (a) at $25^{\circ} \mathrm{C}$. (b) at 100 Hz . (c) $0.01-10 \mathrm{~Hz}$ or $0.1-10 \mathrm{~Hz}$, at $\mathrm{G}=100$ if available. (d) at $\mathrm{G}=100$ or max, not 1000 ; no source imbalance. (e) abs max. (f) separate LV output rails. (g) at $G=$ max. (h) plus HF auto-zero noise. (k) caution: high bias currents. ( m ) plus filter stage and output clamp. ( n ) to within $50 \mathrm{mV}-200 \mathrm{mV}$ of rail. (o) see Fig. 5.82 . (p) rail-to-rail input, provided AGND away from rails. (q) 250 kHz chopper. (r) $V_{\text {out }}$ to $V_{\mathrm{EE}}$, but $V_{\mathrm{ref}}=0.8 \mathrm{~V}$ min. (s) $2 \mathrm{~V} / \mu \mathrm{s}$ at $\mathrm{G}=1000$.

Parts using configurations D and E are unlike the others. In D a flying capacitor $C_{\mathrm{S}}$ periodically samples and conveys to the "hold" capacitor $C_{\mathrm{H}}$ the differential input voltage, thus creating a single-ended (ground-referenced) replica. This sounds good in principle; but the resulting noise is high, and the slow commutating rate $(3-6 \mathrm{kHz}$, for the two exemplars in Table 5.8 on page 363) limits the bandwidth and extends the settling time. This technique is also vulnerable to aliasing at half the chopping frequency. However, these parts are inexpensive, and they may be well suited for some dc applications.

Finally, in E the output currents from a pair of differential-input transconductance amplifiers are combined and forced to equality: one amplifier sees the input signal pair, and the other sees a divided fraction of the output, producing a single-ended output voltage, as shown. This low-cost configuration (no laser-trimmed resistor pairs, etc.) is limited to small differential input signals (thus high gain), and generally exhibits relatively poor gain accuracy. ${ }^{89}$ Interestingly, the fastest amplifier in Table 5.8, by far, uses this configuration.

[^279]
### 5.16.11 Chopper and auto-zero instrumentation amplifiers

The same auto-zero techniques that are used in "zerooffset" CMOS op-amps (§5.11) are used in some CMOS low-voltage instrumentation amplifiers. These are recognizable by their very low offset-voltage specifications, down in the tens of microvolts, where non-AZ CMOSs do not venture (see Table 5.8 on page 363). These amplifiers attain excellent CMRR also, but they pay the price in broadband noise, switching-frequency noise, ${ }^{90}$ and (sometimes) input bias and noise currents. The amplifiers are useful particularly in low-frequency applications, for example as input stages for integrating ADCs (see Figures 13.67), or combined with lowpass filtering.

### 5.16.12 Programmable gain instrumentation amplifiers

You set the voltage gain of a simple op-amp circuit with external resistors. In contrast, difference amplifiers (Table 5.7 on page 353) ordinarily are configured with fixed gain, set by a precision internal matched resistor network. And the gain of instrumentation amplifiers (Table 5.8 on page 363) is ordinarily set by a single gain-setting resistor $R_{\mathrm{g}}$. Note, though, that some of the amplifiers in Table 5.8 include several internal $R_{\mathrm{g}}$ gain-setting resistors, allowing accurate gain selection with only an external jumper wire. Taking this one step further, you can get programmable-

[^280]Table 5.9 Selected Programmable-gain Instrumentation Amplifiers (cont'd)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0404.jpg?height=601&width=1450&top_left_y=276&top_left_x=321)
(t) typical. (u) 148-page user manual; includes ADC for sensor span, offset tempco cal, etc.; parameters stored in external SOT23 EEPROM. (v) caution: the RR output parts often don't allow the REF pin to be close to $V_{\mathrm{EE}}$; be sure to check the datasheet! (w) part with large gain error assume you'll perform gain calibration. $(x)$ the CMRR spec is typically at 60 Hz ; check the plots if you care about performance at higher frequencies.
gain amplifiers (PGAs) in which that selection is made by a digital input code (either applied as a parallel logic-level code to a set of pins, or as a multibit serial code through a serial port like SPI or $\mathrm{I}^{2} \mathrm{C}$; see Chapters 14 and 15 ). These are, in essence, integrated versions of the discrete digitally programmable instrumentation amplifier of Figure 5.80 .

Some examples of stand-alone instrumentation PGAs are the PGA204/5, LMP8358, and PGA280, with more listed in Table 5.9. The PGA202/3 (JFET) and PGA204/5 (BJT) are traditional "high-voltage" (to $\pm 18 \mathrm{~V}$ ) parts that accept a 2 -bit parallel code (on two pins) to select gains of $1,10,100$, or 1000 (PGA202/4) or 1, 2, 4, or 8 (PGA203/5). The more recent LMP8358 is a low-voltage single-supply part ( $2.7-5.5 \mathrm{~V}$ ) with auto-zero and gains from 10 to 1000 in a $1-2-5$ sequence (i.e., $10,20,50,100$, $200,500,1000$ ), and with ambidextrous programming the three pins can be used either as a 3-bit gain-setting parallel port or a 3-wire SPI serial port that programs both the gain and some additional parameters such as input polarity reversal, fault detection, and bandwidth. It is fast ( 8 MHz ) and accurate ( $V_{\mathrm{OS}}=10 \mu \mathrm{~V}$, max).

Finally, the very elegant PGA280 addresses the need for a PGA whose input signals can range over $\pm 10 \mathrm{~V}$ or more, but with a separately powered output stage matched to contemporary low-voltage single-supply ADCs and microcontrollers. The inputs can range over $\pm 15.5 \mathrm{~V}$ (with $\pm 18 \mathrm{~V}$ supplies), with the output supplied from the same +2.7 V
to +5 V supply that powers the ADC or $\mu \mathrm{C} .{ }^{91}$ This solves the messy problem of protecting the inputs of a low-voltage part when it is driven from an IC running from higher voltages. There's a REF-like pin that sets the output mid-span voltage; the output is actually differential, with a pair of complementary outputs, but you can ignore one and treat it as single-ended (with a slight loss of accuracy).

This amplifier has excellent performance: it programs through a digital serial port, with selectable gains from $1 / 8$ to 128 by factors of two. It combines low offset voltage (auto-zeroing: $\pm 15 \mu \mathrm{~V}$ max, at $G=128$ ), high input impedance ( $>1 \mathrm{G} \Omega$ typ), low gain drift ( $\pm 3 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ max), and excellent CMRR (gain-dependent: 130-140 dB typ). Among its other tricks are an on-chip 2-input multiplexer (two differential-input pairs), an uncommitted byte-wide bidirectional digital port, and various signal conditioning and fault-detection options.

Figure 5.90 shows the sort of application for which this part would be ideal: our colleagues have developed an experimental robotic grasping hand ${ }^{92}$ that is driven by a single torque motor through a set of passive linkages and couplings. For control you'd like to know the applied

[^281]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0405.jpg?height=922&width=1626&top_left_y=218&top_left_x=131)

Figure 5.90. Two-channel level-shifting PGA application: reading out the applied torque and thermal response of a grasping robotic hand. This chopper-stabilized ( 250 kHz ) instrumentation PGA works from $\pm 15 \mathrm{~V}$ rails, but delivers its output to a 3.3 VADC - that's being helpful! Recommended.
torque (from the motor current), and something about the contact pressure (if any) with the object being grasped. The PGA280's wide input compliance and range of gains, combined with 2-channel differential inputs, make this an easy task: we imagine a pair of thermistors, self-heated a few degrees above ambient, that sense the temperature at the grasping points, and a low-side sense resistor in the motor return line. The low-voltage output stage connects to the on-chip ADC of a microcontroller, which controls the channel switching and gain of the PGA. We've rigged the thermistors so that first contact makes an upward step in differential voltage, followed by a second step in the same direction when the other "finger" makes contact. (The step size provides further information about the object's material.) Note the differential " 4 -wire" connection at the motor-current-sense resistor, to eliminate errors from ground connection resistance; we've filtered that signal, because the use of pulse-width modulation tends to create high-frequency noise.

When looking around for a good instrumentation amplifier, be sure to consider specialized PGA variants that are intended to serve as front ends for low-level sensors and the like, for example the PGA309 ${ }^{93}$ or PGA2310. ${ }^{94}$

PGAs are quite popular as portions of more complex ICs, for example within ADCs (Figure 13.67 again, and Figures 13.70 and 13.71) and microcontrollers (Figure 15.10).

### 5.16.13 Generating a differential output

Both instrumentation amplifiers and difference amplifiers are used to convert a differential input signal to a singleended output. That's fine, if that's what you want (and it usually is). There are some situations, though, in which you need a differential output signal, for example when
${ }^{93}$ Whose 148-page User's Guide describes it thus: "The PGA309 is a smart programmable analog signal conditioner designed for resistive bridge sensor applications. It is a complete signal conditioner with bridge excitation, initial span and offset adjustment, temperature adjustment of span and offset, internal/external temperature measurement capability, output over-scale and under-scale limiting, fault detection, and digital calibration."
94 "The PGA2310 is a high-performance, stereo audio volume control designed for professional and high-end consumer audio systems."
driving several varieties of analog-to-digital converter (ADC, a major subject of Chapter 13). Most simply, this can be done by adding a unity-gain inverter to the singleended output, as in Figure 5.91A. ${ }^{95}$ This works, for sure, but the gain accuracy will be degraded unless the resistor pair is matched to at least the precision and stability of the driving amplifier. This pitfall is circumvented in circuit B, where the unity-gain inverter forces the SENSE output pin to a symmetrical voltage relative to ground (or some other reference voltage). With this circuit the gain accuracy is retained; the effect of any resistor mismatch is simply to offset the symmetry of the outputs about ground (or reference voltage), which is generally of less importance because of the differential-input nature of the device being driven.

Both circuits, however, share the drawback of introducing a time delay (or phase shift), owing to the finite bandwidth of the inverting stage. One solution is to use a pair of matched amplifiers, as in Figure 5.66F. But a better way, particularly when plenty of bandwidth and rapid settling is needed (as with fast ADCs), is to use a differential amplifier (or fully differential amplifier, to emphasize the distinction), a term that has come to mean an amplifier with differential inputs and outputs; see $\S 5.17$. The PGA280 of the previous section is such an amplifier (though its designers officially call it an instrumentation amplifier).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0406.jpg?height=723&width=718&top_left_y=1271&top_left_x=248)

Figure 5.91. Generating a differential output from an instrumentation amplifier or difference amplifier. Method $B$ maintains gain accuracy.

[^282]
## 5.17 Fully differential amplifiers

The term "fully differential amplifier" (or sometimes "differential in/out amplifier," or just "differential amplifier") is used to describe an amplifier with differential input and differential output, along with an additional input pin (" $V_{\mathrm{OCM}}$ ") that sets the common-mode voltage of the output pair. We favor the "fully" term, to distinguish clearly from difference amplifiers and instrumentation amplifiers, both of which have single-ended outputs.

For some important applications you need to create a balanced differential output, from either a differential or a single-ended input signal. This is often the case with ADCs that have complementary inputs; see Figure 13.65 (a "charge-redistribution" ADC), Figure 5.102 (pipeline flash), Figure 13.28 (flash), Figure 13.37 (SAR), and Figure 13.68 (delta-sigma). For that application the important performance parameters are likely to be settling time, gain accuracy and stability, the ability to set the common-mode output voltage, and the ability to drive a rail-to-rail swing into a low-voltage ADC.

Other applications where differential signals are widely used include analog signaling over twisted pairs (e.g., through existing Cat-5-style network cable); telecom applications such as ADSL and HDSL links; oscilloscope input stages; and RF communications subcircuits such as IF and baseband blocks.

You can, of course, create a differential-output signal pair by using single-ended amplifiers (op-amps, difference amplifiers, and instrumentation amplifiers), as illustrated in Figures 5.66F, 5.70, 5.91, and 13.37. But you do better, particularly in terms of speed and noise, with an integrated differential amplifier, which also lets you set the common-mode output voltage (i.e., the midpoint of the output swing); this capability is particularly useful when driving differential-input ADCs powered from a single supply, because of their fussy insistence on common-mode input voltages.

Table 5.10 on page 375 includes a good selection of currently available differential amplifiers, keyed to the circuit diagrams in Figures 5.94-5.98. These illustrate the unflagging creativity of the human species, and some nice circuit tricks as well.

Let's take a quick tour. Circuit A, intended for singleended inputs, is simply a differential amplifier "kit," with an input op-amp whose gain you set with external resistors. You can wire it as a noninverting amplifier (therefore high input impedance), or you can configure it as an inverting amplifier (for example, to handle a large input swing by setting the gain to less than unity). The noninverting
input of $A_{2}$, conveniently of high impedance, lets you set the output common-mode output voltage. The LT6350 is a low-noise, low-distortion amplifier of this configuration, with the added feature of rail-to-rail outputs. ${ }^{96}$ Figure 5.92 shows how you would use it to drive an ADC, in this case the LTC2393 that cooperates by providing a mid-scale dc reference output $\left(V_{\mathrm{CM}}\right){ }^{97}$ The amplifier runs from the same +5 V and ground supply voltages, which eliminates the frequent worry about driving the ADC's input clamp diodes into conduction. The input lowpass filter to the ADC $\left(R_{1} R_{2} C_{1}\right)$ serves two functions: (a) it is an anti-alias filter, limiting the input bandwidth to $\sim 150 \mathrm{kHz}$; and (b) it provides the recommended shunt input capacitance to suppress the effects of the ADC's internal switching transients (which afflict many ADCs, including "charge redistribution SAR" converters, and delta-sigma converters - see Chapter 13).

Circuit B is a symmetrical balanced configuration optimized for pro-audio: well-balanced high-level drive ( $>15$ Vrms) with low distortion into balanced pairs, and stability into the load capacitances you get with long cables (to $10,000 \mathrm{pF}$ or more). Figure 5.93 shows a typical application, in this case generating the high-level lowdistortion balanced output needed for pro-audio cable driving, first discussed in $\S 5.14 .2 \mathrm{E}$. Of note here is the very high common-mode output impedance, which preserves signal balance by allowing the receive end to override the driver's default (symmetrical about ground at the driver end, set weakly by the 10k resistors). In fact, it's even OK to ground one side at the receive end, in order to generate a single-ended signal there. We'll have more to say about this in §5.17.1.

Circuit C is the configuration of Figure 5.66F, with high-impedance (buffered) common-mode voltage-setting inputs $\left(V_{\mathrm{OCM}}\right)$. The table entries with this configuration are low-noise wideband amplifiers, good for video and communications applications.

Circuit D is a popular configuration, sometimes with internal gain-setting resistors, sometimes external. The dif-
${ }^{96}$ The ADA4922-1 is a faster, $0.05 \%$ version, with a fixed unity-gain input stage.
${ }^{97}$ The ADC has an internal reference of reasonable accuracy ( $0.5 \%$ ), but it lets you attach an external reference of better performance (e.g., the LT1790-4.096, with accuracy and drift of $\pm 0.05 \%$ and $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, max). Sounds good - but it would not accomplish much here, because the gain accuracy of the system is limited by that of the LT6350 amplifier $( \pm 0.6 \%$, max $)$. You could use the ADA4922-1 instead.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0407.jpg?height=415&width=801&top_left_y=216&top_left_x=972)

Figure 5.92. ADC driver circuit using a configuration $A$ differential amplifier. The ADC provides a mid-span $V_{\mathrm{CM}}$ output reference, here used to set the amplifier's common-mode level. See also the betterperforming AD4922.
ferential amplifier within the feedback loop consists of a symmetrical pair of transconductance amplifiers (voltage-to-current) generating a voltage across a resistive load, with voltage followers to generate the low-impedance output pair. The $V_{\mathrm{OCM}}$ input lets you assert the common-mode output voltage, which otherwise defaults to mid-supply (in which case it's good to attach a bypass capacitor). The $V_{\mathrm{OCM}}$ input bandwidth typically is comparable to that of the amplifier.

Circuit E continues the theme of differential transconductance amplifiers, but here they are configured in a feedback arrangement, the differential-output version of the analogous circuit E in Figure 5.89. Circuit F, used in the fastest amplifiers in the table, blends the output configuration of D with an input configuration like that of the classic instrumentation amplifier (Figure 5.65), again with differential transconductance amplifiers as the gain element.

Finally, circuit G is a completely different animal, a pair of offset-cancelled followers biased from the $V_{\mathrm{OCM}}$ input pin. This configuration, used in the table's 2 GHz entry, is intended for ac-coupled (or transformer-coupled) inputs.

### 5.17.1 Differential amplifiers: basic concepts

A. Gain The differential voltage gain is unity for most configurations in which the gain is set by matched pairs of feedback resistors $R_{\mathrm{f}}=R_{\mathrm{g}}$. The gain range column in Table 5.10 (page 375) identifies parts with fixed gains, minimum gains, or a set of gain selections. In some cases the exact gain is affected by source-impedance and termination-matching issues; see $\S 5.17 .4$ and the formulas in Figure 5.104.

Table 5.10 Selected Differential Amplifiers

|  | 気 |  | Bandwidth |  | Speed |  | $V_{\text {out }}$ diff'\| | Offset |  |  |  | Noise |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  |  | Slew | Settle |  |  |  | Input | $z_{\text {in }}^{\mathrm{h}}$ | $e_{\mathrm{n}}$, typ | Supply | Is | 枵 |  |
|  |  | Gain ${ }^{2}$ | $\Delta$ G | -3dB 0.1dB | Rate | 0.05\% | max | typ | max | bias | diff | @1MHz | Range |  | O) qty 25 |  |
| Part \# |  | Range Set by | (\%) | (MHz) (MHz) | ( $\mathrm{V} / \mathrm{Hs}$ ) | (ns) | $\left(V p^{\text {b }}\right.$ ) | (mV) | (mV) | ( $\mu \mathrm{A}$ ) | ( $\Omega$ ) | ( $\mathrm{nV} / \mathrm{VHz}$ ) | (V) | (mA) | ( | Comments |

high voltage
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=49&width=1603&top_left_y=441&top_left_x=252)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=42&width=1609&top_left_y=484&top_left_x=244)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=34&width=1595&top_left_y=519&top_left_x=269)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=45&width=1629&top_left_y=549&top_left_x=239)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=29&width=1511&top_left_y=588&top_left_x=255) low voltage
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=58&width=468&top_left_y=647&top_left_x=251)

| 1.4 |  | RR |  | 0.1 | c | 160k | 7.5 | $\pm 5$ | y 6.43 | 2-ch-input, SPI |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1.5 |  | RR | 0.25 | 2.5 | 2pA | 30k | 45 | 2.7-12 | 0.7 w 2.80 | $R_{\mathrm{f}}=30 \mathrm{k}$ to 50 k |
| 1.5 |  | RR | 0.25 | 2.5 | 2pA | 30k | $45^{\text {d }}$ | 2.7-12 | 0.7 w 5.23 | -x for $G=1,2,5,10$ |
| 450 | 100 | RR | 0.7 | 2.6 | 0.5 | $\mathrm{Rg}^{\mathrm{h}}$ | $8^{\text {d }}$ | 2.7-12 | 2.6 $\cdot$ 1.98 | $\mathrm{R}_{\mathrm{f}}=1 \mathrm{k}-10 \mathrm{k}$, cheap |
| 490 | 13 k | RR | 0.2 | 2 | 0.65 | $\mathrm{Rg}^{\mathrm{h}}$ | $4.6^{\text {d }}$ | 2.5-5.5 | 1.1 w 2.81 | $R_{f}=1 \mathrm{k}$; 4522 dual |
| 1100 | 20 | 6.0 | 6 | 25 | 6 | 300k | $28^{\text {d }}$ | 5-12 | 7.4 - 1.44 | cheap, ‘5370 triple |
| f | f | RR | 0.25 | 1 | 12 | 400/G | 2.6 | 2.7-5.5 | 16 w 9.81 | dual, 16 bit ready |
| f | f | 4.8 | 5 | 25 | 30 | $\mathrm{Rg}^{\mathrm{h}}$ | $10^{\text {d }}$ | 2.7-11 | 36 - 3.90 | 4th-order filters |
| f | f | RR | 0.25 | 1.5 | 12 | 400/G | 2.2 | 2.7-5.5 | 16 w 5.58 | pin-select filter |
| 1150 | 16 | 15.6 | 1 | 2.5 | 3.5 | $\mathrm{Rg}^{\mathrm{h}}$ | 5 | 3-10 | 20 - 4.12 | $R_{f}=500 \Omega$ |
| 2400 | 18 | 15.6 | 0.5 | 4 | 4 | $\mathrm{Rg}^{\mathrm{h}}$ | $6^{\text {d }}$ | 3.3-10 | 13 - 3.50 | $R_{\mathrm{f}}=365 \Omega$ |
| 900 | 10 | 6.0 | 3 | 30 | 11 | 150k | $25^{\text {d }}$ | 4.8-12 | 12 - 2.80 | EL5373 triple |
| 1100 | 10 | 6.0 | 1.4 | 25 | 14 | 150k | 21 | 4.8-12 | 12 - 1.85 | $G=1+R f / R g$, cheap |
| 800 | 45 | RR | 0.15 | 0.5 | 2.3 | $\mathrm{Rg}^{\mathrm{h}}$ | 2.2 | 4.5-12 | 25 - 6.00 | $R_{\mathrm{f}}=200 \Omega$ |
| 1200 | 15 | 14.4 | 1 | 3.5 | 3 | $\mathrm{Rg}^{\mathrm{h}}$ | $8^{\text {d }}$ | 2.7-11 | 12 - 3.07 | $R_{\mathrm{f}}=348 \Omega$ |
| 400 | $8^{\text {k }}$ | 7.0 | 1 | 6.5 | c | 100 | 1.9 | 4.0-5.5 | 30 - 3.90 | opt 75MHz filter |
| 1200 | 13 | RR | 0.5 | 2 | 23 | $\mathrm{Rg}^{\mathrm{h}}$ | 1.5 | 2.7-5.5 | 30 w 4.91 | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0408.jpg?height=40&width=217&top_left_y=1178&top_left_x=1645) |
| 570 | 7 | RR | 0.25 | 2.5 | 6.5 | $\mathrm{Rg}^{\mathrm{h}}$ | 2 | 3-6 | 14 $\cdot$ 4.07 | $R_{\mathrm{f}}=499 \Omega$ |
| 2900 | 5 | 4.8 | $5^{2}$ | $30^{\text {Z }}$ | c | 150 | 6 | 4.8-6 | 143 - 9.70 | 0.5 dB atten, pins |
| 2800 | 9 | 15.0 | 0.5 | 2.2 | 2.5 | $\mathrm{Rg}^{\mathrm{h}}$ | $3.6^{\text {d }}$ | 3-10 | 10 - 4.72 | $R_{\mathrm{f}}=499 \Omega$; $-2=$ dual |
| 1100 | 4 | 7 | 1 | 6.5 | c | 100 | 1.7 | 5 | 100 - 4.20 | -2,-4 for G=2,4 |
| 2900 | 9 | 15 | 0.2 | 2.5 | c | 500/G | 5.5 ${ }^{\text {d }}$ | 3-11 | 9.5 - 4.78 | -2=dual |
| 2300 | 10 | 15.4 | - |  | 50 | $\mathrm{Rg}^{\mathrm{h}}$ | 1.2 | 5-12 | 29 - 6.43 | CFB, 274ת; clamp |
| 4700 | 6.5 | 15.2 | 1 | 4 | 13 | $R_{g}{ }^{\text {h }}$ | 2.6 | 4.5-11 | 37 - 6.06 | $R_{\mathrm{f}}=200 \Omega$ |
| 380 | 10 | 15.4 | - |  | 80 | $\mathrm{Rg}^{\mathrm{h}}$ | 1.1 | 5-12 | 23 - 8.14 | CFB, $357 \Omega$ |
| 5100 | 16 | 5.6 | 1 | 4 | 8 | $\mathrm{Rg}^{\mathrm{h}}$ | 2.2 | 3-6 | 35 - 10.34 | $R_{\mathrm{f}}=348 \Omega$ |
| 1300 | 2.2k | 1.0 | 15 | 50 | c | 78 | $4^{\text {d }}$ | 3.3 | 120 - 10.55 | assumes $R_{\mathrm{S}}=50 \Omega$ |
| 4900 | $3.3^{\text {k }}$ | 5.2 | 1 | 4 | 8 | $\mathrm{Rg}^{\mathrm{h}}$ | 2 | 3.5-5.5 | 39 v 9.13 | $R_{\mathrm{f}}=349 \Omega$ |
| 6000 | 7 | 6 | 0.5 | 2.5 | 21 | $R_{g}{ }^{\text {h }}$ | $2.2^{\text {d }}$ | 3-10 | 40 - 6.06 | $R_{\mathrm{f}}=2002$; -2=dual |
| 6600 | $2^{\text {k }}$ | 5.2 | 1 | 4 | 8 | $\mathrm{Rg}^{\mathrm{h}}$ | 2.3 | 3.8-5.5 | 39 v 9.13 | $R_{\mathrm{f}}=349 \Omega$ |
| 6600 | 10 | 5.6 | 1 | 4 | 8 | $R_{g}{ }^{\text {h }}$ | 1.9 | 3-6 | 38 - 9.13 | $R_{\mathrm{f}}=349 \Omega$ |
| 3400 | 1.8k | 4.2 | 0.5 | 5 | 5 | 12k | 1.8 | 2.7-3.9 | 42 - 8.27 | emitter follower |
| 3100 | 2.2 | 4.9 | 0.5 | 5 | c | 100 | 1.7 | 5 | 100 - 10.45 | $Z_{\text {out }}=27 \Omega$ at 1 GHz |
| 8000 | $2^{k}$ | 6 |  | 6 | 5 | 3k | 2.7 | 3.5-5 | 37 - 5.65 | specs for $G=10 \mathrm{~dB}$ |
| 9800 | $2^{\text {k }}$ | 4.3 | 0.25 | - | c | 800/G | 1.7 | 3-3.6 | 40 - 5.89 | good for IF-strip |
| 9800 | $2^{\text {k }}$ | 4.3 | 0.25 | - | c | 800/G | 1.6 | 3-3.6 | 80 - 5.88 | good for IF-strip |
| 8700 | 1.4 | 3.5 | - | 36 | 20 | 10k | 5.4 | 5 | 60 - 11.47 | specs for $G=6 d B$ |
| 15 | 2500 | 60 | 1 | 10 | - | 10k | 35 | 9-40 | 5.2 - 4.21 | audio ${ }^{t}, 5$ ppm dist |
| 260 | 580 | 43 | 0.18 | 0.55 | 3.5 | 11M | 6 | 9-26 | 5.4 n 5.81 | 18-bit ADC driver |
| 48 | 240 | RRIO | 0.1 | 0.7 | 1.2 | 4M | $4.1^{\text {d }}$ | 2.7-12 | 4.8 $\cdot$ 3.42 | precision |
| 22 | 300 | RR | 0.2 | 0.8 | 3 | 24M | $5.1^{\text {d }}$ | 2.7-12 | 2.5 w 4.4 | specs |

Notes: (a) fixed gain, programmable gain (PGA), or gain set by input resistor $R g$. (b) RR output means $V_{\text {out }} d i f f=2 \times V_{\text {supply }}$ max. (c) included in $V_{0}$ spec. (d) includes feedback resistor noise. (e) matched 2 nd-order antialias filters; $7,10 \mathrm{MHz}$ avail. (f) set by filter. (g) 6600-x specifies 2.5 to 20 MHz 4 th-order filters. (h) nominally $Z_{\text {in }}=\mathrm{Rg}$, where $G=R f / R g$; but for " $D$ " circuit types it's greater than $R \mathrm{~g}$, see later section on Differential Amplifier Input Impedance. (i) filter, 6 to 27 MHz strappable. (j) -4 version compensated for $G<4$. (k) settle to 1\%. (m) most differential-to-differential amplifiers can convert single-ended input to differential output. ( n ) near. (o) instrumentation amplifier figures. (q) inst-amp input, differential-amp output. (r) $G=2$. (s) $R$-2R ladder input, differential-amp output. (t) high common-mode $Z_{\text {out }}$, like an isolation transformer. (v) inputs to $-V_{\mathrm{EE}}$. (w) RRO and inputs to $-V_{\mathrm{EE}}$ or within 0.2 V of $-V_{\mathrm{EE}}$. (y) RRO and input beyond rails, to $\pm 15 \mathrm{~V}$. (z) RTO.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0409.jpg?height=654&width=761&top_left_y=206&top_left_x=140)

Figure 5.93. Balanced audio driver with a high common-mode output impedance, so that the receiver (load end) sets the commonmode voltage. $V_{\mathrm{CM}(\text { out })}$ defaults to 0 V if the load is left floating.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0409.jpg?height=334&width=692&top_left_y=1037&top_left_x=29)

A, A2
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0409.jpg?height=361&width=776&top_left_y=1480&top_left_x=140)

Figure 5.94. Differential-output amplifier configurations $A$ and $B$, as listed in Table 5.10 on page 375. The uncommitted input opamp can be configured as a noninverting amplifier (or follower), or an inverting amplifier.
B. Input impedance The input impedance of amplifiers with configuration D is equal to $R_{\mathrm{g}}$, making them unsuitable for high gains because the input impedance becomes unmanageably low: the signal source is heavily loaded, the effective $R_{\mathrm{g}}$ is increased by the source impedance $R_{\mathrm{S}}$, and the CMRR is degraded by source-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0409.jpg?height=876&width=572&top_left_y=200&top_left_x=1084)

Figure 5.95. Fully differential amplifier configuration C , as listed in Table 5.10 on page 375 . The symmetry is evident in the redrawn version, $\mathrm{C}^{\prime}$, where the gain is $G=2 R_{\mathrm{f}} / R_{\mathrm{g}}$.
impedance imbalance. The exact value of $R_{\mathrm{g}}$ (and therefore the input impedance) will be affected by source termination and loading considerations; see $\$ 5.17 .4$ and the formulas in Figure 5.104.
C. Single-ended input Most fully differential amplifiers work fine with single-ended inputs, i.e., with the "-" input grounded. But you may wish to use $G=2$ or higher to achieve full peak-to-peak drive into a differential ADC. ${ }^{98}$
D. Common-mode rejection With differential pairs at both input and output, there are two measures of common-mode rejection: differential $V_{\text {out }}$ versus common-mode $V_{\mathrm{in}}$, which is usually quite good (e.g., 80 dB up to 1 MHz ); and common-mode $V_{\text {out }}$ versus common-mode $V_{\text {in }}$, which can be significantly poorer (e.g., 50 dB up to 1 MHz , degrading above that). But the latter is not terribly worrisome if the receiving device (e.g., an ADC) has good common-mode rejection itself. Resistor matching is important for configurations

98 This configuration is also available with a voltage gain less than unity. In a burst of cuteness, Analog Devices calls their AD8475 (with gains of 0.4 and 0.8 ) a funnel amplifier (get it?). With it you can reduce a 20 Vpp signal to a differential pair of 4 Vpp signals, for input to a lowvoltage ADC.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0410.jpg?height=1531&width=745&top_left_y=219&top_left_x=250)

Figure 5.96. Fully differential amplifier configuration D, as listed in Table 5.10 on page 375 ; the gain is $G=R_{\mathrm{f}} / R_{\mathrm{g}}$. A typical configuration for output amplifier $A_{1}$ is shown in $\mathrm{D}^{\prime}$, and TI's version for their THS45xx series is $\mathrm{D}^{\prime \prime}$; the THS4508/11/21, for example, use polarity complements ( $p n p$ input pair, etc.), permitting operation down to $V_{\text {in }}=V_{\text {EE }}-0.2 \mathrm{~V}$.
with external $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$ gain-setting resistors (configuration D ); see $\S 5.17 .5$ for more details.
E. Single-ended output The datasheets of some differential amplifiers describe operation with a single-ended
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0410.jpg?height=1358&width=797&top_left_y=206&top_left_x=1076)

Figure 5.97. Fully differential amplifier configurations E and F , as listed in Table 5.10 on page 375.
output. ${ }^{99}$ When it's operated in single-ended output mode, however, you care about the output offset voltage $\Delta V_{\text {OCM }}$ (i.e., the output error with respect to the $V_{\mathrm{OCM}}$ reference), which translates back to an input-referred error of $\Delta V_{\mathrm{OCM}} / G$. For the LMP7312 the output offset is $\pm 20 \mathrm{mV}$, far larger than the maximum input offset of $\pm 0.1 \mathrm{mV}$. This is a low-gain amplifier ( $G=0.1$ to 2 ), so this output offset looks like a corresponding worst-case
${ }^{99}$ For example, the datasheet for the "Precision SPI-Programmable AFE with Differential/Single-Ended Input/Output" LMP7312 says that "the output can be configured in both single-ended and differential modes with the output common mode voltage set by the user."
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0411.jpg?height=456&width=455&top_left_y=221&top_left_x=295)

Figure 5.98. Fully differential amplifier configuration G , as listed in Table 5.10 on page 375. This type is intended for ac- or transformer-coupled inputs.
input error of $\pm 200 \mathrm{mV}$ to $\pm 10 \mathrm{mV}$ ! This is hardly what one would call "precision."
F. $V_{\text {OCM }}$ bias pin You set the output common-mode voltage by asserting a dc bias at this pin. Some devices buffer this input to get high $R_{\text {in }}$, but many parts present you with an input impedance in the tens of kilohms. Generally the operating $V_{\mathrm{OCM}}$ range does not extend to the negative rail. If this pin is left unconnected, most parts default to mid-supply. It's always a good idea to bypass this pin, because the fast signals associated with these wide-bandwidth amplifiers couple to the $V_{\mathrm{OCM}}$ node.
G. Input common-mode range The input commonmode voltage range of most fully differential amplifiers does not extend to the negative rail, which can seriously constrain a circuit that's running from a single positive supply. This isn't as bad as it sounds, though: the outputs, sitting up there around a positive common-mode output voltage (set by the dc you apply to the $V_{\mathrm{OCM}}$ input pin), bring the input terminals up by the voltage dividers formed by $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$. This effect is largest when operating at low gains; when operating at higher gains it's best to check that the input common-mode range is not violated. Assuming that there's plenty of loop gain (i.e., that $G_{\mathrm{OL}} \gg G$ ) the (equal) voltage at the amplifier's inverting and noninverting pins is

$$
V_{(+,-)}=\frac{V_{\mathrm{OCM}}+G V_{\mathrm{in}(\mathrm{CM})}}{G+1}
$$

where the differential gain $G=R_{\mathrm{f}} / R_{\mathrm{g}}$, and $V_{\mathrm{in}(\mathrm{CM})}$ is the common-mode voltage of the (differential) input signal source. If the input is single ended (with the other differential input grounded) then (substituting $V_{\text {in }} / 2$ for
$\left.V_{\text {in(CM })}\right)$ you get

$$
V_{(+,-)}=\frac{V_{\mathrm{OCM}}+G V_{\mathrm{in}} / 2}{G+1}
$$

Note that with a balanced input signal source (i.e., fixed $\left.V_{\text {in }(\mathrm{CM})}\right)$, the voltages at the amplifier's ( + ) and ( - ) pins don't vary as the input differential signal does its thing. This is in contrast with the single-ended arrangement, in which the input signal amplitude causes a variation in input common-mode voltage. For the latter be sure to check for input common-mode violations at the extremes of the input signal.
Of course, you can do an end run around the problem by choosing an amplifier whose input common-mode range includes the negative rail, for example the THS4521 illustrated in §5.17.3.
H. Voltage feedback versus current feedback All of the " $R_{\mathrm{f}} / R_{\mathrm{g}}$ " amplifiers in Table 5.10 (page 375 ) use conventional voltage-feedback amplifiers, with the exception of the LMH6552/3, which uses current feedback (CFB). Because they are VFB amplifiers, they work well with bandwidth-limiting capacitors across the feedback resistors when operated at higher gains (helpful for taming the integrated voltage noise $v_{n}=e_{\mathrm{n}} \sqrt{\mathrm{GBW}}$, which can be excessive owing to the large bandwidth of many of these amplifiers). To a decent approximation, currentfeedback amplifiers have an $f_{3 \mathrm{~dB}}$ bandwidth independent of gain, whereas voltage-feedback amplifiers have a bandwidth inversely proportional to the closed-loop gain $\left(f_{3 \mathrm{~dB}}=\mathrm{GBW} / G_{\mathrm{CL}}\right)$. See the discussion in Chapter $4 x$.
I. Gain-setting resistors Large $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$ values can cause problems that are due to parasitic circuit-board capacitance. For example, $R_{\mathrm{f}}$ above 1 k for the modestcapability 145 MHz THS4521 creates peaking (Figure 5.99). Dual and quad package options may also suffer from unavoidable peaking problems caused by leadframe issues, so it's generally better to choose fixed-gain types in multiple-amplifier packages. Large values of $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$ also create (a) loss of speed, (b) increased input offset error from the relatively large bias currents characteristic of fast bipolar amplifiers, and (c) increased input-referred voltage noise, both from resistor Johnson noise and from the noise voltage developed across $R_{\mathrm{f}}$ by the amplifier's input noise current.
To put some flesh on these latter bones, consider the THS4521 again, with our (somewhat extreme) straw$\operatorname{man} R_{\mathrm{f}}=R_{\mathrm{g}}=100 \mathrm{k}$. From Figure 5.99 you can see the $\times 10$ reduced bandwidth and peaking. This peaking (which occurs with VFB amplifiers but not CFB types)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0412.jpg?height=537&width=795&top_left_y=219&top_left_x=220)

Figure 5.99. Large gain-setting resistor values create peaking in the frequency response, as shown in this datasheet plot for the THS4521 configured for unity gain ( $R_{\mathrm{f}}=R_{\mathrm{g}}$ ).
can be tamed by putting a small capacitor across each feedback resistor, but you'll lose a bit more bandwidth in the process. ${ }^{100}$ Turning this vice into a virtue, we note that you may wish to add feedback capacitors anyway, to reduce the bandwidth intentionally.
As for offset voltage, this part has an input bias current of 650 nA (typ), which would create a drop of 65 mV across 100 k . But the bias currents are reasonably well matched, with an offset current spec of $\Delta I_{B}= \pm 50 \mathrm{nA}$ (typ), thus creating an input offset of 5 mV . That's much better, but it does seriously degrade the amplifier's typi$\mathrm{cal} V_{\mathrm{OS}}= \pm 0.2 \mathrm{mV}$ ( $\pm 2 \mathrm{mV}$ max). You need to keep $R_{\mathrm{f}}$ and $R_{\mathrm{g}}$ less than 10k to preserve the amplifier's accuracy.
Finally, noise. There are two contributions, the resistors' Johnson noise ( $\left.e_{\mathrm{n}}=\sqrt{4 k T R}=0.13 \sqrt{R} \mathrm{nV} / \sqrt{\mathrm{Hz}}\right)$, and the noise voltage developed by the amplifier's current noise ( $e_{\mathrm{n}}=i_{\mathrm{n}} R_{\mathrm{f}}$ ). For $R_{\mathrm{f}}=100 \mathrm{k}$ the Johnson noise voltage is $40 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and the noise produced by the amplifier's $i_{\mathrm{n}}=0.6 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ is $65 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. These disastrously degrade the amplifier's typical $4.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (taking the usual root-sum-of-squares, the total added noise voltage is $76 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). The table below summarizes these figures, and also those corresponding to $R_{\mathrm{f}} R_{\mathrm{g}}=10 \mathrm{k}$ and $R_{\mathrm{f}}=R_{\mathrm{g}}=1 \mathrm{k} .{ }^{101}$

[^283]Bottom line: compared with the nominal 1 k value, the use of 100 k gain-setting resistors reduces your bandwidth $\times 10$, increases the typical offset voltage $\times 25$, and increases the typical input-referred noise voltage $\times 16$. You wouldn't want to do this. But you could reasonably use something like $2.49 \mathrm{k}, 4.99 \mathrm{k}$, or perhaps 10 k , buying increased input impedance at the expense of modest degradation of bandwidth, noise, and accuracy.

| ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0412.jpg?height=40&width=79&top_left_y=654&top_left_x=1113) | $-3 \mathrm{~dB}$ <br> Bandwidth (MHz) | Offset voltage* (mV, typ) | Input-referred noise |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  | $\begin{gathered} \sqrt{4 k T R} \\ (\mathrm{nV} / \sqrt{\mathrm{Hz}}) \end{gathered}$ | $\begin{gathered} i_{\mathrm{n}} R_{\mathrm{f}} \\ (\mathrm{nV} / \sqrt{\mathrm{Hz}}) \end{gathered}$ | $\begin{gathered} \text { Total* } \\ (\mathrm{nV} / \sqrt{\mathrm{Hz}}) \end{gathered}$ |
| 1k | 150 | $\pm 0.2$ | 4 | 0.7 | 4.6 |
| 10k | 45 | $\pm 0.5$ | 13 | 6.5 | 15 |
| 100k | 15 | $\pm 5$ | 40 | 65 | 76 |
|  | * Includes $V_{\mathrm{OS}}$ and $e_{\mathrm{n}}$ of the amplifier. |  |  |  |  |

J. Common-mode output impedance The voltage asserted onto the $V_{\mathrm{OCM}}$ pin sets the common-mode output voltage. Put another way, differential amplifiers have a low common-mode output impedance. That's usually what you want; after all, that's the reason there is a $V_{\mathrm{OCM}}$ pin. But this can create difficulties if the output is sent to a remote load that needs to establish its preferred common-mode level. That is the case in balanced audio (or video), sent substantial distances over balanced twisted-pair cable.
Take a look at Figure 5.100B. By driving the $V_{\text {OCM }}$ pin with the average output voltage, you create an amplifier that cooperates by letting the load lead the dance. In fact, the load can even unbalance the signal intentionally (by grounding one side), in which case the other output swings symmetrically around ground with the full desired differential output voltage. ${ }^{102}$ There are a few differential amplifiers that are designed specifically for this kind of application, with an internal configuration that creates a high common-mode output impedance. We saw one example (the DRV134, similar to the SSM2142) in Figure 5.93. Another excellent one is the THAT1606, from the curiously named THAT Corporation. ${ }^{103}$
The traditional solution has been to use an isolating transformer, which also can do the job of converting between single-ended and balanced signals (this is known as a "balun," for balanced-unbalanced) as shown. But

[^284]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0413.jpg?height=682&width=1516&top_left_y=210&top_left_x=191)

Figure 5.100. The common-mode output voltage of a differential amplifier is set by the $V_{\mathrm{OCM}}$ pin (usually defaulting to mid-supply if undriven), producing a low common-mode output impedance, as in A . But for balanced audio or video applications you want the (distant) load to be the boss. You can trick a differential amplifier, as in B , simulating the very high $\mathrm{CM}-\mathrm{Z}_{\text {out }}$ of an isolating transformer or balun.
transformers are bulky, limited in bandwidth and linearity, and not inexpensive. High $\mathrm{CM}-\mathrm{Z}_{\text {out }}$ differential amplifiers can be an attractive alternative.

### 5.17.2 Differential amplifier application example: wideband analog link

We conclude the discussion of differential amplifiers with several application examples: a wideband analog link over twisted-pair cable, and a riff on driving differential-input ADCs.

In $\S 5.14 .2 \mathrm{~F}$ we illustrated the use of a difference amplifier as the receiving end of an analog link over differential twisted-pair cable. In that circuit $R_{4} C_{1}$ creates a rising response at high frequencies ("equalization"), to compensate for the increasing cable attenuation. To complete the link, of course, we need a differential driver.

Figure 5.101 shows the whole enchilada, here implemented with Intersil's EL5170/72 differential line driver/receiver pair. They make triple units (EL5370/72) also, with application to color video. Bandwidths to tens of megahertz are easily achievable over tens of meters of Cat-5 cable, with modest equalization at the receiver end. Coaxial cable is considerably better, and two $50 \Omega$ coax lines can replace the $100 \Omega$ differential pair. As always, the balanced signal combines with excellent receiver CMRR (here 95 dB typ) to provide high rejection of interference.

### 5.17.3 Differential-input ADCs

Many analog-to-digital converters require differential signal inputs. This is almost universally true of high-speed converters (e.g., pipelined flash converters), as well as the varieties known as "charge-redistribution SAR" and "deltasigma" (ADCs, in all their glory, are the major subject of Chapter 13). And in many cases the input is hardly benign the internal switched capacitors introduce charge transients at the input terminals, mandating some external shunt capacitance. An additional annoyance is the requirement that the driver must be able to swing the inputs over the full conversion range (which may include ground), but without driving them beyond the ADC's power rails (with the risk of damage from input clamp conduction and possible SCR latchup).

#### A. First iteration: single-supply ADC driver with $V_{\text {OCM }}$ offset

Figure 5.102 shows two iterations of an input stage for fast single-supply ADCs with differential inputs. Our first design was based around the AD9225 12-bit 25 Msps pipelined flash converter, which runs from a single +5 V analog supply, and has a separate digital supply pin for interfacing to microcontrollers running from +3 V to +5 V . Its input span is programmable, either $0-2 \mathrm{~V}$ or $0-4 \mathrm{~V}$, and it provides a mid-span dc output ( +1 V or +2 V ) that can be used to set the differential amplifier's common-mode output (via the $V_{\text {OCM }}$ pin).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0414.jpg?height=738&width=1342&top_left_y=218&top_left_x=375)

Figure 5.101. Wideband analog link over Cat-5 network cable. The EL5370/72 package three similarly performing drivers-receivers in a single IC, convenient for sending analog video (RGB, S-Video, or YPbPr component video) over a single cable (which has four twisted pairs). See also Figure 5.71.

By running the differential amplifier from the same +5 V and ground, we are assured that the ADC's inputs cannot be driven beyond the rails. We chose the AD8139 differential amplifier for its low noise ( $2.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), ample bandwidth ( $\sim 15 \mathrm{MHz}$ at $G=20$ ), and ability to swing its output rail-to-rail (to drive the ADC over its full-input span). We used the recommended pair of series resistors to suppress amplifier ringing from charge transients at the ADC input; and we added a shunt capacitor to both reduce these transients and also provide a second stage of antialias filtering. ${ }^{104}$

That's all good news. The bad news is that this amplifier, in common with most differential amplifiers, does not include ground in its input common-mode operating range: you've got to stay a volt away from either rail. So you cannot simply tie one input to ground and drive the other with a small signal around ground. ${ }^{105}$ The amplifier does let you run from split supplies (e.g., $\pm 5 \mathrm{~V}$ ), which solves the input signal-level problem; but then you have to worry about

[^285]power-supply sequencing and the risk of driving negative current into the ADC's clamp diodes.

#### B. Second iteration: single-supply ADC driver with $V_{\text {in(CM) }}$ to ground

What to do? Find a single-supply amplifier that operates with inputs to the negative rail! That's what we did in the second circuit, whose THS4521's common-mode input range includes ground ("NRI" - negative rail input), and in fact guarantees proper operation with inputs to $-0.1 \mathrm{~V} .^{106}$ It also has the needed rail-to-rail output, but it is somewhat noisier and slower than the $\operatorname{AD} 8139(4.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and a gain of only $\times 5$, to maintain 18 MHz bandwidth).

We teamed it with the ADC14L040, a more accurate and faster ADC (14-bit, 40 Msps ) that runs on a single +3.3 V supply and uses less power ( 235 mW versus 335 mW ). The ADC's span is $\pm 0.5 \mathrm{~V}$, centered on an allowable midspan voltage of +0.5 V to +2.0 V . We could have used the ADC's reference-derived +1.5 V output to drive the amplifier's $V_{\mathrm{OCM}}$ pin, as before; but when that pin is not driven the amplifier defaults to mid-supply

[^286]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0415.jpg?height=1001&width=805&top_left_y=206&top_left_x=118)

Figure 5.102. The care and feeding of single-supply differentialinput ADCs. A. The AD9225 provides a midscale $V_{\text {ref }}$ output to set the amplifier's common-mode output; but the AD8139's inputs cannot go closer than 1 V from either rail. B. The THS4521 is unusual in allowing input voltages to the negative rail (here ground).
$(+1.65 \mathrm{~V})$, which is fine. As before we added the recommended decoupling filter.

Given the ADC's higher resolution, it's worth checking to see how the noise voltage contributed by the amplifier and resistors compares with the converter's step size. Taking into account the input gain, the step size is $400 \mathrm{mV} / 2^{14}$, or $25 \mu \mathrm{~V}$. The amplifier's noise density $(4.6 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ combined with the (uncorrelated) resistor noise $(2.7 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ is about $5.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, or about $18 \mu \mathrm{Vrms}$ in the $\sim 12 \mathrm{MHz}$ effective bandwidth of the amplifier and $R C$ filter. In other words, the noise voltage is comparable to the converter's LSB step size. This is OK, though it would be nice to have it somewhat lower. ${ }^{107}$ Perhaps a way to think about it is that the circuit's virtues of speed and resolution have made

[^287]the relatively small noise contribution look bad. You can always throw away bandwidth (if you don't need it), or just look at the top 12 bits, if that makes you feel better.

#### C. Third Iteration: transformer coupling

If you don't need dc coupling, an easy way to drive differential-input converters is with a wideband transformer. They're widely used in radiofrequency applications, and you can get them in small surface-mount packages. Figure 5.103 shows how to do it. Use the ADC's mid-span reference output (suitably bypassed) to set the common-mode voltage, and use a resistive termination that matches the transformed impedance of the driving source. Here we used a 1:2 turns ratio transformer, which transforms impedances by that ratio squared, thus $50 \Omega: 200 \Omega$. This nicely finesses the problems of amplifier input- and output-voltage ranges, noise, and so on. But note that there's no intrinsic protection against ADC overdrive.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0415.jpg?height=429&width=717&top_left_y=987&top_left_x=1014)

Figure 5.103. Wideband transformers can drive differential-input ADCs. They have excellent CMRR, and are available with frequency spans of 10,000:1.

### 5.17.4 Impedance matching

Differential amplifiers are commonly used for widebandwidth applications, in which the (single-ended) input must be properly terminated to match the signal's source impedance (usually $50 \Omega$ ). This is particularly important when the signal arrives through a length of transmission line, in order to prevent reflections (see Appendix H). This is not difficult, as long as you keep your wits about you. ${ }^{108}$

Figure 5.104 shows the situation when differential amplifiers of the D type (Figure 5.96) are used. The extra resistor $R_{\mathrm{T}}$ is chosen so that the signal source sees an input impedance equal to $R_{\mathrm{S}}$ (that is, $R_{\mathrm{T}} \| R_{\mathrm{in}}=R_{\mathrm{S}}$ ). Note

[^288]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0416.jpg?height=402&width=715&top_left_y=207&top_left_x=265)
for given $R_{\mathrm{S}}, G$, and $R_{\mathrm{G} 1}$,
$R_{\mathrm{T}} \| R_{\mathrm{in}}=R_{\mathrm{S}}$ (terminate)
$R_{\mathrm{G} 2}=R_{\mathrm{G} 1}+R_{\mathrm{S}} \| R_{\mathrm{T}} \quad$ (balance)
$$
R_{\mathrm{F}}=G \frac{R_{\mathrm{G} 2}\left(R_{\mathrm{S}}+R_{\mathrm{T}}\right)}{2 R_{\mathrm{T}}} \quad \text { (gain) }
$$
$$
\left(G \equiv \frac{V_{\mathrm{o}}(+)-V_{\mathrm{o}}(-)}{V_{\mathrm{in}}}=\frac{2 R_{\mathrm{T}}}{R_{\mathrm{T}}+R_{\mathrm{S}}} \frac{R_{\mathrm{F}}}{R_{\mathrm{G} 2}}\right)
$$

Figure 5.104. Terminated single-ended to differential amplifier: design equations.
especially that the amplifier's noninverting input is not a virtual ground, so $R_{\text {in }}$ is somewhat larger than $R_{\mathrm{G} 1}$ alone, according to the equation in the figure. The differential amplifier has the usual equal-value feedback resistors $R_{\mathrm{F}}$, but the gain-setting resistors $R_{\mathrm{G}}$ are unequal, to take account of the finite impedance at the drive point (marked $V_{\mathrm{in}}$ ). That is, $R_{\mathrm{G} 2}$ must be larger by the parallel resistance $R_{\mathrm{S}} \| R_{\mathrm{T}}$. Finally, the feedback resistors $R_{\mathrm{F}}$ must be adjusted upward to bring the gain back to the desired value.

Note that the gain is defined in terms of $V_{\text {in }}$, i.e., with respect to the loaded input signal amplitude (not the opencircuit source amplitude). This makes good sense, because signal amplitudes (from signal generators, etc.) are normally specified as their properly terminated amplitudes.

As an example, for a $50 \Omega$ source, $G=2$, and $R_{\mathrm{G} 1}=$ $200 \Omega$, you would find (choosing nearest $1 \%$ standard resistor values) $R_{\mathrm{T}}=60.4 \Omega, R_{\mathrm{G} 2}=226 \Omega$, and $R_{\mathrm{F}}=412 \Omega$.

Unlike the situation at high frequencies, it is not necessary to terminate a signal source when operating at low frequencies (e.g., audio). In that case $R_{\mathrm{T}}$ is omitted and $R_{\mathrm{G} 2}$ is simply $R_{\mathrm{G} 1}+R_{\mathrm{S}}$. The gain, defined now in terms of the open-circuit source signal amplitude, is just $G=R_{\mathrm{F}} /\left(R_{\mathrm{G} 2}\right)$.

### 5.17.5 Differential amplifier selection criteria

All differential amplifiers are not created equal. There are plenty of subtleties lurking, associated with tradeoffs of bandwidth, accuracy, output drive capability, supply voltage, and the like. Here's a summary collection of such con-
siderations, tied closely to the differential amplifiers listed in Table 5.10 on page 375.

#### A. Supply voltage, RR output capability

The first group in Table 5.10 lists the high-voltage differential amplifiers, with $\pm 12 \mathrm{~V}$ to $\pm 15 \mathrm{~V}$ supplies (though some can work down to $\pm 5 \mathrm{~V}$ ). These are usually used with bipolar (split) supplies, but most have the $V_{\mathrm{OCM}}$ commonmode output capability to drive single-supply ADCs. This common-mode capability distinguishes the parts on this table from other types. Most parts have internal rail-splitting divider resistors (which require a bypass capacitor) to establish the common-mode output voltage, but this can be overridden by a dc mid-span output provided from the ADC (see Figure 13.28 in $\S 13.6 .2$ ). Be sure to check both datasheets - sometimes an op-amp will be required (in the manner of Figure 5.86).

Keep in mind that " $V_{\text {out }}$ diff'l max (Vpp)" means $\left(V_{a+}-V_{b-}\right)+\left(V_{b+}-V_{a-}\right)$; that is, twice the peak-to-peak output swing of any one output.

These parts have high differential-output capability, $>50 \mathrm{Vpp}$ (each output going $\pm 12.5 \mathrm{~V}$ ), and higher still for $\pm 18 \mathrm{~V}$ supplies, thus well suited for line-driving applications. The differential THAT1606, OP1632, and LME49724, and the single-ended-input DRV134 are all intended for pro-audio (see §13.9.11D). As described before, the differential types can also be used with single-ended inputs. For lowest distortion, all four of these parts should be driven with a low-impedance source, such as an op-amp output.

Next in Table 5.10 (page 375) are the low supplyvoltage amplifiers. Most high-frequency, low supplyvoltage differential amplifiers are limited to a maximum of $\pm 5 \mathrm{~V}$ supplies, or even less. Many cannot be used with total supply voltages greater than 5 V , or even 3.3 V in some cases. Some can run from a single supply as low as +2.7 V or +3.3 V , others need at least +5 V .

Many of the low- to mid-frequency low-voltage parts have rail-to-rail (RRO) outputs, convenient for singlesupply ADCs, which don't allow signals beyond their supply rails: simply power the amplifier from the same supply rail as the ADC. But note especially that high-frequency RRO types may suffer degraded high-frequency capability when used near their supply rails. For example the LTC6404, with a featured 600 MHz bandwidth, reveals even at 10 MHz distortion that climbs dramatically when the output approaches within 400 mV of the rails.

An alternative to the use of low-voltage RR outputs to protect ADC inputs is to use an amplifier with outputvoltage clamping. That's a nice feature of the LMH6553.

This part is also a CFB amplifier, good for wide bandwidth at high gains, but bad for noise (see the next subsection).

#### B. Common-mode input range, and the negative rail

Most of the parts have summing junctions that must be operated at least a volt or more above the negative supply rail (the low-power THS4521 is an exception). However, as explained in $\S \S 5.17 .1 \mathrm{G}$ and 5.17 .3 ), that does not necessarily prevent the input signals from going down to ground, most particularly when the amplifier is operated in a fully differential configuration at low gains ( $G=1$ or $G=2$, for example).

Nine of the parts (marked $\mathbf{w}$ or $\mathbf{v}$ in Table 5.10's "RRO" column - see page 375) allow use of their summing junctions down to $-V_{\mathrm{EE}}$. The datasheets will declare something like "Common-Mode Input Range Includes the Negative Rail" or "NRI" on the front page. In most cases performance is not degraded under this condition, in contrast to the loss of performance when RRO-capable amplifiers are run to the extremes of output swing. ${ }^{109}$ This is especially useful when fully differential amplifiers are used as single-ended to differential converters, with the $(-)$ input grounded, as in Figure 5.102B. But be careful - if either summing-junction input is taken further than the specified -0.2 V below $-V_{\mathrm{EE}}$, polarity reversal at the output may occur, similar to the situation with the legacy (but still wildly popular) LM324/358 single-supply op-amps. ${ }^{110}$

#### C. Low $Z_{\text {in }}$

Most of these amplifiers present rather low input impedances to their signal sources, especially when configured for high gains, because the specified $R_{\mathrm{f}}$ gain-setting resistor values are low, and $Z_{\text {in }}$ is roughly $R_{\mathrm{f}} / G$ (exceptions: LTC6416, and the EL5170 family). Most parts with higher input impedances are noisier, mostly because of resistor Johnson noise (exception: the AD8352, which uses the F rather than the D configuration).

Signal impedance matching is often a concern, especially at high frequencies, say $30-100 \mathrm{MHz}$ and above, even with short PCB traces. An amplifier's low $Z_{\text {in }}$ complicates the problem of matching the impedance of the signal source, and it also affects the amplifier's gain. See §5.17.4 for helpful formulas.

[^289]
#### D. Offset voltage, CMRR

Many of the amplifiers in Table 5.10 (see page 375) have poor offset voltage and other dc specifications. Most of these are fixed-gain parts with internal resistors (e.g., with the D3 configuration). They appear to be suffering from offsets arising from the high $V_{\mathrm{OCM}}$ common-mode output voltage that's natural with differential amplifiers, combined with modest internal resistor mismatches; for example, a $1 \%$ resistor mismatch operating on a $V_{\mathrm{OCM}}$ of 1.5 V would produce an effective input offset of 15 mV . By contrast, most "bare" parts (e.g., the D configuration) in the table have attractive low offset-voltage specs. But they will surely develop high offsets if you were to use $1 \%$ gainsetting resistors to complete the amplifier. Note also that dc accuracy is degraded by mismatched external resistance when driving D-configuration differential amplifiers.

If we had room for a CMRR column in the table, we'd see a similar bare- versus fixed-gain dichotomy, and for the same reason. Taking two examples from their respective datasheets, the bare ADA4932 has a 100 dB typical CMRR, compared with 64 dB for the similar fixed-gain ADA4950. Likewise for the bare LTC1992 (90 dB) and the fixed-gain LTC1992-10 (60 dB).

In many fully differential applications CMRR isn't important. But if it matters in your design, use $0.1 \%$ resistors, or matched resistor arrays. And be sure to take special care with circuit-board wiring capacitances, which really matter at high frequencies: for example, to achieve -80 dB matching at 1 MHz with $500 \Omega$ gain-setting resistors, you've got to match capacitances to a difficult 0.03 pF ! And no good deed goes unpunished - the CMRR will degrade by 20 dB for each decade increase in frequency.

A better solution would be to use an E- or Fconfiguration part. Intersil's EL5170-series parts have good CMRR, e.g., 80 dB at 1 MHz (but poor 25 mV offset), and Analog Device's AD8352 boasts 60 dB at 100 MHz and 6 mV offset. Both are much less affected by unbalanced input resistances than D-configuration types.

#### E. Fixed gain, external resistor-settable gain

One good reason to select a fixed-gain amplifier is that some of them have better gain accuracy than can be easily and inexpensively achieved with discrete resistors for example, attractive worst-case gain errors of $\pm 0.04 \%$ for the NSC LMP3712, $\pm 0.15 \%$ for the TI (Burr-Brown) PGA280 (both programmable-gain parts), and $\pm 0.08 \%$ for the Analog Devices pin-programmed AD8270.

The simplicity of fixed-gain types may seem appealing, but some external-resistor types have their attractive aspects, e.g., TI's THS4520 and Analog's ADA4932
draw much lower supply currents than their competitors. The THS4520 can be used to make $G=10$ amplifiers with 120 MHz bandwidth.

Fixed-gain types are easier to use at high frequencies, because they avoid painful wiring and pin-capacitance problems. But most have poor absolute gain accuracy, $\Delta G$ in Table 5.10 (exception: the ADL5561). Most don't allow bandwidth-limiting filter capacitors to be added, and most restrict you to low gain values (exceptions: the PGA870 and LT1993-10, but note their high power consumption).

#### F. VFB, CFB, $f_{3 \mathrm{~dB}}, \mathrm{GBW}$, and filters

Few of the fixed-gain amplifiers offer special filtering capability. Three LTC offerings are an exception, especially the LT6600-x, with five fixed 4th-order filter frequencies (alliteration!) available from 2.5 MHz to 20 MHz .

All of the adjustable-gain types employ voltage-feedback-mode op-amps, with two exceptions (the LMH6552 and LMH6553). For gains $G \geq 4$ they follow the GBW rule, namely $f_{-3 \mathrm{~dB}}=\mathrm{GBW} / G$. But be aware that the "Bandwidth" value in the table is generally considerably higher ( $1.5 \times$ or more) than the part's GBW, because it is determined at unity gain, where the amplifier benefits from response peaking that extends its -3 dB rolloff frequency. (The manufacturer may want to show off its bestlooking values, but the peaking for $G=1$ may be so severe with some parts that you may not want to use them that way.) You may have to study datasheet response plots, etc., to determine the actual true (and very useful) GBW value. Because these are VFB op-amp types, they are stable with bandwidth-limiting filter capacitors added across the feedback resistors. You can increase the $R_{\mathrm{f}}$ value (which increases the input impedance) and add a small parallel $C_{\mathrm{f}}$ capacitor to bring peaking under control or a larger one to provide a bandwidth filter for your signal. ${ }^{111}$

#### G. Response peaking, GBW, and 0.1 dB bandwidth

Gain peaking is a primary killer of good "bandwidth-to0.1 dB " ratings. The 0.1 dB bandwidth numbers may be

[^290]much improved for higher gains, where low-gain peaking is eliminated. Take, for example, the ALD5561, which boasts a -3 dB bandwidth of 2900 MHz at its minimum gain ( $G=2$ ), but its -0.1 dB bandwidth is a disappointing 200 MHz (i.e., just $7 \%$ of its -3 dB bandwidth). However, at its maximum gain ( $G=6$ ), where the -3 dB is reduced somewhat (to 1800 MHz ), its -0.1 dB bandwidth improves to 600 MHz (i.e., $33 \%$ of its -3 dB bandwidth). This behavior is displayed nicely in the datasheet's graphs (see Figure 5.105). It is possible that the settling time is also improved (from a lack of ringing), although this isn't specified.

Note that some of the parts in the table are available in dual configurations (noted in the Comments column in Table 5.10), which can be helpful in providing matched timedelay responses, important for many applications.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0418.jpg?height=552&width=733&top_left_y=954&top_left_x=1103)

Figure 5.105. Amplifier peaking at low gain settings produces an extended " -3 dB bandwidth," at the expense of flatness of response.

#### H. Slew rate, settling time, large-signal bandwidth

Just as with some high-speed op-amps, the datasheets indicate a much wider bandwidth for small ( $\sim 100 \mathrm{mV}$ ) signals than for large $(\sim 2 \mathrm{~V})$ signals. This is a slew-rate issue: amplifier output-swing capabilities are reduced as their slew-rate limits are approached. For example, Analog Devices' low-power ADA4932 has a $2800 \mathrm{~V} / \mu \mathrm{s}$ specified slew rate, which implies that 1 V amplitude sinewave outputs are possible to $f=S / 2 \pi A=445 \mathrm{MHz}$. Indeed the part's datasheet shows a -3 dB response to 560 MHz (or even 1 GHz with smaller $R_{\mathrm{f}}$ ) for 100 mV output, but only to 360 MHz for 2 Vpp . Higher slew-rate parts are available,
even to $10 \mathrm{kV} / \mu \mathrm{s}$ (the ALD5561), implying a 2 Vpp capability to $1.5 \mathrm{GHz} .{ }^{112}$

#### I. Distortion

Two of the high-voltage parts (the OP1632 and LME49724), often used for professional music applications, have their distortion performance plotted in Figure 5.43. We would hope that a fully differential circuit, with differential input signals, might have lower distortion than competing single-ended circuits, at least for the symmetrical 2nd-harmonic. And indeed the differential LME49724 does very well, in the -140 dB territory. However, the single-ended LME49990 and OPA134 op-amps do better on the graph.

Figure 5.106 plots distortion (from manufacturers' datasheets) for a few of the differential amplifiers in Table 5.10 (page 375) for frequencies to 100 MHz . As we cautioned earlier, the conditions for distortion data are not standardized, complicating direct comparisons. Consequently, many of these parts provide multiple plots, taken with different combinations of gain, load resistance, signal amplitude, and supply voltage, and in which 2nd- and 3rd-harmonic distortion curves are shown separately.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0419.jpg?height=552&width=802&top_left_y=1201&top_left_x=122)

Figure 5.106. Total harmonic distortion (THD) versus frequency, taken from the respective datasheets, for a selection of the differential amplifiers in Table 5.10 on page 375.

Be careful when evaluating distortion (a parameter that we've not listed in the table). For example, the ADA4932 has 560 MHz (or 360 MHz ) bandwidths, as discussed earlier, but the luster of its front-page claim to being a lowdistortion amplifier $(-90 \mathrm{~dB}$ at 20 MHz ) is tarnished some-

[^291]what when you discover that it deteriorates by a factor of $10 \times$ by 50 MHz , well below its 360 MHz bandwidth.

As we saw with the op-amp distortion plots in Figures 5.43 and 5.44, there's a strong correlation between speed (high GBW, fast slew rate) and low distortion at high frequencies. This is especially clear in Figure 5.106 above 1 MHz . For example, the 145 MHz THS4521 that we've often mentioned performs poorly even in the under5 MHz -region, compared with its TI relative, the 1.6 GHz THS4511 (note that both have NRI front ends, i.e., operating common-mode input range to the negative rail). ${ }^{113}$ Four of the best parts in this class maintain better than -100 dB distortion out to 20 MHz , compared with just 7 MHz for the best-in-class AD8045 op-amp in Figure 5.44. In other words, at high frequencies (say above 10 MHz ) fully differential amplifiers excel in low distortion compared with single-ended op-amps.

As we will see in Chapter 13, 16-bit ADCs are available with sampling rates to 250 Msps (e.g., the AD9467, see Table 13.4), justifying a need for better than $0.01 \%$ linearity ( -80 dB distortion) at frequencies approaching 100 MHz . Happily, manufacturers of differential amplifiers are rising to this challenge. ${ }^{114}$

#### J. Noise, high 1/f noise corners

We conclude with a few comments about noise. We've tabulated amplifier voltage noise, but not current noise. But we do list the input bias current $I_{\mathrm{B}}$, which is roughly predictive of current noise, which must equal or exceed the shot-noise contribution of $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{B}}}$. Note that CFB amplifiers, with their exceptionally high input currents, have much greater input current noise, generally as much as $10 \times$ greater than VFB amplifiers.

Looking at Table 5.10 (page 375), we see many amplifiers with noise densities in the range of $25-45 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Assuming no increase above say 10 MHz (check the datasheet plots) this corresponds to a wideband inputvoltage noise of $V_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{\mathrm{BW}}$, which evaluates to $175-$ $700 \mu \mathrm{Vrms}$ for bandwidths of $50-250 \mathrm{MHz}$. This is quite a bit larger than the $30 \mu \mathrm{~V}$ LSB step size of a 16 -bit ADC with a 2 Vpp full-scale differential input. While some

113 In fairness, the THS4521 gets by on a miserly 1.1 mA of supply current and has RR outputs, whereas the THS4511 takes 39 mA and lacks RROs.
${ }^{114}$ But are they rising to the challenge posed by NSC's ADC12D1800, a 12-bit 3600 Msps converter? Or the even greater challenge posed by the even-speedier ADCs that surely will be available by the time this book's ink has dried? Such ADCs will likely have to be driven with transformers.
dither is a good thing, it's clear that even at $G=1$ these amplifiers are too noisy for some applications.

There are many other amplifiers in the table with $e_{\mathrm{n}}$ specs down in the $1.1-5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ range. But these are the bare amplifier summing-junction noise specs, without the necessary feedback resistors taken into account. Amplifier gains of 5 or 10 are generally assumed, not the least to overcome the amplifier's own output-stage noise. Many of the amplifiers specify $R_{\mathrm{f}}$ values of $350-500 \Omega$. For $G=1$ the input resistor $R_{\mathrm{g}}$ would have the same value, and its Johnson noise of $2.4-2.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ would dominate the intrinsic noise of the quieter amplifiers. However, for $G=10$ the $35-50 \Omega$ resistor noise is under $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, which would not badly degrade the completed amplifier's noise.

Finally, many amplifiers have good looking noise specs, but we must warn you to examine the noise-versusfrequency curves on their datasheets; many have very high $1 / f$ noise corners. This is especially true for current noise, with some $1 / f$ corners way up at 1 MHz or beyond. An example of a troublesome spec might be the THS4508, with its pnp input transistors (for operation to GND) and $4.7 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ of current noise at 1 MHz . This creates $1.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ across a $349 \Omega$ resistor, which is OK compared with the part's $e_{\mathrm{n}}=2.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. But if you were to use 1 k resistors, the corresponding current-induced noise voltage would be $4.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, dominating the amplifier's $e_{\mathrm{n}}$. Depending on the application, this might be of concern. Or it might not.

#### Review of Chapter 5

An A-to-M summary of what we have learned in Chapter 5. This summary reviews basic principles and facts in Chapter 5, but it does not cover application circuit diagrams and practical engineering advice presented there.

#### †A. Precision and Dynamic Range.

A precision circuit is one that exhibits (through careful design and choice of components) both initial accuracy, and also stability (i.e., maintenance of accuracy over time and temperature). A precision circuit may (but need not) exhibit wide dynamic range (the ratio of signal amplitudes over which it operates); see §5.1.

#### IB. Error Budget.

When designing a precision circuit, you need to keep track of numerous error contributions (from voltage offsets, current-induced offsets, component tolerances, and the like); this is best tallied in an error budget, which promotes design discipline, and which assists in helping you spot the dominant error sources; see the example in §5.5.

#### IC. Strict versus Pragmatic.

Strict worst-case design mandates that all components be operated within their datasheet specifications, and that the effects of all their worst-case errors be added (as unsigned magnitudes) to determine the circuit's performance. The benefit of such conservatism is a circuit guaranteed to perform within specifications (assuming proper design); the downside is that it may be impossible to achieve design goals with available and/or affordable components, taking their worst-case specifications in a worst-case arithmetical combination (and noting that some critical performance parameters may be unspecified, or show only "typical" values). We favor a pragmatic approach (§5.3), taking with a grain of salt some of the published worst-case parameters (for example, input leakage current, where testing limits encourage highly conservative worst-case specs), or adopting reasonable estimates of unspecified parameters. It may be sufficient to establish that the circuit effects of the unspecified parameter are completely insignificant; or, if it's a closer call, you may have to set up a testing regime of incoming components to ensure that you meet specs. If have a situation in which there are many components contributing to an overfull error budget, you may have to validate the performance of the overall circuit, subassembly, or complete instrument at final test.

#### 1D. Component Errors - Resistors.

Taking a simple example, resistor accuracy (including the effects of tempco) sets a limit on the accuracy of an amplifier's gain. But it's not that simple, because amplifier gain usually depends on a resistance ratio; so the situation is greatly improved if you use a resistor pair with accurate ratio and matched tempco, and it's the ratio mismatch and the tempco of the ratio that are limiting. Likewise, the CMRR limit of a difference amplifier depends on resistor-pair matching, $\operatorname{CMRR}(\mathrm{dB}) \approx 20 \log (100 / p)$, where $p$ is the ratio mismatch in percent. To give scale to these statements, typical metal-film resistors come in accuracy ranges of $0.05 \%-1 \%$, with a typical tempco spec of $25-100 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$; resistor arrays intended for high precision have accuracies in the range of $0.01 \%-0.05 \%$, tempcos down to $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ or better, and matching accuracies and tempcos down to $0.01 \%-0.001 \%$ and $1-0.1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, respectively. Real resistors depart from the ideal also in linearity, i.e., they exhibit some resistance change with applied voltage. See §5.6.1; see also $\S 1 x .2$ for further discussion of resistors and their vicissitudes (e.g., long-term drift, and parasitic inductance and capacitance).

#### IE. Component Errors - Capacitors and Switches.

Capacitors have several amusing traits that affect the accuracy of integrators and of sample-and-hold circuits; these include resistive leakage (thus exponential decay), and more seriously dielectric absorption (memory effect, see §5.6.2, §1x.3, and the dielectric-absorption plots in that section.) These application circuits include analog switches (for integrator reset, and sample-to-hold switching), which introduce errors through leakage and charge injection (§§3.4.2E and 5.6.3).

#### TF. Amplifier Input Errors.

This is where most of your troubles are located. The primary qualification for membership in the category of precision op-amps is a small offset voltage $V_{\text {os }}$, and a correspondingly low tempco $\mathrm{TC} V_{\mathrm{OS}}$ (sometimes called $\Delta V_{\mathrm{OS}}$ ). The offset voltage operates at the input, so the RTI (referred to the input) error is simply $V_{\mathrm{OS}}$; at the output of an amplifier of voltage gain $G_{\mathrm{V}}$ the $V_{\mathrm{OS}}$-induced error is $\Delta V_{\text {out }}=G_{\mathrm{V}} V_{\mathrm{OS}}$. In an integrator circuit with input resistor $R_{\text {in }}$, the input offset voltage is equivalent to an input current error of $\Delta I_{\text {in }}=V_{\mathrm{OS}} / R_{\text {in }}$. To give an idea of scale, a typical precision op-amp has an offset voltage of $10-50 \mu \mathrm{~V}$, and a tempco of $0.1-0.5 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$. Auto-zero op-amps (see $\mathbb{T I I}$ ) improve on these figures by about a factor of ten; see Table 5.5 on pages 320-321 and Table 5.6 on 335. See also $\S 5.10 .5$.

But there's more. Input bias current $I_{\mathrm{B}}$ flowing through
the source resistance $R_{\mathrm{S}}$ seen at the amplifier's input produces an RTI voltage error of $\Delta V_{\mathrm{in}}=I_{\mathrm{B}} R_{\mathrm{S}}$. For precision bipolar op-amps, whose bias currents are of order 10 nA , this becomes serious for source resistances greater than a few kilohms (where $I_{\mathrm{B}} R_{\mathrm{S}}$ amounts to a few tens of microvolts, in the same ballpark as a precision op-amp's $V_{\mathrm{OS}}$ ). High- $R_{\mathrm{S}}$ situations thus mandate low-bias op-amps, usually those with JFET or MOSFET inputs, or (for moderate source resistance) a bipolar precision op-amp with biascancellation (where $I_{\mathrm{B}}$ is of order 1 nA ). A warning: the very low bias current of FET-input op-amps rises dramatically at higher temperatures (see Figure 5.6), where its input current may even exceed that of a bias-cancelled bipolar op-amp. See also §5.10.7.

Looking deeper, additional error sources at op-amp inputs include $I_{\mathrm{B}}$ variation with common-mode input voltage $V_{\mathrm{CM}}$ (§5.7.2, Figure 5.7), $V_{\mathrm{OS}}$ variation with $V_{\mathrm{CM}}$ (i.e., CMRR, §5.7.3, §5.10.9, and Figures 5.10, 5.29, and 5.30), PSRR, and input noise ( $e_{\mathrm{n}}, i_{\mathrm{n}}, \S \S 5.10 .6$ and 5.10.8).

#### IIG. Amplifier Output Errors.

While much of precision analog design concerns dc and low frequencies, some applications require accuracy at higher speeds: audio and video, communications, scientific measurement, and so on. With falling op-amp loop gain, input errors are rising, output impedance is rising, and slew-rate limitations may come into play, along with reduced suppression of output-stage crossover distortion, gain nonlinearity, and phase error. And overshoot, ringing, and settling time are critical in dynamic applications.

These can be made quantitative. The gain error $\delta_{\mathrm{G}} \equiv\left(G_{\text {ideal }}-G_{\text {actual }}\right) / G_{\text {ideal }}=1 /(1+A B)$, where $B$ is the feedback fraction around open-loop gain $A$; see §5.8.5. The closed-loop bandwidth is $f_{3 \mathrm{~dB}}=f_{\mathrm{T}} / G_{\mathrm{CL}}$, corresponding to a time constant of approximately $\tau \approx G_{\mathrm{CL}} / 2 \pi f_{\mathrm{T}}$, which (if well compensated, with good phase margin) produces a settling time of order $5-10 \tau$; see $\S \S 5.8 .2$ and 5.10.10. An op-amp's actual settling time can be considerably longer, and there's no substitute for real data; see Table 5.5 on pages 320-321. A well-compensated op-amp exhibits a closed-loop phase error of $\phi \approx f / f_{\mathrm{C}}$, where $f_{\mathrm{C}}=f_{\mathrm{T}} / G_{\mathrm{CL}}$ is the frequency at which the closed-loop gain has fallen to unity. ${ }^{115}$ Op-amp distortion depends strongly on the output-stage circuit; see the extensive plots in Figures 5.43 and 5.44.

[^292]
#### IH. Rail-to-rail Op-amps.

It's tempting to choose op-amps with rail-to-rail commonmode input range (RRI), rail-to-rail output (RRO), or both (RRIO), especially for operation at low supply voltages.
RRI op-amps. But there are drawbacks associated with the duplicate complementary input stages that can seriously compromise precision, notably an abrupt change of both $I_{\mathrm{B}}$ and $V_{\mathrm{OS}}$ at the input crossover voltage (§5.9.1). Some RRIO op-amps (e.g., the OPA360-series) circumvent this problem by using an on-chip charge pump. If you don't need full rail-to-rail input, choose an op-amp whose input common-mode range extends only to one rail (usually the negative rail).

RRO op-amps. Op-amps that feature rail-to-rail output have their own issues, stemming from the use of a common-source (or common-emitter) output-stage topology, rather than the conventional source follower (or emitter follower). These include increased distortion, and higher output impedance (thus gain and phase shift are more susceptible to load impedance). However, many RRO op-amps mitigate this latter problem by using internal capacitive feedback to lower the open-loop output impedance at high frequencies, as seen for example in Figure 5.34.

#### III. Auto-zero Op-amps.

This subclass of op-amps includes on-chip offset-nulling circuitry that operates cyclically (with an on-chip oscillator) to trim the input offset voltage ( $\$ 5.11$ ). As the entries in Table 5.6 on page 335 demonstrate, this produces typical $V_{\mathrm{OS}}$ values around a microvolt, with tempcos around $10 \mathrm{nV} /{ }^{\circ} \mathrm{C}$, roughly an order of magnitude better than the best conventional precision op-amps. Notable, too, is the absence of a $1 / f$ low-frequency rising noise voltage (see for example Figures 5.53 and 5.54).

That's the good news. The bad news is that the switching action produces noise-spectra peaks at the switching frequency and its harmonics (Figure 5.51), superposed on a low-frequency noise voltage floor that is already considerably higher than that of conventional low-noise op-amps (compare Table 5.6 on page 335 with Table 5.5 on pages 320-321). The input switching circuitry also results in relatively high input noise current, compared with low-noise precision JFET-input op-amps.

Auto-zero op-amps are built with CMOS, and (except for some legacy parts) are generally limited to low supply voltages ( $\leq 7 \mathrm{~V}$ total supply). A shining exception is the recent LTC2057HV ( 4.75 V to 60 V total supply!). Another caution: because of their internal voltage-storage
correction capacitors, auto-zero op-amps can exhibit slow recovery from saturation, as long as several milliseconds.

#### I|J. Difference, Differential, and Instrumentation Amplifiers: Taxonomy.

These share the property of accurate and stable differential gain, with high common-mode rejection: $V_{\text {out }}=G_{\mathrm{V}} \Delta V_{\text {in }}=G_{\mathrm{V}}\left(V_{\text {in }+}-V_{\text {in }-}\right)$. In common usage, the terms are distinguished as follows.
Difference amplifier. Differential-in, single-ended out; op-amp plus two matched resistor pairs (Figure 5.65, §5.14); CMRR $90-100 \mathrm{~dB}$; accurate but low gain ( $G_{V}=0.1-10$ ); input impedance $25-100 \mathrm{k}$, intended to be driven by a low impedance; inputs typically can go beyond rails.
Instrumentation amplifier. Differential-in, single-ended out; very high input impedance ( $10 \mathrm{M} \Omega$ to $10 \mathrm{G} \Omega$ ), wide gain range ( $G_{V}=1-1000$ ), and very high CMRR at higher gains ( $110-140 \mathrm{~dB}$ at $G_{\mathrm{V}}=100$ ); see $\S 5.15$ and Figure 5.77.
Fully differential amplifier. Differential or single-ended in, differential-out; most are low voltage, fast-settling, and wideband; ideal for twisted-pair cable drivers and fast differential-input ADCs; see §5.17.

#### ПK. Difference Amplifiers.

The classic difference amplifier, typified by the original INA105 (see Table 5.7 on page 353, §5.14), consists of an op-amp plus a pair of matched resistor dividers, with SENSE and REF inputs (at the bottom of the divider strings) in addition to the $V_{\text {in }+}$ and $V_{\text {in }-}$ signal inputs. With REF grounded and SENSE tied to the output, the gain is $G_{\text {diff }}=V_{\text {out }} / \Delta V_{\mathrm{in}}=R_{\mathrm{f}} / R_{\mathrm{i}}$, where $R_{\mathrm{f}}$ and $R_{\mathrm{i}}$ are the feedback and input resistors, respectively. Figure 5.66 shows circuit variations that exploit alternative connections of the SENSE and REF pins.

Difference amplifiers are simple, and good enough for many applications. Some permit common-mode inputs well beyond the rails (e.g., $\pm 200 \mathrm{~V}$ for the INA117). But difference amplifiers suffer from relatively low input impedance (tens of $\mathrm{k} \Omega$ ), limited gain (typically in the range of $G=1-10$ ), relatively high noise voltage, unimpressive CMRR (typically $\lesssim 90 \mathrm{~dB}$ ), and degradation of both gain and CMRR when driven with signals of non-zero source impedance.

#### IL. Instrumentation Amplifiers.

These drawbacks are nicely remedied in the instrumentation amplifier configuration of three op-amps (Figure 5.77, §5.15). The input impedance is high ( $10 \mathrm{M}-1 \mathrm{~T} \Omega$ ), and the gain (which can be as large as $\times 1000$ ) is set with a single external resistor (or pin-selectable choice of internal resistors). When configured for high gain, most instrumentation amplifiers deliver a typical CMRR around 120 dB , and an input noise voltage $e_{\mathrm{n}}$ less than $10 \mathrm{nV} / \sqrt{\mathrm{Hz}}$; they do not permit common-mode outputs beyond the rails. Instrumentation amplifiers are available in BJT, JFET, MOSFET, auto-zero, and programmable-gain types; see Tables 5.8 on page 363 and 5.9 on pages 370-371.

#### †M. Fully Differential Amplifiers.

Unlike difference amplifiers and instrumentation amplifiers, fully differential amplifiers (\$5.17) generate a balanced differential output centered on a settable commonmode voltage. This is useful for driving fast ADCs with complementary inputs, balanced transmission lines, and RF communication circuits. Befitting these applications, they tend to be wideband (up to 1 GHz or more), high slewrate ( $1000 \mathrm{~V} / \mu$ s or more), fast settling (a few nanoseconds), and quiet ( $5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ or less). There are many internal circuit topologies (labeled A-G in §5.17); see Table 5.10 for a representative selection.

# 6. FILTERS

## 6.1 Introduction

With only the techniques of transistors and op-amps it is possible to delve into a number of interesting areas of linear (as contrasted with digital) circuitry. We believe that it is important to spend some time doing this now, in order to strengthen understanding of some of these difficult concepts (transistor behavior, feedback, op-amp limitations, etc.) before introducing more new devices and techniques and getting into the large area of digital electronics. Therefore, in this chapter we treat the topic of filters, and particularly active filters. The latter use resistors and capacitors, in combination with amplifiers (usually op-amps), to produce filters with well-defined frequency response. As we'll see, these filters (along with the classic $L C$ passive filters that they can emulate) can be much sharper than the simple $R C$ filters we saw in Chapter 1.

The three following chapters will continue with additional topics in analog electronics: Chapter 7 (Oscillators and timers), Chapter 8 (Low-noise techniques), and Chapter 9 (Voltage regulation and power conversion). Then, following two chapters on digital logic, we revisit analog electronics, happily harmonized with the intervening digital teachings, in Chapter 12 (Logic interfacing), Chapter 13 (Digital meets analog), and Chapter 15 (Microcontrollers).

## 6.2 Passive filters

In Chapter 1 we began a discussion of filters made from resistors and capacitors. Those simple $R C$ filters produced gentle highpass or lowpass gain characteristics, with a $6 \mathrm{~dB} /$ octave falloff well beyond the -3 dB point. By cascading highpass and lowpass filters, we showed how to obtain bandpass filters, again with gentle $6 \mathrm{~dB} /$ octave "skirts." Such filters are sufficient for many purposes, especially if the signal being rejected by the filter is far removed in frequency from the desired signal passband. Some examples are bypassing of radiofrequency signals in audio circuits, "blocking" capacitors for elimination of dc levels, and separation of modulation from a communications "carrier."

### 6.2.1 Frequency response with RC filters

Often, however, filters with flatter passbands and steeper skirts are needed. This happens whenever signals must be filtered from other interfering signals nearby in frequency. The obvious next question is whether or not (by cascading a number of identical lowpass filters, say) we can generate an approximation to the ideal "brick-wall" lowpass frequency response, as in Figure 6.1.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0424.jpg?height=258&width=353&top_left_y=973&top_left_x=1298)

Figure 6.1. Ideal brick-wall lowpass filter.
We know already that simple cascading won't work, because each section's input impedance will seriously load the previous section, degrading the response. But with buffers between each section (or by arranging to have each section of much higher impedance than the one preceding it), it would seem possible. Nonetheless, the answer is no. Cascaded $R C$ filters do produce a steep ultimate falloff, but the "knee" of the curve of response versus frequency is not sharpened. We might restate this as "many soft knees do not a hard knee make." To make the point graphically, we plotted some graphs of gain response (i.e., $V_{\text {out }} / V_{\text {in }}$ ) versus frequency for lowpass filters constructed from $1,2,4,8$, 16, and 32 identical $R C$ sections, perfectly buffered (Figure 6.2).

The first graph shows the effect of cascading several $R C$ sections, each with its 3 dB point at unit frequency. As more sections are added, the overall 3 dB point is pushed downward in frequency, as you could easily have predicted. ${ }^{1}$ To compare filter characteristics fairly, the rolloff

[^293]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0425.jpg?height=1810&width=754&top_left_y=207&top_left_x=141)

Figure 6.2. Frequency responses of multisection $R C$ filters. Graphs $A$ and $B$ are linear plots, whereas $C$ is logarithmic. The filter responses in $B$ and $C$ have been normalized (or scaled) for 3 dB attenuation at unit frequency.
frequencies of the individual sections should be adjusted so that the overall 3 dB point is always at the same frequency. For this reason, the other graphs in Figure 6.2 are all "normalized" in frequency, meaning that the -3 dB point (or breakpoint, however defined) is at a frequency of 1 radian per second (or at 1 Hz ). To determine the response of a filter whose breakpoint is set at some other frequency, simply multiply the values on the frequency axis by the actual breakpoint frequency $f_{\mathrm{c}}$. In general, we will also stick with the log-log graph of frequency response when talking about filters because it tells the most about the frequency response. It lets you see the approach to the ultimate rolloff slope, and it permits you to read off accurate values of attenuation. In this case (cascaded $R C$ sections), the normalized graphs in Figures 6.2B and 6.2C demonstrate the soft knee characteristic of passive $R C$ filters.

It's interesting to look also at the phase shift of an $R C$ lowpass cascade, again adjusted to put the overall 3 dB points at unit frequency; these are plotted in Figure 6.3. The lagging phase shift reaches $90^{\circ} \times n$ asymptotically, for $n$ cascaded sections, as you might expect (recall the smooth transition from $0^{\circ}$ to $90^{\circ}$ lagging phase shift of a single $R C$ section, Figure 1.104). Perhaps non-intuitively, however, the phase shift at the 3 dB point grows progressively with larger cascades. Phase-shift characteristics are important, as we'll see presently, because they determine the filter's in-band waveform distortion.

## A. Degradation of ultimate attenuation: non-ideal capacitors

Unlike ideal capacitors, real capacitors exhibit some extra "parasitic" elements - most prominently an effective series resistance (ESR) and an effective series inductance (ESL). So at very high frequencies (where the capacitor's ESR becomes comparable to the capacitive reactance $1 / \omega C$ ) a real $R C$ filter stops rolling off. We modeled this by using SPICE (see Appendix J) for the cascaded multisection $R C$ filter, see Figure 6.4. For this comparison we assumed that you want to do some $R C$ filtering of a dc rail that supplies a low-level stage, to suppress higher frequency switching noise, coupled signals, and the like. So we gave ourselves a "budget" of $100 \Omega$ total series resistance (consistent with a load current of a few milliamps); and we limited ourselves to $20 \mu \mathrm{~F}$ total capacitance (to maintain reasonable physical size). Then we ran simulations of three filters: a single $100 \Omega, 20 \mu \mathrm{~F} R C$ stage; a 2-section filter with $50 \Omega$ and $10 \mu \mathrm{~F}$ in each section; and a 4-section filter with $25 \Omega$ and $5 \mu \mathrm{~F}$ in each section. We ran plots of the response of these three filters, first with perfect capacitors (no ESR), then
with realistic ESR values, taken from capacitor datasheets (e.g., $1 \Omega$ for a $5 \mu \mathrm{~F}$ electrolytic capacitor rated at 100 V ).

You can see the effect of the series resistance, namely a loss of ultimate attenuation at high frequencies, where the impedance of the capacitors asymptotes to the ESR value, rather than continuing to fall as $1 / f$. Nevertheless, it is clear that spreading the total capacitance into several filter sections makes good sense.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0426.jpg?height=552&width=802&top_left_y=579&top_left_x=219)

Figure 6.3. Phase shift versus frequency for the multisection $R C$ lowpass filters of Figure 6.2C.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0426.jpg?height=537&width=799&top_left_y=1298&top_left_x=218)

Figure 6.4. Real capacitors include some irreducible series resistance, which limits the ultimate attenuation of $R C$ filters. This SPICE simulation compares ideal (dotted curves) and real (solid curves) cascaded $R C$ lowpass filters.

### 6.2.2 Ideal performance with LC filters

As we pointed out in Chapter 1, filters made with inductors and capacitors can have very sharp responses (§1.7.14). We discussed the parallel $L C$ resonant circuit as an example, as
well as the series $L C$ trap. And we showed a dramatic comparison of an $R C$ and an $L C$ lowpass filter, each with the same 1 MHz cutoff frequency (Figure 1.112). By including inductors in the design, it is possible to create filters with any desired flatness of passband combined with sharpness of transition and steepness of falloff outside the band. Figure 6.5 shows an example of a telephone filter and its stunning bandpass characteristics. ${ }^{2}$

Obviously the inclusion of inductors into the design brings about some magic that cannot be performed without them. In the terminology of network analysis, that magic consists of the use of "off-axis poles" (see Chapter $1 x$ ). Even so, the complexity of the filter increases according to the required flatness of passband and steepness of falloff outside the band, accounting for the large number of components used in the preceding filter. The transient response and phase-shift characteristics are also generally degraded as the amplitude response is improved to approach the ideal brick-wall characteristic.

### 6.2.3 Several simple examples

The impressive Orchard and Sheahan filter of Figure 6.5 is a frighteningly complex design, showing what can be done with sophisticated classic $L C$ filter synthesis. ${ }^{3}$ But you don't have to be a filter wizard to make "good enough" filters ${ }^{4}$ that solve most of the problems you are likely to

[^294]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0427.jpg?height=289&width=1304&top_left_y=345&top_left_x=116)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0427.jpg?height=435&width=327&top_left_y=219&top_left_x=1454)

Figure 6.5. Left: An unusually good $L C$ bandpass filter (inductances in mH , capacitances in pF ). Right: measured response of the filter circuit. The admirably sharp frequency response comes at the expense of degraded phase response; see discussion in $\S 6.2 .5$. The 0 dB value in the response curve corresponds to $\sim 9 \mathrm{~dB}$ of loss, assuming 10 k source and load impedances.
encounter. Here we show three simple filters that we used in recent designs at our radiotelescope observatory.

#### A. Sinewave from digital square wave

With digital electronics it is very easy to make and manipulate pulses or square waves of precise frequency. But at our observatory we wanted sine waves, not square waves. Figure 6.6 shows a simple way to produce a sinewave output from a fixed-frequency square wave, namely the use of a tuned series $L C$. It behaves like a very low impedance at resonance ${ }^{5}\left(f_{0}=1 / 2 \pi \sqrt{L C}\right)$, rising on either side (asymptotically as $1 / f$ at low frequencies, and as $f$ at high frequencies).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0427.jpg?height=302&width=799&top_left_y=1410&top_left_x=126)

Figure 6.6. A series $L C$ bandpass filter converts a square wave into a sinewave suitable for driving a $50 \Omega$ load.

Here we chose the product $L C$ for resonance at 1.0 MHz , and the value of $L$ such that its impedance at 3 MHz (the next frequency component of a 1 MHz square wave, which has only odd harmonics) is large compared with the $50 \Omega$ load impedance. For $L_{1}=100 \mu \mathrm{H}$, the reactance at 3 MHz is $X_{\mathrm{L}}=2 \pi f L \approx 2 \mathrm{k} \Omega$ 。

Figure 6.7 shows the measured performance. The slight bowing of the square wave is due to loading by the filter

[^295]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0427.jpg?height=402&width=802&top_left_y=840&top_left_x=974)

Figure 6.7. Input (lower trace) and output (upper trace) of the series $L C$ bandpass (sinewave) filter of Figure 6.6, loaded with $50 \Omega$. Vertical: $1 \mathrm{~V} /$ div (top trace), $5 \mathrm{~V} / \mathrm{div}$ (bottom trace). Horizontal: $400 \mathrm{~ns} / \mathrm{div}$.
and $50 \Omega$ load. We included a simple $R C$ prefilter to slow the rise time, because the very fast edges of the square wave coupled through the parasitic shunt capacitance of the inductor to cause small notches on the sinewave output. The " $3 \times$ 'HC04" designation refers to the type of digital logic component we used; see Chapter 10.

#### B. "Spur" removal

An elegant technique known as phase-locked loop (PLL) frequency synthesis, discussed later in Chapter 13 (§§13.13.6A and 13.13.6B), permits you to generate a desired precise frequency of your choosing, beginning with a standard "reference" frequency, for example 10.0 MHz . Figure 6.8 shows a portion of a 78.0 MHz PLL synthesizer we built, in block diagram form. The basic idea is to use a voltage-tunable oscillator (VCO), and compare an integer subdivision of its desired output frequency with a different subdivision of the reference frequency such that those frequencies will agree when the output frequency is correct. A frequency error produces a correction signal to steer the

VCO toward the correct oscillation frequency. Here we divided the 10 MHz reference by 50 (producing 200 kHz ), to be compared with the VCO's output after division by 390; those divided frequencies will agree when the VCO is oscillating at 78.0 MHz .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0428.jpg?height=682&width=802&top_left_y=460&top_left_x=219)

Figure 6.8. A series LC "trap" suppresses spurs at the 200 kHz reference frequency in this phase-locked loop (PLL) oscillator.

We engineered a simple but quite good JFET oscillator (shown later, in Figure 7.29), with its output energy almost entirely at its central frequency. It was so "clean" that the dominant undesired component of its output was a bit of residual energy at $78.0 \mathrm{MHz} \pm 0.2 \mathrm{MHz}$, caused by the 200 kHz internal comparison frequency. The simple cure here was to put a series $L C$ trap, tuned to 200 kHz , across the analog tuning voltage, as shown. The three other components ( $R_{1} R_{2} C_{1}$ ) form the classic PLL loop filter, as we'll see in §13.13.

#### C. Anti-alias lowpass filter

An analog waveform can be digitized, by sampling its amplitude periodically and converting each sample to a numeric quantity. We'll see later (Chapter 13, e.g., Figure 13.60) that the process can introduce artifacts, both from the finite accuracy with which the amplitudes are quantized, and from the finite rate at which those samples are taken. These artifacts can be suppressed, to any required degree, by adequate choice of quantization depth (amplitude accuracy) and rate (sampling frequency).

The important fact, for this filter example, is that the signal being digitized must not contain signals whose frequency exceeds half the sampling rate $f_{\mathrm{S}}$; this is known as
the Nyquist criterion. ${ }^{6}$ The usual way this is accomplished is by passing the predigitized signals through a lowpass "anti-aliasing" filter, whose cutoff ensures thorough attenuation of signals above the Nyquist frequency $f_{\mathrm{S}} / 2$. This usually requires a sharp filter cutoff, because otherwise you would have to go to a much higher sampling rate to escape signals that pass through the soft cutoff; furthermore you want a filter that is flat throughout the desired signal passband.

In this radiotelescope receiver example (Figure 6.9) we use a mixer (a device that multiplies two signals together to produce its output) to convert a 2 MHz band of signal frequencies centered on 78 MHz (the "IF" band) to a band centered on dc (known as "baseband"). A mixer can do this sort of frequency shifting, because the product of two sinusoids is a pair of waves at the sum and difference frequencies: $\cos \left(\omega_{1} t\right) \cos \left(\omega_{2} t\right)=\frac{1}{2}\left\{\cos \left(\omega_{1}-\omega_{2}\right) t+\right.$ $\left.\cos \left(\omega_{1}+\omega_{2}\right) t\right\}$. Here the signal band drives one input to the mixer, and a fixed oscillator at 78 MHz (the "local oscillator," or LO) drives the other input. The difference frequency at the output of the mixer is the baseband, ${ }^{7}$ in which the band from dc to 1 MHz contains the signals we want to digitize in this example. ${ }^{8}$

Here we amplified the baseband, then passed it through a serious anti-aliasing filter, specifically a " 7 -section $L C$ Chebyshev lowpass filter with 1.0 MHz cutoff frequency and 0.1 dB peak-to-peak ripple."9 We designed the filter with a weird input and output impedance ( $378 \Omega$ ) to take advantage of standard value tunable inductors. The filter removes signal components above 1 MHz , and this filtered baseband is then amplified (again) and digitized (by the device labeled ADC - analog-to-digital-converter) at a sampling rate of 2.5 Msps (megasamples/s). The corresponding Nyquist frequency of 1.25 MHz is well into the stopband of the very sharp lowpass filter; in fact, the calculated and measured performance are in close agreement, demonstrating that the input signals are reduced by 20 dB at that
${ }^{6}$ Violating this rule produces aliasing, the creation, in the digitized output, of nonexistent in-band frequency components; see §13.5.1B.
7 The sum frequency, centered on 156 MHz , is discarded in subsequent filtering.
${ }^{8}$ So we can Fourier transform them to get a radio spectrum. More precisely, the baseband contains frequencies from " -1 MHz " to +1 MHz , which a single mixer folds into a single dc -1 MHz band; but we recover the unfolded baseband by using a pair of mixers, driven with sine and cosine LO signals. The pair of filtered baseband signals, commonly called $I$ and $Q$ (for in-phase and quadrature), are individually digitized to create the complex input time series to the (complex) Discrete Fourier Transform.
${ }^{9}$ This is the filter we used for the linear swept response of Figure 1.112.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0429.jpg?height=429&width=1370&top_left_y=214&top_left_x=264)

Figure 6.9. A sharp 7 -section $L C$ lowpass filter prevents aliasing in this radioastronomy receiver by eliminating any signal frequencies above the Nyquist frequency ( 1.25 MHz , or half the sampling rate). We built 126 of these puppies; see the photograph in Figure 1.111.
frequency and that the worst-case aliased signals (at 1.5 MHz ) are reduced by an additional 16 dB . This is stunning performance for a filter that is easily designed and constructed, especially when compared with an $R C$ filter of similar component count, where the attenuation at $1.25 f_{\mathrm{c}}$ is just 1.6 dB relative to that at $f_{\mathrm{c}}$; Figures 6.10 and 6.11 make the comparison graphically.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0429.jpg?height=575&width=789&top_left_y=1121&top_left_x=126)

Figure 6.10. The abrupt cutoff of the 7 -section $L C$ filter of Figure 6.9 compared with the soft rolloff of a 7 -section $R C$ filter with the same 1 MHz cutoff.

#### D. Passive differential filter

Most high-frequency ADCs have differential inputs, see §13.6.2, and many require a low input-signal source impedance, terminated in many cases by a differential capacitor. We discussed low-impedance high-frequency differential-output amplifiers in §5.17, where, for example, Figure 5.102 shows a differential lowpass filter consisting of two $50 \Omega$ resistors and a 100 pF capacitor, as specified for the AD9225 25 MSps ADC (see also Figure 13.28).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0429.jpg?height=514&width=792&top_left_y=789&top_left_x=979)

Figure 6.11. The same filter pair of Figure 6.10, here plotted on a linear scale. The Chebyshev's passband "ripple" (of $+0 \mathrm{~dB} /-0.1 \mathrm{~dB}$, or $\pm 0.6 \%$ in amplitude) is more easily seen, but the details of stopband attenuation are lost.

Frequently you'll want an anti-alias filter between the amplifier and the ADC input. For example, if the sampling frequency is 25 MHz , you may want a steep rolloff input filter starting at 10 MHz . Texas Instruments has a nice application note describing how to convert a single-ended filter to differential form (SLWA053B: Design of differential filters for high-speed signal chains, available at www.ti.com).

### 6.2.4 Enter active filters: an overview

The synthesis of filters from passive components ( $R, L$, and $C$ ) is a highly developed subject, with a rich literature of traditional handbooks (e.g., the authoritative work by Zverev; see Appendix N), now supplemented by elegant software tools that make such designs a routine task. However, inductors as circuit elements frequently leave much to be desired. They are often bulky and expensive, and they depart from the ideal by being "lossy," i.e., by having
significant series resistance, as well as other "pathologies" such as nonlinearity, distributed winding capacitance, and susceptibility to magnetic pickup of interference. Furthermore, the inductances needed for low-frequency filters may dictate unmanageably large components. Finally, classic filters made with $L$ 's and $C$ 's are not electrically tunable.

What is needed is a way to make inductorless filters with the characteristics of ideal RLC filters. Ideally we might hope for tunability, either by an analog tuning voltage or a varying pulse frequency.

By using op-amps as part of the filter design, we can synthesize any RLC filter characteristic without using inductors. Such inductorless filters are known as active filters because of the inclusion of an active element (the amplifier). We'll see another class of active filter - the switched capacitor filter - that adds MOSFET switches to produce, in effect, a frequency-tunable resistor. These deliver performance similar to that of the standard active filter (sometimes called a "continuous-time" filter), but with the added feature of precise tuning of its characteristic frequency breakpoints (with an externally applied clocking frequency) over a wide range. (This tunability comes at a price, though, namely some switching noise and a reduced dynamic range; see §6.3.6.)

Active filters can be used to make lowpass, highpass, bandpass, and band-reject filters, with a choice of filter types according to the important features of the response, e.g., maximal flatness of passband, steepness of skirts, or uniformity of time delay versus frequency (more on this shortly). In addition, "allpass filters" with flat amplitude response but tailored phase versus frequency can be made (they're also known as "delay equalizers"), as well as the opposite - a filter with constant phase shift but tailored amplitude response.

#### A. Negative-impedance converter, gyrator, and generalized impedance converter

Three interesting circuit elements that should be mentioned in any overview are the negative-impedance converter (NIC), the gyrator, and the generalized impedance converter ${ }^{10}$ (GIC). These devices can mimic the properties of inductors while using only resistors and capacitors in addition to op-amps.

Once you can do that, you can build inductorless filters with the ideal properties of any RLC filter, thus providing at least one way to make active filters.

[^296]
#### B. Negative-impedance converter

The NIC converts an impedance to its negative, whereas the gyrator converts an impedance to its inverse. The following exercises will help you discover for yourself how that works out.

Exercise 6.1. Show that the circuit in Figure 6.12 is a negativeimpedance converter, in particular that $Z_{\text {in }}=-Z$. Hint: apply some input voltage $V$ and compute the input current $I$. Then take the ratio to find $Z_{\text {in }}=V / I$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0430.jpg?height=368&width=470&top_left_y=650&top_left_x=1301)

Figure 6.12. Negative-impedance converter.
The NIC therefore converts a capacitor to a "backward" inductor:

$$
\begin{equation*}
Z_{\mathrm{C}}=1 / j \omega C \rightarrow Z_{\text {in }}=j / \omega C, \tag{6.1}
\end{equation*}
$$

i.e., it is inductive in the sense of generating a current that lags the applied voltage, but its impedance has the wrong frequency dependence (it goes down, instead of up, with increasing frequency).

#### C. Gyrator

The gyrator, on the other hand, converts a capacitor to a true inductor:

$$
\begin{equation*}
Z_{\mathrm{C}}=1 / j \omega C \rightarrow Z_{\text {in }}=j \omega C R^{2} \tag{6.2}
\end{equation*}
$$

i.e., an inductor with inductance $L=C R^{2}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0430.jpg?height=381&width=597&top_left_y=1738&top_left_x=1176)

Figure 6.13. Gyrator implemented with NICs.
The existence of the gyrator makes it intuitively reasonable that inductorless filters can be built to mimic any filter
using inductors by simply replacing each inductor with a gyrated capacitor. ${ }^{11}$ The use of gyrators in just that manner is perfectly OK ; and in fact the telephone filter illustrated previously, though designed as a classic $L C$ filter, was implemented with gyrators (in a configuration known as a Riordan gyrator, which looks different from Figure 6.13). In addition to simple gyrator substitution into pre-existing $R L C$ designs, it is possible to synthesize many other filter configurations.

Exercise 6.2. Show that the circuit in Figure 6.13 is a gyrator, in particular that $Z_{\text {in }}=R^{2} / Z$. Hint: you can analyze it as a set of voltage dividers, beginning at the right.

#### D. Generalized impedance converter

The configuration of Figure 6.14 is known as a generalized impedance converter ${ }^{12}$ (GIC); it multiplies the impedance attached at $Z_{5}$ by the factor $Z_{1} Z_{3} / Z_{2} Z_{4}$. So, for example, if you put a capacitor at $Z_{4}$, and resistors everywhere else, you get an inductor whose value is $L=\left(R_{1} R_{3} R_{5} / R_{2}\right) C$; that is, it becomes a gyrator. But you can do more amusing things with a GIC: for example, if you put capacitors at $Z_{3}$ and $Z_{5}$, you wind up with a frequency-dependent negative resistor (FDNR). Filter implementations with GICimplemented FDNRs have been popular in the audio design field, where it is claimed that they have superior noise and distortion characteristics compared with something like a Sallen-and-Key filter (next section). The field of inductorless filter design is both lively and rich with detail, with new designs appearing in the journals every month.

#### Performance limits

As with any op-amp circuit, the performance of gyrators and GICs at high frequencies depends on the op-amp's bandwidth (and other characteristics). So a GIC configured as an inductor (capacitor at $Z_{4}$, resistors elsewhere) will stop looking like an inductor at frequencies greater than a few percent of the op-amp's bandwidth $f_{\mathrm{T}}$. The simulation results in Figure 6.15 show the kind of behavior you'll see. Roughly speaking, the nearly perfect inductor (at low frequencies) becomes something approximating a capacitor at high frequencies, with a resonance in between. ${ }^{13}$ This may look ugly, on this extended graph; but notice that the "inductor" appears to have an astonishingly high quality factor

[^297]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0431.jpg?height=634&width=825&top_left_y=219&top_left_x=950)

Figure 6.14. Generalized impedance converter. If $Z_{4}$ is a capacitor, the circuit behaves like an inductor, with value as shown. From A. Antoniou, IEE Proc., 116, 1838-1850 (1969).
$Q$ of about $2 \times 10^{5}$ at 1 kHz if you assume that the $4.6 \mathrm{~m} \Omega$ impedance floor on the graph properly represents the inductor's loss (i.e., equivalent series resistance, ESR). (In reality there are other losses, so realizable $Q$ values are in the range of 1000... still pretty darn good for an inductor that's a fraction of a henry !). And, for the highest-bandwidth op$\operatorname{amp}\left(f_{\mathrm{T}}=50 \mathrm{MHz}\right.$ ) the capacitance is just 2.3 pF ; you could never make a 160 mH inductor with such a tiny "winding capacitance," nor with such a high self-resonant frequency.

Gyrators are used in real-world filters: in an App Note, Texas Instruments suggests using multiple GIC stages to make anti-alias filters. ${ }^{14}$ And Stanford Research Systems uses four GIC stages acting as an $R+L C$ ladder to make an 8-zero 9-pole elliptical lowpass filter for their SR830 DSPbased lock-in amplifier, "so that all frequency components greater than half the sampling frequency are attenuated by at least 96 dB ." The A/D samples at 256 kHz and the filter passes signals from dc to 102 kHz ; they've allowed themselves a 25\% frequency margin to get the attenuation down to $96 \mathrm{~dB} .{ }^{15}$ The full schematic of the filter is included in the

[^298]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0432.jpg?height=695&width=756&top_left_y=214&top_left_x=239)

Figure 6.15. Finite op-amp bandwidth degrades the ideal GIC inductor, which becomes capacitive at frequencies beginning at a small fraction of $f_{\mathrm{T}}$, as seen in these plots derived from SPICE simulations. When compared with a physical inductor, with its winding capacitance and self-resonant frequency, the GIC inductor's analogous capacitance and self-resonant frequency (which depend on the op-amp's bandwidth) can be significantly better, as suggested in these plots (which, however, are predicated on the use of an ideal capacitor).
instrument's wonderfully informative manual - a hallmark of all SRS products.

#### E. Sallen-and-Key filter

Figure 6.16 shows an example of a simple and even partly intuitive filter topology, an example of which we saw earlier in §4.3.6. These are known as Sallen-and-Key filters, after the inventors. ${ }^{16}$ The unity-gain amplifier can be an op-amp connected as a follower, or just an emitter follower or source follower. The particular filters shown are 2-pole lowpass and highpass filters. Taking the example of the lowpass filter (Figure 6.16A), note that it would be simply two cascaded $R C$ lowpass filter sections, except for the fact that the bottom of the first capacitor is bootstrapped by the output. It is easy to see that at very high frequencies it falls off just like a cascaded $R C$, because the output is essentially

[^299]zero. As the output rises at decreasing frequency, however, the bootstrap action tends to reduce the attenuation, giving a sharper knee. Of course, such hand-waving cannot substitute for honest analysis, which luckily has already been done for a prodigious variety of nice filters. We will come back to active filter circuits in $\S 6.3$, after a short introduction to filter performance parameters and filter types.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0432.jpg?height=563&width=587&top_left_y=527&top_left_x=1181)

Figure 6.16. Sallen-and-Key lowpass and highpass active filters. The ultimate performance of these simple-looking filters is affected by the non-zero output impedance of the follower, see Figure 6.36.

### 6.2.5 Key filter performance criteria

There are some standard terms that keep appearing when we talk about filters and try to specify their performance. It is worth getting it all straight at the beginning.

#### A. Frequency domain

The most obvious characteristic of a filter is its gain versus frequency, typified by the sort of lowpass characteristic shown in Figure 6.17.

The passband is the region of frequencies that are relatively unattenuated by the filter. Most often the passband is considered to extend to the -3 dB point, but with certain filters (most notably the "equiripple" types) the end of the passband may be defined somewhat differently. Within the passband the response may show variations or ripples, defining a ripple band, as shown. The cutoff frequency, $f_{c}$, is the end of the passband. The response of the filter then drops off through a transition region (also colorfully known as the skirt of the filter's response) to a stopband, the region of significant attenuation. The stopband may be defined by some minimum attenuation, e.g., 40 dB .

Along with the gain response, the other parameter of importance in the frequency domain is the phase shift of the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0433.jpg?height=845&width=802&top_left_y=210&top_left_x=119)

Figure 6.17. Filter characteristics versus frequency.
output signal relative to the input signal. In other words, we are interested in the complex response of the filter, which usually goes by the name of $\mathbf{H}(\mathbf{s})$, where $\mathbf{s}=j \omega$, and $\mathbf{H}$ and $\mathbf{s}$ are complex. Phase is important because a signal entirely within the passband of a filter will emerge with its waveform distorted if the time delay of different frequencies in going through the filter is not constant. Constant time delay corresponds to a phase shift increasing linearly with frequency ( $\Delta t=-d \phi / d \omega=-\frac{1}{2 \pi} d \phi / d f$ ); hence the term linear-phase filter applied to a filter that is ideal in this respect. Figure 6.18 shows a typical graph of amplitude response and phase shift for a lowpass filter that is definitely not a linear-phase filter. Graphs of phase shift versus frequency are best plotted on a linear frequency axis.

#### B. Time domain

As with any ac circuit, filters can be described in terms of their time-domain properties: rise time, overshoot, ringing, and settling time. This is of particular importance where steps or pulses may be present. Figure 6.19 shows a typical lowpass-filter step response. Here, rise time is, as usual, the time required to go from $10 \%$ to $90 \%$ of the final value. Of greater interest is the settling time, which is the time required to get within some specified amount of the final value and stay there. The delay time is the time duration from the input step to the output reaching
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0433.jpg?height=488&width=697&top_left_y=218&top_left_x=1019)

Figure 6.18. Phase shift (lagging) and amplitude response for an 8 -pole Chebyshev lowpass filter ( 2 dB passband ripple). The normalization shown is conventional: 0 dB corresponds to the top of the ripple band, and the cutoff (or "critical") frequency is the frequency at which the response leaves the ripple band. The filter's actual dc gain is unity ( 0 dB ); for even-order filters (like this one) the ripple rises from dc, whereas for odd-order filters the ripple drops from dc.
$50 \%$ of its final value. ${ }^{17}$ Overshoot and ringing are selfexplanatory terms for some undesirable properties of filters. The phase-shifting characteristics of filters imply a corresponding time delay, which you sometimes see plotted (or tabulated) as group delay versus frequency. ${ }^{18}$

### 6.2.6 Filter types

Suppose you want a lowpass filter with flat passband and sharp transition to the stopband. The ultimate rate of falloff, well into the stopband, will always be $6 \mathrm{ndB} /$ octave, where $n$ is the number of "poles." You need one capacitor (or inductor) for each pole, so the required ultimate rate of falloff of filter response determines, roughly, the complexity of the filter.

Now, assume that you have decided to use a 6-pole lowpass filter. You are guaranteed an ultimate rolloff of $36 \mathrm{~dB} /$ octave at high frequencies. It turns out that the filter design can now be optimized for maximum flatness of passband response, at the expense of a slow transition from passband to stopband. Alternatively, by allowing some

[^300]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0434.jpg?height=550&width=795&top_left_y=220&top_left_x=220)

Figure 6.19. Time-domain filter characteristics. A simple $R C$ lowpass filter, for example, would have no overshoot or ringing, and would be characterized by a rise time of $t_{\mathrm{r}}=2.2 R C\left(\approx 0.35 / f_{3 \mathrm{~dB}}\right)$, a delay time of $t_{\mathrm{d}}=0.69 R C$, and a settling time (to $1 \%$ ) of $t_{\mathrm{s}}=4.6 R C$.
ripple in the passband characteristic, the transition from pass-band to stopband can be steepened considerably. A third criterion that may be important is the ability of the filter to pass signals within the passband without distortion of their waveforms caused by phase shifts. You may also care about rise time, overshoot, and settling time. Generally speaking, you've got to make tradeoffs among these characteristics - a filter with a sharp cutoff will exhibit poor time-domain properties such as ringing and phase shifts.

There are filter designs available to optimize each of these characteristics, or combinations of them. In fact, rational filter selection will not be carried out as just described; rather, it normally begins with a set of requirements on passband flatness, attenuation at some frequency outside the passband, and whatever else matters. You will then choose the best design for the job, using the number of poles necessary to meet the requirements. ${ }^{19}$ In the next few sections we introduce the three popular classics - the Butterworth filter (maximally flat passband), the Chebyshev filter (steepest transition from passband to stopband), and the Bessel filter (maximally flat time delay). Each of these filter responses can be produced with a variety of different filter circuits, some of which we discuss later. They are

[^301]all available in lowpass, highpass, bandpass, and band-stop (notch) versions. ${ }^{20}$

#### A. Butterworth and Chebyshev filters

The Butterworth filter produces the flattest passband response, at the expense of steepness in the transition region from passband to stopband. As you will see later, it has only mediocre phase and transient characteristics. The amplitude response is given by

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{1}{\left[1+\left(f / f_{\mathrm{c}}\right)^{2 n}\right]^{\frac{1}{2}}} \tag{6.3}
\end{equation*}
$$

where $n$ is the order of the filter (number of poles). Increasing the number of poles flattens the passband response and steepens the stopband falloff, as shown in Figure 6.20.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0434.jpg?height=575&width=725&top_left_y=850&top_left_x=1107)

Figure 6.20. Normalized lowpass Butterworth filter response curves. Note the improved attenuation characteristics for the higher-order filters.

The Butterworth filter trades off everything else for maximum flatness of response. It starts out extremely flat at zero frequency and bends over near the cutoff frequency $f_{\mathrm{c}}$ (which is usually the -3 dB point).

In most applications, all that really matters is that the wiggles in the passband response be kept less than some amount, say 1 dB . The Chebyshev filter responds to this reality by allowing some ripples throughout the passband, with greatly improved sharpness of the knee (compared with the "maximally flat" Butterworth, for example). A Chebyshev filter is specified in terms of its number of poles

[^302]and passband ripple. By allowing greater passband ripple, you get a sharper knee. The amplitude is given by
\$\$

$$
\begin{equation*}
\frac{V_{\mathrm{out}}}{V_{\mathrm{in}}}=\frac{1}{\left[1+\varepsilon^{2} C_{n}^{2}\left(f / f_{\mathrm{c}}\right)\right]^{\frac{1}{2}}} \tag{6.4}
\end{equation*}
$$

\$\$
where $C_{n}$ is the Chebyshev polynomial of the first kind of degree $n$, and $\varepsilon$ is a constant that sets the passband ripple. Like the Butterworth (but in even greater degree), the Chebyshev has phase and transient characteristics that are far from ideal.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0435.jpg?height=1213&width=749&top_left_y=623&top_left_x=146)

Figure 6.21. Comparison of some common 6-pole lowpass filters. The same filters are plotted on both linear and logarithmic scales. The actual gains of the filters are shown, rather than the "topadjusted" 0 dB convention.

Figure 6.21 presents graphs comparing the responses of Chebyshev and Butterworth 6-pole lowpass filters. As you can see, they're both tremendous improvements over a 6pole $R C$ filter.

As a practical reality, the Butterworth, with its "maximally flat" passband, may not be as attractive as it might
appear, since you are always accepting some variation in passband response anyway (with the Butterworth it is a gradual rolloff near $f_{\mathrm{c}}$, whereas with the Chebyshev it is a set of equal-amplitude ripples spread throughout the passband). Furthermore, active filters constructed with components of finite tolerance will deviate from the predicted response, which means that a real Butterworth filter will exhibit some passband ripple anyway. The graph in Figure 6.22 illustrates the effects of worst-case variations in resistor and capacitor values on filter response.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0435.jpg?height=493&width=690&top_left_y=667&top_left_x=1025)

Figure 6.22. The effect of component tolerance on active-filter performance.

Viewed in this light, the Chebyshev is a very rational filter design. It manages to improve the situation in the transition region by spreading equal-size ripples ${ }^{21}$ throughout the passband, the number of ripples increasing with the order of the filter. Even with rather small ripples (as little as 0.1 dB ) the Chebyshev filter offers considerably improved sharpness of the knee compared with the Butterworth. To make the improvement quantitative, suppose that you need a filter with flatness to 0.1 dB within the passband and 20 dB attenuation at a frequency $25 \%$ beyond the top of the passband. By actual calculation, that will require a 19-pole Butterworth, but only an 8-pole Chebyshev.

The idea of accepting some passband ripple in exchange for improved steepness in the transition region, as in the equiripple Chebyshev filter, is carried to its logical limit in the so-called elliptic (or Cauer) filter by trading ripple in both passband and stopband for an even steeper transition region than that of the Chebyshev filter. ${ }^{22}$ Such a filter does the job, if you are satisfied with an amplitude characteristic that reaches and maintains some minimum attenuation throughout the stopband (rather than continuing to fall

[^303]off with a $6 n \mathrm{~dB} /$ octave ultimate slope). The payback is a simpler filter, with better phase and amplitude characteristics (see below). With computer-aided design techniques, the design of elliptic filters is as straightforward as for the classic Butterworth and Chebyshev filters.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0436.jpg?height=509&width=812&top_left_y=526&top_left_x=219)

Figure 6.23. Specifying filter frequency-response parameters.
Figure 6.23 shows how you specify filter frequency response graphically. In this case (a lowpass filter) you indicate the allowable range of filter gain (i.e., the ripple) in the passband, the minimum frequency at which the response leaves the passband, the maximum frequency at which the response enters the stopband, and the minimum attenuation in the stopband. As an example, Figure 6.24 compares the responses for Chebyshev and elliptic lowpass filter implementations to meet a specified performance, here requiring an 11-pole Chebyshev or a 6-pole elliptic (to meet the same specifications with a Butterworth would require a 32 -pole implementation!). The simpler elliptic filter has the better phase characteristics, but its response does not continue to fall off monotonically with frequency once it has reached the specified stopband attenuation.

#### B. Bessel filter

As we've suggested, the amplitude versus frequency response of a filter does not tell the whole story. A filter characterized by a flat amplitude response may exhibit rapidly changing phase shifts, which produce unequal time delays for signals within its passband. The result is that a signal in the passband will suffer distortion of its waveform. In situations where the shape of the waveform is paramount, a linear-phase filter (or constant-time-delay filter) is desirable. A filter whose phase shift varies linearly with frequency is equivalent to a constant time delay for signals within the passband; i.e., the waveform is not distorted. The
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0436.jpg?height=491&width=799&top_left_y=219&top_left_x=1075)

Figure 6.24. Lowpass filter example: a 6-pole elliptic filter with both passband and stopband ripple (dashed curve) meets the performance specifications shown here, whereas you would need an 11-pole Chebyshev (which has ripple only in its passband) or a 32-pole Butterworth ("maximally flat" - no ripple in passband or stopband) to do as well.

Bessel filter (also called the Thomson filter) ${ }^{23}$ has maximally flat time delay within its passband in analogy with the Butterworth, which has maximally flat amplitude response.

To see the kind of improvement in time-domain performance you get with the Bessel filter, look at Figure 6.25 for a comparison of phase shift and time delay versus frequency for the Bessel filter compared with two classic filters that exhibit more abrupt frequency characteristics (Butterworth and Chebyshev). The poor time-delay performance of the Butterworth (and to a greater extent of the Chebyshev) gives rise to effects such as waveform distortion and overshoot when driven with pulse signals - see Figure 6.26. On the other hand, the price you pay for the Bessel's constancy of time delay is an amplitude response with even less steepness than that of the Butterworth or Chebyshev in the transition region between passband and stopband. An important point: adding sections to a Bessel filter (i.e., making it of higher order) does not significantly increase the steepness of transition into the stopband; it does, however, improve the phase linearity (constancy of time delay), as well as increasing the ultimate rate of falloff, reaching the usual $6 n \mathrm{~dB} /$ octave asymptotic limit (look ahead to Figure 6.30).

23 That's the legendary German mathematician Friedrich Bessel (17841846) who, though not a practicing circuit designer, developed the mathematics. The label Bessel-Thomson recognizes Thomson's application to filters: Thomson, W. E., "Delay Networks having Maximally Flat Frequency Characteristics," Proceedings of the Institution of Electrical Engineers, Part III, 96 44, pp. 487-490 (1949).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0437.jpg?height=1488&width=1654&top_left_y=210&top_left_x=117)

Figure 6.25. A. Phase shift vs. frequency for three lowpass filter types, each configured with a cutoff frequency of 1 kHz (vertical line). B. Time delay vs. frequency for the adjacent filters; note change of vertical-scale units and linear frequency axis. If you like normalized units, use $f / f_{\mathrm{c}}$ for the horizontal axes, and $t_{\mathrm{d}} / T$ for the time delay.

There are numerous filter designs that attempt to improve on the Bessel's good time-domain performance by compromising some of the constancy of time delay for improved rise time and amplitude-versus-frequency characteristics. The Gaussian filter has phase characteristics nearly as good as those of the Bessel, with improved step response. In another class there are interesting filters that allow uniform ripples in the passband time delay (in analogy with the Chebyshev's ripples in its amplitude response)
and yield approximately constant time delays even for signals well into the stopband; these are sometimes called simply "linear phase" filters, characterized with a parameter that sets the phase ripple (e.g., $0.5^{\circ}$ ) within the passband. Another approach to the problem of making filters with uniform time delays is to use allpass filters (also known as delay equalizers). These have constant amplitude response with frequency, with a phase shift that can be tailored to individual requirements. Thus they can be used to
improve the time-delay constancy of any filter, including Butterworth and Chebyshev types.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0438.jpg?height=1458&width=772&top_left_y=322&top_left_x=234)

Figure 6.26. Response to a 1 V step input at $t=0$, for the three 1 kHz lowpass filters of the previous figures.

#### C. Filter comparison

In spite of the preceding comments about the Bessel filter's frequency response, it still has vastly superior properties in the time domain compared with the Butterworth and Chebyshev. The Chebyshev, with its highly desirable amplitude-versus-frequency characteristics, actually has the poorest time-domain performance of the three. The Butterworth is in between in both frequency- and time-
domain properties. Table 6.1 on the next page and Figures 6.26 and 6.27 give more information about timedomain performance for these three kinds of filters to complement the frequency-domain graphs presented earlier. They make it clear that the Bessel is a desirable filter when performance in the time domain is important.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0438.jpg?height=509&width=774&top_left_y=488&top_left_x=1082)

Figure 6.27. Step-response comparison for 8-pole lowpass filters normalized to 1 Hz cutoff frequency.

### 6.2.7 Filter implementation

We'll see in the next section how to implement these classic filters with R's, C's, and op-amps. These are called active filters, and have the advantage of requiring no inductors. This is good, because inductors tend to be bulky, imperfect, and not inexpensive.

However, for use at frequencies above roughly 100 kHz , it is often preferable to build passive filters like the antialias lowpass filter example we showed in Figure 6.9. You have two choices: you can build your own, or you can buy what you need. To make your own, you can use any of numerous design tables (we give a set in Appendix E) or filter-design software (see §6.3.8) to calculate the $L$ and $C$ values for the particular filter you want. If you are making only a few, you may wish to use slug-tuned inductors (adjusted with an inductance meter or bridge), and either $1 \%$ capacitors or hand-trimmed pairs of paralleled capacitors, to get the precision you need.

Alternatively, you can just throw money at the problem: there are dozens of manufacturers of standard and custom filters, and they are happy to build anything you want. At the low end of the frequency spectrum (say below 100 MHz ) they will use lumped elements ( $L$ 's and $C$ 's); above that you'll get coaxial or cavity filters. If the filter you want is a standard unit (e.g., in the MiniCircuits Labs catalog), it will be inexpensive and generally

Table 6.1 Time-domain Performance Comparison for Lowpass Filters ${ }^{a}$

| Type | $f_{3 \mathrm{~dB}}$ <br> (Hz) | Poles | Step risetime (0-90\%) <br> (s) | Overshoot (\%) | Settling time |  | Stopband attenuation |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  |  | $\text { to } 1 \%$ <br> (s) | to 0.1\% <br> (s) | $\begin{array}{r} f=2 f_{\mathrm{C}} \\ (\mathrm{~dB}) \end{array}$ | $\begin{gathered} f=10 f_{\mathrm{C}} \\ (\mathrm{~dB}) \end{gathered}$ |
| $\begin{aligned} & \text { Bessel } \\ & (-3 \mathrm{~dB} \text { at } \\ & \left.f_{\mathrm{c}}=1 \mathrm{~Hz}\right) \end{aligned}$ | 1.0 | 2 | 0.4 | 0.4 | 0.6 | 1.1 | 10 | 36 |
|  | 1.0 | 4 | 0.5 | 0.8 | 0.7 | 1.2 | 13 | 66 |
|  | 1.0 | 6 | 0.6 | 0.6 | 0.7 | 1.2 | 14 | 92 |
|  | 1.0 | 8 | 0.7 | 0.3 | 0.8 | 1.2 | 14 | 114 |
| $\begin{gathered} \text { Butterworth } \\ (-3 \mathrm{~dB} \text { at } \\ \left.f_{\mathrm{C}}=1 \mathrm{~Hz}\right) \end{gathered}$ | 1.0 | 2 | 0.4 | 4 | 0.8 | 1.7 | 12 | 40 |
|  | 1.0 | 4 | 0.6 | 11 | 1.0 | 2.8 | 24 | 80 |
|  | 1.0 | 6 | 0.9 | 14 | 1.3 | 3.9 | 36 | 120 |
|  | 1.0 | 8 | 1.1 | 16 | 1.6 | 5.1 | 48 | 160 |
| $\begin{gathered} \text { Chebyshev } \\ 0.5 \mathrm{~dB} \text { ripple } \\ (-0.5 \mathrm{~dB} \text { at } \\ \left.f_{\mathrm{C}}=1 \mathrm{~Hz}\right) \end{gathered}$ | 1.39 | 2 | 0.4 | 11 | 1.1 | 1.6 | 8 | 37 |
|  | 1.09 | 4 | 0.7 | 18 | 3.0 | 5.4 | 31 | 89 |
|  | 1.04 | 6 | 1.1 | 21 | 5.9 | 10.4 | 54 | 141 |
|  | 1.02 | 8 | 1.4 | 23 | 8.4 | 16.4 | 76 | 193 |
| Chebyshev <br> 2dB ripple <br> (-2dB at <br> $f_{\mathrm{C}}=1 \mathrm{~Hz}$ ) | 1.07 | 2 | 0.4 | 21 | 1.6 | 2.7 | 15 | 44 |
|  | 1.02 | 4 | 0.7 | 28 | 4.8 | 8.4 | 37 | 96 |
|  | 1.01 | 6 | 1.1 | 32 | 8.2 | 16.3 | 60 | 148 |
|  | 1.01 | 8 | 1.4 | 34 | 11.6 | 24.8 | 83 | 200 |
| Notes: (a) a design procedure for these filters is presented in the section "VCVS circuits." |  |  |  |  |  |  |  |  |

delivered from stock. Otherwise you will pay at least a hundred dollars, and wait at least a few weeks. Some manufacturers we've used are Lark Engineering, Mini-Circuits Laboratories, Trilithic (Cir-Q-Tel), and TTE.

## 6.3 Active-filter circuits

A lot of ingenuity has been used in inventing clever active circuits, each of which can be used to generate response functions such as the Butterworth, Chebyshev, etc. You might wonder why the world needs more than one activefilter circuit. The reason is that various circuit realizations excel in one or another desirable property, so there is no all-around best circuit.

Active filters can be built using discrete op-amps as the active elements. ${ }^{24}$ In that case you must provide the resistors and capacitors that set the filter characteristics. These passive components must generally be accurate and stable, particularly in filters with sharp frequency characteristics. An attractive alternative is to take advantage of the rich variety of IC active filters, in which most of the hard work has been done, including the on-chip integration of matched passive components.

[^304]Active filters come in two basic varieties: "continuoustime" filters, and switched-capacitor filters. Continuoustime filters are analog circuits made from op-amps, resistors, and capacitors; the filter characteristics are set by the component values and, of course, the circuit configuration. The thing just sits there and acts like a filter. Switchedcapacitor filters use a capacitor combined with a MOSFET switch, turned on and off by an externally applied clocking signal, to substitute for the input resistor in the classic op-amp integrator. The effective resistor value is set by the clocking frequency. A typical switched-capacitor filter uses several such integrators in combination with additional opamps to implement the desired filter function. ${ }^{25}$ Switchedcapacitor filters have the advantages of being simply tuned over a wide range (by the applied clocking frequency), of maintaining stable characteristics, and of being particularly easy to fabricate as ICs. However, they are generally noisier (i.e., with smaller dynamic range), have higher distortion, and can introduce switching artifacts such as aliasing and clock feedthrough.

Some of the features to look for in active filters are (a) small numbers of parts, both active and passive, (b) ease

[^305]of adjustability, (c) small spread of parts values, especially the capacitor values, (d) undemanding use of the op-amp, especially requirements on slew rate, bandwidth, and output impedance, (e) the ability to make high- $Q$ filters, (f) electrical tunability, and (g) sensitivity of filter characteristics to component values and op-amp gain (in particular, the gain-bandwidth product, $f_{\mathrm{T}}$ ). In many ways, the last feature is one of the most important. A filter that requires parts of high precision is difficult to adjust, and it will drift as the components age; in addition, there is the nuisance that it requires components of good initial accuracy. The VCVS circuit probably owes most of its popularity to its simplicity and its low parts count, but it suffers from high sensitivity to component variations. By comparison, recent interest in more complicated filter realizations is motivated by the benefits of insensitivity of filter properties to small component variability.

In this section we present several circuits for lowpass, highpass, and bandpass active filters. We begin with the popular VCVS, or controlled-source type, then show the state-variable designs available as ICs from several manufacturers, and finally mention the twin-T sharp rejection filter.

Most of the new active-filter ICs being introduced are of the switched-capacitor type, owing to their ease of use, small size, low cost, excellent stability, and (in some cases) complete absence of required external components. We conclude the chapter with a discussion of them.

### 6.3.1 VCVS circuits

The voltage-controlled voltage-source (VCVS) filter, also known simply as a controlled-source filter, was devised by Sallen and Key (and introduced in simplified form in §6.2.4E). It's a variation of the simpler unity-gain circuit shown earlier (Figure 6.16), in which the unity-gain follower is replaced with a noninverting amplifier of gain greater than unity. Figure 6.28 shows the circuits for lowpass, highpass, and bandpass realizations. The resistors at the outputs of the op-amps create a noninverting voltage amplifier of voltage gain $K$, with the remaining $R$ 's and $C$ 's contributing the frequency response properties for the filter. These are 2 -pole filters, and they can be Butterworth, Bessel, etc., by suitable choice of component values, as we show later. Any number of VCVS 2-pole sections may be cascaded to generate higher-order filters. When that is done, the individual filter sections are, in general, not identical. In fact, each section represents a quadratic polynomial factor of the $n$ th-order polynomial describing the overall filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0440.jpg?height=1126&width=777&top_left_y=223&top_left_x=1119)

Figure 6.28. VCVS active-filter circuits.

There are design equations and tables in most standard filter handbooks for all the standard filter responses, usually including separate tables for each of a number of ripple amplitudes for Chebyshev filters. In the next section we present an easy-to-use design table for VCVS filters of Butterworth, Bessel, and Chebyshev responses ( 0.5 dB and 2 dB passband ripple for Chebyshev filters) for use as lowpass or highpass filters. Bandpass and band-reject filters can be made from combinations of these.

### 6.3.2 VCVS filter design using our simplified table

To use Table 6.2 to make a lowpass or a highpass filter, begin by deciding which filter response you need. As we mentioned earlier, the Butterworth may be attractive if maximum flatness of passband is desired, the Chebyshev gives the fastest rolloff from passband to stopband (at the expense of some ripple in the passband), and the Bessel provides the best phase characteristics, i.e., constant signal delay in the passband, with correspondingly good step
response. The frequency responses for all types are shown in the accompanying graphs (Figure 6.30).

Table 6.2 VCVS Lowpass Filters

| $\frac{\mathscr{0}}{\circ}$ | Butterworth K | Bessel |  | Chebyshev ( 0.5 dB ) |  | Chebyshev (2dB) |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  | $c$ | K | $c$ | K | $c$ | K |
| 2 | 1.586 | 1.272 | 1.268 | 1.231 | 1.842 | 0.907 | 2.114 |
| 4 | 1.152 | 1.432 | 1.084 | 0.597 | 1.582 | 0.471 | 1.924 |
|  | 2.235 | 1.606 | 1.759 | 1.031 | 2.660 | 0.964 | 2.782 |
| 6 | 1.068 | 1.607 | 1.040 | 0.396 | 1.537 | 0.316 | 1.891 |
|  | 1.586 | 1.692 | 1.364 | 0.768 | 2.448 | 0.730 | 2.648 |
|  | 2.483 | 1.908 | 2.023 | 1.011 | 2.846 | 0.983 | 2.904 |
| 8 | 1.038 | 1.781 | 1.024 | 0.297 | 1.522 | 0.238 | 1.879 |
|  | 1.337 | 1.835 | 1.213 | 0.599 | 2.379 | 0.572 | 2.605 |
|  | 1.889 | 1.956 | 1.593 | 0.861 | 2.711 | 0.842 | 2.821 |
|  | 2.610 | 2.192 | 2.184 | 1.006 | 2.913 | 0.990 | 2.946 |

To construct an $n$-pole filter (for $n$ an even integer), you will need to cascade $n / 2$ VCVS sections. Within each section, $R_{1}=R_{2}=R$, and $C_{1}=C_{2}=C$. As is usual in op-amp circuits, $R$ will typically be chosen in the range 10 k to 100 k . (It is best to avoid small resistor values, because the rising open-loop output impedance of the op-amp at high frequencies adds to the resistor values and upsets calculations.) Then all you need to do is set the gain, $K$, of each stage according to the table entries. For an $n$-pole filter there are $n / 2$ entries, one for each section.

#### A. Butterworth lowpass filters

If the filter is a Butterworth, all sections have the same values of $R$ and $C$, given simply by $R C=1 / 2 \pi f_{\mathrm{c}}$, where $f_{\mathrm{c}}$ is the desired -3 dB frequency of the entire filter. To make a 6-pole lowpass Butterworth filter, for example, you cascade three of the lowpass sections shown previously, with gains of $1.07,1.59$, and 2.48 (preferably in that order, to avoid dynamic range problems), and with identical $R$ 's and $C$ 's to set the 3 dB point.

#### B. Bessel and Chebyshev lowpass filters

To make a Bessel or Chebyshev filter with the VCVS, the situation is only slightly more complicated. Again we cascade several 2-pole VCVS filters, with prescribed gains for each section. Within each section we again use $R_{1}=R_{2}=R$ and $C_{1}=C_{2}=C$. However, unlike the situation with the Butterworth, the $R C$ products for the different sections are different and must be scaled by the normalizing factor $c_{\mathrm{n}}$ (given for each section in Table 6.2 on this page) according
to $R C=1 / 2 \pi c_{\mathrm{n}} f_{\mathrm{c}}$. Here $f_{\mathrm{c}}$ is again the -3 dB point for the Bessel filter, whereas for the Chebyshev filter it defines the end of the passband, i.e., it is the frequency at which the amplitude response falls out of the ripple band on its way into the stopband. For example, the response of a Chebyshev lowpass filter with 0.5 dB ripple and $f_{\mathrm{c}}=100 \mathrm{~Hz}$ will be flat within +0 dB to -0.5 dB from dc to 100 Hz , with 0.5 dB attenuation at 100 Hz and a rapid falloff for frequencies greater than 100 Hz . Values are given for Chebyshev filters with 0.5 dB and 2.0 dB passband ripple; the latter have a somewhat steeper transition into the stopband (Figure 6.30).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0441.jpg?height=598&width=955&top_left_y=747&top_left_x=959)

Figure 6.29. VCVS lowpass filter example. Resistor values shown are the nearest standard 1\% values (known as "E96").

#### An example

As an illustration, Figure 6.29 shows a VCVS implementation of a 4-pole lowpass filter with $f_{\mathrm{c}}=100 \mathrm{~Hz}$; resistor values for three filter characteristics are listed, calculated as just described. We used a similar filter (6-pole Butterworth, $f_{\mathrm{c}}=90 \mathrm{~Hz}$ ) to create a precision $50-70 \mathrm{~Hz}$ sinewave from a digital square wave that was referenced to a crystal oscillator; the output was amplified and used to drive an astronomical telescope. ${ }^{26}$

#### C. Highpass filters

To make a highpass filter, use the highpass configuration shown previously, i.e., with the $R$ 's and $C$ 's interchanged. For Butterworth filters, everything else remains unchanged (use the same values for $R, C$, and $K$ ). For the Bessel and Chebyshev filters, the $K$ values remain the same, but the

[^306]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0442.jpg?height=1202&width=1455&top_left_y=205&top_left_x=318)

Figure 6.30. Normalized frequency response graphs for the 2-, 4-, 6-, and 8-pole filters in Table 6.2. The Butterworth and Bessel filters are normalized to 3 dB attenuation at unit frequency, whereas the Chebyshev filters are normalized to 0.5 dB and 2 dB attenuations. As explained earlier, the top of the ripple band in the Chebyshev plots has been set to unity.
normalizing factors $c_{\mathrm{n}}$ must be inverted, i.e., for each section the new $c_{\mathrm{n}}$ equals $1 /\left(c_{\mathrm{n}}\right.$ listed in Table 6.2 on the preceding page).

A bandpass filter can be made by cascading overlapping lowpass and highpass filters. A band-reject filter can be made by summing the outputs of nonoverlapping lowpass and highpass filters. However, such cascaded filters won't work well for high- $Q$ filters (extremely sharp bandpass filters) because there is great sensitivity to the component values in the individual (uncoupled) filter sections. In such cases a high- $Q$ single-stage bandpass circuit (e.g., the VCVS bandpass circuit illustrated previously, or the state-variable and biquad filters in the next section) should be used instead. Even a single-stage 2-pole filter can produce a response with an extremely sharp peak. Information on such filter design is available in the standard references.

#### D. Generalizing the Sallen-and-Key filter

A design simplification in these Sallen-and-Key (or VCVS) filter circuits was the use of identical resistor and capacitor values within each 2-pole filter stage; but with that simplification came a set of oddball amplifier gains, as seen in the "Gain" column in Figure 6.29.

Often you want to set the filter's gain, for example to prevent saturation, or so that you can change the filter characteristics (by a change of component value) without altering the gain. When you constrain the gain, however, you have to relax the component ratio constraint. You can learn all about this in a pair of nice Application Notes by James Karki from TI. ${ }^{27}$ The bottom line is that (just as with the preceding VCVS circuits) you can create any filter

[^307]characteristic, using amplifier stages with your choice of gain, providing you are willing to adjust the resistor and capacitor ratios.

Following Karki's analysis, we can write down summary formulas for the transition frequency $f_{\mathrm{c}}$ and $Q$ of a 2-pole Sallen-Key section in which the component ratios can take on arbitrary values. Following the naming convention $^{28}$ of Figure 6.28A, we define parameters $m, n$, and $\tau$ (which will make the final results prettier):

$$
m=R_{1} / R_{2}, n=C_{1} / C_{2}, \text { and } \tau=R_{2} C_{2}
$$

With these definitions, a 2-pole filter section has a transition frequency

$$
\begin{equation*}
f_{c}=\frac{1}{2 \pi \tau \sqrt{m n}} \tag{6.5}
\end{equation*}
$$

and a $Q$ (sharpness of transition, or peakiness) of

$$
\begin{equation*}
Q=\frac{\sqrt{m n}}{1+m+m n(1-K)} \tag{6.6}
\end{equation*}
$$

These results alone are not enough for you to design higher-order filter cascades with canonical filter shapes (Chebyshev, etc.); for that you can consult the tables in Karki's App Note SLOA049B, or (for more fun) use a filter-design program. But these expressions demonstrate the point that you can trade off one set of constraints for another. Note particularly the attractive case of unity gain ( $K=1$ ), for which the gain elements can be wideband unitygain buffer ICs, or simple discrete-transistor followers. ${ }^{29}$

Revisiting the earlier constraint we used with the VCVS table (i.e., $R_{1}=R_{2}=R, C_{1}=C_{2}=C$ ), these formulas reduce to the simple forms

$$
\begin{equation*}
f_{c}=\frac{1}{2 \pi R C}, \quad Q=\frac{1}{3-K} \tag{6.7}
\end{equation*}
$$

for which the circuit goes unstable $(Q \rightarrow \infty)$ when $K=3$. Note that such a circuit, with the gain $K$ further constrained to unity (i.e., a follower, as we illustrated in Figure 6.16 to introduce the idea of an active filter) produces a pretty anemic filter, with a $Q$ of just one half.

#### E. Summary

VCVS filters minimize the number of components needed (two poles per op-amp) and offer the additional advantages of noninverting gain, low output impedance, small

[^308]spread of component values, easy adjustability of gain, and the ability to operate at high gain or high $Q$. They suffer from sensitivity to component values and amplifier gain, and they don't lend themselves well to applications where a tunable filter of stable characteristics is needed. And they require op-amps whose bandwidth ( $f_{\mathrm{T}}$, or GBW) is much higher than $f_{\mathrm{c}}$ of the filter. ${ }^{30}$ Some of these drawbacks are nicely remedied in the state-variable and biquad filters.

Exercise 6.3. Design a 6-pole Chebyshev lowpass VCVS filter with a 0.5 dB passband ripple and 100 Hz cutoff frequency $f_{\mathrm{c}}$. What is the attenuation at $1.5 f_{\mathrm{c}}$ ?

### 6.3.3 State-variable filters

The 2-pole filter shown in Figure 6.31 is far more complex than the VCVS circuits, but it is popular because of its improved stability and ease of adjustment. It is called a state-variable filter and was originally available as an IC from National (the AF100 and AF150, now discontinued); you can get it from Burr-Brown/TI (the UAF42), and a closely similar part is made by Maxim (MAX274-5). Because it is a manufactured module, all components except $R_{\mathrm{G}}, R_{\mathrm{Q}}$, and the two $R_{\mathrm{F}}$ 's are built in. Among its nice properties is the availability of highpass, lowpass, and bandpass outputs from the same circuit; also, its frequency can be tuned while maintaining constant $Q$ (or, alternatively, constant bandwidth) in the bandpass characteristic. As with the VCVS realizations, multiple stages can be cascaded to generate higher-order filters. The frequency can be made adjustable with a dual pot for the $R_{\mathrm{F}}$ pair. But, given the inverse $(1 / R)$ frequency tuning, you may prefer a linear scheme like that shown in Figure 6.34, where you could use either a dual pot or a dual multiplying DAC (see §6.3.3C).

Extensive design formulas and tables are provided by the manufacturers for the use of these convenient ICs. They show how to choose the external resistor values to make Butterworth, Bessel, and Chebyshev filters for a wide range of filter orders, with lowpass, highpass, bandpass, or bandreject responses. Among the nice features of these hybrid ICs is integration of the capacitors into the module, ${ }^{31}$ so that only external resistors need be added.

[^309]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0444.jpg?height=669&width=802&top_left_y=219&top_left_x=216)

Figure 6.31. State-variable active filter.

#### A. Bandpass filters

The state-variable circuit, in spite of its large number of components, is a good choice for sharp (high- $Q$ ) bandpass filters. It has low component sensitivities, does not make great demands on op-amp bandwidth, and is easy to tune. For example, in the circuit of Figure 6.31 used as a bandpass filter, the two resistors $R_{\mathrm{F}}$ set the center frequency, and $R_{\mathrm{Q}}$ and $R_{\mathrm{G}}$ together determine the $Q$ and band-center gain:

$$
\begin{align*}
& R_{\mathrm{F}}=5.03 \times 10^{7} / f_{0} \quad \text { ohms }  \tag{6.8}\\
& R_{\mathrm{Q}}=10^{5} /(3.48 Q+G-1) \quad \text { ohms }  \tag{6.9}\\
& R_{\mathrm{G}}=3.16 \times 10^{4} Q / G \quad \text { ohms } \tag{6.10}
\end{align*}
$$

So you could make a tunable-frequency, constant- $Q$ filter by using a 2 -section variable resistor (pot) for $R_{\mathrm{F}}$. Alternatively, you could make $R_{\mathrm{Q}}$ adjustable, producing a fixedfrequency, variable- $Q$ (and, unfortunately, variable-gain) filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0444.jpg?height=524&width=848&top_left_y=1733&top_left_x=221)

Figure 6.32. A filter with independently settable gain and $Q$.

Exercise 6.4. Calculate resistor values in Figure 6.32 to make a bandpass filter with $f_{0}=1 \mathrm{kHz}, Q=50$, and $G=10$.

Figure 6.32 shows a useful variant of the state-variable bandpass filter. The bad news is that it uses four op-amps; the good news is that you can adjust the bandwidth (i.e., $Q$ ) without affecting the midband gain. In fact, both $Q$ and gain are set with a single resistor each. The $Q$, gain, and center frequency are completely independent and are given by these simple equations:

$$
\begin{align*}
f_{0} & =1 / 2 \pi R_{\mathrm{F}} C  \tag{6.11}\\
Q & =R_{1} / R_{\mathrm{Q}}  \tag{6.12}\\
G & =R_{1} / R_{\mathrm{G}}  \tag{6.13}\\
R & \approx 10 \mathrm{k} \quad \text { (noncritical, matched }) . \tag{6.14}
\end{align*}
$$

Biquad filter
A close relative of the state-variable filter is the so-called biquad filter, shown in Figure 6.33. This circuit also uses three op-amps and can be constructed from the statevariable ICs mentioned earlier. It has the interesting property that you can tune its frequency (via $R_{\mathrm{F}}$ ) while maintaining constant bandwidth (rather than constant $Q$ ). Here are the design equations:

$$
\begin{align*}
f_{0} & =1 / 2 \pi R_{\mathrm{F}} C,  \tag{6.15}\\
\mathrm{BW} & =1 / 2 \pi R_{\mathrm{B}} C,  \tag{6.16}\\
G & =R_{\mathrm{B}} / R_{\mathrm{G}} . \tag{6.17}
\end{align*}
$$

The $Q$ is given by $f_{0} / \mathrm{BW}$ and equals $R_{\mathrm{B}} / R_{\mathrm{F}}$. As the center frequency is varied (via $R_{\mathrm{F}}$ ), the $Q$ varies proportionately, keeping the bandwidth $f_{0} / Q$ constant.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0444.jpg?height=539&width=797&top_left_y=1567&top_left_x=1068)

Figure 6.33. Biquad active filter.

When you design a biquad filter from scratch (rather than with an active-filter IC that already contains most of the parts), the general procedure goes something like this.
(1) Choose an op-amp whose bandwidth $f_{\mathrm{T}}$ is at least 10 to 20 times $G f_{0}$.
(2) Pick a round-number capacitor value in the vicinity of $C=10 / f_{0} \mu \mathrm{~F}$, where $f_{0}$ is in Hz .
(3) Use the desired center frequency to calculate the corresponding $R_{\mathrm{F}}$ from eq'n 6.15 .
(4) Use the desired bandwidth to calculate $R_{\mathrm{B}}$ from eq'n 6.16.
(5) Use the desired band-center gain to calculate $R_{\mathrm{G}}$ from eq'n 6.17.

You may have to adjust the capacitor value if the resistor values become awkwardly large or small. For instance, in a high- $Q$ filter you may need to increase $C$ somewhat to keep $R_{\mathrm{B}}$ from becoming too large (or you can use the T-network trick described in $\S 4.5 .5$ ). Note that $R_{\mathrm{F}}, R_{\mathrm{B}}$, and $R_{\mathrm{G}}$ each act as op-amp loads, and so they ought not to become less than, say, 5k. When juggling component values, you may find it easier to satisfy requirement (1) by decreasing integrator gain (increase $R_{\mathrm{F}}$ ) and simultaneously increasing the inverter-stage gain (increase the 10k feedback resistor).

As an example, suppose we want to make a filter with the same characteristics as in Exercise 6.4 on page 411. We would begin by provisionally choosing $C=0.01 \mu \mathrm{~F}$. Then we find $R_{\mathrm{F}}=15.9 \mathrm{k}\left(f_{0}=1 \mathrm{kHz}\right)$ and $R_{\mathrm{B}}=796 \mathrm{k}(Q=50$; $\mathrm{BW}=20 \mathrm{~Hz})$. Finally, $R_{\mathrm{G}}=79.6 \mathrm{k}(G=10)$.

Exercise 6.5. Design a biquad bandpass filter with $f_{0}=60 \mathrm{~Hz}$, $\mathrm{BW}=1 \mathrm{~Hz}$, and $G=100$.

#### B. Higher-order bandpass filters

As with our earlier lowpass and highpass filters, it is possible to build higher-order bandpass filters with approximately flat bandpass and steep transition to the stopband.

You do this by cascading several lower-order bandpass filters, the combination tailored to realize the desired filter type (Butterworth, Chebyshev, or whatever). As before, the Butterworth is "maximally flat," whereas the Chebyshev sacrifices passband flatness for steepness of skirts. Both the VCVS and state-variable/biquad bandpass filters just considered are second-order (two pole). As you increase the filter sharpness by adding sections, you generally degrade the transient response and phase characteristics. The "bandwidth" of a bandpass filter is defined as the width between -3 dB points, except for equiripple filters, for which it is the width between frequencies at which the response falls out of the passband ripple channel.

You can find tables and design procedures for constructing complex filters in standard books on active filters, or in the datasheets for active-filter ICs. There are also some very nice filter-design programs, including shareware and
freeware versions that run on standard PCs and workstations.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0445.jpg?height=305&width=748&top_left_y=322&top_left_x=1006)

Figure 6.34. Tuning the frequency of the state-variable active filter. The op-amp buffer can be omitted if strict linearity with pot rotation is not needed.

#### C. Electronic tunability

Sometimes you want electrical tunability (or switchability) so you can change filter characteristics under control of a signal (rather than having to turn the shaft on a variable resistor). An example might be an anti-alias lowpass filter that precedes a digitizer, in which the digitizing rate $f_{\text {samp }}$ can be varied over some range. In that case the filter's $f_{\mathrm{c}}$ must be set to follow the Nyquist frequency, $f_{\mathrm{c}} \approx f_{\text {samp }} / 2$ (see $\S \S 6.2 .3 \mathrm{C}, 6.3 .7 \mathrm{~A}$, and 13.5.1B). In active-filter circuits like the VCVS you can do this, to a limited extent, by using analog switches to select among a small set of fixed resistors, each of which substitutes for one of the resistors in the filter. But the state variable filters provide a particularly convenient way to accomplish both switchability and continuous tuning, in one of several ways.
Digital potentiometer As we discussed in §3.4.3E, you can get convenient ICs that contain a long string of matched resistors, with MOSFET switches to select the voltage-divider tap (by means of digital control ${ }^{32}$ ). So you can effectively alter the value of a programming resistor (e.g., $R_{\mathrm{F}}$ in Figure 6.31) by preceding it with such a digital voltage divider (with a unity-gain follower, if needed to drive a low-value $R_{\mathrm{F}}$ ); see Figure 6.34. By using a dual digital pot ${ }^{33}$ you could adjust the pair of $R_{\mathrm{F}}$ 's simultaneously, as would be needed to tune $f_{0}$ in that bandpass circuit. Digital pots come with as many as 1024 taps, and they come in both linear and log spacing, so you can achieve pretty accurate electronic control. Digital pots do not provide particularly accurate overall resistance values (typically $\pm 20 \%$ ), but they do guarantee accurate and stable control of divider ratio ( $1 \%$ or

[^310]better); i.e., the resistors that make up the string are well matched. That is why they work well in this application, in which only the ratio is important.
Multiplying DAC Another way to effectively vary $R_{\mathrm{F}}$ in the state-variable filter is to use a multiplying DAC (digital-to-analog converter), rather than a programmable divider, to scale the op-amp's voltage output. The MDAC outputs a voltage (or a current, in some models) that is proportional to the product of an analog input voltage and a digital input quantity. Compared with the digital pot, the MDAC method provides higher resolution (finer step size), faster response, and (often) wider voltage range.
Analog switch If only a discrete set of filter parameters is desired, you can just use a set of MOSFET analog multiplexers to select among a preselected group of programming resistors. Don't forget to consider the effects of finite $R_{\mathrm{ON}}$.
Integrated switchability There are a few active-filter ICs that provide for programmable cutoff frequency, by a digital code you apply to a set of programming pins. You don't get continuous control, but you sure save a lot of work (and a lot of parts). In this class are the LTC1564 (8-pole elliptic lowpass), which lets you select the cutoff frequency from 10 kHz to 150 kHz in 10 kHz steps, and the MAX270 (dual 2-pole lowpass), which lets you select the cutoff frequency among 128 steps going from 1 kHz to 25 kHz .

#### Electronic tuning alternatives: switched-capacitor filters and DSP

The above techniques achieve electronic tunability by presenting the continuous-time filter with an effectively variable set of programming resistors. When thinking about electronic tuning, it's wise to consider switched-capacitor filters and digital signal processing (DSP), in both of which electronic tunability is inherent. These are discussed later in this chapter (§6.3.6 and 6.3.7).

#### D. Multiple-feedback active filter

In addition to the VCVS (Sallen-and-Key) and statevariable (or biquad) active-filter circuit configurations, there's another active-filter circuit that's commonly used. It's called the "multiple-feedback" (MFB) active filter (also known as the "infinite-gain multiple-feedback"), and is shown in Figure 6.35. Here the op-amp is configured as an integrator, rather than as a voltage amplifier (or follower). Designing an MFB filter is no more difficult than designing a VCVS, and you can find nice filter software that supports both configurations, for example at the very fine website of

Uwe Beis (see §6.3.8). You can get nice MFB filter ICs, for example the LTC1563, an inexpensive (\$2.30) linearfilter IC using the MFB configuration, convenient for making anti-alias filters, etc. The ' $1563-2$ version makes 4 - and 5-pole Butterworth filters, from 256 Hz to 360 kHz , and the -3 version makes Bessel filters. The ICs use internal 27 pF to 54 pF capacitors trimmed to $3 \%$, combined with your external 7 k to $10 \mathrm{M} 1 \%$ resistors. The datasheet is especially instructive.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0446.jpg?height=333&width=529&top_left_y=632&top_left_x=1205)

$$
\left.\begin{array}{l}
R=20 \mathrm{k} \\
C=5.6 \mathrm{nF}
\end{array}\right\} f_{\mathrm{C}}=1 \mathrm{kHz}
$$

Figure 6.35. Multiple-feedback (MFB) active filter, here shown in a 2-pole lowpass configuration.

This configuration has an interesting advantage compared with the VCVS: as you go to high frequencies, approaching the bandwidth $f_{\mathrm{T}}$ of the op-amp, the degrading effects of rising op-amp output impedance are less severe. We ran SPICE simulations of VCVS and MFB 2pole Butterworth lowpass filters (Figures 6.36 and 6.37), which show this effect nicely. We set the cutoff frequency at 4 kHz , well below the LF411's unity-gain frequency $\left(f_{\mathrm{T}}\right)$ of 4 MHz . In the VCVS configuration the op-amp's rising $Z_{\text {out }}$ allows input signal to couple to the output through the first capacitor, a path that is absent in the MFB configuration. ${ }^{34}$ In many applications, however, this is not a serious worry. And the effect is reduced as the resistor values of the filter are increased, as shown in Figure 6.36. The VCVS configuration is alive and well, and remains popular. ${ }^{35}$

[^311]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0447.jpg?height=598&width=799&top_left_y=221&top_left_x=121)

Figure 6.36. The rising closed-loop output impedance of the opamp degrades the high-frequency attenuation in the VCVS (Sallen-and-Key) configuration, by allowing some input signal to couple to the output through the input resistor and feedback capacitor ( $R_{1}$ and $C_{1}$ in Figure 6.28). Larger resistor values reduce the effect. See also Figure 6.37.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0447.jpg?height=608&width=805&top_left_y=1122&top_left_x=118)

Figure 6.37. The stopband attenuation of the MFB configuration is not much affected by rising op-amp output impedance (e.g., as seen in Figure 4.53), compared with that of the VCVS. However, you can mitigate the effect in the VCVS by using a second opamp to create a buffered output from the signal at the op-amp's noninverting input.

### 6.3.4 Twin-T notch filters

The passive $R C$ network shown in Figure 6.38 has infinite attenuation at a frequency $f_{c}=1 / 2 \pi R C$. Infinite attenuation is uncharacteristic of $R C$ filters in general; this one works by effectively adding two signals that have been shifted $180^{\circ}$ out of phase at the cutoff frequency. It requires
good matching of components to obtain a good null at $f_{\mathrm{c}}$. It is called a twin-T, and it can be used to remove an interfering signal, such as 60 Hz powerline pickup. The problem is that it has the same "soft" cutoff characteristics as all passive $R C$ networks, except, of course, near $f_{\mathrm{c}}$, where its response drops like a rock. For example, a twin-T driven by a perfect voltage source is down 10 dB at twice (or half) the notch frequency and 3 dB at four times (or one-fourth) the notch frequency. One trick to improve its notch characteristic is to "activate" it in the manner of a Sallen-and-Key filter (Figure 6.39). This technique looks good in principle, but it is generally disappointing in practice, owing to the impossibility of maintaining a good filter null. As the filter notch becomes sharper (more gain in the bootstrap), its null becomes less deep.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0447.jpg?height=346&width=475&top_left_y=860&top_left_x=1140)

Figure 6.38. Passive twin-T notch filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0447.jpg?height=407&width=659&top_left_y=1322&top_left_x=1058)

Figure 6.39. Bootstrapped twin-T.
Twin-T filters are available as prefab modules, going from 1 Hz to 50 kHz , with notch depths of about 60 dB (with some deterioration at high and low temperatures). They are easy to make from components, but resistors and capacitors of good stability and low temperature coefficient should be used to get a deep and stable notch. One of the components should be made trimmable.

The twin-T filter works fine as a fixed-frequency notch, but it is a horror to make tunable, because three resistors must be simultaneously adjusted while maintaining constant ratio. However, the remarkably simple $R C$ circuit of Figure 6.40A, which behaves just like the twin-T, can be
adjusted over a significant range of frequency (at least two octaves) with a single potentiometer. Like the twin-T (and most active filters) it requires some matching of components; in this case, the three capacitors must be identical, and the fixed resistor must be exactly six times the bottom (adjustable) resistor. The notch frequency is then given by

$$
f_{\text {notch }}=1 / 2 \pi C \sqrt{3 R_{1} R_{2}} .
$$

Figure 6.40B shows an implementation that is tunable from 25 Hz to 100 Hz . The 50 k trimmer is adjusted (once) for maximum depth of notch.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0448.jpg?height=812&width=641&top_left_y=691&top_left_x=302)

Figure 6.40. Bridged differentiator tunable-notch filter. The implementation in (B) tunes from 25 Hz to 100 Hz .

As with the passive twin-T, this filter (known as a bridged differentiator) has a gently sloping attenuation away from the notch and infinite attenuation (assuming perfect matching of component values) at the notch frequency. It, too, can be "activated" by bootstrapping the wiper of the pot with a voltage gain somewhat less than unity (as in Figure 6.39). Increasing the bootstrap gain toward unity narrows the notch, but also leads to an undesirable response peak on the high-frequency side of the notch, along with a reduction in ultimate attenuation.

### 6.3.5 Allpass filters

Allpass? Allpass?! Whatever can that be? And why would you want such a thing, when a piece of wire does as well (and probably better)?

Allpass filters, also known as delay equalizers or phase equalizers, are filters with flat amplitude response, but with a phase shift that varies with frequency. They are used to compensate for phase shifts (or time delays) in some signal path.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0448.jpg?height=720&width=790&top_left_y=441&top_left_x=1059)

Figure 6.41. Allpass filter, also known as a delay equalizer, or phase equalizer.

Figure 6.41 shows the basic circuit configuration. Intuitively, it's easy to see that the circuit behaves like an inverter at low frequencies (where no signal is coupled to the noninverting input) and a follower at high frequencies (recall the optional inverter of §4.3.1A). By writing a few equations you can convince yourself that the circuit behaves as described in the figure. Interchanging $R$ and $C$ produces a similar characteristic, but with lagging (rather than leading) phase shifts between the extremes of inverting and following. The phase shift can be tuned by making $R$ variable; but note that a small value of $R$ makes the circuit's input impedance small at high frequencies (where the reactance of $C$ goes to zero).

Figure 6.42 shows a variant that extends the range of phase shift to a full $360^{\circ}$. The downside is that you have to adjust two components simultaneously (e.g., the pair of equal-value resistors) to change its tuning. This can be done nicely, though, by using a digital dual potentiometer (an "EEpot") of the sort described in §3.4.3E.

### 6.3.6 Switched-capacitor filters

One drawback to these state-variable or biquad filters is the need for accurately matched capacitors. If you build the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0449.jpg?height=720&width=802&top_left_y=209&top_left_x=102)

Figure 6.42. Allpass filter with a full $360^{\circ}$ phase shifting range. (Genin, R., Proc. IEEE, 56, 1746 (1968).)
circuit from op-amps, you've got to get pairs of stable capacitors (not electrolytic, tantalum, or high- $\kappa$ ceramic), perhaps matched better than $1 \%$ for optimum performance. You also have to make a lot of connections, since the circuits use at least three op-amps and six resistors for each 2-pole section. Alternatively, you can buy a filter IC, letting the manufacturer figure out how to integrate matched 1000 pF ( $\pm 0.5 \%$ ) capacitors into an IC. Semiconductor manufacturers have solved those problems, but at a price: the UAF42 and MAX274 "Universal Active Filter" ICs (mentioned earlier), implemented with hybrid or laser-trim technology, cost about \$8-\$16 apiece. These "continuoustime" filters also do not lend themselves to easy tunability.

#### A. Switched-capacitor integrator

There's another way to implement the integrators that are needed in the state-variable or biquad filter configurations. The basic idea is to use MOSFET analog switches, clocked from an externally applied square wave at some high frequency (typically 100 times faster than the analog signals of interest), as shown in Figure 6.43. In the figure, the funny triangular object is a digital inverter, which turns the square wave upside down so that the two MOS switches are closed on opposite halves of the square wave.

The circuit is easy to analyze: when $S_{1}$ is closed, $C_{1}$ charges to $V_{\text {in }}$, i.e., holding charge $C_{1} V_{\text {in }}$. On the alternate half of the cycle, $C_{1}$ discharges into the virtual ground, transferring its charge to $C_{2}$. The voltage across $C_{2}$ therefore changes by an amount $\Delta V=\Delta Q / C_{2}=V_{\mathrm{in}} C_{1} / C_{2}$. Note
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0449.jpg?height=853&width=799&top_left_y=206&top_left_x=973)

Figure 6.43. A. Switched-capacitor integrator. B. conventional integrator.
that the output-voltage change during each cycle of the fast square wave is proportional to $V_{\text {in }}$ (which we assume changes only a small amount during one cycle of square wave), i.e., the circuit is an integrator! It is easy to show that the integrators obey the equations in the figure.

Exercise 6.6. Derive the equations in Figure 6.43.
Exercise 6.7. Here's another way to understand the switchedcapacitor integrator: calculate the average current that flows through $S_{2}$ into the virtual ground. You should find that it is proportional to $V_{\text {in }}$. Therefore, the combination of $S_{1}, C_{1}$, and $S_{2}$ behaves like a resistor, forming a classic integrator. What is the value of that equivalent resistance, in terms of $f_{0}$ and $C_{1}$ ? Use that to arrive at the equation in the figure, $V_{\text {out }}=f_{0}\left(C_{1} / C_{2}\right) \int V_{\text {in }} d t$.

#### B. Advantages of switched-capacitor filters

There are two important advantages to using switched capacitors instead of conventional integrators. First, as hinted earlier, it can be less expensive to implement on silicon: the integrator gain depends only on the ratio of two capacitors, not on their individual values. In general, it is easy to make a matched pair of anything on silicon, but very hard to make a similar component (resistor or capacitor) of precise value and high stability. As a result, monolithic switched-capacitor filter ICs are inexpensive - TI's universal switched-capacitor filter (the MF10) costs \$3.50
(compared with $\$ 16$ for the conventional UAF42), and furthermore it gives you two filters in one package.

The second advantage of switched-capacitor filters is the ability to tune the filter's characteristic frequency (e.g., the center frequency of a bandpass filter, or the -3 dB point of a lowpass filter) by merely changing the frequency of the square-wave ("clock") input. ${ }^{36}$ This is because the characteristic frequency of a state-variable or biquad filter is proportional to (and depends only on) the integrator gain.

#### C. Switched-capacitor filter configurations

Switched-capacitor filters are available in both dedicated and "universal" configurations. The former are prewired with on-chip components to form lowpass filters of the desired type (Butterworth, Bessel, Elliptic), whereas the latter have various intermediate inputs and outputs brought out so you can connect external components to make anything you want. The price you pay for universality is a larger IC package and the need for external resistors. For example, LTC's self-contained LTC1069-6 8-pole elliptic lowpass filter comes in an 8-pin package (about \$9), compared with their LTC1164 quad 2-pole universal filter which requires 12 external resistors to implement a comparable filter and comes in a 24-pin package (about \$15). Figure 6.44 shows just how easy it is to use the dedicated type. Look ahead to $\S 7.1 .5 \mathrm{~A}$ to see an elegant and simple sinewave generator that uses a tracking switched-capacitor filter acting on a square wave at a fraction of the clock frequency (Figures 7.18 and 7.19).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0450.jpg?height=335&width=716&top_left_y=1450&top_left_x=262)

Figure 6.44. Switched capacitor dedicated lowpass filter, requiring no external components. The 8th-order elliptic response has $\pm 0.1 \mathrm{~dB}$ passband ripple, and is more than 40 dB down at $1.3 f_{3 \mathrm{~dB}}$.

Both dedicated and universal switched-capacitor filters use as the basic building block the 2-pole statevariable configuration, with switched-capacitor integrators replacing the resistor-fed op-amp integrators of the classic continuous-time state-variable active filter; see Fig-

[^312]ure 6.45. The universal filter ICs come with one to four such sections, which can be cascaded to form a higherorder filter (with each section implementing a quadratic term in the factored filter equation), or they can be used independently for multiple simultaneous channels (which must, however, share the common clocking input). The manufacturer's datasheets (or software or both) make filter design easy with these universal filter ICs. ${ }^{37}$ And no design is needed at all for the dedicated filter - you just connect it up, and off you go.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0450.jpg?height=335&width=792&top_left_y=659&top_left_x=1073)

Figure 6.45. "Universal" second-order switched-capacitor building block. It can provide lowpass, highpass, bandpass, allpass, and notch, as determined by external connections. With its on-chip capacitors, the only external components required are a few resistors.

#### D. Drawbacks of switched-capacitor filters

Now for the bad news: switched-capacitor filters have three annoying characteristics, all related and caused by the presence of the periodic clocking signal. First, there is clock feedthrough, the presence of some output signal (typically about 10 mV to 25 mV ) at the clock frequency, independent of the input signal. Usually this doesn't matter, because it is far removed from the signal band of interest. If clock feedthrough is a problem, a simple $R C$ filter at the output usually gets rid of it.

The second problem is more subtle: if the input signal has any frequency components near the clock frequency, they will be "aliased" down into the passband. To state it precisely, any input signal energy at a frequency that differs from the clock frequency by an amount corresponding to a frequency in the passband will appear (unattenuated!) in the passband. For example, if you use a MAX7400 (dedicated 8-pole elliptic lowpass) as a 1 kHz lowpass filter (i.e., set $f_{\text {clock }}=100 \mathrm{kHz}$ ), any input signal energy in the

[^313]range of $99-101 \mathrm{kHz}$ will appear in the output band of dc1 kHz . No filter at the output can remove it! You must make sure the input signal doesn't have energy near the clock frequency. If this isn't naturally the case, you can usually use a simple $R C$ filter, because the clock frequency is typically quite far removed from the passband. The use of filter ICs with a high clock-to-corner frequency ratio (e.g., 100:1 instead of $25: 1$ or $50: 1$ ) simplifies input anti-alias filter design. You can get some nice filter ICs with 1000:1 clock ration from Mixed Signal Integration, for example their MSHN series. ${ }^{38}$ A high clock ratio also reduces the "staircase" output waveform from these filters.

The third undesirable effect in switched-capacitor filters is a general reduction in signal dynamic range (an increase in the "noise floor") that is due to incomplete cancellation of MOSFET switch charge injection (see §3.4.2E). This manifests itself as a raised noise floor within the bandpass. Typical filter ICs have claimed dynamic ranges of $80-90 \mathrm{~dB}$. In addition to reduced dynamic range (compared with continuous-time filters), switched-capacitor filters tend to have more distortion than you would expect, especially for output signals near the supply rails.

Like any linear circuit, switched-capacitor filters (and their op-amp analogs) suffer from amplifier errors such as input offset voltage and $1 / f$ low-frequency noise. These can be a problem if, for example, you wish to lowpass filter some low-level signal without introducing errors or fluctuations in its average dc value. A nice solution is provided by the clever folks at Linear Technology, who dreamed up the LTC1062 "DC accurate lowpass filter" (or the MAX280, with improved offset voltage). Figure 6.46 shows how you use it. The basic idea is to put the filter outside the dc path, letting the low-frequency signal components couple passively to the output; the filter grabs onto the signal line only at higher frequencies, where it rolls off the response by shunting the signal to ground. The result is zero dc error, and switched-capacitor-type noise only in the vicinity of the rolloff ${ }^{39}$ (Figure 6.47). You can cascade a pair of these filters to make higher-order filters, or a tunable sharp bandpass filter. The datasheet also shows you how to make a tunable notch filter.

Switched-capacitor filter ICs are widely available from manufacturers such as Linear Technology, TI, and Maxim. Typically you can put the cutoff (or band center) anywhere in the range of dc to a few tens of kilohertz, as set by the clock frequency. The characteristic frequency

[^314]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0451.jpg?height=404&width=774&top_left_y=211&top_left_x=985)

Figure 6.46. LTC1062 "dc-accurate" lowpass filter. The external clock input must swing rail-to-rail (add a small series resistor to protect the input); alternatively you can enable the internal oscillator by connecting a capacitor from CLK to ground.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0451.jpg?height=529&width=670&top_left_y=853&top_left_x=1040)

Figure 6.47. LTC1062 output noise spectra (see the datasheet).
is a fixed multiple of the clock, usually $50 f_{\text {clk }}$ or $100 f_{\text {clk }}$. Most switched-capacitor filter ICs are intended for lowpass, bandpass, or notch (band-stop) use, though you can configure the universal type as highpass filters. Note that clock feedthrough and discrete (clock-frequency) output waveform quantization effects are particularly bothersome in the latter case, since they're both in-band.

### 6.3.7 Digital signal processing

Our discussion of electronic filters in this chapter would be seriously incomplete without an introduction to the widespread technique of digital signal processing (DSP), also known as discrete-time signal processing. Contemporary systems that include microprocessors favor digitalfiltering methods for their flexibility and performance. Digital signal processing is the manipulation of signals in the digital domain, in which a signal (for example, a speech waveform) has been converted to a sequence of
numbers representing its sampled amplitude values at equally spaced intervals of time. The "manipulations" can be any of the things we've seen in the purely analog domain - filtering, combining, attenuation or amplification, nonlinear compression and clipping, and so on; but they can include also additional sophisticated operations made possible by the power of computation, such as coding, error correction, encryption, spectral analysis, speech synthesis and analysis, image processing, adaptive filtering, and lossless compression and storage.

We'll have much to say about digitizing and processing in Chapters 13 ("Digital meets analog") and 15 ("Microcontrollers"), when we'll have, respectively, the electronic tools for conversion between analog voltages and their digital representation, and the means to process those digital quantities. Here we would like simply to introduce the application of DSP to filtering and give a glimpse of its capabilities, particularly when compared with the analog filters we've seen. We'll stick to one-dimensional filters; that is, the filtering of "one-dimensional" signals such as speech (as contrasted with two-dimensional images), which are characterized by some voltage waveform $V(t)$ evolving in time.

#### A. Sampling

We mentioned earlier that a digitized representation of a continuous waveform involves sampling at a discrete set of (nearly always) uniformly spaced times, with a discrete set of (usually) uniformly spaced quantized amplitudes. These determine the fidelity of the quantization - in frequency (from the sampling rate, obeying the Nyquist sampling criterion, see Figure 13.60) and in dynamic range and noise (from the quantization precision); see §13.5.1. There's a lot to say about these; but at the most basic level you've got to sample at least twice the rate of the highest-frequency component that's in the input, and you've got to have enough precision in the $n$-bit amplitude quantization to preserve the dynamic range you want. Put compactly,

$$
\begin{aligned}
f_{\text {samp }} & \geq 2 f_{\text {sig }}(\max ), \\
\text { dynamic range } & =6 n \mathrm{~dB} .
\end{aligned}
$$

Assuming you're beginning with an analog waveform, the sampling is done with an analog-to-digital converter (ADC), preceded by an anti-alias lowpass filter (LPF), if needed, to ensure that the waveform being digitized contains no signals of significance above the Nyquist frequency $f_{\text {samp }} / 2$.

#### B. Filtering

The sequence of adequately sampled amplitudes (call it $x_{n}$, for the $n$th sample) represents the input signal. We
want to do a filtering operation on the sequence, for example a lowpass filter. There are two broad classes of DSP filters: finite-impulse-response (FIR) and infinite-impulseresponse (IIR). The FIR is easiest to understand - each output sample is simply a weighted sum of some number of input samples (see Figure 6.48):

$$
y_{i}=\sum_{k=-\infty}^{\infty} a_{k} x_{i-k}
$$

where the $x_{i}$ are the input signal amplitudes, the $a_{k}$ are the weights, and the $y_{i}$ are the output of the filter. In real life there will be only a finite number of weights, and so the sum will run only over a finite set of input values, as in the figure. Speaking crudely, the set of coefficients is an approximation to the inverse Fourier transform of the desired filter function.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0452.jpg?height=481&width=807&top_left_y=905&top_left_x=1063)

Figure 6.48. Finite impulse response (nonrecursive) digital filter.

Note an interesting - and important - feature of such a filter: its output is formed of samples both past and $f u$ ture. That is, it can generate an output that would appear to violate causality (effect must follow cause), but which is permitted here because the output signal has an overall delay with respect to the input. This ability to see into the future (a boast that no analog filter can make) allows digital filters to implement frequency- and phase-response characteristics that cannot be achieved with the (causal) analog filters we've seen up to this point.

The IIR filter differs in allowing the output to be included, with some weighting factor, along with the inputs in the weighted sum; this is sometimes called a recursive filter. The simplest example might be

$$
y_{i}=b y_{i-1}+(1-b) x_{i}
$$

which happens to be the discrete approximation to a continuous-time $R C$ lowpass filter, in which the weighting factor $b$ is given by $b=e^{-t_{\mathrm{s}} / R C}$, where $t_{\mathrm{s}}$ is the sampling interval. Of course, the situation is not identical to an analog
lowpass filter operating on an analog waveform because of the discrete nature of the sampled waveform.

Both FIR and IIR implementations have their pros and cons. FIR filters are generally preferred because they are simple to understand, easy to implement, unconditionally stable (no feedback), and they can be (and usually are) designed as linear-phase filters (i.e., the time delay is constant, independent of frequency). IIR filters are more economical, however, requiring fewer coefficients and therefore less memory and calculation. They also are easily derived from the corresponding classic analog filter; and they are particularly well suited to applications requiring high selectivity, for example, notch filters. However, they require more bits of arithmetic precision to prevent instabilities and "idle tones," and they are more difficult to code.

#### C. An example: IIR lowpass

As a simple numerical example, suppose you want to filter a set of numbers representing a signal, with a lowpass 3 dB point at $f_{3 \mathrm{~dB}}=1 / 20 t_{\mathrm{s}}$, equivalent to a single-section $R C$ lowpass filter of the same breakpoint. Here the time constant equals the time for 20 successive samples. Then $A=0.95123$, and so the output is given by

$$
y_{i}=0.95123 y_{i-1}+0.04877 x_{i}
$$

The approximation to a real lowpass filter becomes better as the time constant becomes long compared with the time between samples, $t_{\mathrm{s}}$.

You would probably use a filter like this to process data that are already in the form of discrete samples, e.g., an array of data in a computer. In that case the recursive filter becomes a trivial arithmetic pass once through the data.

#### D. An example: FIR lowpass

An ideal lowpass filter has unit response up to its cutoff frequency $f_{\mathrm{c}}$ and zero response for higher frequencies. That is, the response curve is rectangular, a "brick-wall" filter. To first order, the FIR coefficients $a_{k}$ are the rectangle's Fourier transform, namely a $(\sin x) / x$ function (or sinc function), in which the scaling of the argument depends on the ratio of the cutoff frequency to the sampling frequency, namely,

$$
\begin{equation*}
a_{k} \propto \frac{\sin \left(2 \pi k f_{\mathrm{n}}\right)}{2 \pi k f_{\mathrm{n}}} \tag{6.18}
\end{equation*}
$$

where the integers $k$ go from $-\infty$ to $\infty$, and $f_{\mathrm{n}}$ is the normalized cutoff frequency, defined as $f_{\mathrm{n}}=f_{\mathrm{c}} / f_{\mathrm{s}}$.

In a real-world implementation, of course, you get only a finite number of $k$ 's, say $N$ of them. So the question: what set of truncated filter coefficients $a_{k}$, where $k$ goes only from $-N / 2$ to $N / 2$, best approximates the ideal lowpass filter? This turns out to be more complicated than you
might at first imagine. Among other things, it depends on what you mean by "best."

If you simply truncate the $a_{k}$ series, discarding coefficients beyond the length of your FIR sample string, the resulting filter's frequency response will exhibit large bumps in the stopband attenuation; that is, degraded rejection around those frequencies. This is exactly analogous to the problem of "spectral leakage" in digital spectrum analysis, or of diffraction sidelobes in optics, and the fix is the same: here you taper the coefficients $a_{k}$ by multiplying them by a "window function" that goes smoothly toward zero at the ends (in spectrum analysis you multiply the incoming digitized signal amplitudes by an analogous windowing function, and in optics you "apodize" the aperture with a mask whose opacity increases toward the edges). The effect is to reduce greatly the stopband ripple, at the expense of a more gradual transition from passband to stopband (in spectral analysis the effect is greatly reduced spectral leakage into adjacent frequency bins, at the expense of broader bin width; in optics the sidelobes are attenuated, at the expense of decreased resolution in the form of a broader "point-spread function"). Typical window functions have names like Hamming, Hanning, and Blackman-Harris. There's no "best" window - it's always a tradeoff between the steepness of transition to the stopband versus the worst-case attenuation in the stopband. But most of the time it doesn't really matter a whole lot which of the standard windows you use. ${ }^{40}$

A second aspect of "best" is to choose a cutoff frequency $f_{\mathrm{n}}$ for which at least some of the coefficients are exactly zero; that way you can omit the multiply and add operations corresponding to those taps. This occurs, for example, with the choice $f_{\mathrm{n}}=0.25$ (a sampling rate four times the cutoff frequency), for which the coefficients in eq'n 6.18 become

$$
\begin{equation*}
a_{k} \propto \frac{\sin (\pi k / 2)}{\pi k / 2} \tag{6.19}
\end{equation*}
$$

and therefore all the coefficients with even $k$ (except $a_{0}$ ) are zero. You get a small bonus, also, by using a filter length $N$ that is a multiple of 4 ; that makes the end coefficients (at $k= \pm N / 2$ ) vanish, because their index $k$ is then even.

Because a cutoff frequency of half the sampling frequency (i.e., $f_{\mathrm{n}}=0.5$ ) is the maximum allowed by the Nyquist sampling theorem, a filter whose cutoff is at $f_{\mathrm{n}}=0.25$ is known as a "half-band" filter. Figures 6.49 and 6.50 show the response of half-band filters with $N=8,16$, 32 , and 64 , where the coefficients have been calculated

[^315]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0454.jpg?height=443&width=789&top_left_y=207&top_left_x=228)

Figure 6.49. Half-band FIR digital filter response, plotted on a linear scale. A filter of order $N$ requires $N / 2+1$ coefficients.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0454.jpg?height=450&width=799&top_left_y=813&top_left_x=223)

Figure 6.50. The half-band filters of Figure 6.49, plotted on a loglog scale to reveal the stopband response.
according to eq'n 6.19 , weighted by a Hamming window. The latter is a raised cosine, given approximately by

$$
\begin{equation*}
w(k)=0.54+0.46 \cos (2 \pi k / N) \tag{6.20}
\end{equation*}
$$

A final step is to normalize the coefficients (by multiplying each by the same factor) so that their sum is 1 , giving the filter unit gain at dc. The recipe, then, is to choose an $N$ (preferably a multiple of 4 ); then, for each positive odd $k$ up to $N / 2$, calculate the sinc function of equation (6.19) and multiply it by the Hamming coefficient of eq'n 6.20 to get the (not yet normalized) $a_{k}$. Note that the coefficients are symmetric $\left(a_{-k}=a_{k}\right)$, and that the $a_{0}$ term will be 1.0 (because both $\operatorname{sinc}(0)$ and $w(0)$ have value unity). The final step is to normalize these coefficients by dividing each by their sum.

Because the even coefficients are zero, the resultant filters, though requiring $N$ stages of memory, need approximately half that number of coefficients (those with odd subscripts, plus $a_{0}$ ), namely $5,9,17$, and 33 , respectively. You can check our recipe by calculating the coefficients for
the lowest-order filter in the figures ( $N=8$ ); you should get

$$
\begin{aligned}
a_{0} & =+0.497374 \\
a_{1}=a_{-1} & =+0.273977 \\
a_{2}=a_{-2} & =0 \\
a_{3}=a_{-3} & =-0.022664 \\
a_{4}=a_{-4} & =0
\end{aligned}
$$

#### An aside: window tradeoffs

We used a Hamming window as the coefficient multiplier for the filters of Figures 6.49 and 6.50, partly out of laziness (it's easy to calculate), and partly because it's a reasonably good window in terms of stopband attenuation ( $\sim 60 \mathrm{~dB}$ ). But, as we remarked above, you can produce better stopband attenuation at the expense of transition-region steepness. This is nicely illustrated in Figure 6.51, where we've redone the $N=32$ half-band lowpass FIR filter using three different window functions. The Blackman-Harris windows are a sum of two or three sinusoidal terms, weighted to produce the minimum sidelobe level. The exact form is

$$
w(k)=a_{0}+a_{1} \cos (2 \pi k / N)+a_{2} \cos (4 \pi k / N)+a_{3} \cos (6 \pi k / N)
$$

where the $a$ 's are given by $\left[a_{0}, a_{1}, a_{2}, a_{3}\right]=[0.42323$, $0.49755,0.07922,0]$ (3-term) and [0.35875, 0.48829, $0.14128,0.01168]$ (4-term). These windows produce impressive stopband attenuation ( $\sim 85 \mathrm{~dB}$ and $\sim 105 \mathrm{~dB}$ ), as compared with the Hamming's $\sim 55 \mathrm{~dB}$, but with correspondingly softer transition regions. It's worth noting that these are calculated responses, and will be realized in practice only if the FIR multiply and add operations are done with adequate arithmetic precision, and if the upstream ADC has correspondingly accurate linearity.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0454.jpg?height=439&width=802&top_left_y=1709&top_left_x=1073)

Figure 6.51. Half-band FIR lowpass filters of order $N=32$, with three choices of coefficient window function. Note the change of vertical scale compared with those of Figures 6.49 and 6.50.

#### E. Implementation

You could set up a DSP filter with discrete hardware - shift registers, multipliers, accumulators, and the like - the stuff of Chapters 10 and 11. But any such attempt would seem quaint by current standards, where general-purpose processors (microprocessors and microcontrollers) let you do the same tasks, and with greater flexibility. Even better, there is a class of digital signal processor chips, optimized for the sort of multiply-accumulate operations you need to do, and generally arranged for efficient flow of lots of data in and out. An example is the TMS320 series from TI, which includes (at time of writing) chips like the TMS320C64xx, which can do a 1k-point fast Fourier transform (FFT) in about $1 \mu \mathrm{~s}$ (!), or a 32 -coefficient FIR on a 10,000 -point data set in $108 \mu \mathrm{~s}$. At the other end of the performance scale, the tiny QF1D512 from Quickfilter Technology is an inexpensive stand-alone chip that performs up to a 512-tap FIR filter on 12- to 24-bit serial data (at audio rates), with 32-bit programmable coefficients. It costs less than $\$ 2$ in small quantities and comes with free design software; you can also get a variety of evaluation kits.

### 6.3.8 Filter miscellany

#### A. Linearity

In some filtering applications it is essential to maintain a high degree of amplitude linearity, even as the filter attenuates some frequencies more than others. This is necessary, for example, in high-quality audio reproduction. For such applications you should use op-amps designed for low distortion (which will be prominently featured on the datasheet), with adequate bandwidth, slew rate, and loop gain; some examples are the LT1115, OPA627, and AD8599; see Table 5.4 on page 310 and the discussion of high-speed op-amps and design issues in $\S 5.8$, and further discussion in Chapter $4 x$. Perhaps less obvious, it's important to choose passive components of good linearity. The primary hazards lying in wait here are the "high- $\kappa$ " ceramic capacitors (which can exhibit astonishing variations of capacitance with applied voltage), and electrolytic capacitors (with their memory effect caused by dielectric absorption - see the discussion in Chapter $l x$. Use film capacitors (ideally polypropylene) or NPO/C0G ceramic.

And for $L C$ (passive) filters it's essential to choose inductors wound on magnetic material of good linearity (a problem that is absent for air-core inductors; the latter are available in reasonable sizes for inductances up to $\sim 1 \mathrm{mH}$ or so).

#### B. Filter-design software

It used to be hard to design filters - but no more! There's plenty of software out there, and it's easy to use. You can set up your passband and stopband requirements for a continuous-time filter (cutoff frequency, stopband frequency, ripple and attenuation, etc.), and the software obliges with a recitation of how many sections will be required, according to the circuit configuration (Sallen-and-Key, state variable, biquad, or MFB) and filter function (Bessel, Butterworth, Chebyshev, elliptic). Then it will draw the circuit, and give you plots of amplitude, phase, and time delay as functions of frequency. And similarly for switched-capacitor filters or digital filters.

Here are some filter design resources we've found useful. Most of these are free (but you have to pay for MMICAD, and for Filter Solutions and Filter Light).

- LC filters:
- http://www-users.cs.york.ac.uk/ fisher/lcfilter/
- MMICAD (Optotek)
- Analog active filters
- FilterPro (TI)
- FilterCAD (LTC)
- ADI Analog Filter Wizard
- http://www.beis.de/Elektronik/Filter/Filter.html
- Digital filters:
- http://www-users.cs.york.ac.uk/ fisher/mkfilter/
- All types
- Filter Solutions, Filter Light, and Filter Free (http://www.nuhertz.com/filter/)

### Review of Chapter 6

An A-to-J summary of what we have learned in Chapter 6. This summary reviews basic principles and facts in Chapter 6, but it does not cover application circuit diagrams and practical engineering advice presented there.

#### ๆA. Filter Overview.

This chapter deals with signals in the frequency domain: by filter we mean a circuit with some deliberate passband and attenuation characteristics (both amplitude and phase) versus frequency. For some applications the filter's timedomain behavior is important also, i.e., the filter's transient response (overshoot and settling time) to a voltage-step input, and its in-band fidelity to an input waveform.

#### IB. Filter Characteristics.

There are the basic shapes - lowpass, highpass, bandpass, and band-stop (notch). There's also the all-pass (or delay equalizer), which has a flat amplitude response, but a varying phase; and there are comb filters that pass (or block) an array of equally spaced frequencies. Important frequencydomain parameters include flatness of response in the passband, depth of attenuation in the stopband, and steepness of falling response in the transition region between. In the time-domain you care about overshoot, settling time, and linearity of phase across the passband (i.e., constancy of time delay).

#### qC. Filter Implementations.

Filters can be built (a) entirely with passive components ( $R$, $L$, and $C$ ); (b) with $R$ 's and $C$ 's, assisted with op-amps; (c) with $C$ 's alone, combined with periodically-clocked analog switches; or (d) with digital processing of the ADCsampled input waveform. These are called passive filters, active filters, switched-capacitor filters, and digital filters, respectively. The term continuous-time filter is sometimes applied to filters of type (a) and (b), and discrete-time filter to (c) and (d). The order of a filter is equal to the number of $C$ 's plus the number of $L$ 's (or equivalent, if implemented digitally). An $n$th order lowpass filter has an ultimate rolloff of $6 n \mathrm{~dB} /$ octave ( $20 n \mathrm{~dB} /$ decade $)$.

#### ID. Passive RC Filters.

Passive $R C$ filters ( $\S 6.2 .1$ ) are the simplest, and good enough for applications such as blocking dc, suppressing high-frequency power-supply noise, or removing signals far from the band of interest. But $R C$ filters, regardless of order, have a soft transition region (Figure 6.2) and are unsuited to separating signals that are nearby in frequency.

Their transfer function is far from the ideal "brick-wall" filter response (see for example Figure 6.11).

#### ПE. Passive LC Filters.

Perhaps surprisingly, combining inductors with capacitors allows you to make all manner of very sharp filters ( $\S 6.2 .2$; see for example Figure 6.5). The classic filter shapes, all implementable with $L C$ filters, are the Butterworth (maximally flat passband), the Chebyshev (sharpest transition region, at the cost of amplitude ripple in the passband), and the Bessel (maximally flat time-delay in the passband). The performance characteristics of these filter types are compared in Table 6.1 and Figures 6.20, 6.21, 6.25-6.27, and 6.30 .

#### IF. Active Filters.

Inductors are non-ideal in several respects (size, linearity, electrical losses; see Chapter $1 x$; but the combination of a capacitor and an op-amp (plus several resistors), in a configuration known as a gyrator ( 86.2 .4 C ), creates an electrical equivalent of an inductor. So you can make an inductorless filter that mimics any $L C$ filter, by simply substituting gyrators for the inductors. More generally, you can make such active filters (\$6.3) with various configurations of opamps, capacitors, and resistors that need not incorporate explicit gyrators.

#### IIG. Active Filter Circuits.

In §6.3.1 we showed how to design the simple and popular VCVS active filter, with tabulated data (Table 6.2) for 2nd-order to 8th-order lowpass or highpass filters, with Butterworth, Chebyshev, or Bessel response. Better performance and tunability is gotten with the state-variable and biquad active filters (\$6.3.3), which require three op-amps for each 2nd-order section. These latter filter topologies are well suited for bandpass filters; see §6.3.3A, where explicit design equations are given. You can get nice state-variable ICs that include the op-amps and capacitors, and can be configured as lowpass, highpass, band-pass, or band-reject, requiring only a few external resistors to set the characteristic cutoff frequencies; examples are the UAF42 and the MAX274. The world is awash with active-filter implementations; some others seen in Chapter 6 include the Sallen-and-Key filter (Figure 6.16), a state-variable variant with independently settable gain and $Q$-factor (Figure 6.32), and the multiple-feedback filter (Figure 6.35).

#### IH. Notch Filters.

In contrast to their generally "soft" frequency characteristics, the $R C$ filter known as a twin-T (\$6.3.4) produces a
deep notch (limited only by component imperfection and mismatching). The twin-T is hard to tune (it requires three tracking adjustable resistors). But a similar $R C$ notch filter (the bridged-differentiator, Figure 6.40) allows a modest range of tunability ( $5: 1$ or so) with a single pot.

#### |ll. Switched-capacitor Filters.

An op-amp combined with a pair of capacitors and a pair of analog switches forms a discrete approximation to a continuous-time integrator (Figure 6.43). This is the building block of the switched-capacitor filter (§6.3.6), easily incorporated into an IC, and conveniently tuned by varying the externally-applied switching frequency. The downside is the production of artifacts related to the switching operation: clock feedthrough, aliasing, and limited dynamic range.

#### ПJ. Digital Filters and DSP.

With ubiquitous embedded microcontrollers and accompanying ADCs, it's natural to implement filtering operations with the machinery of digital signal processing (DSP, §6.3.7). If the signals to be filtered are in the form of ana-
log voltages, they first must be digitized (sampled at regular intervals and converted to a stream of numbers), taking care to sample at a high enough rate (at least twice the highest frequency present in the signal, $\left.f_{\mathrm{samp}} \geq 2 f_{\operatorname{sig}(\max )}\right)$ and with sufficient amplitude accuracy ( $n$-bit quantization yields $6 n \mathrm{~dB}$ dynamic range) to retain adequate fidelity. (If the input signal is already digitized, no sampling is needed, and digital filtering is particularly convenient.)

The stream of numbers representing the successive sampled and digitized signal voltages (call them $x_{i}$ ) is then subjected to a digital filtering operation. Easiest to understand is the finite-impulse-response (FIR) filter, where each output signal amplitude $y_{i}$ is formed from a weighted sum of a finite number $N$ of input samples; i.e., $y_{i}=\sum a_{k} x_{i-k}$, with $k$ going from $-N / 2$ to $N / 2$. If the sum is permitted to include output samples, you've got a recursive filter, also known as an infinite-impulse-response filter. See Figure 6.49 for an example of an FIR lowpass filter. There's plenty of complexity, and plenty of math, in the business of digital filtering; this specialty appeals to EEs who are really applied mathematicians in disguise (you know who you are!).

# 7. OSCILLATORS AND TIMERS

In this chapter we meet oscillators and timers, the circuits that provide the essential "heartbeats" and timing of electronics. As we'll see, many of the important devices and techniques involve a blend of analog and digital electronics. We'll introduce the digital know-how you need for a first look, and point to later sections of the book where you can get a deeper knowledge of digital techniques.

## 7.1 Oscillators

### 7.1.1 Introduction to oscillators

Within nearly every electronic instrument it is essential to have an oscillator or waveform generator of some sort. Apart from the obvious case of signal generators, function generators, and pulse generators themselves, a source of regular oscillations is necessary in any cyclical measuring instrument, in any instrument that initiates measurements or processes, and in any instrument whose function involves periodic states or periodic waveforms. That includes just about everything. For example, oscillators or waveform generators are used in digital multimeters, oscilloscopes, radiofrequency receivers, computers, every computer peripheral (tape, disk, printer, terminal), nearly every digital instrument (counters, timers, calculators, and anything with a "multiplexed display"), every consumer electronic device (cell phone, camera, music or video player or recorder), and a host of other devices too numerous to mention. A device without an oscillator either doesn't do anything or expects to be driven by something else (which probably contains an oscillator). It is not an exaggeration to say that an oscillator of some sort is as essential an ingredient in electronics as is a regulated supply of dc power.

Depending on the application, an oscillator may be used simply as a source of regularly spaced pulses (e.g., a "clock" for a digital system), or demands may be made on its stability and accuracy (e.g., the time base for a frequency counter), its adjustability (e.g., the local oscillator in a transmitter or receiver), or its ability to produce accurate waveforms (e.g., the ramp generator in a dual-slope analog-to-digital converter).

In the following sections we treat briefly the most popular oscillators, from the simple $R C$ relaxation oscillators to the stable quartz-crystal oscillators. Our aim is not to survey everything in exhaustive detail, but simply to make you acquainted with what is available and what sorts of oscillators are suitable in various situations.

### 7.1.2 Relaxation oscillators

A very simple kind of oscillator can be made by charging a capacitor through a resistor (or a current source), then discharging it rapidly when the voltage reaches some threshold, beginning the cycle anew. Alternatively, the external circuit may be arranged to reverse the polarity of the charging current when the threshold is reached, thus generating a triangle wave rather than a sawtooth. Oscillators based on this principle are known as relaxation oscillators. They are inexpensive and simple, and with careful design they can be made reasonably stable (better than $1 \%$ ) in frequency.

#### A. Basic op-amp - comparator relaxation oscillator

In the past, negative-resistance devices such as unijunction transistors and neon bulbs were used to make relaxation oscillators, but current practice favors op-amps, comparators, or special timer ICs. Figure 7.1A shows a classic $R C$ relaxation oscillator. The operation is simple: assume that when power is first applied, the comparator output goes to positive saturation (it's actually a toss-up which way it will go, but it doesn't matter). The capacitor begins charging up toward +5 V , with time constant $R C$. When it reaches onehalf the supply voltage, the op-amp switches into negative saturation (it's a Schmitt trigger), and the capacitor begins discharging toward -5 V with the same time constant. The cycle repeats indefinitely, with period $2.2 R C$, independent of supply voltage.
Exercise 7.1. Show that the period is as stated.
Rail-to-rail CMOS output-stage comparators ${ }^{1}$ (see §§4.3.2A. 12.1.7 and Table 12.2) were chosen because

[^316]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0459.jpg?height=820&width=716&top_left_y=177&top_left_x=165)

Figure 7.1. Classic op-amp (or comparator) relaxation oscillator, using comparators with rail-to-rail output stages. A. Dual supply with symmetrical bipolarity square-wave output. B. Single-supply variant, with parts values (for 10 kHz ), including speed-up capacitor. See also Figure 4.39 in §4.3.3.
their outputs saturate cleanly at the supply voltages. Comparators like the TLC3702 are much faster (its propagation time is $\sim 5 \mathrm{~ns}$ ) than op-amps of similar technology, because they do not need compensation for stable operation with negative feedback (see §4.9), so they are a good choice if you want to go above a few kilohertz. The bipolar LM6132-54 series of op-amps also swings rail-to-rail and, unlike their CMOS cousins, allows operation at a full $\pm 15 \mathrm{~V}$. However, if op-amps (rather than comparators) are used, this circuit makes considerable demands on the op-amp speed, because the output square wave goes rail-to-rail; even something like the LM6152, with its $f_{\mathrm{T}}$ of 75 MHz and large-signal slew rate of $45 \mathrm{~V} / \mu \mathrm{s}$, has enough speed for operation only up to 100 kHz or so. Note that this circuit does not operate the op-amp in the linear region, with the customary negative feedback; ${ }^{2}$ so you could use an uncompensated op-amp (see §4.9) for better speed.

You can run this kind of circuit from a single supply voltage, as shown in Figure 7.1B, if you add one resistor. Here we've taken advantage of the faster comparators that are available for lower supply voltages only. The TLV3501 (supply voltage range of 2.7 V to 5.5 V only) has a propagation time of just 3 ns in this circuit, allowing operation

[^317]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0459.jpg?height=656&width=628&top_left_y=177&top_left_x=1061)

Figure 7.2. Relaxation oscillator with CMOS digital logic inverters. A. Beware conventional wisdom! B. Taming parasitic instabilities with a small speed-up capacitor $C_{2}$.
up to tens of megahertz; here it's loafing along at a mere $10 \mathrm{kHz} .^{3}$

By using current sources (instead of resistors) to charge the capacitor, a good triangle wave can be generated. A clever circuit using that principle was shown in §4.3.3.

#### B. CMOS logic relaxation oscillators

You can build simpler $R C$ relaxation oscillators by using CMOS digital logic inverters (Chapters 10-12) instead of an op-amp or comparator. Figure 7.2A shows a circuit often seen in the literature. ${ }^{4}$ The good news is that it's simple; the bad news is that it doesn't work! Specifically, its output waveform has ragged edges, plagued with fast ( $\sim 100 \mathrm{MHz}$ ) parasitic oscillations at each transition; this is due to the relatively slow rise time at the input to the first inverter (caused by capacitive loading). The final (good) news is that there's a simple fix, namely the inclusion of a small speed-up capacitor ( $C_{2}$ in Figure 7.2B). Figure 7.3 shows measured waveforms, both for the conventional circuit (Figure 7.2A), and for the improved circuit.

One slightly worrisome aspect of this circuit is the fact that the input protection diodes are forced into conduction each cycle by the charged capacitor $C_{1}$; it's not really a

[^318]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0460.jpg?height=516&width=797&top_left_y=219&top_left_x=221)

Figure 7.3. Parasitic oscillations plague the simple oscillator circuit of Figure 7.2A. The upper pair of waveforms show an $\sim 90 \mathrm{MHz}$ instability on the rising and falling edges of a 1 kHz oscillator (made with commonplace 74 HC 04 logic running at 5 V ). Adding a 47 pF speed-up capacitor (Figure 7.2B) cleans it up nicely. Horizontal: $40 \mathrm{~ns} / \mathrm{div}$; vertical: $5 \mathrm{~V} / \mathrm{div}$
problem, however, because the current is safely limited by $R_{2}$. But if it bothers you, you'll like the circuit of Figure 7.4 A , where a $2: 1$ voltage divider reduces the swing applied to the capacitor, preventing input clamping. Figure 7.4B is another variation on the logic oscillator theme, taking aim at the parasitic oscillation problem. When we breadboarded these two oscillators on the test bench, however, we found it still necessary to include the 47 pF speedup capacitors to eliminate parasitics.

You can make an even simpler CMOS oscillator by just hooking $R C$ feedback around a CMOS logic inverter with Schmitt trigger input (Figure 7.5). It is guaranteed to oscillate, with clean output transitions and a full logic swing. However, its frequency is not particularly well determined, because hysteresis is not a well-controlled parameter in logic ICs - it's provided to clean up slow inputs, not to do anything precise (you're lucky to get it at all!). The 74HC14, for example, specifies only that the hysteresis amplitude (that is, the difference between rising and falling thresholds) is somewhere between 0.5 V and $1.5 \mathrm{~V}!^{5}$ That means you can expect a frequency spread of $50 \%$ or more among oscillators with the same $R$ and $C$ values. The frequency will also vary with supply voltage; we found frequency approximately proportional to supply voltage for the oscillator of Figure 7.5. Finally, this oscillator generates a somewhat unstable output, with as much as a few percent "jitter" in the timing of successive edges (enough

[^319]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0460.jpg?height=741&width=715&top_left_y=211&top_left_x=1117)

Figure 7.4. CMOS relaxation oscillator variants. A. Half-scale swing prevents input diode clamping (J. Thompson's design). B. Improved stability with one inverter and one buffer ( E . Wielandt's design). In our test setup the 47 pF capacitor was needed to prevent parasitics.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0460.jpg?height=246&width=569&top_left_y=1221&top_left_x=1190)

Figure 7.5. Simplest CMOS oscillator.
to see on an oscilloscope), with sensitivity to digital noise on the power supply.

#### C. Unijunction transistor relaxation oscillator

There are several ways to make a relaxation oscillator that exploit the "negative-resistance" characteristic of devices such as tunnel diodes, gas-filled discharge tubes, diacs, and unijunction transistors. In the circuit of Figure 7.6, for example, the programmable unijunction transistor (PUJT) is a 3-terminal, 4-layer (pnpn) device; it looks like an open circuit to the charging $R C$ until the capacitor voltage reaches a diode drop above the gate (G) voltage (set by the $R_{2} R_{3}$ divider), at which point the PUJT conducts heavily from anode (A) to cathode ( K ), discharging the capacitor and beginning a new cycle. The discharge current turns on the output transistor switch, generating a saturated output pulse to ground. With the values shown, the oscillator
generates $10 \mu \mathrm{~s}$ negative-going output pulses at 10 Hz , with a total supply current of just $1 \mu \mathrm{~A}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0461.jpg?height=470&width=595&top_left_y=329&top_left_x=223)

Figure 7.6. Programmable unijunction transistor (PUJT) relaxation oscillator.

Continuing this theme, Figure 7.7 shows a couple of funky oscillators that we couldn't resist hooking up, just to remind us of the old days of electronics. They also exploit "snapback" negative resistance, at somewhat higher voltages than the PUJT, in this case of a neon lamp and a 4-layer diac; the latter is widely used as a triac trigger in phase-control ac powerline dimmers (of the sort that are common in residential wall switches).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0461.jpg?height=733&width=766&top_left_y=1394&top_left_x=140)

Figure 7.7. Two unusual relaxation oscillators that exploit devices with a negative-resistance "snapback" VI characteristic. The Littelfuse HT32 and ST32 diacs were discontinued in 2009, but you can get the comparable DB3 from at least three manufacturers.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0461.jpg?height=772&width=799&top_left_y=221&top_left_x=973)

Figure 7.8. Block diagram of the legendary 555 in its contemporary CMOS implementation.

### 7.1.3 The classic oscillator-timer chip: the $\mathbf{5 5 5}$

The next level of sophistication involves the use of timer or waveform-generator ICs as relaxation oscillators. The most popular chip around is the legendary 555 (and its many successors), designed originally in 1970 by Hans Camenzind at Signetics. It is also a misunderstood chip, and we intend to set the record straight with the equivalent circuit shown in Figure 7.8. Some of the symbols belong to the digital world (Chapter 10 and following), so you won't become a 555 expert for a while yet. But the operation is simple enough: the output goes HIGH (near $V_{\mathrm{CC}}$ ) when the 555 receives a $\overline{\text { TRIGGER }}$ input, and it stays there until the THRESHOLD input is driven, at which time the output goes LOW (near ground) and the DISCHARGE transistor is turned on. The TRIGGER input is activated by an input level below $\frac{1}{3} V_{\mathrm{CC}}$, and the THRESHOLD is activated by an input level above $\frac{2}{3} V_{\mathrm{CC}}$.

The easiest way to understand the workings of the 555 is to look at an example (Figure 7.9). Before power is applied, the capacitor is discharged; so when power is applied the 555 is triggered, causing the output to go HIGH, the discharge transistor $Q_{1}$ to turn off, and the capacitor to begin charging toward 15 V through $R_{\mathrm{A}}+R_{\mathrm{B}}$. When it has reached $\frac{2}{3} V_{\text {CC }}(+10 \mathrm{~V})$, the THRESHOLD input is triggered, causing the output to go Low and $Q_{1}$ to turn on, discharging $C$ toward ground through $R_{\mathrm{B}}$. Operation is now cyclic, with $C$ 's voltage going between $\frac{1}{3} V_{\mathrm{CC}}$ and $\frac{2}{3} V_{\mathrm{CC}}$, with period
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0462.jpg?height=424&width=726&top_left_y=186&top_left_x=257)

Figure 7.9. The 555 connected as an oscillator.
$T=0.693\left(R_{\mathrm{A}}+2 R_{\mathrm{B}}\right) C$. The output you generally use is the square wave ${ }^{6}$ at the output.

Exercise 7.2. Show that the period is as advertised, independent of supply voltage.

The original (bipolar-transistor version) 555 makes a respectable oscillator, with stability approaching $1 \%$. It can run from a single positive supply of 4.5 to $16 \mathrm{~V},^{7}$ maintaining good frequency stability with supply-voltage variations because the thresholds track the supply fluctuations. The 555 can also be used as a timer to generate single pulses of arbitrary width (see §7.2.1E), as well as a bunch of other things. It is really a small kit, containing comparators, gates, and flip-flops. It has become a game in the electronics industry to try to think of new uses for the 555 you too can become an alpha-nerd!

A caution about the bipolar 555: many versions of this IC (in common with some other timer chips) generate a big supply-current glitch (as much as 150 mA ) during each output transition. ${ }^{8}$ Be sure to use a hefty bypass capacitor near the chip. Even so, the 555 may have a tendency to generate double output transitions; the CMOS versions (discussed next) are better in this regard, but still not cured of all bad behavior.

#### A. CMOS 555s

Some of the less-desirable properties of the original bipolar 555 (high supply current, high trigger current, double

[^320]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0462.jpg?height=517&width=817&top_left_y=180&top_left_x=1061)

Figure 7.10. More CMOS 555 oscillator circuits. A. $50 \%$ duty cycle (square wave). B. Constant frequency, with fully variable duty cycle.
output transitions, and inability to run with very low supply voltage) have been remedied in a collection of CMOS successors. You can recognize these by the tell-tale "555" somewhere in the part number. Table 7.1 on the next page lists most of these that we could find, along with their important specifications. Note particularly the ability to operate at very low supply voltage (down to 1 V ) and the generally low supply current. These chips also can run at higher frequency than the original 555. The CMOS output stages give rail-to-rail swing, at least at low load currents (but note that these chips don't have the output-current muscle of the standard 555). All chips listed are CMOS except for the original 555 and the ZSCT1555.

#### B. $50 \%$ duty cycle

The 555 oscillator of Figure 7.9 generates a rectangularwave output whose duty cycle (fraction of time the output is HIGH) is always greater than $50 \%$. That is because the timing capacitor is charged through the series pair $R_{\mathrm{A}}+R_{\mathrm{B}}$, but discharged (more rapidly) through $R_{\mathrm{B}}$ alone. But you can make a CMOS 555 (with its rail-to-rail output swing) give you exactly $50 \%$ duty cycle (a true square wave) with the circuit of Figure 7.10A. The trick is to use a single charge-discharge resistor, connected to the output; so the capacitor is either charging toward $+V_{\mathrm{CC}}$ (with $\frac{2}{3} V_{\mathrm{CC}}$ threshold) or discharging toward ground (with $\frac{1}{3} V_{\mathrm{CC}}$ threshold). It's like two people throwing a ball back and forth, with a dog tirelessly zigzagging back and forth, trying to catch it. ${ }^{9}$ You should be able to show that $f_{\text {osc }}=$ $0.72 / R C$.

Exercise 7.3. Show that this result is correct.

[^321]Table 7.1 555-type Oscillators ${ }^{a}$

| Part \# | Mfg | Qty per package |  |  | Supply voltage |  | $\begin{gathered} \text { Supply } \\ \text { current/osc } \\ \hline \text { typ @ 5V } \\ (\mu \mathrm{A}) \end{gathered}$ | $\begin{gathered} \begin{array}{l} \text { Trig \& thresh } \\ \text { current } \end{array} \\ \hline \begin{array}{c} \text { (nA) } \end{array} \end{gathered}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0463.jpg?height=111&width=128&top_left_y=325&top_left_x=1283) | $R_{\text {out }}$ |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  |  |  | 5V |  |  |  |
|  |  |  |  |  | min <br> (V) | max <br> (V) |  |  |  | sink <br> ( $\Omega$ ) | source ( $\Omega$ ) |
| 555 |  | $\cdot$ | $\cdot$ | - |  |  | 4.5 | 18 | 3000 | 2000 | 0.5 | $12^{\text {b }}$ | $100^{\circ}$ |
| ZSCT1555 | ZT | $\cdot$ | _ | - | 0.9 | 6 | 150 | 100 | $0.3^{\text {d }}$ | $35^{\text {e }}$ | $0.15^{\text {e }}$ |
| ICM7555 | IL | $\cdot$ | $\cdot$ | - | 2 | 18 | 60 | 10 | 1 | 50 | 400 |
| TLC551 | TI | $\cdot$ | $\cdot$ | - | 1 | 18 | $15^{f}$ | $0.01^{t}$ | 1.8 | 25 | 200 |
| TLC555 | TI | $\cdot$ | - | - | 2 | 18 | 170 | $0.01^{t}$ | 2.1 | 25 | 200 |
| LMC555 | NS | $\cdot$ | $\cdot$ | - | 1.5 | 15 | 100 | $0.01^{t}$ | 3 | 40 | 150 |
| ALD555 | AL | $\cdot$ | - | - | 2 | 12 | 100 | 0.2 | 2 | 20 | 250 |
| ALD1502 | AL | $\cdot$ | $\cdot$ | $\cdot$ | 2 | 12 | 50 | 0.4 | 2.5 | 20 | 200 |
| MIC1555 | MI | $\cdot$ | - | - | 2.7 | 18 | 240 | 50 | 59 | 25 | 100 |

Notes: (a) all are CMOS except first two (bipolar) entries. (b) $I_{0}(\mathrm{~mA})$ at $V_{\mathrm{o}}=0.3 \mathrm{~V}$. (c) $I_{0}(\mathrm{~mA})$ at $V_{\text {sat }}=1.7 \mathrm{~V}$. (d) min, @ $V_{\mathrm{S}}=1.5 \mathrm{~V}$. (e) $I_{\mathrm{O}}(\mathrm{mA})$ at $V_{\mathrm{sat}}= \pm 0.35 \mathrm{~V}$ and $V_{\mathrm{s}}=1.5 \mathrm{~V}$. (f) at $V_{\mathrm{s}}=1 \mathrm{~V}$. (g) at $V_{\mathrm{s}}=8 \mathrm{~V}$. ( t ) typical.

#### C. Full duty cycle control

Figure 7.10B shows how to make a fixed-frequency output whose duty cycle can be varied from near $0 \%$ to near $100 \%$. The frequency would be completely constant, and independent of the duty-cycle setting, except for the effect of the diode drop during charging; that's why we used a low-drop ( $V_{\mathrm{F}}=0.3 \mathrm{~V}$ at 10 mA ) SD103C Schottky diode.
Exercise 7.4. Show that $f_{\text {osc }}=1.44 / R C$.

#### D. Sawtooth oscillator

By using a current source to charge the timing capacitor, you can make a ramp (or "sawtooth-wave") generator. Figure 7.11A shows how, using a simple pnp current source. The ramp charges to $\frac{2}{3} V_{\mathrm{CC}}$, then discharges rapidly (through the 555's npn discharge transistor, pin 7) to $\frac{1}{3} V_{\mathrm{CC}}$, beginning the ramp cycle anew. Note that the ramp waveform appears on the capacitor terminal and must be buffered with an op-amp since it is at high impedance. In practice, this circuit exhibits a subtle flaw: when a small value capacitor is used, the discharge is so rapid that the bottom of the sawtooth drops below $\frac{1}{3} V_{\mathrm{CC}}$ before the discharge transistor shuts off. This is remedied, as shown, by the inclusion of a small resistor in series with the $\overline{\text { DIS }}$ pin, chosen for a discharge time constant of $\sim 5 \mu \mathrm{~s} .{ }^{10}$

Figure 7.11B shows an alternative, namely to delay the falling-edge signal to $\mathrm{TR}^{\prime}$ so that the discharge interval is extended long enough to ensure complete discharge; $1 \mu \mathrm{~s}$ was adequate, for the circuit values shown.

In Figure 7.11B we drew a current source symbol, be-

[^322]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0463.jpg?height=1041&width=588&top_left_y=875&top_left_x=1081)

Figure 7.11. Sawtooth oscillators with the CMOS 555. A. Discrete $p n p$ current source charges $C$, whose discharge is slowed to prevent $V_{+} / 3$ undershoot. B. Delayed TR' on falling edge causes full discharge to 0 V .
cause there are several alternatives to the discrete pnp current source. Figure 7.12 shows some simple 2 -terminal favorites, namely a JFET "current regulator diode," and two integrated circuits. As discussed in §3.2.2, a JFET with
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0464.jpg?height=420&width=187&top_left_y=188&top_left_x=223)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0464.jpg?height=392&width=236&top_left_y=221&top_left_x=469)
B.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0464.jpg?height=240&width=144&top_left_y=209&top_left_x=691)

LM334
$\left(I=\frac{60 \mathrm{mV}}{R}\right.$ )
C.
<img class="imgSvg" id = "m2y4u49dw2fi8ha7rwj" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0yeTR1NDlkdzJmaThoYTdyd2oiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDIxMCA5Ni41NTk2Mjg3MTMwMTE5OSIgc3R5bGU9IndpZHRoOiAyMDkuOTk5OTk5OTk5OTQ5MjRweDsgaGVpZ2h0OiA5Ni41NTk2Mjg3MTMwMTE5OXB4OyBvdmVyZmxvdzogdmlzaWJsZTsiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTM2LjQ5OTk5OTk5OTk2MTk0IiB5MT0iNDguMjc5ODQyNjMxMTIwMzQ2IiB4Mj0iMTY3Ljk5OTk5OTk5OTk0OTI0IiB5Mj0iNDguMjc5ODcwOTA1NzM0NzI1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTMiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTE3LjQxNDYxNjQ2NzM0NjI2IiB5MT0iNjkuOTk2NjQ1Njk3MjQ3NzkiIHgyPSIxMzAuMDE0NjM2MDU2NTY4NjMiIHkyPSI0OC4xNzI4MTY4MzE3MzQ0NjUiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMjAuNzQ5OTc1NTEzNDMzOTUiIHkxPSI3NS41NTk2Mjg3MTMwMTE5OSIgeDI9IjEzNi40OTk5OTk5OTk5NjE5NCIgeTI9IjQ4LjI3OTg0MjYzMTEyMDM0NiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai03IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEyMC43NTAwMjQ0ODY1MDI1NSIgeTE9IjIxLjAwMDAyODI3NDYxNDMyMyIgeDI9IjEzNi40OTk5OTk5OTk5NjE5NCIgeTI9IjQ4LjI3OTg0MjYzMTEyMDM0NiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai05IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5MT0iNzUuNTU5NjAwNDM4Mzk3NjciIHgyPSIxMjAuNzQ5OTc1NTEzNDMzOTUiIHkyPSI3NS41NTk2Mjg3MTMwMTE5OSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai0xMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI5Mi40MDAwMTkzOTcwODM0MSIgeTE9IjI2LjY3MDAwMjgyNzQ1OTE0MyIgeDI9IjExNy42MDAwMTkzOTcwNzMyNSIgeTI9IjI2LjY3MDAyNTQ0NzE1MDYwNyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai0xMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4OS4yNTAwMjQ0ODY1MTUyNiIgeTE9IjIxIiB4Mj0iMTIwLjc1MDAyNDQ4NjUwMjU1IiB5Mj0iMjEuMDAwMDI4Mjc0NjE0MzIzIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTE1IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijc5Ljk4NTM2NDEzNTUwNDMxIiB5MT0iNDguMTcyNzcxOTI1MTE5NTgiIHgyPSI5Mi41ODUzNDQ1NDYyNzE4MSIgeTI9IjY5Ljk5NjYyMzQxMDMyNDM5Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTE3IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjczLjQ5OTk5OTk5OTk4NzMxIiB5MT0iNDguMjc5Nzg2MDgxODkxNjciIHgyPSI4OS4yNDk5NzU1MTM0NDY2NyIgeTI9Ijc1LjU1OTYwMDQzODM5NzY3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTE5IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjczLjQ5OTk5OTk5OTk4NzMxIiB5MT0iNDguMjc5Nzg2MDgxODkxNjciIHgyPSI4OS4yNTAwMjQ0ODY1MTUyNiIgeTI9IjIxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjQyIiB5MT0iNDguMjc5NzU3ODA3Mjc3MzM1IiB4Mj0iNzMuNDk5OTk5OTk5OTg3MzEiIHkyPSI0OC4yNzk3ODYwODE4OTE2NyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PG1hc2sgaWQ9InRleHQtbWFzay1tMnk0dTQ5ZHcyZmk4aGE3cndqIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjxjaXJjbGUgY3g9IjE2Ny45OTk5OTk5OTk5NDkyNCIgY3k9IjQ4LjI3OTg3MDkwNTczNDcyNSIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48Y2lyY2xlIGN4PSI0MiIgY3k9IjQ4LjI3OTc1NzgwNzI3NzMzNSIgcj0iNy44NzUiIGZpbGw9ImJsYWNrIj48L2NpcmNsZT48L21hc2s+PHN0eWxlPgogICAgICAgICAgICAgICAgLmVsZW1lbnQtbTJ5NHU0OWR3MmZpOGhhN3J3aiB7CiAgICAgICAgICAgICAgICAgICAgZm9udDogMTRweCBIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGFsaWdubWVudC1iYXNlbGluZTogJ21pZGRsZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuc3ViLW0yeTR1NDlkdzJmaThoYTdyd2ogewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTJ5NHU0OWR3MmZpOGhhN3J3aikiPjxsaW5lIHgxPSIxMzYuNDk5OTk5OTk5OTYxOTQiIHkxPSI0OC4yNzk4NDI2MzExMjAzNDYiIHgyPSIxNjcuOTk5OTk5OTk5OTQ5MjQiIHkyPSI0OC4yNzk4NzA5MDU3MzQ3MjUiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMTcuNDE0NjE2NDY3MzQ2MjYiIHkxPSI2OS45OTY2NDU2OTcyNDc3OSIgeDI9IjEzMC4wMTQ2MzYwNTY1Njg2MyIgeTI9IjQ4LjE3MjgxNjgzMTczNDQ2NSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otMycpIj48L2xpbmU+PGxpbmUgeDE9IjEyMC43NDk5NzU1MTM0MzM5NSIgeTE9Ijc1LjU1OTYyODcxMzAxMTk5IiB4Mj0iMTM2LjQ5OTk5OTk5OTk2MTk0IiB5Mj0iNDguMjc5ODQyNjMxMTIwMzQ2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai01JykiPjwvbGluZT48bGluZSB4MT0iMTIwLjc1MDAyNDQ4NjUwMjU1IiB5MT0iMjEuMDAwMDI4Mjc0NjE0MzIzIiB4Mj0iMTM2LjQ5OTk5OTk5OTk2MTk0IiB5Mj0iNDguMjc5ODQyNjMxMTIwMzQ2IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai03JykiPjwvbGluZT48bGluZSB4MT0iODkuMjQ5OTc1NTEzNDQ2NjciIHkxPSI3NS41NTk2MDA0MzgzOTc2NyIgeDI9IjEyMC43NDk5NzU1MTM0MzM5NSIgeTI9Ijc1LjU1OTYyODcxMzAxMTk5IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTJ5NHU0OWR3MmZpOGhhN3J3ai05JykiPjwvbGluZT48bGluZSB4MT0iOTIuNDAwMDE5Mzk3MDgzNDEiIHkxPSIyNi42NzAwMDI4Mjc0NTkxNDMiIHgyPSIxMTcuNjAwMDE5Mzk3MDczMjUiIHkyPSIyNi42NzAwMjU0NDcxNTA2MDciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTExJykiPjwvbGluZT48bGluZSB4MT0iODkuMjUwMDI0NDg2NTE1MjYiIHkxPSIyMSIgeDI9IjEyMC43NTAwMjQ0ODY1MDI1NSIgeTI9IjIxLjAwMDAyODI3NDYxNDMyMyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otMTMnKSI+PC9saW5lPjxsaW5lIHgxPSI3OS45ODUzNjQxMzU1MDQzMSIgeTE9IjQ4LjE3Mjc3MTkyNTExOTU4IiB4Mj0iOTIuNTg1MzQ0NTQ2MjcxODEiIHkyPSI2OS45OTY2MjM0MTAzMjQzOSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otMTUnKSI+PC9saW5lPjxsaW5lIHgxPSI3My40OTk5OTk5OTk5ODczMSIgeTE9IjQ4LjI3OTc4NjA4MTg5MTY3IiB4Mj0iODkuMjQ5OTc1NTEzNDQ2NjciIHkyPSI3NS41NTk2MDA0MzgzOTc2NyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otMTcnKSI+PC9saW5lPjxsaW5lIHgxPSI3My40OTk5OTk5OTk5ODczMSIgeTE9IjQ4LjI3OTc4NjA4MTg5MTY3IiB4Mj0iODkuMjUwMDI0NDg2NTE1MjYiIHkyPSIyMSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0yeTR1NDlkdzJmaThoYTdyd2otMTknKSI+PC9saW5lPjxsaW5lIHgxPSI0MiIgeTE9IjQ4LjI3OTc1NzgwNzI3NzMzNSIgeDI9IjczLjQ5OTk5OTk5OTk4NzMxIiB5Mj0iNDguMjc5Nzg2MDgxODkxNjciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMnk0dTQ5ZHcyZmk4aGE3cndqLTIxJykiPjwvbGluZT48L2c+PGc+PHRleHQgeD0iMTY0LjA2MjQ5OTk5OTk0OTI0IiB5PSI1My41Mjk4NzA5MDU3MzQ3MjUiIGNsYXNzPSJlbGVtZW50LW0yeTR1NDlkdzJmaThoYTdyd2oiIGZpbGw9ImN1cnJlbnRDb2xvciIgc3R5bGU9IgogICAgICAgICAgICAgICAgdGV4dC1hbmNob3I6IHN0YXJ0OwogICAgICAgICAgICAgICAgd3JpdGluZy1tb2RlOiBob3Jpem9udGFsLXRiOwogICAgICAgICAgICAgICAgdGV4dC1vcmllbnRhdGlvbjogbWl4ZWQ7CiAgICAgICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogbm9ybWFsOwogICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBsdHI7CiAgICAgICAgICAgICI+PHRzcGFuPlk8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSIxNjcuOTk5OTk5OTk5OTQ5MjQiIHk9IjQ4LjI3OTg3MDkwNTczNDcyNSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTM2LjQ5OTk5OTk5OTk2MTk0IiB5PSI0OC4yNzk4NDI2MzExMjAzNDYiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyMC43NDk5NzU1MTM0MzM5NSIgeT0iNzUuNTU5NjI4NzEzMDExOTkiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5PSI3NS41NTk2MDA0MzgzOTc2NyIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNzMuNDk5OTk5OTk5OTg3MzEiIHk9IjQ4LjI3OTc4NjA4MTg5MTY3IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI0Ny4yNSIgeT0iNTMuNTI5NzU3ODA3Mjc3MzM1IiBjbGFzcz0iZWxlbWVudC1tMnk0dTQ5ZHcyZmk4aGE3cndqIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogaG9yaXpvbnRhbC10YjsKICAgICAgICAgICAgICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkOwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IG5vcm1hbDsKICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogcnRsOyB1bmljb2RlLWJpZGk6IGJpZGktb3ZlcnJpZGU7CiAgICAgICAgICAgICI+PHRzcGFuPkk8L3RzcGFuPjwvdGV4dD48dGV4dCB4PSI0MiIgeT0iNDguMjc5NzU3ODA3Mjc3MzM1IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI4OS4yNTAwMjQ0ODY1MTUyNiIgeT0iMjEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEyMC43NTAwMjQ0ODY1MDI1NSIgeT0iMjEuMDAwMDI4Mjc0NjE0MzIzIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+"/>
D.

Figure 7.12. Current-source choices for the sawtooth oscillator.
gate tied to source runs at constant current when biased with $\gtrsim 1 \mathrm{~V}$; these are available as packaged 2-terminal devices, in a limited range of currents ( $0.43 \mathrm{~mA}-4.7 \mathrm{~mA}$ ), and with operation up to 100 V . The LM334 is also a 2-terminal (floating) current source, with a third pin that lets you program the current by connecting a resistor as shown; the current is approximately ${ }^{11} 60 \mathrm{mV} / R$, and, like the JFET, works down to $\sim 1 \mathrm{~V}$ (its maximum is 40 V ). The REF200 is a temperature compensated 2-terminal (floating) $100 \mu \mathrm{~A}$ current source (with several selectable multiples), operable from $2-40 \mathrm{~V}$.

#### Ratiometric sawtooth oscillator

And now for an interesting variation. In many situations you want a stable current source like the REF200, designed to deliver a current that does not depend on the voltage across it (the REF200 is quite good in this regard, its current varying less than $0.1 \%$ for voltages from 2 V to 30 V; see Figure 9.37). And that would be fine here, delivering a constant frequency sawtooth in the circuit of Figure 7.11B - providing, of course, that the 555's thresholds stay constant. But if the supply voltage (here $V_{+}=+15 \mathrm{~V}$ ) were to change, the thresholds would follow proportionally (at $V_{+} / 3$ and $2 V_{+} / 3$ ), and the frequency of oscillation would change. And this would happen if you were to use something like a 9 V battery for your $V_{+}$supply.

There's an elegant way to finesse this problem, namely to make the current source's output proportional to supply voltage, which compensates exactly for the frequency change that would otherwise occur. This is the technique of ratiometric design, elegant and powerful. The simple pnp current source of Figure 7.12A is almost what you want: it would be exactly right except for the $\sim 0.6 \mathrm{~V}$ base-emitter drop. And you can fix that by rigging up a transistor current source with $V_{\mathrm{BE}}$ cancellation.

[^323]Look at Figure 7.13: in the first circuit a diode in the base divider adds a voltage drop that approximately matches the transistor's base-emitter drop. That's pretty good, but not ideal because (a) the $V_{\mathrm{BE}}$ match is imperfect, and (b) the diode's drop means that the voltage drop across $R_{1}$ is not quite proportional to $V_{+}$(figure out why).

This is fixed in the second circuit (Figure 7.13B), where $Q_{1}$ 's base voltage tracks $V_{+}$exactly, and its $V_{\mathrm{BE}}$ downward drop cancels $Q_{2}$ 's drop going back up. It's imperfect only insofar as the $V_{\mathrm{BE}}$ 's aren't equal, both because of transistor mismatch and because of $I_{\mathrm{C}}$ mismatch (à la Ebers-Moll). The third circuit fixes the $V_{\mathrm{BE}}$ mismatch (by using matched transistors operating at the same current), but it's got the not-quite-proportional current problem of Figure 7.12A; that is, the current through "programming resistor" $R_{\mathrm{p}}$ is proportional to $V_{+}-V_{\mathrm{BE}}$. Note, by the way, that this circuit is the classic current mirror that we saw back in §2.3.7.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0464.jpg?height=437&width=838&top_left_y=955&top_left_x=1063)

Figure 7.13. Current sources with output approximately proportional to the supply voltage ( $I_{\text {out }} \propto V_{+}$), to make $f_{\text {out }}$ in Figure 7.11 independent of supply voltage.

#### E. Triangle oscillator

Figure 7.14 shows a simple way to generate a triangle wave with a CMOS 555. The rail-to-rail output square wave is used to generate a current source-sink (of alternating polarity), producing a triangle waveform (going between the usual $\frac{1}{3} V_{\mathrm{CC}}$ and $\frac{2}{3} V_{\mathrm{CC}}$ ) at the capacitor. The configuration of diodes is the familiar bridge rectifier (§1.6.2), here used to trick the unipolar 2-terminal current-source device into thinking that the current is always flowing in the same (normal) direction, whereas to the outside world it's a bidirectional current source. (You can think of the bridge as presenting to the current source a rectified version of the alternating-polarity external current.) We used Schottky diodes here, to minimize the two-diode forward drop of the bridge. As with the sawtooth oscillator, you have to buffer the high-impedance waveform with an op-amp. This
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0465.jpg?height=486&width=587&top_left_y=219&top_left_x=227)

Figure 7.14. Triangle-wave oscillator with the 555. This circuit requires a floating (2-terminal) current source, as in Figure 7.12B-D.
circuit is simple (taking advantage of the oscillatororiented innards of the 555), but its performance is not nearly as good as the more elaborate op-amp-based circuit of Figure 4.39 on page 239 or Figure 4.83 on page 267.
Exercise 7.5. Demonstrate that you understand the circuits of Figures 7.11 and 7.14 by calculating the frequency of oscillation in each case.

### 7.1.4 Other relaxation-oscillator ICs

The classic 555 spawned compatible and improved CMOS successors, as we've seen; it's still alive and well. And it is flexible enough to do lots of good tasks, including timing and pulse generation, which we treat later in the chapter. But there's been a lot of progress in semiconductor electronics since the 555's introduction in 1971, and you can get some very nice contemporary oscillator-timer chips that may well be your better choice. ${ }^{12}$ Here are a few of our favorites.

#### A. LTC1799 and LTC6900 series

These elegant ICs come from the wizards at Linear Technology, who call them "silicon oscillators." The LTC1799 runs from a single positive 2.7 V to 5.5 V supply (drawing about a milliamp), it generates a $50 \%$ duty-cycle rail-to-rail square-wave output, and its output frequency is set by a single external resistor (or current source). It operates from 1 kHz to 33 MHz (it has an internal $\div 1$, $\div 10$, or $\div 100$ frequency divider, $N$, selected by tying the DIV input LOW, open, or HIGH, to produce its 33,000:1

[^324]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0465.jpg?height=376&width=677&top_left_y=210&top_left_x=1039)

Figure 7.15. The LTC1799 (and its descendants) generates stable rail-to-rail square waves with single-resistor programming.
range). That's it - one external component, and off you go! It has very good accuracy ( $\pm 0.5 \%$, typ), temperature stability ( $\pm 0.004 \% /{ }^{\circ} \mathrm{C}$, typ), and voltage coefficient $( \pm 0.05 \% / V)$ Figure 7.15 shows how to use it. The similar LTC6900 series includes the LTC6900 (somewhat lower power consumption), the LTC6905 ( $17 \mathrm{MHz}-170 \mathrm{MHz}$ ), and the LTC6903/4 ( $1 \mathrm{kHz}-68 \mathrm{MHz}$, programmed via a 3wire serial digital connection). The latter part would be particularly well suited to a system with a resident microcontroller (Chapter 15), which can effortlessly send digital commands hither and yon.

Figure 7.16 shows the dependence of output frequency on resistor value. If you like equations, you may be happier with this:

$$
f_{\mathrm{osc}}=\frac{1}{N} \cdot \frac{100}{R(\mathrm{k} \Omega)} \quad \mathrm{MHz}
$$

Because the frequency is set by an input current at the SET input terminal, you can use instead an externally generated current to adjust the frequency (we'll call it an "ICO," for "current-controlled oscillator"), keeping in mind that the SET input sits approximately 1.13 V below the positive rail. For current programming the datasheet suggests currents in the range of $5 \mu \mathrm{~A}$ to $200 \mu \mathrm{~A}$, with $\times 10$ range switching as before (which could be done electrically, for example with 3-state logic or with a pair of transistor switches). The $V_{+}$-referenced voltage level at the SET input makes voltage programming a bit awkward: the datasheet suggests one method, namely to apply a control voltage through a second resistor to the SET input, to add or subtract a variable current from that supplied by $R_{\mathrm{SET}}$; but this method has its problems, and you're probably best off just generating a current externally to drive SET.

#### B. LTC699x "TimerBlox"

A few years after their LTC1799/6900, Linear Technology introduced the "TimerBlox ${ }^{\circledR}$ " series of timing functions - oscillators, pulse-width modulators, one-shots
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0466.jpg?height=558&width=759&top_left_y=221&top_left_x=238)

Figure 7.16. LTC1799 output-frequency programming. The manufacturer advises you to stay on the solid lines for best accuracy.
(monostables), and delay/debounce. Rather than trying to make a "one size fits all" chip (with lots of pins), they instead tailored separate chips, in the small 6-pin SOT23-6 package, or the even-smaller $2 \mathrm{~mm} \times 3 \mathrm{~mm}$ DFN package. These chips share many properties, for example a singlesupply ( $2.25-5.5 \mathrm{~V}$ ), good out-of-the-box accuracy ( $\sim 2 \%$ worst-case), single resistor tuning, and a single analog pin for user programming of 16 choices of range and mode (compare with the LTC1799/6900, where one pin sets one of three ranges). LTC has pulled out the stops to create a set of simple, function-specific, and small parts ${ }^{13}$ to handle our oscillator and timing problems.

Here is a listing of the TimerBlox parts available at the time of writing:

| Part \# | Function | Total Range | Comments |
| :---: | :---: | :---: | :---: |
| LTC6990 | VCO | $488 \mathrm{~Hz}-2 \mathrm{MHz}$ | 16:1 tuning range, as eight octave ( $\times 2$ ) ranges |
| LTC6991 | LF osc; <br> timer | $29 \mu \mathrm{~Hz}-977 \mathrm{~Hz}$ | $1 \mathrm{~ms}-9.5 \mathrm{hr}$, as eight $\times 8$ ranges |
| LTC6992-x | PWM | $3.8 \mathrm{~Hz}-1 \mathrm{MHz}$ | $\begin{aligned} & 0 \%-100 \%, 5 \%-100 \%, \\ & 5 \%-95 \%, \text { or } 0 \%-95 \% \end{aligned}$ |
| LTC6993-x | One-shot | $1 \mu \mathrm{~s}$ - 34 s | normal or retrig; rising or falling edge |
| LTC6994-x | delay/ <br> debounce | $1 \mu \mathrm{~s}-34 \mathrm{~s}$ | delay single or all edges; reject narrow pulse |

The LTC6991 takes aim at the problem of very lowfrequency square-wave oscillators, with a total output frequency range of approximately 30 microhertz to 1 kHz ;

[^325]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0466.jpg?height=411&width=670&top_left_y=218&top_left_x=1137)

Figure 7.17. Resistor-programmed 1 Hz oscillator.
thinking of this as a timer, that's a range of periods from 1 millisecond to 9 hours. You select one of eight ranges, whose "center" frequencies (corresponding to $R_{\mathrm{set}}=200 \mathrm{k} \Omega$ ) are spaced apart by factors of eight: $0.00012 \mathrm{~Hz}, 0.001 \mathrm{~Hz}, 0.008 \mathrm{~Hz}, 0.064 \mathrm{~Hz}, 0.5 \mathrm{~Hz}, 4 \mathrm{~Hz}$, $32 \mathrm{~Hz}, 250 \mathrm{~Hz}$. Within a chosen range, the external resistor $R_{\text {set }}(50-800 \mathrm{k} \Omega)$ tunes the oscillation frequency over a 16:1 range. For example, in the 4 Hz range you can tune continuously from 1 Hz ( $\left.R_{\mathrm{set}}=800 \mathrm{k}\right)$ to 16 Hz ( $\left.R_{\mathrm{set}}=50 \mathrm{k}\right)$.

Now for the mystery: how can you select one of 16 operating modes (eight ranges, two polarities) with a single pin, without the need for any kind of serial programming? Easy: these chips contain an internal 16-level (4-bit) ADC, with the power supply voltage $V_{+}$as full-scale reference, to determine the DIVCODE value (an integer from 0 to 15). So you simply apply a dc voltage in the range 0 to $V_{+}$to the DIV programming pin, most easily done via a pair of resistors from $V_{+}$to ground. ${ }^{14}$ That voltage divider's output (call it $V_{k}$ ) should aim for the midpoint of one of the sixteen subdivisions from 0 V to $V_{+}$. Stated precisely, you would use a pair of $1 \%$ resistors that produces an output voltage $V_{k}=V_{+}(2 k+1) / 32$ in order to select ${ }^{15}$ DIVCODE $=k$. That DIVCODE then determines the frequency range and (in this case) the polarity of output and reset.

As an example, Figure 7.17 shows how to generate a
${ }^{14}$ You could instead use the voltage output of a DAC, if you want digital control.
${ }^{15}$ This is an, uh, interesting scheme. Why not use two more pins, for a total pincount of eight, with programming like the LTC1799 (each one tied to GND, $V_{+}$, or open)? Evidently, in their zeal to minimize pincount and package size, and simultaneously to avoid the need for any kind of serial programming, the designers chose this analog scheme, with internal ADC. We'd like to see them offer an 8 -pin SOIC (and DFN) option, with 3-level selection on three pins; that way you'd get up to 27 mode choices, without the need for any external resistors. And, hey, a DFN-8 takes up less space than a DFN-6 plus two resistors! OK, you clever folks at LTC, what do you think?

1 Hz square wave with 3.3 V logic level output (i.e., 0 V and $+3.3 \mathrm{~V})$. We selected the 0.5 Hz range $(k=3)$, for which the voltage divider ratio is $R_{2} /\left(R_{1}+R_{2}\right)=7 / 32$; then we selected $R_{\text {set }}=95.3 \mathrm{k} \Omega$ for an $f_{\text {out }}$ of 1.0 Hz according to the datasheet's exact formula for oscillator period

$$
T=\frac{1}{f_{\text {out }}}=\frac{R_{\mathrm{set}}}{50 \mathrm{k} \Omega} \cdot n_{\mathrm{div}} \cdot 1.024 \times 10^{-3}(\text { seconds })
$$

where the chip's internal divider ratio $n_{\text {div }}$ is determined ${ }^{16}$ from the DIVCODE according to $n_{\mathrm{div}}=2^{3 k}$, thus $n_{\mathrm{div}}=512$ here. These chips run on reasonably low power; this circuit draws about 0.1 mA when unloaded.

Later in the chapter, in connection with timers, we'll see another example in which the LTC6991 is used to generate a switched "hour of power" (Figure 7.65). And we'll see also how to use other members of this family, in VCO and timer applications (§7.2.4).

#### C. Oscillator + divider

Another class of oscillator-timers uses an oscillator (relaxation or otherwise) followed by a digital counter, to generate long delay times without resorting to large resistor and capacitor values. Examples of this are the 74 HC 4060 and the Maxim ICM7240/50/60. These CMOS parts generate an output pulse for some number $N$ of oscillator cycles, ${ }^{17}$ and they run on a fraction of a milliamp. These timers (and their near relatives) are great for generating delays from a few seconds to a few minutes.

Some more recent additions to this class of oscillator include the LTC6903/4 (described earlier), and the Maxim DS1070/80 series. The LTC ICs operate from the same supply voltages as the LTC1799/6900 and generate rail-to-rail square-wave outputs over the larger range of 1 kHz to 68 MHz ; but they require no external components! The trick is that the frequency is set by sending a pair of numbers (a 4-bit scaling factor and a 10-bit frequency coefficient) via a bit-serial digital-input line. That might sound complicated; but in fact it is remarkably easy to do in any system where you have an embedded microcontroller (a small computer-on-a-chip), which in contemporary electronics includes just about any electronic circuit. We'll see much more of that in Chapter 15 ("Microcontrollers").

The DS1070/80 series "EconOscillators" is similar, with serial programming to set the frequency; that is, held

[^326]in internal nonvolatile memory, so you need to program it only once, or when you want to change it. The DS1085 is currently the fanciest member of the family, with four programmable settings that let you choose an output frequency (in the range of 8.1 kHz to 133 MHz ) to better than one part in a thousand. Beware, though, that the initial accuracy and stability of this "silicon oscillator" is only at the $\pm 1 \%$ level; that is, its resolution (step size) greatly exceeds its accuracy and stability. Think of it as a " $1 \%$ oscillator" whose frequency you can set in the field. ${ }^{18}$

There's a nice generalization of these "divide-by- $N$ " methods, namely the phase-locked loop (PLL). We treat them later in this chapter (§7.1.8B) and in Chapter 13.

#### D. Voltage-controlled oscillators

Other IC oscillators are available as voltage-controlled oscillators (VCOs), with the output rate variable over some range according to an input control voltage. We saw the germ of this idea when we used a current source to charge the capacitor in the 555; with little additional effort we could have made the current proportional to a controlling input voltage. There are many uses for a VCO, and so there are many offerings from the chip manufacturers. Some of these have frequency ranges exceeding 1000:1. Examples are the original NE566 and later designs like the ICL8038, MAX038, XR2206/7, and 74LS624-9 series.

The 74LS624 series, for example, generates digital-logic-level outputs up to 20 MHz and uses external $R C$ 's to set the nominal frequency. Faster VCOs like the 1648 can produce outputs to 200 MHz , and there are much higherfrequency VCO techniques (like Gunn-diode oscillators and YIG oscillators) that operate in the many gigahertz range.

Where linearity is important, a precision voltage-tofrequency (V/F) converter like the AD537, LM331, or AD650 really does the job, with worst-case linearity of $0.15 \%, 0.01 \%$, or $0.005 \%$, respectively. Most VCOs use internal current sources to charge and discharge a capacitor, and many therefore provide triangle-wave outputs. The classic Exar XR2206 goes further - it includes a set of "soft" clamps to convert the triangle wave to a not-toogreat sine wave; they call this a sine shaper, and it produces a sine-looking wave with $<1 \%$ distortion. Depending on external timing components, it goes from fractional hertz

[^327](at the low end) to 1 MHz (at the high end), ${ }^{19}$ with a sweep range of 1000:1 and a temperature stability of frequency of $0.002 \% /{ }^{\circ} \mathrm{C}$. You can also use it as a triangle-wave generator, in which mode it lets you adjust the duty cycle from $1 \%$ to $99 \%$.

In Chapter 13 we'll see some additional VCO methods, there in the context of "voltage-to-frequency conversion." Those methods are synchronous and require a fixedfrequency clocking input; those clocking pulses are passed through to the output, or not, such that the average output frequency is accurately proportional to the input voltage; see §13.8.1 and §13.9.

VCO chips sometimes have an awkward reference for the control voltage (e.g., the positive supply) and complicated symmetrizing schemes for sinewave output. It is our opinion that the ideal VCO has yet to be developed. Many of these chips can be used with an external quartz crystal, as we discuss shortly, for much higher accuracy and stability; in such cases the crystal simply replaces the capacitor.

You can make VCOs with techniques other than $R C$ (or current-driven) relaxation oscillators. For example, the frequency of an $L C$ oscillator (\$7.1.5D) can be electrically tuned with a voltage-variable capacitor (a varactor), though the tuning range is much less (typically 1-10\%) than a tunable relaxation oscillator. Likewise it is possible to "pull" the frequency of a quartz crystal over a narrow range of perhaps $0.01 \%$. Other oscillator technologies (Gunn oscillators, dielectric resonator oscillators, YIG-tuned oscillators, "current-starved" inverter chains, and others) permit electrical tuning by various means, an essential element of phase-locked-loop frequency synthesis (§13.13).

### 7.1.5 Sinewave oscillators

For many applications you need a real sine wave, rather than the rectangular, triangular, or other waveforms you get from relaxation oscillators. Examples are in audiofrequency test and measurement, in radio and video communications, and in medical and scientific research and applications. It is common in those applications to talk about spectral purity or harmonic distortion, which are measures of departure from an ideal sinewave.

The $R C$ relaxation oscillators we've been talking about don't generate sinewaves - their native waveforms are

[^328]ramps (linear or $R C$ exponential) and rectangular waves. The XR2206 in §7.1.4D illustrates one method of making an approximate sinewave, namely by clipping a triangle with a succession of soft clamps; this method is used in some analog function generators. ${ }^{20}$ However, there are oscillator configurations that generate sinewaves directly, and there are other tricks for making sinewaves from square waves.

Examples of native sinewave oscillators are the Wien bridge (which uses humble $R$ 's and $C$ 's), the resonator oscillators (which use resonators such as an $L C$ circuit, quartz crystal, coaxial or cavity resonator, or even an atomicmolecular resonator), and the method of direct digital synthesis (DDS).

In this section we look at ways to make sinewaves, beginning with a few tricks for making sinewaves from square waves (or other non-sinusoidal waveforms), then moving to techniques that generate sinewaves directly. In a later section (§7.1.9) we discuss quadrature oscillators, which generate a pair of signals with a $90^{\circ}$ phase relationship.

#### A. Sine from square

The simple trick here is to lowpass filter the square (or whatever) wave, to remove all but the fundamental frequency. An easy way to think about it is to remember that any ${ }^{21}$ periodic waveform can be deconstructed into a set of sinusoidal components (the waveform's "Fourier series"), each with some fixed amplitude and phase; when you add those components together, you reconstruct the original waveform. The lowest frequency component (at the periodicity of the original waveform) is the fundamental, and all higher components ("harmonics") are integer multiples of the fundamental frequency (that is, at $2 f_{0}, 3 f_{0}, 4 f_{0}, \ldots$ ). So you can create a sinusoidal wave from an arbitrary periodic wave by lowpass filtering at a frequency higher than the
${ }^{20}$ Such techniques of "corrupting" a triangle wave with diode clamps do not produce a high-quality sinewave: the resulting distortion can rarely be reduced below $1 \%$. By comparison, most audiophiles insist on distortion levels well below $0.1 \%$ for their amplifiers. To test such low-distortion audio components, pure sinewave signal sources with residual distortion less than $0.01 \%$ or so are required.
${ }^{21}$ Well, nearly any: mathematicians are adept at finding pathological functions to rebut any loosely-worded proposition. We should probably say "any well-behaved periodic waveform"; but we can say, confidently, "any periodic waveform you can actually create with electronics."
fundamental but lower than the second harmonic, ${ }^{22}$ thus extracting only the fundamental sinusoidal component.

As long as the filter doesn't pass the harmonic spectrum significantly, you'll get a good sinewave. As we discussed in Chapter 6, you can make lowpass filters in several ways: as "continuous-time" analog filters (with a network of discrete $L$ 's and $C$ 's; or, at lower frequencies, with active filters; or with discrete-time switched-capacitor filters; or with the numerical methods of digital signal processing).

To demonstrate this technique, we hooked up a 555 as a 1 kHz oscillator (Figure 7.10A, with $R=75 \mathrm{k}$ and $C=10 \mathrm{nF}$ ), and ran the square-wave output through a lowpass active filter (a continuous-time 8-pole Butterworth) with breakpoint at 1.5 kHz . The output looked like a pretty good sinewave, and in fact it measured just $0.6 \%$ distortion ${ }^{23}$ This technique requires a somewhat complex analog circuit, and it lacks frequency agility (i.e., once you've chosen the filter's breakpoint frequency, you can vary the oscillator frequency by only a small amount, say $\pm 25 \%$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0469.jpg?height=434&width=805&top_left_y=1051&top_left_x=113)

Figure 7.18. Sinewave generation with tracking lowpass filter. The MAX294 (or similar MAX293 or LTC1069-1) is an 8-pole elliptic lowpass switched-capacitor filter requiring no external components.

Switched-capacitor filters are simpler to use, being available as inexpensive clocked ICs; instead of requiring $R$ 's and $C$ 's to set the passband, the clock frequency tunes the filter - it determines the breakpoint frequency. Figure 7.18 shows a simple circuit in which a MAX294 switched-capacitor lowpass filter is used to convert an input square wave to an output sinewave. The MAX294's breakpoint is at $f_{\text {CLK }} / 100$, so we've clocked it at 128 times the input square wave frequency. This puts the breakpoint at

[^329]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0469.jpg?height=512&width=730&top_left_y=221&top_left_x=1005)

Figure 7.19. Waveforms from the circuit of Figure 7.18: the 1 kHz square-wave input ( $f_{\text {OSC }} / 128$ ), and the resulting sinewave after lowpass filtering. The output amplitude is equal to the fundamental component of the square wave input, which is a factor of $4 / \pi$ larger. Horizontal: $400 \mu \mathrm{~s} /$ div. Vertical: $2 \mathrm{~V} /$ div.
$1.28 f_{\mathrm{IN}}$, and results in the handsome sinewave shown in Figure 7.19; it measured a very clean $0.03 \%$ distortion.

Not only is this circuit simpler than the analog lowpass scheme, it provides highly predictable output amplitude ${ }^{24}$, it provides tunability - that's because the filter tracks the input frequency, keeping its lowpass breakpoint at $1.28 f_{\mathrm{IN}}$ as the input frequency is varied. ${ }^{25}$ In this circuit we varied the 555's frequency by factors of ten, and measured a maximum of $0.1 \%$ distortion for output sinewave frequencies over the range of 100 Hz to 10 kHz .

#### B. Wien bridge oscillator

At low to moderate frequencies the Wien bridge oscillator (Figure 7.20) is a useful source of low-distortion sinusoidal signals. The idea is to make a feedback amplifier with $0^{\circ}$ phase shift at the desired output frequency, then adjust the loop gain so that a self-sustaining oscillation just barely takes place. For equal-value $R$ 's and $C$ 's as shown, the voltage gain from the noninverting input to op-amp output should be exactly +3.00 . With less gain the oscillation will cease, and with more gain the output will saturate. The distortion is low if the amplitude of oscillation remains within the linear region of the amplifier, i.e., it must not be allowed to go into a full-swing oscillation. Without some trick to control the gain, that is exactly what

[^330]will happen, with the amplifier's output increasing until the effective gain is reduced to 3.0 because of saturation. The tricks involve some sort of long-time-constant gain-setting feedback, as we will see.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0470.jpg?height=545&width=860&top_left_y=396&top_left_x=167)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0470.jpg?height=542&width=799&top_left_y=219&top_left_x=1075)

Figure 7.21. A photoconductive opto-isolator provides another method of amplitude control in the Wien-bridge oscillator. (Courtesy Steve Cerwin)
for applied voltages $<1$ Vrms), varied over several decades of resistance according to the LED current. Unlike silicon devices, they are intrinsically slow (tens of milliseconds for the device shown), which is helpful in this application.

It has been claimed that, with careful design, Wienbridge oscillators can be built with distortion "well into the parts-per-billion range." Tricks to do this, which include the use of cascaded op-amps (for high loop gain, therefore low distortion), and cancellation of remaining harmonic distortion, are described in Linear Technology Magazine, Feb. 1994, pp. 26-28.

#### An ultralow-distortion design

We are skeptical of this claim. ${ }^{27}$ However, with some attention to detail the distortion can be brought down to levels of a few parts per million $(0.0001 \%)$ using quite conventional components and techniques. Figure 7.22 shows such a circuit, which we designed and tested to find out just how difficult this might be.

We began with a two-op-amp circuit variant, which has the advantage of using the inverting configuration; this reduces distortion by eliminating the common-mode signals present in the simpler non-inverting amplifier. The OPA627 is a fast ( $f_{\mathrm{T}}=16 \mathrm{MHz}$ ), low-noise ( $e_{\mathrm{n}}=4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), low input-current $\left(I_{\mathrm{B}} \approx 1 \mathrm{pA}\right.$ ) op-amp, with the particular advantages here of intrinsically low distortion ( $0.00003 \%$ as a unity-gain follower with a 10 V signal at 1 kHz ) and the ability to operate with $\pm 15 \mathrm{~V}$ supplies. (We want to operate with a large signal swing to minimize the effect of noise on the sinewave purity.)

[^331]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0471.jpg?height=682&width=1233&top_left_y=215&top_left_x=327)

Figure 7.22. Wien-bridge ( 1 kHz ) oscillator with unusually low distortion ( $<0.001 \%$ ). To obtain best performance, include a trimmer in $R_{5}$, adjusted to optimize the controlled value of the JFET's resistance.

For this configuration, sustained oscillation occurs when $\mathrm{IC}_{2}$ 's voltage gain is -2.00 . We chose $R_{5}$ to be $5 \%$ smaller than critical, with the series JFET providing the adjustable 1 k (nominal) additional resistance. That puts a 100 mV (peak-to-peak) sinewave across the JFET, which we judged small enough for good linearity, especially with the linearizing divider $R_{3} R_{4}$ (see $\S 3.2 .7 \mathrm{~A}$ ). Amplitude control is provided by integrator $\mathrm{IC}_{3}$, which receives pulses of input current (via the divider to a stable -5 V reference) when the sinewave output of $\mathrm{IC}_{2}$ reaches 2 V amplitude: its negative-going output back-biases the JFET's gate, relative to the source at virtual ground, raising the JFET's resistance and thus lowering the gain of $\mathrm{IC}_{2}$ to maintain this output amplitude. ${ }^{28}$ For the values shown, the JFET's minimum $R_{\mathrm{ON}}$ (i.e., at $V_{\mathrm{GS}}=0$ ) must be less than 1 k , which requires a minimum $g_{\mathrm{m}}$ of 1 mS (see §3.2.7); the 2 N 5458 specifies a minimum $g_{\mathrm{m}}$ of 1.5 mS , so the circuit is guaranteed to start up. We tacked on an inverting gain-of-5 stage to produce a healthy 10 V amplitude output.

The circuit worked "out of the box" - correct frequency and amplitude ( $1 \mathrm{kHz}, 10 \mathrm{~V}$ ) and a good-looking sinewave. The measured total harmonic distortion (THD) was an admirable $0.002 \%{ }^{29}$ Before celebrating, though, we tried some variations: (a) Replacing the film capacitors with ceramic ("X7R" type) raised the distortion ${ }^{30}$ a hundred-

[^332]fold, to $0.22 \%$ ! (b) Dropping the swing across the JFET to 50 mVpp (by raising $R_{5}$ to 19.6 k ) halved the distortion, to $0.001 \%$; from here on we stuck with this smaller JFET swing. (c) Next we trimmed the ratio of $R_{3} / R_{4}$ slightly, to minimize the (dominantly second harmonic) distortion, achieving a final THD figure of $0.0002 \%$; that's -114 dB down from the signal, a mere 2 parts per million! (d) Finally, to see the effect of the linearizing gate divider, we omitted $R_{4}$, which raised the distortion 50 -fold, to $0.01 \%$.

Some important lessons from this exercise, if you want the lowest distortion, are (a) avoid inexpensive ceramic capacitors, (b) use the gate-linearizing trick (subtracting $V_{\mathrm{DS}} / 2$ from $V_{\mathrm{GS}}$ ), and (c) keep the swing small across JFETs being used as resistors, preferably less than 100 mV (which, however, causes a rather lengthy amplitude settling time). Because JFET nonlinearity dominated the distortion, even when trimmed, we could have reduced the distortion still further by running the oscillator at lower amplitude, say 0.5 V , at the expense of added broadband noise produced by the fixed noise contribution of the op-amps. ${ }^{31}$

#### C. RC phase-shift oscillator

Unlike the relaxation oscillator (where an $R C$ time constant is combined with voltage thresholds to make an

[^333]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0472.jpg?height=554&width=797&top_left_y=218&top_left_x=219)

Figure 7.23. Phase-shift oscillator. Three $R C$ sections produce a $180^{\circ}$ phase shift, converted to positive feedback by the inverting amplifier.
oscillation), the preceding Wien-bridge oscillator exploits the phase-shifting characteristics of an $R C$ network, in a circuit with positive feedback, to select its operating frequency. This same idea is used in phase-shift oscillators: gain and feedback are applied around a network of several $R$ 's and $C$ 's, arranged so that the resulting loop oscillates at a frequency set by the network. Figure 7.23 shows a classic example.

The three-section $R C$ produces a lagging phase shift that increases with frequency, reaching $180^{\circ}$ at approximately $\omega=2.4 / R C$, where the loss through the network is a factor of $26 .{ }^{32}$ The inverting amplifier provides the remaining $180^{\circ}$ phase shift, and also the needed voltage gain (here a conservative $G_{\mathrm{V}}=-36$ ). The circuit oscillates at 1 kHz , with a (rather distorted) clipped sinewave that swings rail-to-rail (i.e., $\pm 5 \mathrm{~V}$ ). However, the waveform at the last $R C$ section is nicely sinusoidal, and, after an $\times 5$ gain stage, emerges as a 1 V amplitude sinewave with just $0.9 \%$ distortion.

For phase-shift oscillator devotees, there is a world of possible variations: discrete transistor configurations, amplitude-limiting feedback schemes, and so on. Although we tried mightily, we are unable to resist the temptation to show another phase-shift oscillator (Figure 7.24). Here an (inverting) integrator provides $270^{\circ}$ of lagging phase shift, so only two $R C$ sections are needed to close the loop in-phase. This circuit illustrates also the use of back-toback diode clamps for amplitude limiting. As with Figure 7.23 , we've derived the output from the last $R C$ section, where its distortion is minimum; the circuit's output is a 1 kHz sinewave of 1 V amplitude and $1 \%$ distortion. If

[^334]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0472.jpg?height=659&width=792&top_left_y=178&top_left_x=1076)

Figure 7.24. A variation on the phase-shift oscillator. An integrator adds $90^{\circ}$ lagging phase shift (and inversion) to a 2 -section $R C$. (Courtesy Tony Williams)
you were instead to put the diode limiters across the first 39 nF phase-shifting capacitor, the integrator output would be another sinusoidal wave of low distortion - in fact, it would be a $90^{\circ}$ lagging wave (cosine, inverted), thus creating a "quadrature pair" (§7.1.9, though here of unequal amplitudes).

#### D. LC oscillators

At high frequencies (say above a megahertz) a favorite method of sinewave generation is to use a resonator of some sort to establish the frequency of oscillation. The resonator itself may be electrical (e.g., an $L C$ circuit), or electromechanical (e.g., a piezoelectric quartz crystal), or even atomic or molecular (e.g., a hydrogen maser). Some resonators are easily tuned (e.g., $L C$ ), whereas others are quite stably fixed (e.g., a quartz crystal). Resonator-based oscillators are fundamentally different from the preceding $R C$ based oscillators, because they exploit a system that has an intrinsic resonant frequency (like a crystal resonator), compared with an $R C$ circuit's nonresonant time constant (or phase shift). Because these resonances can be both narrow in frequency and stable over time, they are well suited for conscription into the noble service of oscillation.

We begin with $L C$-controlled oscillators, which play an important role in communications, and in which a tuned $L C$ circuit is connected in an amplifier-like circuit to provide gain at its resonant frequency. Overall positive feedback is then used to cause a sustained oscillation to build up at the LC's resonant frequency; such circuits are self-starting.

Figure 7.25 shows two popular configurations. The first
circuit is the trusty Colpitts oscillator, ${ }^{33}$ a parallel tuned $L C$ at the input, with positive feedback from the output (inverted in phase, because the JFET is inverting). For this circuit, operating at 20 MHz , the distortion is typically less than -60 dB . The second circuit is a Hartley oscillator, built with an npn transistor; the variable capacitor is for frequency adjustment. Because a common-base amplifier is noninverting, the feedback signal is not inverted. Both circuits use output link coupling, just a few turns of wire acting as a step-down transformer.

A third oscillator configuration - the emitter-coupled oscillator (or Peltz oscillator) - is shown in Figure 7.26, which is used in the 1648 "voltage-controlled oscillator" chip of the ECL III digital logic family. ${ }^{34}$ You can think of this as a feedback noninverting differential amplifier, with a parallel $L C$ to set the frequency of oscillation. The 1648 will operate to 200 MHz , with the operating frequency set, as usual, by the resonant frequency of the parallel $L C$ : $f_{0}=1 / 2 \pi \sqrt{L C}$. Although the datasheet claims "high spectral purity," we found it to be mediocre at best when compared with a Clapp oscillator using a single JFET (see Figure 7.30 later in this section).

#### Electrical tunability

LC oscillators can be made electrically tunable over a modest range of frequency. The trick is to use a voltage-variable capacitor ("varactor") in the frequency-determining $L C$ circuit. The physics of diode junctions provides the solution, in the form of a simple reverse-biased diode: the capacitance of a pn junction decreases with increasing reverse voltage (§1.9.5B). Although any diode acts as a varactor, you can get special varactor diodes designed for the purpose; Figure 7.27 shows the tuning characteristics of some representative types. And Figure 7.28 shows how to use a varactor to achieve $\pm 1 \%$ electrical tunability, in this case with simple Armstrong-type JFET oscillator (with transformer-coupled feedback from the source). In this circuit the tuning range has been made deliberately small to achieve good stability, by using a relatively large fixed capacitor $(100 \mathrm{pF})$ shunted by a small tunable capacitor (maximum value of 15 pF ). Note the large biasing resistor (so the diode bias circuit doesn't load the oscillation) and the dc blocking capacitor.

Varactors typically provide a maximum capacitance of a few picofarads to a few hundred picofarads, with a tun-

[^335]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0473.jpg?height=927&width=506&top_left_y=215&top_left_x=1130)

Figure 7.25. Popular $L C$ oscillator configurations. A. Colpitts with center-tapped resonating capacitor. B. Hartley with a center-tapped resonating inductor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0473.jpg?height=485&width=555&top_left_y=1306&top_left_x=1095)

Figure 7.26. Emitter-coupled oscillator, a simplified version of that used in the MC1648 ECL-family IC.
ing range of about $3: 1$ (although there are wide range varactors with ratios as high as $15: 1$ ). Because the resonant frequency of an $L C$ circuit is inversely proportional to the square root of capacitance, it is possible to achieve tuning ranges of up to $4: 1$ in frequency, though more typically you're talking about a tuning range of $\pm 25 \%$ or so.

In varactor-tuned circuits, the oscillation itself (as well as the externally applied dc tuning bias) appears across the varactor, causing its capacitance to vary at the signal
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0474.jpg?height=603&width=797&top_left_y=219&top_left_x=219)

Figure 7.27. A reverse-biased diode exhibits capacitance that varies with applied voltage, shown here for several typical "varactor" tuning diodes. Those with steeper solid curves have "hyperabrupt" diode junctions.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0474.jpg?height=460&width=779&top_left_y=1053&top_left_x=233)

Figure 7.28. Varactor-tuned $L C$ oscillator.
frequency. This produces oscillator waveform distortion, and, more important, it causes the oscillator frequency to depend somewhat on the amplitude of oscillation. To minimize these effects, you should limit the amplitude of the oscillation (amplify in following stages, if you need more output); also, it's best to keep the dc varactor bias voltage above a volt or so, in order to make the oscillating voltage small by comparison.

An additional technique that helps mitigate this signalbiasing effect is to use a series pair of back-to-back varactors, so that the oscillating voltage seen by the two varactors acts to change their capacitances in opposite directions. This is illustrated in the low-noise oscillator of Figure 7.29 (see also Figure 6.8), used within a phase-locked loop (§13.13) to produce a clean 60 MHz "local oscillator" for a radio-astronomy receiver. This particular configuration is known as a Clapp oscillator, for which the fre-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0474.jpg?height=652&width=797&top_left_y=220&top_left_x=1076)

Figure 7.29. Low-noise JFET LC oscillator, used within a phaselocked loop (see §13.13). This design has unusually low sideband noise, as shown in the spectra of Figure 7.30.
quency is ordinarily set by the series resonant $L_{1} C_{1}$. Here we've added a parallel capacitance across $C_{1}$, consisting of the series pair of varactors. The tuning voltage is applied via $R_{2}$, which puts them both in equal back-bias (relative to their anodes at zero volts). The varactors, of equal capacitance, each take half the oscillation voltage, producing capacitance changes of opposite sign and (if the signal is not too large) of approximately equal magnitude. The net effect is a greatly reduced change in the capacitance of the series pair, and therefore lower distortion and frequency pulling. The measured signal purity was approximately 10 dB better than a good commercial frequency synthesizer (HP 3325A). A frequency spectrum of its output is shown in Figure 7.30, where its signal purity is compared with that of an MC1648 emitter-coupled oscillator using similar $L C$ components and operating at approximately the same frequency. ${ }^{35}$

Electrically tunable oscillators are used extensively to generate frequency modulation, as well as in RF phaselocked loops like this one. PLLs are treated in Chapter 13.

For historical reasons we should mention a close cousin of the $L C$ oscillator, namely the tuning-fork oscillator. It used the high- $Q$ oscillations of a metallic tuning fork as the frequency-determining element of an oscillator, and it found use in low-frequency standards (stability of a few parts per million, if run in a constant-temperature oven) as well as in wristwatches. These objects have been super-

[^336]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0475.jpg?height=491&width=729&top_left_y=221&top_left_x=161)

Figure 7.30. Frequency spectrum of the 60 MHz JFET LC oscillator of Figure 7.29, compared with that of a bipolar ECL oscillator (MC1648). Vertical: 10 dB/div. Horizontal: 200 kHz/div.
seded by quartz ("crystal") oscillators, which are discussed in §7.1.6. Interestingly, however, quartz crystals made for low-frequency operation (e.g., the 32.768 kHz used in wristwatches) oscillate in a mechanical tuning-fork mode.

#### E. Parasitic oscillations

Suppose you have just made a nice amplifier and are testing it out with a sinewave input. You switch the input function generator to a square wave, but the output remains a sinewave! You don't have an amplifier; you've got trouble.

Parasitic oscillations aren't ordinarily as blatant as this. They are usually observed as fuzziness on part of a waveform, erratic current-source operation, unexplained opamp offsets, or circuits that behave normally with the oscilloscope probe applied, but go wild when the 'scope isn't looking. These are bizarre manifestations of untamed highfrequency parasitic oscillations caused by unintended Hartley or Colpitts oscillators exploiting lead inductances and interelectrode capacitances.

The circuit in Figure 7.31 shows an oscillating current source, born in an electronics lab course where an analog volt-ohm-milliammeter (VOM) was used to measure the output compliance of a standard transistor current source. The current seemed to vary excessively ( $5 \%$ to $10 \%$ ) with load voltage variations within its expected compliance range, a symptom that could be "cured" by sticking a finger on the collector lead! The combined meter capacitance and the collector-base capacitance of the transistor resonated with the meter inductance in a classic Hartley oscillator circuit, with feedback provided by collector-emitter capacitance. Adding a small resistor in series with the base suppressed the oscillation by reducing the high-frequency common-base gain. This is one trick that often helps.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0475.jpg?height=631&width=670&top_left_y=218&top_left_x=1040)

Figure 7.31. Unintended Hartley oscillator causes current-source mischief.

There are opportunities for parasitic oscillations in any active circuit that has gain. You've just got to be alert, and pay attention to any unexpected or weird circuit behavior. Sometimes you'll see the telltale signs of fuzz on only a portion of the waveform. With experience you'll come to recognize the symptoms of oscillations in op-amps (generally in the neighborhood of $f_{\mathrm{T}}$, say, a megahertz) or in discrete small-signal transistors (generally in the 10 s to 100 s of megahertz).

#### "Pickup"

It's easy ${ }^{36}$ to mistake various forms of signal pickup for an oscillation, because they too can cause fuzz on the displayed signal. If you suspect pickup, check to see if you've got $60 \mathrm{~Hz}^{37}$ (or perhaps 120 Hz ), a clear indication of powerline coupling. This can originate in capacitive coupling to a high-impedance point in the circuit. Or it can come from inductive coupling into a portion of your circuit that has some geometrical area linked by the alternating magnetic field. A third possibility is through a ground loop (portions of the circuit referenced to local grounds that are not at the same potential). Even in a well-layed-out circuit this latter problem can be severe, for example when it is connected to some external instrument that is plugged into a different ac power outlet. Higher-frequency pickup is common, too: coupling from switching power supplies (treated in Chapter 9), generally in the range of 20 kHz to 1 MHz ; or

[^337]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0476.jpg?height=772&width=1384&top_left_y=206&top_left_x=354)

Figure 7.32. Quartz crystal packages. Across the top row are complete oscillator modules in DIP-8 and DIP-14 sizes; a much smaller alternative is the tiny $7 \mathrm{~mm} \times 5 \mathrm{~mm}$ surface-mount oscillator module at bottom center. The strange object in the middle is a bare crystal, shown with its spring-loaded electrode plates. You don't see those anymore; instead, crystals come in the popular sealed packages known as (left to right, bottom row) HC49/U, HC49/US, and 3mm tubular. We were lucky to find that oddball glass case at the right: inside you can see the gorgeous quartz disk with its plated electrodes.
modulated RF pickup from broadcast stations (US allocations are $0.5 \mathrm{MHz}-1.7 \mathrm{MHz}$ for $\mathrm{AM}, 88 \mathrm{MHz}-108 \mathrm{MHz}$ for FM, and anywhere from $55 \mathrm{MHz}-700 \mathrm{MHz}$ for television).

### 7.1.6 Quartz-crystal oscillators

$R C$ (or capacitor plus current source) relaxation oscillators can easily attain stabilities approaching $0.1 \%$, with initial predictability of $5 \%$ to $10 \%$. That's good enough for many applications, such as a vacuum fluorescent display (VFD) in which the individual characters of a multicharacter display are driven sequentially in rapid succession (a 100 Hz overall rate is typical); this is called a multiplexed display (see the example circuit in $\S 10.6 .2$ ). Only one character is lit at any time, but, if the entire display is "refreshed" rapidly enough, your eye sees the whole display without obvious flicker. In such an application the precise rate is quite irrelevant - you just want something in the ballpark. As stable sources of frequency, $L C$ oscillators can do a bit better, with stabilities of $0.01 \%$ over reasonable periods of time. That's good enough for nondemanding applications like an inexpensive radio. Both kinds of oscillators are easily tunable - with a variable $R$ or current source (for the
relaxation oscillator) and with a mechanically or electrically tunable capacitor, or a slug-tuned inductor (for the $L C$ oscillator).

But for real stability there's no substitute for a crystal oscillator. This uses a piece of quartz (silicon dioxide, the primary ingredient of glass) that is cut and polished to vibrate mechanically at a certain frequency. Quartz is piezoelectric (a strain generates a voltage, and vice versa), so acoustic waves in the crystal can be driven by an applied electric field and in turn can generate a voltage at the surface of the crystal. By plating some contacts on the surface, you wind up with an honest electrical circuit element that can be modeled by a sharply resonant RLC circuit, pretuned to some frequency (which is the mechanical resonant frequency of the little slab of single-crystal quartz). Quartz crystals come packaged as bare components or as complete oscillator modules; some examples are shown in Figure 7.32.

The quartz crystal's high $Q$ (typically around $10^{4}-10^{5}$ ) and good stability make it a natural for oscillator control as well as for high-performance filters. As with $L C$ oscillators, the crystal's equivalent circuit provides positive feedback and gain at the resonant frequency, leading to sustained oscillations.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0477.jpg?height=185&width=489&top_left_y=219&top_left_x=281)

Figure 7.33. Quartz-crystal equivalent circuit. $C_{0}$ is the actual electrode and lead capacitance, whereas the series RLC models the electrically coupled mechanical resonance. Typical values for a 1 MHz crystal might be $C_{0}=4 \mathrm{pF}$, and, for the series $R L C, 1 \mathrm{H}$, 0.02 pF , and $75 \Omega\left(Q \sim 10^{5}\right)$.

#### A. Series and parallel modes

The crystal's resonant behavior, as modeled by its equivalent circuit, deserves some additional explanation. The equivalent circuit contains two capacitors, giving a pair of closely spaced (within $0.1 \%$ ) series- and parallel-resonant frequencies (Figure 7.33). The effect is to produce a rapidly changing reactance with frequency (Figure 7.34).

The label "resonant frequency" $f_{\mathrm{R}}$ is given to the seriesresonant frequency of $L_{1}$ and $C_{1}$ (it's also called the seriesresonant frequency $f_{\mathrm{S}}$ ), so the net series reactance goes from being capacitive (below $f_{\mathrm{R}}$ ) to inductive (above $f_{\mathrm{R}}$ ). At $f_{\mathrm{R}}$ the net reactance of the series pair $\left(L_{1}\right.$ and $\left.C_{1}\right)$ is zero, and the magnitude of the impedance is a minimum (and equals $R_{1}$ ). ${ }^{38}$ Slightly above this in frequency (typically $\sim 0.1 \%$ higher) is the "antiresonant frequency" $f_{\mathrm{a}}$, where the series combination of $C_{0}$ and $C_{1}$ (which is slightly less than $C_{1}$ alone) resonates with $L_{1}$. (Alternatively you can think of this as the parallel resonance of $C_{0}$ with the net series reactance of $L_{1}$ and $C_{1}$, which becomes increasingly inductive above $f_{\mathrm{R}}$.) This is also called the parallel resonant frequency $f_{\mathrm{p}}$, although that term should properly be reserved for the actual circuit situation in which an external load capacitance $C_{\mathrm{L}}$ is intentionally added in parallel (more on this soon). At this frequency ( $f_{\mathrm{a}}$ or $f_{\mathrm{p}}$ ) the net reactance again goes through zero, but this time with a peak in the magnitude of the impedance. When a crystal is operated in parallel resonance, the additional parallel capacitance added by the external circuit adds to the crystal's $C_{0}$ and lowers the resonant frequency somewhat. Crystals intended for operation in parallel resonant mode will specify a value of external shunt capacitance (typically in the range of 1035 pF ) for oscillation at the specified frequency stamped on the crystal.

This business of parallel and series is important, and any device that uses an external crystal will specify which mode it's using, along with some guidance on crystal pa-

[^338]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0477.jpg?height=710&width=633&top_left_y=209&top_left_x=1056)

Figure 7.34. Reactance and magnitude of the impedance of a quartz crystal near its resonances, on a greatly expanded frequency scale. $f_{\mathrm{S}}$ and $f_{\mathrm{a}}$ are the series- and parallel-resonant frequencies [more precisely, the resonant $\left(f_{\mathrm{R}}\right)$ and antiresonant $\left(f_{\mathrm{a}}\right)$ frequencies, respectively]. An additional external capacitance $C_{\mathrm{L}}$ lowers the parallel-resonant frequency to $f_{\mathrm{p}}$, when operated in that mode.
rameters (maximum allowable $R_{\mathrm{S}}$, value of parallel capacitance). Better yet, you will see a listing of crystal manufacturers and part numbers that are known to work properly.

#### B. Exploring a quartz crystal

You can find plenty of sketches like Figure 7.34. But do you believe they accurately represent what real crystals do?

We weren't sure, so to find out we took a sample crystal (a CTS type MP100, specified as $10.0 \mathrm{MHz} \pm 45 \mathrm{ppm}$, in series-resonant mode), and measured its impedance with a high-resolution vector impedance test instrument (an HP4192A). The latter can measure from $0.01 \Omega$ to $200 \mathrm{k} \Omega$, with a resolution of 1 Hz , and at frequencies to 13 MHz - perfect for this job. Our particular crystal had a measured series-resonant frequency of $f_{\mathrm{S}}=10.000086 \mathrm{MHz}$ (that's a frequency error of +8.6 ppm ), an impedance (resistive) at resonance of $R_{1}=4.736 \Omega$, and a parallel capacitance of $C_{0}=5.5 \mathrm{pF}$. We know the product $L_{1} C_{1}$ (from the resonant frequency), but not their individual values. ${ }^{39}$ But we can get at them indirectly, by measuring the (unspecified) parallel-(anti)resonant frequency, and its variation

[^339]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0478.jpg?height=558&width=797&top_left_y=221&top_left_x=221)

Figure 7.35. Impedance versus frequency for a sample 10.0 MHz series-resonant crystal, as modeled by SPICE from measured values of its RLC electrical model. Curves for four values of external parallel capacitance $C_{\mathrm{L}}$ are plotted.
with added external parallel capacitance $C_{\mathrm{L}}$. These we measured as $f_{\mathrm{a}}=10.02245 \mathrm{MHz}$ (no $C_{\mathrm{L}}: C_{0}$ only), and $f_{\mathrm{p}}=10.00355 \mathrm{MHz}$ (with $C_{\mathrm{L}}=30 \mathrm{pF}$ external parallel capacitance).

From these we can back out the values of $L_{1}$ and $C_{1}$, namely 10.3324 mH and $0.024515 \mathrm{pF} .^{40}$ And with those values we can enjoy many happy hours running the SPICE simulator, to learn how graphs of the crystal's impedance, phase shifts, and $Q$-value really look. Figures 7.35, 7.36, and 7.37 show such results.

These show the expected minimum at the series resonant frequency $f_{\mathrm{R}}$ (where $|Z|=4.7 \Omega$ ), and that it varies very little with external capacitance (not visible, in fact, even in the expanded plot of Figure 7.36; that is, much less than 1 ppm going from $C_{\mathrm{L}}=0 \mathrm{pF}$ to 30 pF ). In contrast, the par-allel-resonant frequency (impedance maxima) depends relatively strongly on external capacitance, which effectively "pulls" its resonance downward by $\sim 2000 \mathrm{ppm}$ when 30 pF is added.

The fact that the parallel resonance is higher than the 10.0 MHz stamped on the case doesn't mean there's anything "wrong" with this crystal. Its frequency is simply specified for series-resonant circuit operation. If it were instead specified for parallel-resonant operation, this particular sample would be stamped " 10.00355 MHz ," and would specify " $C_{\mathrm{L}}=30 \mathrm{pF}$."41 (Of course, you'd buy instead

[^340]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0478.jpg?height=616&width=795&top_left_y=223&top_left_x=1077)

Figure 7.36. Impedance and phase in the neighborhood of the series resonance, for the 10.0 MHz crystal of Figure 7.35. Note that the graphs of impedance and phase are unaffected by external capacitance. The high- $Q$ resonance of our sample, with its $R_{1}=4.7 \Omega$, is considerably degraded for a crystal with worst-case specified $R_{1}=50 \Omega$.
a 10.0 MHz standard frequency crystal specified for parallel mode; for this manufacturer that would have the part number MP101.)

From the relatively large frequency shifts with load capacitance, it's clear that you have to be careful to use the specified load capacitance (taking into account wiring and chip capacitances) when operating a crystal in parallelresonant mode. Looking at the positive side, that means you can use an external variable capacitor to trim the operating frequency (or lock it, over a narrow range, using an electrically tunable varactor capacitor). On the negative side, it means that even small drifts in the external circuit's capacitance will cause frequency shifts. For example, to achieve 0.1 ppm frequency stability (assuming the crystal is that good over temperature or time) the external capacitance must not change by more than 0.002 pF ; this is likely a difficult constraint for the external amplifier that closes the oscillation loop.

Our crystal measured an impressively low value of $R_{1}=4.7 \Omega$, compared with the manufacturer's worst-case maximum of $50 \Omega$. To see how that changes things, we included that worst-case value in the expanded plots of the series and parallel resonances (Figures 7.36 and 7.37). For the series resonance the impedance minimum is shallower, and the phase shift versus frequency is more gentle. The
rameters, the load capacitance required for getting a parallel-resonant frequency $f_{P}$ is $C_{\mathrm{L}}=\left\{f_{\mathrm{S}} C_{1} / 2\left(f_{\mathrm{P}}-f_{\mathrm{S}}\right)\right\}-C_{0}$.
shallower phase change ( $\sim 1.3^{\circ} / \mathrm{ppm}$, versus $\sim 13^{\circ} / \mathrm{ppm}$ ) means that the external oscillator circuit must keep changes in its phase shift an order of magnitude smaller to maintain the same stability (here $0.13^{\circ}$ versus $1.3^{\circ}$, for stability of 0.1 ppm ). In an oscillator circuit such a crystal would be less stable against other variations in circuit parameters as well (amplifier input impedance, gain, etc.), and in fact it may refuse to oscillate entirely. Worse yet, the circuit may oscillate at an unrelated frequency, an unhappy situation that we've encountered more than once.

Finally, the expanded plot around the parallel resonance, for a single value of load capacitance ( $C_{\mathrm{L}}=30 \mathrm{pF}$; the others are off-scale), shows the same sort of $Q$ degradation with maximum (worst-case) specified $R_{1}$. It is interesting to note that the sharpness of the phase change (and width of the impedance maximum) is similar to that of the series-resonant case, contrary to statements that you'll sometimes hear.

To complete the oscillator circuit, the crystal is connected within a positive feedback loop. Some common oscillator circuits are shown in $\S 7.1 .6 \mathrm{D}$, where you'll see external loading capacitances, a large-value resistor to complete the bias path, and (sometimes) a smaller series resistor. You can simulate the full circuit configuration, if you like, by using the crystal model above. ${ }^{42}$ We've done so, but we will show restraint and conclude this discussion, declaring victory in revealing the nature of those often misunderstood crystal resonances.

#### C. Standard crystal frequencies

Quartz crystals are available from about 10 kHz to about 30 MHz , with overtone-mode crystals going to about 250 MHz . Although crystals have to be ordered for a given frequency, most of the commonly used frequencies are available off the shelf. Frequencies such as 100 kHz , $1.0 \mathrm{MHz}, 2.0 \mathrm{MHz}, 4.0 \mathrm{MHz}, 5.0 \mathrm{MHz}$, and 10.0 MHz are always easy to get. A 3.579545 MHz crystal was used in analog TV color-burst oscillators. Digital wristwatches use 32.768 kHz (divided by $2^{15}$ to get a useful 1 Hz ), and other powers of 2 are also common. A crystal oscillator can be adjusted slightly by varying a series or parallel capacitor, for example one of the 27 pF or 32 pF capacitors in Figures 7.38D and E. Given the low cost of crystals (much less than a dollar), it is worth considering a crystal oscillator in any application where you would have to strain the capabilities of $R C$ relaxation oscillators. ${ }^{43}$

[^341]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0479.jpg?height=614&width=795&top_left_y=221&top_left_x=975)

Figure 7.37. Impedance and phase in the neighborhood of the parallel resonance for the 10.0 MHz crystal of Figure 7.35. Here only one value of load capacitance ( $C_{\mathrm{L}}=30 \mathrm{pF}$ ) is shown, because the other values are completely off-scale. Once again, the high$Q$ resonance of our sample is considerably degraded for a crystal with worst-case specified $R_{1}=50 \Omega$.

Although crystal oscillators are not tunable, in the manner of relaxation oscillators or $L C$-based oscillators, you can use a varactor to vary some added external capacitance, thereby "pulling" the natural frequency of a parallel-mode quartz-crystal oscillator. The resulting circuit is called a "VCXO" (voltage-controlled crystal oscillator), and it augments the good-to-excellent stability of crystal oscillators with a small degree of tunability. The best approach is probably to buy a commercial VCXO, rather than attempt to design your own. Typically they produce maximum deviations of $\pm 10 \mathrm{ppm}$ to $\pm 100 \mathrm{ppm}$ from center frequency, though wide-deviation units (up to $\pm 1000 \mathrm{ppm}$ ) are also available.

An alternative, and a popular one at that, is to synthesize (with either a phase-locked loop, §13.13, or by direct digital synthesis, §7.1.8) any desired output frequency, using a crystal oscillator's fixed-frequency output as a "reference." The synthesized frequency can be changed easily under digital control, and it is as stable as the crystal oscillator itself. As a consequence, most contemporary communications equipment (radios, televisions, transmitters, cellphones, etc.) uses DDS or PLL synthesis to generate the needed internal frequencies.
made as a tiny etched silicon structure. Although these oscillators are not as stable as quartz, they can be very small (SiTime makes a series that measures $2 \mathrm{~mm} \times 2.5 \mathrm{~mm} \times 0.8 \mathrm{~mm}$ ), and they can incorporate temperature compensation and frequency synthesis circuitry naturally within the same silicon technology.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0480.jpg?height=978&width=1552&top_left_y=205&top_left_x=270)

Figure 7.38. Various crystal oscillators. Circuits D-G exploit portions of digital logic circuits: an inverter, a 14-stage binary counter, a microcontroller, and a frequency synthesizer, respectively.

#### D. Crystal oscillator circuits

Figure 7.38 shows some crystal oscillator circuits. In Circuit A the classic Pierce oscillator implemented with the versatile FET (see Chapter 3). The Colpitts oscillator, with a crystal instead of an $L C$, is shown in circuit B. An npn bipolar transistor with the crystal as feedback element is used for circuit C . The remaining circuits generate logiclevel outputs by using digital logic functions (circuits D through G). It's common to see an unbuffered logic inverter (i.e., a single CMOS transistor pair, as in Figure 3.90) used as a crystal oscillator (Figure 7.38D); in that application the inverter is biased into the linear region with a high-value feedback resistor, with the crystal providing (parallel-mode) resonant feedback. The LVC1404 is designed particularly for this application, with its pair of unbuffered inverters plus an optional Schmitt-trigger inverter (for generating abrupt output transitions); for low voltages (down to 0.8 V ) the 'AUP1GU04 ${ }^{44}$ works well. In this circuit (and in Figure 7.38E) the series resistor $R_{2}$ should be

[^342]chosen comparable to the reactance of $C_{2}$ at the oscillator frequency. ${ }^{45}$

Let us pause for a moment to ask how these latter parallel-mode circuits can oscillate, given that the crystal has a $0^{\circ}$ phase shift at its resonance (whether series or parallel mode; see Figures 7.36 and 7.37). What happens is that the load capacitance $C_{\mathrm{L}}$ is actually wired as a pair of capacitors ( $C_{1}$ and $C_{2}$ ) in series, with the midpoint grounded. So when there's an oscillating voltage across the crystal, the two ends are seesawing $180^{\circ}$ out of phase with each other; it's just like a center-tapped transformer winding. The inverting amplifier completes the $360^{\circ}$ phase shift needed for a sustained oscillation.

Turning back to the remaining circuits in Figure 7.38, it's quite common to see a pair of "XTAL" terminals on more complex digital ICs (microprocessors, waveform synthesizers, serial communications chips, etc.), an invitation to use the chip's internal oscillator circuit (usually a prebiased unbuffered inverter). In Figures 7.38E-G we've shown three such examples - a 14-stage binary frequency

[^343]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0481.jpg?height=462&width=797&top_left_y=213&top_left_x=122)

Figure 7.39. The coveted Art of Electronics logo wristwatch runs 3 years on a $1.5 \mathrm{~V}, 28 \mathrm{mAh}$ cell - that's just 1 microamp!
divider generating a precise 1.000 kHz square-wave output, a microcontroller whose serial port timing is set by the external 10.0 MHz crystal, and a frequency synthesizer chip that generates accurate frequencies needed for applications such as multimedia, communications, and data conversion (through a programmable PLL, $f_{\text {out }}$ from 1 MHz to 200 MHz ）。

Figure 7.39 shows an interesting niche application for crystal oscillators, the "quartz wristwatch." You need quartz stability here (there are 86,400 seconds in a day, so stability of "only" 1 part in $10^{4}$ would cause a drift of a minute per week); and, you need really low power. These inexpensive mass-produced products run their oscillators, frequency divider electronics, and drive power for a tiny stepping motor on a power budget of about a microwatt.

#### A micropower design

Challenged by the astonishingly low power of highly customized quartz-oscillator wristwatch circuits, we looked further into what can be done using only standard components. We chose the low-voltage 74AUP logic family (specified for $0.8-3.3 \mathrm{~V}$ operation), and we tested the standard parallel-resonant Pierce configuration, using an unbuffered inverter for the oscillator followed by a Schmitt inverter second stage to generate a clean switching waveform (Figure 7.40A).

The measured total supply current versus supply voltage is plotted in Figure 7.41 for both a 32.768 kHz (wristwatch) crystal and a 2.5 MHz crystal; these curves (marked " $R_{3}=R_{4}=0$ ") show a rapid increase in supply current with increasing supply voltage, caused by the "class-A" oscillator current (the overlapping conduction of the nMOS and pMOS inverter pair for mid-supply input voltages; see Figure 10.101) during the transitions of the input waveform.

A nice trick to reduce greatly this effect is to add a pair
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0481.jpg?height=1075&width=814&top_left_y=207&top_left_x=963)

Figure 7.40. Micropower crystal oscillator. A. Unbuffered inverter oscillator with Schmitt second stage. B. Reducing linear "shootthrough" current. C. Low-voltage oscillator drives full-voltage output inverter.
of resistors in the supply leads (Figure 7.40B); this produced the supply-current curve marked " $R_{3}=R_{4}=10 \mathrm{k}$," a factor of $20-50$ reduction for the 32.768 kHz oscillator. So we have a sub-microamp 32 kHz oscillator - but only for output voltages of less than a volt, which is lower than just about any logic device you might want the oscillator to drive. The final trick is to use that low-voltage oscillator to drive a full-voltage output stage (Figure 7.40C), with a blocking capacitor and large feedback resistor to bias the output stage in its linear region. With the oscillator and second stage running at 1.0 V , feeding a biased output inverter third stage running at 1.8 V , we measured $2.4 \mu \mathrm{~A}$ total supply current, compared with $12.8 \mu \mathrm{~A}$ for the 2 -stage oscillator alone (Figure 7.40 B ) running at 1.8 V ; this is a five-fold improvement. ${ }^{46}$

These modest experiments lead to the obvious question:

[^344]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0482.jpg?height=473&width=769&top_left_y=218&top_left_x=233)

Figure 7.41. Measured power-supply current for the oscillators of Figure 7.40. Each curve pair plots first-stage (lower) and two-stage (upper) supply current.
how do the watchmakers do it? If you poke around a bit, you can find some very interesting datasheets. For example, a company called "EM Microelectronic" offers a tiny IC, the EM7604, which it describes as a "Low Power Crystal Oscillator Circuit 32.768 kHz ." And they mean low: this puppy can run from 1.2 V to 5.5 V , and has a typical operating current of $0.3 \mu \mathrm{~A}$ or less at supply voltages between 3 V and 5 V . Perhaps a revealing hint as to their customer base is provided by the notation "Swatch Group Electronic Systems."

#### E. A caution

The proper design of crystal oscillators is not at all trivial it is essential to ensure that the product of circuit gain $A$ and crystal loss $B$ (i.e., the loop gain $A B$ ) is greater than unity, and that the overall phase shift going around the loop is an integral multiple of $360^{\circ}$, at the desired frequency of oscillation. ${ }^{47}$ The crystal loss (caused by $R_{\mathrm{S}}$ in the equivalent circuit) may prevent proper oscillation, with the shunt capacitance $C_{\mathrm{P}}$ alone providing an adequate path for oscillation at a frequency unrelated to that stamped on the crystal. You must be careful, also, to select a crystal intended for operation at its series or parallel resonance, as required by the external oscillator circuit. ${ }^{48}$ Oscillator chips and other ICs that accept an external crystal for their internal clocking (such as microcontrollers, see for example Figure 15.4) will state it clearly on the datasheet; here's an example, from the datasheet for the MPC9230 PLL synthesizer:
...As the oscillator is somewhat sensitive to loading on its inputs, the user is advised to mount the crystal as close to the MCP9230 as possible to

[^345]avoid any board level parasitics. . . . Because the series resonant design is affected by capacitive loading on the XTAL terminals, loading variation introduced by crystals from different vendors could be a potential issue. For crystals with a higher shunt capacitance, it may be required to place a resistance across the terminals to suppress the third harmonic. . . The oscillator circuit is a series resonant circuit and thus for optimum performance a series resonant crystal should be used. Unfortunately, most crystals are characterized in a parallel resonant mode.

And here's an example from the 174-page (!) datasheet for the PIC16F7x microcontroller, for which you connect the crystal between two pins, and a capacitor from each to ground:

The PIC16F7x oscillator design requires the use of a parallel cut crystal.

#### Capacitor selection for crystal oscillator (for design guidance only):

These capacitors were tested with the crystals listed below for basic start-up and operation. These values were not optimized. Different capacitor values may be required to produce acceptable oscillator operation. The user should test the performance of the oscillator over the expected $V_{D D}$ and temperature range for the application. See the notes following this table for additional information.
[a table of selected manufacturers' crystals follows, then more warnings.]
These are not idle warnings (though the severity of their disclaimers may have been encouraged by the company's legal department). In various situations we've found that one company's crystals work fine, and another's, with similar specifications, do not. This is most likely due to poorly specified properties such as effective series resistance and mount capacitance. Our experience with discrete crystaloscillator circuits has been, well, checkered.

#### F. Crystal oscillator modules

For reasons like these we favor the use of complete oscillator modules, to get bulletproof reliability. These cost more than bare crystals, ${ }^{49}$ but they include oscillator circuitry

[^346]guaranteed to work, and they provide logic-level squarewave output. You can use them as the oscillator for any IC to which you could attach a bare crystal, because all such ICs will also accept a clocking square-wave input.

Oscillator modules come in IC-style packages, such as standard DIP and smaller 4-pin surface-mountable styles. They come off-the-shelf in lots of standard frequencies (e.g., $1,2,4,5,6,8,10,16$, and 20 MHz , up to 100 MHz or so), as well as some weird frequencies used in microprocessor systems (e.g., 14.31818 MHz , used for video boards; or 22.118 MHz , a favorite for 8051-type microcontrollers because of serial port timing). These "crystal clock modules" typically provide accuracies (over temperature, power-supply voltage, and time) of a modest $0.01 \%$ ( 100 ppm ), but you get that performance inexpensively, reliably, and you don't have to wire up any circuitry.

If you need a non-standard frequency, you can get "programmable oscillator modules" that let you select the frequency, typically in the range of 1 MHz to 125 MHz or more; these cost roughly double that of standard modules (about $\$ 5$ each in small quantities), and are "one-time" programmable (you select the frequency when you order; or you can buy a programmer for $\sim \$ 500$ and program the "blank" oscillator modules in the field). These use PLL techniques to synthesize the desired output frequency from the standard-frequency internal oscillator (§13.13). ${ }^{50}$

Some manufacturers of crystal (and ceramic) oscillator modules are Cardinal Components, Citizen, Connor Winfield, Crystek, CTS, Ecliptek, ECS, Epson, Fox, Seiko, and Vishay.

#### G. Ceramic resonators

Before going on to discuss oscillators of higher stability (§7.1.7), we must mention ceramic resonators. Like quartz crystals, these are piezoelectric mechanical resonators, with electrical properties similar to those of quartz. They come in a limited selection of frequencies from about 200 kHz to 50 MHz . However, they are less precise (typically $\pm 0.3 \%$ ), with correspondingly poorer stability (typically $0.2 \%-1 \%$ over temperature and time). The good news is that they are small, dirt cheap (\$0.15$\$ 0.25\$ in small quantities), available with built-in capacitors (for about \$0.25-\$0.50), generally interchangeable in any quartz crystal oscillator circuit, and can be "pulled" over a frequency range of a few parts per thousand (owing to

[^347]their lower $Q$ value). They occupy a useful niche between $L C$ resonators and quartz crystals. They are available from companies like Abracon, AVX, ECS, Murata, Panasonic, and TDK.

#### H. SAW-based oscillators

If you need a stable oscillator at frequencies higher than are supported by crystal (or ceramic) resonators, there is the technology of surface acoustic waves (SAWs), used both for filters and for oscillators. You can get SAW oscillator modules in the frequency range from 100 MHz to 1 GHz . They are tiny (just like crystal-oscillator modules) and they have comparable stabilities ( 50 ppm over temperature). The down side is that only a sparse set of standard frequencies is available, and these things tend to be somewhat pricey (upward of \$50, in small quantities).

On the other hand, if you want to roll your own, you can get bare SAW resonators in the frequencies that are popular for garage-door openers, key fobs, and the like (433 MHz is widely used for these things) for about \$1; add an inexpensive bipolar transistor and a few passive components and you've got an oscillator. Attach a short piece of wire, and you've got a transmitter!

### 7.1.7 Higher stability: TCXO, OCXO, and beyond

Without great care you can obtain frequency stabilities of a few parts per million over normal temperature ranges with crystal oscillators. By using temperature-compensation schemes you can make a TCXO (temperature-compensated crystal oscillator) with somewhat better performance. Both TCXOs and uncompensated oscillators are available as complete modules from many manufacturers, e.g., Bliley, Cardinal Components, CTS Knights, Motorola, Reeves Hoffman, Statek, and Vectron. They come in various sizes, ranging from modules down to SMT and DIP packages. TCXOs deliver stabilities of 1 ppm over the range $0^{\circ} \mathrm{C}$ to $50^{\circ} \mathrm{C}$ (inexpensive) down to 0.1 ppm over the same range (expensive).

#### A. Temperature-stabilized oscillators

For the utmost in stability, you may need a crystal oscillator in a constant-temperature oven ("OCXO"). A crystal with a zero temperature coefficient at some elevated temperature $\left(80^{\circ} \mathrm{C}\right.$ to $\left.90^{\circ} \mathrm{C}\right)$ is used, with the thermostat set to maintain that temperature. Such oscillators are available as small modules for inclusion into an instrument or as complete frequency standards ready for rack mounting. The 1000B from Symmetricom is typical of high-performance
modular oscillators, delivering 10 MHz with stabilities of a few parts in $10^{11}$ over periods of seconds to hours.

When thermal instabilities have been reduced to this level, the dominant effects become crystal "aging" (the frequency tends to increase continuously with time), powersupply variations, and environmental influences such as shock and vibration (the latter are the most serious problems in quartz wristwatch design). To give an idea of the aging problem, the 1000B oscillator has a specified aging rate (after a month of break-in) of 1 part in $10^{10}$ per day, maximum. Aging effects are due in part to the gradual relief of strains, and they tend to settle down after a few months, particularly in a well-manufactured crystal. ${ }^{51}$

Oven-controlled crystal oscillators can be miniaturized, if need be, for portable applications that demand excellent oscillator stability. Valpey Fisher, for example, puts a resistive plating directly on the quartz crystal, creating a small $\mathrm{OCXO}\left(\sim 1.3 \mathrm{~cm}^{3}\right)$ requiring just 0.15 W of heater power.

#### B. Atomic standards

Atomic frequency standards are used where the stability of ovenized-crystal standards is insufficient. These use a microwave absorption line in a rubidium ( Rb ) gas cell, or atomic transitions in an atomic cesium (Cs) beam, as the reference to which a quartz crystal is stabilized. Commercially available Rb and Cs frequency standards achieve accuracy and stability of a few parts in $10^{11}$ and $10^{13}$, respectively. Cesium-beam standards are the official timekeepers in the United States, with timing transmissions from the National Institute of Standards and Technology (NIST) and the Naval Observatory.

Atomic hydrogen masers are yet another highly stable standard. Unlike Rb and Cs standards, the hydrogen maser is an actual oscillator (rather than a passive reference), with claimed stabilities approaching a few parts in $10^{14}$. Recent research in stable clocks has centered on techniques using "cooled" trapped ions or atoms, or "atomic fountains," to achieve even better stability. These schemes are being used to create precise optical standards, which are then bridged to a radiofrequency reference via an "optical comb." Many physicists believe that ultimate stabilities of parts in $10^{17}-$ $10^{18}$ are achievable.

Finally, you don't have to spend vast amounts of money to get an accurate frequency standard. Instead you can derive a precise 10 MHz clocking signal, along with 1 pps pulses, by receiving navigation signals from the Global

[^348]Positioning System (GPS). ${ }^{52}$ This is a constellation of 24 satellites in 12 -hour orbits, covering all but the arctic latitudes, designed for precise navigation and timing. The satellites carry stable atomic clocks, and they transmit "navigation messages" using sophisticated dual-frequency spread-spectrum methods, at 1.575 GHz and 1.228 GHz . A GPS receiver on the ground, collecting signals from four satellites, can triangulate its position, and time as well. The inexpensive handheld GPS receivers you can buy (from companies like Garmin and Magellan, or included in cell phones) are intended for navigation, and they do not recover or regenerate a reference frequency. However, you can spend more and get a carefully engineered laboratory standard. An example is the Symmetricom 58503B "GPS Time and Frequency Reference Receiver," which delivers a 10 MHz output (stable to 1 part in $10^{12}$, averaged over a day), and also 1 pps timing pulses (accurate to 20 nanoseconds); it costs $\$ 4,500$. All you need, to get this kind of precision, is a place to put the doorknob-size antenna; your tax dollars do the rest.

In Table 7.2 we've gathered together various oscillator technologies, and their characteristics. We hope you like it.

### 7.1.8 Frequency synthesis: DDS and PLL

A stable reference is stable, but not tunable. But, as we hinted earlier, there are two nice techniques that let you create an output frequency of your choosing, with the stability of the reference: direct digital synthesis (DDS), and phaselocked loop (PLL) synthesis. These are digital "mixedsignal" techniques, which we treat in detail in Chapters 12 and 13 . But they are closely related to oscillators and frequency generation, and so we will describe them here at a basic level.

#### A. Direct digital synthesis

The idea here is to program a digital memory with the numerical values of sine and cosine for a large set of equally spaced angle arguments (say for every $1^{\circ}$ ). You then make sinewaves by rapidly generating the sequential addresses, reading the memory values for each address (i.e., each sequential angle), and applying the digital values to a digital-to-analog converter. (DAC)

Figure 7.42 shows the scheme, in both its simplest notional form (a counter increments addresses to a sinelookup ROM), and in the (far better) method used in

[^349]Table 7.2 Oscillator Types ${ }^{a}$

| Class | Type | Stability | Tunability | Agility | Freq Range | Cost | Notes |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Relaxation and delay | RC relaxation delay Wien bridge | $\begin{gathered} 10^{-2} \text { to } 10^{-3} \\ 10^{-2} \text { to } 10^{-3} \\ 10^{-3} \end{gathered}$ | wide (>10:1) <br> modest $(\sim 5: 1)^{b}$ <br> modest (<10:1) | $\begin{gathered} \text { high } \\ \text { high } \\ \text { slow-slewing } \end{gathered}$ | Hz to 10's MHz 10 MHz to 100's MHz Hz to MHz | $\begin{aligned} & \text { low }(<\$ 10) \\ & \text { low }(<\$ 10) \\ & \text { low }(<\$ 10) \end{aligned}$ | 555, 1799, etc within an IC sinewave output |
| Resonator | LC ceramic crystal ("xtal") <br> xtal - TCXO <br> xtal - OCXO <br> SAW <br> cavity ${ }^{C}$ | $\begin{gathered} 10^{-3} \text { to } 10^{-5} \\ 10^{-2} \text { to } 10^{-3} \\ 10^{-5} \\ 10^{-6} \text { to } 10^{-7} \\ 10^{-8} \text { to } 10^{-9} \\ 10^{-4} \\ 10^{-5} \end{gathered}$ | modest small ( $<10^{-3}$ ) very small $\left(10^{-4}\right)$ very small $\left(10^{-4}\right)$ very small $\left(10^{-4}\right)$ very small $\left(10^{-4}\right)$ modest ${ }^{\mathrm{d}}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0485.jpg?height=234&width=150&top_left_y=443&top_left_x=838) | kHz to 100's MHz 100's kHz to 10's MHz 10's kHz to 100 MHz 10's kHz to 100 MHz 10's kHz to 100 MHz 100's MHz <br> 10's MHz to 10's GHz | $\begin{aligned} & \text { low }(<\$ 10) \\ & \text { low }(<\$ 10) \\ & \text { low }(<\$ 10) \end{aligned}$ $\begin{aligned} & \text { medium (\$10-100) } \\ & \text { high }(\$ 100-1000) \\ & \text { low }(<\$ 10) \end{aligned}$ <br> low to medium | ubiquitous <br> small, low jitter |
| Atomic | Rb vapor <br> Cs beam <br> H maser <br> GPS | $\begin{gathered} 10^{-10} \\ 10^{-13 f} \\ 10^{-14} \\ 10^{-13 \mathrm{k}} \end{gathered}$ | N.A. <br> N.A. <br> N.A. <br> N.A. | N.A. <br> N.A. <br> N.A. <br> N.A. | 10 MHz derived ref ${ }^{\mathrm{e}}$ 10 MHz derived refg 10 MHz derived refh 10 MHz derived ref | high (\$1k) <br> very high (\$10k) <br> even higher (>\$100k) <br> high (\$1k) | the def'n of the sec! <br> ref'd to NIST Cs stds |
| Referencederived | PLL synthesis "direct" synth DDS | equal to ref equal to ref equal to ref | wide wide wide | $\begin{gathered} t_{\mathrm{s}}=0-100 \mathrm{~ms} \\ t_{\mathrm{s}}=5-10 \mathrm{~ms} \\ \text { immediate } \end{gathered}$ | Hz to GHz Hz to GHz Hz to GHz | low-med (\$10-100) <br> high (>\$1k) <br> low-high (\$10-1000) |  |

Notes: (a) somewhat subjective evaluations. (b) tuning via operating current. (c) cylindrical cavity, waveguide, or dielectric "pill" resonator. (d) tuning via mechanical plunger, varactor, or YIG. (e) from 8.634488275 GHz resonance. (f) long-term. (g) from 9.192631770 GHz resonance. (h) from 1.420405751767 GHz oscillation. (k) long-term.
practice. In the latter a ROM with an $n$-bit address space (thus values of the sine at $2^{n}$ phases within a single $360^{\circ}$ cycle) is driven by a phase register that accumulates steps of phase according to the value of the "frequency tuning word" (FTW). At each clock the phase advances by $\Delta \phi=\left(360^{\circ} / 2^{n}\right) \cdot$ FTW, generating an output frequency $f_{\text {out }}=\mathrm{FTW} \cdot f_{\mathrm{clk}} / 2^{n}$, with any extra phase being carried forward from cycle to cycle.

This method has some drawbacks. The output is actually a staircase wave, since it is constructed from a set of discrete voltages, one for each table entry. You can, of course, use a lowpass filter to smooth the output; but having done so, you cannot span a wide range of frequencies, because the lowpass filter must be chosen to pass the sinewave itself while blocking the (higher) angle step frequency (the same problem applies to the switched-capacitor resonator; §7.1.9B). Decreasing the angular step size helps, but reduces the maximum output frequency.

Contemporary DDS chips include the sine lookup table, DACs, and everything else you need except for the stable fixed-frequency clocking input (usually provided by a simple crystal oscillator; §7.1.6). They are remarkably fast, and inexpensive. For example, the AD9850 series includes the AD9852, which goes to 150 MHz output frequency with 48-bit frequency resolution (that's a microhertz!!); it costs $\$ 15$ in quantity. If that isn't fast enough for you, perhaps the AD9912 (\$37), with its 1 GHz clocking speed $\left(f_{\text {out }(\max )}=400 \mathrm{MHz}\right)$ and 14-bit DAC will do the job.

DDS chips let you program frequency sweeps (a ramping frequency versus time); and also amplitude, frequency, and phase modulation (periodic variation over time). You can send frequency-changing commands at very high rates (100 million new frequencies per second, for the AD9852) to make an agile oscillator.

Various members of the family permit phase synchronization and precise phase offsetting, so you can make a precision programmable quadrature oscillator (i.e., simultaneous sine and cosine outputs) with stunning performance with just a few chips (and for a few dollars more).

#### B. Phase-locked loops

This mixed-signal technique synthesizes an output frequency $f_{\text {out }}$ that is related to the reference oscillator frequency $f_{\text {osc }}$ by a rational fraction; i.e., $f_{\text {out }}=(n / r) \times f_{\text {osc }}$, where $n$ and $r$ are integers. You can think of this as a generalization of the simple divide-by- $N$ frequency divider (where $f_{\text {out }}=f_{\text {osc }} / N$ ). Because PLLs blend analog and digital techniques, we'll discuss them in detail only later, in §13.13.

What's important to know now is that this gives you wonderful flexibility in oscillator frequency generation. For example, if we use a fixed-frequency 16 MHz crystal oscillator to drive a PLL chip and set $r=16$, then the output frequency will be exactly $n \mathrm{MHz}$, thus creating a highfrequency single-chip oscillator with output frequency settable in 1 MHz steps (with a typical output-frequency range
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0486.jpg?height=888&width=1565&top_left_y=209&top_left_x=258)

Figure 7.42. Direct digital synthesis creates its sinewave output from precomputed values of a sinusoid stored in ROM. The simplest configuration $(\mathrm{A})$ increments a counter to address successive values from ROM. Far better is a configuration with a phase accumulator (B), which delivers $n$ bits of output frequency resolution.
of $25-500 \mathrm{MHz}$ or so). PLL synthesis is used in telecommunications devices (such as radios, televisions, and cellular telephones) to set the operating frequency for each channel.

As this example suggests, the somewhat complex PLL clock-synthesis technique is available in easy-to-use chips, with someone else having done all the hard work (specifically, making a phase detector and a voltage-controllable oscillator, and stably closing the loop). There are, in addition, the inexpensive "programmable oscillator modules" we mentioned in §7.1.6F that incorporate a crystal oscillator and a PLL, so you can stock a single module type, and program its frequency when you're ready to use it. You can get these from the companies that make fixed-frequency modules, for example Epson (SG8002 series), ECS (ECSP series), Citizen (CSX-750P series), CTS (CP7 series), and Cardinal (CPP series). They come in the same DIP and SMT packages as conventional factory-set oscillators, with a slight price premium.

### 7.1.9 Quadrature oscillators

There are times when you need an oscillator that generates a simultaneous pair of equal-amplitude sine waves, $90^{\circ}$ out
of phase. You can think of the pair as sine and cosine (or $I$ and $Q$, for in-phase and quadrature). This is referred to as a quadrature pair (the signals are "in quadrature"). One important application is in radio communications circuits (quadrature mixers, single-sideband generation). Of great utility, as we explain below, a quadrature pair is all you need to generate any arbitrary phase.

The first idea you might invent is to apply a sinewave signal to an integrator (or differentiator), thus generating a $90^{\circ}$-shifted cosine wave. The phase shift is right, but the amplitude is wrong (figure out why). Here are some methods that do work.

#### A. Paired integrators

Figure 7.43 is a variation on a circuit that has been bouncing around now for several decades. It uses a pair of cascaded integrators ( $-90^{\circ}$ phase shift each) inside a feedback loop, closed by a unity-gain inverting amplifier ( $180^{\circ}$ phase shift). Oscillation occurs at a frequency at which each integrator has unity voltage gain; that is, at a frequency at which the capacitive reactance $1 / 2 \pi f C$ equals $R$. The diodes limit the amplitude to $\sim 300 \mathrm{mV}$. We tested this circuit with LMC6482 op-amps running from $\pm 5 \mathrm{~V}$, and with $R=15.8 \mathrm{k}$ and $C=10 \mathrm{nF}$ ( $\left.f_{\mathrm{osc}}=1 \mathrm{kHz}\right)$, producing
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0487.jpg?height=874&width=808&top_left_y=221&top_left_x=119)

Figure 7.43. Quadrature sinewave oscillator (adapted from a circuit by Tony Williams): A. Basic circuit, with diode limiter (dashed box). B. Biased limiter. C. Zener limiter.
the waveforms in Figure 7.44. The measured frequency was 997 Hz , with distortion of $0.006 \%$ and $0.02 \%$ for the sine and cosine outputs, respectively.

The simple diode limiter does not provide particularly good amplitude control, and it also limits the amplitude to $\sim 300 \mathrm{mV}$. An improved limiter is shown in Figure 7.43 B , in which the output is biased toward the supply rails by a pair of dividers, so that the diodes conduct only at a larger amplitude (set by the divider ratio). With the component values shown, the measured amplitude was 3.3 V. Figure 7.43C shows another limiter that some designers favor, using a zener wrapped in a diode bridge (therefore bidirectional) to set the amplitude. You can use regular zener diodes for larger amplitudes ( 5 V and above), but low-voltage zeners perform poorly, with their "soft knees" (see Figure 1.17). But you can use instead a low-voltage 2-terminal reference, which behaves like a nearly perfect zener; some examples are the LM385-1.2 and $-2.5(1.24 \mathrm{~V}$ and 2.50 V$)$, the AD1580 (1.22 V), and the ADR510 (1.0 V). With any of these schemes it's a good idea to put a capacitor across the zener (or reference) to hold its voltage during zero crossings of the waveform.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0487.jpg?height=412&width=651&top_left_y=220&top_left_x=1047)

Figure 7.44. Measured output from the circuit of Figure 7.43A. Horizontal: $200 \mu \mathrm{~s} /$ div. Vertical: $100 \mathrm{mV} /$ div.

#### B. Switched-capacitor resonator

This is a clever method: Figure 7.45 shows how to use a switched-capacitor filter IC as a self-excited bandpass filter to generate a quadrature sinewave pair. The easiest way to understand it is to assume there is already a sinewave output present. Op-amp $U_{2 \mathrm{a}}$, wired as a comparator, converts this to a $\pm 5 \mathrm{~V}$ square wave, which is fed back as the filter's input. The filter has a narrow bandpass $(Q=10)$, so it converts the input square wave to a sinewave output, sustaining the oscillation. A square-wave clock input (CLK) determines the bandpass center frequency and hence the frequency of oscillation, in this case $f_{\mathrm{CLK}} / 100$. The circuit
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0487.jpg?height=799&width=802&top_left_y=1366&top_left_x=974)

Figure 7.45. You can generate a pair of quadrature sinewaves by feeding back the squared-up output of a narrow bandpass filter, implemented in a switched-capacitor filter IC.
generates a quadrature pair of sinewaves of equal amplitude, and is usable over a frequency range of a few hertz to more than 10 kHz . Note that the output is actually a "staircase" approximation to the desired sinewave, owing to the quantized output steps of the switched filter - see Figure 7.46.

An interesting feature of this circuit is its ability to "calculate pi"': the filter is configured with an accurate gain of $R_{3} / R_{1}=0.2$, and its input is an accurate $\pm 5 \mathrm{~V}$ square wave, so one might expect an output amplitude of $\pm 1 \mathrm{~V}$. But no - the filter retains only the fundamental frequency component of the square wave, which has an amplitude equal to $4 / \pi$ times that of the square wave. So, voilà, we get an output amplitude of $4 / \pi$ volts (about 1.27 V ), as seen in the 'scope traces.

#### C. Direct digital synthesis

We saw this popular method earlier (\$7.1.8) as a general way to synthesize a sinewave (or any "arbitrary" wave, if you want) of precise frequency, relative to an accurate reference frequency input. Among its many virtues, this method lends itself well to the generation of a pair of signals in quadrature (or any other phase relationship, if you want). Figure 7.47 shows a nice chip from Analog Devices that is intended for quadrature sinewave generation; it permits frequency adjustment in steps of a microhertz, along with a large bag of tricks that includes digital mixers (for quadrature amplitude modulation), and timers and accumulators (for frequency or phase modulation, nonlinear chirp, etc). The datasheet makes for some good reading!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0488.jpg?height=519&width=820&top_left_y=1524&top_left_x=210)

Figure 7.46. Observed waveforms from the circuit of Figure 7.45. The switched capacitor filter generates a staircase approximation to the ideal quadrature sinewaves, more evident when the filter is set to the coarser 50:1 $f_{\text {CLK }} / f_{\text {out }}$ ratio. This filter knows the value of $\pi$ : the output amplitude is $4 / \pi$ volts! Horizontal: $200 \mu \mathrm{~s} /$ div; Vertical: $1 \mathrm{~V} / \mathrm{div}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0488.jpg?height=350&width=700&top_left_y=218&top_left_x=1119)

Figure 7.47. Quadrature generation by DDS. The AD9854 has many additional tricks up its sleeve (see text).

#### D. Phase-sequence filters

There are tricky $R C$ filter circuits that have the property of accepting an input sinewave and producing as output a pair of sinewave outputs whose phase difference is approximately $90^{\circ}$. The radio hams know this as the "phasing" method of single-sideband generation (due to Weaver), in which the input signal consists of the speech waveform that you want to transmit. Unfortunately, this method works satisfactorily only over a rather limited range of frequencies and requires precision resistors and capacitors.

A better method for wideband quadrature generation uses "phase-sequence networks," consisting of a cyclic repetitive structure of equal resistors and geometrically decreasing capacitors, as in Figure 7.48. You drive the network with a signal and its $180^{\circ}$-shifted cousin (that's easy, since all you need is a unity-gain inverter). The output is a fourfold set of quadrature signals, with a 6 -section network giving $\pm 0.7^{\circ}$ error over a 40:1 frequency range; an 8 section network extends the range to $150: 1$. This is demonstrated in Figure 7.49, a SPICE simulation of an 8 -section phase-sequence network, showing the behavior of a pair of quadrature outputs with good performance from 400 Hz to 50 kHz .

#### E. Quadrature square waves

For the special case of square waves, generating quadrature signals is a lead-pipe cinch. The basic idea is to generate twice the frequency you need, then divide by 2 with digital flip-flops. Figure 7.50 shows a simple circuit that does this, using type-D flip-flops (Chapter 10). This technique is essentially perfect from dc to at least 100 MHz .

#### F. Radiofrequency quadrature

At radio frequencies (upward of a few megahertz) the generation of quadrature sinewave pairs again becomes easy, using devices known as quadrature hybrids (or quadrature splitter-combiners). At the low-frequency end of the radio spectrum (from a few megahertz to perhaps 1 GHz ) these
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0489.jpg?height=1167&width=779&top_left_y=223&top_left_x=136)

Figure 7.48. Four-section phase-sequence network. The network is effective for frequencies extending from a low frequency $f_{\text {Low }} \approx 0.2 / R C$ to a high end that depends on the ratio of capacitances of the first and last section, as $f_{\mathrm{HIGH}} / f_{\mathrm{LOW}} \approx C_{\text {first }} / C_{\text {last }}$.
take the form of small core-wound transformers, while at higher frequencies you find incarnations in the form of stripline (strips of foil insulated from an underlying ground plane; see Chapter $1 x$ ) or waveguide (hollow rectangular tubing). These techniques tend to be fairly narrowband, with typical operating bandwidths of an octave (i.e., ratio of $2: 1$ ).

#### G. Generating a sinewave of arbitrary phase

Once you have a quadrature pair, it's easy to make a sinewave of arbitrary phase. You simply combine the inphase $(I)$ and quadrature $(Q)$ signals in a resistive combiner, made most easily with a potentiometer going between the $I$ and $Q$ signals. As you rotate the pot, you combine the $I$ and $Q$ in different proportions, taking you smoothly from $0^{\circ}$ to $90^{\circ}$ phase. If you think in terms of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0489.jpg?height=777&width=795&top_left_y=221&top_left_x=975)

Figure 7.49. Phase and amplitude behavior of an 8 -section phasesequence network (with $R=10 \mathrm{k}, C=40 \mathrm{nF}$ ), as modeled in SPICE. The lower plot expands the region of accurate quadrature. Note that it is the difference of phases (dashed curves) that are in quadrature.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0489.jpg?height=470&width=552&top_left_y=1260&top_left_x=1102)

Figure 7.50. Square waves in quadrature, courtesy of the versatile type-D flip-flop.
phasors, you'll see that the resulting phase is completely independent of frequency; however, the amplitude varies somewhat as you adjust the phase, dropping 3 dB at $45^{\circ}$. You can extend this simple method to the full $360^{\circ}$ by simply generating the inverted ( $180^{\circ}$-shifted) signals, $I^{\prime}$ and $Q^{\prime}$, with an inverting amplifier of gain $G_{\mathrm{V}}=-1$.

The generation of sinusoidal bursts of predetermined phase (and amplitude) is of great importance in digital communications. It is used in particular in the method of quadrature amplitude modulation (QAM, pronounced
"quahm"), in which several bits are encoded in each QAM "symbol." For example, most digital cable television is encoded as 256 -QAM, with each symbol (out of a constellation of 256) carrying 8-bits of information; you can think of the individual symbols as little bursts of several sinusoidal cycles, with a particular phase and amplitude characterizing each symbol. ${ }^{53}$

With DDS it is even easier to set the output phase (relative to a synchronizing pulse, or to a second DDS synthesizer that is synchronized to the first), because DDS chips let you add a user-specified offset to the internal accumulating phase that is used to generate the sinewave. For example, the AD9951 has a 14-bit phase-offset word, giving you a phase-settable step size of $360^{\circ} / 2^{14}$, or $0.02^{\circ}$. You can change the phase on-the-fly to produce phase modulation.

### 7.1.10 Oscillator "jitter"

In addition to the primary oscillator parameters - frequency, amplitude, and waveform - there is stability: if an oscillator drifts with time, temperature, or supply voltage, we talk about stability (or lack thereof), and we may assign corresponding coefficients. For example, a crystal oscillator might specify a tempco of $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. That's important for applications such as timekeeping, communications, or spectroscopy.

But it's not the whole story. You could, for example, have an oscillator that maintains a precise 10.0 MHz average frequency, independent of time and temperature, but that exhibits variations in the timing of its zero crossings from cycle to cycle. (If you like, you can think of this as an instability on a short time scale, as compared with the long time scales of effects like drift with time and temperature. ${ }^{54}$ ) This undesirable property has several names, depending on the context: if it's a sinewave, and you're using it in a communications application, you call it phase noise, or spectral purity; if instead it's a square wave or digital pulse train, and you're using it for waveform sampling and reconstruction, or for clocking fast digital data links, you call it jitter.

A bit more on this business of jitter. Timing jitter arises whenever an output transition is created by a periodic signal crossing a decision threshold, as for example

[^350]in an $R C$ relaxation oscillator or a crystal oscillator. Figure 7.51 shows the situation. A signal of finite slew rate $S$ (volts/second) is crossing a voltage threshold, and both the signal and the voltage threshold are imperfect, each with some additive noise voltage $v_{\mathrm{n}}$; we'll call these $v_{\mathrm{n}}(\mathrm{sig})$ and $v_{\mathrm{n}}(\mathrm{th})$. So there's a timing uncertainty, such that the time at which the (noisy) signal crosses the (noisy) threshold can (and will) vary by
$$
\Delta t=\frac{\sum v_{\mathrm{n}}}{\text { slew rate }}=\frac{v_{\mathrm{n}}(\mathrm{sig})+v_{\mathrm{n}}(\mathrm{th})}{S}
$$

Jitter is greater with slowly slewing signals, for a given amount of signal or threshold noise. A sinewave of frequency $f$ has a maximum slew rate of $S=2 \pi f V_{0}$, where $V_{0}$ is the peak signal amplitude (though less if the threshold is not at the amplitude midpoint); the slew rate of a pulse or step can be approximated by $S=V_{\text {step }} / t_{\mathrm{r}}$, where $t_{\mathrm{r}}$ is the rise time (or, more generally, transition time).

Oscillator stability and jitter are important subjects, and we'll have more to say about them in Chapter 13, in connection with digital-analog conversion, serial digital communication, and phase-locked loops.

## 7.2 Timers

Oscillators generate a periodic signal, characterized by its waveform (sine, square, pulse), its frequency, and its amplitude. Closely related to oscillators are timers: circuits that generate a delayed pulse, or a pulse of a given width, following a triggering event. Here you talk about delay times and pulse widths rather than about frequency. The techniques, however, are quite similar, consisting mostly of $R C$-style analog waveforms (driving comparator-trigger circuits), or oscillator-driven digital counters or dividers.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0490.jpg?height=506&width=565&top_left_y=1683&top_left_x=1187)

Figure 7.51. Timing jitter basics: a signal of finite slew rate passes through a decision threshold.

There's quite a range of techniques, depending on the time scale involved and the accuracy required. We visit most of the techniques in common use.

### 7.2.1 Step-triggered pulses

Sometimes you need to generate an output pulse, of some duration, from an input trigger. The input may be a short pulse, from which you want to generate a longer output pulse; alternatively, the input may be a "step" (usually a logic-level transition, longer than the desired output pulse), from which you want to generate a short pulse.

#### A. Short pulse from step: $\boldsymbol{R C + d i s c r e t e}$ transistor

An $R C$ differentiator turns a voltage step into a step with a trailing decay of time constant $R C$ (Figure 7.52A). You can use the output directly, or you can run it through a transistor switch to generate something more like a rectangular pulse. Figure 7.52B shows the ubiquitous 2N7000 small MOSFET used to generate an output pulse of either polarity (swinging between a positive rail and ground); the pulse width is of order $\tau=R C$, but depends upon the ratio of gate threshold voltage to input step size. In Figure 7.52 C we show the analogous circuits with a fast bipolar switching transistor (a PN2369: it uses gold-doping to reduce base charge storage time to 13 ns maximum, compared with 200 ns for a plain ol' jellybean like the $2 \mathrm{~N} 3904^{55}$ ). Note that a series resistor $\left(R_{1}\right)$ is needed to limit the peak base current. The exact timing behavior with a BJT is more complicated than with a MOSFET, because of forward basevoltage clamping: for the circuit with rising-edge input, the output pulse width is determined primarily by $R_{1} C$ (which sets the decay of forward base drive current); for the circuit with falling-edge input, on the other hand, the output pulse width is determined primarily by $R_{2} C$ (which times the recovery from base back-bias to forward bias, assuming $R_{2} \gg R_{1}$ ), as given by the formula shown. For the latter circuit the input step amplitude $V_{\text {step }}$ should be no larger than $\sim 6 \mathrm{~V}$ to prevent base-emitter reverse breakdown.

A caveat: with the exception of the falling-edge BJT in Figure 7.52C, the pulse widths generated by these circuits are somewhat unpredictable, and they should not be used where accurate timing is needed. We will see better methods shortly.

This is a situation where SPICE simulation provides

[^351]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0491.jpg?height=1146&width=812&top_left_y=218&top_left_x=964)

Figure 7.52. Generating a pulse from a step with $R C$ 's and transistors. A. Bare $R C$ differentiator. B. $R C$ drives MOSFET switch. C. $R C$ drives BJT switch.
a useful tool for exploring detailed circuit behavior. Figure 7.53 shows a comparison of bench measurement and simulation for the falling-edge circuit of Figure 7.52C, running from $\mathrm{a}+5 \mathrm{~V}$ supply, when driven by a 5 V falling step of 5 ns fall time. The rather good agreement validates the use of the simulation models and tools. Note particularly the accurate simulation of delay time (the input step began at 20 ns ), transistor saturation voltage, base voltage, and output waveform (which, though not visible in the printed figure, overshoots the +5 V rail by about 40 mV , owing to capacitive coupling of the rising base voltage).

We'll be seeing more accurate and predictable ways to generate output pulses from input edges. But this simple method is fine for noncritical jobs, for example driving a hefty latching power relay, as shown in Figure 7.54. This
beta and higher leakage current; these transistors are well suited for fast switching, but not much else.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0492.jpg?height=851&width=797&top_left_y=207&top_left_x=221)

Figure 7.53. Simulated (lower) and measured (upper) waveforms of the right-hand circuit of Figure 7.52 C , with $R_{1}=220 \Omega, C_{1}=47 \mathrm{pF}$, $R_{2}=2.2 \mathrm{k}, R_{C}=470 \Omega$, and with 'scope probing capacitance to ground of 8 pF at base and collector. The SPICE plot and the 'scope trace have been scaled identically, at $20 \mathrm{~ns} / \mathrm{div}$ and $1 \mathrm{~V} / \mathrm{div}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0492.jpg?height=448&width=669&top_left_y=1373&top_left_x=283)

Figure 7.54. A 20 ms pulse actuates a latching power relay. This is a "2-coil" latching relay (for SET and RESET), only one of which is shown. This particular relay costs $\$ 23$, and includes high-current PCB and FastOn (spade lug) contacts.
particular relay's contacts are rated at 30 A and 250 Vac ; it has a pair of coils (set, reset), which you drive by applying 24 Vdc for a minimum of 20 ms . We tested the circuit in our lab - it made an impressive clatter that could be heard down the hallway.

#### B. Pulse from step or edge

With the addition of a couple more transistors you arrive, finally, at a pulse output circuit that is happy to trigger either on a step or on a short pulse; that is, it is edge triggered, and insensitive to whether the triggering edge belongs to a pulse that is shorter or longer than the desired output pulse length. We showed this classic BJT "one-shot" circuit earlier, in the transistor chapter - see Figure 2.12. You can wire up that configuration, if you want. But you're probably better off using an integrated monostable multivibrator: these devices take care of the details, and they provide flexible triggering options. We'll look at them next, after taking a brief look at the use of digital logic gates for generating short pulses.

#### C. Short pulse from step: logic gates

A closely related technique uses digital logic gates (Chapter 10) in place of discrete transistors. This is particularly useful if you want output signals to drive additional logic, because the output signals are of the correct logic voltages and speeds. In Figure 7.55 a logic inverter (§10.1.4D) with built-in Schmitt trigger (\$4.3.2A) is used to create output pulses with abrupt transitions; although the edges are fast (owing to the Schmitt trigger), the timing is only approximate, because the Schmitt voltage thresholds are loosely specified (e.g., the specified hysteresis amplitude spans a range of $3: 1$ ).

In Figure 7.56A the short propagation delay of logic inverters (of order several nanoseconds), combined with the logic of gates, substitutes for $R C$ delays to create the output pulse width; the three circuits shown respond to rising, falling, or both edges, respectively. The circuits in Figure 7.56B extend this gate idea to longer output pulse widths, by using an $R C$ delay, sharpened up with a Schmitt inverter, to provide the delayed input to the gate.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0492.jpg?height=335&width=817&top_left_y=1789&top_left_x=1061)

Figure 7.55. A logic inverter with Schmitt-trigger input creates a clean output pulse. $R_{1}$ limits gate input current when the input signal returns to its initial level, during which the gate input is driven below ground or above $V_{+}$, respectively.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0493.jpg?height=897&width=810&top_left_y=207&top_left_x=118)

Figure 7.56. Generating a pulse from a step, with logic gates. A. Short pulses made with 2 -input gates and cascaded inverter delays. B. Longer pulses made with 2-input gates and $R C$ delays.

#### D. Short pulse from edge: monostable multivibrators

If these last circuits appeal to you, you're in luck: the semiconductor industry has created a class of integrated circuits that combines digital logic with an $R C$ timing circuit, in the form of the monostable multivibrator (also known as a "one-shot," emphasis on the word "one"). These are edge triggered, with timing set with good accuracy by an external $R C$ and with clean logic-level outputs. The output pulse can be short compared with the input duration (as with the circuits above); or it can be longer than the input (as with the circuits we discuss next). This topic has plenty of complexity, so we postpone a full discussion to §7.2.2.

#### E. Long pulse from trigger: the 555 returns!

The circuits above create an output pulse shorter than the input. That's OK, if it's what you want. But you might want the opposite: a brief input pulse triggers a longer output - think of the one-minute zapper button on a microwave oven, for example. The methods here can be grouped, roughly, into two categories: (a) $R C$-mediated analog timing circuits, and (b) oscillators followed either by dedicated digital counter-dividers, or by the full computational glory of microprocessors (computers-on-a-chip). In the first cat-
egory are devices like the classic 555 (which we used earlier to make an $R C$ relaxation oscillator, §7.1.3), and the monostable multivibrator (a dedicated pulse-generating chip).

Looking back in the chapter, we made an oscillator with the 555 by driving both the TH and the $\mathrm{TR}^{\prime}$ inputs with the voltage on the capacitor (Figures 7.9-7.14); those inputs flipped the output state (and the DIScharge transistor), causing the cyclic charging and discharging of the capacitor. To make instead a single pulse, connect the capacitor to the TH input only, and use the $\mathrm{TR}^{\prime}$ terminal as a trigger input (Figure 7.57). A negative-going input starts the cycle, turning off the DIS transistor and causing the output to go HIGH; when the capacitor voltage reaches $2 / 3$ of $V_{+}$the cycle ends, with the output returning to LOW and the DIS pin discharging the capacitor rapidly to ground. It is easy to calculate the pulse width, namely $t=1.1 R C$. Note that the input trigger must be removed before the end of the pulse, that is, it must be shorter than the intended output pulse. Look back at Figure 4.41 to see how to make a programmable one-shot pulse generator (with "cold switching" control of the pulse width) with a 555.

Roughly speaking, a CMOS 555 (see Table 7.1 on page 430) can generate pulse widths from about $1 \mu \mathrm{~s}$ to $100 \mathrm{sec}-$ onds. At the long end the limit is set by residual TH input current, which is less than 10 nA , so values of $R$ as large as $10-100 \mathrm{M} \Omega$ can be used. At the short end, the minimum resistor value is limited by the maximum DIS current ( $\sim 15 \mathrm{~mA}$ with a 5 V supply) and the intrinsic speed of the 555. Another limitation of the 555 is the awkward input trigger condition, namely a negative-going pulse that must return to its positive quiescent voltage before the end of the output. The latter problem is addressed nicely in the class of timer chips known as monostable multivibrators.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0493.jpg?height=402&width=715&top_left_y=1730&top_left_x=1015)

Figure 7.57. The venerable 555 generates a single positive output pulse when connected in monostable mode. The input $R C$ differentiator converts a falling step into a trigger pulse; it can be omitted if a short trigger pulse is available to drive the TR' input.

### 7.2.2 Monostable multivibrators

Within the various families of digital logic ( $\S 10.1 .2 \mathrm{~B}$, §10.2.2) you can get monostable multivibrators (oneshots), which you can think of as logic-friendly versions of the 555 as it was used in Figure 7.57. They are edge triggered (by standard logic levels), and generate a logiclevel output pulse $Q$ (and its complement $Q^{\prime}$ ) whose width is determined by an external $R$ and $C$. Monostables are very useful (some would say too useful!) for generating pulses of selectable width and polarity. Making one-shots with $R C$ 's combined with discrete transistors or gates (as we've just done) is tricky, and depends, for example, on the details of a gate's input circuit, since you wind up with voltage swings beyond the supply voltages. Rather than encouraging bad habits by illustrating more such circuits, we encourage you to adopt the one-shot as an available functional unit. In actual circuits it is best to use a packaged one-shot; you construct your own only if absolutely necessary, e.g., if you have a gate available and no room for an additional IC package (even then, maybe you shouldn't).

#### A. What's inside

Although you can happily use monostables without ever worrying about what's happening inside, it is an interesting place to visit. Figure 7.58 shows the internal circuit scheme used in most monostables. There are pins for an external $C$ and $R$; the latter charges the capacitor toward $V_{+}$, which can range from +2 V to +15 V , depending on the particular logic family. ${ }^{56}$ In the resting state the capacitor is fully charged, and the output flip-flop is reset, i.e., $Q$ is Low (ground) and $Q^{\prime}$ is $\mathrm{HIGH}\left(V_{+}\right)$.

Look at the waveforms in the figure, and assume for now that the three resistors $R_{1}-R_{3}$ are of equal resistance. ${ }^{57}$ When the trigger condition is met (more on this below), for example by bringing input $B$ HIGH while input $A^{\prime}$ is LOW, two things happen: (a) the output $Q$ goes HIGH; and (b) the capacitor is rapidly discharged toward ground by the lower MOSFET. ${ }^{58}$ When the capacitor's falling voltage reaches $\frac{1}{3} V_{+}$, the control circuitry removes gate drive from the lower MOSFET, allowing the capacitor to charge back up through $R_{\text {ext }}$; this begins the $R C$-mediated timing interval, which ends when the capacitor's voltage reaches $\frac{2}{3} V_{+}$,

[^352]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0494.jpg?height=1001&width=799&top_left_y=219&top_left_x=1075)

Figure 7.58. Internal circuit and waveforms for a monostable multivibrator. The waveforms show retriggerability.
at which time the output flip-flop is reset, ending the output pulse by bringing $Q$ again Low. It's a straightforward exercise in $R C$ time constants to find that this takes a time

$$
\begin{equation*}
t=R C \log _{e} \frac{V_{+}-V_{\mathrm{L}}}{V_{+}-V_{\mathrm{H}}}, \tag{7.1}
\end{equation*}
$$

where $V_{\mathrm{L}}$ and $V_{\mathrm{H}}$ are the lower and upper threshold voltages.

Exercise 7.6. Derive this formula.

#### B. One-shot characteristics Inputs

One-shots are triggered by a rising or falling edge at the appropriate inputs. The only requirement on the triggering signal is that it have some minimum width, typically 25 ns to 100 ns ; it can be shorter or longer than the output pulse. Two inputs are usually provided so that a signal can be connected to one or the other, to trigger the one-shot either on a rising edge or on a falling edge; alternatively, both inputs can be used, with a pair of separate triggering sources. The extra input can also be used to inhibit triggering. Figure 7.59 shows two examples.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0495.jpg?height=352&width=686&top_left_y=216&top_left_x=177)

| $A$ | $\bar{B}$ |
| :---: | :---: |
| $\uparrow$ | H |
| L | $\downarrow$ |


| $\bar{A}$ | $B$ | $\bar{R}$ |
| :---: | :---: | :---: |
| $\downarrow$ | H | H |
| L | $\uparrow$ | H |
| L | H | $\uparrow$ |

Figure 7.59. Two popular one-shots and their truth tables. Monostables trigger on input transitions, and usually accommodate either polarity, with internal AND or OR gating. Most monostables include Schmitt trigger inputs.

Each horizontal row of the truth tables represents a valid input triggering transition. For example, the ' 4538 is a dual monostable with OR gating at the input; if only one input is used, the other must be disabled, as shown. The popular ' 123 is a dual monostable with AND input gating; unused inputs must be enabled. Note particularly that the ' 123 triggers when RESET is disabled if both trigger inputs are already asserted. This is not a universal property of monostables, and it may or may not be desirable in a given application (it's usually not). The ' 423 is the same as the ' 123 , but without this "feature."

When monostables are drawn in a circuit diagram, the input gating is usually omitted, saving space and creating a bit of confusion.

#### Retriggerability

Most monostables (e.g., the 4538, '123, and ' 423 mentioned earlier) will begin a new timing cycle if the input triggers again during the duration of the output pulse (as in Figure 7.58). They are known as retriggerable monostables. The output pulse will be longer than usual if they are retriggered during the pulse, finally terminating one pulse width after the last trigger. The '221, by contrast, is nonretriggerable: it ignores input transitions during the time that the output pulse is asserted.

#### Resettability

Most monostables have a jam RESET input that overrides all other functions. A momentary input to the RESET terminal terminates the output pulse. The RESET input can be used to prevent a pulse during power-up of the logic system; however, see the preceding comment about the ' 123.

Table 7.3 Monostable Multivibrators

| Type | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0495.jpg?height=119&width=50&top_left_y=284&top_left_x=1107) | Trig | Families |
| :---: | :---: | :---: | :---: |
| '123a | $\cdot$ | ! A \& B \& !R | AHC(T), HC(T), LS, LV, LVC, VHC |
| '221 | - | ! A \& B | 74C, HC(T), LS, LV, VHC |
| '423 | $\cdot$ | ! A \& B | HC(T), LS |
| ‘4538 | $\cdot$ | $A$ or B | 4000, HC(T) |
| Notes: (a) See Table 7.4. |  |  |  |

#### Pulse width

Pulse widths from 40 ns up to milliseconds (or even seconds) are attainable with standard monostables, set by an external capacitor and resistor combination. A device like the 555 can be used to generate longer pulses, but its input properties are sometimes inconvenient. Very long delays are best generated digitally (see §7.2.4).

Table 7.3 lists the commonly available monostables. In addition to these traditional logic-family monostables, be sure to look at the LTC6993 "TimerBlox" one-shots (see table on page 433). It has only one trigger input, but four variants let you choose rising- or falling-edge triggering, and retriggerable or non-retriggerable. You set the pulse width with a range selection pin (via a voltage divider from $V_{+}$), and another external resistor that allows continuous tuning over a $16: 1$ span within the selected range. The eight digitally-divided ranges jump by successive factors of 8 , thus a total range of $2^{21}: 1$. Output pulse widths range from $1 \mu \mathrm{~s}$ to 34 seconds, with worst-case timing accuracy of a few percent.

#### C. Cautionary notes about monostables

Monostables have some problems you don't see in other digital circuits. In addition, there are some general principles involved in their use. First, a rundown on monostable pathology.

#### Some problems with monostables

Timing One-shots involve a combination of linear and digital techniques. Because the linear circuits have the usual problems of $V_{\mathrm{GS}}$ (or $V_{\mathrm{BE}}$ and beta) variation with temperature, etc., one-shots tend to exhibit temperature and supplyvoltage sensitivity of output pulse width. A typical unit like the ' 4538 will show pulse-width variations of a few percent over a $0-50^{\circ} \mathrm{C}$ temperature range and over a $\pm 5 \%$ supply-voltage range. In addition, unit-to-unit variations give you a $\pm 10 \%$ prediction accuracy for any given circuit. When looking at temperature and voltage sensitivity, it is
important to remember that the chip may exhibit selfheating effects and that supply-voltage variations during the pulse (e.g., small glitches on the $V_{+}$line) may affect the pulse width seriously.

Brand variation Monostables with the same generic part number, but made by different manufacturers, may have somewhat different specifications, particularly involving timing components. The usual way this is specified is by a " $K$-value," where the output pulse width (for all but smallvalue capacitors) is given approximately by $t_{\mathrm{w}}=K R C$ (if the datasheet does not mention $K$, look for the pulse width with $R=10 \mathrm{k}$ and $C=100 \mathrm{nF}$ ). And here's how it goes: nearly all monostables fall into three clusters of $K$-values, either $K=0.7$ (all of the ' 4538 monostables), or $K$ is either $\approx 0.45$ or $\approx 1.0$ (most other monostable part numbers).

The ' 4538 monostables are boring! They all have $K=0.7$ (hey, not a bad reason for choosing it. . .). But there's some excitement with the other part numbers, because the $K$ value for a given part number may be 1.0 or 0.45 , depending on who makes it. For example, the 74 HC 123 is available from at least five manufacturers. ${ }^{59}$ The FSC and Toshiba parts guarantee an output pulse width of $0.9-$ 1.1 ms (with 1.0 ms typ) for 10 k and 100 nF , but the NXP part instead specifies 0.45 ms (typ, with no minimum or maximum spec). The other two brands have chosen different $R C$ combinations, at which they specify typical values only: ST uses $100 \mathrm{nF} / 100 \mathrm{k} \Omega$ ( 4.4 ms typ), and TI uses $10 \mathrm{nF} / 10 \mathrm{k} \Omega(45 \mu \mathrm{styp})$. Evidently these parts are not fully interchangeable! ${ }^{60}$ This caution extends generally to analog and mixed-signal devices of all kinds (consider yourself warned).

To illustrate this point, we've collected in Table 7.4 a comprehensive listing of all available ' 123 -style monostables. The data include the timing variable $K$ that you can use to predict the pulse width according to $t_{w}=K R C+t_{\min } .{ }^{61}$ The effective value of $K$ varies with supply voltage, so in Figure 7.60 we've made graphs showing this dependence for the monostables listed in Table 7.4.

Another parameter that varies with manufacturer, and that is not generally specified on datasheets, is the particular choice of threshold voltages - that is, the ratios of the internal resistors $R_{1}-R_{3}$ in Figure 7.58. That does matter, though, because the rapid discharging of a small-value tim-

[^353]Table 7.4 "Type 123" Monostable Timing

| Mfg | Part Number ${ }^{\text {a }}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0496.jpg?height=145&width=36&top_left_y=276&top_left_x=1430) | Vsupply |  | $K^{\text {C }}$ | $t_{(\mathrm{ns})}$ |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  | min <br> (V) | $\max _{(\mathrm{V})}$ |  |  | + |
| multiple | 74LS123 $\dagger$ | $\cdot$ | 4.5 | 5.5 | 0.37 | - |  |
| Toshiba | TC74HC123 | - | 2 | 6 | 1.00 | 150 | 1 |
| Renesas | HD74HC123 ${ }^{\dagger}$ | - | 2 | 6 | 1.00 | 390 | 2 |
| Fairchild | MM74HC123 | - | 2 | 6 | 1.00 | 390 | 6 |
| TI | CD74HC123 | $\cdot$ | 2 | 6 | 0.45 | 230 | 8 |
| ST | M74HC123 | - | 2 | 6 | 0.44 | 230 | 9 |
| NXP | 74HC123 | $\cdot$ | 2 | 6 | 0.45 | 105 | 8 |
| TI | SN74AHC123 | - | 2 | 5.5 | 1.00 | $110^{f}$ | 4 |
| NXP | 74AHC123 | - | 2 | 5.5 | 1.00 | 45 | - |
| Fairchild | 74VHC123 | - | 2 | 5.5 | 1.00 | 75 | 4 |
| Toshiba | TC74VHC123 | - | 2 | 5.5 | 1.00 | 75 | 5 |
| TI | SN74LV123 | - | 2 | 5.5 | 1.00 | 110 | 4 |
| NXP | 74LV123 | - | 1.2 | 5.5 | 0.43 | 70 | 7 |
| TI | SN74LVC1G123 ${ }^{9}$ | . | 1.65 | 5.5 | 0.95 | 95 | 3 |
| Toshiba | TC7WH123 ${ }^{9}$ | - | 2 | 5.5 | 1.00 | 75 | - |

Notes: (a) suffixes are omitted; all except † have Schmitttrigger inputs, and all trigger on (!A) \&B. (b) TTL thresholds, for example $74 \mathrm{HCT123}$. (c) pulse width $=K R C+t_{\mathrm{min}}$, spec'd at 5 V for 10 k and $0.1 \mu \mathrm{~F}$. (d) for $R C=0$, derived from the 2 k and 28 pF value by subtracting $56 \mathrm{~ns} \cdot K$. (e) From the graph of $K$ vs supply voltage. (f) 75 ns for 'AHCT123. (g) single monostable in 8-pin package.
ing capacitor (say $\sim 1000 \mathrm{pF}$ or less) overshoots the lower threshold (a similar effect bedevils the classic 555 sawtooth oscillator circuit, where the DIS pin pulls the timing capacitor rapidly toward ground). The result is an enlarged (and not terribly stable) pulse width. At least one manufacturer (TI, in their SN74HC4538) has addressed this problem by putting the lower threshold close to ground (at about $4.3 \%$ of $V_{+}$, or +0.2 V when running from a +5 V supply), so discharge overshoot has almost no effect - the capacitor charges back up from about the same voltage, overshoot or not.

Long pulses For the generation of long pulses, you can use large value timing resistors (up to 10M should be safe, even if the datasheet shows values only to 200k, say, because these are CMOS designs with low leakage currents). Even so, the capacitor value may be a few microfarads or more; in that case electrolytic capacitors are generally necessary. ${ }^{62}$ You have to worry about leakage current (which is insignificant with the smaller capacitor types), and you should include a diode across $R$ (Figure 7.61A); the latter is

[^354]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0497.jpg?height=791&width=779&top_left_y=209&top_left_x=136)

Figure 7.60. Datasheets plots of effective timing coefficient $K$ versus supply voltage for the monostables in Table 7.4. Note the changes of scale, particularly the expanded set around $K=1.0$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0497.jpg?height=442&width=797&top_left_y=1177&top_left_x=127)

Figure 7.61. Monostable circuit variations. A. A diode prevents reverse conduction on power-down. B. A filtered "private $V_{+}$supply" reduces supply-noise instabilities.
needed to prevent reverse conduction at the $R C_{X}$ terminal by the charged timing capacitor if $V_{+}$is turned off abruptly.

Duty cycle With some one-shots the pulse width is shortened at high duty cycle. For example, NXP's 74LV123, when powered from +3.3 V and using $R=10 \mathrm{k}$ and $C=100 \mathrm{nF}$, has constant pulse width up to $95 \%$ duty cycle, decreasing about $1.5 \%$ near $100 \%$ duty cycle. The nonretriggerable ' 221 monostable is considerably worse in this respect, with erratic behavior at high duty cycles. By contrast, in our tests the Fairchild MM74HC123A maintained perfect timing to $99.98 \%$ duty cycle, along with a jitter-free
output pulse. (It, like the admirable TI SN74HC4538, uses a rather low $V_{\mathrm{L}}$ threshold, about $10 \%$ of $V_{+}$.)

Another thing to be aware of is the effect of capacitor size on retriggering recovery time. For example, TI's 74LVC1G123 datasheet has a plot of minimum retrigger time for various capacitances; it shows a minimum wait of $1 \mu \mathrm{~s}$ for a 10 nF timing cap, which is $1 \%$ of the $100 \mu \mathrm{~s}$ pulse width with a 10 k resistor.

Triggering One-shots can produce substandard or jittery output pulses when triggered by too short an input pulse. There is a minimum trigger pulse width specified, e.g., 140 ns for the 4538 with +5 V supply, 60 ns with +15 V supply (4000-series "high-voltage" CMOS is faster and has more output drive capability when operated at higher supply voltages), 25 ns for the 'HCT423 at its specified +5 V supply, and 3 ns for the speedy 'LVC123 with +3.3 V supply.
Noise immunity Because of the linear circuits in a monostable, the noise immunity is generally poorer than in other digital circuits. One-shots are particularly susceptible to capacitive coupling near the external $R$ and $C$ used to set the pulse width. In addition, some one-shots are prone to false triggering from glitches on the $V_{+}$line or ground. One way to avoid these problems is to create a "private" $R C$-filtered $V_{+}$supply, as shown in Figure 7.61B; alternatively, you could supply the monostable from a separately regulated $V_{+}$, via a small linear voltage regulator, if you have available a higher-voltage supply rail.
Specsmanship Be aware that monostable performance (predictability of pulse width, temperature and voltage coefficients, etc.) may degrade considerably at the extremes of its pulse-width range. Specifications are usually given in the range of pulse widths where performance is good, which can be misleading. In addition, there can be a lot of difference from manufacturer to manufacturer in the performance of monostables of the same part number. Read the datasheets carefully!

Output isolation Finally, as with any digital device containing flip-flops, outputs should be buffered (by a gate, inverter, or perhaps an interface component like a line driver) before going through cables or to devices external to the instrument. If a device like a one-shot tries to drive a cable directly, the load capacitance and cable reflections may cause erratic operation to occur.

General considerations for using monostables
Be careful, when using one-shots, to generate a train of pulses, that an extra pulse doesn't get generated at the
"ends." That is, make sure that the signals that enable the one-shot inputs don't themselves trigger a pulse. This is easy to do by looking carefully at the one-shot truth table, if you take the time.

Don't overuse one-shots. It is tempting to put them everywhere, with pulses running all over the place. Circuits with lots of one-shots are the mark of the neophyte designer. Besides the sort of problems just mentioned, you have the added complication that a circuit full of monostables doesn't allow much adjustment of the clock rate, since all the time delays are "tuned" to make things happen in the right order. In many cases there is a way to accomplish the same job without a one-shot, and that is to be preferred. Figure 7.62 shows an example.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0498.jpg?height=672&width=810&top_left_y=830&top_left_x=220)

Figure 7.62. A digital delay can replace one-shot delays. Note that (unlike in circuit $A$, where the trigger initiates the output), in B the trigger input "arms" the circuit, whose digital output is synchronized to the next rising edge of CLK following the input trigger.

The idea is to generate a pulse and then a second delayed pulse following the rising edge of an input signal. These might be used to set up and initiate operations that require that some previous operation be completed, as signaled by the input rising edge. In the first circuit, the input triggers the first one-shot, which then triggers the second one-shot at the end of its pulse.

The second circuit does the analogous thing with type$D$ flip-flops, generating output pulses with width equal to one clock cycle. This is a synchronous circuit, as opposed to the asynchronous circuit using cascaded monostables. The use of synchronous methods is generally preferable from several standpoints, including noise immunity. If you wanted to generate shorter pulses, you could use the same
kind of circuit, with the system clock divided down (via several toggling flip-flops) from a master clock of higher frequency. The master clock would then be used to clock the $D$ flip-flops in this circuit. The use of several subdivided system clocks is common in synchronous circuits. Note that there is up to one clock period of jitter in the digital delay circuit, unlike the "instantaneous" response of cascaded monostables.
§7.2.4 explores further this idea of "digital timers."

### 7.2.3 A monostable application: limiting pulse width and duty cycle

Here's a nice monostable application, simple and effective, which has saved the day (and much grief) on numerous occasions. It's useful whenever you're driving a device with high-current short pulses (for example solenoids or LEDs), and particularly in situations where those pulses are generated from software (in a microcontroller or FPGA). The danger, of course, is that a software bug or microcontroller crash can cause a destructively long pulse.

To set the stage with a specific example, researchers in one of our labs were photographing zebrafish with a microscope fitted with an illuminator ring of sixty LEDs. The camera shutter, operating at 120 frames/sec, generated $80 \mu$ s LED-driving pulses every 8 ms . Because the duty cycle $\left(t_{\mathrm{ON}} / T\right)$ was only $1 \%$, it was OK to drive the LEDs at very high current ( 1 A , or ten times their continuous current rating of 100 mA ), and to do so without heat sinking. Fine... but a screwup in camera programming generated a long pulse that destroyed the array of LEDs; the cost was $\$ 40 \ldots$. and a day's labor.

The solution is a circuit like Figure 7.63. Upon triggering, the first monostable generates a pulse $T_{1}$ that limits the maximum output pulse width $T_{\mathrm{OuT}}$, by disabling the AND gate after time $T_{1}$. The second monostable inhibits retriggering until it has timed out, preventing further LEDdriving pulses until a total time $T_{2}$ after the last trigger. Here we chose timing components $R C$ to set $T_{1}=100 \mu \mathrm{~s}$ and $T_{2}=5 \mathrm{~ms}$. Fitted with this protection circuit, the LED illuminator has now captured many millions of portraits of zebrafish, with both fish and LED living happily.

### 7.2.4 Timing with digital counters

For timing jobs where you want a long delay (minutes to hours, or even days), or where you need real accuracy, stability, or predictability, these analog timing methods are inadequate. What you do instead is use digital counters in combination with a fixed oscillator (perhaps of high
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0499.jpg?height=1035&width=813&top_left_y=207&top_left_x=119)

Figure 7.63. A simple protection circuit for high-current pulsed devices: limiting pulse width and duty cycle with a pair of monostables.
stability). Digital techniques are treated in detail in Chapters 10-13; but they form such an essential part of the business of timers that we must include them here.

#### A. An example: an "hour of power"

Suppose, to save battery power, you want a circuit to turn off a portable instrument after an hour. The circuit of Figure 7.64 will do the job. It exploits the CMOS 4060 binary counter chip (14 cascaded stages), which includes a pair of internal inverters intended for making an $R C$ oscillator (the way we did in §7.1.2B). It belongs to the "4000B highvoltage CMOS" logic family, allowing operation from supply voltages of 3-18 V. That's handy here, because we can run it directly from the 9 V battery (whose terminal voltage begins life at about 9.4 V , and ends somewhere around 6 V ).

At turn-on (or when the Start button is pressed) the counter is reset to a count of zero (because the " $R$ " reset input is brought momentarily HIGH), so all of the $Q$ 's (the counter's binary outputs) are LOW. That turns on the $p$ channel MOSFET, supplying power to the load. When the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0499.jpg?height=649&width=802&top_left_y=206&top_left_x=977)

Figure 7.64. "An hour of power." The $1 \mathrm{M} \Omega$ (nominal) frequencysetting resistor could consist of a 750k fixed resistor in series with a 500k trimmer.
counter reaches a count of $2^{13}$, the $Q_{14}$ bit goes HIGH, both turning off power to the load and also stopping the oscillator. That's the end of the hour of power. The 4060 has negligible quiescent current ( $\ll 1 \mu \mathrm{~A}$ ), so the battery sees only MOSFET leakage current, also negligible.

A few comments. (a) Clamping the oscillator to end the cycle, as we've done here, is a trick; more typically you would use a flip-flop whose two states correspond to power-on and power-off. The popular 14541 "programmable-timer" chip offers such features internally, and is a better choice. (b) The fourth counter bit ( $Q_{4}$ ) is used to signal activity, so you know the timer is running. We used a high-efficiency LED, running at $50 \mu \mathrm{~A}$, to minimize current drain. (c) Tasks like this are easily accomplished with programmable microcontrollers (see Figure 7.69, and Chapter 15), which are flexibly reprogrammed, and which can do other tasks along the way. Our fondness for circuits like Figure 7.64 reveals, well, a certain nostalgia.

You can make an hour-of-power circuit with one of the elegant "TimerBlox" chips from LTC (introduced in §7.1.4B). The obvious choice would be the LTC6993 oneshot timer (see the table on page 433), but that part tops out at a pulse length of 34 seconds. Instead, you can press into service the LTC6991 low-frequency oscillator (maximum oscillator period of 9.5 hours!), rigged up as shown in Figure 7.65 so that it's held in the reset state after the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0500.jpg?height=529&width=1292&top_left_y=220&top_left_x=400)

Figure 7.65. An hour of power, TimerBlox-style.
end of its first half cycle. ${ }^{63}$ This circuit runs on the low voltages for which these chips are designed (single supply, +2.5 V to +5.5 V ), which mandated a low-threshold pMOS switch for $Q_{1}$. A nice feature of this series of timers is their accuracy ( $\pm 1.5 \%$ worst case): your hour-of-power will terminate within one minute of its appointed time.

#### B. Another example: "one second per hour"

This circuit challenge appeared on the sci.electronics.design ("sed") newsgroup: generate a 1 -second pulse once per hour, given a 1 Hz input clock; and do it with a minimum number of ICs. Figure 7.66 shows one way to do this, ${ }^{64}$ once again using an integrated binary counter. This time we've used the 404012 -stage counter, which lacks an oscillator but which provides outputs from every stage. The AND gates ( $(10.1 .4$ ) provide a HIGH output when the indicated $Q$ 's are all HIGH, i.e., the count $n=2048+1024+512+8+4+2+1=3599$; that sets the output flip-flop ( $\S 10.4 .1$ ), which both generates one clock cycle of HIGH output and also resets the counter. Because the count is reset to zero, the full cycle is 3600 seconds, which, by great good fortune, happens to be the number of seconds in an hour.

[^355]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0500.jpg?height=545&width=777&top_left_y=855&top_left_x=1081)

Figure 7.66. "One second per hour" timer, using digital logic.

#### C. A third example: remote camera control

We wanted to use a Panasonic DMC-LC1 digital camera to capture the faint light of star images as they transited an array of photomultipliers. The camera has a USB port for reading and deleting images from its memory card, but it does not provide a way to trip the shutter. However, it does have a separate connector for an electrical "shutter release," which can be activated with a switch or relay. So the idea is to use a relay to take a picture, then retrieve it via the USB connection.

Sounds easy - but there's a catch: you can't take a picture when the USB port is active. It turns out you have to deactivate the USB connection for at least 3 seconds before you take a picture, then you have to wait a second or two before reactivating it to get the image. Figure 7.67 shows a solution to this timing problem, relying again on digital counting methods. The circuit is timed by a CMOS 555 , running at 1 Hz . It clocks a ' 4017 decimal counter, which has the interesting feature of providing
individual outputs for each of its 10 states (0-9); when powered, it starts up in state 0 (because of the $R C$ reset), and then progresses sequentially upward. States $0-4$ all cause the "USB power" relay to actuate, because of the $\mathrm{M}^{2} \mathrm{~L}$ (Mickey Mouse Logic) diode array; ${ }^{65}$ this removes USB power, which is connected through the "normally closed" relay contacts. State 3 comes along during the time the USB is deactivated, actuating the relay and shutter ("normally open" contacts, here). Then the shutter deactivates, and USB power is restored after another second.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0501.jpg?height=736&width=810&top_left_y=655&top_left_x=118)

Figure 7.67. Camera control timer. The relays operate from 5 V (drawing 40 mA ), and can switch up to 8 A ; a suitable part is Omron G5C-2114P-US-DC5.

#### D. Other digital timing chips

There is a class of timer-oriented counter chips that are good for these kinds of tasks. Here are ones that we know and like (and see also the counter ICs in Table 10.5 on page 742 ).

#### ICM7240/42/50/60

This series of "Fixed and Programmable Timer/Counters" from Maxim includes an internal 555-like oscillator circuit, to which you attach an external frequency-setting $R$ (to $V_{+}$) and $C$ (to ground). The 8-pin 7242 has a fixed modulo-256 counter, with a pair of outputs at $f_{\mathrm{OSC}} / 2$ and $f_{\mathrm{OSC}} / 256$. The 16-pin 7240/50/60 parts allow you to set the divider modulus via programming pins: binary (1-255), decimal (199), and "real-time" (1-59), respectively. These low-power

[^356]parts $(<1 \mathrm{~mA})$ run on supply voltages from 2 V to 16 V , with maximum oscillator frequency of $1-15 \mathrm{MHz}$ (typical) over that range.

MC14536
This "Programmable Timer" from ON Semiconductor (formerly Motorola) includes internal inverters for making an $R C$ oscillator (\$7.1.2B), followed by a 24 -stage binary counter chain. You can select (via 4 input pins) which of the last 16 stages you want as output; and an on-chip monostable lets you convert that output to a pulse (in the range of $\sim 1-100 \mu \mathrm{~s}$ wide). You can bypass the first 8 stages, for shorter timing delays, which can range from microseconds to days. This low-power part $(\sim 1.5 \mu \mathrm{~A} / \mathrm{kHz}$, when driven from an external oscillator) runs on supply voltages from 3 V to 18 V , with maximum clocking frequency of $1-$ 5 MHz (typical) over the range of $5-15 \mathrm{~V}$.

MC14541
This "Programmable Timer" from ON Semiconductor is similar to the MC14536, but includes only 16 stages and limits the choices of divide ratios $\left(2^{8}, 2^{10}, 2^{13}\right.$, and $\left.2^{16}\right)$. In exchange, it gives you an internal power-up reset, a choice of output polarity, a choice of single-cycle or repeatingcycle modes, and somewhat lower operating current. It includes an output flip-flop, but unfortunately does not provide inputs to set or clear it.

#### LTC699x "TimerBlox"

This series includes oscillator and timer functions, with single-resistor frequency (or delay) programming, and voltage-divider ( 2 resistors) range and mode selection; see the table on page 433 . They run on a single +2.5 V to +5.5 V supply, with excellent timing accuracy $(<2 \%$, worst-case, for the oscillators; $3.4 \%$ for the timers).

In addition to the oscillators and monostables in this family, there's the LTC6994-x "Delay Block \& Debouncer." The -1 variant delays one edge only, while the -2 variant delays both edges (thus pulse-width preserving). The delay range $\tau$ is $1 \mu$ s to 34 seconds, selectable (along with polarity mode) via a voltage divider; a second resistor tunes the delay within the selected range, over a $16: 1$ span. Input pulses shorter than $\tau$ produce no output, which is handy for debouncing, or for "pulse qualification."

#### TPL5000/5100

These impressive nanopower timers from Texas Instruments run from 1.8 V to 5.5 V , draw a meager 40 nA (yes, nanoamps!), and are 3-bit programmable (via three input pins) from 1 to 16 seconds or 16 to 1024 seconds
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0502.jpg?height=435&width=616&top_left_y=221&top_left_x=317)

Figure 7.68. Microcontroller implementation of camera control timer.
(TPL5000 and 5100, respectively). The TPL5100 can drive a $p$-channel power MOSFET, to switch output loads.

#### Microcontrollers

A microcontroller is an inexpensive and flexible computer-on-a-chip, intended to be "embedded" into pretty much any kind of electronic device. We'll have much more to say about these wonderful devices in Chapter 15. But we cannot resist showing, in Figures 7.68 and 7.69, analogous microcontroller-based solutions to the camera shutter and "hour-of-power" examples whose implementation in discrete logic we showed in Figures 7.67 and 7.64, respectively.

In Figure 7.68 an Atmel "ATtiny24" microcontroller, with on-chip oscillator and timer functions (and lots more!) runs a program (which you have to write, of course) to do the shutter and USB power timing; its output pins can sink or source 20 mA , so we've used parallel pairs to handle the 40 mA relay current. This particular IC costs about a dollar, in small quantities. It, like all microcontrollers, is available in many variants, with additional memory, I/O, A/D converters, and so on. They are all remarkable bargains.

The microcontroller version of the "hour of power" (Figure 7.69) is a bit more complicated, because microcontrollers run only on supply voltages lower than the +9 V we
chose for the earlier example in Figure 7.64; typically they require a dc supply voltage in the range +1.8 V to +5 V . The approach we've taken here is to use a low-dropout linear regulator that has a shutdown mode (in which its standby current $I_{\mathrm{OFF}} \sim 1 \mu \mathrm{~A}$ ), and to use a microcontroller output pin to enable the regulator during operation. The circuit is rigged up for zero battery drain (other than leakage and $I_{\mathrm{OFF}}$ ) except when timing.

A great virtue of programmable microcontrollers is their ability to give a fine performance in any of a variety of tasks. In this circuit you could program the controller to accept other inputs and produce other outputs (for example, sense temperature and humidity, and display values on an LCD display), and omit the output power switching entirely. ${ }^{66}$ Or more simply, as a variation on the humble hour-of-power task, you could have several "mode" inputs that would set different timings, or patterns of power, or whatever.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0502.jpg?height=530&width=799&top_left_y=985&top_left_x=1070)

Figure 7.69. Microcontroller implementation of "an hour of power."

[^357]
### Review of Chapter 7

An A-to-H summary of what we have learned in Chapter 7. This summary reviews basic principles and facts in Chapter 7 , but it does not cover application circuit diagrams and practical engineering advice presented there.

#### ПA. Oscillator and Timer Overview.

Oscillators are circuits that create a periodic output waveform. The output may be as simple as a logic-level square wave (or train of pulses) for use as a "clock" in a digital system. Or it may be a highly accurate, stable, and perhaps programmable source of low-distortion sinewaves (or of other waveforms, for example a periodic ramp for use in an ADC or a PWM switchmode power converter). The signal from an oscillator is characterized broadly by its waveform, frequency, amplitude, and tunability, and, at a deeper level of scrutiny, by its phase noise, jitter, sideband suppression, distortion, temperature coefficient of frequency, and long-term stability.

Timers are circuits that generate a delayed pulse, or a pulse of a given width, following a triggering event. A timer is characterized broadly by output pulse width, delay time, and retriggerability, and, at a deeper level of scrutiny, by timing jitter, long-term stability of timing interval, and tempco.

#### ||B. Relaxation Oscillators.

These simple oscillators exploit an $R C$ decay (or a current charging a capacitor) to generate a sustained oscillation. The $R C$ can be wrapped around an op-amp or comparator, forming the classic pedagogical oscillator (§7.1.2A). More common is the use of logic inverters (§7.1.2B), or a timer IC like the ubiquitous 555 (§7.1.3 and Table 7.1) or its contemporary forebears (e.g., the LTC6900-series, §7.1.4). Such timer or oscillator ICs deliver reasonable accuracy and predictability ( $\sim 1 \%$ ), over frequencies ranging from a few hertz to a megahertz or more. By adding a digital counter you can lengthen the period to minutes, hours, or just about forever; examples are the 74 HC 4060 ( $R C$ oscillator plus 14-stage binary counter; §7.1.4C), and the LTC6991 (resistor-programmed oscillator, periods from 1 ms to 9 hours; §7.1.4B). At the opposite end of the timescale, logic ICs extend the $R C$ oscillator frequency range to tens or even hundreds of megahertz (§7.1.4D).

#### IC. Voltage-controlled Oscillators.

Sometimes you want frequency tunability, via an input control voltage. That'a a $V C O$. These can be highly linear and stable (e.g., the AD650 V-to-F converter, $\sim 0.01 \%$
nonlinearity), or just seat-of-the-pants simple (e.g., the 74LS624-629 series, accuracy and linearity not specified, but likely good to perhaps $\pm 20 \%$ ). Oscillators built with resonators ( $L C$, crystal, SAW, silicon) rather than $R C$ 's can be tuned electrically as well; for some the tuning range is narrow (e.g., the frequency tuning range of a voltage-controlled crystal oscillator, or VCXO, is of order $\pm 100 \mathrm{ppm}, \S 7.1 .6 \mathrm{C}$ ), whereas an $L C$ oscillator can be varactor tuned over a $2: 1$ frequency range. Complete VCO modules are available for communication-band frequency ranges, for example the many modules from Crystek that together span the range from about 50 MHz to 5 GHz ; the individual modules each tune over a modest range, from as little as $\pm 1 \%$ to as much as $\pm 25 \%$.

#### 11D. Sinewave Oscillators.

The inherent waveforms of relaxation oscillators are segments of exponential charging and discharging (if built with an $R C$ ), or linear ramps (if the resistor is replaced by a current source); in either case these waveforms drive a comparator circuit to reverse the cycle. That is, the "natural" waveforms are square waves, triangle or sawtooth waves, or what might be called "shark's fin" waves. What you don't get are sine waves.

But sinewaves are essential for many tasks; and you can generate them, with some cleverness, with the frequency set by $R$ 's and C's only, analogous to the simple relaxation oscillator. Most famous is the Wien-bridge oscillator (§7.1.5B), an arrangement of two $R$ 's and two $C$ 's whose phase shifts cancel at a frequency $f=1 / 2 \pi R C$, where the attenuation is exactly a factor of $1 / 3$. The oscillator circuit wraps this network around a noninverting op-amp with gain equal to +3 . The final trick is to sense the output amplitude, and maintain it at a preset (and nonsaturated) level by controlling the gain. A pair of fellows named Hewlett and Packard founded a business with this as their first product; the rest is history.

You can make sinewaves also by lowpass filtering a nonsinusoidal waveform. This is the basis of the RC phaseshift oscillator (§7.1.5C), and of the digital tracking-filter technique (§7.1.5A).

An oscillator that generates a pair of sinusoidal signals with a phase difference of $90^{\circ}$ (i.e., sine and cosine) is called a quadrature oscillator (§7.1.9); the signals are "in quadrature." This can be done with analog techniques (integrator pair, switched-capacitor resonator, phase-sequence filter, RF quadrature hybrid), or with digital synthesis (see IGG below).

#### I[E. Resonator-based Oscillators.

Relaxation oscillators, and $R C$-based oscillators in general, can deliver stabilities no better than $1 \%$ or so. That is because their accuracy depends on an exponential decay (in the time domain), or a gradual phase shift (in the frequency domain). For better stability you need to exploit a resonant system, whose natural physical frequency can be extremely well-defined. It can have a "quality factor" $Q$ (which is its frequency selectivity $\Delta f / f$ ) of a million or more.

The simple $L C$ resonant circuit is widely used in the frequency range from kilohertz to hundreds of megahertz (\$7.1.5D), with stabilities of order $10-100 \mathrm{ppm}$, and with tunability via a mechanical-variable capacitor or inductor, or an electrically-tunable capacitor (a varactor). For higher frequencies the $L C$ tuned circuit can be replaced by a coaxial or cavity resonator.

Better stability (but less tunability) is provided by electro-mechanical resonators: quartz-crystal (§7.1.6), ceramic ( $\$ 7.1 .6 \mathrm{G}$ ), and surface-acoustic-wave (SAW; $\S 7.1 .6 \mathrm{H}$ ). These are inexpensive and stable ( $\sim 10 \mathrm{ppm}$ ), and quartz-crystals and crystal-oscillator modules are available in a wide selection of standard frequencies in the range of 10 kHz to 100 MHz (and crystal manufacturers are happy to provide any frequency you want as a special-order product, at quite reasonable prices). Crystal oscillators can be "pulled" up to $\pm 100 \mathrm{ppm}$ with a varactor; these are sometimes called VCXOs (voltage-controlled crystal oscillators). Ceramic-resonator oscillators can be pulled over a wider range ( $\pm 1000 \mathrm{ppm}$ ), owing to their lower $Q$; the downside is poorer frequency stability. They are very inexpensive, but they come in only a limited set of standard frequencies.

#### IF. High-stability Oscillators.

Crystal oscillators held at constant temperature are remarkably stable, as good as 1 part in $10^{9}$ for a welldesigned OCXO (oven-controlled crystal oscillator); the residual drift is due mostly to mechanical and diffusional "aging" effects. For still better stability you need an atomic standard (\$7.1.7B), the most accessible being a rubidium-vapor-stabilized crystal oscillator. These deliver stabilities of order 1 part in $10^{10}$, and their prices (around $\$ 1 \mathrm{k}$, but you can get some real deals on eBay) allow inclusion in precision test and communication equipment. There are more precise (and exotic) frequency standards - cesium beam, hydrogen maser, atomic fountain, chilled ion - but, as they say, "if you have to ask the price, you can't afford them."

Happily, you can take advantage of your tax dollars at work, namely the precise timing provided by the GPS satellite constellation. For about $\$ 1 k$ (and a place to put a little
doorknob-size antenna) you can have your own 10 MHz reference, with long-term stability of order $10^{-12}$.

#### ๆG. Frequency Synthesis.

VCOs are tunable, but not particularly stable, nor capable of spanning many decades of frequency; by contrast, a crystal oscillator is stable, but tunable at most over parts-per-million. But you can have it both ways: from a stable reference oscillator at some standard fixed frequency (typically a highly stable 10.0 MHz crystal oscillator) you can generate an output frequency of your choosing, with one of several methods of frequency synthesis (§7.1.8). Simplest to understand is direct digital synthesis (DDS), in which successive sinusoidal amplitudes are read from a table at the appropriate rate and converted to an analog output signal voltage. Complete DDS chips that include all the hardware (counters, sine lookup table, ADC) are widely available, and inexpensive. You provide the reference frequency, and you talk to these things with a microcontroller (Chapter 15) to set the output frequency, phase offset, and so on. DDS chips let you synthesize output frequencies ranging from fractions of a hertz up to a gigahertz, with frequency agility (the ability to change frequency rapidly and precisely).

Phase-locked-loop (PLL) synthesis is the other common technique. In its simplest form, a VCO is controlled by a phase comparator whose inputs are the $r$ th subdivision of the reference frequency and the $n$th subdivision of the VCO output frequency. Then $f_{\text {out }}=(n / r) f_{\text {ref }}$. There are many subtleties here, involving loop stability, sidebands and jitter, resolution, lockup and slewing times, and so on. See $\S 13.13$ for an extensive discussion.

#### १H. Timers and One-shots.

You can make simple edge-triggered pulsers with as little as an $R C$, or (better) with an $R C$ assisted by a BJT or MOSFET (\$7.2.1A). But you get cleaner pulses with faster edge times if you use logic gates (\$7.2.1C). For better predictability it's best to use an IC designed for timer use, either a monostable multivibrator (a "one-shot"), a 555type timer, or one of a class of specialized timers like the LTC6991/3, ICM7240/50/60, or MC14536/41. Monostables, being mixed-signal components (logic parts with a linear function), have their "issues," notably their sensitivity to supply-rail noise; they also have a somewhat limited timing range (typically tens of nanoseconds to seconds). They come in both non-retriggerable and retriggerable types; the latter extend their pulse duration if another trigger arrives during the pulse. Pulse widths are set by an
external $R C$, with a multiplying constant $K$ of order unity $\left(\tau=K R C+t_{\min }\right)$; see Table 7.4 and Figure 7.60.

You can do much more with timer chips that incorporate a digital counter (e.g., the LTC6991 extends the timing range to ten hours), or you can configure an external bi-
nary counter. When thinking about extended timing intervals, or in fact pretty much any timing tasks, don't forget the versatile microcontroller (the subject of Chapter 15); there you'll find a timing example, in the form of a "suntan monitor" (§15.2).

# 8. LOW-NOISE TECHNIQUES

In many applications you're dealing with small signals, for which it is essential to minimize the degrading effects of amplifier "noise." Low-noise design is thus an important part of the art of electronics. The extensive detail (decorated with more than our usually paltry quota of equations!) in this chapter reflects the richness of the low-noise design. So does its length - it's the longest chapter in the book. Recognizing that many readers will have a less-thanpassionate interest in the various subjects treated here, we offer the following guide.
A quick guide to this chapter The basics of noise are explained in $\S 8.1$ ("Noise"), which should be read first. Readers interested primarily in low-noise design with opamps can then skip ahead to the discussion, tables, and graphs in $\S 8.9$ ("Noise in operational amplifier circuits"). Those interested in low-noise design with discrete transistors (or interested in gaining a fuller understanding of what's going on "under the hood" of op-amps) should read $\S 8.5$ ("Low-noise design with bipolar transistors") and $\S 8.6$ ("Low-noise design with JFETs"). Readers working with photodiode circuits and the like will want to read $\S 8.11$ ("Noise in transimpedance amplifiers"). ${ }^{1}$ For a discussion of noise measurement, go to $\$ 8.12$ ("Noise measurements and noise sources") and $\$ 8.13$ ("Bandwidth Limiting and RMS Voltage Measurement").
An even quicker guide to noise This chapter is lengthy, and it's filled with mathematical details and information about hundreds of transistors and op-amps. But noise doesn't have to be complicated. In a spirit of encapsulating the essence of noise, we offer a one-minute breathless end-of-class "takeaway":

The random noise you care about is characterized by its density (rms noise amplitude in a 1 Hz band of frequency); voltage noise density is called $e_{\mathrm{n}}$, and has units like $\mathrm{nV} / \sqrt{\mathrm{Hz}}$. Likewise, the symbol for noise current is $i_{\mathrm{n}}$; a noise current at an amplifier's input flows through the signal's source resistance, creating its own noise voltage $e_{\mathrm{n}}=i_{\mathrm{n}} R_{\mathrm{s}}$. If a

[^358]noise source is uniform over frequency, it's called "white noise," and the rms noise voltage contained within a bandwidth $B$ is just $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{B}$. Knowing that, you can go to Tables 8.3a-8.3c on page 522, which lists $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ for a wide selection of opamps , to figure out how much noise is added in an amplifier stage. Multiply by the amplifier's gain and, voilà, you've got the output noise.
Amplifiers aren't the only source of noise. A resistor generates "Johnson noise", eq'n 8.4, and the discrete charges in a flow of current generate "shot noise", eq'n 8.6. Both of these are white noise. ${ }^{2}$ Finally (with ten seconds remaining) - to figure the total noise in a circuit with multiple independent noise sources, you take the sum of the squares of each noise density, multiply by the bandwidth, then take the square root. Time's up. End of class.

## 8.1 "Noise"

In almost every area of measurement the ultimate limit of detectability of weak signals is set by noise - unwanted signals that obscure the desired signal. Even if the quantity being measured is not weak, the presence of noise degrades the accuracy of the measurement. Some forms of noise are unavoidable (e.g., real fluctuations in the quantity being measured), and they can be overcome only with the techniques of signal averaging and bandwidth narrowing. ${ }^{3}$ Other forms of noise (e.g., radiofrequency interference and "ground loops") can be reduced or eliminated by a variety of tricks, including filtering and careful attention to wiring configuration and parts location. Finally, there is noise that arises in the amplification process itself, and it can be reduced through the techniques of low-noise amplifier design. Although the techniques of signal averaging

[^359]can often be used to rescue a signal buried in noise, it always pays to begin with a system that is free of preventable interference and that possesses the lowest amplifier noise practicable.

We begin by talking about the origins and characteristics of the different kinds of noise that afflict electronic circuits. Then we launch into a discussion of bipolartransistor (BJT) and field-effect transistor (FET) noise, including methods for low-noise design with a given signal source, and we present some design examples. After a short discussion of noise in differential and feedback amplifiers, we continue with low-noise design with opamps, including transimpedance (current-to-voltage) amplifiers. Sections on noise measurements, bandwidth limiting, and lock-in detection follow, then a short discussion of power-supply noise. We conclude with a section on proper grounding and shielding and the elimination of interference and pickup.

Because the term noise can be applied to anything that obscures a desired signal, ${ }^{4}$ noise can take the form of another signal ("interference"); most often, however, we use the term to describe "random" noise of a physical (often thermal) origin. Noise can be characterized by its frequency spectrum, its amplitude distribution, and the physical mechanism responsible for its generation. Let's next look at the chief offenders:

Johnson noise: Random-noise voltage created by thermal fluctuations in a resistor.
Shot noise: Random statistical fluctuations in a flowing current caused by the discrete nature of electrical charge.
Flicker noise: Additional random noise, rising typically as $1 / f$ in power at low frequencies, with a multitude of causes.
Burst noise: low-frequency noise typically seen as random jumps between a pair of levels, caused by material device defects.

### 8.1.1 Johnson (Nyquist) noise

Any old resistor just sitting on the table generates a noise voltage across its terminals known as Johnson noise (or Nyquist noise). ${ }^{5}$ It has a flat frequency spectrum, mean-

[^360]ing that there is the same noise power in each hertz of frequency (up to some limit, of course). Noise with a flat spectrum is also called "white noise." The actual open-circuit noise voltage generated by a resistance $R$ at temperature $T$ is given by
\$\$

$$
\begin{equation*}
v_{\text {noise }}(\mathrm{rms})=v_{\mathrm{n}}=(4 k T R B)^{\frac{1}{2}} \quad \mathrm{~V}(\mathrm{rms}) \tag{8.1}
\end{equation*}
$$

$$
where $k$ is Boltzmann's constant, $T$ is the absolute temperature in Kelvins $\left(\mathrm{K}={ }^{\circ} \mathrm{C}+273.16\right)$, and $B$ is the bandwidth in hertz. Thus $v_{\text {noise }}(\mathrm{rms})$ is what you would measure at the output if you drove a perfect noiseless bandpass filter (of bandwidth $B$ ) with the voltage generated by a resistor at temperature $T$. At room temperature $\left(68^{\circ} \mathrm{F}=20^{\circ} \mathrm{C}=\right.$ 293K),
$$

$$
\begin{align*}
4 k T & =1.62 \times 10^{-20} & & \mathrm{~V}^{2} / \mathrm{Hz}-\Omega \\
(4 k T R)^{\frac{1}{2}} & =1.27 \times 10^{-10} R^{\frac{1}{2}} & & \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}}  \tag{8.2}\\
& =1.27 \times 10^{-4} R^{\frac{1}{2}} & & \mu \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}}
\end{align*}
$$

\$\$

For example, a 10 k resistor at room temperature has an open-circuit rms voltage of $1.3 \mu \mathrm{~V}$, measured with a bandwidth of 10 kHz (e.g., by placing it across the input of a good audio amplifier and measuring the output with a voltmeter). The source resistance of this noise voltage is just $R$. If you connect the terminals of the resistor together, you get a (short-circuit) current of

$$
\begin{equation*}
i_{\text {noise }}(\mathrm{rms})=v_{\text {noise }}(\mathrm{rms}) / R=v_{\mathrm{nR}} / R=(4 k T B / R)^{\frac{1}{2}} \tag{8.3}
\end{equation*}
$$

As we'll see in §8.2.1, it's convenient to express noise voltage (or current) as a density $e_{\mathrm{n}}$ (rms voltage per square root bandwidth). Johnson noise, with its flat (white) spectrum, has constant noise voltage-density

$$
\begin{equation*}
e_{\mathrm{n}}=\sqrt{4 k T R} \quad \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.4}
\end{equation*}
$$

from which the rms noise voltage in some limited bandwidth $B$ is then simply $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{B}$. Likewise, the shortcircuit noise-current density is

$$
\begin{equation*}
i_{\mathrm{n}}=\sqrt{4 k T / R} \quad \mathrm{~A} / \mathrm{Hz}^{\frac{1}{2}} . \tag{8.5}
\end{equation*}
$$

Figure 8.1 plots the simple relationship between Johnsonnoise voltage density and source resistance; also shown is the short-circuit noise current density. An easy number to remember, when choosing resistor values for lownoise amplifier designs, is that a $1 \mathrm{k} \Omega$ resistor at room temperature generates an open-circuit noise voltage density of $4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$; scale by the square root of resistance for other values. ${ }^{6}$

[^361]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0508.jpg?height=493&width=812&top_left_y=218&top_left_x=211)

Figure 8.1. Open-circuit thermal noise-voltage and short-circuit thermal noise-current densities versus resistance at $25^{\circ} \mathrm{C}$.

Here's a handy Johnson-noise mini-table, listing both voltage and current noise densities (units of $\mathrm{V} / \sqrt{\mathrm{Hz}}$ and $\mathrm{A} / \sqrt{\mathrm{Hz}}$ ), and noise within a 10 kHz band, for seven decade-related values of resistance:

| R | Johnson noise, at $T=25^{\circ} \mathrm{C}$ open circuit short circuit |  |  |  |
| :---: | :---: | :---: | :---: | :---: |
|  | $\begin{gathered} e_{\mathrm{n}} \\ (\mathrm{nV} / \sqrt{\mathrm{Hz}}) \end{gathered}$ | $\begin{gathered} e_{\mathrm{n}} \sqrt{B} \\ B=10 \mathrm{kHz} \\ (\mu \mathrm{~V}) \end{gathered}$ | $\begin{gathered} i_{\mathrm{n}} \\ (\mathrm{pA} / \sqrt{\mathrm{Hz}}) \end{gathered}$ | $\begin{gathered} i_{\mathrm{n}} \sqrt{B} \\ B=10 \mathrm{kHz} \\ (\mathrm{pA}) \end{gathered}$ |
| $100 \Omega$ | 1.28 | 0.128 | 12.8 | 1280 |
| 1k | 4.06 | 0.406 | 4.06 | 406 |
| 10k | 12.8 | 1.28 | 1.28 | 128 |
| 100k | 40.6 | 4.06 | 0.406 | 40.6 |
| 1M | 128 | 12.8 | 0.128 | 12.8 |
| 10M | 406 | 40.6 | 0.041 | 4.06 |
| 100M | 1280 | 128 | 0.0128 | 1.28 |

The amplitude of the Johnson-noise voltage at any instant is, in general, unpredictable, but it obeys a Gaussian amplitude distribution (Figure 8.2), where $p(V) d V$ is the probability that the instantaneous voltage lies between $V$ and $V+d V$, and $v_{\mathrm{n}}(\mathrm{rms})$ is the rms noise voltage, given earlier. ${ }^{7}$

The significance of Johnson noise is that it sets a lower limit on the noise voltage in any detector, signal source, or amplifier having resistance. The resistive part of a source impedance generates Johnson noise, as do the bias and load resistors of an amplifier. You will see how it all works out presently.

[^362]It is interesting to note that the physical analog of resistance (any mechanism of energy loss in a physical system, e.g., viscous friction acting on small particles in a liquid) has associated with it fluctuations in the associated physical quantity (in this case, the particles' velocity, manifest as the chaotic Brownian motion). Johnson noise is just a special case of this fluctuation-dissipation phenomenon.

Johnson noise should not be confused with the additional noise voltage created by the effect of resistance fluctuations when an externally applied current flows through a resistor. This "excess noise" has a $1 / f$ spectrum (approximately) and is heavily dependent on the actual construction of the resistor. We will talk about it later.

### 8.1.2 Shot noise

An electric current is the flow of discrete electric charges, not a smooth fluidlike flow. The finiteness of the charge quantum results in statistical fluctuations of the current. If the charges act independently of each other, the fluctuating current's noise density is given by

$$
\begin{equation*}
i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{dc}}} \quad \mathrm{~A} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.6}
\end{equation*}
$$

where $q$ is the electron charge ( $1.60 \times 10^{-19}$ coulomb). This noise, like resistor Johnson noise, is white and Gaussian. So its amplitude, taken over a measurement bandwidth $B$, is just

$$
\begin{equation*}
i_{\text {noise }}(\mathrm{rms})=i_{\mathrm{nR}}(\mathrm{rms})=i_{\mathrm{n}} \sqrt{B}=\left(2 q I_{\mathrm{dc}} B\right)^{\frac{1}{2}} \quad \mathrm{~A}(\mathrm{rms}) \tag{8.7}
\end{equation*}
$$

$$
p(V, V+\mathrm{d} V)=\frac{1}{V_{\mathrm{n}} \sqrt{2 \pi}} \exp \left(-V^{2} / 2 V_{n}^{2}\right) \mathrm{d} V,
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0508.jpg?height=511&width=741&top_left_y=1607&top_left_x=1096)

Figure 8.2. Johnson noise obeys a Gaussian distribution of amplitudes. The normalizing factor $0.4 / V_{\mathrm{n}}$ ensures dimensionless unit area under the bell curve (the " 0.4 " is actually $1 / \sqrt{2 \pi}$, about 0.3989 ).

For example, a "steady" current of 1 A actually has an rms fluctuation of 57 nA , measured in a 10 kHz bandwidth; i.e., it fluctuates by about $0.000006 \%$. The relative fluctuations are larger for smaller currents: a "steady" current of $1 \mu \mathrm{~A}$ actually has an rms current-noise fluctuation, measured over a 10 kHz bandwidth, of $0.006 \%$, i.e., -85 dB . At 1 pAdc , the rms current fluctuation (same bandwidth) is 57 fA , i.e., a $5.7 \%$ variation! Shot noise is "rain on a tin roof."

Here's a handy minitable listing shot-noise current density and shot noise current in a 10 kHz band for decadal currents spanning 12 orders of magnitude:

|  | Shot noise current |  |  |
| :---: | :---: | :---: | ---: |
| $I_{\mathrm{dc}}$ | $B=10 \mathrm{kHz}$ |  |  |
| 1 fA | $18 \mathrm{aA} / \sqrt{\mathrm{Hz}}$ | $i_{\mathrm{n}} \sqrt{B}(10 \mathrm{kHz})$ | $\frac{i_{\mathrm{n}} \sqrt{B}}{I_{\mathrm{dc}}}$ |
| 1 pA | $0.57 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ | 57 fA | +5 dB |
| 1 nA | $18 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ | 1.8 pA | -25 dB |
| $1 \mu \mathrm{~A}$ | $0.57 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ | 57 pA | -85 dB |
| 1 mA | $18 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ | 1.8 nA | -115 dB |

An important point: the shot-noise formula given earlier assumes that the charge carriers making up the current act independently. That is indeed the case for charges crossing a barrier, for example the current in a junction diode, where the charges move by diffusion; but it is not true for the important case of metallic conductors, where there are long-range correlations between charge carriers. Thus the current in a simple resistive circuit has far less noise than is predicted by the shot-noise formula. Another important exception to the shot-noise formula is provided by our standard transistor current-source circuit (Figure 2.32); we discuss this further in §8.3.5.

Exercise 8.1. A resistor is used as the collector load in a low-noise amplifier; the collector current $I_{\mathrm{C}}$ is accompanied by shot noise. Show that the output noise voltage is dominated by shot noise (rather than Johnson noise in the resistor) as long as the quiescent voltage drop across the load resistor is greater than $2 k T / q(50 \mathrm{mV}$, at room temperature).

### 8.1.3 1/f noise (flicker noise)

Shot noise and Johnson noise are irreducible forms of noise generated according to physical principles. The most expensive and most carefully made resistor has exactly the same Johnson noise as the cheapest carbon resistor of the same resistance. Real devices have, in addition, various sources of "excess noise." Real resistors suffer from fluc-
tuations in resistance, generating an additional noise voltage (which adds to the ever-present Johnson noise) proportional to the dc current flowing through them. This noise depends on many factors having to do with the construction of the particular resistor, including the resistive material and especially the end-cap connections. Here is a listing of typical excess noise for various resistor types, given as rms microvolts per volt applied across the resistor, measured over one decade of frequency: (eq'n 8.13)

Carbon composition
Carbon film
Metal film
Wire wound

$$
\begin{aligned}
& 0.10 \mu \mathrm{~V} \text { to } 3.0 \mu \mathrm{~V} \\
& 0.05 \mu \mathrm{~V} \text { to } 0.3 \mu \mathrm{~V} \\
& 0.02 \mu \mathrm{~V} \text { to } 0.2 \mu \mathrm{~V} \\
& 0.01 \mu \mathrm{~V} \text { to } 0.2 \mu \mathrm{~V}
\end{aligned}
$$

This noise has approximately a $1 / f$ power spectrum (equal power per decade of frequency) and is sometimes called "pink noise." When plotted against voltage or current (rather than power) its amplitude falls as $1 / \sqrt{f}$, as shown in Figure 8.3. Figure 8.4 shows how it looks in comparison with a sample of white noise and of what's sometimes called "red noise" ( $1 / f^{2}$ power spectrum); if you want to make your own, look ahead to Figure 8.93 to see how.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0509.jpg?height=468&width=807&top_left_y=1205&top_left_x=966)

Figure 8.3. When plotted on log axes as noise voltage versus frequency, $1 / f$ noise slopes downward with a slope of $1 / 2$, i.e., as $1 / f^{\frac{1}{2}}$ (it is noise power that goes as $1 / f$ ).

You often see the notation $f_{\mathrm{c}}$ for the corner frequency at which the $1 / f$ noise is the same as an underlying whitenoise component. ${ }^{8}$ The combined noise voltage density is

$$
\begin{equation*}
e_{\mathrm{n}}(f)=e_{\mathrm{n}(\text { white })} \sqrt{1+f_{\mathrm{c}} / f} \tag{8.8}
\end{equation*}
$$

from which the rms integrated noise voltage in a band extending from $f_{1}$ to $f_{2}$ can be calculated; see eq'n 8.59 on page 565.

[^363]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0510.jpg?height=784&width=743&top_left_y=210&top_left_x=251)

Figure 8.4. Three noises: top, "white noise" (uniform power per Hz ); middle, "red noise" (power per Hz proportional to $1 / f^{2}$ ); bottom, "pink noise" (or $1 / f$ noise, power per Hz proportional to $1 / f$ ).

Other noise-generating mechanisms often produce $1 / f$ noise, examples being base-current noise in transistors and cathode current noise in vacuum tubes. Curiously enough, $1 / f$ noise is present in nature in unexpected places, e.g., the speed of ocean currents, the flow of sand in an hourglass, the flow of traffic on Japanese expressways, and the yearly flow of the Nile measured over the last 2,000 years. ${ }^{9}$ If you plot the loudness of a piece of classical music versus time, you get a $1 / f$ spectrum! No unifying principle has been found for all the $1 / f$ noise that seems to be swirling around us, although particular sources can often be identified in each instance.

### 8.1.4 Burst noise

Not all noise sources are characterized by a Gaussian (or even smooth) distribution of amplitudes. Most notorious among the exceptions is burst noise (also variously called popcorn noise, bistable noise, or random telegraph signal noise), seen occasionally in semiconductor devices (particularly in parts dating back to the 1970s and earlier). It consists of random jumps between two (usually) voltage levels, taking place on time scales of tens of milliseconds;

[^364]when played out on a loudspeaker it sounds like the birth throes of popcorn. Figure 8.5 shows a typical waveform, the output of a vintage ${ }^{10} 741 \mathrm{op}$-amp wired as a noninverting amplifier with $G=100$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0510.jpg?height=342&width=807&top_left_y=403&top_left_x=1068)

Figure 8.5. Burst noise from a 1973-vintage 741 op-amp, configured as an $\times 100$ noninverting amplifier with grounded input. The output was bandpass filtered to $0.1 \mathrm{~Hz}-3 \mathrm{kHz}$, with $6 \mathrm{~dB} /$ octave rolloffs.

Viewed in the frequency domain, the effect of burst noise is a raised low frequency portion, without any obvious spectral peaks. You can see this in Figure 8.6, where the voltage noise spectrum of the noisy and quiet op-amp specimens are plotted. ${ }^{11}$

### 8.1.5 Band-limited noise

All circuits operate within some limited frequency band. So, although it's nice to talk about (and calculate with) noise-density quantities, what you usually care about is the rms noise voltage contained within some signal band of interest (called $B$ in eq'n 8.1). In many cases you are dealing with a white noise source (e.g., Johnson noise or shot noise). If that is passed through a perfectly sharp bandpass filter (a "brick-wall" filter), the band-limited rms amplitude is simply $v_{\mathrm{n}(\mathrm{rms})}=e_{\mathrm{n}} \sqrt{B}$. But analog brick-wall filters aren't practical - so what you want to know is the equivalent bandwidth of a real filter, say a simple $R C$ lowpass. It turns out that the equivalent brick-wall bandwidth is given by

$$
\begin{equation*}
B=\frac{\pi}{2} f_{3 \mathrm{~dB}}=1.57 f_{3 \mathrm{~dB}}=\frac{1}{4 R C} \mathrm{~Hz}, \tag{8.9}
\end{equation*}
$$

${ }^{10}$ Semiconductor manufacturers have worked hard to alleviate this problem (believed to be caused by intermittent trapping of charge carriers at defects and interfaces), and popcorn noise is largely a thing of the past. We tested ten samples of 741 s , from six different manufacturers, before we found this one. A second sample from the same manufacturer and with the same date code showed no evidence of popcorn noise, as seen in the pair of spectra of Figure 8.6.
${ }^{11}$ It is possible that a related mechanism is responsible for similarly shaped noise plateaus seen in some JFETs; see for example the LSK389 in Figure 8.47.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0511.jpg?height=519&width=791&top_left_y=215&top_left_x=125)

Figure 8.6. Spectrum of the burst noise produced by the same op-amp as used for Figure 8.5, along with that of a second opamp from the same batch that exhibited no burst noise. The vertical scale shows RTI (referred to the input) rms noise densities.
where $f_{3 \mathrm{~dB}}=1 / 2 \pi R C$. You can use higher-order filters, of course, for example a 2-pole Butterworth lowpass filter; its equivalent brick-wall bandwidth is $B=1.11 f_{3 \mathrm{~dB}}$. For still higher-order filters (including bandpass) see the expressions in Table 8.4 on page 564 . For slowly varying (or dc) signals you can instead do a simple averaging (as, for example, with an integrating ADC, see §13.8.3); in that case the equivalent noise bandwidth is $B=1 / 2 T$, where $T$ is the duration of the (uniform) averaging of the input signal. We'll have a bit more to say about this in §8.13.1.

Of course, the noise spectrum may be other than white (e.g., it may be $1 / f$ noise or a combination of white noise with a $1 / f$ rising tail at low frequencies). In such a case you cannot simply multiply the noise density by the square root of the bandwidth. Instead you have to integrate the (changing) noise density over the bandpass. For an ideal brick-wall bandpass that is just $v_{\mathrm{n}}^{2}=\int e_{\mathrm{n}}^{2}(f) d f$ from the lower to upper frequency cutoff of the filter. For a realizable filter you have to integrate the noise density, multiplied by the filter's spectral response $H(f)$, over the bandpass: $v_{\mathrm{n}}^{2}=\int\left|e_{\mathrm{n}}(f) H(f)\right|^{2} d f$. For an arbitrary noise spectrum this is what you would need to do. But life is simpler if you're dealing with classic noise spectra like $1 / f$ flicker noise, in which case the noise integrals can be expressed analytically. We've gathered these together in Table 8.4 on page 564 , which includes results for white-, pink-, and red-noise spectra, when band limited by brickwall, single-pole, 2-pole Butterworth, and $m$-pole Butterworth bandpass filters (response from $f_{1}$ to $f_{2}$ ). Those tabulated formulas let you get the results for lowpass $\left(f_{1}=0\right)$ or highpass filters $\left(f_{2}=\infty\right)$, which are just special cases of the more general bandpass filter.

We discuss this in plenty of detail later in the chapter, at §8.13.

### 8.1.6 Interference

As we mentioned earlier, an interfering signal or stray pickup constitutes a form of noise. Here the spectrum and amplitude characteristics depend on the interfering signal. For example, 60 Hz powerline pickup has a sharp spectrum and relatively constant amplitude, whereas car ignition noise, lightning, and other impulsive interferences are broad in spectrum and spiky in amplitude. Other sources of interference are radio and television stations (a particularly serious problem near large cities), nearby electrical equipment, motors and elevators, subways, switching regulators, and television sets. Cellphones often dwarf all other sources of RF interference. Even when not in use, the cellphone transmits periodically to tell the cell tower its location, generating interference with a distinctive galloping rhythm. ${ }^{12}$ The same goes for mobile computers that use the cellular network for Internet access.

In a slightly different guise you have the same sort of problem generated by anything that puts a signal into the parameter you are measuring. For example, an optical interferometer is susceptible to vibration, and a sensitive RF measurement (e.g., nuclear magnetic resonance, NMR or MRI) can be affected by ambient RF. Many circuits, as well as detectors and even cables, are sensitive to vibration and sound; they are microphonic, in the terminology of the trade.

Many of these noise sources can be controlled by careful shielding and filtering, as we discuss later in the chapter. At other times we are forced to take Draconian measures, involving massive stone tables (for vibration isolation), constant-temperature rooms, anechoic chambers, and electrically shielded ("Faraday cage") rooms.

## 8.2 Signal-to-noise ratio and noise figure

Before getting into the details of amplifier noise and lownoise design, we need to define a few terms that are often used to describe amplifier performance. These involve ratios of noise voltages, measured at the same place in the circuit. It is conventional to refer noise voltages to the input of an amplifier (although the measurements are usually made at the output), i.e., to describe source noise and amplifier noise in terms of microvolts at the input that would

[^365]generate the observed output noise. This makes sense when you want to think of the relative noise added by the amplifier to a given signal, independent of amplifier gain; it's also realistic, because most of the amplifier noise is usually contributed by the input stage. Unless we state otherwise, noise voltages are referred to the input (RTI).

### 8.2.1 Noise power density and bandwidth

In the preceding examples of Johnson noise and shot noise, the noise voltage you measure depends both on the measurement bandwidth $B$ (i.e., how much noise you see depends on how fast you look) and on the variables ( $R$ and $I$ ) of the noise source itself. So it's convenient to talk about an rms noise-voltage "density" $e_{\mathrm{n}}$ :

$$
\begin{equation*}
v_{\mathrm{n}(\mathrm{rms})}=e_{\mathrm{n}} B^{\frac{1}{2}}=(4 k T R)^{\frac{1}{2}} B^{\frac{1}{2}} \quad \text { Vrms } \tag{8.10}
\end{equation*}
$$

where $v_{\mathrm{n}}$ is the rms noise voltage you would measure in a bandwidth $B$. White-noise sources have an $e_{\mathrm{n}}$ that doesn't depend on frequency, whereas pink noise, for instance, has a $e_{\mathrm{n}}$ that drops off at $3 \mathrm{~dB} /$ octave. You'll often see $e_{\mathrm{n}}^{2}$, too, the mean squared noise density. Since $e_{\mathrm{n}}$ always refers to rms and $e_{\mathrm{n}}^{2}$ always refers to mean square, you can just square $e_{\mathrm{n}}$ to get $e_{\mathrm{n}}^{2}$ ! Sounds simple (and it is), but we want to make sure you don't get confused.

Note that $B$ and the square root of $B$ keep popping up. Thus, for example, for Johnson noise from a resistor $R$,

$$
\begin{array}{rlr}
e_{\mathrm{nR}}(\mathrm{rms}) & =(4 k T R)^{\frac{1}{2}} & \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}}, \\
e_{\mathrm{nR}}^{2} & =4 k T R & \mathrm{~V}^{2} / \mathrm{Hz}, \\
v_{\mathrm{n}(\mathrm{rms}} & =v_{\mathrm{nR}} B^{\frac{1}{2}}=(4 k T R B)^{\frac{1}{2}} \mathrm{~V}, \\
v_{\mathrm{n}}^{2} & =v_{\mathrm{nR}}^{2} B \quad=4 k T R B \quad \mathrm{~V}^{2} .
\end{array}
$$

On datasheets you may see graphs of $e_{\mathrm{n}}$ or $e_{\mathrm{n}}^{2}$, with units like "nanovolts per root Hz" or "volts squared per Hz." The quantities $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ that will soon appear work just the same way.

When you add two signals that are uncorrelated (two noise signals, or noise plus a real signal), you add their noise power; that is, their squared amplitudes add:

$$
v=\left(v_{\mathrm{s}}^{2}+v_{\mathrm{n}}^{2}\right)^{\frac{1}{2}}
$$

where $v$ is the rms signal obtained by adding together a signal of rms amplitude $v_{\mathrm{s}}$ and a noise signal of rms amplitude $v_{\mathrm{n}}$. The rms amplitudes ${ }^{13}$ do not add.

[^366]
### 8.2.2 Signal-to-noise ratio

Signal-to-noise ratio (SNR) is simply defined as

$$
\begin{equation*}
\mathrm{SNR}=10 \log _{10}\left(v_{\mathrm{s}}^{2} / v_{\mathrm{n}}^{2}\right)=20 \log _{10}\left(v_{\mathrm{s}} / v_{\mathrm{n}}\right) \quad \mathrm{dB} \tag{8.11}
\end{equation*}
$$

where the voltages are rms values, and some bandwidth and center frequency are specified; i.e., it is the ratio, in decibels, of the rms voltage of the desired signal to the rms voltage of the noise that is also present. ${ }^{14}$ The "signal" itself may be sinusoidal, or a modulated informationcarrying waveform, or even a noiselike signal itself. It is particularly important to specify the bandwidth if the signal has some sort of narrowband spectrum, because the SNR will decrease as the bandwidth is increased beyond that of the signal: the amplifier keeps adding noise power, while the signal power remains constant.

### 8.2.3 Noise figure

Any real signal source or measuring device generates noise because of Johnson noise in its source resistance (the real part of its complex source impedance). There may be additional noise, of course, from other causes. The noise figure (NF) of an amplifier is simply the ratio, in decibels, of the output of the real amplifier to the output of a "perfect" (noiseless) amplifier of the same gain, with a resistor of value $R_{\mathrm{S}}$ connected across the amplifier's input terminals in each case. That is, the Johnson noise of $R_{\mathrm{S}}$ is the "input signal":

$$
\begin{align*}
\mathrm{NF} & =10 \log _{10}\left(\frac{4 k T R_{\mathrm{s}}+v_{\mathrm{n}}^{2}}{4 k T R_{\mathrm{s}}}\right)  \tag{8.12}\\
& =10 \log _{10}\left(1+\frac{v_{\mathrm{n}}^{2}}{4 k T R_{\mathrm{s}}}\right) \mathrm{dB}, \tag{8.13}
\end{align*}
$$

where $v_{\mathrm{n}}^{2}$ is the mean squared noise voltage per hertz contributed by the amplifier, with a noiseless (cold) resistor of value $R_{\mathrm{S}}$ connected across its input. This latter restriction is important, as you will see shortly, because the noise voltage contributed by an amplifier depends very much on the source impedance (Figure 8.7).

Noise figure is handy as a figure of merit for an amplifier when you have a signal source of a given source impedance and want to compare amplifiers (or transistors, for which the NF is often specified). The NF varies with frequency

[^367]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0513.jpg?height=537&width=797&top_left_y=219&top_left_x=122)

Figure 8.7. Effective input-noise-voltage density versus noise figure and source resistance.
and source impedance, and it is often given as a set of contours of constant NF versus frequency and $R_{\mathrm{s}}$ (we'll see examples later, in Figures 8.22 and 8.27). It may also be given as a set of graphs of NF versus frequency, one curve for each collector current, or a similar set of graphs of NF versus $R_{\mathrm{s}}$, one for each collector current. Note: the foregoing expressions for NF assume that the amplifier's input impedance is much larger than the source impedance, i.e., $Z_{\text {in }} \gg R_{\mathrm{s}}$. However, in the special case of RF amplifiers, you usually have $R_{\mathrm{S}}=Z_{\text {in }}=50 \Omega$, with the NF defined accordingly. For this special case of matched impedances, simply remove the factor " 4 " from eq'ns 8.12 and 8.13 .

Big fallacy: don't try to improve things by adding a resistor in series with a signal source to reach a region of minimum NF. All you're doing is making the source noisier to make the amplifier look better! Noise figure can be very deceptive for this reason. To add to the deception, the NF specification (e.g., $\mathrm{NF}=2 \mathrm{~dB}$ ) for a transistor or FET will always be for the optimum combination of $R_{\mathrm{S}}$ and $I_{\mathrm{C}}$. It doesn't tell you much about actual performance, except that the manufacturer thinks the noise figure is worth bragging about.

In general, when evaluating the performance of some amplifier, you're probably least likely to get confused if you stick with a SNR calculated for that source voltage and impedance. Here's how to convert from NF to SNR:

$$
\begin{equation*}
\mathrm{SNR}=10 \log _{10}\left(\frac{v_{\mathrm{s}}^{2}}{4 k T R_{\mathrm{s}}}\right)-\mathrm{NF}(\mathrm{~dB})\left(\mathrm{at} R_{\mathrm{s}}\right) \quad \mathrm{dB} \tag{8.14}
\end{equation*}
$$

where $v_{\mathrm{s}}$ is the rms signal amplitude, $R_{\mathrm{S}}$ is the source impedance, and NF is the noise figure of the amplifier for source impedance $R_{\mathrm{s}}$. See $\S \S 8.3 .1$ and 8.5.6 for some noise figure calculation examples.

### 8.2.4 Noise temperature

Rather than noise figure, you sometimes see noise temperature used to express the noise performance of an amplifier. Both methods give the same information, namely the excess noise contribution of the amplifier when driven by a signal source of impedance $R_{\mathrm{s}}$; they are equivalent ways of expressing the same thing.

Look at Figure 8.8 to see how noise temperature works: we first imagine the actual (noisy) amplifier connected to a noiseless source of impedance $R_{\mathrm{S}}$ (Figure 8.8A). If you have trouble imagining a noiseless source, think of a resistor of value $R_{\mathrm{S}}$ cooled to absolute zero. There will be some noise at the output, even though the source is noiseless, because the amplifier has noise. Now imagine constructing Figure 8.8B, where we magically make the amplifier noiseless and bring the source $R_{\mathrm{s}}$ up to some temperature $T_{\mathrm{n}}$ such that the output noise voltage is the same as in Figure 8.8A. $T_{\mathrm{n}}$ is called the noise temperature of the amplifier, for source impedance $R_{\mathrm{s}}$.

As we remarked earlier, noise figure and noise temperature are simply different ways of conveying the same information. In fact, you can show that they are related by the following expressions:

$$
\begin{gather*}
T_{\mathrm{n}}=T\left(10^{\mathrm{NF}(\mathrm{~dB}) / 10}-1\right) \quad \text { Kelvin, }  \tag{8.15}\\
\mathrm{NF}(\mathrm{~dB})=10 \log _{10}\left(\frac{T_{\mathrm{n}}}{T}+1\right) \tag{8.16}
\end{gather*}
$$

where $T$ is the ambient temperature, usually taken as $293^{\circ} \mathrm{K}$.

Generally speaking, good low-noise amplifiers have noise temperatures far below room temperature (or,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0513.jpg?height=644&width=457&top_left_y=1586&top_left_x=1144)

Figure 8.8. Noise temperature.
equivalently, they have noise figures far less than 3 dB ). Later in the chapter we explain how you go about measuring the noise figure (or temperature) of an amplifier. First, however, we need to understand noise in transistors and the techniques of low-noise design. We hope the discussion that follows will clarify what is often a murky subject.

## 8.3 Bipolar transistor amplifier noise

The noise generated by an amplifier is easily described by a simple noise model that is accurate enough for most purposes. In Figure 8.9, $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ represent the transistor's internal noise, modeled as a noise voltage $e_{\mathrm{n}}$ in series with the input, combined with a noise current $i_{\mathrm{n}}$ injected at the input. The transistor symbol itself (or amplifier, in general) is assumed noiseless, and it simply amplifies the inputnoise voltage it sees (caused by its own $e_{\mathrm{n}}$, combined with its $i_{\mathrm{n}}$ flowing through the input signal's source impedance $R_{\mathrm{s}}$ ). That is, the amplifier contributes a total noise voltage $e_{\mathrm{a}}$, referred to the input, of

$$
\begin{equation*}
e_{\mathrm{a}}(\mathrm{rms})=\left[e_{\mathrm{n}}^{2}+\left(R_{\mathrm{s}} i_{\mathrm{n}}\right)^{2}\right]^{\frac{1}{2}} \quad \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.17}
\end{equation*}
$$

The two terms are simply the squared values of the amplifier input-noise voltage, and the noise voltage generated by the amplifier's input noise current passing through the source resistance. ${ }^{15}$ Because the two noise terms are usually uncorrelated, their squared amplitudes add to produce the effective noise voltage seen by the amplifier. For low source resistances the noise voltage $e_{\mathrm{n}}$ dominates, whereas for high source impedances the noise current $i_{\mathrm{n}}$ generally dominates.

Just to get an idea of what these look like, look at Figure 8.10, which shows a graph of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus $I_{\mathrm{C}}$ and $f$ for the excellent (but, sadly, discontinued ${ }^{16}$ ) low-noise npn 2SD786. We go into some detail now, describing these and showing how to design for minimum noise. It is worth noting that voltage noise and current noise for a bipolar transistor are in the range of nanovolts and picoamps per root hertz (i.e., $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $\mathrm{pA} / \sqrt{\mathrm{Hz}}$ ); for FETs the current noise is lower, down in the $\mathrm{fA} / \sqrt{\mathrm{Hz}}$ range.

### 8.3.1 Voltage noise, $e_{n}$

The equivalent voltage noise looking in series with the base of a bipolar transistor arises from collector-current shot
${ }^{15}$ An additional term, important at higher frequencies or when $i_{\mathrm{n}}$ is small, is the noise current $i_{\mathrm{n}}$ generated by $e_{\mathrm{n}}$ in combination with the input capacitance: $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\text {in }}$. See $\S \S 8.11 .3$ and 4x.3.4.
${ }^{16}$ The 2SD786 was for many years the standard to which low-noise transistors aspired. We feature it here because it is well characterized, with a wealth of information and excellent noise performance. Our nomination for its successor is the ZTX851 (with ZTX951 pnp complement), characterized and used in numerous examples later in the chapter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0514.jpg?height=386&width=448&top_left_y=218&top_left_x=1266)

Figure 8.9. Noise model of a transistor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0514.jpg?height=508&width=784&top_left_y=700&top_left_x=1077)

Figure 8.10. Equivalent rms input noise voltage ( $e_{\mathrm{n}}$ ) and noise current ( $i_{\mathrm{n}}$ ) versus collector current for a 2SD786 npn transistor, adapted from the datasheet.
noise generating a noise voltage across the intrinsic emitter resistance ${ }^{17} r_{\mathrm{e}}$, Johnson noise generated in the base resistance $r_{\mathrm{bb}}$, and (as we'll see later) base current shot noise through that resistance. Deferring for the moment the base current term (which most often does not contribute significantly to a BJT's voltage noise), the input noise voltage density looks like this:

$$
\begin{align*}
e_{\mathrm{n}}^{2} & =2 q I_{\mathrm{C}} r_{\mathrm{e}}^{2}+4 k T r_{\mathrm{bb}^{\prime}}  \tag{8.18}\\
& =4 k T\left(\frac{V_{\mathrm{T}}}{2 I_{\mathrm{C}}}+r_{\mathrm{bb}^{\prime}}\right)  \tag{8.19}\\
& =4 k T\left(\frac{r_{\mathrm{e}}}{2}+r_{\mathrm{bb}^{\prime}}\right) \quad \mathrm{V}^{2} / \mathrm{Hz} \tag{8.20}
\end{align*}
$$

where we've eliminated $r_{\mathrm{e}}$ in the second form (eq'n 8.19) and $I_{\mathrm{C}}$ in the third form (eq'n 8.20) by remembering that $r_{\mathrm{e}}=V_{\mathrm{T}} / I_{\mathrm{C}}=k T / q I_{\mathrm{C}}$.

[^368]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0515.jpg?height=723&width=1156&top_left_y=215&top_left_x=371)

Figure 8.11. Input noise voltage $e_{\mathrm{n}}$ in a BJT. At low currents the shot noise in $I_{\mathrm{C}}$ through $r_{\mathrm{e}}$ dominates; otherwise the Johnson noise in $r_{\mathrm{b} b^{\prime}}$ is the dominant term. However, at low frequencies and high currents, the base-current shot noise through $r_{\mathrm{bb}^{\prime}}$ causes $e_{\mathrm{n}}$ to rise again. These curves assume typical values of flicker-noise breakpoint ( $f_{\mathrm{ci}} \sim 1 \mathrm{kHz}$ ) and base resistance ( $r_{\mathrm{bb}} \sim 25 \Omega$ ), with double-sided arrows indicating variation with $r_{\mathrm{bb}^{\prime}}$, and the arrow upward from "min" indicating $1 / f$ rise with decreasing frequency.

The third form is handy because it lets you think about the noise voltage as if arising from combining the separate Johnson noise from two resistors. To get a sense of the scale of BJT noise voltage, it's helpful to know that the base resistance $r_{\mathrm{bb}^{\prime}}$ for typical BJTs (see Table 8.1a on page 501) goes from a few ohms to a few hundred ohms; thus the second term's noise voltage contribution is typically in the range of $0.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ to $2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (we like to remember that a $100 \Omega$ resistor has $e_{\mathrm{n}}=1.28 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and that $e_{\mathrm{n}}$ scales as the square root of $R$ ).

As for the first term in eq'n 8.20, it's telling us that the collector shot-noise current through $r_{\mathrm{e}}$ produces the same noise voltage as the Johnson noise of a fictional resistor of value $R=r_{\mathrm{e}} / 2$. For example, in a BJT running at $100 \mu \mathrm{~A}$ (thus $r_{\mathrm{e}}=250 \Omega$ ) this amounts to $e_{\mathrm{n}}=\sqrt{4 k T \cdot 125 \Omega}$, or $1.4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. This is a useful thing to know, for example when choosing resistor values so as not to compromise the noise performance of a low-noise amplifier. Lest we leave the wrong impression, we hasten to emphasize again that the intrinsic emitter resistance $r_{\mathrm{e}}$ is not a "real" resistor - it does not have Johnson noise; the noise-voltage term we're describing arises solely from the noise voltage generated by collector shot-noise current flowing through a noiseless $r_{\mathrm{e}} .{ }^{18}$

Both voltage-noise terms in eq'ns 8.18 and 8.20 have a flat (white) spectrum, with a Gaussian distribution of

[^369]instantaneous amplitude. Because $r_{\mathrm{e}}$ falls inversely with collector current, a BJT's $e_{\mathrm{n}}$ falls as $1 / \sqrt{I_{\mathrm{C}}}$ with rising collector current, ultimately reaching a minimum that depends on $r_{\mathrm{bb}^{\prime}}$ (Figure 8.11). For this reason it's usually best to run at relatively high collector currents if the objective is to minimize noise voltage; the price you pay is increased base current and increased heating. Taking again the excellent 2SD786 as an example, at frequencies above 1 kHz it has an $e_{\mathrm{n}}$ of $1.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at $I_{\mathrm{C}}=100 \mu \mathrm{~A}$ and $0.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at $I_{\mathrm{C}}=1 \mathrm{~mA}$ (Figure 8.10). This transistor uses special geometry to achieve an unusually low $r_{\mathrm{bb}^{\prime}}$ of $4 \Omega$, which is needed to realize the lowest values of $e_{\mathrm{n}}$.

Of course, if you need to operate at a low collector current (where the effect of $r_{\mathrm{e}}$ dominates), it's of no particular benefit to have a low value of $r_{\mathrm{bb}^{\prime}}$. To make this point graphically, we plotted in Figure 8.12 the predicted and measured $e_{\mathrm{n}}$ versus collector current for six low-noise $n p n$ transistors, using a simple one-parameter model based upon $r_{\mathrm{bb}^{\prime}}$ alone. Selecting a transistor with low $r_{\mathrm{bb}^{\prime}}$ really matters at higher currents, though, which is where you have to operate if you want to achieve $e_{\mathrm{n}}$ values southward of $1 \mathrm{nV} / \sqrt{\mathrm{Hz}} .{ }^{19}$ We illustrate that point dramatically in $\S 8.5 .9$, in an input stage with $e_{\mathrm{n}}<0.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

The voltage-noise density $e_{\mathrm{n}}$ at 1 kHz , as plotted in
${ }^{19}$ The effective $r_{\mathrm{bb}^{\prime}}$ is said to increase slightly at low currents. For example, if the 2 N 5089 excess noise at $10 \mu \mathrm{~A}(5.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ instead of $4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) is due to $r_{\mathrm{bb}^{\prime}}$, we can calculate that $r_{\mathrm{bb}^{\prime}}$ increased from
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0516.jpg?height=590&width=832&top_left_y=220&top_left_x=204)

Figure 8.12. A simple model of BJT noise voltage (shot noise current through $r_{\mathrm{e}}$, combined with Johnson noise of base resistance, solid curves) provides a good first approximation to measured noise values (datapoints at four currents), shown here for six selected low-noise BJTs. The dashed line shows the theoretical minimum noise voltage at current $I_{\mathrm{C}}$, as given in eq'n 8.18. The measured noise is $10 \%-20 \%$ high at collector currents below $100 \mu \mathrm{~A}$. See Figure 8.17 for the noise spectra of these six BJTs at $I_{\mathrm{C}}=10 \mathrm{~mA}$.

Figure 8.12, does not tell the whole story, of course. If you care about the noise at lower frequencies, you have to worry about a component of the transistor's noise that is frequency dependent, usually in the form of a rising $1 / f$ flicker-noise tail (characterized by a $1 / f$ corner frequency $f_{\mathrm{c}}$ ). For BJTs, the $1 / f$ noise in their $e_{\mathrm{n}}$ comes from one additional noise term that we've ignored thus far - the noise voltage produced by the base's noise current $i_{\mathrm{n}}$ flowing through the transistor's own $r_{\mathrm{bb}}$, i.e., $e_{\mathrm{n}}=i_{\mathrm{n}} r_{\mathrm{bb}}$. This latter term becomes a significant contributor to $e_{\mathrm{n}}$ only at low frequencies and at relatively high collector currents. But it is quite important for another reason: it flows through the input signal's source resistance, generating an additional noise voltage $v_{\mathrm{n}}=i_{\mathrm{n}} R_{\mathrm{sig}}$. Let's look at the business of input noise current, after which we briefly revisit transistor $e_{\mathrm{n}}$ with this effect included.

### 8.3.2 Current noise $\boldsymbol{i}_{\mathbf{n}}$

The transistor's input noise current generates an additional noise voltage across the input signal source impedance.

[^370]The main source of base-current noise is shot-noise fluctuation in the steady base current,

$$
\begin{equation*}
i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{B}}}=\sqrt{2 q I_{\mathrm{C}} / \beta_{0}} \quad \mathrm{~A} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.21}
\end{equation*}
$$

which is Gaussian noise exhibiting a flat frequency spectrum (i.e., white noise); we've used the symbol $\beta_{0}$ here to emphasize that it's the beta at $d c$.

There is in addition a flicker-noise component that rears its ugly head at low frequencies. The latter exhibits the typical $1 / f$ frequency dependence, with a corner frequency that we'll call $f_{\text {ci }}$; i.e., it contributes a term $2 q I_{\mathrm{B}} f_{\mathrm{ci}} / f$ to the overall $i_{\mathrm{n}}^{2}$. It rises somewhat more rapidly with $I_{\mathrm{C}}$, owing to a rising $1 / f$ breakpoint, typically with $f_{\text {ci }}$ going as $I_{\mathrm{B}}^{1 / 3}$ to $I_{\mathrm{B}}^{1 / 4}$. See Figures 8.13 and 8.14. Typical currentnoise corner frequencies are $f_{\mathrm{ci}} \sim 50-300 \mathrm{~Hz}$ at $1-10 \mu \mathrm{~A}$, and $200 \mathrm{~Hz}-2 \mathrm{kHz}$ at 1 mA .

Note that this simple base-current shot noise is not collector-current shot noise divided by beta. If it were, it would be $\sqrt{2 q I_{\mathrm{C}}} / \beta_{0}$ rather than the correct (and larger) $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{C}}} / \sqrt{\beta_{0}}$ (as given by eq'n 8.21). In fact, to first order the base-current shot noise is uncorrelated with the collector-current shot noise.

However, at high frequencies this is no longer true, leading to one final current-noise term: at frequencies approaching the transistor's $f_{\mathrm{T}}$ (i.e., as the current gain approaches unity) the decreasing beta makes the collectorcurrent's shot noise visible at the base.

Putting these terms together, we have, finally

$$
\begin{equation*}
i_{\mathrm{n}}^{2}=2 q \frac{I_{\mathrm{C}}}{\beta_{0}}\left(1+\frac{f_{\mathrm{ci}}}{f}\right)+2 q I_{\mathrm{C}}\left(\frac{f}{f_{\mathrm{T}}}\right) \quad \mathrm{A}^{2} / \mathrm{Hz} \tag{8.22}
\end{equation*}
$$

where the last term effectively represents a frequencydependent beta.

Taking the example of the 2SD786 again (Figure 8.10), above $1 \mathrm{kHz} i_{\mathrm{n}}$ is about $0.25 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ at $I_{\mathrm{C}}=100 \mu \mathrm{~A}$ and $0.8 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ at $I_{\mathrm{C}}=1 \mathrm{~mA}$. The noise current increases and the noise voltage decreases as $I_{\mathrm{C}}$ is increased. In the next subsection (§8.3.3) we see how this dictates operating current in low-noise design. Figure 8.15 shows graphs of $i_{\mathrm{n}}$ versus frequency and current for a pair of low-noise transistors.

Current-noise times input impedance The inputnoise current flowing through the input signal's source impedance generates a noise-voltage density of magnitude $v_{\mathrm{n}}=i_{\mathrm{n}} Z_{\mathrm{s}}$, which combines (as sum of squares) with the transistor's input noise-voltage density. ${ }^{20}$ Usually the source impedance is resistive, in which case you need to

[^371]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0517.jpg?height=626&width=1050&top_left_y=218&top_left_x=424)

Figure 8.13. Input noise-current density $i_{n}$ versus frequency in a BJT. At mid-frequencies it is entirely base-current shot noise, proportional to $\sqrt{I_{\mathrm{B}}}$. At low frequencies $i_{\mathrm{n}}$ rises as $1 / \sqrt{f}$ (it is the noise power that goes as $1 / f$ ); however, the $1 / f$ breakpoint ( $f_{\mathrm{ci}}$ ) rises with increasing current, so that at a given low frequency below $f_{\mathrm{ci}}$ the noise current rises faster than the square root of base current, as shown. At high frequencies the falling beta ( $\beta \rightarrow 1$ at $f_{\mathrm{T}}$ ) causes the noise density to rise $\propto f$. These curves assume a typical value of flicker noise breakpoint ( $f_{\mathrm{ci}} \sim 500 \mathrm{~Hz}$ at $I_{\mathrm{B}}=1 \mu \mathrm{~A}$ ), with the solid arrow indicating variation of $i_{\mathrm{n}}$ with base current, and the dashed arrow indicating variation of $1 / f$ breakpoint with base current.
add its Johnson noise as well; in other words, the total input-referred squared noise voltage is

$$
\begin{equation*}
v_{\mathrm{n}}^{2}=e_{\mathrm{n}}^{2}+4 k T R_{\mathrm{S}}+\left(i_{\mathrm{n}} R_{\mathrm{S}}\right)^{2} \quad \mathrm{~V}^{2} / \mathrm{Hz} \tag{8.23}
\end{equation*}
$$

If the source impedance is reactive, however, the current noise contribution (the last term in the equation) will be frequency dependent. A common situation in which this matters is an ac-coupled input signal. If you aren't thinking about noise, you'd normally choose the blocking capacitor value based on the downstream load impedance (transistor input impedance and bias resistor), to set the low-frequency rolloff somewhat below the lowest frequency of interest. That could be a rather small capacitance (if the amplifier has a high input impedance, or if the low-frequency cutoff isn't terribly low), through which the noise current would generate substantial noise voltage (and, of course, increasing proportional to the capacitor's reactance $X_{C}=1 / 2 \pi f C$, i.e., proportional to $1 / f$ ). ${ }^{21}$

So, you need to turn the process around: first, choose the capacitor value to keep its noise-voltage contribution $v_{\mathrm{n}}=i_{\mathrm{n}} X_{\mathrm{C}}$ small enough at the lowest frequency of operation (and remember that base-current noise often exhibits a $1 / f$ tail); then choose the transistor's input bias resistor value to get the desired low-frequency rolloff. We've been bitten by this issue, surprised by a $1 / f$ noise voltage $(1 / f$

[^372]in amplitude, not power) caused by the blocking capacitor's reactance versus frequency. To fix the problem we had to increase the blocking capacitor's value by a factor of 50 !
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0517.jpg?height=562&width=828&top_left_y=1298&top_left_x=956)

Figure 8.14. Input noise current in a BJT is shot noise, scaling as the square root of base current for frequencies above the $1 / f$ corner frequency $f_{\mathrm{ci}}$. At lower frequencies the curve is steeper, because $f_{\mathrm{ci}}$ itself rises with increasing current (see Figure 8.15).

### 8.3.3 BJT voltage noise, revisited

As suggested in §8.3.1, the transistor's input current noise $i_{n}$ can become a significant contributor to the voltage noise $e_{\mathrm{n}}$ seen at its input terminals, owing to the noise voltage
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0518.jpg?height=922&width=736&top_left_y=223&top_left_x=247)

Figure 8.15. Noise current ( $i_{\mathrm{n}}$ ) versus frequency for two low-noise npn transistors. The low-frequency noise current exhibits a somewhat greater rise with collector current, owing to a rising $1 / f$ corner frequency.
generated across its internal $r_{\mathrm{bb}}$ by its own input-noise current $i_{\mathrm{n}}$. Because $i_{\mathrm{n}}$ is shot noise in the dc base current, it increases as the square root of collector current (for constant beta); and, because $i_{\mathrm{n}}$ of a BJT is seriously afflicted by a $1 / f$ low-frequency tail, its contribution to the overall $e_{\mathrm{n}}$ is seen primarily (and often only) at low frequencies. A more detailed noise model of the bipolar transistor lets us incorporate this effect.

Adding this noise term to our original (incomplete) BJT noise voltage formula, eq'n 8.18, we have

$$
e_{\mathrm{n}}^{2}=2 q I_{\mathrm{C}} r_{\mathrm{e}}^{2}+4 k T r_{\mathrm{bb}^{\prime}}+2 q \frac{I_{\mathrm{C}}}{\beta_{0}} r_{\mathrm{bb}^{\prime}}\left(1+\frac{f_{\mathrm{ci}}}{f}\right), \mathrm{V}^{2} / \mathrm{Hz},(8.24)
$$

where, as before, the first term can be replaced by $2 k T r_{\mathrm{e}}$, and, as in eq'n 8.22 , the current-noise corner frequency $f_{\mathrm{ci}}$ rises approximately as the fourth root of $I_{\mathrm{C}}$.

To see how this works out, look at Figure 8.16, where we've plotted separately (for three choices of collector current) the $e_{\mathrm{n}}$ from the first two terms (as dashed lines) and the $e_{\mathrm{n}}$ from the third term (as thin solid lines). The thick solid lines represent the total voltage noise, i.e., including all three terms of eq'n 8.24. For these calculated curves
we used typical BJT noise parameters ( $\beta=200, r_{\mathrm{bb}^{\prime}}=50 \Omega$, $f_{\mathrm{ci}}=1 \mathrm{kHz}$ at $I_{\mathrm{C}}=1 \mathrm{~mA}$ ).

This shows how the $i_{\mathrm{n}} r_{\mathrm{bb}}$ noise-voltage term competes with the other two $e_{\mathrm{n}}$ noise terms, dominating at high collector current and low frequency. Although the noisecurrent $1 / f$ breakpoint $f_{\mathrm{ci}}$ increases only mildly with $I_{\mathrm{C}}$, its contribution acts to create a rapidly rising noise-voltage breakpoint $f_{\mathrm{c}}$. Compare this with Figure 8.11, where the same effect can be seen: there, however, $e_{\mathrm{n}}$ is plotted versus collector current, with a family of several spot frequencies.

To maintain some perspective here, note that additional noise voltage is evident only at very low frequencies (Figure 8.16 goes down to 0.01 Hz !) and at relatively high current densities. It's not something over which to lose sleep. ${ }^{22}$ This can be seen in the measured noise-voltage curves plotted in Figure 8.17, where the effect (at the substantial collector current of 10 mA ) is serious above 10 Hz only for BC850 with its unusually high $r_{\mathrm{bb}} \approx 750 \Omega$. In fact, for transistors with attractively low $r_{\mathrm{bb}}$ the $e_{\mathrm{n}}$ improvement gained from running at high collector current more than compensates for the rise at low frequencies that comes from the base-current shot-noise contribution, as seen in Figure 8.18.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0518.jpg?height=572&width=817&top_left_y=1201&top_left_x=1061)

Figure 8.16. BJT noise-voltage density versus frequency (from eq'n 8.24 ) for a hypothetical transistor with the listed parameters, showing the effect of current noise $i_{\mathrm{n}}$ at low frequencies and high collector currents.

[^373]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0519.jpg?height=580&width=743&top_left_y=220&top_left_x=154)

Figure 8.17. Measured input noise-voltage spectra ( $e_{\mathrm{n}}$ versus frequency at $I_{\mathrm{C}}=10 \mathrm{~mA}$ ) for the six BJTs of Figure 8.12.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0519.jpg?height=494&width=739&top_left_y=952&top_left_x=151)

Figure 8.18. Measured input noise-voltage spectra for a ZTX851 at five choices of collector current. Base noise current adds noise voltage at low frequencies and high current, but you're still ahead at collector currents up to 10 mA .

### 8.3.4 A simple design example: loudspeaker as microphone

Let's put this noise theory into practice by designing a simple and inexpensive ac-coupled audio amplifier that runs on low current from a single +9 V supply (which could be a battery, or a "wall-wart" ac adapter), with input noise of just a few $\mathrm{nV} / \sqrt{\mathrm{Hz}}$. If you want to have an application in mind, think about a front-door intercom, where the small loudspeaker also serves reciprocally as a microphone. ${ }^{23}$

To get a handle on the noise specifications, we put a few small " $8 \Omega$ " loudspeaker samples on our lab bench, spoke to them in a normal voice, and measured output au-

[^374]dio voltages in the range of $30-100 \mu \mathrm{Vrms}$. Let's aim for a signal-to-noise ratio of 40 dB or better; that translates to an input noise voltage of $0.5 \mu \mathrm{Vrms}$ or less. And let's keep the component cost really low - we'll aim for 25 .

The basic circuit Figure 8.19 shows the circuit, an accoupled common-emitter stage (with bypassed emitter resistor) driving an emitter follower. We're not worried about distortion (with output swings in the tens of millivolts, from $\sim 50 \mu \mathrm{~V}$ input levels), but we want plenty of voltage gain, and bypassing the emitter resistor eliminates it as a noise source. We provisionally chose operating currents of $100 \mu \mathrm{~A}$, to be revisited (as with any circuit design) after an initial evaluation of the circuit's performance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0519.jpg?height=501&width=695&top_left_y=801&top_left_x=1022)

Figure 8.19. Low noise, and even lower cost: a simple audio preamp for running a loudspeaker "backward."

Noise calculation We chose the '5089 for this example because it's widely available (half a million in stock at Mouser and DigiKey, four different manufacturers), it's inexpensive ( $\$ 0.026$ in qty 100), and it promotes itself for low-noise amplifier applications. ${ }^{24}$ It has lots of current gain ( 400 minimum, 600 typical at $100 \mu \mathrm{~A}$ ), but it suffers from relatively high base resistance $r_{\mathrm{bb}^{\prime}} \approx 300 \Omega$.

From eq'n 8.24 it's easy to calculate the various noise voltage density $\left(e_{\mathrm{n}}\right)$ contributions (and the reader is encouraged to do so), referred to the input (RTI):

| Shot noise of $I_{\mathrm{C}}$ through $r_{\mathrm{e}}$ | $r_{\mathrm{e}} \sqrt{2 q I_{\mathrm{C}}}$ | $1.4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ |
| :--- | :--- | :--- |
| Johnson noise in $r_{\mathrm{bb}}$ | $\sqrt{4 k T r_{\mathrm{bb}^{\prime}}}$ | $2.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ |
| Johnson noise in $R_{\mathrm{C}}$ | $\sqrt{4 k T R_{\mathrm{C}}} / G_{\mathrm{V}}$ | $0.17 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ |
| Shot noise of $I_{\mathrm{B}}$ through $r_{\mathrm{bb}^{\prime}}$ | $r_{\mathrm{bb}^{\prime}} \sqrt{2 q I_{\mathrm{B}}}$ | $0.066 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ |

${ }^{24}$ For example, ON Semiconductor explicitly calls it a "Low Noise Transistor"; Fairchild and NXP call it a "General Purpose Transistor," but promote it for "low noise, high gain, general purpose amplifier applications" and "low-noise input stages in audio equipment," respectively.

The dominant noise source is Johnson noise in $Q_{1}$ 's internal base resistance, followed by collector shot noise flowing through $Q_{1}$ 's intrinsic emitter resistance $r_{\mathrm{e}}$ of $250 \Omega$ at its collector current of 0.1 mA . The last two terms are negligible by comparison: there's plenty of Johnson noise in $Q_{1}$ 's collector resistor, but owing to that stage's voltage gain of $\sim 150$ it is an insignificant contribution when referred to the input (RTI). Even smaller is the voltage noise produced by base-current shot noise flowing through $r_{\mathrm{bb}}$. There are other noise possibilities, but they are vanishingly small by comparison: as an example, the Johnson-noise current in the bias divider flowing through the speaker's $8 \Omega$ source impedance generates a noise voltage density of just $0.003 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

Performance From these noise-voltage densities we arrive at the total rms noise voltage over the signal bandwidth: $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{\Delta f}=142 \mathrm{nVrms}$, where $e_{\mathrm{n}}$ is the combined noise-voltage density of $2.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and $\Delta f$ is the audio bandwidth (for which we've used the "telephone bandwidth" of 3 kHz ). Compared with the nominal $50 \mu \mathrm{Vrms}$ audio input, that amounts to a signal-to-noise ratio of 51 dB - not bad for the price!

Speaking of which, component cost is a "performance" parameter, of sorts. A quick search of the usual distributors (DigiKey, Mouser, Newark, Future) turned up the following prices (SMT components - chip resistors and capacitors, SOT-23 transistors):

|  | qty 100 | qty 1 k |
| :--- | ---: | ---: |
| $Q_{1}, Q_{2}$ | $\$ 0.026$ | $\$ 0.023$ |
| $C_{\text {in }}$ | $\$ 0.032$ | $\$ 0.012$ |
| $C_{\mathrm{E}}$ | $\$ 0.068$ | $\$ 0.039$ |
| $C_{\text {out }}$ | $\$ 0.034$ | $\$ 0.017$ |
| resistors | $\$ 0.012$ | $\$ \mathbf{\$ 0 . 0 0 4}$ |
| total parts | $\$ 0.246$ | $\$ 0.134$ |

Variations We exceeded our targets of SNR and cost, so we could leave it at that. But it's always good to review an initial design, looking to improve things. Here the noise budget is dominated by the relatively high base resistance of these "low-noise" transistors. We could improve the noise performance by choosing an input-stage transistor with lower $r_{\mathrm{bb}^{\prime}}$ - look ahead to Table 8.1a on page 501, and at Figure 8.12, to see some candidates. However, once you've driven down the $r_{\mathrm{bb}^{\prime}}$ Johnson noise, the collector shot noise through $r_{\mathrm{e}}$ becomes the dominant term, and you're forced to increase the collector current to reap further improvements in $v_{\mathrm{n}}{ }^{25}$ In fact, as Figure 8.12 shows,

[^375]down at $I_{\mathrm{C}}=100 \mu \mathrm{~A}$ the ' 5089 is hardly worse (not even a factor of 2) than transistors with the lowest $r_{b^{\prime}}$.

Looked at another way, we could instead stick with the inexpensive and widely available MMBT5089, and reduce somewhat the collector current (say, to $50 \mu \mathrm{~A}$ ), with very little increase in overall noise: the noise density would increase from $2.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ to $3.0 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, which would reduce the audio-band SNR by just 1 dB (from 50.9 dB to 49.8 dB ). Certainly worth it, if you're running from a battery.

### 8.3.5 Shot noise in current sources and emitter followers

We remarked earlier (in §8.1.2) that shot noise is suppressed in the classic BJT current source (redrawn in Figure 8.20A). You might at first think this is obvious, because the collector current is just the emitter current (apart from a small base current contribution), in which shot noise is absent (as it always is in metallic conductors). But at the collector you've got just the sort of barrier in which shot noise is unavoidable.

OK, you might say, perhaps the current source does exhibit shot noise, but surely at the emitter terminal you've got a quiet current (and thus an absence of noise voltage) just look at that resistor!

Paradoxically, that intuition is wrong. It turns out that the current source is "quiet," but the emitter follower's output does indeed include a noise voltage just equal to a shotnoise current (calculated from $I_{\mathrm{C}}$ ) flowing through $r_{\mathrm{e}}$, i.e., just the $r_{\mathrm{e}} \sqrt{2 q I_{\mathrm{C}}}$ we saw in eq'n $8.24 .{ }^{26}$

It's actually rather easy to test this. Look at Figure 8.20 C , where $\mathrm{a} \sim 10 \mu \mathrm{~A}$ current source is loaded with a $1 \mathrm{M} \Omega$ collector resistor. Absent collector shot noise, we should see only a Johnson-noise voltage density of $181 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at the collector, ${ }^{27}$ to be compared with a noise voltage $10 \times$ higher if the collector current has the statutory shot noise $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{C}}}$. Meanwhile, at the emitter, that shotnoise current, flowing through $r_{\mathrm{e}}$, would produce a noisevoltage density of $4.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$; in the absence of emitter shot noise the follower would be quiet (apart from the other sources of BJT noise in eq'n 8.24).

We built circuit C, and...(drumroll)... we measured $190 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at the collector (consistent with Johnson

[^376]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0521.jpg?height=450&width=257&top_left_y=219&top_left_x=147)
A. Current source
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0521.jpg?height=449&width=190&top_left_y=222&top_left_x=443)
B. Follower
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0521.jpg?height=450&width=356&top_left_y=219&top_left_x=687)
C. Test circuit
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0521.jpg?height=340&width=636&top_left_y=335&top_left_x=1100)

Figure 8.20. Shot noise is suppressed in the transistor current source, A, but not in the emitter follower, B. This is easily confirmed by measuring the noise-voltage density in the test circuit C .
noise alone, i.e., a quiet current source); and we measured $4.93 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at the emitter (consistent with collectorcurrent shot noise through $r_{\mathrm{e}}$ ). Evidently shot noise is suppressed in the current source, but not in the follower. Interesting! And, to test the possibility that collector current never exhibits shot noise, we put a bypass capacitor between the base and emitter terminals. The noise voltage at the collector jumped up, to $1679 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, which agrees well with the shot-noise formula's predicted ${ }^{28}$ $1664 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. How can we understand this?

To get an understanding of this puzzle, it's best to start with what must be true and see where it leads. Look at Figure 8.21, as we take it in steps.

1. We know for sure that the emitter current is quiet, because it's the current through a metallic conductor. And any worry we might have that this current could become noisy because of the fluctuations in the transistor's base-to-emitter voltage (i.e., input-voltage noise) is easily addressed: we can reduce any such effect (already negligible, because noise variations $v_{\mathrm{n}(\mathrm{BE})}$ are down in the microvolts) by as much as we like by simply increasing both $R_{\mathrm{E}}$ and the negative supply voltage proportionally.
2. Somewhere within the transistor there must be a diffusive collector current that is subject to classic uncorrelated charge-flow shot noise, $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{C}(\mathrm{dc})}}$, and over which the transistor has no control.
3. But this is a three-terminal device with negligible base current, so we know that the current flowing into the collector terminal equals the current flowing out of the emitter terminal (in the limit of large beta); and the latter is "quiet."

[^377]4. So it must be the case that the controllable portion of the BJT's collector current is fluctuating in just such a way as to cancel the shot noise fluctuations.

For that to be so, the input voltage $V_{1}$ to the BJT transconductance model must be such that $g_{m} V_{1}=I_{\mathrm{E}}-i_{\mathrm{n}}$, and so the input noise-voltage portion of $V_{1}$ is just

$$
\begin{equation*}
e_{\mathrm{n}}=-i_{\mathrm{n}} / g_{m} \tag{8.25}
\end{equation*}
$$

which (recall $r_{\mathrm{e}}=1 / g_{m}$ ) is the familiar $i_{\mathrm{n}} r_{\mathrm{e}}$ form from eq'n 8.24.

This may seem like a circular argument; but in a real sense this is how this component of the base-to-emitter noise voltage is (and must be) created. This line of reasoning also explains nicely the presence of noise voltage $e_{\mathrm{n}}$ at the emitter of our test circuit (and, of course at the output of an emitter follower, or at the input of a commonemitter amplifier, etc.). And it explains also why bypassing the emitter liberates the full shot noise at the collector of our current source: such a connection invalidates the starting assumption (\#1, above) because the capacitor diverts
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0521.jpg?height=366&width=774&top_left_y=1751&top_left_x=985)

Figure 8.21. Three-terminal simplified "hybrid- $\pi$ " model of the current-source-follower of Figure 8.20C. The noise voltage $e_{\mathrm{n}}$ reflects the unavoidable internal shot-noise current $i_{\mathrm{n}}$. If the emitter current is quiet, so will be the resulting collector current $I_{\mathrm{C}}$.
entirely the emitter current at signal frequencies. In fact, it creates a grounded-emitter amplifier (rather than a current source or follower), in which the full input-noise voltage as given above (eq'n 8.25) is amplified by the transconductance $g_{m}$ to produce an output-noise current equal to $g_{m} e_{\mathrm{n}}$. And that is exactly the full (unsuppressed) shot noise corresponding to the dc collector current $I_{\mathrm{C}}$ (rewind to step \#2, above), which is what we measured in our test setup.

A final (and important) point: the shot-noise suppression in the current source requires a quiet emitter current sink, satisfied in this case by a large (compared with $r_{\mathrm{e}}$ ) pull-down resistor $R_{\mathrm{E}}$ (here 1 M versus 2.5 k ). But that's not the case for, say, an undegenerated current mirror. This raises the quantitative question, how large must $R_{\mathrm{E}}$ be, to be "large" in this sense?

This is easy enough to figure out: at the emitter we have a noise voltage $e_{\mathrm{n}}$ equivalent to the Johnson noise of a resistor of value $r_{\mathrm{e}} / 2$ and with source impedance equal to $r_{\mathrm{e}}$; i.e., a noise current equivalent to the Johnson-noise current of a resistor of value $2 r_{\mathrm{e}}$. This is diluted by the quiet (i.e., shot-noise-free) pull-down resistor $R_{\mathrm{E}}$, so that the reduction of current noise at the collector is in the ratio $\sqrt{2 r_{\mathrm{e}} / R_{\mathrm{E}}}$. For example, at 1 mA collector current we have an impedance seen at the emitter of $r_{\mathrm{e}}=25 \Omega$, with a noise voltage equivalent to that of a $12.5 \Omega$ resistor, or a noise current equivalent to that of a $50 \Omega$ resistor. So a $50 \Omega$ pull-down resistor reduces the noise by 3 dB , and a $4.95 \mathrm{k} \Omega$ pulldown reduces it by 20 dB , etc. Stated more generally, the reduction in collector noise current $i_{\mathrm{n}}$ is in the ratio $\sqrt{50 \mathrm{mV} / V_{\mathrm{R}_{\mathrm{E}}}}$, where $V_{\mathrm{R}_{\mathrm{E}}}$ is the dc voltage across the emitter pull-down resistor $R_{\mathrm{E}}$.

## 8.4 Finding $\mathbf{e}_{\boldsymbol{n}}$ from noise-figure specifications

Transistor datasheets traditionally provided some tabulated values for $e_{\mathrm{n}}$, and (often) graphs at selected collector currents of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus frequency (or $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus collector current at selected frequencies), as we've seen for the 2SD786 and the MPSA18.

That was then! Now you see instead tabulations and graphs of noise figure ( NF ) - see for example the contours of constant NF plotted against $I_{\mathrm{C}}$ and $R_{\mathrm{s}}$ for the lownoise 2SC3324 npn bipolar transistor ${ }^{29}$ from Toshiba (Figure 8.22).

There's a lot of information in these plots, even though they tell the story only at two frequencies $(10 \mathrm{~Hz}$ and 1 kHz ; it would sure be nice to see a plot of noise parame-

[^378]ters versus frequency). Let's see how much we can squeeze out of these two plots.

### 8.4.1 Step 1: NF versus $I_{C}$

We can make a plot of NF versus collector current, for each of a set of source resistances, by simply reading off values along a horizontal line in Figure 8.22. It's helpful to use a spreadsheet program with plotting capabilities such as Microsoft Excel, or (if you want to show off) a more sophisticated mathematical package such as MATLAB ${ }^{\circledR}$ or Mathematica ${ }^{\circledR}$. Figure 8.23 shows what you get by reading across the 1 kHz plot of Figure 8.22 for six values of source resistance. Here we estimated NF values for halfdecade steps of $I_{\mathrm{C}}$ (thus $10 \mu \mathrm{~A}, 30 \mu \mathrm{~A}, 100 \mu \mathrm{~A}$, and so on), plotted them in Excel, then smoothed them with Bézier curves in Adobe Illustrator ${ }^{\circledR}$. Noise-figure values below 1 dB should not be considered reliable, because Figure 8.22 (from which the data were derived) shows no contours below $\mathrm{NF}=1 \mathrm{~dB} .{ }^{30}$ The dashed line indicates $\mathrm{NF}=3 \mathrm{~dB}$, where the noise contributed by the transistor is equal to the Johnson noise in the source resistor.

Before moving on, let's get some intuition about these curves. For low values of $R_{\mathrm{S}}$ the source has low Johnsonnoise voltage (e.g., $R_{\mathrm{s}}=100 \Omega$ has $e_{\mathrm{n}}=1.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), quite a bit less than the transistor's input $e_{\mathrm{n}}$ at small collector currents. ${ }^{31}$ That's why the noise figure improves with increasing collector current. On the other hand, for large values of $R_{\mathrm{s}}$ the transistor's voltage noise is unimportant compared with the resistor's much larger Johnson noise. But now when we operate at large collector currents the transistor's input current noise (base current shot noise: $i_{\mathrm{n}} \approx \sqrt{2 q I_{\mathrm{B}}}$ ) generates a substantial noise voltage across that larger $R_{\mathrm{s}}$, such that the noise voltage at the input terminal is much larger than Johnson noise alone, hence a large (poor) noise figure.

### 8.4.2 Step 2: NF versus $\boldsymbol{R}_{\mathrm{s}}$

Figure 8.24 is an analogous plot, this time however showing NF versus source resistance (instead of $I_{\mathrm{C}}$ ) for each of

[^379]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0523.jpg?height=825&width=1588&top_left_y=246&top_left_x=155)

Figure 8.22. Toshiba's datasheet for its low-noise 2SC3324 npn transistor does not provide values or graphs for input voltage noise $e_{\mathrm{n}}$. Instead you get these graphs of noise figure (NF) versus collector current and source resistance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0523.jpg?height=573&width=799&top_left_y=1221&top_left_x=121)

Figure 8.23. 2 SC 3324 noise figure versus collector current, from the datasheet contour plots shown in Figure 8.22.
a set of collector currents; it is taken from the same 1 kHz contour curves of Figure 8.22, this time reading off values along vertical lines of constant $I_{\mathrm{C}}$. It's a useful graph for determining, approximately, the optimum operating current for a signal of a given source impedance.

### 8.4.3 Step 3: getting to $e_{n}$

The previous two graphs (NF versus $I_{\mathrm{C}}$, NF versus $R_{\mathrm{S}}$ ) are simply reorganizations of the manufacturer's 1 kHz noise
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0523.jpg?height=572&width=796&top_left_y=1219&top_left_x=977)

Figure 8.24. 2SC3324 noise figure versus source resistance, from the data of Figure 8.22.
figure contour plot (Figure 8.22). We didn't need to calculate anything.

That's not the situation with noise voltage, $e_{\mathrm{n}}$. Here we need to invert the defining equation (eq'n 8.13) for noise figure in order to find $e_{\mathrm{n}}$ :

$$
\begin{equation*}
e_{\mathrm{n}}=\sqrt{4 k T R_{\mathrm{s}}} \sqrt{10^{\mathrm{NF} / 10}-1} \tag{8.26}
\end{equation*}
$$

The first term is the signal source resistor's Johnson-noise voltage density, and the second term is the multiplying
factor attributable to the transistor's noise contribution, as given by its noise figure. The latter includes contributions from both $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$; so we must use the NF values for small source resistance so that the contribution from the transistor's $i_{\mathrm{n}}$ is negligible. ${ }^{32}$

Figure 8.25 shows what you get for $e_{\mathrm{n}}$ versus collector current, beginning with the noise-figure values corresponding to $R_{\mathrm{s}}=50 \Omega$ (from Figure 8.23 or 8.22 ). In common with most devices, this transistor exhibits the familiar "flickernoise" excess below its " $1 / f$ noise corner-frequency" (see §8.1.3, and also §5.10.6).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0524.jpg?height=560&width=795&top_left_y=710&top_left_x=220)

Figure 8.25. 2SC3324 noise voltage versus collector current, derived from the data of Figure 8.22.

### 8.4.4 Step 4: the spectrum of $e_{\mathrm{n}}$

We complained earlier about the lack of noise data versus frequency - it's given only for 10 Hz and 1 kHz . But we can fill in the details, on the reasonable assumption that the noise power at low frequencies goes approximately as $1 / f$ (that is, $e_{\mathrm{n}} \propto 1 / \sqrt{f}$ ), and that the two datapoints straddle the $1 / f$ noise corner-frequency.

To do this, we first find the $1 / f$ corner frequency $f_{\mathrm{c}}$ from the $e_{\mathrm{n}}$ values that straddle it. To a good approximation,

$$
\begin{equation*}
f_{\mathrm{c}}=f_{\mathrm{L}}\left(\frac{e_{\mathrm{nL}}^{2}}{e_{\mathrm{nH}}^{2}}-1\right) \tag{8.27}
\end{equation*}
$$

where $e_{\mathrm{nL}}$ is the noise density at a frequency $f_{\mathrm{L}}$ below the corner frequency, and $e_{\mathrm{nH}}$ is the noise density well above $f_{\mathrm{c}}$ (see the discussion on page 566). Once we've got $f_{\mathrm{c}}$, we can find $e_{\mathrm{n}}$ versus frequency:

[^380]\$\$

$$
\begin{equation*}
e_{\mathrm{n}}(f)=e_{\mathrm{nH}} \sqrt{1+f_{\mathrm{c}} / f} \tag{8.28}
\end{equation*}
$$

\$\$

Because the corner frequency depends on collector current, we read off $e_{\mathrm{nL}}$ and $e_{\mathrm{nH}}$ from Figure 8.25 for each of four decade values of $I_{\mathrm{C}}$, and then plot the corresponding $e_{\mathrm{n}}$ versus $f$. Figure 8.26 shows the resulting noise-voltage spectra.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0524.jpg?height=567&width=782&top_left_y=566&top_left_x=1076)

Figure 8.26. 2 SC 3324 noise voltage versus frequency, deduced from the curves of Figure 8.25.

### 8.4.5 The spectrum of $i_{n}$

By a similar procedure we could extract curves of current noise $i_{\mathrm{n}}$ versus frequency. Above the $1 / f$ corner we would see base-current shot noise $\left(i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{b}}}\right)$, with the characteristic $1 / f$ rise at low frequencies.

Once you've gotten plots of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus frequency, you have all the basic information contained within a noisefigure contour plot. Look ahead to §8.9.1E, and especially Figure 8.58, to see how you can use $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ to predict the total effective input noise density versus source resistance. The graphic shown in the upper left of that figure shows how to find the breakpoints that separate the $e_{\mathrm{n}}$-dominated (low- $R_{\mathrm{s}}$ ) region, the source Johnson-noisedominated (mid- $R_{\mathrm{s}}$ ) region, and the $i_{\mathrm{n}}$-dominated (high- $R_{\mathrm{S}}$ ) region. We prefer that simpler approach, and we'll be using $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ extensively in the rest of the chapter.

### 8.4.6 When operating current is not your choice

Knowing how $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ vary with collector (or drain) current helps in setting the operating point for optimum noise performance, as we'll see in the next section.

Sometimes, though, the choice has already been made, by person or persons unknown. In such a case you live with what you're given. Figure 8.27 shows an example, with published noise-figure contours for the Stanford Research Systems model SR560 preamplifier (§8.6.4). It's clear from the high input noise resistance ( $\sim 200 \mathrm{k} \Omega$ ) that this is a JFET-input amplifier, and that its noise performance is far from optimum with a source of low impedance: $\mathrm{NF}=15 \mathrm{~dB}$ for $R_{\mathrm{S}}=50 \Omega(!)$; compare that with the $\sim 2 \mathrm{~dB}$ noise figure of the 2 SC 3324 running at $I_{\mathrm{C}}=5 \mathrm{~mA}$.

What not to do OK, you say, I'll put a 200k resistor in series with the input signal, and, voilà, I'll get a 0.05 dB noise figure.
Don't do that! What you've done is to add lots of noise to the input signal, so that it dominates over the amplifier's noise. An amplifier like this is optimized for high- $Z$ signal sources and is far from optimum for $50 \Omega$ systems. What you can do, if you insist on using it with a $50 \Omega$ source, is to transform the source impedance upward by a modest factor with a signal transformer, for example a North Hills HB0904 ( $50 \Omega: 1200 \Omega$, with $1 \mathrm{kHz}-6 \mathrm{MHz}$ bandpass) or a Mini-Circuits T16-6T-X65 ((50 $\Omega: 800 \Omega$, with $30 \mathrm{kHz}-$ 75 MHz bandpass). This puts you in the $\sim 3 \mathrm{~dB}$ territory of noise figure, quite an improvement over the $\mathrm{NF}=15 \mathrm{~dB}$ you get with a bare $50 \Omega$ source. For more discussion of signal transformers, see §8.10.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0525.jpg?height=660&width=812&top_left_y=1443&top_left_x=117)

Figure 8.27. Noise figure versus frequency and source resistance for the SR560 low-noise preamp. (Courtesy of Stanford Research Systems.)

## 8.5 Low-noise design with bipolar transistors

The fact that $e_{\mathrm{n}}$ falls and $i_{\mathrm{n}}$ rises with increasing $I_{\mathrm{C}}$ provides a simple way to optimize transistor operating current to give lowest noise with a given source. Look at the model again (Figure 8.28). The noiseless signal source $v_{\mathrm{s}}$ has added to it an irreducible noise voltage from the Johnson noise of its source resistance:

$$
\begin{equation*}
e_{\mathrm{R}}^{2}(\text { source })=4 k T R_{\mathrm{S}} \quad\left(\mathrm{~V}^{2} / \mathrm{Hz}\right) \tag{8.29}
\end{equation*}
$$

The amplifier adds noise of its own, namely,

$$
\begin{equation*}
e_{\mathrm{a}}^{2}(\text { amplifier })=e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{s}}\right)^{2} \quad\left(\mathrm{~V}^{2} / \mathrm{Hz}\right) \tag{8.30}
\end{equation*}
$$

Thus the amplifier's noise voltage is added to the input signal, and, in addition, its noise current generates a noise voltage across the source impedance. These two are uncorrelated (except at very high frequencies), so you add their squares. The idea is to reduce the amplifier's total noise contribution as much as possible. That's easy, once you know $R_{\mathrm{S}}$, because you just look at a graph of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus $I_{\mathrm{C}}$ in the region of the signal frequency, picking $I_{\mathrm{C}}$ to minimize $e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{S}}\right)^{2}$. Alternatively, if you are lucky and have a plot of noise-figure contours versus $I_{\mathrm{C}}$ and $R_{\mathrm{s}}$, you can quickly locate the optimum value of $I_{\mathrm{C}}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0525.jpg?height=212&width=606&top_left_y=1241&top_left_x=1105)

Figure 8.28. Amplifier noise model.

### 8.5.1 Noise-figure example

As an example, suppose we have a small signal in the region of 1 kHz with source resistance of 10 k , and we wish to make a low-noise common-emitter amplifier with a 2 N 5087 . From the datasheet graphs of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus collector current (Figure 8.29), we see that the sum of voltage and current terms (with 10k source) is minimized for a collector current of about $20-40 \mu \mathrm{~A}$. Because the current noise is falling faster than the voltage noise is rising as $I_{\mathrm{C}}$ is reduced, it might be a good idea to use slightly less collector current, especially if operation at a lower frequency is anticipated ( $i_{\mathrm{n}}$ rises rapidly with decreasing frequency). We can estimate the noise figure using $i_{\mathrm{n}}$ and $e_{\mathrm{n}}$ at 1 kHz :

$$
\begin{equation*}
\mathrm{NF}=10 \log _{10}\left(1+\frac{e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{S}}\right)^{2}}{4 k T R_{\mathrm{S}}}\right) \mathrm{dB} \tag{8.31}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0526.jpg?height=1040&width=792&top_left_y=207&top_left_x=224)

Figure 8.29. Voltage and current noise versus frequency for the 2N5087 pnp transistor.

Reading from Figure 8.29, at $I_{\mathrm{C}}=20 \mu \mathrm{~A}, e_{\mathrm{n}}=3.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $i_{\mathrm{n}}=0.17 \mathrm{pA} / \sqrt{\mathrm{Hz}}$; and $4 k T R_{\mathrm{s}}=1.65 \times 10^{-16} \mathrm{~V}^{2} / \mathrm{Hz}$ for the 10 k source resistance. The calculated noise figure is therefore 0.42 dB . This is consistent with the datasheet's graph (Figure 8.30) showing NF versus frequency, in which they have chosen this operating current for $R_{\mathrm{S}}=10 \mathrm{k}$. This choice of collector current is also roughly what you would get from the graph in Figure 8.31 of noise-figure contours at 1 kHz , although the actual noise figure can be estimated only approximately from that plot as being slightly less than 0.5 dB .

Exercise 8.2. Find the optimum $I_{\mathrm{C}}$ and corresponding noise figure for $R_{\mathrm{S}}=100 \mathrm{k}$ and $f=1 \mathrm{kHz}$, using the graph in Figure 8.29 of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$. Check your answer from the noise-figure contours (Figure 8.31).

For the other amplifier configurations (follower, grounded base) the noise figure is essentially the same, for given $R_{\mathrm{S}}$ and $I_{\mathrm{C}}$, since $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ are unchanged. Of course, a stage with unity voltage gain (a follower) may just pass
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0526.jpg?height=509&width=797&top_left_y=220&top_left_x=1076)

Figure 8.30. Noise figure (NF) versus frequency, for three choices of $I_{\mathrm{C}}$ and $R_{\mathrm{s}}$, for the 2 N 5087 .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0526.jpg?height=542&width=832&top_left_y=869&top_left_x=1056)

Figure 8.31. Contours of constant narrowband noise figure for the 2N5087 transistor. (From the ON Semiconductor datasheet.)
the problem along to the next stage, ${ }^{33}$ since the signal level hasn't been increased to the point that low-noise design can be ignored in subsequent stages.

### 8.5.2 Charting amplifier noise with $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$

The noise calculations just presented, although straightforward, make the whole subject of amplifier design appear somewhat formidable. If you misplace a factor of Boltzmann's constant, you suddenly get an amplifier with a $10,000 \mathrm{~dB}$ noise figure! In this section we present a simplified noise-estimation technique of great utility.

The method consists of first choosing some frequency of interest in order to get values for $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus $I_{\mathrm{C}}$ from the transistor datasheets. Then, for a given collector current, you can plot the total noise contributions from $e_{\mathrm{n}}$ and

[^381]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0527.jpg?height=777&width=1142&top_left_y=364&top_left_x=378)

Figure 8.32. Total amplifier input voltage noise ( $e_{\mathrm{a}}$ ) plotted from the $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ parameters. The "total effective input noise" curve includes the Johnson noise from a resistive input source, i.e., $Z_{\mathrm{s}}=R_{\mathrm{s}}$.
$i_{\mathrm{n}}$ as a graph of $e_{a}$ versus source resistance $R_{\mathrm{S}}$. Figure 8.32 shows what that looks like at 1 kHz for an input stage using a 2N5087 pnp transistor running at $10 \mu \mathrm{~A}$ of collector current. The $e_{\mathrm{n}}$ noise voltage is constant, and the $i_{\mathrm{n}} R_{\mathrm{s}}$ voltage increases proportional to $R_{\mathrm{s}}$, i.e., with a $45^{\circ}$ slope. The amplifier noise curve is drawn as shown, with care being taken to ensure that it passes through a point 3 dB (voltage ratio of 1.4) above the crossing point of individual voltageand current-noise contributions. Also plotted is the noise voltage of the source resistance, which is also the 3 dB NF contour. The other lines of constant noise figure are simply straight lines parallel to this line, as you will see in the examples that follow.

The best noise figure $(0.65 \mathrm{~dB})$ at this collector current and frequency occurs for a source resistance of $42 \mathrm{k} \Omega$, and the noise figure is easily seen to be less than 3 dB for all source resistances between $2 \mathrm{k} \Omega$ and $1 \mathrm{M} \Omega$, the points at which the 3 dB NF contour intersects the amplifier noise curve.

The next step is to draw a few of these noise curves on the same graph, using different collector currents or frequencies, or maybe a selection of transistor types, in order to evaluate amplifier performance. Before we go on to do that, let's show how we can talk about this same amplifier
using a different pair of noise parameters, the noise resistance $R_{\mathrm{n}}$ and the noise figure $\mathrm{NF}\left(R_{\mathrm{n}}\right)$, both of which pop right out of the graph.

We'll have some fun with this technique later (§8.7), after we've learned about noise in JFETs, by refereeing over a world championship low-noise shootout between a best-in-class BJT (2SD786) and a comparably excellent JFET (2SK170).

### 8.5.3 Noise resistance

The lowest noise figure in this example occurs for a source resistance $R_{\mathrm{S}}=42 \mathrm{k}$, which equals the ratio of $e_{\mathrm{n}}$ to $i_{\mathrm{n}}$. That defines the noise resistance:

$$
\begin{equation*}
R_{\mathrm{n}}=\frac{e_{\mathrm{n}}}{i_{\mathrm{n}}} \quad \text { ohms. } \tag{8.32}
\end{equation*}
$$

You can find the noise figure for a source of that resistance from our earlier expression, eq'n 8.31, for noise figure:
$\mathrm{NF}\left(\right.$ at $\left.R_{\mathrm{n}}\right)=10 \log _{10}\left(1+1.23 \times 10^{20} \frac{e_{\mathrm{n}}^{2}}{R_{\mathrm{n}}}\right) \mathrm{dB} \approx 0.31 \mathrm{~dB}$.
Noise resistance isn't actually a real resistance in the transistor, or anything like that. It is a tool to help you quickly find the value of source resistance for minimum noise
figure, ideally so that you can vary the collector current to shift $R_{\mathrm{n}}$ close to the value of source resistance you're actually using. $R_{\mathrm{n}}$ corresponds to the point where the $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ lines cross.

The noise figure for a source resistance equal to $R_{\mathrm{n}}$ then follows simply from the preceding equation.

### 8.5.4 Charting comparative noise

It's easy to compare candidate transistors with this charting technique, plotting total amplifier noise for each of a selection of possible collector currents. We've done this in Figure 8.33, where we compare total amplifier noise (which includes source resistance Johnson noise) versus source resistance for the high-beta 2N5962 and the low$r_{\mathrm{bb}}$ ZTX851 npn transistors, using measured values of beta and $r_{\mathrm{bb}}$ listed in Table 8.1a on page 501. You can see that the high-beta part operated at low collector current is the clear winner for high source resistances, where its relatively high $r_{\mathrm{bb}^{\prime}}(480 \Omega)$ is harmless, being swamped by the Johnson noise of the signal source. By contrast, for low source resistances (say 1 k and below) the ZTX851's admirably low $r_{\mathrm{bb}}(\sim 1.7 \Omega)$ achieves the lowest noise, particularly when operated at a relatively high collector current to minimize the " $r_{\mathrm{e}}$ " noise term (recall that collectorcurrent shot noise through $1 / g_{m}$ produces a noise voltage density $e_{\mathrm{n}}$ equivalent to the Johnson noise of a resistor of value $r_{\mathrm{e}} / 2$, eq'n 8.20).

### 8.5.5 Low-noise design with BJTs: two examples

Let's put these ideas and equations to work, first by looking at a simple single-ended low-noise audio preamp that achieved popularity beginning in the 1980s, then by comparing with a classic differential design that addresses many of the shortcomings of the single-ended circuit.

#### A. The Naim preamp

Figure 8.34 shows the input stage used for many years in low-level preamps from the British manufacturer Naim Audio. It's an ac-coupled single-ended two-stage series feedback design (Figure 2.92), tailored for low input-noise voltage. The overall voltage gain is $G_{\mathrm{V}}=1+R_{\mathrm{f}} / R_{\mathrm{E}}$ (here 30 dB ), with $R_{\mathrm{E}}$ chosen rather small to keep its Johnson noise-voltage contribution down below a nanovolt per root hertz ( $15 \Omega$ has $e_{\mathrm{n}}=0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). The other significant noise term is the transistor's contribution from $r_{\mathrm{bb}}$, which is variously specified on datasheets either as an $e_{\mathrm{n}}$ value (at some specified collector current) or graph, or as a noisefigure value or graph, or (rarely) as a value for $r_{\mathrm{bb}^{\prime}}$ itself; or
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0528.jpg?height=1042&width=809&top_left_y=221&top_left_x=1065)

Figure 8.33. Comparing the total amplifier input-noise voltage versus source resistance of two candidate low-noise BJTs. The curves plot five decade values of collector current. For low source resistances the ZTX851's low $r_{\mathrm{bb}}$ yields low noise at high collector currents; by contrast, the 2N5962's higher $r_{\mathrm{bb}}$ limits the ultimate noise voltage, but its higher beta (thus lower base-current shot noise, $\left.\sqrt{2 q I_{\mathrm{C}} / \beta}\right)$ results in improved performance with high source resistances. These curves include the Johnson noise of the source resistance.
(worst of all) perhaps none of these. For the "Low Noise" ZTX384C used in this preamp, the datasheet is rather, uh, taciturn, revealing only that $\mathrm{NF}=4 \mathrm{~dB}$ (max) from $30 \mathrm{~Hz}-$ 15 kHz for $R_{\mathrm{S}}=2 \mathrm{k}$ and $I_{\mathrm{C}}=0.2 \mathrm{~mA}$. This is not terribly helpful, because that corresponds to a seriously large Johnsonnoise voltage of $6.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

The fact is that these amplifiers were pretty quiet. One reason is that worst-case specifications of difficult-tomeasure parameters tend to be overly pessimistic. For example, the contemporary low-noise npn 2SC3324 specifies (for a particular test condition) $\mathrm{NF}=3 \mathrm{~dB}$ (max), but 0.2 dB (typ). Naim may have selected parts for low noise. The other reason is that Naim's circuit actually uses five transistors in parallel (each with a $15 \Omega$ emitter ballasting resistor) for $Q_{1}$, which drives down its noise voltage by a factor
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0529.jpg?height=661&width=753&top_left_y=190&top_left_x=144)

Figure 8.34. Low-level audio preamp, similar to that used in the NAIM NA323. $Q_{1}$ is made from a parallel connection of four or five selected transistors.
of $\sqrt{5}$. Bottom line: this preamp's noise was likely in the neighborhood of $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, as befits a preamp designed for the low signal levels characteristic of the moving-coil phono cartridges for which it was optimized.

This circuit is simple; but there are tradeoffs caused by the small $R_{\mathrm{E}}$ that was chosen for low noise. It makes the bias scheme somewhat problematical, with the bias divider $R_{1} R_{2}$ acting more as a current source (compared with the classic voltage biasing, for example as in Figure 2.35), thus making the quiescent operating point rather dependent on $Q_{1}$ 's beta. The low value of $R_{\mathrm{E}}$ also results in a low input impedance, owing to the required stiff bias divider's impedance of $3.2 \mathrm{k} \Omega$. ${ }^{34}$

#### B. A better design: dc-coupled differential preamp

Many of the shortcomings of the Naim preamp are nicely addressed in the dc-coupled differential preamp shown in Figure 8.35, which retains the former's desirable low-noise performance. It's basically the classic 2-stage op-amp configuration (e.g., Figures 4.43 or 2.91), here simplified with a single-ended class-A output stage with current-sink active load (with the assumption that the next stage will not require substantial drive current).

This circuit eliminates electrolytic blocking capacitors, both at the input and in the gain-setting feedback divider $R_{1} R_{2}$; it minimizes Early effect nonlinearity in the input stage; and its use of active (current-source) loads both

[^382]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0529.jpg?height=830&width=796&top_left_y=207&top_left_x=977)

Figure 8.35. A low-noise dc-coupled audio preamplifier with predictable biasing.
improves its overall linearity (through improved singlestage linearity, plus higher loop gain) and provides stable and predictable biasing. The price you pay in exchange is small: increased circuit complexity, and the 3 dB increase in noise (owing to $Q_{2}$ 's contribution). At these collector currents the noise is dominated by the Johnson noise of the base resistance $r_{\mathrm{bb}^{\prime}}$. So, as with the Naim amplifier, the input transistors could be implemented as a parallel array of matched- $V_{\mathrm{BE}}$ transistors (even if single transistors are used, the pair should be matched to $\sim 10 \mathrm{mV}$ or so), or (better) implemented with larger die-size transistors with lower $r_{\mathrm{bb}} \cdot{ }^{35}$

### 8.5.6 Minimizing noise: BJTs, FETs, and transformers

Bipolar transistor amplifiers can provide very good noise performance over the range of source impedances from about $200 \Omega$ to $1 \mathrm{M} \Omega$, with corresponding optimum collector currents generally in the range of several milliamps down to a microamp. (With low source impedances you want to minimize $e_{\mathrm{n}}$, whereas with high source impedances

[^383]you want to minimize $i_{\mathrm{n}}$; as we've seen, that dictates high and low collector current, respectively).

If the source impedance is high, say greater than 100k or so, transistor current noise dominates, and the best device for low-noise amplification is a FET. Although their voltage noise is usually greater than that of bipolar transistors, the gate current (and its noise) can be exceedingly small, making them ideally suited for low-noise high-impedance amplifiers. We'll dive into FET noise shortly (§8.6), after an entertaining "challenge" interlude.

For very low source impedances (say $50 \Omega$ ), transistor voltage noise will always dominate, and noise figures will be poor. One approach in such cases is to use a signal transformer to raise the signal level (and impedance), treating the signal on the secondary as before. Transformers have their drawbacks, of course: they're ac coupled; they operate over only a few decades of bandwidth (and never to dc); those intended for low-frequency operation are bulky and expensive and exhibit nonlinearities; and they are susceptible to magnetic pickup. Nevertheless, they can be the magic sauce when you're dealing with a low impedance signal (say less than $100 \Omega$ ); see §8.10.

### 8.5.7 A design example: 40¢ "lightning detector" preamp

Here's an interesting design challenge, and a chance to exercise some of our noise theory. Imagine we want to manufacture an inexpensive photodiode amplifier that runs on low current from a 9 V battery, with input noise of just a few $\mathrm{nV} / \sqrt{\mathrm{Hz}}$, and with response time of a few microseconds. You can think of this as a simple "lightning detector," because lightning is almost unique in delivering microsecond-scale pulses of light in the outdoor environment. ${ }^{36}$ In a fully refined implementation this could serve as a useful early warning device to install in locations where you'd want to be indoors when the sky is becoming electric - golf courses, harbors, soccer fields, etc.

[^384]Here we explore the basics, a launching point to inspire the electronic hobbyist. It will turn out that we can do the job with standard parts, for a total component cost (in 1000piece quantities) of just $\$ 0.40$. It will be a "throwaway" device, manufactured in the millions, with commensurate profits and fame (dream on!). Let's take it in easy stages, as shown in Figures 8.36A-E (similarly labeled in the following paragraphs).
A. Block diagram We back-bias the PIN photodiode to lower its capacitance (thus lower noise and faster response), and we use a blocking capacitor into the summing junction of a transimpedance stage to eliminate the dc level from ambient light and leakage current. The feedback resistor $R_{\mathrm{f}}$ sets the gain ( $G=-R_{\mathrm{f}}$ volts/amp).
B. Discrete design, first iteration We need inverting feedback, so we begin with a grounded-emitter stage $\left(Q_{1}\right)$, with an emitter follower $\left(Q_{3}\right)$ to create a low-impedance output and feedback source.
C. Add cascode This circuit will be running at low currents ( 0.1 mA or so), thus relatively high impedances at which Miller effect causes a significant bandwidth reduction. So we add a cascode $\left(Q_{2}\right)$ atop the gain stage's collector.
D. Inverted cascode A 9 V battery is down to 6 V at end-of-life, so now we're running out of headroom! We want to keep plenty of dynamic range, so we fix this problem by turning the cascode around, creating an "inverted cascode," in which collector current variations in $Q_{1}$ pass through $p n p$ cascode transistor $Q_{2}$, while the latter continues to clamp $Q_{1}$ 's collector voltage. The output follower plays a dual role here, with its $V_{\mathrm{BE}}$ setting $Q_{2}$ 's collector current: $I_{\mathrm{C} 2}=V_{\mathrm{BE} 3} / R_{3}$.

#### E. Front-end follower and input current noise At

the $\sim 50 \mu \mathrm{~A}$ collector current in $Q_{1}$ that we'll need to get sufficient bandwidth, there would be too much current noise at the input. (Remember that the input signal is a current.) So we add a high-beta follower $\left(Q_{4}\right)$ and choose a collector current of $1 \mu \mathrm{~A}$ as an initial trial value. We also choose a large feedback resistor $R_{2}$ to minimize its noise current as seen at the input, with shunt capacitance $C_{\mathrm{c}}$ to limit the bandwidth to 100 kHz . The idea is to calculate the input noise to see where the dominant contribution comes from, then iterate the design toward an optimum. We've filled in component values for an initial design.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0531.jpg?height=2004&width=1542&top_left_y=192&top_left_x=198)

Figure 8.36. Tutorial evolution of a low-noise and low-power photodiode amplifier built with low-cost discrete components. Apart from $Q_{1}$ and the photodiode, all parts are available in surface-mount packages (prepend "MMBT" to transistor part numbers, e.g., MMBT5089).

Calculating the noise performance Let's estimate the noise current at the input; that's what competes with the (current) signal from the photodiode. There's shot noise in $Q_{4}$ 's base current, and there's Johnson-noise current from the feedback resistor $R_{2}$ and the photodiode bias resistor $R_{\mathrm{b}}$. In addition, we have to worry about noise voltage at the input: in combination with the input capacitance $C_{\text {in }}$ it creates an input noise current $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\text {in }}$ (as we'll see in detail in §8.11). Input noise voltage is the combined $e_{\mathrm{n}}$ contributions of $Q_{1}$ and $Q_{4}$, each having Johnson noise in their $r_{\mathrm{bb}^{\prime}}$ and collector shot noise through their $r_{\mathrm{e}}$. Let's take these in turn.

Noise current Estimating $Q_{4}{ }^{\prime} \mathrm{s} \beta \approx 350$ at its $1 \mu \mathrm{~A}$ collector current, we find that its base current of 3 nA creates a shot-noise density $i_{\mathrm{n}(\text { shot })}=\sqrt{2 q I_{\mathrm{B}}}=30 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. Feedback resistor $R_{2}$ and bias resistor $R_{\mathrm{b}}$ create a Johnson-noise current $i_{\mathrm{n}(\mathrm{R})}=\sqrt{4 k T / R}=57 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. These combine (square root of sum-of-squares) to create $i_{\mathrm{n}}($ total $)=65 \mathrm{fA} / \sqrt{\mathrm{Hz}}$.

Noise voltage Emitter follower $Q_{4}$, running at $1 \mu \mathrm{~A}$, generates a shot noise voltage across its $r_{\mathrm{e}}$ of $e_{\mathrm{n}(\text { shot } 4)}=r_{\mathrm{e}} \sqrt{2 q I_{\mathrm{C}}}=14.3 \mathrm{nV} / \sqrt{\mathrm{Hz}} . \quad$ Its internal base resistance of $\sim 300 \Omega$ adds a relatively insignificant Johnson-noise voltage $e_{\mathrm{n}(\mathrm{J} /)}=\sqrt{4 k \operatorname{Tr}_{\mathrm{bb}^{\prime}}}=2.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, for a combined $e_{\mathrm{n} 4}=14.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

Grounded-emitter amplifier $Q_{1}$, running at nominal $40 \mu \mathrm{~A}$ and with an $r_{\mathrm{bb}}$ of $\sim 300 \Omega$, generates corresponding noise voltages $e_{\mathrm{n}(\text { shotl })}=r_{\mathrm{e}} \sqrt{2 q I_{\mathrm{C}}}=2.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $e_{\mathrm{n}(\mathrm{JI})}=\sqrt{4 k T r_{\mathrm{bb}^{\prime}}}=2.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, for a combined $e_{\mathrm{n} 1}=3.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

Combining the noise voltages of $Q_{1}$ and $Q_{4}$, we find ${ }^{37}$ $e_{\mathrm{n}}($ total $)=14.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Evidently $Q_{4}$ is the big noise gorilla in the room here; but let's continue with the analysis.

In combination with the input capacitance of $\sim 10 \mathrm{pF}$ ( 5 pF for the photodiode, 2.5 pF for $Q_{4}$ 's $C_{\mathrm{cb}}$, and 2.5 pF for wiring capacitance) that noise voltage creates an effective input-current noise (\$8.11.3)of $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}=90 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, if we take for $\omega$ a characteristic frequency of 100 kHz .
Verifying feedback stability This is a feedback circuit, with the ever-present potential for oscillation. And, in a transresistance configuration like this, the shunt capacitance at the input combines with the large-value feedback resistor to introduce an additional lagging phase shift. We deal with this in detail in $\S \S 4 x .3$ and 8.11 ; the criterion for stability is that the open-loop amplifier's unity-gain bandwidth must satisfy

[^385]\$\$

$$
\begin{equation*}
f_{\mathrm{T}}(\text { open-loop })>f_{\mathrm{R}_{2} \mathrm{C}_{\mathrm{c}}}^{2} / f_{\mathrm{R}_{2} \mathrm{C}_{\mathrm{in}}} . \tag{8.33}
\end{equation*}
$$

\$\$
(Stated differently, the feedback network's -3 dB rolloff frequency must be less than the geometric mean of (a) the amplifier's open-loop unity-gain frequency and (b) the -3 dB rolloff frequency of the feedback resistor in combination with the input capacitance.)

So, for the circuit of Figure 8.36E we require $f_{\mathrm{T}}$ (open-loop) $>106 \mathrm{kHz}^{2} / 1.6 \mathrm{kHz}$, or 7 MHz . We estimate the amplifier's open-loop unity gain as follows.
(a) The low-frequency voltage gain is $G=g_{m 1} R_{\text {load }}$, where $R_{\text {load }}$ is the impedance seen at cascode transistor $Q_{2}$ 's collector.
(b) The latter is $R_{\text {load }}=R_{4} \cdot g_{m 3} R_{3} \approx 1.3 \mathrm{M} \Omega$, so the lowfrequency open-loop gain $G_{\text {OL }}$ ranges from 1000 to 3000 for $Q_{1}$ collector currents from $20 \mu \mathrm{~A}$ to $60 \mu \mathrm{~A}$, (battery voltage from 6 V to 9 V ), respectively.
(c) This gain rolls off at $6 \mathrm{~dB} /$ octave, starting at a frequency set by $R_{\text {load }}$ in combination with the capacitance seen at $Q_{2}$ 's collector; taking $C_{\mathrm{cb}} \sim 2.5 \mathrm{pF}$ for each of $Q_{2}$ and $Q_{3}$, that's $f_{3 \mathrm{~dB}}=25 \mathrm{kHz}$.
(d) That brings the amplifier's open-loop gain down to unity at about 25 MHz (for $Q_{1}$ 's minimum collector current), a good margin of stability given our 7 MHz requirement.

The cascode was essential for getting this bandwidth at these low currents. Without it the gain stage $\left(Q_{1}\right)$ would see its load capacitance multiplied by the voltage gain of 1000 , owing to Miller effect. ${ }^{38}$

Optimization The contributions from amplifier noise currents $(65 \mathrm{fA} / \sqrt{\mathrm{Hz}})$ and from noise voltage generating noise current through the input capacitance $(90 \mathrm{fA} / \sqrt{\mathrm{Hz}})$ are in the same ballpark. The latter rises proportional to frequency, and dominates, slightly, at the high-frequency end of the bandpass; but when integrated over the amplifier's passband, the two noise terms contribute comparable integrated noise, totaling approximately $I_{\mathrm{n}}=30 \mathrm{pArms}$ (therefore 0.3 mVrms at the amplifier's output).

The lion's share of the noise current, then, comes from the 10M gain-setting and biasing resistors. These could be raised in value, though $R_{\mathrm{b}}$ must not be so large that the photodiode saturates in nighttime ambient light. The latter problem could be circumvented by sensing the voltage at the photodiode and using it to control a quiet biasing current source. If the resistor noise were brought down

[^386]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0533.jpg?height=621&width=792&top_left_y=220&top_left_x=140)

Figure 8.37. Replacing Figure 8.36's BJT input transistor with a low-capacitance JFET reduces input noise voltage and noise current by a factor of 3 .
enough, the dominant remaining noise source would be $Q_{4}$, whose voltage noise (multiplied by $\omega C_{\text {in }}$ ) and current noise are comparable. Raising its operating current reduces its voltage noise, but increases its current noise. We seem to be stuck.

But no, we're not! If we replace the BJT input follower with a low-capacitance JFET (Figure 8.37), we can score a significant improvement. The voltage noise of a 2N5484 ( $C_{\mathrm{in}} \approx 2.2 \mathrm{pF}$ ) running at $50 \mu \mathrm{~A}$ is about $e_{\mathrm{n}}=5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (based on measurements at $100 \mu \mathrm{~A}$ ), and its current noise is negligible; so we reduce the transistor noise contribution by a factor of 3 (for an additional cost of 5-10 cents). Of course, this makes sense only if the $R_{\mathrm{b}}$ and $R_{2}$ Johnsonnoise contributions can be reduced by at least a factor of 4. With those improvements the amplifier's total integrated input noise becomes $I_{\mathrm{n}} \approx 10 \mathrm{pArms}$. That's comparable to shot noise in the photodiode's leakage current ( 3 nA , typ, at -10 V and $\left.25^{\circ} \mathrm{C}\right)-$ no point in grooming the amplifier further.

We take up the subject of low-noise design with JFETs shortly, in §8.6.

### 8.5.8 Selecting a low-noise bipolar transistor

It's important to select the right transistors, and appropriate operating currents, in order to optimize a circuit's lownoise performance. This task has been made more difficult as some of the finest low-noise favorites have been recently discontinued by one manufacturer after another (most of these came in through-hole packages, not favored for machine assembly). Often this means you can't simply choose a part used in someone else's good design. The task is made difficult also by the lack of relevant information
in datasheets - noise-voltage curves, or even a mention of noise voltage is the exception in most contemporary BJT datasheets. We come to your rescue with Tables 8.1a,b, where we've listed a range of good candidate transistors, ${ }^{39}$ along with measured noise parameters such as $e_{\mathrm{n}}, r_{\mathrm{bb}}, V_{\mathrm{A}}$ (Early voltage), and plots of beta versus collector current. Herewith a guide to the table, and to the task of selecting and using a low-noise transistor. ${ }^{40}$

The beta or $h_{\mathrm{FE}}$ column shows the manufacturer's stated minimum values. While the typical beta is often much higher, you have to accept the reality that a minimum-beta part may end up in your circuit (unless you are willing to screen incoming parts). The manufacturer's beta specs are often at higher currents than you'll be using, and the beta may be severely degraded at lower currents, see the discussion of recombination and Gummel plots in $\S 2 x .13$. To see which transistors are susceptible to this, we measured beta versus collector current, going from $1 \mu \mathrm{~A}$ to 100 mA , with the results shown in Figure 8.39 (with corresponding labels in the Beta plot column of Tables 8.1a,b). The falloff of beta at low current is summarized in the Linearity column in the table, rating the transistors on a scale of 1 (large beta falloff at microamp currents) to 5 (beta does not change with current). Note how some parts run out of steam at currents above 1 mA ; these are small-die parts running at high current density. Keep in mind our measurements were taken at $V_{\mathrm{CE}}=5 \mathrm{~V}$, and that the high-current beta of some BJTs falls rapidly at lower collector voltages (a saturation effect). ${ }^{41}$ Our measured plots go to 50 mA , but the datasheets of some larger-die parts (like the ZTX851) provide curves of beta going as high as 10 A .

Some BJT types are measured by the manufacturer and
${ }^{39}$ In many cases these transistors are not promoted by the manufacturer as "low noise." We made some guesses, then ordered and tested samples of some 100 different types.
${ }^{40}$ Some advice about finding parts. It's helpful to search using the inner (numeric) portion of the part name, because there may be versions with differing prefixes or suffixes. You'll have an easier time finding surface-mount parts than through-hole parts - see the notes in the SOT-23 column of Table 8.1a. Some parts are stocked only at specialty suppliers, such as B\&D Enterprises, MCM, Donberg Electronics, Encompass, and Littlediode. Discontinued parts may also be available on eBay, in small quantities suitable for making specialized laboratory instruments. Some large Pacific rim distributors have good older-part inventory and sell from their websites, through Alibaba, or on eBay. The Sanyo four parts near the bottom of the table have been discontinued, but they make other parts that may offer similar performance.
${ }^{41}$ We've not provided measurements of beta at lower voltages, but we are confident that the low-noise winners (the npn ZTX851 and pnp ZTX951) do very well in this respect, having been designed as highcurrent transistors with low saturation voltage.

Table 8.1a Low-noise BJTs ${ }^{a}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0534.jpg?height=1682&width=1462&top_left_y=261&top_left_x=315)

Manufacturers: A - Analog Devices, C - Central, D - Diodes, Inc., H - Renesas, I - Infineon, In - Intersil, L - Linear Integrated Systems, m - many, N - NSC, O - ON Semi, R - Rohm, S - Sanyo (ON Semi), Th - THAT, T - Toshiba, Z - Zetex (Diodes, Inc.).
Names \& Packages: a - available, see datasheet for part numbers, most are pinout B. b - for TO-92 try BC550 and BC560, both pinout C. c - CMPTxxx, d - SOT-89, f - FMMTxxx, m - MMBTxxx, p - PMBTxxx or PMSTxxx, v - ATV, z - FZTxxx.
Notes: $\diamond=\sqrt{ } \mathrm{Hz}$. (a) listed in order of decreasing $r_{b b}$ : (b) complement available, see datasheet. (c) complements grouped together. (d) from datasheet. (e) ranking of beta constancy over collector current, ranked on a scale from 1 to 5 (best). (f) lower $1 / f$ noise and $e_{n}=0.21 \mathrm{nV} / \sqrt{ } \mathrm{Hz}$ at $I_{C}=10 \mathrm{~mA}$. ( g ) discussed extensively in this chapter's section "Finding $e_{\mathrm{n}}$ from noise figure." (m) maximum. (o) collector current $l_{c}$ at which the $r_{\text {e }}$ noise contribution raises the irreducible $r_{b b}$ ' Johnson noise voltage by $50 \%$; corresponding values of $e_{\mathrm{n}}, i_{\mathrm{n}}$, and $R_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$ are listed. ( r ) ON Semi BC550C datasheet has $r_{b \mathrm{~b}}=170 \Omega$ plot (drops $25 \%$ from 0.1 to 10 mA ). (s) 2N5550 is lower-beta version. (t) typical. (u) see figure. (v) video transistor, included for its low $C_{\mathrm{cb}}$. (x) discontinued, included for comparison. (y) measured on a 2SA1162-Y. (z) measured beta 25 .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0535.jpg?height=733&width=799&top_left_y=220&top_left_x=121)

Figure 8.38. Pinouts for the BJTs in Table 8.1a.
binned into beta categories. For example the BC850 has A, B , and C grades, with typical betas at 2 mA of 180,290 , and 520, respectively. It's tempting to go for the highest-grade part in your design, but often you'll find no availability at the distributors. The higher beta grades also suffer from degraded noise performance, lower $V_{\text {CEO }}$ ratings and lower Early voltages (i.e., lower output impedances). ${ }^{42}$

Looking at the BC850 again, you see that it's a smallarea transistor that you'd probably use at much lower currents than the 2 mA at which its beta is specified; so it's nice to see in Figure 8.39 that its beta drops by less than $10 \%$ at $1 \mu \mathrm{~A}$, compared, say, with the 2 N 5962 , whose beta drops by $50 \%$. The popular npn 2N3904 holds steady, but the beta of its pnp sibling 2N3906 drops by a factor of 3 over four decades of current, a common situation with pnp parts. However, there's plenty of good news: the betas of the pnp BC860 and ZTX718 drop less than $20 \%$ at $1 \mu \mathrm{~A}$ and the beta of the lower-gain 2N5087 is flat clear down to $1 \mu \mathrm{~A}$.

Before discussing the all-important noise measurements, let's look at the Early voltage, or $V_{\mathrm{A}}$ column. Look back to $\S \S 2.3 .2$ and $2 x .8$ for a discussion of the

[^387]Table 8.1b Dual Low-noise BJTs ${ }^{a}$

| Dual part \# | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0535.jpg?height=110&width=49&top_left_y=308&top_left_x=1143) | Single part \#, etc. | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0535.jpg?height=124&width=93&top_left_y=294&top_left_x=1333) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0535.jpg?height=124&width=40&top_left_y=294&top_left_x=1421) | Noise ${ }^{\mathrm{X}}$ |  |  | Match ${ }^{\text {m }}$ |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  |  | $\begin{gathered} e_{n} @ \\ (n V / \Delta) \end{gathered}$ | (c) <br> (mA) | $r_{b b^{\prime}}$ ( $\Omega$ ) |  |  |
| BCM847 | I | BC850B | N 45 | 37 | 3.3 | 1 | 650 | 2 | 10 |
| BCM857 | I | BC860B | P 50 | 17 | 3.1 | 1 | 590 | 2 | 10 |
| LS301 | L | - | N 18 | - | - | - | - | 1 | 5 |
| IT124 | L | - | N 2 | - | - | - | - | 5 | 10 |
| CMKT5089M | C | 2N5089 | N 25 | 38 | 2.2 | 10 | 291 | 5 | 10 |
| DMMT3904 | D | 2N3904 | N 40 | 31 | - | - | - | 1 | 2 |
| DMMT3906 | D | 2N3906 | P 40 | 3 | - | - | - | 1 | 2 |
| DMMT5551 | D | 2N5551 | N 160 | 25 | - | - | - | 1 | 2 |
| DMMT5401 | D | 2N5401 | P 160 | 2 | - | - | - | 1 | 2 |
| LM394C | N | obsolete | N 20 | 40 | 1.8 | 0.1 | 60 | 0.2 | 5 |
| MAT12 | A | - | N 40 | - | 0.85 | 1 | 28 | 0.2 | 5 |
| HFA3134 | In | $f_{\mathrm{T}}=8 \mathrm{GHz}$ | N 12 | - | 0.8 | 1 | 40 | 6 | 8 |
| HFA3135 | In | $f_{\mathrm{T}}=7 \mathrm{GHz}$ | P 12 | - | 1.3 | 1 | 105 | 6 | 8 |
| SSM2212 | A | - | N 40 | - | 0.85 | 1 | 28 | 0.2 | 5 |
| SSM2220 | A | - | P 36 | - | 0.7 | 1 | 25 | 0.2 | 6 |
| THAT 300 | Th | four npn | N 36 | - | 0.9 | 1 | 30 | 3 | 4 |
| THAT 320 | Th | four pnp | P 36 | - | 0.75 | 1 | 25 | 3 | 5 |
| HN3C51F | T | 2SC3324 | N 120 | - | 0.78 | 10 | 35 | - | - |
| HN3A51F | T | 2SA1312 | P 120 | - | 0.28 | 10 | 20 | - | - |

Notes: ( $\downarrow$ ) square-root Hz. (a) see Table 8.2a for single BJTs. (b) see footnotes in Table 8.2a. (m) maximum. (x) measured.

Early effect. The Early voltage $V_{\mathrm{A}}$ provides an estimate of the BJT's output conductance (and output impedance): $g_{\text {oe }}=1 / r_{\mathrm{o}}=I_{\mathrm{C}} /\left(V_{\mathrm{A}}+V_{\mathrm{CE}}\right)$. We can also estimate a maximum possible single-stage gain (that is, with $R_{\mathrm{L}}=\infty$ ), $G_{\max }=g_{m} / g_{\text {oe }}$. By substituting $g_{m}=I_{\mathrm{C}} / V_{\mathrm{T}}$, we get (ignoring $V_{\mathrm{CE}}$ compared with the usually much larger $V_{\mathrm{A}}$ ) $G_{\text {max }}=V_{\mathrm{A}} / V_{\mathrm{T}}$.

While it's possible to overcome the drawbacks of a low Early voltage, for example by adding a cascode stage (see $\S \S 2.4 .5 \mathrm{~B}$ and $3 x .4$ ) or by adding emitter degeneration, it's frequently convenient not to have to do so. For such applications it's best to restrict your choices to BJTs with relatively high $V_{\mathrm{A}}$. As the entries in Table 8.1a demonstrate, though, the $p n p$ member of an $n p n-p n p$ complementary pair (they're grouped together in the table) usually suffers from dramatically lower Early voltages; e.g., the pnp BC860C has $V_{\mathrm{A}}=30 \mathrm{~V}$ compared with the $n p n$ BC850C's value of 220 V . This is unfortunate, because pnp transistors are useful in current mirrors for npn differential amplifiers, where their low Early voltage greatly reduces the stage gain. The problem can be solved in several ways, for example by adding emitter degeneration in the pnp mirror, as in Figure 8.35, or by using a Wilson mirror.

Looking at the table's maximum collector voltage ( $V_{\mathrm{CEO}}$ ) values, we see many low-noise BJTs with ratings
of 120 V or more, leading us to wonder why they have such a high voltage rating. Could it be to achieve a high Early voltage? Perhaps, but it's been observed that highvoltage "video-output" transistors often exhibit admirably low noise voltage. For example, Sanyo's 2 SC3601 has a very low measured $e_{\mathrm{n}}$ of $0.22 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, with an $r_{\mathrm{bb}^{\prime}}$ of $1.7 \Omega .{ }^{43}$

In general, high voltage transistors have lower betas; for example, the 300 V MPSA42 (\#20 on our graph), has the lowest gain. A contender for the part with highest beta, the Linear Integrated Systems' IT124 (based on an old Intersil part), suffers from a $V_{\text {CEO }}$ rating of just 2 V (!) in exchange for its superbeta gain. Happily, they've morphed the design into their LS301 with an 18 V rating, and it wins the beta contest (curve \#44) with an astonishing $\beta=3000$ at $1 \mu \mathrm{~A} .{ }^{44}$

A significant task is choosing the transistor's operating current. It's tempting to scan down the table's "Noise parameters" columns and pick a part near the bottom with an $e_{\mathrm{n}}$ under $0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. But watch out for the high basecurrent noise that these transistors create, when operated at the relatively high collector currents needed for those low $e_{\mathrm{n}}$ values. For example, the winning ZTX851 has a very attractive $e_{\mathrm{n}}=0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at $I_{\mathrm{C}}=10 \mathrm{~mA}$. But, with its $\beta$ of 220 (see Figure 8.39), its base current of $45 \mu \mathrm{~A}$ creates an input noise current $i_{\mathrm{n}}\left(=\sqrt{2 q I_{\mathrm{C}}}\right)$ of $3.8 \mathrm{pA} / \sqrt{\mathrm{Hz}}$. That sounds small - but it creates an additional voltage noise of $0.19 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ across even a low $50 \Omega$ source impedance, adding 3 dB to the transistor's input noise voltage. The problem only gets worse with higher source impedances, because the added $i_{\mathrm{n}} Z_{\mathrm{s}}$ noise voltage grows linearly with source impedance, compared with Johnson noise from a resistive source (which grows as the square root of $R_{\mathrm{s}}$ ) ${ }^{45}$ For example, this base current noise creates $2.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ with a $600 \Omega$ source impedance.

We took the table's noise measurements at high-enough currents to eliminate the $I_{\mathrm{C}}$ term in the BJT noise equation $e_{\mathrm{n}}=\left[4 k T\left(r_{\mathrm{bb}^{\prime}}+0.5 V_{\mathrm{T}} / I_{\mathrm{C}}\right)\right]^{\frac{1}{2}}$ (see Figure 8.10), because we wanted to expose their $r_{\mathrm{bb}}$ values. But usually you'll want to operate at lower currents. For example, reducing the ZTX851's current to 1 mA raises the noise voltage

[^388]by a factor of 2.3 (to $0.48 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), but the decrease in base current (to $5 \mu \mathrm{~A}$ ) lowers the noise current by a factor of 3.2 , to $1.2 \mathrm{pA} / \sqrt{\mathrm{Hz}}$. At this lower current the $i_{\mathrm{n}} R_{\mathrm{s}}$ noise-voltage contribution drops to $0.72 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for a $600 \Omega$ source impedance, for a total amplifier noise of $0.86 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, considerably lower than the $2.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 mA collector current, and nicely lower than the $3.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of $600 \Omega$ resistive Johnson noise. Sometimes you may want to operate at a really low current, where the $r_{\mathrm{e}}\left(=V_{\mathrm{T}} / I_{\mathrm{C}}\right)$ term dominates and the contribution of the $r_{\mathrm{b} b^{\prime}}$ term is insignificant.

The measured noise that is listed in Table 8.1a is based on a small sampling of contemporary parts. Because some of these parts are not specifically intended for low-noise applications, the manufacturer does not specify (or control) their noise properties. It is important to keep this in mind, because you may encounter batches of parts with degraded noise. Figure 8.40 shows an example: four parts from a single batch of power transistors of a type that have been favored by audio enthusiasts, but which exhibited disappointingly wide variation in low-frequency noise voltage.

These tradeoff considerations were discussed at length in $\S 8.5$, and they're illustrated in Figure 8.32, where the concept of a transistor's noise resistance $R_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$ is shown. Look back at Figure 8.33, where we compared the voltage noise of the small-die high-beta 2N5962 with that of the large-die low- $r_{\mathrm{bb}^{\prime}}$ ZTX851, at collector currents ranging from $1 \mu \mathrm{~A}$ to $10 \mathrm{~mA} .{ }^{46}$ The ' 851 outperforms the ' 5962 for source impedances of less than $1 \mathrm{k} \Omega$ when operated at a collector current of $100 \mu \mathrm{~A}$ or more. Conversely, the ' 5962 beats the ' 851 for source impedances above 100k for almost any value collector current.

Figure 8.41 compares the noise voltage versus source resistance for six exemplary low-noise transistors at operating currents of $10 \mu \mathrm{~A}$ and 1 mA . The parts are ranked by increasing $e_{\mathrm{n}}$ at 1 mA collector current and with low source resistance, i.e., they are ranked by increasing $r_{\mathrm{bb}}$. While it's impressive to see $0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ performance of the lowest-noise parts (like the ZTX851), it's sobering to realize that this holds only if the resistive component of the source impedance is below $10 \Omega$. Note the generally inverse relationship of the ranking at high $R_{\mathrm{S}}$ relative to that at low $R_{\mathrm{s}}$. Note also how at a collector current of $10 \mu \mathrm{~A}$ all of the transistors have comparable noise voltages for source resistances less than 10k, although the high beta

[^389]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0537.jpg?height=1923&width=806&top_left_y=217&top_left_x=120)

Figure 8.39. Measured beta versus collector current, at $V_{\mathrm{CE}}=5 \mathrm{~V}$, for the transistors in Table 8.1a. Use these data with $i_{n}=\sqrt{2 q I_{C} / \beta}$ to find the base-current noise at the chosen collector current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0537.jpg?height=489&width=733&top_left_y=225&top_left_x=1001)

Figure 8.40. Because of their very low base resistance ( $r_{\mathrm{bb}^{\prime}}$ ), the MJE15028-33 family of 8A bipolar power transistors have been used by audio experimenters to make low-noise audio amplifiers. That sounded good, to us. . . but we discovered $>10 \mathrm{~dB}$ variations in their (unspecified) low-frequency noise, even within a single batch of parts.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0537.jpg?height=1044&width=810&top_left_y=1021&top_left_x=970)

Figure 8.41. Comparing total input noise of six BJT candidates, plotted as in Figure 8.33. For low source resistance you want a transistor with low $r_{\mathrm{bb}^{\prime}}$, operated at high current; for high source resistance you want a high-beta transistor, operated at low current.
parts shine above $1 \mathrm{M} \Omega .{ }^{47}$ These data and analysis illustrate how low-noise performance can be optimized for a given source impedance by selecting the right transistor and running it at the right current for the job.

The curves in Figures 8.33 and 8.41 include the Johnson noise from a resistive source, $R_{\mathrm{s}}$, and would not be valid for reactive high-impedance sources such as capacitive sensors. In that case the $e_{\mathrm{n}}$ and the $i_{\mathrm{n}} Z_{\mathrm{s}}$ traces meet, similar to the 0.65 dB line in Figure 8.32, without being pushed up by an intervening $R_{\mathrm{S}}$ region.

The typical values of capacitance listed in Table 8.1a are from the datasheet specifications, or sometimes from plots, and generally at $V_{\mathrm{CE}}=10 \mathrm{~V}$. Most of the listed values are $C_{\mathrm{ob}}$, although some are $C_{\mathrm{cb}}$. These are related by $C_{\mathrm{ob}}=C_{\mathrm{cb}}+C_{\mathrm{ce}}$, but the $C_{\mathrm{ce}}$ contribution is usually small, often well under $25 \%$.

The four columns of optimum noise parameters deserve some explanation. They experiment with the concept of reducing $I_{\mathrm{C}}$ until the noise-voltage contribution from $r_{\mathrm{e}}$ (i.e., collector-current shot noise times $1 / g_{m}$ ) raises the overall voltage noise by $50 \%$ over its high-current (i.e., $r_{\mathrm{bb}{ }^{\prime}}$ Johnson noise alone) value. Put another way, the idea is to throttle down the collector current in order to reduce the transistor's noise current, but only to the extent that it increases the transistor's noise voltage by a modest amount. That collector current is listed, along with the corresponding $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ (conservatively calculated from the specified minimum beta), and the transistor's noise resistance $R_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$ at that current. If you buy into the idea of not running the BJT at an "excessive current" and are willing to compromise $e_{\mathrm{n}}$ to reduce $i_{\mathrm{n}}$, these values give an upper limit for $I_{\mathrm{C}}$ and a lower limit for $e_{\mathrm{n}}{ }^{48}$

Looking at the bottom quarter of the table, now with

[^390]this "optimum" perspective, it's sobering to see the low $R_{\mathrm{n}}$ values, ranging from $30 \Omega$ to $125 \Omega$. And much of the next quartile has trouble getting above $400 \Omega$. This means that for commonly encountered signal impedances above 100$400 \Omega$, the amplifier's noise contribution when operated at the "optimum" collector current would be dominated by the $i_{\mathrm{n}} Z_{\mathrm{s}}$ contribution (i.e., input-noise current flowing through the signal's source impedance). We'd be strongly motivated to drive down $i_{\mathrm{n}}$, by finding parts with higher beta, and by lowering $I_{\mathrm{C}}$. In this sense the "optimum" current is really a maximum practical current. Looking out of the corner into which we've painted ourselves, the alternative of a quiet JFET (instead of a BJT) looks seriously worth considering.

And that is the subject we take up in the next major section (§8.6), after taking a brief (but challenging) interlude.

### 8.5.9 An extreme low-noise design challenge: transformerless ribbon microphone preamp

We looked around for a challenging application, one that requires unusually low input noise voltage. A traditional application is a "moving-coil" phonograph cartridge, with its very low signal voltage $(\sim 1 \mathrm{mV}$ at maximum groove modulation, thus a mere $0.1 \mu \mathrm{~V}$ for an 80 dB dynamic range). Problem is, it's too traditional! ${ }^{49}$

A closely related technology is used in the ribbon microphone, in which an outrageously delicate strip of metal foil (typically $2 \mu \mathrm{~m}$ thick - that's a mere 4 wavelengths of light!) is suspended in a magnet's gap, there wafted about by the ambient sound field. You can think of it as a single-turn generator, propelled by the sound's subtle vibrations. Ribbon mics were the first truly high fidelity microphones: they're the clunky big studio mics you see in old movies. These things go back to the 1930s, with models from RCA (the classic 44B) and BBC-Marconi (named, with British understatement, the "Type A"). They're clunky because they have a large magnet inside; they weigh typically $5-10$ pounds. They continue to be built and used today, ${ }^{50}$ favored by some for their "smooth sound," variously described (in the inimitable language of the audiophile) as "intimate, warm and detailed, yet never harsh."

The output signal from a ribbon mic is tiny by comparison even with the low-level moving-coil phono cartridge: at the standard sound pressure level of 1 Pa you

[^391]get $50-100 \mu \mathrm{~V}$ directly from the ribbon. That sounds like plenty of signal - until you realize that this reference level of one pascal corresponds to +94 dB SPL. That's loud - a jackhammer at 5 feet! A sensitive microphone needs to get down another 80 dB or so to capture the quietest sounds in a concert. ${ }^{51}$ At those levels the signal directly from the ribbon is a mere $5-10 \mathrm{nVrms}$. To set the scale, an op-amp with the lowest voltage noise density (LT1028, $e_{\mathrm{n}}=0.85 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) has an input-noise voltage of about 100 nVrms , integrated over the audio band of $20 \mathrm{~Hz}-$ 20 kHz ; that's $20-25 \mathrm{~dB}$ larger than the quiet-level audio output directly from the ribbon.

So ribbon mics invariably include an audio step-up transformer, with a turns ratio typically of $1: 30$. That increases the signal amplitude by the same ratio, so that a well-designed low-noise audio amplifier does not compromise the low-level performance. But transformers can be problematical, both in terms of linearity and in maintaining a flat response over the 1000:1 frequency-range of high-quality audio. We could eliminate the transformer entirely by designing an amplifier whose input-noise voltage is at least 20 dB better than that of an LT1028, i.e., with $e_{\mathrm{n}} \leq 0.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

#### A. A simple 70 picovolt per-root-hertz preamp test design

To get to this kind of noise level you've got to use a BJT (or, as we'll see, a bunch of them in parallel). You pay a price in terms of input current (i.e., relatively low input impedance); but we're aided here by the very low native source impedance of the ribbon, which is less than $1 \Omega$ over the whole audio band. We seek a transistor with low base resistance $\left(r_{\mathrm{bb}^{\prime}}\right)$, which we'll operate at relatively high collector current in order to drive down the $r_{\mathrm{e}}$ noise contribution (collector shot noise flowing through $r_{\mathrm{e}}$ ); recall that the latter is numerically the same as the Johnson noise created by a "real" resistor of value $R=r_{\mathrm{e}} / 2$.

To set the scale, note that our target noise voltage of $e_{\mathrm{n}}=0.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ corresponds to the Johnson-noise voltage created by a $0.6 \Omega$ resistor! In other words, we need a transistor whose $r_{\mathrm{bb}^{\prime}}$ is significantly less than that, and we need to run it at a collector current of at least $\sim 50 \mathrm{~mA}$ (where the " $r_{\mathrm{e}}$ " noise contribution is equivalent to that of a $0.25 \Omega$ resistor). And we need a circuit configuration that delivers on that low-noise promise.

There are several possible circuit configuration choices. We could try something like the Naim circuit of Figure 8.34

[^392]- but we'd have to reduce $R_{\mathrm{E}}$ to a fraction of an ohm, forcing $Q_{3}$ to drive a very stiff load. The same problem afflicts the "better" design of Figure 8.35. They have in common the need to keep the impedance of the feedback signal very low.

Two approaches we settled on are shown, in simplified form, in Figure 8.42. Both circuits dispense with feedback, arguing that a class-A preamp (of moderate gain, say $G \approx 100$ ) for microvolt-level signals is inherently linear. The single-ended common-emitter amplifier is simplest, and has a 3 dB noise advantage compared with a differential configuration. But it requires a huge input blocking capacitor ( $\lesssim 150,000 \mu \mathrm{~F}$ to preserve the signal's very low source impedance down to a few hertz), which causes a long startup settling time; it's esthetically ugly, too. We
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0539.jpg?height=1178&width=747&top_left_y=898&top_left_x=999)

Figure 8.42. Ribbon microphone preamp configurations. Compared with the dc-coupled differential circuit, the single-ended circuit is quieter, but requires a very large blocking capacitor at the input. In either case it's necessary to use multiple paralleled transistors so that the effective base resistance $r_{\mathrm{bb}^{\prime}}$ is in the range of $0.1 \Omega$ or less. See Figure 8.45.
did use this circuit to characterize a slew of candidate lownoise BJTs (look ahead to Figure 8.92 and associated discussion), but for our entry to the ribbon-mic preamp challenge we went with the dc-coupled differential open-loop configuration shown. No giant input capacitors here; but to deal with the doubled noise power we had to reduce $r_{\mathrm{bb}{ }^{\prime}}$ and $r_{\mathrm{e}}$ by a factor of 2 (i.e., we doubled the number of paralleled transistors used for each side of the input pair).

#### B. Choosing a low-noise BJT

For a circuit like this it's essential to use a transistor (or several in parallel) that exhibits very low input-noise voltage. That requires a base resistance $r_{\mathrm{bb}^{\prime}}$ down in the range of just a few ohms. Sadly, $r_{\mathrm{bb}}$ is rarely specified; and the excellent low- $r_{\mathrm{bb}}{ }^{\prime}$ transistors of yesteryear have largely gone extinct. A case in point is the fine Toyo-Rohm 2SD786, with a specified typical $r_{\mathrm{bb}^{\prime}}$ of $4 \Omega$ (it's $n p n$; the 2SB737 $p n p$ complement is better still, with a specified typical $r_{\mathrm{bb}^{\prime}}$ of $2 \Omega)$. Actual samples of each performed even better, with measured $r_{\mathrm{bb}^{\prime}}$ values around $2.3 \Omega$ and $1.2 \Omega$, respectively.

You can't get these anymore (and we won't part with any of our precious and dwindling "lifetime" stock! Even if you beg us.). What about the "low-noise" small-signal BJTs you can get, such as the 2SC3324? The good news is that they do specify their noise performance, as we saw in §8.4. The bad news is that they don't promise a whole lot (" $\mathrm{NF}=0.2 \mathrm{~dB}$ typ, 3 dB max"); and these small-geometry transistors are generally optimized for operation at low current, where the $r_{\mathrm{e}}$ noise contribution is so large that there's no need to keep $r_{\mathrm{bb}}{ }^{\prime}$ small. For example, the 2SC3324 achieves its minimum noise figure around $I_{\mathrm{C}}=30 \mu \mathrm{~A}$; at that current $r_{\mathrm{e}}$ is $830 \Omega$, and thus its $r_{\mathrm{b} b^{\prime}}$ noise contribution is insignificant as long as $r_{\mathrm{bb}^{\prime}}$ is kept below, say, $200 \Omega$. Our samples measured $r_{\mathrm{bb}^{\prime}} \approx 40 \Omega$ - plenty good enough for these transistors' intended low-current application, but not helpful here.

We embarked on a search for low- $r_{\mathrm{bb}}{ }^{\prime}$ transistors and found that the situation is not bleak. It's just unspecified. In the circuit design community you'll find mention of good noise properties with large-geometry transistors (i.e., power transistors). ${ }^{52}$ We measured the noise voltage (details later) of a few dozen promising candidates (most of which are listed in Table 8.1a on page 501), and found that, indeed, some of the large geometry ("power") transistors have $r_{\mathrm{bb}}$ values down below $10 \Omega$, and deliver quite respectable input-referred $e_{\mathrm{n}}$ when operated at currents of

[^393]10 mA or so (where the $r_{\mathrm{e}}$ contribution is equivalent to Johnson noise from a $1.25 \Omega$ resistor). Figure 8.17 (back on page 486 ) shows that the ZTX851 (a $5 \mathrm{~A}, 60 \mathrm{~V}$ transistor, lacking any official low-noise endorsement) performs on a par with the legendary 2SD786; you can see, also, that the larger $r_{\mathrm{bb}}$ of the smaller geometry "low noise" parts like the 2N5089 and 2SC3324 makes them non-competitive in this high- $I_{C}$ /low- $e_{n}$ arena.

As we remarked earlier (\$8.3.1), where we showed a plot (Figure 8.12) of $e_{\mathrm{n}}$ versus collector current for six candidate low-noise transistors, there's not much benefit in having a low $r_{\mathrm{bb}^{\prime}}$ if you are operating at low current (where the effect of $r_{\mathrm{e}}$ dominates); but it really matters at higher currents, which is where you have to operate if you want to achieve $e_{\mathrm{n}}$ values southward of $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

To emphasize this latter point, we show in Figure 8.43 a plot of the voltage noise spectra of the ZTX851 over a large range of collector currents (seen earlier in Figure 8.18, and here extended down to 4 Hz ). The lesson here is that you have to run plenty of current to get really low $e_{\mathrm{n}}$. Don't overdo it, though: as seen in the earlier Figure 8.18, at still higher currents the low-frequency noise rises, owing to a rapidly increasing base-current flicker-noise contribution. For this transistor the "sweet spot" is at a collector current of $\sim 5 \mathrm{~mA}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0540.jpg?height=532&width=753&top_left_y=1267&top_left_x=1098)

Figure 8.43. To reap the benefits of a transistor with desirable low base spreading resistance $r_{\mathrm{bb}}$ (thus low Johnson noise), you must operate at a high enough collector current to make the $r_{\mathrm{e}}$ noise contribution comparably small, as shown in these measured noise spectra of a ZTX851 npn transistor.

#### C. Beating the $0.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ goal

Among our candidates, we found that the quietest pnp transistors were somewhat better than their npn cousins. For example, at $I_{\mathrm{C}}=10 \mathrm{~mA}$ a typical (average of six samples) pnp ZTX951 measured $e_{\mathrm{n}}=0.20 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, compared with $0.21 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the ZTX851 npn complement
(corresponding to $r_{\mathrm{bb}^{\prime}}$ values of $1.2 \Omega$ and $1.5 \Omega$, respectively). We're not sure why this is so, although as we remarked earlier the noise specifications of the legendary $n p n$ 2SD786 (with pnp 2SB737 complement) indicate the same trend. ${ }^{53}$

We used the differential circuit variant of Figure 8.42, with a parallel array of transistors for each of the input pair, followed with a $G=30$ quiet op-amp stage (made with the tried-and-tested LT1128, whose input noise voltage is $\lesssim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ all the way down to 10 Hz ). Ordinarily you'd include a small "emitter-ballasting" resistor in series with each emitter of the parallel array, chosen to drop $\sim 50 \mathrm{mV}$ or so in order to equalize the currents and prevent current hogging; at 10 mA per transistor that would amount to $5 \Omega$, adding an unacceptable amount of noise voltage. It's often said that transistors from a single production batch are inherently matched in their base-emitter voltage drops; out of curiosity we measured $V_{\mathrm{BE}}$ for a batch of 100 each of ZTX851 and ZTX951, with the results shown in the histogram of Figure 8.44. The matching is quite good, enough so that no emitter ballasting resistors are needed. ${ }^{54}$ The same is not true for JFETs, by the way; see Figure 3.17's histogram of three hundred representative $n$-channel parts, painstakingly made ${ }^{55}$ from three batches of 100 JFETs, in the popular 2N5457-59 series of $n$-channel parts (graded by $I_{\mathrm{DSS}}$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0541.jpg?height=529&width=759&top_left_y=1307&top_left_x=146)

Figure 8.44. Distribution of measured $V_{\mathrm{BE}}$ in a batch of 100 each of $n p n$ and $p n p$ parts.

For a circuit like this, with resistive collector loads and
${ }^{53}$ This may be related to the larger die size needed for a similarlyperforming pnp transistor.
${ }^{54}$ We found similarly good matching for a batch of BD437s (an inexpensive and widely available BJT for "medium-power linear and switching applications").
${ }^{55}$ Literally! One's fingertips were rendered quite tender, after leadforming and inserting three hundred transistors.
emitter pulldowns, the dc supply rails must be quiet, because noise on the rails appears unattenuated at the output. Here we used a so-called capacitance multiplier to eliminate supply noise; it's a useful subcircuit - see the description in §8.15.

The final results?...(drumroll)...here are measured noise voltages for several transistor configurations (with some graphs in Figure 8.45):

|  |  | $I_{\mathrm{C}}$ | $e_{\mathrm{n}}(\mathrm{nV} / \sqrt{\mathrm{Hz}})$ |  |
| :---: | :---: | :---: | :---: | :---: |
| transistor | qty | $(\mathrm{mA})$ | $@ 1 \mathrm{kHz}$ | $@ 100 \mathrm{~Hz}$ |
| ZTX951 | $2 \times 16$ | $2 \times 100$ | 0.085 | 0.10 |
|  | $2 \times 32$ | $2 \times 200$ | 0.070 | 0.09 |
| BD437 | $2 \times 24$ | $2 \times 100$ | 0.095 | 0.17 |
|  | $2 \times 24$ | $2 \times 200$ | 0.080 | 0.13 |
| 2SC3601E | $2 \times 12$ | $2 \times 200$ | 0.093 | 0.18 |

This is impressively low input noise voltage - you rarely see figures below $0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ - but it's only fair to point out the unusual nature of this challenge, with its ultralow source impedance of less than an ohm, thus tolerant of the low input impedance (and relatively high input current) of a grounded-emitter amplifier stage running at a collector current of 100 mA . Getting to much lower input currents, though, is best accomplished with JFETs, as we'll see presently.

#### D. Measuring BJT noise

How did we make these transistor noise measurements? There are fancy commercial instruments you can buy to measure noise parameters $\left(e_{\mathrm{n}}, i_{\mathrm{n}}, \mathrm{NF}\right)$ of discrete transistors (BJT or FET); these are generally aimed at RF and microwave characterization (although the discontinued
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0541.jpg?height=545&width=790&top_left_y=1610&top_left_x=975)

Figure 8.45. Measured noise voltage spectra for the amplifier of Figure 8.42, with three choices of input transistor and operating current. The preamp with 64 ZTX951 transistors is the winner.

HP/Agilent 4470A measured $e_{\mathrm{n}}, i_{\mathrm{n}}$, and NF at eleven spot frequencies, two per decade from 10 Hz to 1 MHz ). We took a more modest route, building our own simple circuit. It's basically the device under test (DUT) configured as a grounded emitter amplifier stage, with settable collector current and collector-to-emitter voltage, and provision for determining its voltage gain. Knowing the latter, you measure the output noise voltage spectrum, first with the input bypassed (to get $e_{\mathrm{n}}$ ), then with a series resistor at the input (to get $i_{\mathrm{n}}$ ). It's described in detail in $\S 8.12 .2$.

## 8.6 Low-noise design with JFETS

Picking up where we left off (at §8.5.6), for high source impedances it's transistor current noise that dominates, thus favoring FETs, usually in the form of a JFET. Compared with BJTs, JFETs generally have greater voltage noise, but very much lower gate current (and current noise), and so they're the universal choice for low-noise highimpedance amplifiers. In this context it is sometimes useful to think of Johnson-noise voltage, in combination with the signal's source resistance, as a current noise $i_{\mathrm{n}}=v_{\mathrm{n}} / R_{\mathrm{S}}$ (as plotted earlier in Figure 8.1). This lets you compare sourcenoise contributions with amplifier current noise.

We can use the same amplifier noise model for FETs, namely a series noise-voltage source and a parallel noisecurrent source. You can analyze the noise performance with exactly the same methods used for bipolar transistors. For example, see the graphs in Figure 8.53 in $\S 8.7$ where we referee the "bipolar/FET shootout."

### 8.6.1 Voltage noise of JFETs

For JFETs the voltage noise $e_{\mathrm{n}}$ is essentially the Johnson noise of the channel resistance, given approximately by

$$
\begin{equation*}
e_{\mathrm{n}}^{2}=4 k T\left(\frac{2}{3} \frac{1}{g_{m}}\right) \quad \mathrm{V}^{2} / \mathrm{Hz} \tag{8.34}
\end{equation*}
$$

where the inverse transconductance term takes the place of resistance in the Johnson-noise formula; in other words, the noise voltage is the same as the Johnson noise produced by a resistor of value $R=\frac{2}{3} \frac{1}{g_{m}}$ (analogous to the input noise voltage of a BJT, whose $e_{\mathrm{n}}$ is equivalent to the Johnson noise of a resistor of value $R=\frac{1}{2} \frac{1}{g_{m}}$ ). You can see from Figure 8.46 (measured noise voltage versus transconductance ${ }^{56}$ ) that this sets a reliable lower bound to the actual noise voltage, which can be somewhat greater in practice.

[^394]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0542.jpg?height=550&width=784&top_left_y=220&top_left_x=1077)

Figure 8.46. Testing the JFET noise formula: scatterplot of measured noise voltage density (well above the $1 / f$ corner frequency) versus measured transconductance for a selection of 50 different JFET types, operated at various drain currents. Open circles indicate JFETs whose noise had not flattened to the white-noise floor at our maximum frequency.

Because the transconductance rises with increasing drain current (as $\sqrt{I_{\mathrm{D}}}$, see $\S 3.3 .3$, Figure 3.54 , and Table 3.7), it is generally best to operate FETs at high drain current for lowest voltage noise. However, because the $e_{\mathrm{n}}$ is Johnson noise, which goes only as $1 / \sqrt{g_{m}}$, and that in turn goes as $\sqrt{I_{\mathrm{D}}}, e_{\mathrm{n}}$ is finally inversely proportional to the fourth root of $I_{\mathrm{D}}$. With such a mild dependence of $e_{\mathrm{n}}$ on $I_{\mathrm{D}}$ it doesn't pay to run at a drain current so high that other properties of the amplifier are degraded. In particular, a FET running at high current gets hot, which (a) decreases $g_{m}$, (b) increases offset voltage drift and CMRR, and (c) raises gate leakage dramatically; the latter effect can actually increase voltage noise, because there is some contribution to $e_{\mathrm{n}}$ from flicker noise associated with the gate leakage current.

There is another way to increase $g_{m}$ and therefore decrease JFET voltage noise: by paralleling a pair of JFETs, you get twice the $g_{m}$, but of course this is at twice the $I_{\mathrm{D}}$. But now if you run the combination at the previous $I_{\mathrm{D}}$,
with rising frequency until we found the high-frequency white-noise floor. This yielded a wide range of conditions under which to test the formula. No parts were better, but many were $10 \%$ to $30 \%$ worse. Others were much worse, up to $\times 2$. For some the noise continued to fall with increasing frequency, so we couldn't find the noise floor; these are indicated with open circles on the graph. The takeaway lesson: get $g_{m}$ as high as possible for low $e_{\mathrm{n}}$. Remember, paralleling or using larger-die JFETs is a good way to increase $g_{m}$. But watch out for high capacitance and leakage. And keep in mind that $1 / f$ noise and lowfrequency noise plateaus can dominate your design. Examine our plots and the data for JFETs in Table 8.2 on page 516. For critical projects, take your own measurements.
you still improve $g_{m}$ by a factor of $\sqrt{2}$ over the singleJFET value, without increasing total drain current; so you decrease $e_{\mathrm{n}}$ by a factor of the 4 th root of 2 , to $84 \%$ of the single-JFET value. ${ }^{57}$ In practice you can simply parallel a number of matched JFETs, or look for a largegeometry JFET like the IFN146 $(0.7 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ or IF3601 $(0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ mentioned earlier. ${ }^{58}$

There is a price to pay, however. All the capacitances scale with the number of paralleled JFETs. As a result, high-frequency performance (including noise figure) is degraded. In practice you should stop paralleling additional transistors when the circuit's input capacitance roughly matches the source's capacitance. If you care about performance at high frequencies, choose JFETs with high $g_{m}$ and low $C_{\text {rss }}$; you might consider the ratios $g_{m} / C_{\text {rss }}$ and $g_{m} / C_{\text {iss }}$ to be high-frequency figures of merit (recall that $f_{\mathrm{T}}=g_{m} / 2 \pi C$, where $C$ is the input capacitance or Miller capacitance, depending on the circuit configuration). Note that circuit configurations can also play an important role; e.g., the cascode circuit can be used to eliminate the Miller effect (gain multiplication) on $C_{\text {rss }}$.

In Figure 8.52 we've plotted an extensive collection of measured noise voltage for many of the JFETs in Table 8.2. See also Table 3.7, with additional JFET characteristics (not related to noise), and the "Measured transconductance" graph in $\S 3 x .2$ for plots of JFET transconductance versus drain current.

#### A. JFET $1 / f$ voltage noise

Like their BJT brothers, most JFETs suffer also from rising noise voltage density at low frequencies, as seen in the measured data of Figure 8.47. In some cases (such as the 2 SK170B) the $1 / f$ noise is quite subdued and can be characterized by a single noise-corner frequency $f_{\mathrm{c}}$, similar to BJTs. In such cases the noise corner can be estimated with eq'n 8.27 , and, once $f_{\mathrm{c}}$ is known, the noise density can be calculated with eq'n 8.28. The plot shows 1 kHz noise voltage density ranging from $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the

[^395]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0543.jpg?height=493&width=796&top_left_y=218&top_left_x=977)

Figure 8.47. Measured voltage noise density versus frequency for several BJTs and JFETs, illustrating the $1 / f$-like rise at low frequencies. See Figure 8.52 for an extensive set of JFET noise plots.

2SK170B, to $2.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the low-capacitance 2N5457, to $11 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the small-die PN4117 (for which the drain current is $I_{\mathrm{DSS}}$, here $75 \mu \mathrm{~A}$ ).

But some JFETs suffer from an elevated low-frequency noise plateau region, ${ }^{59}$ like that of the LSK389. This part has an attractively low-noise density of $1.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 1 kHz and above, but it rises, in a snake-like curve, to twice that value in the 100 Hz region. This is not a terribly serious drawback for this otherwise excellent part, and it still enjoys low wideband noise levels of about 70 nVrms and 180 nVrms for 1 kHz and 10 kHz total bandwidths, respectively.

Sometimes this effect can get out of hand. For example, compare Fairchild's quiet version of the 2N5486, with $e_{\mathrm{n}}=3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, with the noisy sample we measured from "manufacturer D": the latter's $4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 kHz climbs steeply at lower frequencies, going off-scale at 700 Hz . It climbs to $50 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 100 Hz , some $15 \times$ that of the quiet Fairchild JFET with the same part number. As a result the noisy part has about $1 \mu \mathrm{~V}$ of wideband noise (to 1 kHz ). For a stunning comparison of noise variation
${ }^{59}$ Called "roller-coaster" noise by Motchenbacher and Connelly. The mechanism for the excess $1 / f$ noise was identified in the early 1960s as a bulk rather than surface effect, involving random capture or emission of electrons trapped in the depletion region. See, for example, P. O. Lauritzen, "Low-frequency generation noise in junction field effect transistors," Solid-State Electron., 8, 1, 41-58 (1965), or C. T. Sah, "Theory of low-frequency generation noise in junction-gate field-effect transistors," Proc. IEEE, 52, 7, 795-814 (1994). In the time domain this noise can take the form either of discrete steps between two or more voltage levels ("popcorn" or "telegraph" noise) or random sudden voltage excursions (burst noise); see Figures 8.5 and 8.6 for examples of popcorn noise in a vintage 741 BJT op-amp.
in 2 N 5486 s made by multiple manufacturers, see the measured spectra in Figure 8.51. The noisiest part in that group has a $210 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ plateau, resulting in about $2.5 \mu \mathrm{Vrms}$ low frequency integrated voltage noise. In its defense, the 2N5486 "RF Amplifier" datasheet lists noise-figure specifications only at 100 MHz and 400 MHz . Note also that this low-frequency-noise excess does not affect operation at much higher frequencies (where " $e_{\mathrm{n}} \cdot C_{\mathrm{in}}$ " noise, discussed in \$8.11, rears its ugly head).

Although it's common to talk about $1 / f$ noise and a corresponding corner frequency $f_{\mathrm{c}}$, the reality is that many JFETs do not conform to such a neat model. In their datasheets, manufacturers deal with the issue of excess low-frequency noise in several ways. First, they may avoid a noise specification altogether. Second, they may give the $e_{\mathrm{n}}$ noise-density spec at relatively high frequencies $10 \mathrm{kHz}, 100 \mathrm{kHz}$, or even higher. Third, they may provide instead an rms noise voltage specification at some specified bandwidth. Fourth, they may give an intentionally high (conservative) specification, such as $115 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ max, or perhaps a 3 dB noise figure for $R_{\mathrm{S}}=1 \mathrm{M} \Omega$ (whose source noise-voltage density is a high $126 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). Fifth, they may give an $e_{\mathrm{n}}$ spec at say 100 Hz (where it's useful), but give a typical value only. Finally, for parts intended for high-frequency amplification, they may give their noise spec at radio frequencies -100 MHz or higher.

### 8.6.2 Current noise of JFETs

At low frequencies the current noise $i_{\mathrm{n}}$ is extremely small, arising from the shot noise in the gate leakage current (Figure 8.48): ${ }^{60}$

$$
\begin{equation*}
i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{G}}}=\left(3.2 \times 10^{-19} I_{\mathrm{G}}\right)^{\frac{1}{2}} \quad \mathrm{~A} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.35}
\end{equation*}
$$

The noise current rises with increasing temperature, as the gate leakage current rises. Watch out for the rapidly increasing gate leakage in $n$-channel JFETs that occurs for operation at high $V_{\mathrm{DG}}$ and/or high $I_{\mathrm{D}}$ (see $\S 3.2 .8$ ). A dose of reality: it's hard to estimate with any accuracy the level of current noise in JFETs, because the gate leakage is poorly specified. Too often you see unrealistically high worstcase specifications, for example $I_{\mathrm{G}}=1 \mathrm{nA}$ (max), whereas at normal ambient temperatures it's more typically down in the $1-10 \mathrm{pA}$ range. With such low bias currents the input noise-current density is very small, e.g., $1.8 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ for a gate leakage current of 10 pA . That noise current would generate an $e_{\mathrm{n}}$ just $1.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ through a signal source

[^396]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0544.jpg?height=552&width=820&top_left_y=219&top_left_x=1059)

Figure 8.48. Input shot-noise current density versus FET gate leakage current.
impedance of $1 \mathrm{M} \Omega$ (which, by the way, would itself have a Johnson-noise voltage of $128 \mathrm{nV} / \sqrt{\mathrm{Hz}}$; the source resistance would have to reach $5 \mathrm{G} \Omega$ before the noise voltage generated by the JFET's noise current would match the Johnson noise of the source).

At moderate to high frequencies there are additional noise and resistive terms.
(a) If there's a summing junction (for example in a transimpedance amplifier) then the input noise voltage $e_{\mathrm{n}}$ driving the input capacitance $C_{\text {in }}$ generates a noise current of $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\text {in }}$, see $\S 8.11$ for details.
(b) In a common-source amplifier without cascode, there is an effective resistive part of the (normally capacitive) input impedance seen looking into the gate. This comes from the effect of feedback capacitance (Miller effect) when there is a phase shift at the output caused by load capacitance; i.e., the part of the output signal that is shifted $90^{\circ}$ couples through the feedback capacitance $C_{\text {rss }}$ to produce an effective resistance at the input, given by

$$
\begin{equation*}
R=\frac{1+\omega C_{\mathrm{L}} R_{\mathrm{L}}}{\omega^{2} g_{m} C_{\mathrm{rss}} C_{\mathrm{L}} R_{\mathrm{L}}^{2}} \text { ohms } \tag{8.36}
\end{equation*}
$$

Both effects rise linearly with frequency above a breakpoint, and both have similar breakpoint frequencies, typically in the range of $2-100 \mathrm{kHz}$ for low-leakage JFETs.

As an example, the $2 \mathrm{~N} 5486 n$-channel JFET has a noise current of $\sim 5 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ and a noise voltage $e_{\mathrm{n}}$ of $2.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, both at $I_{\mathrm{DSS}}$ and 10 kHz . These figures are roughly 200 times better in $i_{\mathrm{n}}$ and 2 times worse in $e_{\mathrm{n}}$ than the corresponding figures for the 2N5087 BJT used in connection with the noise figure plots in §8.5.1 (Figure 8.29). If we assume a $470 \Omega$ load with 5 pF of shunt capacitance
( 68 MHz drain rolloff), the noise current begins climbing at about 30 kHz , and reaches levels of concern to the RF designer in the $10-100 \mathrm{MHz}$ region. ${ }^{61}$ It's not uncommon to see a cascode transistor added to suppress the effect and to improve the high-frequency gain.

With FETs you can achieve good noise performance for input impedances in the range of 10 k to 100 M . As we've seen (Figure 8.27), and whose secrets will be revealed presently (§8.6.4), the SRS model SR560 preamp has a noise figure of 1 dB or better for source impedances from $5 \mathrm{k} \Omega$ to $20 \mathrm{M} \Omega$ in the frequency range from 100 Hz to 10 kHz . Its performance at moderate frequencies corresponds to a noise voltage of $4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and a noise current of $0.013 \mathrm{pA} / \sqrt{\mathrm{Hz}}$.

### 8.6.3 Design example: low-noise wideband JFET "hybrid" amplifiers

You can improve on the noise performance of commercial JFET preamps (and op-amps) by combining the best discrete JFETs with an op-amp in a "hybrid" design. Several nice circuit examples are shown in progressive examples in other chapters: (a) an ac-coupled low-noise wideband amplifier (to $\sim 20 \mathrm{MHz}$ ) with $e_{\mathrm{n}} \approx 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ in Figure 3.34 ; (b) an analogous dc-coupled amplifier with $e_{\mathrm{n}} \approx 2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ in Figure 3.37; and (c) a dc-coupled low-noise wideband differential amplifier with $e_{\mathrm{n}} \approx 2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ in $\S 3 x .4$.

The reader is encouraged to spend a few minutes (or even a half hour!) reviewing those examples, which illustrate important techniques in low-noise amplifier design with discrete JFETs (and also when combined with an opamp second stage). Here we complete the progression of such hybrid designs with a dc-coupled instrumentation amplifier (INA; see §5.15) of comparably low-noise and wide bandwidth.

The circuit in Figure 8.49 is an evolution of the singleended dc-coupled hybrid amplifier of Figure 3.37, two of which here form the differential amplifier input of the classic three-amplifier INA. The voltage gain (difference input to single-ended output) is $G=100$, set by the ratio $1+2 R_{\mathrm{f}} / R_{\mathrm{g}}$. The $\pm 2 \%$ trim of $R_{\mathrm{f} 2}$ is used to maximize the common-mode rejection ratio, a desirable feature that is responsible for much of the INA's fame. JFETs need help to achieve low offset voltage ( $Q_{1}$ specifies 20 mV , worst case), so we've added an offset balance in $Q_{1 a, b}$ 's drain.

[^397]As for noise, the LSK389B ${ }^{62}$ specifies a typical $e_{\mathrm{n}}$ of $0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 1 kHz and $I_{\mathrm{D}}=2 \mathrm{~mA}$. At our 5 mA drain current we can expect slightly better; but the noise of each differential pair (e.g., $Q_{1 a, b}$ ) is larger by a factor of $\sqrt{2}$, with another factor of $\sqrt{2}$ to account for the combined noise of the upper and lower differential pairs. As with the single-ended amplifier of Figure 3.37, the op-amp's noise ( $e_{\mathrm{n}} \sim 12 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) is reduced by a factor of the JFET pair's gain $(\sim 20)$ when referred to the input. The overall noise voltage of this instrumentation amplifier is thus $\sim 2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Combined with its bandwidth ( $\sim 20 \mathrm{MHz}$, for signal source impedance $\leq 1 \mathrm{k} \Omega$ ), this is better performance than can be had in available instrumentation amplifiers.

Can we do better? The easiest way to beat down the JFET voltage noise is to add a second pair of JFETs at each input, paralleling the existing gate and drain terminals, but with each pair pulled down with its own 10 mA current sink (and with the drain resistors now $500 \Omega$ ). That reduces the input voltage noise by $\sqrt{2}$, and there is no need to worry about $V_{\mathrm{GS}}$ matching between the separate JFET matched pairs (figure out why). Finally, if you want to minimize input current, add a pair of cascode transistors to keep the $V_{\text {DS }}$ of $Q_{1}$ below 5 V ; see $\S 3.2 .8$ and Figures 5.61 and 8.67.

### 8.6.4 Designs by the masters: SR560 low-noise preamplifier

It's always instructive to look at the innards of a good commercial product. Stanford Research Systems (SRS) has a nice line of scientific instruments, among which you'll find their SR560 low-noise preamplifier, in continuous production since 1989. It uses a differential JFET front-end for high input impedance $(100 \mathrm{M} \Omega \| 25 \mathrm{pF})$, and it has a nice set of panel controls that let you select things like the voltage gain (calibrated $\times 1$ to $\times 50,000$, in a $1-2-5$ sequence or uncalibrated over the same range), frequency response (via switchable lowpass and highpass sections), ac or dc coupling, phase inversion, and so on. It's a good performer - noise-voltage density better than $4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, response flat to $\pm 0.5 \mathrm{~dB}$ to $1 \mathrm{MHz}, 0.01 \%$ typical distortion, and output swing to 10 Vpp .

We showed this puppy's specified noise-figure contours in Figure 8.27. Let's look under the hood to see how they did it. Figure 8.50 shows the front-end amplifier circuit, in full detail (Figure 8.50A) and in simplified forms (circuit B , block diagram C ).

[^398]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0546.jpg?height=1144&width=1414&top_left_y=219&top_left_x=339)

Figure 8.49. Hybrid JFET-input low-noise wideband instrumentation amplifier: $G=100, e_{\mathrm{n}} \approx 2 \mathrm{nV} / \sqrt{\mathrm{Hz}}, \mathrm{BW} \approx 20 \mathrm{MHz}$.

Overall topology Matched low-noise JFET pair $Q_{\text {lab }}$, running at 4.6 mA (close to its guaranteed minimum $I_{\mathrm{DSS}}$, see below), forms the fully differential first stage, in a hybrid configuration in which the JFET differential output drives an op-amp (analogous to Figure 3.37), but here configured with feedback to $Q_{1 a}$ 's source terminal so that both JFET gates are available as external inputs. The overall configuration is therefore a differential "current-feedback amplifier" (CFB, see $\S 4 x .6$ ), analogous to the single-ended hybrid circuit of Figure 3.34, and instrumentation amplifier configuration " C " in Figure 5.88. The first-stage native voltage gain is selectable as $\times 10$ or $\times 2$; for the latter a $499 \Omega$ series resistor is switched in, and thus unity net gain is seen at the second stage's input. The second stage is an LT1028 low-noise op-amp ( $e_{\mathrm{n}} \sim 1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 Hz$)$, $G=10$, with $\lesssim 100 \Omega$ source impedance at both inputs to preserve low noise voltage. With the input divider the overall second-stage gain is $\times 2, \times 5$, or $\times 10$.

JFET bias The designer nicely finessed the business of uncertain $I_{\mathrm{DSS}}$ by sensing the average drain voltage, comparing it with a +6.2 V reference, and closing the loop via integrator $U_{2}$. This is a reliable way to deal with loose $I_{\text {DSS }}$ specs, for example those of the original NPD5564 dual JFET ( $I_{\mathrm{DSS}}=5 \mathrm{~mA}$ min, 30 mA max ). That JFET is no longer available from the original manufacturer ${ }^{63}$ but fortunately there's a superior replacement (LSK389B), with pleasantly tighter $I_{\mathrm{DSS}}$ specs ( $6 \mathrm{~mA} \mathrm{~min}, 12 \mathrm{~mA}$ max), and, as a bonus, lower noise voltage (at $I_{\mathrm{D}}=2 \mathrm{~mA}$ the NPD5564's typical noise-voltage densities at 10 Hz and at 1 kHz are $12 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $3.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, respectively; the LSK389B's corresponding figures are $2.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ).

[^399]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0547.jpg?height=1962&width=1603&top_left_y=218&top_left_x=150)

Figure 8.50. Front-end amplifier stages of the Stanford Research Systems SR560 Low-Noise Preamplifier (A: detailed; B and C: simplified). Some details of input signal switching have been omitted.

Bandwidth In the signal path, amplifier $U_{1}$ is a decompensated low-noise $\left(e_{\mathrm{n}} \sim 3.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$ typ at 10 Hz$)$ wideband ( $f_{\mathrm{T}} \sim 63 \mathrm{MHz}$ ) op-amp, here configured as an integrator with $f_{\mathrm{T}}=5 \mathrm{MHz}(33 \mathrm{pF}$ and $1.0 \mathrm{k} \Omega$ ). Its slew rate of $17 \mathrm{~V} / \mu \mathrm{s}$ translates to a first-stage output of 5 Vpp at the instrument's rated 1 MHz bandwidth. In the second stage, capacitor $C_{3}$ limits the bandwidth to $\sim 2 \mathrm{MHz}$. In the first-stage bias path (which matters for commonmode rejection), integrator $U_{2}$ has an output slew rate of $10 \mathrm{~V} / \mu \mathrm{s}$ (min), so it can follow a 3 Vpp common-mode input (the instrument's rated maximum) at the full 1 MHz rated bandwidth. The integrator's unity-gain bandwidth is $230 \mathrm{kHz}(6.8 \mathrm{pF}$ and $50 \mathrm{k} \Omega)$, thus a bias-setting loop gain of 230 at 1 kHz . That puts an increasing CMRR burden on $U_{1}$ at higher frequencies, evident in the instrument's CMRR specification: $>90 \mathrm{~dB}$ to 1 kHz , decreasing by $6 \mathrm{~dB} /$ octave (i.e., as $1 / f$ ) above $1 \mathrm{kHz} .{ }^{64}$

Offset voltage These dual JFETs are not in the same league as precision-matched BJTs, and they don't claim to be. The NPD5564 (the best grade in its family) has a specified maximum offset voltage (i.e., gate-source mismatch, $\left.\left|V_{\mathrm{GS} 1}-V_{\mathrm{GS} 2}\right|\right)$ of 5 mV at $I_{\mathrm{D}}=2 \mathrm{~mA}$; the LSK389B, though excelling in noise performance, is considerably poorer, with a maximum mismatch of 20 mV (specified at $I_{D}=1 \mathrm{~mA}$ ). The SR560 deals with this problem by throwing pots at it: there's a 10-turn OFFSET trimmer in $Q_{1 \mathrm{~b}}$ 's drain, with enough range $( \pm 0.13 \mathrm{~mA})$ to balance a worstcase offset, and a second 10-turn trimmer down in the source resistor string to independently balance the offset when switched to low gain. There is a pair of analogous CMRR trimmers, 20-turns each. We've done the calibration routine (complete with some iteration of the not-veryorthogonal adjustments), and can attest to the fussiness of getting (and sustaining) deep offset and CMRR nulls.

Noise voltage To minimize noise voltage, the JFETs are operated at relatively high current, and the resistor values (in the source, drain, and signal path generally) are intentionally small. With the original noise budget of $\sim 4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ it was acceptable, for example, to use $110 \Omega$ resistors in the JFET sources. But a series pair of that resistance produces a Johnson noise-voltage density of $2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, a bit more than we'd like when paired with these quieter JFETs. An optimized design would reduce those values by perhaps a factor of 2 .
Miscellany Low-level signal switching (e.g., ac/dc/gnd

[^400]input coupling, $\times 1 / \times 10$ gain selection, and $A / B$ input interchange) is done with electromechanical relays. Not just any old relay, though - these guys use relays with goldcladded twin contacts (intended for stable low resistance, even with low-level signals where there is no contact cleaning; see §1x.6.1). And these relays are the latching type, where a momentary pulse switches the state, thus eliminating noise-inducing coil currents in the steady state; this further eliminates local heating as a source of drift. In this instrument a microcontroller runs all relays and indicator lights, sensing a front-panel command (or external digital control), and appropriately pulses relays as needed to change their state.

### 8.6.5 Selecting low-noise JFETS

As we mentioned earlier, bipolar transistors offer the best noise performance with low source impedances, owing to their lower input-voltage noise. Voltage noise, $e_{\mathrm{n}}$, is reduced by choosing a transistor with low base resistance, $r_{\mathrm{bb}}{ }^{\prime}$, and operating at high collector current (as long as $h_{\mathrm{FE}}$ remains high). For higher source impedances the current noise can be minimized instead by operating at lower collector current.

At high values of source impedance, FETs are the best choices. Their voltage noise can be reduced by operating at higher drain currents, where the transconductance is highest. FETs intended for low-noise applications have high $\kappa$ values (see §3.1.4), which generally means high input capacitance. For example, the low-noise 2SK170 has a typical $C_{\text {iss }}$ of 30 pF , whereas the PN4117-9 series of lowcurrent FETs has a maximum $C_{\text {iss }}$ of just 3 pF .

Table 8.2 on the following page presents a selection of JFET candidates for low-noise circuits. It's meant to be used in conjunction with Table 3.7, which has more extensive tabular data, including single-sample measurements. Also refer to Figure 3x.10's transconductance plots, and Figure 8.52's noise plots. The entries near the bottom of Table 8.2 are dual JFETs, suitable for differential stages; but note that their $V_{\mathrm{OS}}$ is not impressive - generally far inferior to even the poorest op-amps (the interdigitated LS840, whose layout is shown in Figure 3.18, is the best of the lot, with 2 mV typical, 5 mV worst-case offset voltage).

We favor JFETs with high transconductance and low gate-cutoff voltages, but sadly many of the old favorites with superior performance have been discontinued. NXP's BF862 has become a "go-to" low-noise part, both quiet and with attractively low capacitance. Toshiba's 2SK170 has been single-handedly kept in stock by large factory purchases by Mouser, and the second-source LSK170 is

Table 8.2 Low-noise JFETs ${ }^{a}$

| Part number |  | $\begin{aligned} & \text { 주 } \\ & \text { ٓㅇ } \end{aligned}$ | $V_{\mathrm{GS}}$ max (V) | IDss |  | $V_{\text {GS(off) }}$ <br> (10nA) |  | gm |  | $\begin{aligned} & \text { @/D } \\ & \text { (mA) } \end{aligned}$ | $R_{\text {on }}$ typ ( $\Omega$ ) | Ciss <br> typ <br> (pF) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0549.jpg?height=168&width=45&top_left_y=221&top_left_x=1393) | Measured noise voltage, $e_{\mathrm{n}}(\mathrm{nV} / \sqrt{ } \mathrm{Hz})$ |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  | min |  | m | min | max | min |  | $f=100 \mathrm{~Hz}$ |  |  |  |  |  | 0kHz, |  |
| SOT-23 | TO-92, etc |  |  | (mA) | (mA) | (V) | (V) | (mS) | (mS) |  |  |  |  | $\mathrm{D}=1 \mathrm{~mA}$ | 100 | 1mA | 5,10mA |
| MMBF4117 | PN4117 |  | N | 40 | 0.03 | 0.09 | -0.6 | -1.8 | 0.07 | 0.21 | m | - | 1.2 | S | 12 | 11 V | at 0 | . 07 mA |
| MMBF4118 | PN4118 | N | 40 | 0.08 | 0.24 | -1 | -3 | 0.08 | 0.25 | m | - | 1.2 | U | 48 | 11nV | $\checkmark$ at 0 | 2mA |
| MMBF4119 | PN4119 | N | 40 | 0.2 | 0.6 | -2 | -6 | 0.10 | 0.33 | m | - | 1.2 | V | 45 | $11.5 n$ | $\mathrm{V} / \Delta$ at | .3mA |
| BFT46 | - | N | 25 | 0.2 | 1.5 | - | -1.2 | 1 | - | m | - | 3.5 | - | - | - | - | - |
| BF511 | - | N | 20 | 2.5 | 7 | -1.5 | - | 4 | - | m | - | $5^{\text {m }}$ | - | 20 | - | 3.8 | - |
| MMBF5457 | 2N5457 | N | 25 | 1 | 5 | -0.5 | -6 | 1 | 5 | m | - | 4.5 | P | $2.8^{\text {f }}$ | - | 2.4 | 2.2 |
| MMBF5458 | 2N5458 | N | 25 | 2 | 9 | -1 | -7 | 1.5 | 5.5 | m | - | 4.5 | - | 11 | - | 3 | - |
| MMBF5459 | 2N5459 | N | 25 | 4 | 16 | -2 | -8 | 2 | 6 | m | - | 4.5 | - | - | - | - |  |
| MMBF5460 | 2N5460 | P | 40 | 1 | 5 | 0.75 | 6 | 1 | 4 | m | - | 5 | - | - | - | - | - |
| MMBF5461 | 2N5461 | P | 40 | 2 | 9 | 1 | 7.5 | 1.5 | 5 | m | - | 5 | - | - | - | - | - |
| MMBF4416 | - | N | 30 | 5 | 15 | - | -6 | 4.5 | 7.5 | m | - | 2.2 | R | 3.9 | 4.7 | 2.8 | 2.6 |
| MMBF5484 | 2N5484 | N | 25 | 1 | 5 | -0.3 | -3 | 3 | 6 | m | - | 2.2 | - | 5 | 4.3 | 2.5 | 2.2 |
| MMBF5485 | 2N5485 | N | 25 | 4 | 10 | -0.4 | -4 | 3.5 | 7 | m | - | 2.2 | - | 2.8 | 4.3 | 2.5 | 2.3 |
| MMBF5486 | 2N5486 ${ }^{\text {n }}$ | N | 25 | 8 | 20 | -2 | -6 | 4 | 8 | m | - | 2.2 | Q | $3 n$ | 5 | $3^{\text {f }}$ | 2.5 |
| MMBF4392 ${ }^{\text {p }}$ | PN4392 | N | 40 | 25 | 75 | -2 | -5 | 16 |  | 10 | 60 | 12 | - | - | - | - | - |
| MMBF4393 ${ }^{\text {P }}$ | PN4393 ${ }^{\circ}$ | N | 40 | 5 | 30 | -0.5 | -3 | 13 |  | 10 | 100 | 12 | J | $1.8^{f}$ | - | 1.8 | 1.4 |
| PMBF4393 | - | N | * | * | * | * | * | * |  | * | * | * | - | 22 | 14 | 5.2 | 3.4 |
| MMBF5103 | PF5103 | N | 40 | 10 | 40 | -1.2 | -2.7 | 7.5 | - | 2 | 30 | $16{ }^{\text {m }}$ | L | 2 | 3.2 | 1.9 | 1.5 |
| - | J107 | N | 25 | 100 | - | -0.5 | -4.5 | 75 |  | 5 | 8 | 35 | F | 1.4 | - | 1.3 | 0.75 |
| PMBFJ109 | J109 | N | 25 | 40 | - | -2 | -6 | 26 |  | 5 | 12 | 15 | - | 7.8 | - | 2.2 | - |
| MMBFJ110 ${ }^{\text {P }}$ | J110 | N | 25 | 10 | - | -0.5 | -4 | 20 |  | 5 | 18 | 15 | - | 1.6 | 3.2 | 1.5 | 0.9 |
| MMBFJ112 ${ }^{p}$ | J112 | N | 35 | 5 | - | -1 | -5 | 17 |  | 25 | $50^{\mathrm{m}}$ | 6 | - | 2 | 3.3 | 1.8 | 1.5 |
| MMBFJ113 ${ }^{\text {P }}$ | J113 | N | 35 | 2 | - | -0.5 | -3 | 12 |  | 5 | $100^{\mathrm{m}}$ | 6 | H | 1.8 | 3.2 | 1.7 | 1.4 |
| MMBFJ309 ${ }^{\text {P }}$ | J309 | N | 25 | 12 | 30 | -1 | -4 | 13 | - | 10 | 50 | 4 | G | 18 | - | 2.6 | 1.3 |
| MMBFJ310 ${ }^{\text {P }}$ | J310 | N | 25 | 24 | 60 | -2 | -6.5 | 13 | - | 10 | 50 | 4 | K | 2 | 4.8 | 2 | 1.5 |
| BF861A | - | N | 25 | 2 | 6.5 | -0.2 | -1 | 12 | 20 | m | - | 7.5 | - | 9 | - | 2.7 | 1.8 |
| BF861B | - | N | 25 | 6 | 15 | -0.5 | -1.5 | 16 | 25 | m | - | 7.5 | - | 9 | - | 1.5 | 1.2 |
| BF862 ${ }^{\text {b }}$ | - | N | 20 | 10 | 25 | -0.3 | -1.2 | 35 | $45^{t}$ | m | - | 10 | E | 1.3 | 2.2 | 1.1 | 0.8 |
| - | 2SK147B ${ }^{\text {d }}$ | N | 40 | 8 | 16 | -0.3 | -1.2 | 40 | - | 5 | - | 75 | - | 1.9 | 2.5 | 1.3 | 0.85 |
| - | IFN147 | N | 40 | 5 | 30 | -0.3 | -1.2 | 30 | $40^{t}$ | m | - | 75m | - | 1.5 | 2.4 | 1.1 | 0.75 |
| - | 2SK170BL ${ }^{\text {C }}$ | N | 40 | 6 | 12 | -0.2 | -1.5 | 10 | - | 1 | - | 30 | B | 1.2 | 2.3 | 1.1 | 0.78 |
| - | LSK170B | N | 40 | 6 | 12 | -0.2 | -2 | 10 | - | 1 | - | 20 | - | 1.3 | 2.3 | 1.0 | 0.78 |
| - | IF3601 | N | 20 | 30 | - | -0.04 | -3 | 750 | - | m | - | 300 | A | 0.65 | 1.8 | 0.6 | 0.38 |

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0549.jpg?height=351&width=1654&top_left_y=1549&top_left_x=114)

PREFIXES: IF = interFET, LS = Linear Integrated Systems, PMB = NXP.
NOTES: $\diamond=\sqrt{ } \mathrm{Hz} . *=$ same as row above. (a) sorted by decreasing voltage noise, and also by part number within a family.
(b) preferred part. (c) complement 2SJ74. (d) discontinued, shown for comparison. (e) mV, max. (f) Fairchild part, others are much noisier. (g) LS840 has an interdigitated die. (k) dual unmatched J310. ( m ) maximum, or $g_{m} @ /$ DSS. ( n ) RF JFET, high 1/f noise from several manufacturers. (o) also MPF4393 from ON Semi. (p) also PMBF- from NXP, very noisy. (t) typical.

[^401]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0550.jpg?height=513&width=792&top_left_y=218&top_left_x=224)

Figure 8.51. Beware unspecified noise parameters: measured voltage noise spectra of six 2N5486 JFET samples from five manufacturers (Fairchild's produced the winning "A" curve). Befitting its intended application as a "High-Frequency Amplifier," some datasheets specify noise performance only at high frequencies (e.g., $\geq 100 \mathrm{MHz}$ ). The slope of $1 / f$ noise is indicated by the dashed line. JFETs "E" and "F" have $2.5 \mu \mathrm{Vrms}$ low-frequency noise (to 1 kHz ).
available directly from Linear Integrated Systems, who also offer a matched dual version of the venerable '170, the LSK389. The excellent IFN146 and IFN147 are available directly from InterFET. Also consider the Fairchild J107, a low-cost switch that can moonlight as a low-noise JFET; with luck it will remain available.
Unspecified "low-noise" transistors An important caution: It is risky to rely on unspecified noise parameters, for instance the assumption (absent a manufacturer's $e_{\mathrm{n}}$ specification) that all transistors of a given part number will exhibit similar noise voltage to that measured in a sample batch. To see what can happen in practice, look at Figure 8.51, where we've plotted the measured noise-voltage spectra of six samples of a 2N5486 n-channel JFET. In fact, transistors even from the same manufacturer and production run may show large variations, as seen in Figure 8.40's measured noise spectra of four power transistors taken from a single batch. Figure 8.52 shows comparisons of the noise characteristics of a number of popular and useful JFETs.

Be aware of JFET weaknesses When we discussed the many considerations in choosing a low-noise bipolar transistor (§8.5.8), one factor of importance was the transistor's output resistance $r_{\mathrm{O}}$ (or, if you prefer, its output conductance, $g_{o e}$ ). For a BJT this is described by its Early voltage ${ }^{65} V_{\mathrm{A}}$, whose measured values are listed in

[^402]Table 8.1a on page 501. Most npn BJTs have fairly high $V_{\mathrm{A}}$ values, which is to say they have a high output resistance, thus ordinarily not a serious concern.

But that's not the case for JFETs. If you tried measuring an analogous "Early voltage" for JFETs, you would be disappointed in their low values. The parameter commonly used to describe the variation of drain current with drain voltage is output conductance, $g_{\text {os }}$, which varies with both drain voltage and drain current. For many JFETs the output conductance (ideally zero) is high enough to have a serious affect on amplifier gain. Because the value of a JFET's $g_{\text {os }}$ is roughly proportional to its transconductance $\left(g_{m}\right)$, we've defined a parameter $G_{\max }=g_{m} / g_{\text {os }}$, which represents the maximum voltage gain of a common-source amplifier with high-impedance drain load. ${ }^{66}$ This parameter is not listed in Table 8.2, but you can find it in the JFET listing of Table 3.7. You need to take it into account when designing a JFET amplifier stage, perhaps circumventing its gain-killing effect by adding a cascode; see §3x.4.

Some JFETs suffer also from a severe drop in transconductance at drain voltages of less than 2 V , especially at high drain currents; see the plots of transconductance versus drain voltage in $\S 3 x$. 2 . If you're thinking of doing anything unusual in a low-noise JFET design, you'd do well to study first the JFET-specific material in Chapters 3 and $3 x$.

## 8.7 Charting the bipolar-FET shootout

Let's have some fun with the graphical noise-charting technique we introduced in §8.5.2. A perennial bone of contention among engineers is whether FETs or bipolar transistors are "better." We dispose of this issue with characteristic humility by matching two of the best contenders and letting them deliver their best punches.

In the bipolar corner we have the magnificent 2SD786, whose vital statistics are displayed in Figure 8.10 and listed in Table 8.1a on page 501. Its noise voltage is $\sim 0.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 1 mA , with an admirably low $1 / f$ noise corner well below 10 Hz ; and its very low $r_{\mathrm{bb}^{\prime}}$ (we measured $2.3 \Omega$ ) allows us to get down to the $0.25 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ territory at higher collector currents. It has plenty of beta, too: above 200 at currents all the way down to $1 \mu \mathrm{~A}$, which is helpful in achieving a low noise-current. It has been a perennial favorite among audio enthusiasts.

The FET entry is the 2SK170 n-channel JFET, known far and wide for its stunning low-noise performance, reputed to exceed that of bipolar transistors. Its very low

[^403]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0551.jpg?height=1519&width=1694&top_left_y=220&top_left_x=102)

Figure 8.52. Measured noise voltage density versus frequency for a selection of JFETs listed in Table 8.2. All data taken at $V_{\mathrm{DS}}=5 \mathrm{~V}$.
measured noise voltage can be seen in Figure 8.54, and its vital statistics are listed in Table 8.2 on page 516. According to its datasheet, it was trained only for drain currents ranging from $200 \mu \mathrm{~A}$ to 10 mA ; but we've conservatively extrapolated its noise parameters down to $100 \mu \mathrm{~A}$, so that we can evaluate it with drain currents ranging from $100 \mu \mathrm{~A}$ to 10 mA . We have high hopes for this fighter, given its very low input-current noise ( $\sim 1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, the shot noise corresponding to its gate leakage current of $\sim 3 \mathrm{pA}$ ). In Figure 8.53 we've charted their total amplifier noise voltage
versus source resistance at 1 kHz , just as we did for the 2N5087. ${ }^{67}$
${ }^{67}$ In our previous edition the contenders were the LM394 self-described "ultra well-matched monolithic NPN transistor pair" $\left(e_{\mathrm{n}}=1 \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$ at $I_{\mathrm{C}}=1 \mathrm{~mA}$, versus $0.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for this edition's 2SD786 championship contestant) and the 2N6483 matched monolithic $n$-channel JFET pair $\left(e_{\mathrm{n}}=4 \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$ at $I_{\mathrm{C}}=100 \mu \mathrm{~A}$, versus $1.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for this edition's 2SK170 entry). This edition's fighters are single transistors, rather than matched monolithic duals. Both contenders from the previous edition are long retired, having fought the good fight for several decades.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0552.jpg?height=778&width=1335&top_left_y=221&top_left_x=376)

Figure 8.53. Comparison of total amplifier input voltage noise density $\left(e_{a}\right)$ at 1 kHz , for the 2 SD 786 npn bipolar transistor (dashed lines) and the 2SK170n-channel JFET (solid lines).

And the winner? Well, it's a split decision. The FET won points on lowest minimum noise figure, $\mathrm{NF}\left(R_{\mathrm{n}}\right)$, reaching a phenomenal 0.0005 dB noise figure (that's a noise temperature of just 33 millikelvin!), and dipping below 0.2 dB from 1 k to 100 M source impedance. For high source impedances, FETs remain unbeaten. The bipolar transistor is best at low source impedances, particularly below $5 \mathrm{k} \Omega$, and it can reach a 0.2 dB noise figure for source resistances $R_{\mathrm{S}}$ from $1-10 \mathrm{k} \Omega$, with a suitable choice of collector current. Although its victory in terms of noise alone is slim, it has other important virtues, notably its superior predictability of $V_{\mathrm{BE}}$ compared with a JFET's loosely characterized $V_{\mathrm{GS}}$.

Just as in boxing, where the best fighters of yesteryear have retired from the rigors of competing, we must remind our readers, with some sadness, that the 2SD786 has been discontinued by Toyo-Rohm; and Toshiba's 2SK170 is sometimes available, sometimes not. However, also as in boxing, there are some younger contenders for the best low-noise transistor who haven't yet had a chance to compete in a world championship. The replacement LSK170 JFET from Linear Integrated Systems performs almost as well as its mentor; and the ZTX851 BJT from Zetex, though unspecified in noise performance, appears to outperform even the champion 2SD786 (as seen in the measured noise spectra of Figures 8.12 and 8.17).

And, if it's really low-noise voltage you want, consider
the IF3601 from InterFET, with its $0.35 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ typical noise voltage even down at 30 Hz ! And this is a JFET, with low input current ( 100 pA typ, hence low $i_{\mathrm{n}}$, about $6 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ ), and thus the noise resistance is about 60 k . When used as an amplifier with a source impedance equal to its noise resistance (i.e., $R_{\mathrm{S}}=60 \mathrm{k}$ ), its performance is unbeatable - the noise figure is 0.001 dB . InterFET and Linear Integrated Systems JFETs must be purchased directly from the manufacturer, but in our experience they're happy to accept small orders.

Before you go out and buy a bushel of these remarkable JFETs, consider the remarks of the critics, who claim it is muscle-bound - it has high input and feedback capacitance $(650 \mathrm{pF}$ and 80 pF , respectively), which limits its usefulness at high frequencies. Its relative, the IFN146, is better in this regard, at the expense of higher $e_{\mathrm{n}}(75 \mathrm{pF}$ and 15 pF , respectively, with $e_{\mathrm{n}}=0.7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). These same critics argue that a bipolar complementary pair like the ZTX851 and ZTX951, with $e_{\mathrm{n}}$ as low as $0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, can offer even better performance at moderate source impedances and frequencies.

### 8.7.1 What about MOSFETs?

The dominant FET species on the planet, by a demographic ratio of at least $10^{12}: 1$, is the MOSFET, of which the JFET is the poor (and neglected) sister. We haven't neglected

JFETs, though, because they're the best choice for discrete low-noise design, particularly when low noise at low frequencies is important (e.g., audio). As will be evident in §8.9, JFETs also dominate as input stages within op-amps where both low input current and low noise voltage are important.

So, what about MOSFETs for low-noise design? One problem is that you cannot get small MOSFETs as discrete parts. And MOSFETs tend to have much higher voltage noise than JFETs, particularly at low frequencies where the $1 / f$ noise dominates - the $1 / f$ knee can be as high as 10 kHz to 100 kHz . Figure 8.54 makes this point dramatically, plotting measured noise-voltage density versus frequency for a selection of representative MOSFETs, JFETs, and BJTs. The quietest BJTs are the winners (with lownoise JFETs not far behind), whereas at these audio frequencies the MOSFETs aren't even in the ballpark (and perhaps not even in the same city). For this reason you wouldn't normally choose a MOSFET for best-in-class low-noise amplifiers below 1 MHz .

MOSFETs are used as low-noise linear amplifiers, however, in the form of integrated circuits intended for radiofrequency applications. At those frequencies their noise performance is good enough, and the CMOS process allows convenient integration and low cost.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0553.jpg?height=817&width=802&top_left_y=1303&top_left_x=119)

Figure 8.54. Comparison of measured noise-voltage spectra for some popular transistors: MOSFETs, JFETs, and BJTs. We included within each species both a "quietest" part and an inexpensive ( $<\$ 0.05$ in quantity) and popular "jellybean."

MOSFETs are used also in "zero-drift" op-amps: their noise voltage density $e_{\mathrm{n}}$ is not impressive - typically in the range of $25-100 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ - but they exhibit no $1 / f$ rise at low frequencies, so they compete as the quietest amplifiers for very low-frequency applications. This is seen clearly in Figure 5.54. ${ }^{68}$

## 8.8 Noise in differential and feedback amplifiers

Low-noise amplifiers are often differential, to obtain the usual benefits of low drift and good common-mode rejection. When you calculate the noise performance of a differential amplifier, there are three points to keep in mind: (a) be sure to use the individual collector currents, not the sum, to get $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ from data sheets; (b) the $i_{\mathrm{n}}$ seen at each input terminal is the same as for a single-ended amplifier configuration; and (c) the $e_{\mathrm{n}}$ seen at one input, with the other input grounded, say, is 3 dB larger than the singletransistor case, i.e., it is multiplied by $\sqrt{2}$.

In amplifiers with feedback, you want to take the equivalent noise sources $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ out of the feedback loop, so you can use them as previously described when calculating noise performance with a given signal source. Let's call the noise terms brought out of the feedback loop $e_{\mathrm{A}}$ and $i_{\mathrm{A}}$, for amplifier noise terms. Thus the amplifier's noise contribution to a signal with source resistance $R_{\mathrm{S}}$ is

$$
\begin{equation*}
e^{2}=e_{\mathrm{A}}^{2}+\left(R_{\mathrm{s}} i_{\mathrm{A}}\right)^{2} \quad \mathrm{~V}^{2} / \mathrm{Hz} \tag{8.37}
\end{equation*}
$$

Let's take the two feedback configurations separately.
Noninverting For the noninverting amplifier (Figure 8.55) the input noise sources become ${ }^{69}$

$$
\begin{align*}
i_{\mathrm{A}}^{2} & =i_{\mathrm{n}}^{2} \quad \mathrm{~A}^{2}(\mathrm{rms})  \tag{8.38}\\
e_{\mathrm{A}}^{2} & =e_{\mathrm{n}}^{2}+4 k T R_{\|}+\left(i_{\mathrm{n}} R_{\|}\right)^{2} \quad \mathrm{~V}^{2}(\mathrm{rms}) \tag{8.39}
\end{align*}
$$

where $e_{\mathrm{n}}$ is the "adjusted" noise voltage for the differential configuration, i.e., 3 dB larger than for a single-transistor stage. The additional noise-voltage terms arise from Johnson noise and input-stage noise current in the feedback resistors. Note that the effective noise voltage and current are now not completely uncorrelated, so calculations in which their squares are added can be in error by a maximum factor of 1.4.

[^404]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0554.jpg?height=348&width=751&top_left_y=204&top_left_x=265)

Figure 8.55. A. Noise model of the op-amp. B. Noise sources in the noninverting amplifier.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0554.jpg?height=264&width=494&top_left_y=692&top_left_x=401)

Figure 8.56. Noise sources in the inverting amplifier.
For a follower, $R_{2}$ is zero, and the effective noise sources are just those of the differential amplifier alone. Note that these drawings and formulas assume that the signal source resistance is zero (or at least small compared with $R_{\|}$, so as not to add Johnson noise). ${ }^{70}$

Inverting For the inverting amplifier (Figure 8.56) the input noise sources become

$$
\begin{align*}
& i_{\mathrm{A}}^{2}=i_{\mathrm{n}}^{2}+4 k T \frac{1}{R_{1}} \quad \mathrm{~A}^{2}(\mathrm{rms}),  \tag{8.40}\\
& e_{\mathrm{A}}^{2}=e_{\mathrm{n}}^{2}\left(1+\frac{R_{1}}{R_{2}}\right)^{2}+4 k T R_{1}\left(1+\frac{R_{1}}{R_{2}}\right) \\
& +\left(i_{\mathrm{n}} R_{1}\right)^{2} \quad \mathrm{~V}^{2}(\mathrm{rms}) . \tag{8.41}
\end{align*}
$$

For differential amplifiers and ordinary op-amps the two input terminals have comparable input noise voltages, and noise currents. This is not true, however, for currentfeedback (CFB) op-amps ( $\S 4$.6), where the noise current at the inverting input is generally much larger than at the non-inverting input.
Operational amplifiers These have differential inputs, so they play by the same rules. Op-amps dominate most analog designs, and for good reason: they are highly evolved and deliver excellent performance. There are thousands of op-amp choices, optimized for various combi-

[^405]nations of parameters that include accuracy, speed, noise, power consumption, and supply voltage. If you can solve a design problem with op-amps, you probably should ${ }^{71}$. Following the theme of this chapter, low-noise design with op-amps is the subject of the next section.

## 8.9 Noise in operational amplifier circuits

Op-amp datasheets specify input noise in terms of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$, just as with transistors and FETs. You'll see tabulated values, and usually plots of $e_{\mathrm{n}}$ and (sometimes) $i_{\mathrm{n}}$ versus frequency. Unlike design with discrete transistors, however, you don't get to adjust internal operating currents and component values - you only get to use them.

There are thousands of op-amps out there, with a good selection of parts aimed at low-noise applications. We've collected some 150 favorites in Tables 8.3a-8.3c, many of whose noise voltage and current density are plotted in Figures 8.60 and 8.61. How to choose among these? There's $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$, of course (and the corresponding $1 / f$ low-frequency corner frequency $f_{\mathrm{c}}$ ). But there are also all the usual performance tradeoffs: accuracy, speed, input current, power dissipation, and price. As an example, at $0.85 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (and $f_{\mathrm{c}}=3.5 \mathrm{~Hz}$ ) the LT1028 is among the lowest $e_{\mathrm{n}}$ op-amps available (curve A in the upper plot of Figure 8.60). But it draws 8.5 mA of supply current, with $\sim 1.8 \mathrm{~mA}$ devoted to the input stage alone. For all the reasons discussed in $\S 8.3-\S 8.6$, you can't match that kind of low-noise voltage in an op-amp whose total supply current is, say, 0.1 mA . And you may not want to: the LT1028's BJT inputs have plenty of bias current, with correspondingly high noise-current density ( $\sim 1 \mathrm{pA} / \sqrt{\mathrm{Hz}}-$ curve A again, this time in the lower plot of Figure 8.60). Put another way, the high-noise current of this low- $e_{n}$ champ wipes out its noise advantage for an input signal of source impedance greater than $1 \mathrm{k} \Omega$ (its noise resistance, $\left.R_{\mathrm{n}} \equiv e_{\mathrm{n}} / i_{\mathrm{n}}\right) .{ }^{72}$

Let's look more closely at low-noise design with opamps. We begin with a guide to the extensive listing in Table 8.3.

[^406]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0555.jpg?height=1894&width=1524&top_left_y=201&top_left_x=187)

Notes: (a) see also op-amp tables in Chapters $4,4 x$, and 5 . (b) 0.01 Hz or 0.1 Hz to 10 Hz . (c) calculated. (d) italics are lower-voltage JFET types. (d1) OP-37 decomp. (d2) OP228 decomp. (d3) OPA637 decomp. (d4) LT1037 decomp. (d5) OPA657 decomp. (d6) ADA4637 decomp. (d7) MAX4237 decomp. (d8) LMP7717 decomp. (g) LTC suggests LT1677, RRIO. (h) LTC suggests LT6200, 6230. (J) at 1 kHz or 10 kHz , except 10 Hz for chopper types. (k) beyond the rail. (p) per amplifier. (q) italics are jellybeans. (s) SC70. (t) typical. (u) datasheet specs are $10 x$ higher. (v) $V_{\mathrm{OS}}$ vs $V_{\mathrm{CM}}$ stable. (w) to 5 V above the rail. ( x ) SOIC is non-std pinout. (y) DIP discontinued, NRND. A: specs at 5 V . B: over-the-top, low $\mathrm{I}_{\mathrm{B}}$ for $\mathrm{V}_{\mathrm{CM}}<\mathrm{V}_{\mathrm{CC}}-0.7$. C: OVP to +32 V . D: LT1012 replacement, w/RRO. E: decomp, $\mathrm{G}>5$. F: original classic. G: noisy classic. H: noisy, cheap; LM321 single. I: zero-drift, CMOS(!). J: improved OP177. K: 0.7ppm dist. L: classic audio. M: "RRIO LT1007."

Table 8.3b Low-noise FET-input Op-amps ${ }^{\text {a }}$

| $\begin{aligned} & 10 \\ & 0 \\ & 0 \\ & 0 \\ & 0 \\ & \end{aligned}$ | Part \# ${ }^{\text {d }}$ | $\begin{aligned} & \text { 을 } \\ & \text { ¿ } \\ & \text { \# } \end{aligned}$ | Supply |  | Input /B <br> @ $25^{\circ} \mathrm{C}$ |  | $V_{\text {os }}$ <br> max <br> (mV) | $T C V_{\text {os }}$ typ $\left(\mu \mathrm{V} /{ }^{\circ} \mathrm{C}\right)$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0556.jpg?height=141&width=60&top_left_y=246&top_left_x=969) | Noise |  |  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0556.jpg?height=148&width=52&top_left_y=244&top_left_x=1288) | GBW <br> (MHz) | Swing to Supply? <br> in IN OUT F) + + - |  |  |  | Cost <br> qty 25 <br> (\$US) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0556.jpg?height=129&width=29&top_left_y=252&top_left_x=1755) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  |  |  | $V_{\mathrm{n}(\mathrm{p}}$ |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
|  |  |  | range ${ }^{d}$ <br> (V) | $\begin{gathered} I_{Q}^{\prime} \\ \left(m A^{p}\right) \end{gathered}$ |  |  | typ <br> (pA) |  |  |  | $\begin{gathered} 10 \mathrm{~Hz}^{\mathrm{b}} \\ (\mu \mathrm{~V}) \end{gathered}$ | $\begin{array}{r} 1 \mathrm{kHz} \\ \left(\mathrm{nV} / \sqrt{ } \mathrm{H}_{2}\right. \end{array}$ | $\begin{gathered} f_{\mathrm{C}}^{\mathrm{C}} \\ \mathrm{z})(\mathrm{Hz}) \end{gathered}$ |  |  |  |  | $\begin{gathered} 1 \mathrm{kHz} \mathrm{z}^{\mathrm{J}} \\ (\mathrm{nV} \cdot \mathrm{pF}) \end{gathered}$ |  |  |
| JFET |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
|  | OPA129B | 1 | 10-36 | 1.2 | 30fAZ | 0.1 |  | 2 | 3 | 80 | 4 | 17 | 310 | 34 | 32,U | 1 | 2 |  |  | - - - - |  | $\cdot$ - | 11.28 | cc |
| ם | AD549KH | 1 | 10-36 | 0.6 | 75fA ${ }^{Z}$ | 0.1 | 0.25 | 2 | 90 | 4 | 35 | 100 | 35 | - | 1 | 1 | - - |  | - | 28.00 |  |
|  | ISL28110 | 1,2 | 9-42 | 2.6 | 0.3 | 2 | 0.3 | 1 | 88 | 0.6 | 6 | 45 | 72 |  | 12.5 | 12 | - - - |  |  | 2.34 | DD |
| ■ | OPA124PB | 1 | 10-36 | 2.5 | 0.35 | 1 | 0.25 | 1 | 100 | 1.6 | 8 | 195 | 24 | 33,P | 1.5 | 3 | - - - |  | - - | 6.40 | EE |
|  | OPA140 | 1,2,4 | 4.5-40 | 1.8 | 0.5 | 10 | 0.12 | 0.35 | 126 | 0.25 | 5.1 | 12 | 51 | H | 11 | 10 | - $\cdot$ $\cdot$ |  | $\cdot$ | 3.89 | FF |
|  | AD8076 | 1 | 5-24 | 6.4 | 0.5 | 5 | 1 | 1 | 89 | 6 | 6.6 | 2000 | 17 | - | 350 | 2.5 |  |  |  | 5.32 | - |
| ■ | AD795 | 1 | 8-36 | 1.3 | 1 | 2 | 0.5 | 3 | 90 | 1 | 8 | 50 | 18 |  | 1.6 | 2.2 |  |  | - | 7.97 | GG |
| ■ | OPA141 | 1,2,4 | 4.5-40 | 1.8 | 2 | 20 | 3.5 | 2 | 120 | 0.25 | 6.5 | 13 | 52 | - | 10 | 8 | - $\cdot$ $\cdot$ |  | $\cdot$ $\cdot$ | 2.36 | FF |
| ■ | OPA1641 | 1,2,4 | 4.5-40 | 1.8 | 2 | 20 | 3.5 | - | 120 | 0.2 | 5.1 | 7 | 41 | f1 | 20 | 8 | - $\cdot$ $\cdot$ |  | $\cdot$ - | 2.76 | FF |
| - | AD8620A | 1,2 | 10-27 | 2.5 | 2 | 10 | 0.25 | 0.5 | 90 | 1.8 | 6 | 1200 | 90 |  | 25 | 15 | - - - - |  | $\cdot$ - | 11.86 | - |
|  | OPA656 ${ }^{\text {d5 }}$ | 51 | 9-13 | 14 | 2 | 20 | 1.8 | 2 | 80 | 4.5 | $7^{\text {x }}$ | 1100 | 20 | T | 230 | 2.8 | - - |  |  | 5.59 | - |
|  | LF412C | 1,2,4 | 10-44 | 3.6 | 50 | 200 | 3 | 7 | 80 | 2.5 | 25 | 45 | 75 | 21 | 3 | 3 | - - - - |  | - - | 1.32 | HH |
|  | OPA171 | 1,2,4 | 2.7-40 | 0.48 | 8 | 15 | 1.8 | 0.3 | 104 | 3 | 14 | 170 | 42 | 18 | 3 | 3 | - $\cdot$ $\cdot$ |  | $\cdot$ $\cdot$ | 0.91 | ZZ |
|  | OPA604 | 1,2 | 9-50 | 5.3 | 50 | - | 5 | 8 | 80 | 1.3 | 11 | 60 | 110 | 16 | 20 | 10 | - - - - |  | - - | 2.57 | JJ |
| $\square$ | OPA134 | 1,2,4 | 5-36 | 4 | 5 | 100 | 2 | 2 | 86 | 1.1 | 8 | 80 | 40 | f3 | 8 | 5 | - - - |  | - - | 1.60 | KK |
|  | OPA2132 | 1,2,4 | 5-36 | 4 | 5 | 50 | 0.5 | 2 | 96 | 1.1 | 8 | 80 | 48 | - | 8 | 6 | - - - |  | $\cdot$ - | 3.81 | - |
|  | LME49880 | 2 | 10-36 | 14 | 5 | - | 10 | 3 | 90 | 1.9 | 7 | 250 | - |  | 25 | - | - - - |  | - - | 2.43 | 0 |
|  | ADA4627B ${ }^{\text {d }}$ | 6 | 9-36 | 7 | 5 | 20 | 0.2 | 1 | 106 | 0.7 | 6 | 60 | 42 | - | 19 | 7 | - - - |  | $\cdot$ - | 15.05 | LL |
|  | LT1793 | 1 | 9-40 | 4.2 | 4 | 20 | 0.9 | 8 | 81 | $0.5^{\text {u }}$ | 5.8 | 30 | 9 | 10 | 4.3 | 1.5 | - - - |  | $\cdot$ - | 3.15 | - |
| $\square$ | OPA627A ${ }^{\text {d }}$ | 1 | 10-36 | 7 | 5 | 20 | 0.28 | 0.5 | 106 | 0.6 | 4.5 | 90 | 32 | L | 16 | 7 | - - - |  | - | 20.82 | - |
|  | LT1792 | 1 | 9-40 | 4.2 | 300 | 800 | 0.8 | 7 | 82 | $0.35^{\text {u }}$ | 4.0 | 30 | 56 | f2 | 4.3 | 14 | - - - |  | $\cdot$ - | 3.15 | - |
| $\square$ | OPA827 | 1 | 8-40 | 4.8 | 15 | 50 | 0.15 | 1.5 | 104 | 0.25 | 3.8 | 25 | 34 | - | 22 | 9 | - - - - |  | - - | 9.22 | MM |
|  | AD743 | 1 | 9.6-36 | 8.1 | 150 | 250 | 1 | 2 | 80 | 0.38 | 2.9 | 35 | 58 | - | 4.5 | 20 | - - - - |  | y - | 7.83 | - |
| CMOS |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
|  | ISL28194 | 1 | 1.8-5.8 | 330nA | 15 | 80 |  | 1.5 | 70 | 10 | 265 | 7 | - | - | 0.004 | - | $\cdot$ $\cdot$ |  | - $\cdot$ | 1.69 | NN |
|  | LPV521 | 1 | 1.6-5.5 | 470nA | 10fA | 1 | 1 | 0.4 | 75 | 22 | 259 | 7 | - | c3 | 0.006 | - |  |  | s | 1.66 | - |
|  | LMC6442A | 2 | 2.2-11 | 950nA | 5fA | 4 | 3 | 0.4 | 102 | 3 | 170 | 0.5 | 33 | 29 | 0.01 | 4.7 | 。 |  | $\cdot$ - | 2.43 | - |
|  | ISL28195 | 1 | 1.8-5.8 | 0.001 | 15 | 80 | 2 | 1.5 | 70 | 4 | 150 | 3 | - | - | 0.01 | - | $\cdot$ $\cdot$ $\cdot$ |  | - $\cdot$ | 1.57 | - |
|  | MAX9911 | 1,2 | 1.8-6 | 0.004 | 1 | 10 | 1 | 5 | 70 | 40 | 400 | 45 | - | - | 0.2 | - |  |  |  | 0.72 | 00 |
|  | ICL7612 | 1 | 2-16 | 0.006 | 0.5 | 30 | 5 | 15 | 70 | 40 | 100 | 500 | - | c4 | 0.044 | - |  | , | $\cdot$ - | 2.87 | PP |
| ■ | LMP2232A | 1,2,4 | 1.8-6 | 0.01 | 20fA | 1 | 0.15 | 0.3 | 81 | 2.3 | 60 | 20 | - | 25 | 0.13 | - |  |  | $\cdot$ $\cdot$ | 3.29 | - |
|  | ISL28158 | 1,2 | 2.4-5.8 | 0.034 | 5 | 35 | 0.3 | 0.3 | 75 | 1.4 | 64 | 26 | - | - | 0.2 | - | $\cdot$ $\cdot$ |  |  | 1.34 | QQ |
| - | AD8603 | 1,2,4 | 1.8-6 | 0.04 | 0.2 | 1 | 0.05 | 1 | 85 | 2.3 | 25 | 50 | 18 | 20 | 0.4 | 2.5 | $\cdot$ $\cdot$ $\cdot$ | - | 。 | 1.36 | - |
|  | LTC6078 | 2,4 | 2.7-6 | 0.055 | 0.2 | 1 | 0.03 | 0.2 | 95 | 1.0 | 18 | 25 | 126 | - | 0.75 | 18 | $\cdot$ $\cdot$ |  | - | 3.54 | RR |
|  | LMV358 | 1,2,4 | 2.7-6 | 0.1 | $<1$ A | <1nA | 7 | 6 | 50 | 55 | 33 | 7000 | - | - | 1.4 | - | - - - |  | s | 0.45 | Z |
|  | TLV2221 | 1 | 2.7-12 | 0.11 | 1 | 150 | 3 | 1 | 70 | 3 | 19 | 100 | 42 | - | 0.51 | 6 | - $\cdot$ $\cdot$ |  | $\cdot$ | 1.20 |  |
|  | MAX4236A ${ }^{\text {d }}$ | 1 | 2.4-6 | 0.35 | 1 | 500 | 0.02 | 0.6 | 84 | 0.9 | 14 | 17 | 53 | c2 | 1.7 | 7.5 | - $\cdot$ $\cdot$ $\cdot$ |  | $\cdot$ $\cdot$ | 1.78 | - |
| - | LMC6001A | 1 | 5-16 | 0.45 | 10fA | 25fA | 0.35 | 2.5 | 83 | 6 | 22 | 270 | - | - | 1.3 | - |  | - | - - | 12.19 | - |
| ■ | LMC6482A | 2,4 | 3-16 | 0.5 | 20fA | 4 | $0.75^{\mathrm{V}}$ | 1 | 70 | 20 | 37 | 900 | 21 | 17 | 1.5 | 3 | $\cdot$ $\cdot$ $\cdot$ |  | $\cdot$ - | 1.88 | SS |
|  | LMV751 | 1 | 2.7-5.5 | 0.5 | 1.5 | 100 | 1 |  | 85 | 0.7 | 6.5 | 45 | - | - | 4.5 | - | - $\cdot$ $\cdot$ $\cdot$ |  | - $\cdot$ | 1.82 | - |
| ■ | OPA376 | 1,2,4 | 2.2-7 | 0.76 | 0.2 | 10 | 0.03 | 0.26 | 76 | 0.8 | 7.5 | 50 | 91 | c1 | 5.5 | 13 | $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ $\cdot$ | 1.32 | TT |
| $\cdot$ | OPA364 | 1,2 | 1.8-5.5 | 0.85 | 1 | 10 | 0.5 | 3 | 74 | 10 | 17 | 2200 | 21 | - | 7 | 3 | $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ $\cdot$ | 2.18 | UU |
| ■ | AD8692 | 1,2,4 | 2.7-6 | 0.85 | 0.2 | 1 | 2 | 0.3 | 68 | 1.6 | 8 | 215 | 35 | - | 10 | 5 | - $\cdot$ $\cdot$ | - | - $\cdot$ | 1.36 | Q |
|  | LMV791 | 1,2 | 1.8-6 | 0.95 | 0.05 | 1 | 1.35 | 1 | 80 | 1.3 | 6.2 | 170 | 105 | - | 14 | 15 | - $\cdot$ $\cdot$ $\cdot$ | - | 。 | 1.42 | - |
| $\cdot$ | TLC4501A | 1,2 | 4-7 | 1 | 1 | 60 | 0.04 | 1 | 90 | 1.5 | 12 | 500 | 56 | - | 4.7 | 8 | - $\cdot$ $\cdot$ | - | $\cdot$ - | 3.06 | VV |
| ■ | OPA743 | 1,2,4 | 3.5-13 | 1.1 | 1 | 10 | 7 | 8 | 66 | 11 | 30 | 2400 | 28 | 26 | 7 | 4 | $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ | 1.58 | - |
|  | LM6211 | 1 | 5-24 | 1.1 | 0.5 | 5 | 2.5 | 2 | 85 | 2.5 | 6 | 500 | 39 | - | 17 | 5.5 | - $\cdot$ $\cdot$ $\cdot$ | - - | $\cdot$ | 2.52 | - |
| $\square$ | LMP7715 ${ }^{\text {d }}$ | ${ }^{8}$ 1,2 | 1.8-6 | 1.15 | 0.05 | 1 | 0.15 | 1 | 85 | 1 | 5.8 | 110 | 105 | - | 17 | 15 | - $\cdot$ $\cdot$ | - |  | 2.05 | - |
|  | LMV710 | 1 | 2.5-5.5 | 1.2 | 4 | - | 3 | - | 50 | 14 | 20 | 1300 | 119 | - | 5 | 17 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ | - | , | 1.21 | WW |
| $\square$ | LMP7721 | 1 | 1.8-6 | 1.3 | 3fA | 20fA | 0.15 | 1.5 | 83 | 2.3 | 7 | 360 | - | - | 17 | - | - $\cdot$ $\cdot$ | - - | - x - | 11.89 | - |
|  | OPA320 | 1,2 | 1.8-6 | 1.45 | 0.2 | 0.9 | 0.15 | 1.5 | 100 | 2.8 | 8.5 | 640 | 35 | - | 20 | 5 | $\cdot$ $\cdot$ $\cdot$ | - | - $\cdot$ | 2.16 | XX |
| $\square$ | AD8616 | 1,2,4 | 2.7-6 | 1.7 | 0.2 | 1 | 0.5 | 1.5 | 80 | 2.4 | 7 | 1300 | 49 | 11 | 24 | 7 | $\cdot$ $\cdot$ $\cdot$ $\cdot$ | - | - $\cdot$ $\cdot$ | 1.52 | - |
|  | TLC2272A | 2,4 | 4.5-16 | 2.4 | 1 | 60 | 1.0 | 2 | 75 | 1.4 | 9 | 325 | 56 | S | 2.25 | 8 | - $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ - | 1.57 | - |
|  | OPA365 | 1,2 | 2.2-5.5 | 4.6 | 0.2 | 10pA | 0.2 | 1 | 100 | 5 | 4.5 | 5600 | 42 | V | 50 | 6 | $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ | 1.75 | XX |
| - | OPA350 | 1,2,4 | 2.5-7 | 5.2 | 0.5 | 10 | 0.5 | 4 | 74 | 14 | 7 | 9000 | 46 | 12 | 38 | 6.5 | $\cdot$ $\cdot$ $\cdot$ | - | $\cdot$ - | 1.67 | - |
|  | LMP2021 | 1,2 | 2.5-5.8 | 1.1 | 25 | 100 | 0.005 | 0.004 | 105 | 0.26 | 11 | flat | 84 | \#\# | 5 | 12 | - $\cdot$ $\cdot$ | - - |  | 2.92 | YY |

N: classic industrial. O: 0.3 ppm dist. P: cross-coupled. Q: 0.6 ppm dist. R: replaces OP-27, OP270. S: 0.25 ppm dist. T: precision. U: 1 ppm dist. V: 0.4 ppm dist. $\mathbf{W}$ : audio version of LT1028. X: 0.1 ppm dist. Y: charge pump. Z: LMV321 single; BJT\& CMOS versions (same p/n!). AA: above the rail to +18 V . BB: 80 mA output drive. CC: lowest $/ \mathrm{B}$ for an HV part. DD: bootstrapped JFETs. EE: substrate pin. FF: 0.5 ppm dist. GG: replaces OPA111. HH: AoE jellybean. JJ: pro audio. KK: 0.8 ppm dist. LL: replaces OPA627, 637. MM: costs less than OPA627. NN: $<1 \mu \mathrm{~W}$. OO: $7.5 \mu \mathrm{~W}$. PP: programmable quiescent current. QQ: low Vos beyond rails. RR: $V_{\text {OS }}$ degrades near $V_{+}$. SS: popular; LMC7101 (single) is similar. TT: e-trim. UU: charge pump, 20ppm dist. VV: 0.3 sec self-cal at power-on. WW: BiCMOS; LMV711 has shdn. XX: charge-pump, RRI. YY: 2nd best chopper. ZZ: CMOS (among several, check out OPA170, 172, 192; also OPA2188).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0557.jpg?height=1893&width=1567&top_left_y=204&top_left_x=168)

Notes: (a) listed within each category by decreasing $e_{\mathrm{n}}$. (c) calculated. (d) see plots in Chapter 5. (g) for $\mathrm{G}=10$ or $\mathrm{G}=20$. ( J) at 1 kHz or 10 kHz (above the $1 / f$ corner), except 10 Hz for auto-zero op-amps. ( n ) within 0.1 V of $\mathrm{V}_{-}$. (p) per amplifier. ( r ) without $C_{\text {comp. }}$ ( s ) SC70 available. (t) typical. (u) a pin sets $G_{\text {min. }}$ (v) the LT1028 has a nasty $\sim 10 \mathrm{~dB}$ noise peak from 200kHz--600kHz. (w) at 100kHz. (x) G=1 with ext comp. Comments: A: 0.1ppm distortion. B: lowest $e_{\mathrm{n}}$; LTC suggests LT6200, LT6230. C: Hill favorite. D: use DDA pkg; Larkin favorite. E: OPA637 for DIP. F: improved SOIC pinout. G: LT6230-10 decomp. H: $1 \%$ dist at 50 MHz . K: $0.03 \%$ dist at 10MHz. L: auto-zero. M: zero crossover.

### 8.9.1 Guide to Table 8.3: choosing low-noise op-amps

Table 8.3 lists a rich selection of op-amps suitable for lownoise applications. Here we provide a guide to the table entries, and advice for selecting op-amps. Because readers interested primarily in low-noise design with op-amps (rather than with discrete transistors) may have skipped over the earlier quantitative discussions of noise in connection with BJTs and JFETs, we restate below many of the basic ideas, with references to the relevant sections and figures. Readers whose route here (to what might be called "the promised land of op-amps") has taken them through the details of discrete design ("the valley of complexity") will find much of this discussion to be a welcome review.

#### A. Table sorting

In Table 8.3a we've listed BJT-input op-amps by increasing supply current $I_{\mathrm{Q}}$, which correlates roughly with decreasing input noise voltage $e_{\mathrm{n}}$. Once the latter falls below $5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, the entries are roughly ordered by decreasing $e_{\mathrm{n}}$. For JFET-input op-amps (Table 8.3b) the entries are listed by increasing input bias current (up to 1 pA ), then by decreasing $e_{\mathrm{n}}$. CMOS op-amps are sorted by increasing $I_{\mathrm{Q}}$, which correlates approximately with decreasing $e_{\mathrm{n}}$. Table 8.3 c is devoted to high-speed op-amps of all types, listed within each category by decreasing $e_{\mathrm{n}}$.

#### B. Supply voltage, high voltage, low voltage

The table presents a good collection of low-noise op-amps, with a number of representative popular op-amps (some of which might well be called "noisy") for comparison. The latter have other attractive features, such as low cost, high slew rate, low input bias current, low capacitance, low power, multiple manufacturers, and so on. The table separates "high-voltage" op-amps, capable of working with $\pm 15 \mathrm{~V}$ supplies (or up to $36-44 \mathrm{~V}$ total supply), from opamps that are limited to low voltages like $5-20 \mathrm{~V}$ maximum.

Note that many of the high-voltage op-amps (especially the bipolar types) can work also at very low supply voltages, as low as 2.2 V to 3 V total. So, for example, a precision "high-voltage" op-amp like the LT1677, which works fine with 3 V total supply, and which allows inputs and outputs to swing to either rail, ${ }^{73}$ is also clearly an excellent low-voltage part. Op-amps whose inputs and outputs can swing to the negative rail qualify to be called "single-

[^407]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0558.jpg?height=531&width=784&top_left_y=219&top_left_x=1077)

Figure 8.57. To minimize input noise voltage you have to run both BJTs and JFETs at relatively high quiescent currents. That trend extends to integrated op-amps, as seen here in a scatterplot of $e_{\mathrm{n}}$ versus $I_{\mathrm{Q}}$ for most of the op-amps in Table 8.3 and in Figures 8.60 and 8.61.
supply" op-amps, regardless of whether you run them from a single positive supply or from dual supplies.

#### C. Supply current $I_{Q}$, and voltage noise

High supply current is also a major consideration for low noise voltage, $e_{\mathrm{n}}$. Table 8.3 includes op-amps with very low $I_{\mathrm{Q}}$, even though these op-amps have much higher noise. For example, the ISL28194 uses only 330 nA but has a high $265 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ noise density. By comparison, the quiet LT1028 has $0.85 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of noise density, but requires 7.4 mA , or $\sim 20,000$ times as much operating current. ${ }^{74}$

Figure 8.57 is a scatterplot of $e_{\mathrm{n}}$ versus $I_{\mathrm{Q}}$ for several hundred op-amps, showing the voltage-noise and supplycurrent tradeoff. You can see how the noise falls by approximately the square root of the operating current. Any part that's within a factor of two of the best-available part at a given supply current might be considered a low-noise opamp. The correlation with supply current is far from perfect. That's because op-amp designers are balancing tradeoffs among many performance parameters, for example high slew rate, low input current, small die size (for small package size and low cost), and so on, at the expense of low noise voltage.

[^408]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0559.jpg?height=1064&width=1554&top_left_y=241&top_left_x=167)

Figure 8.58. Total noise (source resistor plus amplifier, at 1 kHz ) versus source resistance for a selection of low-noise op-amps (letter labels); we've included a few "ordinary" op-amps (number labels) for comparison. The curve labels correspond to those in Table 8.3 and in Figures 8.60 and 8.61. The curves are generated from datasheet values of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$, except for measured values (shown in bold font) for the noise parameters of the classic LM741 and LM358 (unspecified) and the LT1012 (datasheet value in error); the current noise of the LMC6482 is an estimate, as the datasheet value cannot be correct.

#### D. Voltage-noise density, current-noise density: $e_{\mathrm{n}}$, $i_{n}$

Just as with discrete transistors, op-amp noise performance is specified by voltage noise, $e_{\mathrm{n}}$, and current noise, $i_{\mathrm{n}}$, and their variation with frequency; see §§8.3.1 and 8.3.2. Figure 8.58 and its embedded formula show how to combine $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ with the Johnson noise of your circuit's effective source resistance, $R_{\mathrm{s}}$, to find an effective total input noise density for your circuit. Stated simply, there are three sources of noise: the op-amp's input voltage noise, the opamp's current noise flowing through the signal's source impedance, and Johnson noise in the source impedance. These are uncorrelated, so to find the total noise-voltage density you add their squares (units of $\mathrm{V}^{2} / \mathrm{Hz}$ ) and take the square root. Fourteen representative op-amps are shown as examples in Figure 8.58, with the BJT types best at low source resistances and the JFET and CMOS types best at
high resistances. Table 8.3 has datasheet specs for $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ at 1 kHz , from which you can determine what kind of trace a candidate part will make in such a plot.

#### E. Noise plots, $e_{n}$ and $i_{n}$

It's one thing to look at reams of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ values in datasheets, or to scan those values as organized in the three pages of Table 8.3; but it's another thing to compare noisedensity plots, which include $1 / f$ breakpoints and other unique information. Figures 8.60 and 8.61 show plots of datasheet $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ versus frequency for 60 of the op-amps in Table 8.3, where numbers and letters identify the corresponding traces in the plots. ${ }^{75}$ Note how the voltage-noise plots range over a factor of 1000:1 (though most op-amps

[^409]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0560.jpg?height=688&width=802&top_left_y=207&top_left_x=219)

Figure 8.59. The LT1028 op-amp, introduced in 1981, remains the low-noise winner, despite repeated attempts on its title. The input stage runs at high current ( 1.8 mA total) for low $e_{\mathrm{n}}$; and the largeinput transistors keep the current density low, to achieve an impressively low $1 / f$ corner frequency of 3.5 Hz .
are in the range of $1-100 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, whereas the currentnoise plots range over a factor of nearly $10^{6}: 1$. The latter reflects the very large range of dc input bias currents, from femtoamps (for some CMOS parts) to tens of microamps (for high-speed BJT parts), a ratio of $10^{10}: 1$. The noise current goes only as the square root of the $d c$ current, but hey, the square root of $10^{10}$ is still pretty large.

An op-amp with very low voltage noise $e_{\mathrm{n}}$, such as trace A or 3 for the exemplary LT1028 (whose portrait we present in Figure 8.59) in the top panels, generally correlates with a high current noise $i_{\mathrm{n}}$, as seen in the lower panels. This is a common $e_{\mathrm{n}}$ versus $i_{\mathrm{n}}$ tradeoff, which you have to take into account when selecting parts from Table 8.3 and the corresponding noise plots. As an inducement to learn about low-noise design with discrete transistors, look at traces 1 and 2 of Figure 8.61, the noise voltage of a best-in-class BJT and JFET. With parts like these you can achieve lower noise voltage than with any op-amp, creating a "hybrid low-noise op-amp" in which a discrete front-end (for lowest $e_{\mathrm{n}}$ ) combines with an op-amp second stage (to provide gain, and the output stage). We illustrate this in Figures 8.66 and 8.67 in $\S 8.9 .5$. For a full understanding of discrete low-noise design, see $\S \S 8.5$ and 8.6.

In general, BJT op-amps have low $1 / f$ noise-voltage corner frequencies, typically in the range of $1-30 \mathrm{~Hz}$; but beware their generally much higher noise-current corner frequencies, $30 \mathrm{~Hz}-1 \mathrm{kHz}$ or more. This can seriously af-
fect designs with high-value feedback resistors or high signal source impedances.

If you are considering only op-amps with the lowest noise voltage (less than, say, $1.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), no others have a $1 / f$ noise corner as low as the LT1028 and LT1128, at 3.5 Hz . These impressive parts also have a lower noise current than the other contenders. However, be warned that these op-amps have a nasty broad 15 dB noise peak (shown with admirable candor on the datasheet) starting at 150 kHz , and peaking at 400 kHz before fading away above 600 kHz . Other op-amps don't have this problem, but they have much higher corner frequencies $\left(f_{\mathrm{c}}\right)$, as high as 5 kHz for some of the high-speed op-amps.

#### F. $I_{B}$ and $i_{\mathrm{n}}$ for BJT op-amps; $I_{B}$ bias cancellation

Table 8.3 has typical and maximum input bias-current, or $I_{\mathrm{B}}$, values. ${ }^{76}$ In general, the listed current noise $i_{\mathrm{n}}$ comes from shot noise in the base current of a BJT op-amp or from gate leakage in a JFET or CMOS op-amp; so we'd expect the noise spec to be closely related to the bias current by the shot-noise equation $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{B}}}$. But many BJT opamps use an input bias cancellation scheme (see $\S 4 x .10$ ), to reduce greatly the dc bias current, $I_{\mathrm{B}}$. However, the dc current cancellation in this scheme does not reduce the opamp's $i_{\mathrm{n}}$ noise (in fact, it typically increases it, by $\sqrt{2}$ ). These op-amps are identified in the "bias cancel" column of Table 8.3 a , and they typically have $10 \times$ to $40 \times$ more $i_{\mathrm{n}}$ noise than you'd expect from shot noise based on the specified bias current $I_{\mathrm{B}} .{ }^{77}$ This increased $i_{\mathrm{n}}$ noise is reflected in a lower $R_{\mathrm{n}}$ value, but ideally you'll not find the higher current noise and lowered feedback-resistor values to be a problem.
Bias cancellation near the rails Be careful when relying on listed bias currents with bias-cancelled rail-torail input op-amps, because their input bias current rises dramatically as the inputs approach the supply rails (see §5.7.2). Datasheets show this in graphical form, but they generally do not reveal this undesirable behavior in the listed performance data.

#### G. Current-feedback op-amps

Unlike voltage-feedback (VFB) op-amps, currentfeedback (CFB) op-amps (used in wideband applications) generally have much higher dc bias currents and current noise at their "-input" than at their corresponding

[^410]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0561.jpg?height=649&width=1110&top_left_y=216&top_left_x=149)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0561.jpg?height=713&width=1121&top_left_y=868&top_left_x=144)

| $\underline{\text { Bipolar (BJT) }}$ | $\begin{aligned} & I_{\mathrm{Q}, \mathrm{t}}^{\mathrm{p}} \end{aligned}$ | GBW <br> (MHz) |
| :---: | :---: | :---: |
| high voltage ${ }^{\mathrm{a}}$ |  |  |
| J OPA188z ${ }^{\text {2 }} 2188^{z}$ | 0.4 | 2 |
| E OPA209, 2209 | 2.2 | 18 |
| F OPA227, 2227 | 3.7 | 8 |
| D LT1007 | 2.6 | 7 |
| M LT1012 | 0.4 | 0.7 |
| A LT1028 | 7.4 | 75 |
| G NE5534A | 4 | 10 |
| Q AD8021 | 7 | 1000 |
| B AD8597,99 | 5 | 10 |
| low voltage |  |  |
| K AD8099 | 15 | 4000 |
| C ISL28190,290 | 8.5 | 100 |
| JFET |  |  |
| high voltage |  |  |
| P OPA124 | 2.5 | 2 |
| U OPA129 | 1.2 | 1 |
| H OPA140, 2140 | 1.8 | 11 |
| L OPA627 | 7 | 16 |
| Iow voltage |  |  |
| T OPA656 | 14 | 230 |
| R ADA4817 | 19 | 400 |
| CMOS |  |  |
| medium voltage |  |  |
| S TLC2272 | 1.2 | 2.2 |
| low voltage |  |  |
| $\checkmark$ OPA365 ${ }^{\times}$ | 4.6 | 50 |
| N AD8628 ${ }^{\text {2 }}$ 29 ${ }^{\text {Z }}$ | 0.8 | 2.2 |

(a) all have bias cancellation, except for types G and Q.
(p) per channel.
(t) typical.
(x) zero crossover.
(z) zero drift.

Figure 8.60. Voltage and current noise versus frequency for a selection of "low-noise" op-amps featured in Tables 8.3a-c on pages 522524. All are adapted from datasheet plots, with the exception of measured $i_{\mathrm{n}}$ for op-amps G and J . The labels are in order of ascending $e_{\mathrm{n}}$ at 10 Hz . See Figures 8.110 and 8.111 for measured noise spectra of selected op-amps.
"+ input". For CFB op-amps, Table 8.3c gives the currentnoise value for the input with the lowest current and noise. The difference can be as large as a factor of ten. As always, study the datasheet, carefully!

#### H. Noise resistance $R_{n}$

The noise-resistance parameter $R_{\mathrm{n}} \equiv e_{\mathrm{n}} / i_{\mathrm{n}}$ has its own column. This is the value of source resistance that corresponds to the minimum possible amplifier noise figure; see for example $\S 8.5 .1$ and Figure 8.31. But its real usefulness is to let you see at a glance the maximum feedback resistor values you can use: the impedance $R_{\mathrm{S}}$ seen by the op-amp at its inputs should be $5 \times$ to $30 \times$ smaller than the op-amp's
$R_{\mathrm{n}}$ value if you wish to ensure that $e_{\mathrm{n}}$ is the dominant noise source in your circuit; see Figure 8.58. The idea here is that you can't do anything about the $e_{\mathrm{n}}$ value you're stuck with, but you can lower your feedback resistor values to reduce the effect of the op-amp's $i_{\mathrm{n}}$. But don't forget that you've got to keep the signal's source impedance small compared with $R_{\mathrm{n}}$ also. (Also, quite apart from the noise current, you may have to worry about the effects of the $d c$ bias current flowing through the signal's source, which may be a sensor of relatively high dc resistance.) So in the end you may have to give up on your favorite low- $e_{\mathrm{n}}$ op-amp, and select one with lower $i_{\mathrm{n}}$ even if it has higher $e_{\mathrm{n}}$.

There are no $R_{\mathrm{n}}$ values listed for the JFET and CMOS
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0562.jpg?height=1858&width=1050&top_left_y=224&top_left_x=281)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0562.jpg?height=779&width=455&top_left_y=220&top_left_x=1359)
$\frac{\text { JFET }}{\text { high voltage }}$

| 33 | OPA124 | 2.5 | 1.5 |
| :--- | :--- | :---: | :---: |
| 32 | OPA129 | 1.2 | 1 |
| 21 | LF411,12 | 1.8 | 4 |
| 10 | LT1793 | 4.2 | 4.3 |
| 16 | OPA604,2604 | 5.3 | 20 |

CMOS

| medium voltage |  |  |  |
| :--- | :--- | :---: | :---: |
| 17 | LMC6482 | 0.5 | 1.5 |
| 27 | AD8638z | 1 | 1.4 |
| low voltage |  |  |  |
| 12 | OPA350,2350 | 5.2 | 38 |
| 26 | OPA743 | 1.1 | 7 |
| 25 | LMP2231,32 | 0.01 | 0.13 |
| 15 | LTC6081 | 0.33 | 3.6 |
| 29 | LMC6442 | $1 \mu \mathrm{~A}$ | 10 kHz |
| 20 | AD8603 | 0.04 | 0.4 |
| 11 | AD8615,16 | 1.7 | 24 |
| 23 | MAX9617 Z | 0.06 | 1.5 |

Discrete
1 ZTX851 (npn, 10mA)
2 IF3601 (nJFET, 5mA; InterFET)
(a) all have bias cancellation,
except for \#5, 14, 22, and 24.
(p) per channel. (t) typical. (z) zero drift.

Figure 8.61. Voltage and current noise versus frequency, for a selection of "popular" op-amps featured in Table 8.3 on pages 522-524; a low-noise JFET and BJT are included for comparison. All are adapted from datasheet plots, with the exception of measured $e_{\mathrm{n}}$ for op-amps \#22 and \#24 and BJT \#1, and measured $i_{\mathrm{n}}$ for op-amp \#23. The labels are in order of ascending $e_{\mathrm{n}}$ at 10 Hz .
op-amps in Table 8.3. That's because $i_{\mathrm{n}}$ is essentially the shot noise of the input bias current, a parameter that is poorly specified: you see typical values of a picoamp or less, but hedged with maximum values a thousand times larger. And, of course, these are leakage currents, which rise exponentially with temperature. But not to worry the typical room-temperature input currents are sufficiently low that the corresponding $R_{\mathrm{n}}$ values are generally a gigaohm or greater, as seen clearly in Figure 8.58.

#### I. $I_{\mathrm{B}}$ and $i_{\mathrm{n}}$ for JFET and CMOS op-amps

The input bias-current, $I_{\mathrm{B}}$, has typical and maximum values. Usually the $i_{\mathrm{n}}$ shot noise of $I_{\mathrm{B}}$ is calculated in the most optimistic fashion, from the typical value of $I_{\mathrm{B}}$. For BJT op-amps the maximum $I_{B}$ is generally no more than $2 \times$ to $3 \times$ its typical value. But the situation is quite different for JFET and CMOS op-amps, where the maximum-to-typical $I_{\mathrm{B}}$ ratios are much greater, e.g., $60 \times$ for the TLC4501A or $800 \times$ for the LMC6442A. ${ }^{78}$ This is especially true for low-cost parts with impressively low $I_{\mathrm{B}}$ specs. A caution: beware, the input current may be strongly affected by common-mode voltage, and the listed spec is usually with $V_{\text {in }}$ at mid-supply.

Another issue: Table 8.3's listed $I_{\mathrm{B}}$ values are for an optimistic $25^{\circ} \mathrm{C}$. See $\S 5.10 .7$ and Figure 5.38 for the dramatic effect of elevated temperatures on JFET and CMOS op-amps (caused both by ambient and in-box heating, as well as by the op-amp's self-heating, see below). Because of these uncertainties in estimating bias current, you can't say with any precision what the input noise current $i_{\mathrm{n}}$ will be for JFET or CMOS op-amps. You can say, though, that (except at high temperatures) it will be quite a bit less than that of BJT-input op-amps, as revealed in the lower plots of Figures 8.60 and 8.61.

#### J. $I_{B}$ and junction temperature

As we point out in §5.7.2 (and in further detail in $\S 4 x .10$ ), BJT op-amps with bias-current cancellation are very effective at high temperatures (see Figure 5.6) and under some conditions they may offer the lowest $i_{\mathrm{n}}$ performance. This is especially true for low-supply-current op-amps, whose input-stage collector currents are a fraction of their already low $I_{\mathrm{Q}}$. For example, the LT6010A still enjoys under 50 pA typical bias current at $100^{\circ} \mathrm{C}$ (see the datasheet's plot), much lower than the 1200 pA suffered by the OPA134

[^411]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0563.jpg?height=532&width=830&top_left_y=221&top_left_x=957)

Figure 8.62. A desirably low value of $e_{\mathrm{n}}$ at the usual 1 kHz frequency listed in datasheets doesn't tell the whole story. An op-amp with a high $1 / f$ corner frequency $f_{\mathrm{c}}$ will have greater integrated in-band noise voltage, as seen in these four op-amps of comparable $1 \mathrm{kHz} e_{\mathrm{n}}$ values. Note that the effect extends far above the $1 / f$ corner frequency.

CMOS op-amp, which looked superior at $25^{\circ}$ C. However, even in this case the noise current $i_{\mathrm{n}}$ of the hot JFET opamp still wins over the hot BJT op-amp, by about a factor of 5. That is because the BJT's low bias current is the result of excellent bias cancellation, which is fine when you care about dc input current, but which does not reduce the noise current of the much larger uncancelled bias current.

When thinking about elevated temperatures, keep in mind that in-box and on-board temperatures are often significantly higher than the ambient exterior, especially if power circuitry is involved. Some op-amps also experience significant additional self-heating. For example, our favorite OPA627 JFET op-amp dissipates 210 mW when powered with $\pm 15 \mathrm{~V}$ supplies; in the SOIC-8 package this causes the junction temperature to rise $34^{\circ} \mathrm{C}$ above ambient. Unlike some other parts, the OPA627 and '637 are tested realistically, after a warm-up delay. This is partly responsible for their higher cost.

#### K. $1 / f$ noise and the $1 / f$ corner frequency $f_{c}$

Figures 8.60 and 8.61 show increasing noise at low frequencies. This is called $1 / f$ noise, discussed in various circuit contexts, e.g., in $\S \S 5.10 .6,8.1 .3,8.3$, and 8.13. Table 8.3 includes $1 / f$ voltage-noise corner frequencies $f_{\mathrm{c}}$, calculated from datasheet noise parameters via eq'n 8.60. Watch out for op-amps that may have attractively low $e_{\mathrm{n}}$ (as specified at the usual 1 kHz ), but that suffer from high $1 / f$ corner frequencies. If your circuit's bandwidth is less than $\sim 10 f_{\mathrm{c}}$ you should consider its effects.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0564.jpg?height=1371&width=1593&top_left_y=223&top_left_x=252)

Figure 8.63. Integrated in-band noise voltage for a selection of low-noise and popular op-amps, based on datasheet plots and tabulated values of noise-voltage density. The op-amp labels correspond to those in Figures 8.60 and 8.61 and the listings in Table 8.3. See also Figure 5.54 , which includes auto-zero op-amps and extends down to 0.001 Hz .

#### L. Noise, "integrated noise"

Figure 8.62 shows the integrated noise for four low-noise op-amps, the result of adding up (i.e., integrating) the noise density (sometimes called "spot noise") over the operating bandwidth. It has units of voltage (e.g., $\mu \mathrm{Vrms}$ ), in contrast to noise density, which has units of voltage divided by square root of bandwidth (e.g., $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). Sometimes integrated noise is loosely called the "noise voltage," or just the "noise." Integrated noise may be written as $v_{\mathrm{n}}$, or $V_{\mathrm{n}}$, but never $e_{\mathrm{n}}$. In Figure 8.62 the four op-amps have comparable specified $e_{\mathrm{n}}$ at 1 kHz , but widely varying $1 / f$ corner frequencies $f_{\mathrm{c}}$, ranging from $2-400 \mathrm{~Hz}$, producing dramat-
ically different integrated noise when used entirely below 1 kHz . In fact, the ghost of the low-frequency noise is seen lurking up to $\sim 10 \mathrm{kHz}$.

Figure 8.63 plots integrated noise for three dozen opamps. In general JFET op-amps are worse than BJT opamps at low frequencies, and CMOS op-amps are worse still. The plots were calculated from the table's $e_{\mathrm{n}}$ and $f_{\mathrm{c}}$ values, according to eq'n 8.59. At high frequencies, where white noise predominates, the plots simplify to $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{f_{2}}$.

Chopper and auto-zero op-amps (not shown in the figure) do not suffer from $1 / f$ noise, but they suffer from higher voltage noise, and generally excessive current noise.

See Table 5.6 and Figure 5.54; the latter illustrates how chopper op-amps are generally noisier than low-noise BJT op-amps above $1-10 \mathrm{~Hz}$.

#### M. $0.1-10 \mathrm{~Hz}$ peak-peak voltage noise

The $0.1-10 \mathrm{~Hz}$ peak-peak voltage-noise specification $V_{\mathrm{n}(\mathrm{pp})}$ in Table 8.3 is of importance when you are choosing op-amps for low-frequency applications that are sensitive to $1 / f$ noise. The manufacturer usually determines this spec from 10-second oscilloscope measurements of a filtered output (see $\S 8.13$ and Figure 8.64), but it can also be estimated from eq'n 8.59 (which idealizes to a brickwall bandpass characteristic). We have seen manufacturers using single-pole, two-pole $R C$ pairs, and two- or threepole Butterworth filters. Comparing datasheet values for a few hundred op-amps shows that multiplying by a factor of six matches the brick-wall equation's $V_{\mathrm{n}}(\mathrm{rms})$ value to the datasheet's filtered peak-peak value. We used this approach to check the datasheet values, or to obtain calculated values where the manufacturer had none.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0565.jpg?height=417&width=797&top_left_y=1072&top_left_x=119)

Figure 8.64. Datasheets sometimes provide low-frequency noise voltage snapshots, like this one for the AD8675. The corresponding noise spectrum is similar to curve 8 in Figure 8.61. (Adapted with permission of Analog Devices, Inc.)

#### N. Input capacitance $C_{\text {in }}$

Op-amp input capacitance is a serious issue when you are considering $e_{\mathrm{n}} \cdot C_{\text {in }}$ noise in transimpedance amplifiers (TIAs); see §8.11. For some high-impedance sensors, input capacitance acts both as an additional high-frequency load, and it provides a way for high-frequency noise on the power-supply rails to be coupled to the input as noise current. Some op-amps provide both common-mode and differential capacitance values; for these we have taken the larger value for the table (as always, we suggest careful study of the datasheet before embarking on a design).

Quite often, op-amps with low $e_{\mathrm{n}}$ use large area input transistors, with correspondingly greater capacitance, as
can be seen in the $e_{\mathrm{n}}-\mathrm{vs} .-C_{\text {in }}$ scatterplot of Figure 8.65. Ignoring BJT op-amps and noisy op-amps, the trend shows an increasing noise penalty for low input capacitance. But some parts are exceptions, and we consider them to be quite valuable. An excellent JFET op-amp is the LT1793 with a specified $C_{\text {in }}$ of 1.5 pF ; even with its relatively high $e_{\mathrm{n}}$ of $5.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ it still enjoys the lowest $e_{\mathrm{n}} \cdot C_{\text {in }}$ figure of merit, FOM=9 nV-pF. ${ }^{79}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0565.jpg?height=506&width=790&top_left_y=576&top_left_x=975)

Figure 8.65. Op-amps with low voltage noise tend to have higher capacitance; this is especially true of low-noise JFET-input opamps, with their large-area input transistors.

Often we have a high-capacitance sensor, or some input coax cable, etc., so in addition to an $e_{\mathrm{n}} \cdot C_{\mathrm{in}}$ op-amp FOM (with $C_{\mathrm{ext}}=0$ ), we create additional effective $e_{\mathrm{n}} \cdot C_{\mathrm{in}}$ current noise from the external shunt capacitance of, say, 25 pF . Now a low value of $e_{\mathrm{n}}$ becomes more important, and the OPA827, OPA627, and LT1792 are the new winners, with the LT1793 and OPA365 remaining as contenders. The AD743 with its $e_{\mathrm{n}}$ of $2.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ could be the overall winner for $C_{\text {ext }}>25 \mathrm{pF}$, but sadly it's entered the land of NRND ("Not Recommended for New Designs"). We recommend that you grab'em if you can find 'em! Finally, for high- $C_{\text {ext }}$ applications, consider discrete designs (see §8.3 and Figure 8.66) that can outperform the best IC op-amps.

Op-amps with small-geometry low-capacitance input transistors nonetheless suffer from the necessary added capacitance of their input protection devices. Truly lowcapacitance op-amps may be more susceptible to static damage during handling. Bipolar transistors are less susceptible to static damage and tend to have much lower capacitance than low-noise JFET and CMOS op-amps, but their high $I_{\mathrm{B}}$ and $i_{\mathrm{n}}$ values will often preclude their use in

[^412]high-impedance circuits. An exception would be for transimpedance amplifiers above, say, $1-10 \mathrm{MHz}$, but for these applications you'll need to look at the table of high-speed op-amps, Table 8.3c; those parts aren't evaluated here. ${ }^{80}$ If a bipolar op-amp's $C_{\text {in }}$ is unstated, you can often assume that it's in the range of $2-5 \mathrm{pF}$.

### 8.9.2 Power-supply rejection ratio

Quite apart from noise sources within the op-amp, any noise (or interfering signals) on the power-supply rails will couple to the output, attenuated by the power-supply rejection ratio (PSRR). Typical op-amps have pretty good PSRR at low frequencies (roughly $1 / G_{\text {OL }}$, so $80-140 \mathrm{~dB}$ ), but the PSRR drops as $1 / f$ at higher frequencies, allowing substantial supply-noise coupling. Often the highfrequency PSRR is particularly poor with respect to one or the other supply rail because of coupling by the internal compensation capacitor; see $\S 4 x$. 7. For example, at frequencies above 10 Hz , the LT1012 positive-rail PSRR is 25 dB worse than the negative-rail PSRR; and the micropower LT6003's negative-rail PSRR plummets to less than 10 dB at 1 kHz ! Simple $R C$ filtering for the sensitive stages (or a capacitance multiplier, see §8.15.1) can largely solve this problem. Be sure to read the datasheet, though, or you may not even know you have a problem.

### 8.9.3 Wrapup: choosing a low-noise op-amp

In summary, when choosing an op-amp for a low-noise application, begin by restricting your attention to op-amps that meet your other needs, such as accuracy, speed, power dissipation, supply voltage, input and output swing, and the like. Then choose among this subset, based upon their noise parameters. Generally speaking, you want op-amps with low $i_{\mathrm{n}}$ for high signal impedances, and op-amps with low $e_{\mathrm{n}}$ for low signal impedances. As we've seen, the total input-referred squared noise-voltage density is just

$$
\begin{equation*}
v_{\mathrm{n}}^{2}=4 k T R_{\mathrm{sig}}+e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{sig}}\right)^{2} \quad \mathrm{~V}^{2} / \mathrm{Hz} \tag{8.42}
\end{equation*}
$$

where the first term is due to Johnson noise and the last two terms are due to op-amp noise voltage and current. ${ }^{81}$ Clearly the Johnson noise sets a lower bound to the inputreferred noise. Refer back to Figure 8.58 for an easy graphical look at $v_{\mathrm{n}}($ at 1 kHz$)$ as a function of $R_{\text {sig }}$ for a selection

[^413]of low-noise op-amps from Table 8.3;82 these span a representative range of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$, from which you can interpolate for op-amps not shown explicitly.

This plot illustrates graphically the tradeoff between low noise voltage (where the BJT parts - solid lines - are king), and low noise current (where the CMOS parts dashed lines - are the winners). A good low-noise JFET op-amp like the OPA140 combines the best (nearly) of both worlds. But note that the voltage noise of even a simple (and noisy) CMOS part like the LMC6482 is irrelevant when driven by a source resistance anywhere between $1 \mathrm{M} \Omega$ and $10 \mathrm{G} \Omega$, where the op-amp's contribution to the total noise density is negligible.

See Figures 8.60 and 8.61 for op-amp spectral noise plots. For low-frequency amplifier applications see Figure 8.63 , with its plots of total (integrated) rms noise $v_{\mathrm{n}}$ versus bandwidth.

Two cautions: (a) The total noise density plots ( $v_{\mathrm{n}}$ versus $R_{\mathrm{s}}$ ) of Figure 8.58 characterize the performance only at 1 kHz . So an op-amp with a high $1 / f$ noise corner will look considerably worse at, say, 10 Hz . Taking the example of the LMC6482 (curve \#17), its $e_{\mathrm{n}}$ at 10 Hz is $\sim 170 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, aligning it with curve \#29. (b) Likewise, at high frequencies you care about input capacitance (especially in combination with G $\Omega$-scale input impedances), and you care about the noise current generated by the op-amp's noise voltage in combination with the input capacitance $\left(i_{\mathrm{nC}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}\right)$. A quiet JFET op-amp like the OPA627 has nearly triple the input capacitance (because of its large-area input JFET) of its somewhat noisier (and less expensive) OPA656 cousin.

### 8.9.4 Low-noise instrumentation amplifiers and video amplifiers

In addition to the low-noise op-amps, there are some nice low-noise IC instrumentation amplifiers and low-noise preamplifiers. Unlike general-purpose op-amps, these generally have fixed voltage gain, or provision for attaching an external gain-setting resistor. Instrumentation amplifiers, intended for precision differential applications, are discussed extensively in Chapter 5 (§5.13). Those categorized as"video amplifiers" often have bandwidths into the tens of megahertz, though they can be used for low-frequency applications as well. Examples are the TI/Burr-Brown INA103 instrumentation amplifier, and the TI/National

[^414]LMH6517 or Linear Technology LTC6400-series video amplifiers. These amplifiers typically have $e_{\mathrm{n}}$ down in the $1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ territory, achieved (at the expense of high input noise current, $i_{\mathrm{n}}$ ) by running the input transistor at relatively high collector current.

### 8.9.5 Low-noise hybrid op-amps

Back in §8.9.1E we hinted at the possibility of a hybrid low-noise design, in which a low-noise BJT or JFET differential front-end could combine with a conventional op-amp to provide superior noise performance. The simplified circuits in Figures 8.66 and 8.67 show how this can be done, with BJTs and JFETs, respectively. These amplifiers are also a form of composite amplifier, a subject discussed in §4x.5.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0567.jpg?height=766&width=703&top_left_y=895&top_left_x=169)

Figure 8.66. Combining the best of both worlds: a BJT hybrid wideband low-noise op-amp.

#### A. General design issues

Common-mode range In both cases we designed the circuit to provide a substantial common-mode input signal range (at least $\pm 10 \mathrm{~V}$ ), intending this to serve as a generalpurpose low-noise op-amp substitute. For that reason the current sources in the emitter (or source terminal) are biased for compliance to within 2.5 V of their respective rails, and the collector load resistors ( $R_{1}$ and $R_{2}$ ) in the BJT design are sized to drop only 3 V (thus accommodating negative input swing to at least -12 V ). The JFET design is
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0567.jpg?height=776&width=713&top_left_y=219&top_left_x=1016)

Figure 8.67. Another hybrid op-amp, this time with differential JFET cascode front-end.
similarly biased; however, a volt or two is lost in the cascode transistors ( $Q_{3}$ and $Q_{4}$ ) and in the negative $V_{\mathrm{GS}}$ of the input stage, reducing the positive common-mode input range to approximately $+10 \mathrm{~V}^{83}$

Offset trim In the BJT circuit we used one of the quietest available transistors we found in our tests (the Zetex ZTX951); it is not available as a matched pair, so we provided an offset trim $R_{3}$, with a relatively large adjustment range ( $\pm 6 \%$ ). For the JFET circuit we used the LSK389 "matched" dual, but its worst-case offset of 20 mV mandates an even larger trim range, here $\pm 17 \%$. Ironically, the discrete BJT pair's $V_{\mathrm{BE}}$ mismatch is likely to be less than that of the matched JFET dual; at least that's been our experience; see, for example, the histogram of measured $V_{\mathrm{BE}}$ 's in Figure 8.44.

It's important to realize that a simple offset-trim circuit that unbalances the load resistances, as shown here, greatly compromises the common-mode rejection ratio of the differential input. Additionally, the unbalanced load greatly compromises attenuation of noise in the current source (which would be at least $\times 50$ with $1 \%$ load resistors). A better method involves balancing the currents seen at the collector (or drain) load resistors; see for example Figure 8.80 later in the chapter.
Minimum closed-loop gain Because there's voltage

[^415]gain in the transistor front-ends of these hybrid amplifiers (about $\times 120$ for the BJT, $\times 12$ for the JFET), the overall loop gain is substantially greater than that of the secondstage op-amp alone (which by itself is quite high, roughly 160 dB at low frequencies). To ensure stability (given that the OPA277 is unity-gain stable), these hybrid amplifiers should be configured with a closed-loop gain of at least $\times 100$ and $\times 10$, respectively. ${ }^{84}$

#### B. Some detailed design issues

Choice of transistors Although its noise voltage is unspecified, we found excellent noise performance (and good consistency) with some Zetex bipolar transistors, notably their ZTX851 (npn) and ZTX951 (pnp). The latter were slightly better, with a measured input noise voltage corresponding to an admirably low base resistance of $r_{\mathrm{bb}} \sim 1.2 \Omega$ (thus, e.g., an $e_{\mathrm{n}}$ of $0.17 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 10 mA collector current), compared with $r_{\mathrm{bb}^{\prime}} \sim 1.4 \Omega$ for the npn ZTX851. ${ }^{85}$ For the JFET circuit we chose the lownoise LSK389B from Linear Integrated Systems; it specifies $e_{\mathrm{n}}=0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (typ) and $1.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (max) at a drain current of $2 \mathrm{~mA} .^{86}$ It's a large-geometry JFET (for low noise), with a correspondingly large capacitance of $C_{\text {iss }}=25 \mathrm{pF}$. It has pleasantly high transconductance, specified as $20 \mathrm{mS}(\mathrm{min})$ at 3 mA drain current.

Input current The BJT has the expected high input current, of course, given the relatively high collector current needed to keep $e_{\mathrm{n}}$ low; with the specified $\beta=200$ (typ) the input current is $10 \mu \mathrm{~A}$. That's the price you pay for the lowest $e_{\mathrm{n}}$. By comparison, the JFET circuit's input current is down in the 1 pA territory, judging from the graph of "excess gate current" shown for its predecessor 2SK389 (the LSK389 provides no analogous graphs or specification), and given the very low $V_{\mathrm{DS}}$ enforced by the cascode.

Overall noise voltage These are differential input stages, so you need to multiply the single-transistor $e_{\mathrm{n}}$ 's by $\sqrt{2}$, which results in the values shown in the figures.

[^416]For the JFET version, with its lower front-end gain, there is a small contribution also from the op-amp's input noise $(3 \mathrm{nV} / \sqrt{\mathrm{Hz}})$, but when referred to the input that amounts to just $0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, negligible in the total when combined with the larger front-end squared noise-voltage density.

Note that these are quiet amplifiers - so you need to present their inputs with low signal-source impedances to retain their low $e_{\mathrm{n}}$. For the BJT version, for example, that implies a resistor value down around $10 \Omega$ in the lower leg of the feedback divider.

Differential input voltage If your application can expose the differential BJT hybrid op-amp to more than $\pm 5 \mathrm{~V}$, add a pair of protective back-to-back diodes to prevent base-emitter breakdown and consequent transistor degradation. The differential JFET hybrid op-amp can be safely exposed to full-rail differential-input voltage. These opamp input stages are running at rather high currents, so a substantial input voltage difference, maintained for more than a few milliseconds, will cause unbalanced heating and consequent input offset voltage. It's a good idea to thermally couple the input pair, and perhaps thermally isolate them from air currents as well.

## 8.10 Signal transformers

As mentioned earlier in §8.5.6, you're up against the wall when trying to minimize amplifier noise with a signal of very low source impedance $Z_{\mathrm{s}}$, say less than $100 \Omega$. The noise voltage of a $50 \Omega$ resistor, for example, is just $0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, which puts you down at the limit of the quietest op-amps. And there are signal transducers with considerably lower resistance, for example magnetic coil pickups. If you are interested only in ac signals (as you would be, for a magnetic coil), you can use a transformer to raise the signal level (by the turns ratio, $n: 1$ ), simultaneously raising the source impedance seen at the amplifier's input by that ratio squared; i.e., the amplifier sees a signal of source impedance $n^{2} Z_{\mathrm{s}}$.

High-quality signal transformers are available from companies such as Jensen Transformers and Signal Recovery. For example, a signal in the audio band (say from 100 Hz to 10 kHz ) with source impedance of $100 \Omega$ would be a poor match for an amplifier like the SR560, whose lowest noise figure occurs for signals of source impedance around $500 \mathrm{k} \Omega$ (see Figure 8.27). The problem is that the amplifier's voltage noise is much larger than the signal source's Johnson noise; the resultant noise figure for that signal connected directly to the amplifier would be 12 dB . By using an external step-up transformer like the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0569.jpg?height=37&width=817&top_left_y=221&top_left_x=117) impedances), the signal level is raised (along with its source impedance), thus overriding amplifier noise voltage. At this signal impedance the amplifier's noise figure is about 0.4 dB ; however, the resistance of the transformer's windings ${ }^{87}$ contributes to produce an overall noise figure of about 1.5 dB .

There's a tendency to associate transformers with mediocre performance; but well-engineered signal transformers like this one are pretty good: response $\pm 0.15 \mathrm{~dB}$ over the audio band ( $20 \mathrm{~Hz}-20 \mathrm{kHz}$ ), down 3 dB at 2.5 Hz and 90 kHz , distortion less than $0.1 \%$ even at $20 \mathrm{~Hz},{ }^{88}$ and, as a bonus, common-mode rejection of 110 dB at 60 Hz . The Model 1900 signal transformer from Signal Recovery (originally from Princeton Applied Research) offers turns ratios of 1:100 and 1:1000. It has less bandwidth than the JT-115K-E, but it achieves a minimum noise figure of $\sim 0.5 \mathrm{~dB}$ for source resistances in the $0.8-10 \Omega$ range owing to its low winding resistance of $0.04 \Omega$. This is somewhat better noise performance than the paralleled-BJT amplifier of §8.5.9; because of transformer limitations, however, it does not work over the full audio band.

At radio frequencies (e.g., beginning around 100 kHz ) it is extremely easy to make good transformers, both for tuned (narrowband) and broadband signals. At these frequencies it is possible to make broadband "transmissionline transformers" of very good performance. It is at the very low frequencies (audio and below) that transformers become problematic.

Three comments:
(a) The voltage rises proportional to the turns ratio of the transformer, whereas the impedance rises proportional to the square of the ratio. Thus a $2: 1$ voltage step-up transformer has an output impedance four times the input impedance (this is mandated by conservation of energy).
(b) Transformers aren't perfect. They are susceptible to magnetic pickup, and they have trouble at low frequencies (magnetic saturation) and at high frequencies (winding inductance and capacitance), as well as losses from the magnetic properties of the core and from winding resistance. The latter is a source of Johnson noise, as well. Nevertheless, when dealing with a signal of very low source impedance, you may have
${ }^{87}$ At low frequencies this is simply the dc resistance of the copper wire; but at higher frequencies the effective noise-generating resistance rises owing to the skin effect; see Appendix H (§H.1.4) and §1x.1.
${ }^{88}$ Low frequencies are a transformer's Achilles' heel; at 1 kHz this particular transformer's distortion is just $0.001 \%$.
no choice, and transformer coupling can be very beneficial, as the preceding example demonstrates. Exotic techniques such as cooled transformers, superconducting transformers, and SQUIDs (superconducting quantum interference devices) can provide good noise performance at low impedance and voltage levels. With SQUIDs you can measure voltages of $10^{-15} \mathrm{~V}$ !
(c) Again, a warning: don't attempt to improve performance by adding a resistor in series with a low source impedance. If you do that, you're just another victim of the noise-figure fallacy.

### 8.10.1 A low-noise wideband amplifier with transformer feedback

Lest we leave the reader discouraged as to the merits of transformers in signal applications, we hasten to point out that some very impressive performance can be gotten with careful engineering. Figure 8.68 shows a nice example: a wideband low-noise amplifier with high input impedance, ${ }^{89}$ with a transformer providing lossless (therefore noiseless) feedback to set the voltage gain via the turns ratio (here $\times 10$ ). The transformer nicely solves also the problem of distributing identical feedback to multiple paralleled input JFETs, each of which is biased to the same 10 mA drain current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0569.jpg?height=767&width=808&top_left_y=1295&top_left_x=971)

Figure 8.68. Transformer feedback to paralleled JFETs achieves $650 \mathrm{pV} / \sqrt{\mathrm{Hz}}$ input noise voltage in this wideband amplifier.

[^417]The transformer shown is a small ( 6.5 mm O.D.) highmu tape-wound toroid, with just a few turns in the windings to set the high end of the operating band to 75 MHz . That choice limits the low frequency end to frequencies above $\sim 10 \mathrm{kHz}$, but the nearly $10,000: 1$ frequency range is mighty impressive. The source pull-down resistors $R_{2}$ and $R_{3}$ set the drain current of the BF862 input JFETs to 10 mA (their specified minimum $I_{\mathrm{DSS}}$ ), where their voltage noise is $0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$; the parallel pair improves that by $\sqrt{2}$, thus $0.65 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Bipolar pnp $Q_{3}$ forms an inverted cascode, with its $r_{\mathrm{e}}$ of $12 \Omega$ diverting essentially all of the input transistors' drain signal. Both $Q_{3}$ and $Q_{4}$ are wideband transistors ( 5 GHz ); $Q_{3}$ 's collector current is chosen to cancel the dc magnetization induced in the transformer by the input transistors to prevent core saturation. The supply rails need to be quiet, best achieved with a capacitance multiplier (\$8.15.1). A caution: this feedback circuit has two low-frequency breakpoints (from $C_{2}$ and from the transformer's rather low magnetizing inductance), leading to potential instability and a low-frequency motorboatingtype oscillation. This is prevented here by the large capacitance of $C_{2}$, which puts its breakpoint far below that of the transformer.

## 8.11 Noise in transimpedance amplifiers

Transresistance amplifiers (or transimpedance amplifiers, "TIA," or sometimes just "current amplifiers") produce a voltage output in response to a current input. Their gain is therefore $V_{\text {out }} / I_{\mathrm{in}}$, with units of ohms, hence their name. ${ }^{90}$ We introduced transresistance amplifiers in Chapter 4 (\$4.3.1), we evolved a TIA design for an inexpensive lightning detector (\$8.5.7, Figure 8.36); and we look at issues of their feedback stability in $\S 4 x$.3. As a reminder, the basic circuit, which we've seen before, is shown in Figure 8.69. Assuming ideal components, a current $I_{\text {sig }}$ produces an output $V_{\text {out }}=-I_{\mathrm{sig}} R_{\mathrm{f}}$, so the gain is simply $-R_{\mathrm{f}}$. They are used extensively in circuits where the input is a current, for example from a photodiode or photomultiplier, charged particle detector, tunneling microscope, or patchclamp amplifier.

The emphasis in this chapter is noise, which can arise in several ways in the TIA. The amplifier itself will have its input $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$; and the feedback resistor creates a Johnson noise voltage that equates to an input

[^418]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0570.jpg?height=321&width=450&top_left_y=212&top_left_x=1242)

Figure 8.69. Transresistance amplifier: current in, voltage out.
noise current $i_{\mathrm{nR}}=\sqrt{4 k T / R_{\mathrm{f}}}$ (thus favoring high values of $R_{\mathrm{f}}$ ). Capacitance also plays an important role, not only in stability and bandwidth, but also in converting the amplifier's noise voltage into a noise current. There's also likely to be what we might call signal noise: shot noise in the signal current, Johnson noise in the signal source's resistance, and other forms of signal fluctuation. ${ }^{91}$ Let's see how this all plays out.

### 8.11.1 Summary of the stability problem

As we saw back in §4.3.1C (and which we discuss in greater detail in $\S 4 x .3$ in Chapter $4 x$ ), capacitance to ground at the input (e.g., from a current-output sensor and its connecting cable), in combination with the (usually large) feedback resistance, produces a lagging phase shift in the feedback path. This is unstable when combined with the op-amp's $90^{\circ}$ (or more) lagging phase shift. You cure this by putting a small capacitor $C_{\mathrm{f}}$ across the feedback
${ }_{91}$ Noise in the signal source itself may, in some situations, dominate over the noise contribution of a well-designed amplifier. Optical detectors, for example, are characterized by a "noise-equivalent power" (NEP), which is their electronic noise output stated in terms of optical input power (expressed as optical noise power density, generally in the range of $\mathrm{fW} / \sqrt{\mathrm{Hz}}$ ). The NEP arises from the detector's dark current (a perfect detector would have zero NEP), a "drift current" that can be thought of as a form of leakage. You get such current when photodiodes are operated with a deliberate reverse-bias voltage (the so-called photoconductive mode), in which the capacitance is reduced, and the speed, linearity, and long-wavelength conversion efficiency are improved. If you want to detect very low light levels, and are willing to sacrifice speed, you should operate the photodiode with zero bias (the so-called photovoltaic mode), where the greatly reduced NEP arises mostly from a "diffusion current" related dark resistance, powered by the op-amp's offset voltage. For this purpose the photodiode's datasheet usually assumes a 10 mV offset (i.e., detector bias), but you can almost always do better than that. We've measured dark-adapted NEP levels four orders of magnitude better than specified, when driving an op-amp with $100 \mu \mathrm{~V}$ offset in a cool laboratory setting. Taking account of detector noise is an essential part of any system design whose ultimate job is to "convert photons into volts."
resistor (see $\S 4 x .3$ for details), which, however, seriously reduces the usable bandwidth. As we saw, you therefore need to use an op-amp of surprisingly high bandwidth in order to get even a modest circuit bandwidth. To put numbers on it, the circuit's usable bandwidth $f_{\mathrm{c}}$ is roughly the geometric mean of the op-amp's GBW (or $f_{\mathrm{T}}$ ) and the rolloff frequency, $f_{\mathrm{RC}}=1 / 2 \pi R_{\mathrm{f}} C_{\mathrm{in}}$, of the input capacitance; that is

$$
\begin{equation*}
\mathrm{GBW}=f_{\mathrm{c}}^{2} / f_{\mathrm{RCin}} \tag{8.43}
\end{equation*}
$$

### 8.11.2 Amplifier input noise

A transimpedance amplifier input stage, whether discrete or op-amp, will have some noise voltage and current, characterized by densities $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$; these will exhibit the, bynow, usual $1 / f$ rise at low frequencies. And, in addition to the low-frequency noise tail, the current noise will depend on the dc input current (bias current, for BJTs; leakage current for JFETs or MOSFETs), because at mid-frequencies the input noise current is simply shot noise of the dc current.

How do $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ affect the TIA's overall input noise? We'll see presently (\$8.11.3) that $e_{\mathrm{n}}$ generates a noise current through the capacitance seen at the input, and in fact this can easily become the dominant noise term, particularly at higher frequencies. Before worrying about that effect, note simply that the input $e_{\mathrm{n}}$ flows through the feedback resistor, generating a noise-current density $i_{\mathrm{n}}=e_{\mathrm{n}} / R_{\mathrm{f}}$ (and if the signal source has a finite source resistance, replace $R_{\mathrm{f}}$ with $R_{\mathrm{f}} \| R_{\mathrm{S}}$ ). These terms are usually small compared with the corresponding Johnson-noise currents, but they can grow to significant levels at low frequencies where the $1 / f$ behavior may raise $e_{\mathrm{n}}$ by factors of $10 \times$ to $50 \times$ over its mid-frequency ("white") value. ${ }^{92}$

The current noise $i_{\mathrm{n}}$ of the input stage needs no conversion - it contributes directly to the TIA's equivalent input noise current (as square root of sum of squares). Lowbias op-amps with FET inputs (as well as discrete JFETs) will generally have quite low input-noise currents, down in the $\mathrm{fA} / \sqrt{\mathrm{Hz}}$ territory. But watch out for rising $1 / f$ noise: the datasheet for the low- $e_{\mathrm{n}}$ JFET AD743, for example, shows $i_{\mathrm{n}}$ rising from its mid-frequency $7 \mathrm{fA} \sqrt{\mathrm{Hz}}$ value to

[^419]$100 \mathrm{fA} \sqrt{\mathrm{Hz}}$ at 1 Hz ; that would correspond to the shot noise from a dc bias of 30 nA ! (Its typical room temperature input current is specified as 0.15 nA .) Watch out, also, for rising $i_{\mathrm{n}}$ (from rising leakage current in FETs) at elevated temperatures: the AD 743 specifies $i_{\mathrm{n}}$ only at $25^{\circ} \mathrm{C}$ (where it's $7 \mathrm{fA} \sqrt{\mathrm{Hz}}$ value is consistent with shot noise in 0.15 nA dc input current); but you can use their plot of dc input current versus temperature to find that $i_{\mathrm{n}}=40 \mathrm{fA} \sqrt{\mathrm{Hz}}$ at $80^{\circ} \mathrm{C}$ (where the plot shows a dc input current of 5 nA ) and rising further to $400 \mathrm{fA} \sqrt{\mathrm{Hz}}$ at $125^{\circ} \mathrm{C}$.

Temperature isn't the only contributor to JFET input current; there's the impact-ionization effect (§3.2.8), which can cause a devastating rise in input current (and noise) when a JFET is operated with drain-to-source voltages greater than a few volts. With a discrete JFET design you can prevent this by operating at low drain voltage (e.g., with a cascode); low-noise op-amps usually are designed with this effect in mind, but you will see increased input current (and current noise) as the input voltage approaches one of the rails (e.g., the positive rail for the LT1792 or ADA4627; the negative rail for the AD8610).

### 8.11.3 The $e_{n} \boldsymbol{C}$ noise problem

In addition to the input stage's contributions of $i_{\mathrm{n}}$ (directly) and $e_{\mathrm{n}}$ (flowing through the feedback and input resistances), input capacitance (already an annoyance in terms of stability and bandwidth) creates interesting noise problems as well. For example, you might at first think that amplifier voltage noise is of little concern in an amplifier whose input is a current; because its feedback looks like a voltage follower, it would seem to produce at most an additive output voltage-noise contribution just equal to the input-voltage noise $e_{\mathrm{n}}$ (equivalent to an input-currentnoise contribution of $\left.i_{\mathrm{n}}=e_{\mathrm{n}} / R_{\mathrm{f}}\right)$. But you would be wrong! To see what happens, look at Figure 8.70, where the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0571.jpg?height=345&width=549&top_left_y=1797&top_left_x=1098)

Figure 8.70. The capacitance at the input causes the amplifier's voltage noise $e_{\mathrm{n}}$ to create an input current noise $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}$. Neither this " $e_{\mathrm{n}} C$ " current noise nor the amplifier's own input current noise is shown.
op-amp's internal differential-noise voltage $e_{\mathrm{n}}$ is modeled as a voltage in series with the noninverting terminal. Feedback forces the inverting terminal (with its capacitance $C_{\text {in }}$ to ground) to follow, creating an actual input current $i_{\mathrm{n}}(t)=C_{\mathrm{in}} d v_{\mathrm{n}}(t) / d t$ (where $v_{\mathrm{n}}(t)$ is the op-amp's input noise voltage); expressed as a noise density, we get

$$
\begin{equation*}
i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}=2 \pi e_{\mathrm{n}} C_{\mathrm{in}} f \tag{8.44}
\end{equation*}
$$

That is, the amplifier's voltage noise creates a noise current proportional to the capacitance at the input, and rising proportional to frequency. We refer to this input-noise current, produced by the amplifier's internal noise voltage, as " $e_{n} C$ noise." ${ }^{33}$

### 8.11.4 Noise in the transresistance amplifier

Let's apply this kind of thinking to figure out the noise performance of the transresistance amplifier we looked at in $\S 4 x .3$. We've redrawn it in Figure 8.71, with the op-amp's input-noise voltage $e_{\mathrm{n}}$, noise current $i_{\mathrm{n}}$, and shunt feedback capacitor $C_{\mathrm{f}}$ shown explicitly. In a typical high-speed (small-area) photodiode application you might have $C_{\mathrm{in}} \sim 10-20 \mathrm{pF}$ (but more if connected through a shielded cable), $R_{\mathrm{f}} \sim 1-10 \mathrm{M} \Omega$, and, for a FET-input op$\mathrm{amp}, e_{\mathrm{n}} \sim 3-10 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $i_{\mathrm{n}} \sim 1-10 \mathrm{fA} / \sqrt{\mathrm{Hz}}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0572.jpg?height=412&width=605&top_left_y=1284&top_left_x=320)

Figure 8.71. Noise in a photodiode amplifier. For the calculations we've used $R_{\mathrm{f}}=1 \mathrm{M} \Omega$. Here $C_{\mathrm{in}}$ is the total capacitance seen at the input (amplifier, wiring, and input device capacitances).

We'll calculate the noise contributions (from $e_{\mathrm{n}}, i_{\mathrm{n}}$, and from Johnson noise in the feedback resistor) as effective current noise (versus frequency) at the input; after all, that's where the input current signal that we care about enters. For the time being we ignore the capacitor $C_{\mathrm{f}}$, and use typical circuit values of $R_{\mathrm{f}}=1 \mathrm{M}$ and $C_{\text {in }}($ circuit $)=10 \mathrm{pF}$.

[^420]As we saw earlier, Johnson noise is flat with frequency, with a noise voltage $e_{\mathrm{n}}=\sqrt{4 k T R}$ volts per square root hertz; this translates to a short-circuit noise current of $e_{\mathrm{n}} / R$; that is, $i_{\mathrm{n}}=\sqrt{4 k T / R} \mathrm{amps}$ per square root hertz. So for a $1 \mathrm{M} \Omega$ feedback resistor at $25^{\circ} \mathrm{C}$,

$$
i_{\mathrm{n}}=\left(\frac{4 k T}{R_{\mathrm{f}}}\right)^{\frac{1}{2}}=1.28 \times 10^{-10} R_{\mathrm{f}}^{-\frac{1}{2}}=0.128 \mathrm{pA} / \sqrt{\mathrm{Hz}}
$$

This is one to two orders of magnitude larger than the amplifier's input current noise, which we can therefore ignore. The last contribution is from the amplifier's $e_{\mathrm{n}}$, which, as we remarked earlier, looks like an input current noise $i_{\mathrm{n}}=2 \pi e_{\mathrm{n}} C_{\mathrm{in}} f$. It rises proportional to frequency, becoming dominant over resistor Johnson noise at some crossover frequency that we'll call $f_{\mathrm{X}}$. By equating the Johnson-noise current with the $e_{\mathrm{n}} C$ current, you can find ${ }^{94}$

$$
\begin{equation*}
f_{\mathrm{X}}=\frac{\sqrt{4 k T / R_{\mathrm{f}}}}{2 \pi e_{\mathrm{n}} C_{\mathrm{in}}} \tag{8.45}
\end{equation*}
$$

It would continue to rise forever, except for the effect of the parallel capacitance $C_{\mathrm{f}}$, which causes the noise current to flatten off at a frequency $f_{\mathrm{c}}=1 / 2 \pi R_{\mathrm{f}} C_{\mathrm{f}}$ (caused by the $R_{\mathrm{f}} C_{\mathrm{f}}$ pole cancelling the $+6 \mathrm{~dB} /$ octave rising $e_{\mathrm{n}} C$ noise). If we further choose $C_{\mathrm{f}}$ so that $f_{\mathrm{c}}$ equals the geometric-mean frequency ${ }^{95}$

$$
\begin{equation*}
f_{\mathrm{GM}}=\sqrt{f_{\mathrm{RCin}} f_{\mathrm{T}}} \tag{8.46}
\end{equation*}
$$

we produce a slight peaking at $f_{\mathrm{c}}$, with the pair of poles causing the $e_{\mathrm{n}} C$ noise to fall at $-6 \mathrm{~dB} /$ octave (i.e., $\propto 1 / f$ ) at higher frequencies, as seen in Figure 8.72.

In Figure 8.72 we've plotted $i_{\mathrm{n}}$ (input) for the transresistance amplifier of Figure 8.71, with $R_{\mathrm{f}}=1 \mathrm{M}$, for the opamp choices and corresponding data shown in the figure's table. The plot shows clearly the reduction in input-referred total noise current that you get by choosing an amplifier with low input capacitance and low noise voltage, assuming of course that you are planning to limit the output bandwidth with a later stage of lowpass filtering.

It's interesting to note that, if all other things were equal, an op-amp with greater amplifier bandwidth would not reduce the input-referred noise current; it would simply extend the bandwidth of the transresistance amplifier. However, because faster op-amps tend to have less input capacitance, there is some noise advantage, particularly when the external input capacitance is as low as we've assumed here.

[^421]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0573.jpg?height=524&width=799&top_left_y=223&top_left_x=116)

| Op-amp | $e_{n}$ $(\mathrm{nV} / \sqrt{\mathrm{Hz}})$ | Camp (pF) | $C_{\text {in(total) }}$ (pF) | $\begin{gathered} f_{\mathrm{T}} \\ (\mathrm{MHz}) \end{gathered}$ | $\begin{gathered} f_{\mathrm{C}} \\ (\mathrm{kHz}) \end{gathered}$ | $\begin{gathered} f_{\mathrm{X}} \\ (\mathrm{kHz}) \end{gathered}$ |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| LF411 | 25 | 2 | 12 | 4 | 230 | 67 |
| OPA627 | 4.5 | 15 | 25 | 16 | 320 | 178 |
| OPA637 | 4.5 | 15 | 25 | 80 | 715 | 178 |
| OPA656 | 7 | 3.5 | 13.5 | 230 | 1650 | 212 |
| OPA657 | 4.8 | 5.2 | 15.2 | 1600 | 4100 | 274 |

A.
B.

Figure 8.72. A. Input-referred noise-current spectrum for the photodiode amplifier in Figure 8.71. The crossover frequency $f_{\mathrm{X}}$ at which " $e_{n} C$ " noise becomes dominant is marked with a dot for each configuration. For the LF411 example both $f_{\mathrm{X}}$ and the turnover frequency $f_{\mathrm{c}}$ are marked. In each case it is assumed that the compensation capacitor $C_{\mathrm{f}}$ is chosen so that $f_{\mathrm{c}}$ is equal to $f_{\mathrm{GM}}=\sqrt{f_{\mathrm{RCin}} f_{\mathrm{T}}}$, thereby obtaining maximum amplifier bandwidth consistent with only modest peaking (damping ratio $\zeta=0.7$ ); otherwise there will be a region of flat noise density, as in Figure 8.73. B. Input-referred current-noise parameters for the photodiode amplifiers of Figure 8.71, assuming an external input capacitance of 10 pF .

### 8.11.5 An example: wideband JFET photodiode amplifier

Continuing along this path, in Figure 8.73 we've plotted the transimpedance gain, noise gain, and effective inputnoise current for a transimpedance amplifier made from an OPA656 ( $f_{\mathrm{T}}=230 \mathrm{MHz}, e_{\mathrm{n}}=7 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), with a 1 M feedback resistor and a conservative value of shunt capacitor $\left(2 \mathrm{pF}: f_{\mathrm{c}}=76 \mathrm{kHz}\right.$ ) to ensure stability with input capacitances as high as 1000 pF .

Note that there are two "gains" here: the transimpedance gain (top plot) is the ratio of output signal voltage to input signal current, a plot that is nominally flat up to the rolloff at $f_{\mathrm{c}}$, but with the additional constraint imposed by the finite (and falling) op-amp open-loop gain $G_{\mathrm{OL}}$. The noise gain (middle plot) is the ratio of output signal voltage to input noise voltage, with its characteristic rising " $e_{\mathrm{n}} C$ " slope proportional to frequency. It flattens at $f_{\mathrm{c}}$, but (for op-amps of modest open-loop gain ${ }^{96}$ ) is further limited by $G_{\text {OL }}$.

Finally, the effective input-referred noise current seen at the output (bottom plot) is the sum of the $e_{\mathrm{n}} C$ noise and the feedback resistor's Johnson noise, as shaped by the amplifier's rolloff. Those noise-current terms (as seen at the input) are $e_{\mathrm{n}} \omega C$ and $\sqrt{4 k T / R_{\mathrm{f}}}$, respectively. Here

[^422]the Johnson noise dominates at low frequencies: a $1 \mathrm{M} \Omega$ resistor generates a (short-circuit) white-noise current of $0.13 \mathrm{pA} / \sqrt{\mathrm{Hz}}$.

We measured this amplifier's output noise spectrum with the four values of input capacitance; we measured also the op-amp's input voltage noise ( $e_{\mathrm{n}}$ ). Figure 8.74 is a screen capture (from an SRS785 spectrum analyzer), labeled with corresponding input-referred $i_{\mathrm{n}}$ and $e_{\mathrm{n}}$ scales. The measured data are in reasonable agreement with the predictions of Figure 8.73, with the exception of some excess noise at the low-frequency end of the 10 nF plot. But Figure 8.73 assumed a constant (white-noise) value of $6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for $e_{\mathrm{n}}$, whereas the measured voltage noise exhibits the usual $1 / f$ rise at low frequencies, roughly triple its high-frequency value at 100 Hz .

### 8.11.6 Noise versus gain in the transimpedance amplifier

In the preceding discussion we casually took a roundnumber value of $1 \mathrm{M} \Omega$ for the feedback resistor $R_{\mathrm{f}}$, without much consideration of the consequences for noise and bandwidth. From Figures 8.72, 8.73, and 8.74 it is easy to see that the low-frequency current noise floor is set by $R_{\mathrm{f}}$ 's Johnson noise; so larger values of $R_{\mathrm{f}}$ would appear to be "better."

Not so fast! For a given input capacitance, larger values of $R_{\mathrm{f}}$ correspond to a lower input rolloff frequency ( $\omega=1 / R_{\mathrm{f}} C_{\mathrm{in}}$ ), requiring more aggressive compensation
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0574.jpg?height=1404&width=1195&top_left_y=214&top_left_x=448)

Figure 8.73. Charting the noise in a transimpedance amplifier. A 230 MHz op-amp is used to obtain $\sim 75 \mathrm{kHz}$ bandwidth for input capacitances from 10 pF to 1 nF . The transimpedance bandwidth is not much affected by input capacitance up to 1 nF , but a 10 nF capacitance reduces the bandwidth substantially. It does this without creating instability in this case, because of the OPA656's limited open-loop gain ( 65 dB ).
(i.e., lower bandwidth $f_{\mathrm{c}}$ ). If your noise is dominated by Johnson noise in $R_{\mathrm{f}}$, and you don't care about bandwidth but want to minimize the low-frequency noise, then a larger $R_{\mathrm{f}}$ is good. But in a wideband photodiode amplifier in which the $e_{\mathrm{n}} C$ noise is dominant and in which you want to improve the bandwidth, it's better to reduce $R_{\mathrm{f}}$.

But, not too much! Here's the reason: a goal in any transimpedance amplifier design should be to ensure that the amplifier adds insignificant noise to the inherent shot noise of the input signal. As we reduce $R_{\mathrm{f}}$, however,
its Johnson-noise current $\sqrt{4 k T / R_{\mathrm{f}}}$ increases, ultimately dominating over the input signal's irreducible shot-noise current $\sqrt{2 q I_{\text {in }}}$. By equating these noise currents we get the condition $I_{\mathrm{in}} R_{\mathrm{f}}=2 k T / q=50 \mathrm{mV}$. That is, to avoid adding amplifier noise, the feedback resistor should not be chosen so small that the voltage drop produced by the input (which could be a dc component of the input signal) is less than, say, 100 mV .

This noise-bandwidth tradeoff in the choice of feedback resistance is illustrated in Figure 8.75, where reducing
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0575.jpg?height=509&width=763&top_left_y=210&top_left_x=139)

Figure 8.74. Measured input-referred current noise in the amplifier of Figure 8.73. The separate spectra have been here overlaid, with some helpful decorative legends.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0575.jpg?height=1101&width=820&top_left_y=919&top_left_x=110)

Figure 8.75. In a fast transimpedance amplifier, where $e_{\mathrm{n}} C$ noise dominates over $R_{\mathrm{f}}$ Johnson noise, you can increase the usable bandwidth by reducing $R_{\mathrm{f}}$; recover the lost gain in a second-stage voltage amplifier.
$R_{\mathrm{f}}$ from 1 M to 100 k moves the input rolloff upward by a factor of 10 , allowing an increase in amplifier bandwidth by a factor of roughly 3 (more precisely, $\sqrt{10}$ ). The price you pay is $\times 10$ reduced gain (easily recovered with a downstream voltage amplifier stage), and increased lowfrequency noise floor (still negligible compared with the $e_{\mathrm{n}} C$ high-frequency noise contribution). Of course, the increased bandwidth comes with a continuing increase in $e_{\mathrm{n}} C$ noise, as seen above 100 kHz in the bottom plot of Figure 8.75 .

Happily, there some nice tricks you can use to mitigate these high-frequency $e_{\mathrm{n}} C$ noise effects. One method greatly reduces the effective capacitance at the input by "bootstrapping" the return side of the signal source, e.g., photodiode (and cable shield); another uses a commonbase transistor stage (a cascode) to isolate the photodiode capacitance from the transimpedance stage. We'll describe these shortly, after a brief discussion of an important (and too often overlooked) issue: the need for a bandwidthlimiting lowpass filter at the output of the transimpedance stage.

### 8.11.7 Output bandwidth limiting in the transimpedance amplifier

If you're designing a real-world transimpedance amplifier with significant $e_{\mathrm{n}} C$ noise from capacitance at the input, it's important to add a lowpass filter section at the output. Look again at the noise gain plots in Figure 8.73. Because $C_{\mathrm{f}}$ was chosen for stability with the largest anticipated input capacitance, there is a broad band of noise at high frequencies, particularly for lesser values of input capacitance. This noise extends beyond the amplifier's bandwidth, and can contribute the lion's share of total output noise (remember that logarithmic frequency plots tend to conceal the fact that most of the bandwidth is at the high end).

To see this more clearly, look at Figure 8.76, an analogous set of plots for the current-input amplifier of Figure 8.77. ${ }^{97}$ Here we've used a decompensated low-noise JFET op-amp, with $C_{\mathrm{f}}$ chosen such that the amplifier is stable with input capacitances up to 1000 pF . Noise gain and effective input noise current are plotted, for both 1000 pF and 100 pF at the input. The solid lines show $U_{1}$ 's output, and the dashed lines show the signal after a simple $R C$ lowpass. Because the amplifier is overcompensated when $C_{\mathrm{in}}=100 \mathrm{pF}$, there's a substantial region (the dotted area) of

[^423]out-of-band noise that is eliminated by the $R_{1} C_{1}$ filter. (The effect is minimal when the amplifier is critically compensated, with $f_{\mathrm{c}}$ nearly equal to $f_{\mathrm{GM}}$, as seen in the 1000 pF plots, because the op-amp's open-loop gain rolloff accomplishes the same thing.)

In this circuit we added an output $\times 10$ gain stage, so that the overall gain is $1 \mathrm{~V} / \mu \mathrm{A}$. That provides another opportunity for an additional section of lowpass filtering, via $C_{2}$. This might seem extreme, but remember that a singlesection $R C$ has a gentle rolloff, such that equivalent whitenoise bandwidth extends well beyond its characteristic frequency $\left(1.57 f_{3 \mathrm{~dB}}\right.$, to be exact; see $\S 8.13$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0576.jpg?height=883&width=835&top_left_y=750&top_left_x=200)

Figure 8.76. Noise plots for the current amplifier of Figure 8.77. Adding an output filter at or slightly above $f_{\mathrm{c}}$ greatly reduces the output noise.

### 8.11.8 Composite transimpedance amplifiers

When choosing an op-amp for use in a sensitive transimpedance amplifier, you want very low input noise current, thus a JFET or CMOS type. And if you want plenty of speed it's important to select an op-amp with low input noise voltage (to minimize the high-frequency $e_{\mathrm{n}} C_{\mathrm{in}}$ noise current it produces), and especially so if the input capacitance is substantial. Finally, because the input noise current produced by the gain-setting feedback resistor $R_{\mathrm{f}}$ decreases
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0576.jpg?height=577&width=855&top_left_y=219&top_left_x=1065)

Figure 8.77. Current-input amplifier, $\mathrm{BW}=250 \mathrm{kHz}$, compensated for stability with input capacitances up to 1000 pF . The lowpass filters ( $R_{1} C_{1}$ and $R_{2} C_{2}$ ) minimize out-of-band noise, particularly when $C_{\text {in }}$ is less than the maximum.
as $1 / \sqrt{R_{\mathrm{f}}}$, a low-noise TIA requires a large-value feedback resistor.

But a large $R_{\mathrm{f}}$ produces a low input rolloff frequency ( $f_{\mathrm{RCin}}=1 / 2 \pi R_{\mathrm{f}} C_{\mathrm{in}}$ ), just what you don't need when you're aiming for lots of bandwidth. We'll see presently (in §8.11.9) techniques, such as bootstrapping and cascoding, that can be used in some situations for greatly reducing the effective input capacitance in a transimpedance amplifier. But another approach is simply to select an op-amp with high-enough bandwidth $f_{\mathrm{T}}$ to produce the required TIA bandwidth ( $\sim \sqrt{f_{\mathrm{RCin}} f_{\mathrm{T}}}$ , as we illustrated in $\S 4 x .3 .3$.

This is a reasonable approach - but the performance you get with available op-amps often falls short. Table 8.3 shows that most fast op-amps (say $f_{\mathrm{T}} \geq 350 \mathrm{MHz}$ ) have relatively high noise voltage ( $e_{\mathrm{n}}$ of $6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ or greater), and quiet op-amps tend to be slow, like our low-noise winner, the $\operatorname{AD} 743\left(e_{\mathrm{n}}=2.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}\right.$ and $\left.f_{\mathrm{T}}=4.5 \mathrm{MHz}\right)$. From the table you can see also that some of the fastest op-amps are low-voltage parts, for example the OPA657 with $f_{\mathrm{T}}=1500 \mathrm{MHz}$, whose total supply voltage range is restricted to $9-13 \mathrm{~V}$. That matters, because the larger values of feedback resistor needed for reduced noise produce more gain, therefore larger output swings (and static dc levels, when there's a nonzero dc component to the input current), favoring op-amps that can run on $\pm 15 \mathrm{~V}$.

So, what can be done? A nice approach is to separate the input-stage performance from that of the output stage, to optimize overall noise and speed capability. This can be done with a "composite amplifier," a powerful technique seen, for example, in Figures 5.47 and 13.48, and treated in some detail in $\S 4 x .3$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0577.jpg?height=493&width=809&top_left_y=218&top_left_x=116)

Figure 8.78. Low-noise wideband transimpedance amplifier, exploiting the combination of desirable properties of a pair of op-amps configured as a composite amplifier.

Figure 8.78 shows an example, ${ }^{98}$ a TIA intended for low-level current signals burdened with a relatively high capacitance of 1000 pF . Here an AD743 low-noise input stage has been mated with a $\times 100$ wideband AD811 output stage, thus maintaining the low $e_{\mathrm{n}}$ while boosting the composite amplifier's $f_{\mathrm{T}}$ by a factor of 100 , to 450 MHz . Although the output stage has considerable bandwidth (it's a current-feedback amplifier intended for video applications), the AD743's meager 4.5 MHz bandwidth (with additional poles around that frequency and above, as evidenced by the datasheet's open-loop gain and phase plots) causes the composite amplifier to exhibit a $-12 \mathrm{~dB} /$ octave rolloff above 5 MHz , reaching a $180^{\circ}$ phase shift around 20 MHz . This sounds dangerous, but it's OK because that's well above our $f_{\mathrm{c}}$ frequency (see $\S 4 x .3 .2$ ), and it's above the intercept of the flattened noise gain with the open-loop gain (see Figure 8.73). So the configuration is stable, and in fact the second-stage bandwidth is more than needed.

The performance is quite good, with $i_{\mathrm{n}} \approx 50 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ from 10 Hz to 2 kHz when driven with an input capacitance of 1000 pF , and with bandwidth out to 100 kHz . But the input-noise voltage $(2.9 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ in combination with the large input capacitance causes a rapidly rising $e_{\mathrm{n}} C_{\mathrm{in}}$ noise current, reaching nearly $2000 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ at 100 kHz (Figure 8.79). And the low-frequency noise floor is dominated by the Johnson-noise current of the feedback resistor $R_{\mathrm{f}}$. Given that the AD743 is the quietest available JFET opamp, we seem to have hit the limit of noise performance in a transimpedance amplifier driven with a highly capacitive source.

[^424]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0577.jpg?height=524&width=792&top_left_y=207&top_left_x=979)

Figure 8.79. Measured current noise versus frequency for the amplifier of Figure 8.78, with a 1000 pF capacitor across the input. The dashed line shows the value of $e_{\mathrm{n}} \omega C_{\text {in }}$ for $e_{\mathrm{n}}=2.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (the AD743 datasheet's specified typical $e_{\mathrm{n}}$ ), and the dotted line is $\sqrt{4 k T / R_{\mathrm{f}}}$, the Johnson-noise current of the 10M feedback resistor (after Kretinin \& Chung, used with permission).

#### A. Hybrid composite transimpedance amplifier

We could do better, though, if we could find a way to reduce the already low $e_{\mathrm{n}}$ (which contributes the rising $e_{\mathrm{n}} C_{\mathrm{in}}$ above around 10 kHz ) while maintaining a large gain-bandwidth product. The technique that does the trick here is the use of a hybrid input stage to exploit the very low $e_{\mathrm{n}}$ of a large-area JFET pair like InterFET's IF3602 ( $e_{\mathrm{n}}=0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, typ, at 100 Hz ). Of course, largegeometry JFETs have lots of capacitance (this JFET's $C_{\text {iss }}$ is a whopping 300 pF ), but that is not terribly serious when you've got a signal source that's burdened already with 1000 pF of capacitance. And we'll stick with the composite amplifier topology, to get the high open-loop amplifier bandwidth that we need in order to achieve reasonable TIA bandwidth with a highly capacitive input.

Figure 8.80 shows such a design. The "op-amp" is a 3-stage composite amplifier whose input stage $Q_{\text {lab }}$ is a common-source differential JFET with current mirror drain load $Q_{5} Q_{6}$, isolated with a cascode $Q_{3} Q_{4}$. The overall GBW is 10 GHz , as seen in the Bode plot of Figure 8.80B; this composite op-amp is not stable (!) when used as a voltage amplifier (at least for closed-loop gains $<45 \mathrm{~dB}$ ), but when configured as a transimpedance amplifier (Figure 8.80 C ) with an effective compensation capacitance of 0.032 pF (set by $R_{2}$ in the circuit shown ${ }^{99}$ ) across the 20 M

[^425]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0578.jpg?height=993&width=896&top_left_y=223&top_left_x=205)
A. "Op-amp"
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0578.jpg?height=739&width=1640&top_left_y=1100&top_left_x=238)
C. TIA block diagram
D. Quiet $\pm 5 \mathrm{~V}$ supply

Figure 8.80. Hybrid transimpedance amplifier, optimized for lowest noise with capacitive inputs of order $\sim 1000 \mathrm{pF}$ by the use of largearea input-stage JFETs with extraordinarily low noise voltage ( $e_{\mathrm{n}}=0.35 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). The composite amplifier (A) boosts the gain-bandwidth product $f_{\mathrm{T}}$ to 10 GHz , (B), to maintain an overall TIA bandwidth of $\sim 250 \mathrm{kHz}$ in spite of the large $R_{\mathrm{f}}$ and $C_{\mathrm{in}}$ ( $20 \mathrm{M} \Omega$ and 1000 pF ). The transimpedance configuration (C) sets the gain at $20 \mathrm{~V} / \mu \mathrm{A}$, with an effective $C_{\mathrm{f}}$ of 32 fF (created by the pole-zero network $C_{1} R_{1} R_{2}$, needed to cancel $R_{\mathrm{f}}$ 's excessive self-capacitance (which we'll call $C_{\mathrm{Rf}}$ ); see $\S 4 x$. 3 , setting a dominant pole at 200 kHz to ensure stability. A low-noise voltage reference (D) is used to create quiet $\pm 5 \mathrm{~V}$ supply rails.
gain-setting feedback resistor, it is stable. ${ }^{100}$ The input stage has a noise voltage density of $e_{\mathrm{n}} \approx 0.6 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. The second op-amp (LT6230) is a wideband ( 200 MHz ) lownoise ( $1.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) op-amp, powered by a low-noise $\pm 5 \mathrm{~V}$ power supply ${ }^{101}$ (Figure 8.80D); with the JFET input stage, the combined GBW of these two stages is $f_{\mathrm{T}}=g_{m} / 2 \pi C_{\mathrm{c}}$, or about 200 MHz with a $C_{\mathrm{c}}$ of 100 pF . The last stage has a gain of 50 and an $f_{\mathrm{T}}$ of 65 MHz , boosting the composite amplifier's GBW to 10 GHz .

When configured as a transimpedance amplifier (i.e., Figures 8.80 A and C ), this circuit has $5 \times$ less noise voltage (thus $5 \times$ less $e_{\mathrm{n}} C_{\text {in }}$ noise) than the composite TIA of Figure 8.79. It also has greater bandwidth, thanks to its $20 \times$ higher $f_{\mathrm{T}}$, even with the larger value of feedback resistor ( 20 M , chosen to reduce its Johnson-noise current, given the quieter front-end). Look ahead to Figure 8.81 to see this comparison graphically.
Some details We measured $e_{\mathrm{n}}=0.35 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for an IF3602 JFET operating at 10 mA , and $0.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ at 25 mA ; here we chose the lower drain current of 10 mA for lower dissipation and reduced $1 / f$ noise. Because of the IF3602's very large capacitances ( 300 pF for $C_{\text {iss }}$, 200 pF for $C_{\text {rss }}$ ) we clamped the drains with a cascode, setting $V_{\mathrm{DS}}=V_{\mathrm{BE}}$ independently of $V_{\mathrm{GS}}$ and input commonmode level. This further reduces JFET power dissipation (to about 6 mW each), and prevents excessive "impactionization" gate current (§3.2.8).

The IF3602 pair is not well matched (specified $V_{\text {os }}=100 \mathrm{mV}$ max), which is especially troublesome in view of its very high transconductance (we measured $g_{m}=130 \mathrm{mS}$ at 10 mA , see the plot of measured JFET transconductances in $\S 3 x .2$ ). If we try to trim the offset by unbalancing the drain resistors (with a circuit like that of Figure 8.67), we quickly find from $\Delta I_{\mathrm{D}} / I_{\mathrm{D}}=0.5 g_{m} V_{\mathrm{os}} / I_{\mathrm{D}}$ that we need a $39 \%$ drain-current unbalance to null a worstcase input offset. Ouch! So we went with the scheme shown, in which a degenerated low-noise Wilson current mirror with selected fixed trim resistors sets the required unbalanced drain currents. The current mirror's noise-voltage contribution with $100 \Omega$ emitter resistors $R_{4}$ and $R_{5}$, when referred to the JFET input terminals, is $e_{\mathrm{n}}=\sqrt{4 k T / R_{4}} \cdot 1 / g_{m}$, or $0.1 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, an insignificant $4 \%$

[^426]contribution when the squared amplitudes are combined. Finally, a comment on the differential pair current sink $Q_{2}$ : normally a differential pair's current sink noise is not terribly critical, because a reasonably well-balanced differential stage cancels the noise (e.g., $30 \times$ for a $3 \%$ balance). But here we face a possibly severe current imbalance to trim the offset voltage, so we've used a low-noise voltage regulator $(<10 \mathrm{nV} / \sqrt{\mathrm{Hz}})$, with further $R C$ quieting of the current sink.

Exercise 8.3. Calculate the noise densities of the $\pm 5 \mathrm{Q}$ supplies in Figure 8.80D. What is their rms noise?

#### B. Composite versus single-stage transimpedance amplifiers

The plots of transimpedance gain and input noise current in Figure 8.81 are a good way to see the performance enhancement you get with a composite TIA in the difficult situation of high input capacitance. The improved performance comes from the greater amplifier bandwidth $f_{\mathrm{T}}$, and from the ability to create a quiet input stage.

Comparing first the single-stage (i.e., not composite) configurations A and B , you see the improved bandwidth gained from the faster OPA637, with the tradeoff of greater noise. Adding a (composite) second stage to the quieter configuration A gets you a lot of extra bandwidth with no increase of noise (configuration C , the circuit of Figure 8.78). The composite amplifier with an even lowernoise discrete input stage (configuration D , the circuit of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0579.jpg?height=575&width=717&top_left_y=1465&top_left_x=1014)

Figure 8.81. Comparing the performance of five transimpedance amplifiers when driven with a current signal of 1000 pF capacitance. A, AD743; B, OPA637; C, AD743 composite (Figure 8.78); D, IF3602 composite (Figure 8.80); E, OPA637 with BF862 bootstrap (similar to Figure 8.82); The feedback resistor $R_{\mathrm{f}}$ is $10 \mathrm{M} \Omega$ for circuits $A-C$, and $20 M \Omega$ for $D$ and $E$.

Figure 8.80) has yet more bandwidth, and can tolerate the larger $R_{\mathrm{f}}$ needed to fully exploit the amplifier's lower $e_{\mathrm{n}}$. Finally, if you have the luxury of bootstrapping the input capacitance (see for example §8.11.9, Figure 8.82), the greatly lowered $C_{\text {in }}$ lets you revert to the simple singlestage OPA637 configuration without a great sacrifice in performance.

This example illustrates once again a lesson we've learned over many decades of designing low-noise amplifiers, namely that circuit complexity increases rapidly as improvements are added to reach the limits of low-noise circuit performance.

### 8.11.9 Reducing input capacitance: bootstrapping the transimpedance amplifier

Input capacitance has not been our friend. As Figures 8.73, 8.74 , and 8.76 make abundantly clear, input capacitance is the root of all evil, in terms of both noise and bandwidth. Large-area photodiodes are plagued with lots of capacitance (as much as 1000 pF or more); and, if the detector is at the end of a length of shielded cable, you can figure on an additional $\sim 30 \mathrm{pF} / \mathrm{ft}$ of cable (this value is not arbitrary; see Appendix H).

As we hinted earlier, there are tricks by which you can greatly reduce the effective capacitance. Figure 8.82 shows an elegant solution, ${ }^{102}$ namely an ac-coupled bootstrap of the return side of the capacitive input device (plus shielded cable, if any). In this circuit the JFET follower $Q_{1}$ drives the low side of the photodiode with a replica of any signal at the summing junction; $Q_{1}$ 's high transconductance ( $\sim 25 \mathrm{mS}$ ) ensures a gain close to unity (output impedance $\sim 40 \Omega$ ), thus a reduction of the photodiode's effective input capacitance (as seen at the summing junction) by at least a factor of 10 .

But now we have to worry about noise introduced by $Q_{1}$ and associated circuitry. You might think first about $Q_{1}$ 's gate current, and also the capacitance $C_{\text {iss }}$ that it adds to the input. For this particular JFET, things look pretty good: it has low gate input current ( $\sim 1 \mathrm{pA}$, as long as you keep $V_{\mathrm{DS}}<5 \mathrm{~V}$ ), and low feedback capacitance ( $\sim 2 \mathrm{pF}$ ). But the JFET's noise is another matter, because its $e_{\mathrm{n}}$ voltage noise generates an $e_{\mathrm{n}} C$ noise current in combination with the unbootstrapped photodiode (and cable) capacitance. This is in contrast to the op-amp's $e_{\mathrm{n}}$, which now sees the much lower bootstrapped capacitance; both of these noise currents must come through $R_{\mathrm{f}}$, generating output noise.

[^427]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0580.jpg?height=519&width=700&top_left_y=220&top_left_x=1119)

Figure 8.82. Follower $Q_{1}$ bootstraps the photodiode at signal frequencies, reducing its effective capacitance by a factor of 10 or more. The BF862 is especially well suited to this task, with its low capacitance and sub-nV $/ \sqrt{\mathrm{Hz}}$ noise. This lets us use a lessexpensive op-amp (with less bandwidth and somewhat higher $e_{\mathrm{n}}$ ) for $U_{1}$. We often add an emitter follower (not shown for simplicity). To find the break frequency of the $e_{\mathrm{n}} C_{\mathrm{in}}$ noise, use eq'n 8.45 on page 539 , with the "reduced" value of $C_{\text {in }}$; see text.

For this reason it's essential to choose a JFET with very low noise voltage, ideally much lower than the $e_{\mathrm{n}}$ of the op-amp. The BF862 is an excellent choice, with its impressively low ${ }^{103} e_{\mathrm{n}} \sim 0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Even so, its noise contribution is larger than that of the op-amp (the latter benefitting, of course, from the JFET's successful reduction of effective photodiode capacitance), because the LTC1792 is a quiet $(4.2 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ op-amp to begin with. For example, with a 1000 pF photodiode the op-amp's $4.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ acts on the (reduced) $\sim 100 \mathrm{pF}$, while the JFET's $0.9 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ acts on the full 1000 pF of the photodiode. Making that quantitative, at 100 kHz the noise-current contributions are $0.26 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ and $0.57 \mathrm{pA} / \sqrt{\mathrm{Hz}}$, respectively, for a combined noise current of $0.63 \mathrm{pA} / \sqrt{\mathrm{Hz}}$. Although the JFET's noise dominates, we're still doing quite a bit better than the unbootstrapped configuration, with its noise current of $2.6 \mathrm{pA} / \sqrt{\mathrm{Hz}}$.

We discuss transimpedance amplifiers in further detail (particularly issues of stability) in $\S 4 x .3$. There we include a design for an input-capacitance-tolerant photodiode amplifier that exploits bootstrapping; the circuit is reproduced here in Figure 8.83. In this design we used the excellent (and not inexpensive) OPA637 (GBW $=80 \mathrm{MHz}$,
${ }^{103}$ Inexpensive, too, about $\$ 0.50$ in qty 25. And, according to Phil Hobbs, they can be paralleled without source ballasting (especially when taken from the same reel), because "they go from cutoff to $I_{\text {DSS }}$ in about 400 mV . JFETs running near $I_{\mathrm{DSS}}$ have a low tempco as well. I use boatloads of them - they're Good Medicine."
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0581.jpg?height=471&width=1610&top_left_y=216&top_left_x=139)

Figure 8.83. A complete photodiode amplifier, suitable for input capacitances up to 1000 pF . Input bootstrapping greatly reduces the effective photodiode and cable capacitance, for enhanced speed and reduced noise.
$e_{\mathrm{n}}=4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ). In Figure 8.84 we plot the noise and bandwidth, under the conservative estimate of a tenfold reduction of input capacitance. Bootstrapping improves the bandwidth, reduces the noise, and leaves the transimpedance gain unchanged. ${ }^{104}$ Not bad!

Exercise 8.4. Design a TIA with an OPA637 op-amp and a BF862 JFET bootstrap follower, for input signals with $C_{\mathrm{in}}=1 \mathrm{nF}$. Use $R_{\mathrm{f}}=20 \mathrm{M} \Omega$, and assume the BF862 has a noise voltage of $0.85 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and a voltage gain (when driving the bootstrap terminal) of $G_{\mathrm{V}}=0.95$. Evaluate your circuit's noise and gain performance, which should be not unlike that of curve E in Figure 8.81.

### 8.11.10 Isolating input capacitance: cascoding the transimpedance amplifier

Bootstrapping reduces the effective input capacitance (typically by an order of magnitude), allowing reduced noise and greater bandwidth from a capacitive current-output sensor such as a photodiode. But we can do even better: it's possible to isolate the input capacitance entirely, by interposing a common-base (cascode) stage between the input signal and the transimpedance amplifier.

There are some bumps along the way, so we'll take it in stages. We learned about this from Philip Hobbs, whose articles ${ }^{105}$ make good reading for those interested in pursuing these techniques.

[^428]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0581.jpg?height=1106&width=830&top_left_y=835&top_left_x=957)

Figure 8.84. Noise, bandwidth, and gain for the bootstrapped photodiode amplifier. The reduced effective capacitance improves both the noise (via reduced $e_{\mathrm{n}} C$ ) and bandwidth (via smaller stabilizing feedback capacitance $C_{\mathrm{f}}$ ).

#### A. Creating a capacitance-isolating cascode

Step 1: unbiased cascode
Figure 8.86A shows the core idea, in which the currentsinking signal source drives the emitter of grounded-base
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0582.jpg?height=922&width=1429&top_left_y=218&top_left_x=329)

Figure 8.85. Gain-bandwidth product, $f_{T}$, versus collector current for selected bipolar transistors, as shown in the manufacturers' datasheets. Some wideband transistors are clear off the top.
npn transistor $Q_{1}$ (this is often called a "common-base amplifier"). Assuming reasonable transistor beta, most of that current appears at the collector - but with only the small collector output capacitance of $Q_{1}$, typically just a few picofarads.

A minor flaw here is that the input sits a diode drop below ground. But there are more serious snakes lurking in the Garden of Eden. We want good performance at very low signal currents, say fractions of a microamp. Down there we have to worry about falling transistor beta. Worse still, the input impedance $r_{\mathrm{e}}$ seen at the emitter is rising inversely with input current; at $1 \mu \mathrm{~A}$ it's $25 \mathrm{k} \Omega$ (recall $\left.r_{\mathrm{e}}=25 \Omega / I_{\mathrm{C}}[\mathrm{mA}]\right)$. So the signal current is shunted to ground by the input capacitance at a frequency at which the reactance of $C_{\mathrm{in}}=25 \mathrm{k}$ or less; that is, the input rolls off at $f_{3 \mathrm{~dB}}=1 / 2 \pi r_{\mathrm{e}} C_{\mathrm{in}}$, thus for example around 6.4 kHz for a $1 \mu \mathrm{~A}$ signal with $C_{\mathrm{in}}=1000 \mathrm{pF}{ }^{106}$

[^429]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0582.jpg?height=527&width=799&top_left_y=1303&top_left_x=1075)

Figure 8.86. Isolating input capacitance with a common-base (cascode) input stage. A. Transistor $Q_{1}$ passes the signal current to the transimpedance amplifier, which sees only the small collector-to-base capacitance $C_{\mathrm{cb}}$. B. Adding dc bias reduces $r_{\mathrm{e}}$, greatly increasing the bandwidth.

2 MHz at $10 \mu \mathrm{~A}$, from which you can estimate that about $10 \%$ of the emitter current is diverted at 200 kHz .

#### Step 2: biased cascode

We can drive $r_{\mathrm{e}}$ down (and also preserve reasonable beta) by biasing $Q_{1}$, as shown in Figure 8.86B. With $\pm 15 \mathrm{~V}$ supplies, we might choose $R_{\mathrm{C}}=R_{\mathrm{E}}=60 \mathrm{k} \Omega$ to set $I_{\mathrm{C}}$ at $250 \mu \mathrm{~A}$ quiescent current; thus $r_{\mathrm{e}}=100 \Omega$. This raises the $r_{\mathrm{e}} C_{\mathrm{in}}$ rolloff to a quite respectable 1.6 MHz .

But now we've created three new problems. First, this substantial quiescent collector current means that $R_{\mathrm{C}}$ has to be critically chosen so that $Q_{1}$ 's collector operating point (when disconnected from the virtual ground) would be at ground; otherwise the transimpedance stage (if configured for high gain, say $1 \mathrm{~V} / \mu \mathrm{A}$; i.e., $R_{\mathrm{f}}=1 \mathrm{M} \Omega$ ) will have a large output dc offset. Second, in this circuit the noise currents of $R_{\mathrm{C}}, R_{\mathrm{E}}$, and $R_{\mathrm{f}}$ are all combined at the summing junction; and the required lower $R_{\mathrm{C}}$ and $R_{\mathrm{E}}$ resistor values generate correspondingly larger Johnson-noise currents at the transimpedance input (recall that a resistor of value $R$ generates a short-circuit Johnson-noise current of $i_{\mathrm{n}}=\sqrt{4 k T / R}$. Third, $Q_{1}$ 's higher operating current means higher base current and thus higher shot noise ( $i_{n \text {,base }}=\sqrt{2 q I_{\mathrm{B}}}$ ), which is another noise-current contribution at the transimpedance input. ${ }^{107}$

So here's the situation so far: with the circuit of Figure 8.86 B we have achieved better bandwidth with a given input capacitance, compared with the previous transimpedance designs, but at the cost of (a) dc offset, (b) an input node that is a diode drop below ground, and (c) a noise-speed tradeoff in the choice of $Q_{1}$ 's quiescent current.

Can anything further be done? Read on...

#### Step 3: bootstrapped biased cascode

Yes! Combine the capacitance-reducing bootstrap trick with the biased cascode. Figure 8.87 shows how, this time as a fleshed-out design showing the specifics of component values and types.

To bring this into the real world, we chose a gallium phosphide UV photodiode that we use in the lab; its measured capacitance at 5 V of reverse bias is 460 pF (it is not specified on the datasheet). The photodiode's low side is bootstrapped by JFET follower $Q_{2}$ (as in the earlier Figure 8.82), reducing its effective capacitance tenfold, to $\sim 50 \mathrm{pF}$.

107 There's a subtle point here: a current such as $I_{\mathrm{E}}$ that is generated by a voltage drop across a metallic conductor does not exhibit shot-noise current (the charge carriers do not act independently; see §8.1.2). But the base current does have the "full" shot noise given by the formula. That noise current manifests itself at the collector, because $I_{\mathrm{C}}=I_{\mathrm{E}}$ (noiseless) $-I_{\mathrm{B}}$ (noisy).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0583.jpg?height=881&width=815&top_left_y=218&top_left_x=975)

Figure 8.87. Bootstrapping the cascoded transimpedance amplifier to achieve wideband ( 1 MHz ) low-noise performance with a photodiode of rather high capacitance. Optional blocking capacitor $C_{\mathrm{b}}$ can be used to eliminate dc offset in ac-coupled applications.

The next step is to choose the operating current for cascode transistor $Q_{1}$, such that its $r_{\mathrm{e}}$ is small enough so that the input $r_{\mathrm{e}} C_{\text {in }}$ rolloff ${ }^{108}$ does not compromise the bandwidth $f_{\mathrm{c}}$ set by the transimpedance stage $U_{1}$. We figure $f_{\mathrm{GM}}$ (eq'n 8.46) as usual (see $\S 4 x .3$ ): the capacitance at $U_{1}$ 's input is the sum of $Q_{1}$ 's collector capacitance $(2 \mathrm{pF})$ and $U_{1}$ 's own input capacitance ( 15 pF for our initial choice of an OPA637, whose low noise and wide bandwidth make it a favorite choice as an input stage for photodiode amplifiers); the 17 pF total puts $U_{1}$ 's input rolloff $f_{\mathrm{RfCin}}$ of 18.7 kHz , given our choice ${ }^{109}$ of transimpedance gain $(0.5 \mathrm{~V} / \mu \mathrm{A})$. The OPA637's decompensated $f_{\mathrm{T}}$ of 80 MHz gives us an $f_{\mathrm{GM}}=\sqrt{f_{\mathrm{RfCin}} f_{\mathrm{T}}}=1.22 \mathrm{MHz}$; we choose a value of feedback capacitor $C_{\mathrm{f}}$ to set the critical bandwidth $f_{\mathrm{c}}$ to be 0.7 MHz (a conservative $\zeta=1.2$, to ensure stability), hoping for a transimpedance bandwidth $f_{\mathrm{b}}$ of 1 MHz . That's 0.46 pF , of which the resistor itself provides $\sim 0.1 \mathrm{pF}$. You can use a pair of PCB traces, an adjustable pot with $C_{\mathrm{f}}=0.5 \mathrm{pF}$ (see Figure $4 x .18$ ), or a "gimmick" (a few twists of a pair of insulated wires) to add the remaining 0.36 pF .

[^430]
#### B. Iteration: better op-amp choice

Something's amiss here: the OPA637 is a fine op-amp (with a price to match!), but it uses large-area JFETs to achieve its admirably low $e_{\mathrm{n}}$, resulting in a high input capacitance of 15 pF . That's not a worry when you have, say, an input signal accompanied by lots of capacitance (e.g., a photodiode and some shielded cable). But here it's at a low capacitance node ( $Q_{1}$ 's collector) where it dominates the rolloff, forcing the high $f_{\mathrm{T}}$ requirement.

Let's redo the calculation, assuming we use an op-amp with lower capacitance, say $C_{\mathrm{in}}=4 \mathrm{pF}$. Now $f_{\mathrm{RfCin}}=53 \mathrm{kHz}$, and for an $f_{\mathrm{b}}$ of 1 MHz with $\zeta=1$ (so $f_{\mathrm{c}}=0.7 \mathrm{MHz}$ ) we need an op-amp with $f_{\mathrm{T}} \geq 9 \mathrm{MHz}$. Our effort is rewarded, for now there are many possibilities. We can choose the OPA209 from Table 8.3, with its $f_{\mathrm{T}}$ of 18 MHz and low cost of \$2.27. ${ }^{110}$ That gives us $f_{\mathrm{GM}}=0.98 \mathrm{MHz}$, so we can set $f_{\mathrm{b}}=f_{\mathrm{GM}}=1 \mathrm{MHz}$, and with $\zeta=1$ (critical damping) we have $f_{\mathrm{c}}=0.7 \mathrm{MHz}$ and $C_{\mathrm{f}}=3 \mathrm{pF}$.

Knowing that the transimpedance stage has a usable bandwidth of 1 MHz , we next set the quiescent current of cascode transistor $Q_{1}$ high enough so that the rolloff of $r_{\mathrm{e}}$, combined with the 50 pF (bootstrapped) effective photodiode capacitance, is at a somewhat higher frequency. Here an $I_{\mathrm{C}}$ of $15 \mu \mathrm{~A}$ gives us an $r_{\mathrm{e}}$ (the impedance the signal sees at the emitter) of $1.7 \mathrm{k} \Omega$ and thus an input rolloff frequency of 1.9 MHz . The reduced $C_{\text {in }}$ produced by the bootstrap allows us to run $Q_{1}$ at this low current, with the benefit that the Johnson noise current contributed by $Q_{1}$ 's $1 \mathrm{M} \Omega$ collector and emitter resistors is no larger than that of $R_{\mathrm{f}}$. The base current shot noise is similarly reduced; here it contributes an input-referred noise current of $0.1 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ (to be compared with the $0.26 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ combined contribution of $R_{\mathrm{C}}, R_{\mathrm{E}}$, and $R_{\mathrm{f}}$ ).

Some details: ${ }^{111}$
(a) Bootstrap follower $Q_{2}$ must drive the low side of the

110 The OPA209 may even be too good for the job, with its $e_{\mathrm{n}}$ of $2.2 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. We require only that the op-amp's $e_{\mathrm{n}}$ be significantly less than that of $Q_{1}$ multiplied by the ratio of the reduced (bootstrapped) input capacitance to the capacitance at the op-amp's input node (here that works out to $7.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ ), and also that it be significantly less than the $e_{\mathrm{n}}$ of $Q_{2}$ multiplied by the ratio of the full input capacitance to the capacitance at the op-amp's input node (which usually works out to an even larger value of maximum $e_{\mathrm{n}}$ ). In other words, we could have chosen an op-amp not intended for low-noise applications from the tables in Chapter $4 x$.
${ }^{111}$ For a great read, see Phil Hobbs' book Building Electro-Optical Systems, Making It All Work, 2nd ed., Wiley (2009); a fine collection of tricks for designing cascode photodiode amplifiers, including seriespeaking inductors and $T$-coils to extend the bandwidth, noise cancellers, and more.
photodiode with an output impedance that is much lower than $Q_{1}$ 's input impedance (i.e., $r_{\mathrm{e}}$, here $1.7 \mathrm{k} \Omega$ ); that's satisfied here, where $Q_{2}$ 's high transconductance ensures a low output impedance of $Z_{o}=1 / g_{m} \sim$ $40 \Omega .{ }^{112}$
(b) We chose first a 2N5089 for the cascode transistor $Q_{1}$, because of its high beta at low currents ( $\beta=400 \mathrm{~min}$ at $\left.I_{\mathrm{C}}=100 \mu \mathrm{~A}\right)$ and low output capacitance $(2 \mathrm{pF})$, both of which promote low noise. But then we consulted Figure 8.85 and realized that it had too little GBW: $f_{\mathrm{T}}$ is just 2 MHz at $15 \mu \mathrm{~A}$. So we looked next at an MMBT918 (2N918), with a healthy $f_{\mathrm{T}}=13 \mathrm{MHz}$ at $15 \mu \mathrm{~A}$. Its base would rob about $f / f_{\mathrm{T}}$, about $8 \%$ at $f_{\mathrm{c}}$ and thus an insignificant contributor to the circuit's 3 dB rolloff at 1 MHz . But its beta is anemic, less than 40 at $15 \mu \mathrm{~A}$. So we settled finally on the 2 SC 4082 shown in the figure: it has $f_{\mathrm{T}}=20 \mathrm{MHz}$ at $10 \mu \mathrm{~A}$, and a pleasantly flat beta curve with $\beta=90$ at $100 \mu \mathrm{~A}$ (and likely not much lower at $15 \mu \mathrm{~A}$ ).
(c) There's an additional noise voltage contribution, in the form of the transistor's input noise voltage $\left(e_{\mathrm{n}}=\sqrt{4 k T\left[r_{b b^{\prime}}+0.5 r_{\mathrm{e}}\right]}\right)$ generating an " $e_{\mathrm{n}} C$ " noise current through the photodiode's effective input capacitance. These parameters don't look unfavorable for the 2SC4082. ${ }^{113}$

#### C. A final trick: "Regulated Cascode" (RGC)

Figure 8.88 shows a circuit configuration that's achieved considerable popularity in the world of photonics, where you're dealing with data rates of gigabits per second. Transistors $Q_{1}$ and $Q_{2}$ form a tight local feedback loop, with cascode transistor $Q_{1}$ 's base "regulated" by $Q_{2}$. ( $Q_{1}$ and $Q_{2}$ can be replaced by MOSFETs, as indicated.) The regulated cascode improves on the simple cascode of Figure 8.86 in two important ways. (a) The circuit's input impedance (at $Q_{1}$ 's emitter) is reduced by a factor of $Q_{2}$ 's voltage gain, greatly increasing the $R_{\mathrm{in}} C_{\mathrm{in}}$-limited bandwidth; and (b) the input noise voltage is set by $Q_{2}$, rather than by $Q_{1}$, so the latter can be run at desirable low currents without the usual noise penalty.

To expand on this a bit, remember that input capacitance in the simplest transimpedance amplifier (Figure 8.70) is both a bandwidth killer (via $R_{\mathrm{f}} C_{\mathrm{in}}$ ) and a noise enhancer

[^431]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0585.jpg?height=598&width=774&top_left_y=211&top_left_x=159)

Figure 8.88. A "regulated cascode" input stage to transimpedance amplifier $U_{1}$ allows capacitance-isolating cascode $Q_{1}$ to operate at low current without a corresponding $e_{\mathrm{n}}$ penalty. It also reduces the impedance seen at the capacitive input (by a factor of $G_{\mathrm{V} 2}$ ), for enhanced bandwidth.
(via $e_{\mathrm{n}} C$ ). We struggled with this, and the stability issues it presents, first by adding enough feedback compensation to ensure stability, then piling on op-amp speed to recover some bandwidth. Then we fiddled with circuit configurations to address directly the problem of input capacitance: first we bootstrapped the low side of the photodetector to reduce the effective input capacitance; then we added a cascode input stage to isolate the input capacitance, but that raised the circuit's input impedance (sacrificing bandwidth); so we biased the cascode to reduce $R_{\mathrm{in}}$; and finally we bootstrapped the biased cascode.

All well enough. But the result was an input stage that had to run at significant collector current, generating a difficult-to-tame dc offset that seriously limits the amount of gain in the transimpedance stage. This is not a good situation, particularly if you want to sense small input currents.

The regulated cascode elegantly addresses these problems, by allowing the cascode stage $\left(Q_{1}\right)$ to run at low current (so the circuit works well with small-signal currents), while circumventing the bandwidth and noise penalties (by driving down $R_{\text {in }}$, and by allowing $Q_{2}$ to replace $Q_{1}$ 's voltage noise). To minimize input current noise you should operate $Q_{1}$ at low collector current, but make sure you don't reduce the bandwidth excessively; ${ }^{114}$ see the discussion in the "BJT bandwidth and $f_{\mathrm{T}}$ " section of Chapter $2 x$. A vari-

[^432]ation of this configuration, in integrated form, is used in most contemporary fiber-optic receivers. ${ }^{115}$

### 8.11.11 Transimpedance amplifiers with capacitive feedback

There is a way to eliminate completely the Johnsonnoise contribution of the gain-setting feedback resistor $R_{\mathrm{f}}$, namely to eliminate the resistor itself. Feedback is then provided by the capacitor $C_{\mathrm{f}}$ alone, forming an integrator. The output signal must be differentiated to recover an output proportional to the input signal current; and of course both the integrator and differentiator must be reset (interrupting its operation) often enough to prevent saturation. To preserve the low noise of the input stage, the voltage noise of the differentiator op-amp must be significantly less than that of the input (integrating) op-amp.

Although capacitance feedback may seem an unusual approach, in fact, for ordinary TIAs operating at modestly high frequencies with high-value feedback resistors (say $100 \mathrm{M} \Omega$ and above), the self-capacitance of the resistor conceptually turns the amplifier into an integrator, with the resistor playing something akin to a reset role. Once one starts thinking along these lines, the idea of deliberately raising the feedback capacitance to $\sim 1 \mathrm{pF}$ is no longer so scary. See $\S 4 x .8$ for an example circuit and discussion.

This technique is often used in "patch-clamp" amplifiers ${ }^{116}$ and other low-level current detectors, for example, chilled germanium or silicon x-ray detectors (called IGX and $\mathrm{Si}(\mathrm{Li})$ respectively), in which the integrator is reset by an optical pulse from an LED (thus avoiding switch leakage effects).

A more common application of such an integrating transimpedance amplifier is for the readout of an imaging detector, where the quantity of interest is the total charge delivered during the brief readout, rather than its current-versus-time waveform. For this application you need to know only the change in integrator output voltage caused

[^433]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0586.jpg?height=864&width=1108&top_left_y=216&top_left_x=489)

Figure 8.89. A low-noise transimpedance preamp for a scanning tunneling microscope (STM), where tip current signals are in the nanoamp range. The tip-to-sample voltage is set by the "tip-bias" input; the frequency response goes to $\sim 10 \mathrm{kHz}$, and the gain is $0.1 \mathrm{~V} / \mathrm{nA}$. Trimmer $R_{2}$ adjusts the effective feedback capacitance, to compensate the 100 pF (or more) of capacitance seen at the shielded input line emerging from the cryogenic vacuum chamber.
by the charge delivery. This technique is known as "correlated double-sampling," and dates back to the 1950s; see the footnote on page 571.

### 8.11.12 Scanning tunneling microscope preamplifier

Scanning tunneling microscopy (STM), dating to Binnig and Rohrer's work in the early 1980s, ${ }^{117}$ allows one to image the surface topography (and other properties) of a sample at the atomic level. Figure 8.89 shows a sharp metallic tip hovering above a sample in a vacuum chamber, connected to a current-measuring preamp. When the tip is close to the surface ( $\sim 1 \mathrm{~nm}$, about ten atom diameters) and biased to $\sim 1 \mathrm{~V}$, a current of order 1 nA flows via quantummechanical "tunneling" through the potential barrier. The current is very sensitive to tip-to-sample spacing, varying exponentially such that the current typically increases by an order of magnitude when the spacing is reduced by $0.1 \mathrm{~nm} .{ }^{118}$

[^434]To form a topographic image, the tip is held at a fixed voltage and scanned across the sample, with its spacing controlled by a piezo actuator such that the measured tip current is held constant. The piezo drive voltage is then a measure of variations in the surface height, with a vertical resolution better than an atomic diameter. If the tip's point is made sufficiently small (no more than a few atoms wide), the horizontal resolution is likewise of atomic scale. Figure 8.90 shows an example, an STM image of a silicon surface.

The STM preamp is a transimpedance amplifier, usually mounted at a flange on the vacuum chamber, where it receives the tip's tunnel current signal through a length of shielded line. That adds input capacitance, typically in the range of $50-200 \mathrm{pF}$. Because the preamp is within the tip spacing servo loop, it needs plenty of bandwidth, say 20 kHz , to permit rapid scanning, thus requiring careful loop compensation (see $\S 4 x .3$ ). The preamp also needs to apply the tip-bias voltage.

In Figure 8.89 the transimpedance stage $U_{1}$ is an OPA637, an 80 MHz (decompensated) JFET op-amp with 16 pF of input capacitance and $4.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ input voltage noise (see Table 8.2 on page 516). That's rather a lot of
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0587.jpg?height=756&width=723&top_left_y=219&top_left_x=177)

Figure 8.90. Structure of a $10 \times 10 \mathrm{~nm}$ square region of a silicon crystal surface, imaged at the atomic level by an STM. The graphic model (expanded above) elucidates the observed surface structure (known as a reconstruction, because the surface atoms adopt a different arrangement compared with the bulk; here several atomic planes are seen, in a characteristic " $7 \times 7$ " reconstruction). This first image of an atomic step is adapted from the cover illustration accompanying the article referenced in Footnote 118 on page 553. (Courtesy J. Golovchenko)
input capacitance, but here it's insignificant compared with the cable capacitance, and in exchange we get a quiet wideband amplifier with low input current. Tip bias is set by the dc voltage at $U_{1}$ 's noninverting input; the op-amp's output is offset by the bias voltage, which we remove with difference amplifier $U_{5}$ (see $\S 5.14$ and Table 5.7). ${ }^{119}$
Exercise 8.5. Calculate the preamp's bandwidth for $C_{1}=0.1 \mathrm{pF}$ with $C_{\mathrm{in}}=100 \mathrm{pF}$, and also calculate the maximum allowed input capacitance. Show your stability criteria. Make a graph of the total effective input-noise-current spectral density, with curves for several values of $C_{\mathrm{in}}$, including the maximum value (don't forget $R_{1}$ 's Johnson noise). Calculate the corresponding $f_{\mathrm{X}}$ breakpoint frequencies.

This exercise demonstrates that $e_{\mathrm{n}} C_{\mathrm{in}}$ noise is a serious

[^435]limitation in overall speed and performance. Note that it's not just the op-amp's $e_{\mathrm{n}}$ that matters here - it's combined with noise in the bias voltage applied to $U_{1}$ 's noninverting input. To keep the bias voltage quiet, we use a difference amplifier $U_{4}$ to isolate ground path noise in its computercontrolled DAC, and we add a pair of $R C$ lowpass filters in the bias path through $U_{2}$; the filter at $U_{2}$ 's output is needed because otherwise the voltage noise from $U_{2}$ would make a significant contribution to that of $U_{1}$, as the next exercise demonstrates. Op-amp $U_{3}$ buffers the bias voltage into the 25 k input impedance of $U_{5}$.

Exercise 8.6. Calculate and draw a graph of the allowed spectral noise for $U_{2}$ and for the computer's bias-voltage DAC signal (input to $U_{4}$ ), assuming that the noise voltage of the final bias applied to $U_{1}$ 's noninverting input is no more than $30 \%$ of that contributed by $U_{1}$ itself.

If the STM tip scanning is momentarily stopped, the bias voltage can be changed in a ramp or a series of steps, creating an $I-V$ scan that can be used to determine additional information about the atom immediately under the tip. One approach is to repeatedly stop and make $I-V$ scans. In this way the STM can provide not only an elevation map of the surface, but also a map of elemental composition. But changing the tip-bias voltage causes a pulse of current $i=C_{\text {in }} d V / d t$ that is seen and amplified by the TIA op-amp $U_{1}$. A nice way to deal with this effect is to add $R_{5}$ and $C_{5}$ such that $R_{5} C_{5}=R_{1} C_{\text {in }}$. This creates a cancelling pulse at the inverting input of $U_{5}$, allowing an accurate tunneling current to be measured before the voltage has completely settled. This greatly speeds up the full $I-V$ scan.

This kind of circuitry is useful in other current-input applications, such as patch-clamp amplifiers in neurophysiology. It's basically a form of source-measure unit (SMU), a handy device we used to make the JFET transconductance measurements in $\S 3 x .2$ and the BJT beta plots in Figure 8.39.

### 8.11.13 Test fixture for compensation and calibration

To adjust the input compensation ( $R_{2}$ in Figures 8.80, 8.89 and $4 x .17$ ) you'd like a clean source of nanoamp-scale square waves supplying a calibrated current at the input connector; with the input cable in place you'd then adjust $R_{2}$ for best step response. You might imagine rigging up a 1 V square wave in series with a $1 \mathrm{G} \Omega$ resistor. The problem is that the resistor's parasitic shunt capacitance of $\sim 0.1 \mathrm{pF}$ causes input current spikes at each transition of
the square wave; it takes only $0.01 \mathrm{~V} / \mu$ s of input slewing to produce 1 nA current pulses.

Figure 8.91 shows two solutions to this problem. In circuit A a tunable input series $R C$ (lowpass, or "pole") compensates the current-scaling resistor $R_{2}$ 's parallel parasitic capacitance $C_{\mathrm{p}}$ (highpass, or "zero"). For this simple model of parasitic capacitance, cancellation requires $R_{1} C_{1}=R_{2} C_{\mathrm{p}}$. The optional isolated input connector suppresses ground path current spikes between the signal generator and the preamp and oscilloscope. Circuit B takes a different approach, using a small series capacitor (into the summing junction at the output) as a differentiator; $i=C_{2} d V_{\text {in }} / d t$ predicts a $\pm 1 \mathrm{nA}$ output square wave for a 0.5 Vpp input triangle wave at 1 kHz . This circuit is the simpler, but its performance depends sensitively on the quality of the triangle wave at its turning points; we've gotten good results from Agilent 33120A (and later models) synthesized function generators. Your mileage may vary.

### 8.11.14 A final remark

We remind the reader that we've loosely referred to transimpedance amplifiers as "photodiode amplifiers"; that is, of course, just one application (though an important one) among many.

Our treatment in this chapter is concerned primarily with noise in transimpedance amplifiers, assuming familiarity with the basics. Be sure to visit $\S 4 x .3$ for an introduction to transimpedance amplifiers, a treatment of stability
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0588.jpg?height=468&width=818&top_left_y=1496&top_left_x=211)

Figure 8.91. Test fixture for producing a nanoamp square-wave input for compensating and calibrating a transimpedance amplifier. A. Adjustable $R_{1} C_{1}$ (a "pole") cancels the peaking caused by $R_{2}$ 's shunt capacitance (a "zero"), so that a 0.1 V square wave creates a clean 1 nA output square wave of current into a summing junction. B. Capacitive differentiator converts a 500 mV (peak-to-peak) 1 kHz triangle voltage wave into a $\pm 1 \mathrm{nA}$ square current wave at the output summing junction.
and bandwidth, and a healthy collection of important and useful tricks.

## 8.12 Noise measurements and noise sources

It is a relatively straightforward process to determine the equivalent noise voltage and current of an amplifier, and from these the noise figure and signal-to-noise ratio for any given signal source. That's all you ever need to know about the noise performance of an amplifier. Basically the process consists of putting known noise signals across the input, then measuring the output-noise signal amplitudes within a certain bandwidth. In some cases (e.g., a matched input-impedance device such as a radiofrequency amplifier) an oscillator of accurately known and controllable amplitude is substituted as the input signal source.

Later we discuss the techniques you need to do the output voltage measurement and bandwidth limiting. For now, let's assume you can make rms measurements of the output signal with a measurement bandwidth of your choice.

### 8.12.1 Measurement without a noise source

For an amplifier stage made from an FET or transistor and intended for use at low to moderate frequencies, the input impedance is likely to be very high. You want to know $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ so that you can predict the SNR with a signal source of arbitrary source impedance and signal level, as we discussed earlier. The procedure is simple.

First, determine the amplifier's voltage gain $G_{\mathrm{V}}$ by actual measurement with a signal in the frequency range of interest. The amplitude should be large enough to override amplifier noise, but not so large as to cause amplifier saturation.

Second, short the input and measure the rms noise output voltage, $e_{\mathrm{s}}$. From this you get the input noise voltage per root hertz from

$$
\begin{equation*}
e_{\mathrm{n}}=\frac{e_{\mathrm{s}}}{G_{\mathrm{V}} B^{\frac{1}{2}}} \quad \mathrm{~V} / \mathrm{Hz}^{\frac{1}{2}} \tag{8.47}
\end{equation*}
$$

where $B$ is the bandwidth of the measurement (see $\S 8.13$ ).
Third, put a resistor $R$ across the input and measure the new rms noise output voltage, $e_{\mathrm{r}}$. The resistor value should be large enough to add significant amounts of current noise, but not so large that the input impedance of the amplifier begins to dominate. (If this is impractical, you can leave the input open and use the amplifier's input impedance as $R$.) The output you measure is just

$$
\begin{equation*}
e_{\mathrm{r}}^{2}=\left[e_{\mathrm{n}}^{2}+4 k T R+\left(i_{\mathrm{n}} R\right)^{2}\right] B G_{\mathrm{V}}^{2} \tag{8.48}
\end{equation*}
$$

from which you can determine $i_{\mathrm{n}}$ to be

$$
\begin{equation*}
i_{\mathrm{n}}=\frac{1}{R}\left[\frac{e_{\mathrm{r}}^{2}}{B G_{\mathrm{V}}^{2}}-\left(e_{\mathrm{n}}^{2}+4 k T R\right)\right]^{\frac{1}{2}} \tag{8.49}
\end{equation*}
$$

With some luck, only the first term in the square root will matter (i.e., if current noise dominates both amplifier voltage noise and source resistor Johnson noise).

Now you can determine the SNR for a signal $V_{\mathrm{s}}$ of source impedance $R_{\mathrm{S}}$, namely,

$$
\begin{align*}
\operatorname{SNR}(\mathrm{dB}) & =10 \log _{10}\left(\frac{V_{\mathrm{s}}^{2}}{v_{\mathrm{n}}^{2}}\right) \\
& =10 \log _{10}\left[\frac{V_{\mathrm{s}}^{2}}{\left[e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{s}}\right)^{2}+4 k T R_{\mathrm{S}}\right] B}\right] \tag{8.50}
\end{align*}
$$

where the numerator is the signal voltage (presumed to lie within the bandwidth $B$ ) and the terms in the denominator are the amplifier noise voltage, amplifier noise current applied to $R_{\mathrm{s}}$, and Johnson noise in $R_{\mathrm{s}}$. Note that increasing the amplifier bandwidth beyond what is necessary to pass the signal $V_{\mathrm{s}}$ only decreases the final SNR. However, if $V_{\mathrm{s}}$ is broadband (e.g., a noise signal itself), the final SNR is independent of amplifier bandwidth. In many cases the noise will be dominated by one of the terms in the preceding equation.

### 8.12.2 An example: transistor-noise test circuit

For the measured noise data in Table 8.1a we used the circuit in Figure 8.92. It's basically an elaboration of the simple single-ended grounded-emitter amplifier of Figure 8.42 , with provision for gain calibration, and sockets and test points for component substitution. The singleended configuration requires a large input blocking capacitor. Follower $Q_{2}$ biases the device under test (DUT) to the nominal quiescent voltage point by way of $R_{8}$, with choice of $R_{\mathrm{C}}$ setting the quiescent current. Optional resistor $R_{\mathrm{B}}$ permits measurement of both $\beta$ and $i_{\mathrm{n}}$. The unusually long $R C$ time constants throughout (capacitance multiplier, input and output blocking networks) are needed to suppress excess low frequency noise; the circuit takes many seconds to settle.

This circuit could be improved in several ways (but it was not, owing to operator exhaustion). ${ }^{120}$

[^436]
### 8.12.3 Measurement with a noise source

The preceding technique of measuring the noise performance of an amplifier has the advantage that you don't need an accurate and adjustable noise source, but it requires an accurate voltmeter and filter, and it assumes that you know the gain versus frequency of the amplifier, with the actual source resistance applied. An alternative method of noise measurement involves applying broadband noise signals of known amplitude to the amplifier's input and observing the relative increase of output noise voltage. Although this technique requires an accurately calibrated noise source, it makes no assumptions about the properties of the amplifier, because it measures the noise properties right at the point of interest, at the input.

Again, it is relatively straightforward to make the requisite measurements. You connect the noise generator to the amplifier's input, making sure that its source impedance $R_{\mathrm{g}}$ equals the source impedance of the signal you ultimately plan to use with the amplifier. You first note the amplifier's output rms noise voltage, with the noise-source attenuated to zero output signal. Then you increase the noise source rms amplitude $V_{\mathrm{g}}$ until the amplifier's output rises 3 dB (a factor of 1.414 in rms output voltage). The amplifier's input noise voltage in the measurement bandwidth, for this source impedance, equals this value of added signal. The amplifier therefore has a noise figure

$$
\begin{equation*}
\mathrm{NF}(\mathrm{~dB})=10 \log _{10}\left(\frac{V_{\mathrm{g}}^{2}}{4 k T R_{\mathrm{g}}}\right) \tag{8.51}
\end{equation*}
$$

From this you can figure out the SNR for a signal of any amplitude with this same source impedance, using eq'n 8.14 :

$$
\begin{equation*}
\mathrm{SNR}(\mathrm{~dB})=10 \log _{10}\left(\frac{V_{\mathrm{S}}^{2}}{4 k T R_{\mathrm{S}}}\right)-\mathrm{NF}\left(R_{\mathrm{S}}\right) \tag{8.52}
\end{equation*}
$$

There are nice calibrated noise sources available, most

[^437]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0590.jpg?height=1391&width=807&top_left_y=205&top_left_x=219)

Figure 8.92. Transistor noise test circuit. $Q_{3}$ and associated components form a noise-eliminating capacitance multiplier. Polarities shown are for an npn device under test (DUT); for pnp reverse the polarity of components marked with asterisks. The gain-calibrating input signal is replaced by a $0 \Omega$ shorting plug during noise measurement.
of which provide means for attenuation to precise levels in the microvolt range. Note: once again, the preceding formulas assume $R_{\mathrm{in}} \gg R_{\mathrm{S}}$. If, on the other hand, the noisefigure measurement is made with a matched signal source, i.e., if $R_{\mathrm{S}}=Z_{\mathrm{in}}$, then omit the factors " 4 " in the preceding expressions.

Note that this technique does not tell you $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ directly, just the appropriate combination for a source of impedance equal to the driving impedance you used in the
measurement. Of course, by making several such measurements with different noise source impedances, you could infer the values of $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$.

A nice variation on this technique is to use resistor Johnson noise as the "noise source." This is a favorite technique used by designers of very low noise radiofrequency amplifiers (in which, incidentally, the signal source impedance is usually $50 \Omega$ and matches the amplifier's input impedance). It is usually done the following way: a dewar of liquid nitrogen holds a $50 \Omega$ "termination" (a fancy name for a well-designed resistor that has negligible inductance or capacitance) at the temperature of boiling nitrogen, $77^{\circ} \mathrm{K}$; a second $50 \Omega$ termination is kept at room temperature. The amplifier's input is connected alternately to the two resistors (usually with a high-quality coax relay), and the output noise power (at some center frequency, with some measurement bandwidth) is measured with an RF power meter. Call the results of the two measurements $P_{\mathrm{C}}$ and $P_{\mathrm{H}}$, the output noise power corresponding to cold and hot source resistors, respectively. It is then easy to show that the amplifier's noise temperature, at the frequency of the measurement, is just

$$
\begin{equation*}
T_{\mathrm{n}}=\frac{T_{\mathrm{H}}-Y T_{\mathrm{C}}}{Y-1} \quad \text { Kelvin, } \tag{8.53}
\end{equation*}
$$

where $Y=P_{\mathrm{H}} / P_{\mathrm{C}}$, the ratio of noise powers. The noise figure is then given by eq'n 8.16 , namely,

$$
\begin{equation*}
\mathrm{NF}(\mathrm{~dB})=10 \log _{10}\left(\frac{T_{\mathrm{n}}}{290}+1\right) \tag{8.54}
\end{equation*}
$$

Exercise 8.7. Derive the foregoing expression for noise temperature. Hint: begin by noting that $P_{\mathrm{H}}=\alpha\left(T_{\mathrm{n}}+T_{\mathrm{H}}\right)$ and $P_{\mathrm{C}}=$ $\alpha\left(T_{\mathrm{n}}+T_{\mathrm{C}}\right)$, where $\alpha$ is a constant that will shortly disappear. Then note that the noise contribution of the amplifier, stated as a noise temperature, adds to the noise temperature of the source resistor. Take it from there.

Exercise 8.8. Amplifier noise temperature (or noise figure) depends on the value of signal source impedance, $R_{\mathrm{s}}$. Show that an amplifier characterized by $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ (as in Figure 8.28) has minimum noise temperature for a source impedance $R_{\mathrm{S}}=e_{\mathrm{n}} / i_{\mathrm{n}}$. Then show that the noise temperature, for that value of $R_{\mathrm{s}}$, is given by $T_{\mathrm{n}}=e_{\mathrm{n}} i_{\mathrm{n}} / 2 k$.

If you don't want to bother with liquid nitrogen and are interested only in relatively low-frequency amplifiers, you can exploit the curious fact that a BJT's input noise voltage (at low currents, where $r_{\mathrm{bb}^{\prime}}$ effects are insignificant) is equal to the Johnson noise of a real resistor of value $r_{\mathrm{e}} / 2$. For example, if you ground the base, tie the collector to +5 V , and pull down the emitter through 10 k to -5 V , you'll see at the emitter a noise signal with $50 \Omega$ source impedance and 150 K noise temperature. Add a blocking
capacitor, and alternate this noise source with a real $50 \Omega$ resistor (use a coax relay, not a CMOS switch!), and you've got a simple (and seriously inexpensive!) two-temperature noise calibrator. ${ }^{121}$

#### A. Amplifiers with matched input impedance

This last technique is ideal for noise measurements of amplifiers designed for a matched signal-source impedance. The most common examples are in radiofrequency amplifiers or receivers, usually meant to be driven with a signal source impedance of $50 \Omega$, and that themselves have an input impedance of $50 \Omega$. See Appendix $H$ for an explanation of this departure from our usual criterion that a signal source should have a small source impedance compared with the load it drives. In this situation, $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ are irrelevant as separate quantities; what matters is the overall noise figure (with matched source) or some specification of SNR with a matched signal source of specified amplitude.

Sometimes the noise performance is explicitly stated in terms of the narrowband input signal amplitude required for obtaining a certain output SNR. A typical radiofrequency receiver might specify a 10 dB SNR with a $0.25 \mu \mathrm{~V}$ rms input signal and 2 kHz receiver bandwidth. In this case the procedure consists of measuring the rms receiver output with the input driven by a matched sinewave source initially attenuated to zero, then increasing the (sinewave) input signal until the rms output rises 10 dB , in both cases with the receiver bandwidth set to 2 kHz . It is important to use a meter that reads true rms voltages for a measurement where noise and signal are combined (more about this later). Note that radiofrequency noise measurements often involve output signals that are in the audiofrequency range.

### 8.12.4 Noise and signal sources

Broadband noise can be generated from the effects we discussed earlier, namely Johnson noise and shot noise. The shot noise in a vacuum diode is a classic source of broadband noise that is especially useful because the noise voltage can be predicted exactly; zener diode noise is also widely used in noise sources, as are gas discharge tubes. These extend from dc to very high frequencies, making them useful in audiofrequency and radiofrequency measurements. Look ahead to Figure 13.121 for an example of a "true random" noise generator.

Versatile signal sources are available with precisely controlled output amplitude (down to the microvolt range and

[^438]below) over frequencies from a fraction of a hertz to many gigahertz, programmable via GPIB, USB, or LAN. An example is the Agilent model E8257D synthesized signal generator, with output frequencies from 0.25 MHz to 20 GHz , calibrated amplitudes from 40 nV to 1 V rms , modulation and frequency sweeping modes, handsome digital display and bus interface, and nifty accessories that extend the frequency range to 500 GHz . This is a bit more than you usually need to do the job. And at $+45 \mathrm{~dB} \$$ it likely costs a bit more than you're interested in paying. For a tenth the price (and a hundredth the bandwidth) you can get one of Tektronix's "Arbitrary Function Generators," for example the 2-channel AFG3102C (about \$6k), which provide a Gaussian noise output in addition to standard waveforms (sine, square, pulse, triangle, etc.) and arbitrary (programmed) waveforms. And if it's only a noise waveform you want, you can get broadband noise sources like the Noisecom NC346 (10 MHz-18 GHz).

Some versatile noise sources can generate pink noise as well as white noise. Pink noise has equal noise power per octave, rather than equal power per hertz. Its power density (power per hertz) drops off at $3 \mathrm{~dB} /$ octave (though to the ear it sounds more like spectrally flat random noise than does white noise). It is widely used as a source signal for audio systems; in a typical application you would equalize a speaker system, driven with a pink noise source, by taking measurements with a handheld real-time spectrum analyzer (e.g., the Smaart ${ }^{\circledR}$ acoustic software tools). Because an $R C$ filter's attenuation falls at $6 \mathrm{~dB} /$ octave, a more complicated filter is necessary to generate a pink spectrum from a white-noise input. Read the next subsection to see how this is done.

#### A. Pseudorandom noise source

We can make an interesting noise source by using digital techniques, in particular by connecting long shift registers with their input derived from a modulo-2 addition of several of the later bits (see $\S \S 11.3 .1$ and 13.14). The resultant output is a pseudorandom sequence of 1 s and 0 s that, after lowpass filtering, generates an analog signal of white spectrum up to the lowpass filter's breakpoint, which must be well below the frequency at which the register is shifted. These things can be run at very high frequencies, generating noise up to many megahertz or more. The "noise" has the interesting property that it repeats itself exactly after a time interval that depends on the register length (an $n$-bit maximal-length register goes through $2^{n}-1$ states before repeating). Without much difficulty, that time can be made to be very long (years, or millennia), although most often a period of a second is long enough. For example, a 50-bit
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0592.jpg?height=804&width=1649&top_left_y=213&top_left_x=219)

Figure 8.93. Pseudorandom noise source providing three colors of analog noise from 10 Hz to 100 kHz , with measured values of output noise density (at 1 kHz ) and band-limited noise voltage (4-pole Butterworth, $10 \mathrm{~Hz}-10 \mathrm{kHz}$ ).
register shifted at 10 MHz will generate white noise up to 1 MHz or so, with a repeat time of 3.6 years.

The circuit shown in Figure 8.93 uses a 71-bit maximallength shift register, clocked at 1 MHz , to generate a digital pseudorandom waveform that is spectrally flat ( $\pm 0.07 \mathrm{~dB}$ ) out to 100 kHz . The pseudorandom bit sequence is ridiculously long - with a 1 MHz clock it repeats in about 75 million years. Creating either white or red noise is easy: the "white" selection simply filters the raw 2-level waveform through an $R C$ lowpass at 200 kHz , above the band of interest, to suppress the (wideband) clocking edges. The "red" selection inserts instead a lowpass filter at 5 Hz , below the band of interest, so the output rolls off at the usual $6 \mathrm{~dB} /$ octave.

Pink noise is trickier; you need a filter that reduces the white-noise amplitude by a factor of $1 / \sqrt{2}$ (rather than $1 / 2$ ) for every doubling of frequency. The usual analog method is to use a parallel set of series $R C$ sections (as in Figure 8.93), with the characteristic frequency of each successive section increasing by a fixed ratio (here $\times 10$, i.e., one decade) with an impedance that decreases by the square root of that same ratio (here $\sqrt{10}$ ). Even with such generous decade spacing you do remarkably well, as seen in the SPICE results of Figure 8.94, where the deviation from ideal $-3 \mathrm{~dB} /$ octave behavior is just $\pm 0.25 \mathrm{~dB}$ over the 5 -
decade frequency range of 10 Hz to $1 \mathrm{MHz} .{ }^{122}$
Simulations are fun, but the "rubber hits the road" when you actually build something and measure its performance. We did that, and Figure 8.95 shows the measured spectra of the circuit of Figure 8.93, which, to within the thickness of the (wiggly) lines, performs as advertised.

#### A few notes on the circuit

We cannot resist a few comments on the circuit design. As always, there are several choices at each step: a good design balances issues of performance, cost, complexity, availability of components, power, reliability, and (dare we say it?) elegance. For example, the $\sim 1 \mathrm{MHz}$ clocking signal could be supplied from a \$2 crystal-oscillator module; but for this application it needn't be accurate or stable, and so we chose to use two unused sections of the quad XNOR to make a simple $R C$ relaxation oscillator. (We haven't seen this particular implementation used elsewhere, but it is completely straightforward: it is the topology of Figure 7.5, with $U_{1 \mathrm{a}}$ configured as a noninverting Schmitt buffer, followed by the $U_{1 \mathrm{~b}}$ inverter. The hysteresis is set by $R_{2} R_{3}$, to 0.65 V , with small speed-up capacitor $C_{2}$. The frequency is set by $R_{1} C_{1}$.)
${ }^{122}$ A bit of candor here: to achieve this performance we did a bit of fine tuning to arrive at the circuit's choice of $1 \%$ resistor values.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0593.jpg?height=805&width=1455&top_left_y=215&top_left_x=219)

Figure 8.94. Simulation in SPICE of the pink-noise filter ( $R_{5}$ and components below) in Figure 8.93.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0593.jpg?height=572&width=1152&top_left_y=1099&top_left_x=373)

Figure 8.95. Measured spectra of the circuit of Figure 8.93. Each plotted spectrum is made from two 800-point FFT spectra to span the full 100,000:1 frequency range. The measured total noise voltage $v_{\mathrm{n}}$ and noise densities $e_{\mathrm{n}}$ are listed in Figure 8.93.

We chose the 74HC logic family because parts are readily available, easy to prototype (through-hole DIP), plenty fast, and of low power. ${ }^{123}$ There are standard logic functions for what we needed, so we chose that path (rather

[^439]than the alternatives: a cPLD, FPGA, or microcontroller). Available shift registers were either too small (8 stages), or outrageously large (the 'HC7731 we used is 256 stages, as four separate 64 -stage shift-register banks). We went with the latter, using only one bank, and appending a 'HC164 8 -stage parallel-out shift register so we could get at the needed taps (here $m=65$ and $n=71$; see Table 13.14). Note the use of exclusive-NOR (rather than exclusive-OR), to prevent the stuck state of all zeros and thus guarantee startup.

The output buffer is a nice BiCMOS rail-to-rail input/
output op-amp, with 5 MHz GBW, low input current ( 4 pA , typ), plenty of output drive capability ( $\pm 20 \mathrm{~mA}$ ), and modest power consumption ( 1.2 mA ); it's noisy ( $20 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, with a high $1 / f$ corner frequency), but that hardly matters when you're amplifying noise anyway. The series resistor $R_{7}$ ensures stability into capacitive loads and (if you care) provides source termination into $50 \Omega$ cable.

For the 5 V regulator $\left(U_{5}\right)$ we initially reached for something from the legacy LP2950 or LM2931 series of lowdropout linear regulators. But the LP2950 is intolerant of reversed input polarity (a feat easy enough to accomplish when replacing a 9 V battery); and both regulators are somewhat fussy when it comes to the output capacitor. In particular, they require some minimum amount of equivalent series resistance (ESR), ${ }^{124}$ which is worrisome - how is one expected to deal with the low-ESR ceramic bypass capacitors that litter the rest of the circuit? Happily, there are nice LDOs that do not burden the designer with such worries: the LT1121-5 we chose is stable with output capacitors of zero ESR, and it's tolerant of reverse input (to -30 V ); it also has the usual overcurrent and overtemperature protection.

There's more extensive discussion of pseudorandom noise, along with another pseudorandom noise source design (Figure 13.119), in §13.14.

## 8.13 Bandwidth limiting and rms voltage measurement

### 8.13.1 Limiting the bandwidth

All the measurements we have been talking about assume that you are looking at the noise output only in a limited frequency band. In a few cases the amplifier may have provision for this, making your job easier. If not, you have to hang some sort of filter on the amplifier output before measuring the output noise voltage.
$\boldsymbol{R C}$ filter The easiest thing to use is a simple $R C$ lowpass (or bandpass) filter, with 3 dB point(s) set at roughly

[^440]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0594.jpg?height=348&width=697&top_left_y=219&top_left_x=1121)

Figure 8.96. Equivalent brick-wall noise bandwidth for $R C$ lowpass filter.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0594.jpg?height=269&width=717&top_left_y=702&top_left_x=1116)

Figure 8.97. Equivalent brick-wall noise bandwidth for $R C$ bandpass filter. For the case $f_{1}=f_{2}$ the midband gain is -6 dB .
the bandwidth you want. For accurate noise measurements, you need to know the "equivalent noise bandwidth" (ENBW), i.e., the width of a perfect "brick-wall" filter that lets through the same noise voltage (Figure 8.96). This noise bandwidth is what should be used for $B$ in all the preceding formulas. It is not terribly difficult to do the mathematics, and you find, for an $R C$ lowpass filter,

$$
\begin{equation*}
B=\frac{\pi}{2} f_{3 \mathrm{~dB}}=1.57 f_{3 \mathrm{~dB}} \tag{8.55}
\end{equation*}
$$

For a pair of cascaded lowpass $R C$ sections (buffered so they don't load each other), the magic formula becomes $B=1.22 f_{3 \mathrm{~dB}}$. For the Butterworth lowpass filters discussed in §§6.2.6 and 6.3.2, the noise bandwidth is

$$
\begin{aligned}
& B=1.57 f_{3 \mathrm{~dB}}=\frac{1}{4 R C} \quad(1 \text { pole }), \\
& B=1.11 f_{3 \mathrm{~dB}} \approx \frac{1}{5.6 R C} \quad(2 \text { poles }), \\
& B=1.05 f_{3 \mathrm{~dB}} \approx \frac{1}{6 R C} \quad(3 \text { poles }), \\
& B=1.025 f_{3 \mathrm{~dB}} \approx \frac{1}{6.1 R C} \quad(4 \text { poles }) .
\end{aligned}
$$

If you want to make band-limited measurements up at some center frequency, you can use a pair of $R C$ filters (Figure 8.97), in which case the noise bandwidth is as indicated. You may wish to use higher-order Butterworth filters for more precise bandpass characteristics. In that case you'll need to know the corresponding equivalent noise bandwidths; don't panic - they're listed in Table 8.4 on page 564.
RLC filter Another way to make a bandpass filter for noise measurements is to use an RLC circuit. This is
better than a pair of cascaded highpass and lowpass $R C$ filters if you want your measurement over a bandpass that is narrow compared with the center frequency (i.e., high $Q$ ). Figure 8.98 shows both parallel and series $R L C$ circuits and their exact noise bandwidths. In both cases the resonant frequency is given by $f_{0}=1 / 2 \pi \sqrt{L C}$. You might arrange the bandpass filter circuit as a parallel $R L C$ collector (or drain) load, in which case you use the expression as given. Alternatively (recall Figure 1.107), you might interpose the filter as shown in Figure 8.99; for noise-bandwidth purposes the circuit is exactly equivalent to the parallel $R L C$, with $R=R_{1} \| R_{2}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0595.jpg?height=329&width=272&top_left_y=693&top_left_x=188)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0595.jpg?height=208&width=292&top_left_y=794&top_left_x=568)
$B$.

Figure 8.98. Equivalent brick-wall noise bandwidth for RLC bandpass filter. For the parallel circuit (A) the source signal is a current, and the output is the voltage across the terminals; for the series configuration (B) the input is a voltage applied across the circuit, and the output is the resulting current.

Averaging As we mentioned in $\S 8.1 .5$, another way to accomplish lowpass filtering of a slow signal (a dc voltage, say, in the presence of additive white noise) is simply to average it over some time interval $T$; this is the same averaging operation as is done by an integrating ADC (e.g., in a digital voltmeter, see $\S 13.8 .3$ ). In that case the equivalent noise bandwidth ${ }^{125}$ is $B=1 / 2 T$. Thus, for example, an averaging duration of 1 second admits a noise bandwidth of 0.5 Hz . This is a simple lowpass "filter" - but one that is less sharp even than a single-section $R C$ (the latter falls off at $6 \mathrm{~dB} /$ octave, compared with $3 \mathrm{~dB} /$ octave for the time average).

[^441]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0595.jpg?height=350&width=723&top_left_y=177&top_left_x=1016)

Figure 8.99. Interstage RLC bandpass filter.

Digital filter Digital signal processing (DSP) is an effective way to implement extremely well-defined filter functions, with their characteristics easily modified by changing the stored numerical coefficients. See $\S 6.3 .7$ for more detail.

Frequency translation Imagine you want to make measurements of the "spot noise voltage" in some narrow bandwidth (say 10 Hz ) centered at some relatively high frequency $f_{\text {in }}$, where the latter may be up at tens to hundreds of kilohertz, or perhaps even a megahertz or more. That is, the ratio $Q=f_{\text {in }} / \Delta f$ is very large, say greater than a thousand. Such a high- $Q$ bandpass filter is pretty difficult to implement! But there's a good way to do the measurement without filter heroics.

The trick is to shift (translate) the frequency band of interest down to a much lower frequency, where it's easy to make a narrowband filter. The technique is called heterodyning, and it's a basic technique in most radiofrequency communications systems. It's easiest to understand if you think initially of a single input frequency. Figure 8.100 shows the basic scheme, in which an input signal voltage (at frequency $f_{\text {in }}$ ) is multiplied by a sinusoidal voltage (at frequency $f_{\text {LO }}$ ) from a local oscillator ("LO"), creating a pair of sinusoidal signals at frequencies $f_{\text {in }} \pm f_{\text {LO }} \cdot{ }^{126}$ The multiplier is called a mixer, and its output is filtered to eliminate one of the mixing products. Mixers can be in the form of an active circuit (a "4-quadrant multiplier"), or, for use at higher frequencies, a passive transformer-coupled diode arrangement called a balanced mixer.

In a communications application there may be several stages of frequency translation, passing through several intermediate-frequency ("IF") stages where amplification and filtering takes place. ${ }^{127}$ For a simple noise-measuring

[^442]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0596.jpg?height=568&width=642&top_left_y=206&top_left_x=299)

Figure 8.100. Heterodyne frequency shifting: the mixer produces sum and difference frequencies; only the latter survives the lowpass filter.
application it may be adequate to mix directly to "baseband," by tuning the LO to the frequency at which the spot noise voltage is to be measured. This is the same process used in synchronous detection, described later in §§8.14 and 13.13.6D. Commercial synchronous (lock-in) amplifiers let you make narrowband spot noise voltage measurements at any frequency in their range, extending to 100 kHz (for typical lock-in amplifiers) to as high as 200 MHz (e.g., for the SR844).

### 8.13.2 Calculating the integrated noise

Let's begin with the simple single-section $R C$ lowpass band-limiting filter. From its equivalent brick-wall bandwidth (eq'n 8.55), the integrated noise-voltage output from filtering a white-noise input of noise density $e_{n}$ is found by taking the square root of

$$
\begin{equation*}
v_{\mathrm{n}}^{2}=e_{\mathrm{n}}^{2} B=e_{\mathrm{n}}^{2} \frac{\pi}{2} f_{3 \mathrm{~dB}} \quad \mathrm{~V}^{2}(\mathrm{rms}) \tag{8.56}
\end{equation*}
$$

and analogously for noise current.
Things get more complicated if the noise density $e_{\mathrm{n}}$ depends on frequency, as it does, for example, with $1 / f$ ("pink") noise. In such a case you must integrate, over frequency, the squared noise density $e_{\mathrm{n}}^{2}(f)$ times the filter's spectral power bandpass characteristic. And it's common to use a bandpass filter, with both lower and upper frequency limits (call them $f_{1}$ and $f_{2}$ ). Then an ideal "brickwall" (or should it be "squash court"?!) bandpass filter has unit response between $f_{1}$ and $f_{2}$, and a noise bandwidth of $B=f_{2}-f_{1}$.

Brick walls are hard to implement in analog technology, and a simple expedient, as suggested earlier, is simply
to use a cascaded pair of $R C$ 's, with 3 dB frequencies of $f_{1}$ and $f_{2}$. With a bit of mathematical finesse you could demonstrate proficiency by performing the appropriate integrals, thus figuring the output noise voltage for the "standard noises" (white, or $1 / f$, or even $1 / f^{2}$ ). A shortcut is to exploit the brilliance of Wolfram's impressive Mathematica program. A colleague ${ }^{128}$ did this for us, and Table 8.4 on the next page summarizes the results, for those three colors of noise, and for four styles of bandpass filters (brick-wall, simple $R C$ (single-pole; that is, a pair of cascaded $R C$ sections), 2-pole Butterworth, and $m$-pole Butterworth.

The expressions listed give you the integrated squared noise voltage $v_{\mathrm{n}}^{2}$, for given lower and upper -3 dB frequency limits $f_{1}$ and $f_{2}$, and noise voltage density $e_{\mathrm{n}}$ (Figure 8.101); the rms noise voltage is then gotten by taking the square root: $V_{\mathrm{n}(\mathrm{rms})}=\sqrt{v_{\mathrm{n}}^{2}}$. For pink noise ( $1 / f$ in power) and red noise ( $1 / f^{2}$ in power) the noise density $e_{\mathrm{n}}$ is a function of frequency; for these expressions we have used for the overall multiplying factor the noise density at the high band end; that is, $e_{\mathrm{n}}^{2}\left(f_{2}\right)$ (abbreviated as $e_{n 2}^{2}$ in the table), which is the squared noise density at $f=f_{2}$, in units of $V^{2} / \mathrm{Hz}$.

Note that you can set $f_{1}=0$, in the expressions for white noise, to get the dc-to- $f_{2}$ (lowpass-limited) noise voltage. If you do so, you'll get the expressions shown on page 561. This does not work for pink or red noise, though, because the integral diverges at zero frequency, conveyed in these expressions by the embarrassment of a zero denominator in the log's argument (pink) or, worse, in the result itself (red). This is why $1 / f$ noise is typically measured with a 0.1 Hz to 10 Hz limited bandwidth, etc.; see Figures 8.102 and 8.103.

Noise current is treated just the same: substitute everywhere the noise current density $i_{\mathrm{n}}$ in place of $e_{\mathrm{n}}$, to find the integrated noise current $I_{\mathrm{n}(\mathrm{rms})}$.

#### A. The high end matters most

To calculate the integrated noise voltage over some bandpass, you need to integrate the noise power density $\left(e_{\mathrm{n}}^{2}\right)$ over frequency, taking account of the filter's passband response (call that $H(f) \equiv V_{\text {out }} / V_{\mathrm{in}}$, and don't worry about phase); that is,

$$
\begin{equation*}
v_{\mathrm{n}}^{2}=\int_{f_{1}}^{f_{2}} e_{\mathrm{n}}^{2} H^{2}(f) d f \quad \mathrm{~V}^{2}(\mathrm{rms}) ; \tag{8.57}
\end{equation*}
$$

and then you take the square root: $V_{\mathrm{n}(\mathrm{rms})}=\sqrt{v_{\mathrm{n}}^{2}}$.
So, looking at log-log plots of filter passbands like

[^443]
Table 8.4 Noise Integrals ${ }^{\text {a }}$

|  |  | Noise Spectral Shape |  |
| :---: | :---: | :---: | :---: |
| Filter Type | $\begin{gathered} \text { white } \\ \left(e_{\mathrm{n}}=\mathrm{const}\right) \end{gathered}$ | $\begin{gathered} \text { pink } \\ \left(e_{\mathrm{n}} \sim 1 / \sqrt{f}\right) \end{gathered}$ | $\begin{gathered} \text { red } \\ \left(e_{\mathrm{n}} \sim 1 / f\right) \end{gathered}$ |
| brickwall | $e_{\mathrm{n}}^{2}\left(f_{2}-f_{1}\right)$ | $e_{n 2}^{2} f_{2} \log _{e} \frac{f_{2}}{f_{1}}$ | $e_{n 2}^{2} \frac{f_{2}}{f_{1}}\left(f_{2}-f_{1}\right)$ |
| 1-pole (RC) | $e_{\mathrm{n}}^{2} \frac{\pi}{2} \frac{f_{2}^{2}}{f_{1}+f_{2}}$ | $e_{n 2}^{2} \frac{f_{2}^{3}}{f_{2}^{2}-f_{1}^{2}} \log _{e} \frac{f_{2}}{f_{1}}$ | $e_{n 2}^{2} \frac{\pi}{2} \frac{f_{2}^{3}}{f_{1}\left(f_{1}+f_{2}\right)}$ |
| 2-pole Butterworth | $e_{\mathrm{n}}^{2} \frac{\pi}{2 \sqrt{2}} \frac{f_{2}^{4}}{\left(f_{1}+f_{2}\right)\left(f_{1}^{2}+f_{2}^{2}\right)}$ | $e_{n 2}^{2} \frac{f_{2}^{5}}{f_{2}^{4}-f_{1}^{4}} \log _{e} \frac{f_{2}}{f_{1}}$ | $e_{n 2}^{2} \frac{\pi}{2 \sqrt{2}} \frac{f_{2}^{5}}{f_{1}\left(f_{1}+f_{2}\right)\left(f_{1}^{2}+f_{2}^{2}\right)}$ |
| m-pole Butterworth | $e_{\mathrm{n}}^{2} \frac{\pi / 2 m}{\sin (\pi / 2 m)} \frac{f_{2}-f_{1}}{1-\left(f_{1} / f_{2}\right)^{2 m}}$ | $e_{n 2}^{2} \frac{f_{2}}{1-\left(f_{1} / f_{2}\right)^{2 m}} \log _{e} \frac{f_{2}}{f_{1}}$ | $e_{n 2}^{2} \frac{\pi / 2 m}{\sin (\pi / 2 m)} \frac{f_{2}-f_{1}}{1-\left(f_{1} / f_{2}\right)^{2 m}}$ |

Notes: (a) Values of the mean-squared noise voltage, $v_{\mathrm{n}}^{2}$, in a frequency band from $f_{1}$ to $f_{2}$, as bandpass limited by the indicated filter type. The noise voltage density $e_{\mathrm{n} 2}$ is the value of $e_{\mathrm{n}}$ at $f=f_{2}$.
those in Figure 8.101, you might at first think that a bandpass filter with symmetrical and sharp rolloffs at both low and high ends is needed. But - surprise - the $v_{\mathrm{n}}^{2}$ integral weights the high end disproportionately, as you can see from Figure 8.102, where we've plotted the value $e_{\mathrm{n}}^{2} H^{2}(f)$ for white noise $\left(e_{\mathrm{n}}=1\right)$ over a 100:1 bandpass, on linear frequency and amplitude scales (because that's what integrals do for a living). The integral is the area under the curve, lazily accumulating lots of unwanted spectrum for a singlesection $R C$ at the high end, but acquiring some discipline with higher orders; by contrast, the filter order at the low end matters hardly at all. And this general behavior persists, even with a narrower 10:1 passband (Figure 8.103).

We've taken the simple case of white noise, with its uniform spectral density. But the situation is not much changed even when the noise density is rising at low frequencies (e.g., pink noise, with $e_{\mathrm{n}}^{2} \propto 1 / f$ ): the combination of a response $H^{2} \propto f^{2}$, integrated over a small frequency span at low frequency, kills off the modestly increasing noise density.

### 8.13.3 Op-amp "low-frequency noise" with asymmetric filter

Because "the high end matters most," the low-frequency noise-voltage specifications $(0.1-10 \mathrm{~Hz})$ reported on many op-amp datasheets are measured with an asymmetrical filter, often a single-section highpass at 0.1 Hz cascaded with a 2-section (or sometimes higher-order) lowpass at 10 Hz . Here are the equivalent noise bandwidths for bandpass fil-
ters that are first-order $(R C)$ highpass at $f_{1}$ and secondorder Butterworth lowpass at $f_{2}$; as before, for pink or red noise the multiplying factor is the noise density at the upper frequency limit $f_{2}$, i.e., " $e_{\mathrm{n} 2}$ " $\equiv e_{\mathrm{n}}\left(f_{2}\right)$ :

$$
\begin{align*}
& v_{\mathrm{n}}^{2}=e_{\mathrm{n}}^{2} \frac{\pi}{4} \frac{\sqrt{2} f_{1}^{2} f_{2}^{3}-2 f_{1} f_{2}^{4}+\sqrt{2} f_{2}^{5}}{f_{1}^{4}+f_{2}^{4}} \quad \text { (white), } \\
& v_{\mathrm{n}}^{2}=e_{\mathrm{n} 2}^{2} \frac{\pi f_{1}^{2} f_{2}^{3}+4 f_{2}^{5} \log _{\mathrm{e}}\left(f_{2} / f_{1}\right)}{4\left(f_{1}^{4}+f_{2}^{4}\right)} \quad \text { (pink), }  \tag{8.58}\\
& v_{\mathrm{n}}^{2}=e_{\mathrm{n} 2}^{2} \frac{\pi}{4} \frac{\sqrt{2} f_{1}^{3} f_{2}^{3}-\sqrt{2} f_{1} f_{2}^{5}+2 f_{2}^{6}}{f_{1}^{5}+f_{1} f_{2}^{4}} \text { (red). }
\end{align*}
$$

Op-amp datasheets usually specify a 0.1 Hz to 10 Hz bandwidth for their listed low-frequency noise voltage; as often as not, it is defined with an asymmetric filter. But, curiously, they tend to list a peak-to-peak value (rather than rms), taken from a 10 -second 'scope capture (similar to the bottom trace in Figure 8.4). It's common to estimate the rms noise voltage with this rule of thumb: $v_{\mathrm{n}(\mathrm{ms})} \approx v_{\mathrm{n}(\mathrm{pp})} / 6$.

#### A. Op-amp low-frequency noise voltage

Operational amplifiers (with the exception of auto-zeroing op-amps) exhibit the, by now, familiar noise-density characteristic: flat at higher frequencies (call it $e_{\mathrm{nH}}$ ), but rising approximately as $e_{\mathrm{n}} \propto 1 / \sqrt{f}$ (pink noise) for frequencies below the $1 / f$ noise corner (call that frequency $f_{\mathrm{c}}$ ). If you know $f_{\mathrm{c}}$ and $e_{\mathrm{nH}}$, you can use the expressions in Table 8.4 to estimate the integrated noise voltage over any span of bandpass $f_{1}$ to $f_{2}$.

There are three possibilities. (a) The bandpass is entirely
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0598.jpg?height=1221&width=825&top_left_y=206&top_left_x=205)

Figure 8.101. Spectral shapes of the three classic noises, and the bandpass filters used to evaluate their integrated noise voltage or current.
in the white noise region, i.e., $f_{1}>f_{\mathrm{c}}$; (b) the bandpass is entirely in the pink noise region, i.e., $f_{2}<f_{\mathrm{c}}$; or (c) the bandpass straddles the $1 / f$ corner frequency. For the first two cases, use the corresponding expression from Table 8.4 corresponding to the filter characteristic in use. For case (c), just calculate the separate white and pink $v_{\mathrm{n}}^{2}$ contributions over the full passband ( $f_{1}$ to $f_{2}$ ), and take their sum. In the idealized case of a brick-wall bandpass filter, this process gives an integrated noise voltage of

$$
\begin{equation*}
v_{\mathrm{n}}^{2}=e_{n H}^{2}\left(f_{2}-f_{1}+f_{\mathrm{c}} \log _{\mathrm{e}} \frac{f_{2}}{f_{1}}\right) \quad \mathrm{V}^{2}(\mathrm{rms}) \tag{8.59}
\end{equation*}
$$

This is what we've done to create the integrated noise curves in Figure 5.54 (in $\S 5.11 .1$ ), based on the datasheet noise densities plotted in Figure 5.37 (in §5.10.6) and Fig-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0598.jpg?height=552&width=815&top_left_y=221&top_left_x=1067)

Figure 8.102. Power spectrum of filtered white noise, for 0.1 10 Hz Butterworth bandpass filters of the indicated orders (at their "low,high" ends; thus a "1,2" bandpass filter consists of a first-order highpass $R C$ at $f_{1}$ cascaded with a second-order Butterworth lowpass at $f_{2}$ ).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0598.jpg?height=535&width=812&top_left_y=1054&top_left_x=1071)

Figure 8.103. Power spectrum of filtered white noise, for $1 \mathrm{kHz}-$ 10 kHz Butterworth bandpass filters of the indicated orders ("low,high" ends).
ure 8.63 (from the data plotted in Figures 8.60 and 8.61). ${ }^{129}$ Figure 8.104 shows an example, using the AD8671's datasheet $e_{\mathrm{n}}$ curve $(1 / f$ corner at 5 Hz ) to find the integrated-noise voltage $v_{\mathrm{n}}$ as a function of upper cutoff frequency (it's necessary to choose a nonzero lowfrequency limit $f_{1}$ to prevent divergence).

[^444]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0599.jpg?height=519&width=802&top_left_y=210&top_left_x=122)

Figure 8.104. This op-amp's voltage noise density $e_{\mathrm{n}}$ has its $1 / f$ corner frequency $f_{\mathrm{c}}$ at 5 Hz . Integrating the noise power ( $\sim e_{\mathrm{n}}^{2}$ ) from a low frequency $f_{1}$ up to a cutoff frequency $f_{2}=f$ gives the squared integrated noise voltage $v_{\mathrm{n}}^{2}$, from which these curves of $v_{\mathrm{n}}$ result. If $f_{1}$ were set to zero, the $v_{\mathrm{n}}$ integral would diverge.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0599.jpg?height=444&width=613&top_left_y=1000&top_left_x=219)

Figure 8.105. For the textbook noise density ( $1 / f$ at low frequencies, flat at high frequencies) you can get the corner frequency from the $e_{\mathrm{n}}$ values at two points.

### 8.13.4 Finding the $1 / f$ corner frequency

If you're looking at a plot of noise density versus frequency, you can try to "eyeball" the $1 / f$ corner frequency $f_{\mathrm{c}}$. But it's nice to be able to find $f_{\mathrm{c}}$ from a pair of tabulated values when there's no graph available (often $e_{\mathrm{n}}$ is specified at 10 Hz and at 1 kHz in a datasheet's tabulated data); and anyway some folks are impressed by an equation or two in a not-inexpensive book like this one. You can figure it out, guided by Figure 8.105; the result is

$$
\begin{equation*}
f_{\mathrm{c}}=\frac{e_{\mathrm{nL}}^{2}-e_{\mathrm{nH}}^{2}}{e_{\mathrm{nH}}^{2}} f_{\mathrm{L}}=\left(\frac{e_{\mathrm{nL}}^{2}}{e_{\mathrm{nH}}^{2}}-1\right) f_{\mathrm{L}} \quad \mathrm{~Hz}, \tag{8.60}
\end{equation*}
$$

where $e_{\mathrm{nL}}$ is the noise density at some frequency $f_{\mathrm{L}}$ that is below the corner frequency, and $e_{\mathrm{nH}}$ is the noise density well above $f_{\mathrm{c}}$.

#### A. Noise voltage over the decades

A white-noise source (i.e., $e_{\mathrm{n}}$ constant), filtered to a bandwidth $B$ (for example with a brick-wall bandpass $f_{2}-f_{1}=B$ ), has integrated noise voltage $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{B}$. So, looking at successive decades of bandpass $(0.1-1 \mathrm{~Hz}, 1-$ $10 \mathrm{~Hz}, 10-100 \mathrm{~Hz}$, etc.), we expect to see the noise voltage increasing by factors of $\sqrt{10}$; and that's why, of course, "the high end matters most." The situation for pink noise is different: the $1 / f$ dependence of $e_{\mathrm{n}}^{2}$ compensates for the increasing bandwidths, yielding a constant noise voltage, as you can verify by looking at the expression for brick-wallfiltered pink noise on page 564. These dependencies are illustrated nicely in the integrated noise plots of Figure 5.54 and Figures 8.62 and 8.63 , where the low-frequency $1 / f$ characteristic of conventional op-amps causes their integrated noise voltage to flatten at the low-frequency end; by contrast, auto-zero op-amps exhibit constant $e_{\mathrm{n}}$ at low frequencies, so their integrated noise voltage continues to decrease by $10 \mathrm{~dB} /$ decade as the bandwidth is reduced.

Do bench measurements confirm this behavior? Look at the 'scope traces in Figure 8.106, which are singleshot waveforms of band-limited input noise current in an LT1012 BJT op-amp. The noise-current amplitude decreases about 10 dB from the top decade to the next decade down, but it appears to level off and then increase again at the lowest decade. That suggests a current noise density $i_{\mathrm{n}}$ that rises faster than the $1 / \sqrt{f}$ of pink noise; and indeed the measured current noise spectrum of the LT1012, shown in Figure 8.111, is "steeper than pink." In contrast, an opamp whose low-frequency noise conforms to an ideal pinknoise spectrum would exhibit approximately constant noise amplitude per decade of bandwidth, once well below the $1 / f$ corner frequency.

#### B. Forever 1/f ?

You often hear talk about low-frequency noise power conforming to a " $1 / f$ law," as if there's some statutory requirement involved. You might at first think that this cannot possibly be true, because (you say to yourself) a $1 / f$ power spectrum cannot continue forever, since it would imply unlimited noise amplitude. If you waited long enough, the input offset voltage (or input current, in this case) would become unbounded. In fact, the popular mythology of a lowfrequency noise catastrophe (to which your thinking would have fallen victim) is quite without merit: even if the noise power density continues as $1 / f$ all the way down to zero frequency, its total noise power (i.e., the integral of noise power density) diverges only logarithmically, given that $\int f^{-1} d f=\log _{\mathrm{e}} f$. To put some numbers to it, the total noise power in a pure $1 / f$ spectrum between 1 microhertz and
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0600.jpg?height=682&width=807&top_left_y=220&top_left_x=216)

Figure 8.106. LT1012 noise current versus time, for successive decade bandpasses. Vertical: 5 pA/div. Horizontal: scaled to bandpass, as indicated.

10 Hz is only 3.5 times greater than that between 0.1 Hz and 10 Hz ; going down another six decades (to $10^{-12} \mathrm{~Hz}$ ), the corresponding ratio grows only to 6.5 . Put another way, the $1 / f$ total noise power, going all the way down to a frequency that is the reciprocal of 32,000 years (when Neanderthals still roamed the planet, and there were no op-amps), is just six times greater than that of the usual datasheet $0.1-10 \mathrm{~Hz}$ "low-frequency noise." So much for catastrophes.

To find out whether the low-frequency noise of real opamps continues to conform to a $1 / f$ spectrum, we measured the current noise spectrum of an LT1012 op-amp all the way down to 0.5 millihertz, ${ }^{130}$ with the result of Figure 8.107. As we remarked above, this op-amp is unusual in that its current noise density $i_{\mathrm{n}}$ rises faster than the usual $1 / \sqrt{f}$ (pink noise) for a decade around 1 Hz ; but even so it settles back to the canonical pink noise, and ultimately becomes something closer to "pale white" ( $f^{-1 / 4}$ or slower).

You could conclude that this demonstrates the unphysical nature of $1 / f$ behavior all the way down to zero. But there's another possible explanation, namely that this opamp is afflicted with some mild burst noise. That would be consistent with the "faster-than-pink" slope around 1 Hz (recall the burst-noise spectrum in Figure 8.6), and it would also lead you to incorrectly attribute a "slower-than-pink"

[^445]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0600.jpg?height=552&width=794&top_left_y=221&top_left_x=1067)

Figure 8.107. Measured LT1012 noise current spectrum, extending down to 500 microhertz. Several slopes are shown, for your amusement.
slope at the low frequency end of the spectrum in Figure 8.107.

If this latter explanation is correct, measurements at even lower frequencies (to 0.00001 Hz , say) would confirm a continuing $1 / f$ (pink) slope. But it takes a full day to reach $10 \mu \mathrm{~Hz}$, which is why reliable long timescale data are hard to find. An interesting datapoint is provided by Daire's measurement of the "Spectral Noise Distribution" of a Keithley 6430 high sensitivity ( 0.05 fA resolution) source-measure instrument, ${ }^{131}$ which displays a $1 / f$ character all the way down to a microhertz (corresponding to a time scale of several weeks). With this in mind, it is quite possible that the low-frequency flattening seen in Figure 8.107 is indeed an artifact of a burst-noise plateau. Or maybe not - there's no statutory requirement that extremely-low-frequency noise must obey a $1 / f$ (pinknoise) spectrum.

### 8.13.5 Measuring the noise voltage

There is a class of test instruments, called spectrum analyzers or dynamic signal analyzers, that measure and display the frequency spectrum of an input signal. One style is optimized for low-frequency and audio use, generally up to $\sim 100 \mathrm{kHz}$ or so, with spectral calculations done with a discrete Fourier transform; examples are the Stanford Research Systems SR780/5 and the Agilent U8903A. At the other end you find RF and microwave spectrum analyzers whose upper frequency limits range from $\sim 3 \mathrm{GHz}$

[^446]to upward of 50 GHz ; these use an internal swept oscillator and mixer scheme (often augmented with a digital Fourier transform backend) to map out the spectrum sequentially. A popular configuration accommodates the frequency range from 9 kHz to 3 GHz , often with an internal "tracking generator" that lets you sweep the responses of filters or amplifiers; examples are the Agilent E4403 and the Rohde \& Schwarz FSL3.

These instruments are quite flexible, with a wide range of input gain settings, frequency spans, display scaling, and so on. The low-frequency instruments have $1 \mathrm{M} \Omega$ input impedance, convenient for circuit measurements (e.g., opamp or voltage-reference noise spectra), whereas the RF analyzers present the standard $50 \Omega$ (or $75 \Omega$, for video applications) input impedance. To measure an op-amp noise spectrum, for example, just use the circuit of Figure 8.108, with $R_{\mathrm{S}}=0$; you'll get a spectrum like the lower curve in Figure 8.109. Voltage-noise spectra for some op-amps thus measured are shown in Figure 8.110.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0601.jpg?height=521&width=749&top_left_y=997&top_left_x=136)

Figure 8.108. Measuring op-amp noise voltage and current spectra. For $e_{\mathrm{n}}$, set $R_{\mathrm{S}}=0$; for $i_{\mathrm{n}}$, choose $R_{\mathrm{S}}$ substantially larger than the amplifier's noise resistance ( $R_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$ ). Use a shielded box with filtered dc feedthroughs.

The most accurate way to make integrated output noise voltage measurements is to use a true rms voltmeter. These operate either by measuring the heating produced by the signal waveform (suitably amplified) or by using an analog squaring circuit followed by averaging. If you use a true rms meter, make sure it has response at the frequencies you are measuring; some of them go up to only a few kilohertz. True rms meters also specify a "crest factor," the ratio of peak voltage to rms that they can handle without great loss of accuracy. For Gaussian noise, a crest factor of 3 to 5 is adequate.

You can use a simple averaging-type ac voltmeter instead, if a true rms meter is unavailable. In that case, the values read off the scale must be corrected. As it turns out,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0601.jpg?height=716&width=779&top_left_y=221&top_left_x=978)

Figure 8.109. Voltage and current noise spectra of an OPA277 opamp, measured with the circuit of Figure 8.108. The Johnson noise of the $1 \mathrm{M} \Omega$ resistor $R_{\mathrm{S}}$ used for the $i_{\mathrm{n}}$ measurements sets a "noise floor," here seen to be well below the op-amp's measured $i_{\mathrm{n}}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0601.jpg?height=534&width=799&top_left_y=1167&top_left_x=973)

Figure 8.110. Measured voltage-noise-density spectra of a selection of op-amps. The boldface parts are auto-zero amplifiers, which circumvent the $1 / f$ "flicker-noise" demon by repetitive offset correction; the italic OPA627 is a JFET-input op-amp. See also Figures 8.60 and 8.61.
all averaging meters (VOMs, DMMs, etc.) already have their scales adjusted, so what you read isn't actually the $a v$ erage, but rather the rms voltage assuming a sine-wave signal. For example, if you measure the powerline voltage in the United States, your meter will read something close to 117 V . That's fine, but if the signal you're reading is Gaussian noise, you have to apply an additional correction. The rule is as follows: to get the rms voltage of Gaussian noise,
multiply the "rms" value you read on an averaging ac voltmeter by 1.13 (or add 1 dB ). Warning: this works fine if the signal you are measuring is pure noise (e.g., the output of an amplifier with a resistor or noise source as input), but it won't give accurate results if the signal consists of a sinewave added to noise.

A third method, not exactly world famous for its accuracy, consists of looking at the noise waveform on an oscilloscope: the rms voltage is $1 / 6$ to $1 / 8$ of the peak-topeak value (depending on your subjective reading of the pp amplitude). It isn't very accurate, but at least there's no problem getting enough measurement bandwidth.

### 8.13.6 Measuring the noise current

An easy way to measure input noise current in an op-amp is to use the circuit of Figure 8.108, with a large input resistor $R_{\mathrm{S}}$. Its value has to be large enough so that the noise voltage generated across it by the op-amp's input noise current is at least comparable to (and preferably much larger than) the op-amp's noise voltage: $i_{\mathrm{n}} R_{\mathrm{s}} \gtrsim e_{\mathrm{n}}$. Another way to put it is to say that $R_{\mathrm{S}} \gtrsim R_{\mathrm{n}}$, the op-amp's noise resistance.

We're not done yet. It's also necessary that $i_{\mathrm{n}} R_{\mathrm{s}}$ dominates over the resistor's Johnson-noise voltage density: $i_{\mathrm{n}} R_{\mathrm{s}} \gtrsim \sqrt{4 k T R_{\mathrm{s}}}$. That is, $R_{\mathrm{s}}$ looks like a current noise source of $i_{\mathrm{n}}=\sqrt{4 k T / R_{\mathrm{s}}}$, so you have to choose a largeenough value so that the op-amp's input current noise dominates. We find it easiest to remember Johnson noise voltage and current values for a round-number resistance, and then scale it according to the square root of $R$. So, take note: the Johnson noise of a $1 \mathrm{M} \Omega$ resistor is $e_{\mathrm{n}}=127 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ (open-circuit), scaling as $\sqrt{R}$; and $i_{\mathrm{n}}=127 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (shortcircuit), scaling as $1 / \sqrt{R}$.

Figure 8.111 shows input current noise spectra for a selection of op-amps (most of which have BJT inputs with bias-current cancellation), measured with the circuit of Figure 8.108 with $R_{\mathrm{s}}=100 \mathrm{M} \Omega$ (for which the resistor's Johnson-noise voltage is equivalent to a current-noise density of $12.7 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ ), and was so measured with an OPA627 JFET-input op-amp (whose voltage- and currentnoise contributions are negligible by comparison). The two auto-zero (chopper-stabilized) parts exhibit a flat lowfrequency noise spectrum, in contrast to the usual "pink" $1 / f$ rising noise power density of conventional op-amps. But auto-zeros usually have nasty spectral peaks at higher frequencies, caused by the clocked switching at the input (those for the AD8628A are around 15 kHz , off the righthand end of the graph; but Figure 5.52 shows them handsomely, for the MCP6V06).

|  | Auto-zero Noise <br> Noise Voltage |  |  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0602.jpg?height=252&width=75&top_left_y=224&top_left_x=1512) | Noise Current |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | $\begin{aligned} & \operatorname{spec}^{\mathrm{t}} \\ & \left(\frac{\mathrm{nV}}{\sqrt{\mathrm{~Hz}}}\right) \end{aligned}$ | $\begin{gathered} \hline e_{\mathrm{n}} \\ \text { meas } \\ \left(\frac{\mathrm{nV}}{\sqrt{ } \mathrm{~Hz}}\right) \end{gathered}$ | meas <br> peak <br> ampl <br> $(\mu \mathrm{V})$ |  | $\begin{aligned} & \frac{i n}{\text { spec }^{\dagger}} \\ & \left(\frac{\mathrm{fA}}{\sqrt{H z}}\right) \end{aligned}$ | $\begin{aligned} & \text { in } \\ & \hline \end{aligned}$ | meas <br> peak <br> ampl <br> (pA) |
| AD8551 | 42 | 46 | 5 | 5.2 | 2 | 21 | 20 |
| AD8572 | 51 | 55 | a | a | 2 | 16 | a |
| AD8628 | 22 | 22 | 8 | 15 | 5 | 53 | 100 |
| LMP2021 | 11 | 18 | 8 | 25 | 350 | 120 | 400 |
| LTC1049 | 100 | 90 | 150 | 2.0 | 2 | 100 | 200 |
| LTC1050 | 90 | 70 | 80 | 3.8 | 1.8 | 130 | 8000 |
| LTC1150 | 90 | 92 | 2 | 0.6 | 1.8 | 70 | $15000^{\text {s}}$ |
| MAX4239 | 30 | 28 | 20 | 18 | - | 24 | b |
| MAX9617 | 42 | 42 | 20 | 60 | 100 | 74 | 50 |
| MCP6V06 | 82 | 80 | 40 | 8.9 | 0.6 | 38 | 800 |
| OPA335 | 55 | 52 | 5 | 11 | 20 | 12 | 50 |
| OPA734 | 135 | 120 | 5 | 18 | 40 | 27 | 8000 ${ }^{\text {s }}$ |
| OPA2188 | 8.8 | 8.5 | - | - | 7 | 750 | - |
| TLC4501A ${ }^{\text {C }}$ | 70/12 ${ }^{\text {e }}$ | 60/11 ${ }^{e}$ | 1/2/5 $5^{f}$ | - | 0.6 | $0.6^{9}$ | - |
| MAX4236Ad | 23/14 ${ }^{\text {e }}$ | 24/16 ${ }^{\text {e }}$ | $1 / 3 / 8^{f}$ | - | - | 0.459 | - |

Notes: (a) broad spectrum, slight rise at 2.2 kHz and harmonics. (b) output noise dominated by $V_{\mathrm{n}}$, unable to measure In separately. (c) auto-zero at power-up, no corrections thereafter. (d) precision conventional CMOS op-amp, for comparison. (e) at $10 \mathrm{~Hz} / 1 \mathrm{kHz}$. (f) no spectral features; peak amplitudes for bandwidths to $1 \mathrm{kHz} / 10 \mathrm{kHz} / 100 \mathrm{kHz}$. (g) at 1 Hz . (s) spikey waveform, value listed is the peak amplitude. (t) typical.

A caution: datasheet values for input current noise are sometimes seriously in error, evidently because the manufacturer did not measure it, believing that it was accurately predicted by a shot noise calculation based on dc input current. We were curious, and measured the input noise of a dozen auto-zero op-amps, with the results in Table 8.5 on the current page. And how interesting! The datasheet values for voltage noise were correct; but for some of the parts, the specified current noise values were far too optimistic, sometimes by as much as a factor of fifty. Interestingly, some datasheets even admit what they've done; for example, the $i_{\mathrm{n}}$ entry for each of the three LTC parts is accompanied by a footnote saying "Current noise is calculated from the formula $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{B}}}$, where $q=1.6 \cdot 10^{-19}$ coulombs." This same error afflicts some BJTinput op-amps, in particular those with input bias cancellation, where the (incorrect) current noise in the datasheet evidently was calculated from the shot noise corresponding to the net (i.e., cancelled) input current, rather than from the much larger uncancelled input current. See $\S \S 4$ x. 10 and 5.10 .8 for details.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0603.jpg?height=802&width=1200&top_left_y=219&top_left_x=349)

Figure 8.111. Measured current noise density spectra for most of the op-amps of Figure 8.110. The boldface parts are auto-zero amplifiers, which circumvent the $1 / f$ "flicker-noise" demon by repetitive offset correction, but exhibit switching-induced clock noise at higher frequencies (see the expanded plot in Figure 5.52). See also Figures 8.60 and 8.61.

#### A. Some limitations: bandwidth, stability, dc offset

This simple $i_{\mathrm{n}}$ measurement scheme - letting the device under test amplify its own input current noise, as a voltage developed across a large input resistor - has some drawbacks, which seriously limit the ability to measure noise currents down in the low $\mathrm{fA} / \sqrt{\mathrm{Hz}}$ range. As just discussed, you've got to use sufficiently large values of $R_{\mathrm{S}}$ to overcome both the amplifier's $e_{\mathrm{n}}$ and the resistor's Johnson noise. For a noise current of $1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, for example, that requires $R_{\mathrm{s}}$ at least $10 \mathrm{G} \Omega$ (equivalent $i_{\mathrm{n}}$ contribution is $1.3 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ ). But now you've got to worry about the dc voltage produced by the input bias current: a current of 10 pA , for example, causes 100 mV of dc input, thus saturation at the output after $G=100$. You've also got to worry about instability, because it doesn't take much feedback capacitance from the output pin to the noninverting input to make the amplifier into an oscillator. That can be tamed by a small shunt capacitor to ground, but the added capacitance reduces the (already small) bandwidth: with our $R_{\mathrm{s}}=10 \mathrm{G} \Omega$, for example, a mere 1 pF of input capacitance limits the measurement bandwidth to 16 Hz ! And in our measurements we needed additional shunt capacitance to prevent low-frequency oscillation in our (socketed) test jig.

#### B. Improved bandwidth with a current amplifier

The lesson here is that it's not easy to make measurements of low-level input current noise in good amplifiers. You can do better, though, by using a carefully designed external current amplifier (which presents a low impedance input, i.e., a virtual ground) connected directly to the noninverting input of the device under test, as in Figure 8.112. For example, the DL Instruments ${ }^{132}$ Model 1211 "current preamplifier" has a specified input current noise of $1.5 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (corresponding to a $10 \mathrm{G} \Omega$ feedback resistor to its input summing junction) and a bandwidth of 400 Hz ; it is an "electrometer" configuration (dc negative feedback to an input summing junction), so it holds its input within 0.2 mV of ground at full-scale input current. Some other suppliers of low-noise-current amplifiers and current-measuring instruments are Laser Components (for example their Model DDPCA-300, with switchable gains from $10^{4} \mathrm{~V} / \mathrm{A}$ up to $10^{13} \mathrm{~V} / \mathrm{A}$, and with noise as low as $0.2 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ in the most sensitive ranges), and Keithley (for example their Model 428, with switchable gains from $10^{3}$ V/A up to $\left.10^{11} \mathrm{~V} / \mathrm{A}\right)$.

[^447]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0604.jpg?height=848&width=1136&top_left_y=214&top_left_x=478)

Figure 8.112. Measuring op-amp current noise with a sensitive external current amplifier.

### 8.13.7 Another way: roll-your-own fA $/ \sqrt{\mathrm{Hz}}$ instrument

Commercial high-performance current amplifiers can cost quite a bundle - you're talking numbers like $30-40 \mathrm{~dB} \$$. It's nice to have such a general-purpose bench instrument on hand, of course. But if all you want is to measure lowlevel op-amp input-current noise, and you're willing to make a special-purpose test jig, you can wire up something like the circuit in Figure 8.113. With the values shown you can measure noise currents down to $0.1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ (or less, with a larger $R_{\mathrm{S}}$ ), with a component cost of just a few dollars.

This circuit takes an unusual approach, and is worth a bit of discussion. Our first idea was to eliminate entirely the noise-producing feedback resistor: recall that a resistor of value $R$ has a Johnson noise-voltage density $e_{\mathrm{n}}=\sqrt{4 k T R}$, thus an equivalent noise-current density $i_{\mathrm{n}}=\sqrt{4 k T / R}$; so, for example, to keep that $i_{n}$ contribution less than $1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ requires an $R_{\mathrm{f}}$ greater than $16,000 \mathrm{M} \Omega$ (with consequent problems of bandwidth, offset, and stability). So here we use instead a feedback capacitor! ${ }^{133}$ This makes an integrator, here implemented as a composite amplifier in
133 This isn't as nutty as it sounds. In fact, it is the method of choice ("correlated double-sampling") used in certain low-noise applications, for example photodiode or CCD imager readout amplifiers, where the thermal noise produced by a conventional feedback resistor is un-
which the device-under-test (DUT) (configured as a follower) drives an inverting op-amp stage whose unity-gain bandwidth is limited (by $C_{\text {comp }}$, in combination with $R_{1}$ ) to $\sim 16 \mathrm{kHz}$. We don't need any more bandwidth, and this overcompensation ensures stability.

Ignoring for the moment the DUT's dc input leakage current, this integrator converts input current noise to output voltage noise according to $v_{\mathrm{n}}=i_{\mathrm{n}} / \omega C_{\mathrm{f}}$. So, for example, a flat (white) $i_{\mathrm{n}}$ spectrum produces a $v_{\mathrm{n}}$ whose spectral amplitude falls as $1 / f$, or, equivalently, its noise power density falls as $1 / f^{2}$ (red noise). Of course, there's also voltage noise $e_{\mathrm{n}}$ in both op-amps, which gets added to $v_{\mathrm{n}}$ (in the usual square root of sum of squares manner of uncorrelated noise); by choosing a smaller value for $C_{\mathrm{f}}$ we can reduce the effect of the $e_{\mathrm{n}}$ 's, because smaller values of $C_{\mathrm{f}}$ produce larger current-to-voltage "gain." (Another way to put it is that the effective current noise produced by the input noise voltage $e_{\mathrm{n}}$ is $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{f}}$. Equivalently, the current-noise measurements extend only up to a frequency $\omega=i_{\mathrm{n}} / e_{\mathrm{n}} C_{\mathrm{f}}$,
acceptable. (An engineer would say that a capacitor has no Johnson noise; a physicist would say that a capacitor may have $k T$ worth of thermal energy on average, but, being uncoupled from the thermal bath, that energy does not fluctuate.) This technique may have been originated by Garwin, who used it in the 1950s for high-energy physics instrumentation, and then in 1969 for image detector readout (where Garwin instructed "read twice to cancel $k T$ ").
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0605.jpg?height=687&width=800&top_left_y=218&top_left_x=549)

Figure 8.113. Measuring $i_{n}$ down to $0.1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, with bandwidths out to $\sim 1 \mathrm{kHz}$, using a composite integrator. The suppression resistor $R_{\mathrm{S}}$ (made by Welwyn) has an integral metallic guard band, used to intercept leakage currents on the outside of its glass envelope (hey, this is a really high-value resistor: $1 \mathrm{~T} \Omega$ is a million megohms!); the 7 pF value for $C_{\mathrm{f}}$ includes wiring and switch capacitances. The reset switch presented educational challenges (see text).
above which the amplifier's voltage noise dominates.) For this circuit we chose the LT1677 for $U_{2}$, because it combines pretty low voltage noise ( $3.2 \mathrm{nV} / \sqrt{\mathrm{Hz}})$ with low bias current, wide operating voltage range ( $\pm 1.5 \mathrm{~V}$ to $\pm 20 \mathrm{~V}$ ), and rail-to-rail output.

Figure 8.114 shows a screen capture of the voltagenoise spectrum of the circuit of Figure 8.113, when an LTC1049 auto-zero op-amp is plugged into the DUT
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0605.jpg?height=547&width=784&top_left_y=1533&top_left_x=128)

Figure 8.114. Measured voltage-noise density $v_{\mathrm{n}}$ from the circuit of Figure 8.113, for an LTC1049 auto-zero op-amp. The $1 / f$ amplitude spectrum of the integrator's output $\left(v_{\mathrm{n}}\right)$ corresponds to a flat input current noise spectrum over this range of frequencies, with a value $i_{\mathrm{n}}=100 \mathrm{fA} / \sqrt{\mathrm{Hz}}$.
socket. It conforms accurately to $1 / f$, evaluating to $i_{\mathrm{n}}=100 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ over this frequency range, agreeing with the $i_{\mathrm{n}}$ measurement we made using the circuit of Figure 8.108 (and reported in Table 8.5 on page 569). There's no hint of a leveling off at the high frequency end, consistent with a predicted measurement bandwidth of $\sim 10 \mathrm{kHz}$ for the $i_{\mathrm{n}}$ and $e_{\mathrm{n}}$ of this op-amp.

Having calibrated the technique (and having confirmed the calibration by measuring also the AD8628 auto-zero op-amp), we used it to measure the tough cases - the conventional op-amps listed in Table 8.5, with current-noise values down in the $\sim 1 \mathrm{fA} / \sqrt{\mathrm{Hz}}$ territory - with the results listed. For those measurements the bandwidth extends only to $\sim 1 \mathrm{kHz}$, above which the op-amp's voltage noise $e_{\mathrm{n}}$, in combination with the input capacitances to ground (both within the op-amp, and externally as wiring, etc.), creates an " $e_{\mathrm{n}} C$ " equivalent input current noise (more precisely, $e_{\mathrm{n}} \omega C_{\text {in }}$ ) that dominates the small current noise of the amplifier itself.

We also measured an LMC6081, which should have even lower current noise, given its specified typical input current $I_{\mathrm{b}}$ of 10 fA ; for this op-amp the measured $v_{\mathrm{n}}$ corresponds to an $i_{\mathrm{n}}$ of $0.15 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. That sounds pretty good - but the expected current noise, calculated as $I_{\mathrm{B}}$ shot noise, should be quite a bit lower, about $0.06 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. So now we have to confess that the resistorless purity of this measurement technique has been compromised by the
"current-suppression" resistor $R_{\mathrm{S}}$, needed to cancel the dc input current. We used a very large value ( $1 \mathrm{~T} \Omega$, that's $10^{6}$ megohms!) to reduce the added noise current, which here amounts to $i_{\mathrm{n}}=\sqrt{4 k T / R_{\mathrm{s}}}=0.13 \mathrm{fA} / \sqrt{\mathrm{Hz}}$. So for this opamp what we've actually measured is the noise introduced by the bias-suppression resistor! We could do better, say with a $100 \mathrm{~T} \Omega$ resistor (you can get these things, for example the 3810 -series from Welwyn), which would push the added noise down by a factor of ten. We could do better, that is, if you really believe that you can keep all other insulation resistances (moisture, fingerprints, etc.) that high; a tall order. ${ }^{134}$

#### A. An amusing complication: the reset switch

Here's a little story about reality, and some considerable confusion on the way to ultimate enlightenment. Right "out of the box" this circuit worked nearly perfectly. But there was one curious complication: when the integrator RESET switch was pressed, the output went obediently to zero; but when the switch was released, the output took a large jump - typically to a value in the range of +1.5 V to +2 V . What could cause that? Most likely, some sort of electrostatic charging caused by the movement of the plastic parts, in a pushbutton switch series of which we've grown quite fond (Panasonic EVQ2130x-EVQ2150x series, which are compact, inexpensive, pleasantly tactile, and nearly free of annoying contact "bounce").

We pondered this, and decided to substitute a magnetically operated reed switch - a small sealed tubular glass envelope containing a pair of contacts, with a wire sticking out each end, and which is actuated by bringing a small permanent magnet in proximity (these things are widely used, most familiarly for door and window switches in home alarm systems). The reed switch has good properties: when OFF its capacitance is $\sim 0.3 \mathrm{pF}$ and its resistance is greater than $10^{12} \Omega$. And, with the switch inside the shielded aluminum box and the magnet outside, there would be no opportunity for accumulation of static charge. Better still, with no dc-actuated coil (as in a conventional relay, or a

[^448]reed relay) there would be no magnetic or electric coupling to the sensitive circuit.

This worked considerably better. But still not as expected: imagine our surprise when the output took a -50 mV step when the switch was opened. What could be causing that? We guessed at first that it might be due to a flux rearrangement when the (magnetic) contacts opened, injecting a pulse of charge equal to the change in flux that was linked by the circuit wiring. Easy to check: just move the switch in close proximity to the op-amp, reducing greatly the circuit's enclosed area. We did that, and, encouragingly, the output jump changed sign (now a positive jump, of about the same magnitude). OK, we thought, move the switch halfway back to where it was and the effect should go to zero. It didn't: still +50 mV .

This was really weird! On an inspiration we guessed that we might have reversed the ends when we made the first change, so we flipped the switch over and - aha! - the jump reversed sign (back to -50 mV ).

So the reed switch seemed to have an asymmetry, and a memory of its own, such that it injected some charge (not much: $Q=C_{\mathrm{f}} \Delta V=0.35 \mathrm{pC}$ ) when opened. What could be causing that? We spoke with some wise colleagues, who suggested we think about the difference of "work function" between the two contacts in the switch (which might plausibly be chosen of different metals, to prevent coldweld sticking), and who mumbled terms like "Fermi levels," "contact potential difference," and the "Kelvin probe" technique for measuring the latter.

OK, so we tried a reed switch of different design, and also one from a different manufacturer (for the original Hamlin MDRR-4 we substituted first a Hamlin MDSR-10, then a Coto RI-01BAA), both of which exhibited the same curious effect, though with different amplitudes ( 15 mV and 100 mV , respectively).

Time to call for help! The Hamlin datasheet proclaims hospitably "For details on electrical specifications, contact Hamlin." So we did. We learned that the contact pairs are identical, in fact they just make a zillion of them, all the same, and take any two for each switch. There goes all that Fermi-level theory!

Finally we figured it out. ${ }^{135}$ Glass is a darned good insulator, and it's easy to deposit charge onto the reed switch's glass envelope just by handling it (removing it from its plastic bag, etc.). There's a fancy name for this: it's called the triboelectric effect. A simpler name is static electricity. Glass is one of the classic materials, and in courses on

[^449]electricity you see demonstrations of glass rods being rubbed with cat's fur. ${ }^{136}$ With some charge stuck on the glass, the electric field that it produced caused the electrodes of the reed switch to acquire a small amount of opposing charge when separated.

Here's what we did to confirm this conjecture: we took an inch of woven metal cloth, ${ }^{137}$ grounded one end with a clip lead, wrapped it around the reed switch, and slid it along the length several times, to provide an opportunity for any static charge on the glass surface to take a hike. And it did: after one treatment the output-voltage step was reduced to a negligible $\sim 2 \mathrm{mV}$.

The moral: sensitive measurements (here we're talking femtoamps and picofarads) can reveal effects that are so small that you've never thought about them. They can seriously disrupt your work...but there's a redeeming delight in discovering them for yourself. And then eliminating them.

### 8.13.8 Noise potpourri

Herewith a collection of interesting, and possibly useful, facts.

1. The averaging time required in an indicating device to reduce the fluctuations of a rectified noise signal to a desired level for a given noise bandwidth is

$$
\begin{equation*}
\tau \approx \frac{1600}{B \sigma^{2}} \text { seconds, } \tag{8.61}
\end{equation*}
$$

where $\tau$ is the required time constant of the indicating device to produce fluctuations of standard deviation $\sigma$ percent at the output of a linear detector whose input is noise of bandwidth $B$.
2. For band-limited white noise, the expected number of maxima per second is

$$
\begin{equation*}
N=\sqrt{\frac{3\left(f_{2}^{5}-f_{1}^{5}\right)}{5\left(f_{2}^{3}-f_{1}^{3}\right)}} \tag{8.62}
\end{equation*}
$$

where $f_{1}$ and $f_{2}$ are the lower and upper band limits. For $f_{1}=0, N=0.77 f_{2}$; for narrowband noise $\left(f_{1} \approx f_{2}\right)$, $N \approx\left(f_{1}+f_{2}\right) / 2$.
3. rms-to-average (i.e., average magnitude) ratios:

Gaussian noise: $\quad \mathrm{rms} / \mathrm{avg}=\sqrt{\pi / 2}=1.25=1.96 \mathrm{~dB}$, sinewave: $\quad \mathrm{rms} / \mathrm{avg}=\pi / 2^{\frac{3}{2}}=1.11=0.91 \mathrm{~dB}$,

[^450]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0607.jpg?height=619&width=805&top_left_y=221&top_left_x=970)

Figure 8.115. Relative occurrence of amplitudes in Gaussian noise. Potentially useful for estimating false trigger rates, required "crest factor" in rms measurements, and the like.
square wave: $\quad \mathrm{rms} / \mathrm{avg}=1=0 \mathrm{~dB}$.
4. Relative occurrence of amplitudes in Gaussian noise. Figure 8.115 plots the fractional time that a given amplitude level is exceeded by a Gaussian noise waveform of unit rms amplitude.
5. Positive-threshold crossing rate of lowpass-filtered Gaussian white noise of unit rms amplitude is

$$
\begin{equation*}
\mathrm{TCR}=\frac{\mathrm{BW}}{\sqrt{3}} \exp \left(-V_{\mathrm{th}}^{2} / 2\right) \text { crossings/second } \tag{8.63}
\end{equation*}
$$

where $V_{\text {th }}$ is the positive threshold voltage and BW is the brick-wall lowpass bandwidth. ${ }^{138}$
6. Standard deviation of noise resulting from quantization error is

$$
\begin{equation*}
\sigma_{n}=\frac{\mathrm{LSB}}{\sqrt{12}} \approx 0.3 \mathrm{LSB} \tag{8.64}
\end{equation*}
$$

## 8.14 Signal-to-noise improvement by bandwidth narrowing

As luck would have it, the signals you often want to measure are buried in noise (where the "noise" may include other signals nearby in frequency, i.e., interference), frequently to the extent that you can't even see them on an

[^451]oscilloscope. Even when external noise isn't a problem, the statistics of the signal itself may make detection difficult, as, for example, when counting nuclear disintegrations from a weak source, with only a few counts detected per minute. Finally, even when the signal is detectable, you may wish to improve the detected signal strength in order to make a more accurate measurement. In all these cases some tricks are needed to improve the signal-to-noise ratio. They all amount to a narrowing of the detection bandwidth in order to preserve the desired signal while reducing the total amount of (broadband) noise accepted.

The first thing you might be tempted to try when thinking of reducing the bandwidth of a measurement is to hang a simple lowpass filter on the output, in order to average out the noise. There are cases where that therapy will work, but most of the time it will do very little good, for a couple of reasons. First, the signal itself may have some high frequencies in it, or it may be centered at some high frequency. Second, even if the signal is in fact slowly varying or static, you invariably have to contend with the reality that the density of noise power usually has a $1 / f$ character, so as you squeeze the bandwidth down toward dc you gain very little. Electronic and physical systems are twitchy, so to speak.

In practice, there are a few basic techniques of bandwidth narrowing that are in widespread use. They go under names like signal averaging, transient averaging, boxcar integration, multichannel scaling, pulse-height analysis, lock-in detection, and phase-sensitive detection. All of these methods assume that you have a repetitive ${ }^{139}$ signal; that's no real problem, since there is almost always a way to force the signal to be periodic, assuming it isn't already. Here we discuss an important one of these techniques, known as "lock-in" or "synchronous" detection.

### 8.14.1 Lock-in detection

This is a method of considerable subtlety. It consists of two steps. (1) Some parameter of the source signal is modulated; for example, an LED might be driven with a square wave at a fixed frequency. (2) The detected (and noisy) signal is demodulated, for example by multiplying it by a fixed-amplitude reference signal at the same modulating frequency. The modulation moves the source signal spectrum up to the modulating frequency, above noisy $1 / f$ lowfrequency backgrounds, and away from other noise sources (such as ambient-light fluctuations in the case of the LED

[^452]example). The demodulation step creates a dc output proportional to the signal, which can be lowpass filtered (a simple $R C$ filter may be adequate) to narrow the detected bandwidth.

To understand the method, it is necessary to take a short detour into the phase detector, a subject we first take up in §13.13.2.

#### A. Phase detectors

In §13.13.2 we describe phase detectors that produce an output voltage proportional to the phase difference between two digital (logic-level) signals. For purposes of lock-in detection, you need to know about linear phase detectors, because you are nearly always dealing with analog voltage levels.

The simplest circuit ${ }^{140}$ is shown in Figure 8.116. An analog signal passes through a linear amplifier whose gain is reversed by a square-wave "reference" signal controlling a FET switch (see Table 3.3 or 13.7 for candidates). The output signal passes through a lowpass filter, $R C$. That's all there is to it. Let's see what you can do with it.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0608.jpg?height=519&width=802&top_left_y=1103&top_left_x=1071)

Figure 8.116. Phase detector for linear input signals. Most simply, you can implement this with a dual op-amp and a CMOS switch IC. This scheme is used in the monolithic AD630.

#### Phase-detector output

To analyze the phase-detector operation, let's assume we apply a signal

$$
E_{\mathrm{S}} \cos (\omega t+\phi)
$$

to such a phase detector, whose reference signal is a square wave with transitions at the zeros of $\sin \omega t$, i.e., at

[^453]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0609.jpg?height=486&width=1343&top_left_y=216&top_left_x=280)

Figure 8.117. Lock-in amplifier detection.
$t=0, \pi / \omega, 2 \pi / \omega$, etc. Let us further assume that we average the output, $V_{\text {out }}$, by passing it through a lowpass filter whose time constant is much longer than one period:

$$
\tau=R C \gg T=2 \pi / \omega
$$

Then the lowpass filter output is

$$
\left.\left\langle E_{\mathrm{S}} \cos (\omega t+\phi)\right\rangle\right|_{0} ^{\pi / \omega}-\left.\left\langle E_{\mathrm{S}} \cos (\omega t+\phi)\right\rangle\right|_{\pi / \omega} ^{2 \pi / \omega}
$$

where the angle brackets represent averages and the minus sign comes from the gain reversal over alternate half-cycles of $V_{\text {ref }}$. As an exercise, you can show that

$$
\left\langle V_{\text {out }}\right\rangle=-\left(2 E_{\mathrm{s}} / \pi\right) \sin \phi
$$

Exercise 8.9. Perform the indicated averages by explicit integration to obtain the preceding result for unity gain.

Our result shows that the averaged output, for an input signal of the same frequency as the reference signal, is proportional to the amplitude of $E_{\mathrm{S}}$ and sinusoidal in the relative phase.

We need one more result before going on: what is the output voltage for an input signal whose frequency is close to (but not equal to) the reference signal? This is easy, because in the preceding equations the quantity $\phi$ now varies slowly, at the difference frequency:

$$
\cos (\omega+\Delta \omega) t=\cos (\omega t+\phi) \quad \text { with } \phi=t \Delta \omega
$$

giving an output signal that is a slow sinusoid:

$$
V_{\text {out }}=\left(2 E_{\mathrm{S}} / \pi\right) \sin (t \Delta \omega)
$$

which will pass through the lowpass filter relatively unscathed if $\Delta \omega<1 / \tau=1 / R C$ and will be heavily attenuated if $\Delta \omega>1 / \tau$.

#### B. The lock-in method

Now the so-called lock-in (or phase-sensitive) amplifier should make sense. First you make a weak signal periodic, as we've discussed, say at a frequency in the neighborhood of 100 Hz . The weak signal, contaminated by noise, is amplified and phase detected relative to the modulating signal. Look at Figure 8.117. In many cases you'll want to measure the weak signal as some experimental condition is varied - you'll have an experiment with two "knobs" on it, one for fast modulation to do phase detection, and one for a slow sweep through the interesting features of the signal (in NMR, for example, the fast modulation might be a small 100 Hz modulation of the magnetic field, and the slow modulation might be a frequency sweep 10 minutes in duration through the resonance). The phase shifter is adjusted to give maximum output signal, and the lowpass filter is set for a time constant long enough to give a good signal-to-noise ratio. The lowpass-filter rolloff sets the bandwidth, so a 1 Hz rolloff, for example, gives you sensitivity to spurious signals and noise only within 1 Hz of the desired signal. The bandwidth also determines how fast you can adjust the "slow modulation," because now you must not sweep through any features of the signal faster than the filter can respond; people use time constants of fractions of a second up to tens of seconds or more. ${ }^{141}$

Note that lock-in detection amounts to bandwidth narrowing, with the bandwidth set by the post-detection lowpass filter. Another way to reduce the detection bandwidth is with the technique of signal averaging, in which the results of repetitive measurements (e.g., frequency sweeps) are accumulated; this is a common option on instruments such as spectrum analyzers. In either case the effect of the modulation is to center the signal at the fast modulation

[^454]frequency, rather than at dc, in order to get away from $1 / f$ noise (flicker noise, drifts, and the like).

#### C. Two methods of "fast modulation"

There are several ways to do the fast modulation: the modulation waveform can be either a very small sinewave or a very large square wave compared with the features of the sought-after signal (line shape versus magnetic field, for example, in NMR), as sketched in Figure 8.118. In the first case the output signal from the phase-sensitive detector is proportional to the slope of the line shape (i.e., its derivative), whereas in the second case it is proportional to the line shape itself (providing there aren't any other lines out at the other endpoint of the modulation waveform). This is the reason all those simple NMR resonance lines come out looking like dispersion curves (Figure 8.119).

For large-shift square-wave modulation there's a clever method for suppressing modulation feedthrough, in cases where that is a problem. Figure 8.120 shows the modulation waveform. The offsets above and below the central value kill the signal, causing an on-off modulation of the signal at twice the fundamental of the modulating waveform. This is a method for use in special cases only; don't get carried away by the beauty of it all!

Large-amplitude square-wave modulation is a favorite with those dealing in infrared astronomy, where the telescope's secondary mirrors are rocked to switch the image back and forth on an infrared source. It is also popular in radio astronomy, where it's called a Dicke switch.

Commercial lock-in amplifiers have a variablefrequency modulating source and tracking filter, a
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0610.jpg?height=627&width=738&top_left_y=1564&top_left_x=253)

Figure 8.118. Lock-in modulation methods. A. Small sinusoid. B. Large square wave.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0610.jpg?height=529&width=730&top_left_y=205&top_left_x=1102)

Figure 8.119. Line-shape differentiation resulting from lock-in detection.
switchable-time-constant post-detection filter, a good low-noise wide-dynamic-range amplifier (you wouldn't be using lock-in detection if you weren't having noise problems), and a nice linear phase detector. They also let you use an external source of modulation. The phase shift is adjustable, so you can maximize the detected signal. The whole item comes packed in a handsome cabinet, with a meter or digital display showing the output signal. Typically these things cost a few thousand dollars. Stanford Research Systems has a nice selection of lock-in amplifiers, including several that use digital signalprocessing methods for enhanced linearity and dynamic range. In these the amplified input signal is accurately digitized (to 20 bits), the "oscillator" is a computed lookup table of (quadrature) sines and cosines, and the "mixer" is a numeric multiplier. Ordinarily lock-in amplifiers are of rather limited signal bandwidth, typically 100 kHz . But by using the radiofrequency "heterodyne" technique (input frequency band translation via linear mixing with a "local oscillator"), the lock-in method can be extended into high radio-frequencies. For example, the SR844 goes to 200 MHz ; it uses a hybrid of analog techniques (input filtering and downconversion) and digital signal processing (baseband digitizing and synchronous detection).

To illustrate the power of lock-in detection, we set up a small demonstration for our students. We use a lockin to modulate a small LED of the kind used for panel
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0610.jpg?height=146&width=782&top_left_y=2039&top_left_x=1081)

Figure 8.120. Modulation scheme for suppressing modulation feedthrough.
indicators, with a modulation rate of a kilohertz or so. The current is very low, and you can hardly see the LED glowing in normal room light. Six feet away a phototransistor looks in the general direction of the LED, with its output fed to the lock-in. With the room lights out, there's a tiny signal from the phototransistor at the modulating frequency (mixed with plenty of noise), and the lock-in easily detects it, using a time constant of a few seconds. Then we turn the room lights on, at which point the signal from the phototransistor becomes just a huge messy waveform, jumping in amplitude by 50 dB or more. The situation looks hopeless on the oscilloscope, but the lock-in just sits there, unperturbed, calmly detecting the same LED signal at the same level. You can check that it's really working by sticking your hand in between the LED and the detector. It's darned impressive.

At the other end of the cost spectrum, synchronous detection is used to accomplish the same rejection of ambient light in some inexpensive light-beam-detection components, for example the S6809/46 and S6986 from Hamamatsu. These ICs come in a clear plastic case (several available package styles) containing an integrated photodiode, preamp, and synchronous detector with logic-level output; included also is the internal oscillator and output driver for the external LED light source. They cost about $\$ 6$ in small quantities.

## 8.15 Power-supply noise

Amplifier circuits that do not have a high degree of powersupply rejection are susceptible to noise (and signals) on the dc power supplies. If the dc rails are noisy, the output will be too, so you've got to keep them quiet. The problem is not as bad as it could be, though, because supply noise appears unamplified at the output, with the amplifier's signal gain of, say, $\times 100$ signal gain. Still, dc power supplies are rarely quiet even to the level of $100 \mathrm{nV} / \sqrt{\mathrm{Hz}}(100$ times a reasonable input noise target of, say, $1 \mathrm{nV} / \sqrt{\mathrm{Hz}})$. That is why the dc rails in many of the circuits in this chapter are marked "quiet."

How noisy are typical dc bench power supplies? You'll see specs like " $0.2 \mathrm{mVrms}, 2 \mathrm{mVpp}$," which sounds respectable enough until you realize that signal levels in a sensitive circuit may be far smaller. For example, the output noise level over the 20 kHz audio band of the preamp of Figure 8.42 is just $1 \mu \mathrm{Vrms}\left(v_{\mathrm{n}(\mathrm{out})}=G_{\mathrm{V}} e_{\mathrm{n}(\mathrm{in})} \sqrt{\Delta \mathrm{f}}\right)$. So such a supply's specified noise is 46 dB above the output noise floor.

Specs are one thing, actual performance is another. To get a measure of the power supply noise scene we mea-
sured two dozen dc supplies from our lab's collection, with the resulting spectra of Figure 8.123. ${ }^{142}$

The spread in noise performance is stunning - the outstanding performer (\#4) turned out to be a "precision power source" half a century old (we bought it in 1967), with an ovenized compartment for the zener reference and (discrete) error amplifier. By comparison, a contemporary bench supply with elegant digital readout like \#12 is nearly 100 times ( 40 dB ) as noisy. Not to be outdone, the real screamers turn out to be a simple switchmode cellphone charger (\#22), and an unregulated wall-wart (\#23) whose powerline-tracking output wanderings dominate the lowfrequency spectrum. At the other end, nothing beats a leadacid battery (\#3, right down at our measurement noise floor) for the utmost in inherently quiet dc sources. ${ }^{143}$

What accounts for these large differences? Switching supplies are inherently noisy, of course. But even among the linear supplies there is a $100 \times$ spread $(40 \mathrm{~dB})$ in noise voltage. A quiet dc regulated supply must have plenty of loop gain, implemented with low-noise amplifiers. And it's critically important to select a low-noise voltage reference (particularly down at low frequencies, where it can't be quieted with filters); see the discussion and plots in $\S 9.10$.

### 8.15.1 Capacitance multiplier

A nice trick for cleaning up a noisy supply is a "capacitance multiplier" circuit (Figure 8.121). We introduced this back in §8.5.9, where we explored the properties of a BJT input stage with $e_{\mathrm{n}} \sim 0.07 \mathrm{nV} / \sqrt{\mathrm{Hz}}$. Here we choose $R$ small enough so that there is at most a volt or so drop at maximum load current, then choose $C$ for a long-enough time constant $R C$ to attenuate adequately the portion of the noise spectrum you care about. For our ribbon-mic amplifier we elaborated on this a bit, with a 2-stage $R C$ filter of $\sim 2 \mathrm{~s}$ time constant; it's shown in the top portion of the BJT noisemeasuring circuit of Figure 8.92. There we increased $R C$ until the output noise spectrum was down to the analyzer's noise floor.

Note that the capacitance multiplier compromises the dc output regulation - there's no feedback from its output pin. However, this technique is especially effective when

[^455]added upstream of the regulating pass element (i.e., after the rectifier and storage capacitor). We have applied this simple modification to commercial power supplies and scientific instruments with great success. It's a far easier way to achieve $100 \times$ lower output ripple than the alternative of raising the control-loop gain and bandwidth. If you do this, be sure there's enough drop across $Q_{1}$ to handle the full ripple amplitude - in this location the 120 Hz (or 100 Hz ) ac ripple at full load current may be as much as a few volts. You can add a resistor from the base to ground to increase the dc drop across $Q_{1}$; or you can use a MOSFET, whose larger operating $V_{\mathrm{GS}}$ may provide adequate headroom.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0612.jpg?height=310&width=563&top_left_y=748&top_left_x=341)

Figure 8.121. A "capacitance multiplier" for filtering incoming dc consists of an emitter follower biased with a smoothed (lowpassfiltered) replica of the noisy input. A bead or small resistor prevents oscillation.

Figure 8.122 shows the effect of Figure 8.92's capacitance multiplier, measured with two of the power supplies that appear in Figure 8.123's crowd. For each supply we measured (a) the spectrum directly from the output terminals (solid curves), (b) the spectrum downstream of the capacitance multiplier (dashed curves), and, for comparison, (c) the spectrum with $10,000 \mu \mathrm{~F}$ across the power supply's terminals (dotted curve). In all cases the measured output was loaded with $100 \Omega$. The capacitance multiplier is stunningly effective in eliminating power supply noise, ${ }^{144}$ and it's a far better use of $10,000 \mu \mathrm{~F}$ than the brute-force approach of putting the same capacitance directly across the dc terminals.

## 8.16 Interference, shielding, and grounding

"Noise" in the form of interfering signals, 60 Hz pickup, and signal coupling via power supplies and ground paths can turn out to be of far greater practical importance than the intrinsic noise sources we've just discussed. These interfering signals can all be reduced to an insignificant level (unlike thermal noise) with proper circuit design, layout,

[^456]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0612.jpg?height=986&width=797&top_left_y=216&top_left_x=1076)

Figure 8.122. A capacitance multiplier is highly effective in eliminating power-supply noise, as shown in these measured noise spectra of two of the supplies whose spectra are included in Figure 8.123 (with same label numbers). Solid curves, power supply alone; dotted curves, (single-prime label), with added $10,000 \mu \mathrm{~F}$ capacitor across the dc output terminals; dashed curves (doubleprime label), with capacitance multiplier shown in Figure 8.92.
and construction. In stubborn cases the cure may involve a combination of filtration of input and output lines, careful layout and grounding, and extensive electrostatic and magnetic shielding. In these subsections we offer some suggestions that may help illuminate this dark area of the electronic art. ${ }^{145}$

### 8.16.1 Interfering signals

Interfering signals can enter an electronic instrument through the powerline inputs or through signal input and output lines. In addition, signals can be capacitively

[^457]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0613.jpg?height=1421&width=1664&top_left_y=213&top_left_x=117)

Figure 8.123. All dc power supplies are not created equal! Measured noise voltage spectra of many varieties of supplies found in our lab. Dashed lines are switching supplies; the rest are linear. A $100 \Omega$ load was used in most cases. Spectral peaks ("tonals") at powerline frequency and harmonics have been edited out for clarity; they range from 5 dB to more than 50 dB above the smoothed baseline, as listed. A drifting output voltage produces a rising low-frequency tail.
coupled (electrostatic coupling) onto wires in the circuit (the effect is more serious for high-impedance points within the circuit), magnetically coupled to closed loops in the circuit (independent of impedance level), or electromagnetically coupled to wires acting as small antennas for electromagnetic radiation. Any of these can become a mechanism for coupling of signals from one part of a circuit to another. Finally, signal currents from one part of the circuit can couple to other parts through voltage drops on ground lines or power-supply lines.

#### A. Eliminating interference

Numerous effective tricks have been evolved to handle most of these commonly occurring interference problems. Keep in mind the fact that these techniques are all aimed at reducing the interfering signal or signals to an acceptable level; they rarely eliminate them altogether. Consequently, it often pays to raise signal levels, just to improve the signal-to-interference ratio. Also, it is important to realize that some environments are much worse than others; an instrument that works just dandy on the bench may perform
miserably on location. Some environments worth avoiding are those (a) near a radio or television station (RF interference), (b) near a subway (impulsive interference and powerline garbage), (c) near high-voltage lines (radio interference, frying sounds), (d) near motors and elevators (powerline spikes), (e) in a building with triac lamp dimmers and heater controllers (powerline spikes), (f) near equipment with large transformers (magnetic pickup), and (g) near arc welders (unbelievable pickup of all sorts). Herewith a gathering of advice, techniques, and black magic.

#### B. Signals coupled through inputs, outputs, and powerline

The best bet for powerline noise is to use a combination of RF line filters and transient suppressors on the ac powerline. You can achieve 60 dB or better attenuation of interference above a few hundred kilohertz this way, as well as effective elimination of damaging spikes.

Inputs and outputs are more difficult, because of impedance levels and the need to couple desired signals that may lie in the frequency range of interference. In devices like audio amplifiers you can use lowpass filters on inputs and outputs (much interference from nearby radio stations enters via the speaker wires, acting as antennas). In other situations shielded lines are often necessary. Lowlevel signals, particularly at high impedance levels, should always be shielded. So should the instrument cabinet.

#### C. Capacitive coupling

Signals within an instrument can get around handsomely via electrostatic coupling: some point within the instrument has a 10 volt signal jumping around; a high- $Z$ input nearby does some sympathetic jumping, too. The best things to do are to reduce the capacitance between the offending points (move them apart), add shielding (a complete metal enclosure, or even close-knit metal screening, eliminates this form of coupling altogether), move the wires close to a ground plane (which "swallows" the electrostatic fringing fields, reducing coupling enormously), and lower the impedance levels at susceptible points, if possible. Op-amp outputs don't pick up interference easily, whereas inputs do. More on this later.

#### D. Magnetic coupling

Unfortunately, low-frequency magnetic fields are not significantly reduced by metal enclosures. A dynamic microphone, audio recorder, low-level amplifier, or other sensitive circuit placed in close proximity to an instrument with a large power transformer will display astounding amounts of 60 Hz pickup. The best therapy here is to avoid large enclosed areas within circuit paths and try to keep the circuit
from closing around in a loop. Twisted pairs of wires are quite effective in reducing magnetic pickup, because the enclosed area is small, and the signals induced in successive twists cancel.

When dealing with very low level signals, or devices particularly susceptible to magnetic pickup (tape heads, inductors, wire-wound resistors), it may be desirable to use magnetic shielding. "Mu-metal shielding" is available in preformed pieces and flexible sheets. If the ambient magnetic field is large, it is best to use shielding of high permeability (high mu ) on the inside, surrounded by an outer shield of lower permeability (which can be ordinary iron, or low-mu shielding material), to prevent magnetic saturation in the inner shield. Of course, moving the offending source of the magnetic field is often a simpler solution. It may be necessary to exile large power transformers to the hinterlands, so to speak. Shielded inductors (e.g., pot cores) are configured so that the magnetic material (usually ferrite) provides a closed magnetic path. Toroidal transformers have smaller fringing fields than the standard frame types, and a single reverse turn (or arranging the winding pattern to return back to where it begins) cancels the oneturn effective area of the toroid's winding.

#### E. Circuit boards and cables

Both capacitive and magnetic coupling occurs, also, between traces on circuit boards or between line pairs in cables and ribbons. Magnetic coupling is sometimes called inductive coupling, to distinguish it from capacitive coupling. This business of "crosstalk" is a rich subject, dealt with in good detail in references such as Johnson and Graham's Handbook of Black Magic. ${ }^{146}$ Perhaps unintiutively, it turns out that the magnitudes of inductive and capacitive crosstalk are generally comparable, but they behave differently as seen at the two ends of a pair of closely spaced lines: forward-going crosstalk is proportional to the signal's slew rate, but the capacitive and inductive components are of opposite sign and tend to cancel. For reversegoing crosstalk the coupled signal looks like a flat-topped pulse (of width equal to the round-trip travel time), with capacitive and inductive components reinforcing. If the driving impedance does not match the line's characteristic impedance (see Appendix H), that "near-end crosstalk" (aka NEXT) signal will reflect and become forward going, contributing to (and often dominating) the "far-end crosstalk" (or FEXT).

[^458]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0615.jpg?height=404&width=1238&top_left_y=211&top_left_x=330)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0615.jpg?height=387&width=1236&top_left_y=684&top_left_x=331)
B.

Figure 8.124. Ground paths for low-level signals. A. Right. B. Wrong.

See also additional discussion in Chapter 12 (\$12.9, "Digital signals and long wires").

#### F. Radiofrequency coupling

RF pickup can be particularly insidious, because innocentlooking parts of the circuit can act as resonant circuits, displaying enormous effective cross-section for pickup. Aside from overall shielding, it is best to keep leads short and avoid loops that can resonate. Ferrite beads may help, if the problem involves very high frequencies. Doing good deeds can sometimes create havoc. For example, you may want to use several ceramic capacitors to improve powersupply bypassing; but in combination with the inductance of the connecting supply rails they can form a lovely parasitic tuned circuit somewhere in the HF to VHF region (tens to hundreds of megahertz), nudged by active circuits into ringing and even oscillation. ${ }^{147}$

### 8.16.2 Signal grounds

Ground leads and shields can cause plenty of trouble, and there is a lot of misunderstanding on this subject. The prob-

[^459]lem, in a nutshell, is that currents you forgot about that are flowing through a ground line can generate a signal seen by another part of the circuit sharing the same ground. The technique of a ground "mecca" (a common point in the circuit to which all ground connections are tied) is often seen, but it's a crutch; with a little understanding of the problem you can handle most situations intelligently.

#### A. Common grounding blunders

Figure 8.124 shows a common situation. Here a low-level amplifier and a high-current driver are in the same instrument. The first circuit is done correctly: both amplifiers tie to the supply voltages at the regulator (right at the sensing leads), so $I R$ drops along the leads to the power stage don't appear on the low-level amplifier's supply voltages. In addition, the load current returning to ground does not appear at the low-level input; no current flows from the ground side of the low-level amplifier's input to the circuit mecca (which might be the connection to the case near the BNC input connector).

In the second circuit there are two blunders. Supplyvoltage fluctuations caused by load currents at the highlevel stage are impressed on the low-level supply voltages. Unless the input stage has very good supply rejection, this can lead to oscillations. Even worse, the load current
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0616.jpg?height=386&width=527&top_left_y=220&top_left_x=354)

Figure 8.125. Decoupling the dc rail supplying low-level stages.
returning to the supply makes the case "ground" fluctuate with respect to power-supply ground. The input stage ties to this fluctuating ground, a very bad idea. The general idea is to look at where the large signal currents are flowing and make sure their $I R$ drops don't wind up at the input. In some cases it may be a good idea to decouple the supply voltages to the low-level stages with a small $R C$ network (Figure 8.125). In stubborn cases of supply coupling it may pay to put a zener or 3-terminal regulator on the low-levelstage supply for additional decoupling.

### 8.16.3 Grounding between instruments

The idea of a controlled ground point within one instrument is fine, but what do you do when a signal has to go from one instrument to another, each with its own idea of "ground"? Some suggestions follow (and see also the extensive treatment of the transmission of digital signals in §12.9).

#### A. High-level signals

If the signals are several volts, or large logic swings, just tie things together and forget about it (Figure 8.126). The voltage source shown between the two grounds represents the variations in local grounds you'll find on different powerline outlets in the same room or (worse) in different rooms or buildings. It consists of some 60 Hz voltage, harmonics of the line frequency, some radiofrequency signals (the powerline makes a good antenna), and assorted spikes and other garbage. If your signals are large enough, you can live with this.

#### B. Small signals and long wires

For small signals this situation is intolerable, and you will have to go to some effort to remedy the situation. Figure 8.127 shows some ideas. In the first circuit, a coaxial shielded cable is tied to the case and circuit ground at the driving end, but it is kept isolated from the case
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0616.jpg?height=284&width=695&top_left_y=220&top_left_x=1119)

Figure 8.126. When connecting signals between instruments, you may see 100 mV (or more) differences (at powerline frequency) between their local grounds, even when they are bridged as shown.
at the receiving end (use a Bendix 4890-1 or Amphenol 31-010 insulated BNC connector). A differential amplifier is used to buffer the input signal, thus ignoring the small amount of "ground signal" appearing on the shield. A small resistor and bypass capacitor to ground is a good idea to limit ground swing and prevent damage to the input stage. The alternative receiver circuit in Figure 8.127A shows the use of a "pseudodifferential" input connection for a single-ended amplifier stage (which might, for example, be a standard noninverting op-amp connection, as indicated). The $10 \Omega$ resistor between amplifier common and circuit ground is large enough to let the signal source's reference ground set the potential at that point, because it is much larger than the impedance of the source's ground. Any noise present at that node, of course, appears also at the output. However, this becomes unimportant if the stage has sufficiently high voltage gain, $G_{\mathrm{V}}$, because the ratio of desired signal-to-ground noise is reduced by $G_{\mathrm{V}}$. Thus, although this circuit isn't truly differential (with infinite CMRR), it works well enough (with effective CMRR $=G_{\mathrm{V}}$ ). This pseudo-differential ground-sensing trick can be used also for low-level signals within an instrument, when ground noise is a problem.

In the second circuit (Figure 8.127B), a shielded twisted pair is used, with the shield connected to the case at both ends. Because no signal travels on the shield, this is harmless. A differential amplifier is used as before on the receiving end. If logic signals are being transmitted, it is a good idea to send a differential signal (the signal and its inverted form), as indicated. Ordinary differential amplifiers can be used as input stages, or, if the ground interference is severe, special "isolated amplifiers" are available from manufacturers like Analog Devices, Inc. and TI/Burr-Brown. The latter permit kilovolts of common-mode signals. So do optoisolator modules (\$12.7), a handy solution for digital signals in some situations.

At radio frequencies, transformer coupling offers a convenient way of removing common-mode signal at the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0617.jpg?height=369&width=1259&top_left_y=216&top_left_x=335)
A.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0617.jpg?height=822&width=1322&top_left_y=570&top_left_x=288)

Figure 8.127. Ground connections for low-level signals through shielded cables.
receiving end; this also makes it easy to generate a differential bipolarity signal at the driving end. Transformers are popular in audio applications as well, although they tend to be bulky and lead to some signal degradation, as described in §8.10.

For very long cable runs (measured in miles) it is useful to prevent large ground currents flowing in the shield at radio frequencies. Figure 8.128 suggests a method. As before, a differential amplifier looks at the twisted pair, ignoring the voltage on the shield. By tying the shield to the case through a small inductor, the dc voltage is kept small while preventing large radiofrequency currents. This circuit also shows protection circuitry to prevent common-mode excursions beyond $\pm 10 \mathrm{~V}$.

Figure 8.129 shows a nice scheme to save wires in a multiwire cable in which the common-mode pickup has to be eliminated. Because the signals all suffer the same common-mode pickup, a single wire tied to ground at the
sending end serves to cancel the common-mode signals on each of the $n$ signal lines. Just buffer its signal (with respect to ground at the receiving end) and use it as the comparison input for each of $n$ differential amplifiers looking at the other signal lines.

The preceding schemes work well to eliminate common-mode interference at low to moderate frequencies, but they can be ineffective against radiofrequency interference, owing to poor common-mode rejection in the receiving differential amplifier.

One possibility here is to wrap the whole cable around a ferrite toroid (Figure 8.130). That increases the series inductance of the whole cable, raising the impedance to common-mode signals of high frequency and making it easy to bypass them at the far end with a pair of small bypass capacitors to ground. The equivalent circuit shows why this works without attenuating the differential signal: you have a series inductance inserted into both signal lines
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0618.jpg?height=700&width=710&top_left_y=219&top_left_x=265)

Figure 8.128. Input-protection circuits for use with very long lines.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0618.jpg?height=573&width=809&top_left_y=1035&top_left_x=218)

Figure 8.129. Common-mode interference rejection with long multiwire cables.
and the shield, but they form a tightly coupled transformer of unit turns ratio, so the differential signal is unaffected. This can be thought of as a " $1: 1$ transmission-line transformer" (see $\S 13.10$ in the second edition of this book).

#### C. Floating signal sources

The same sort of disagreement about the voltage of "ground" at separated locations enters in an even more serious way at low-level inputs, just because the signals are so small. An example is a magnetic tape head or other signal transducer that requires a shielded signal line. If you ground the shield at both ends, differences in ground potential will appear as signal at the amplifier input. The best
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0618.jpg?height=450&width=593&top_left_y=206&top_left_x=1178)

Figure 8.130. Wrapping a coaxial or multi-wire cable around a ferrite core for high-frequency common-mode suppression.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0618.jpg?height=210&width=651&top_left_y=813&top_left_x=1144)

Figure 8.131. Preventing sneak ground currents: tie the shield to ground at the receiving end only.
approach is to lift the shield off ground at the transducer (Figure 8.131).

#### D. Isolation amplifiers

Another solution to serious ground-contention problems is the use of an "isolation amplifier." Isolation amplifiers (isoamps) are commercial devices intended for coupling an analog signal (with bandwidth clear down to dc) from a circuit with one ground reference to another circuit with a completely different ground (Figure 8.132). In fact, in some bizarre situations the "grounds" can differ by many
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0618.jpg?height=565&width=804&top_left_y=1672&top_left_x=1067)

Figure 8.132. Isolation amplifier concept.
kilovolts! Isolation amplifiers are mandatory for medical electronics in which electrodes are applied to human subjects, in order to isolate completely those connections from any instrument circuits powered directly from the ac powerlines. Currently available isolation amplifiers use one of three methods.

1. Transformer isolation of a high-frequency carrier signal, which is either frequency modulated or pulse-width modulated with the relatively low bandwidth signal (dc to 10 kHz or so) to be isolated (Figure 8.133). This method is used in isolation amplifiers from Analog Devices, Inc. Transformer-isolated iso-amps have the convenient feature of requiring dc power only on one side; they all include a transformer-coupled dc-to-dc converter in the package. Transformer-coupled iso-amps can isolate up to 1.5 kV and have typical bandwidths of 5 kHz , though some units (e.g., the AD215) go to 120 kHz . The latter has $0.015 \%$ maximum nonlinearity, and costs about $\$ 80$ in single-piece quantities.
2. Optically coupled signal transmission via an LED at the sending end and photodiode at the receiving end. This technique is typified by the ACPL-C79 series from Avago. These devices use a delta-sigma modulation and demodulation scheme, and achieve a bandwidth from dc to 200 kHz . This series is inexpensive (about $\$ 5$ in modest quantity), with maximum nonlinearity of $0.06 \%$. An interesting alternative, which involves no clocking signal or carrier frequency, is to couple an LED at the sending end to a photodiode at the receiving end. To achieve good linearity you use feedback from a second matched photodiode at the transmitting side that receives light from the same LED, thus cancelling nonlinearities in both LED and photodiode (Figure 8.134; see also Figure 12.90 in Chapter 12). Some additional analog optoisolation techniques are discussed in $\S 12.7 .4$, and related digital isolated couplers in $\S 12.7 .2$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0619.jpg?height=365&width=799&top_left_y=1792&top_left_x=121)

Figure 8.133. AD215 transformer-coupled isolation amplifier. (Adapted from the AD215 datasheet, courtesy Analog Devices, Inc.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0619.jpg?height=616&width=796&top_left_y=220&top_left_x=977)

Figure 8.134. Unmodulated optical coupling eliminates clocking noise, with feedback from a matched detector to achieve reasonable linearity. (Adapted from the ISO100 datasheet, courtesy of Texas Instruments.)
3. Capacitively coupled isolation of a high-frequency carrier signal, which is modulated with the signal to be isolated (Figure 8.135). This technique is typified by the ISO122 and ISO124 from TI/Burr-Brown (Figure 8.136). There is no feedback, as with transformer isolation, but for most models you need power supplies at both ends. This usually isn't a problem, as you are likely to have electronics at both ends, generating and using the signal. If not, you can get an isolated dcdc converter to use with the iso-amp. The ISO124 isolates to 1.5 kV , with $0.01 \%$ maximum nonlinearity and
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0619.jpg?height=547&width=767&top_left_y=1599&top_left_x=989)

Figure 8.135. Capacitively-coupled isolation amplifier. (Adapted from the Burr-Brown Application Bulletin AB-047, courtesy of Texas Instruments.)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0620.jpg?height=452&width=799&top_left_y=218&top_left_x=218)

Figure 8.136. ISO124 capacitively-coupled isolation amplifier. (Adapted from the ISO124 datasheet, courtesy of Texas Instruments.)

50 kHz bandwidth; it costs $\$ 18$ in single-piece quantities. Figure 8.137 shows nicely the innards of one of these capacitively coupled devices.

These isolation amplifiers are all intended for analog signals. The same sorts of ground problems can arise in digital electronics, where the solution is simple and effective: optically coupled isolators ("optoisolators") are available, with plenty of bandwidth ( 10 MHz or more), isolation of several kilovolts, and low cost (a dollar or two). They are discussed extensively in Chapter 12.
A caution: isolation amplifiers can introduce noise of their own, particularly those that use some form of signal modulation (which is most of them!). For the latter you've got a residue of the modulating clock frequency; and all isolation amplifiers (whether clocked or not) introduce broadband noise of the usual sort. One remedy for clock noise is to add an analog lowpass filter at the output of the receiving side. For more detail see the helpful application document "Noise Sources in Applications Using Capacitive Coupled Isolated Amplifier" (Application Bulletin SBOA028, available at the Texas Instruments website, www.ti.com).

#### E. Signal guarding

A closely related issue is signal guarding, an elegant technique to reduce the effects of input capacitance and leakage for small signals at high impedance levels. You may be dealing with signals from a micro-electrode or a capacitive transducer, with source impedances of hundreds of megohms. Just a few picofarads input capacitance can form a lowpass filter, with rolloffs beginning at a few hertz! In addition, the effects of insulation resistance in the connecting cables can easily degrade the performance of an ultra-low input current amplifier (bias currents less than
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0620.jpg?height=560&width=802&top_left_y=210&top_left_x=1076)

Figure 8.137. Burr-Brown (TI) ISO106 isolation amplifier, courtesy of Texas Instruments.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0620.jpg?height=272&width=820&top_left_y=910&top_left_x=1059)

Figure 8.138. Using a guard to raise input impedance.
a picoamp) by orders of magnitude. The solution to both these problems is a guard electrode (Figure 8.138). ${ }^{148}$

A follower bootstraps the inner shield, effectively eliminating leakage current and capacitive attenuation by keeping zero voltage difference between the signal and its surroundings. An outer grounded shield is a good idea, to keep interference off the guard electrode; the follower has no trouble driving that capacitance and leakage, of course, given its low output impedance.

You shouldn't use these tricks more than you need to; it would be a good idea to put the follower as close to the signal source as possible, guarding only the short section of cable connecting them. Ordinary shielded cable can then carry the low-impedance output signal out to the remote amplifier. ${ }^{149}$

#### F. Coupling to outputs

Ordinarily the output impedance of an op-amp is low enough that you don't have to worry about capacitive signal coupling. In the case of high-frequency or fast-switching

[^460]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0621.jpg?height=457&width=815&top_left_y=218&top_left_x=118)

Figure 8.139. Digital cross-coupling interference with linear signals.
interference, however, you have just cause for alarm, particularly if the desired output signal involves some degree of precision. Consider the example in Figure 8.139. A precision signal is buffered by an op-amp and passes through a region containing digital logic signals jumping around with slew rates of $0.5 \mathrm{~V} / \mathrm{ns}$. The op-amp's closed-loop output impedance rises with frequency, typically reaching values of 10 to $100 \Omega$ or more at 1 MHz (see $\S 5.8 .3$ ). How large a coupling capacitance is permissible, to keep coupled interference less than the analog signal's resolution of 0.1 mV ? The surprising answer is a maximum of 0.02 pF .

There are some solutions. The best thing is to keep your small analog waveforms out of the reach of fast-switching signals. A moderate bypass capacitor across the op-amp's output (with perhaps a small series resistor, to maintain opamp stability) will help, although it degrades the slew rate. You can think of the action of this capacitor as lowering the frequency of the coupled charge bundles to the point where the op-amp's feedback can swallow them. A few hundred picofarads to ground will adequately stiffen the analog signal at high frequencies (think of it as a capacitive voltage divider). Another possibility is to use a lowimpedance buffer such as the LT1010, or a power op-amp such as the LM675. Don't neglect the opportunity to use shielding, twisted pairs, and proximity to ground planes to reduce coupling.
### Review of Chapter 8

An A-to-Q summary of what we have learned in Chapter 8. This summary reviews basic principles and facts in Chapter 8, but it does not cover application circuit diagrams and practical engineering advice presented there.

#### ॥A. Noise Basics.

See §8.1. The random noise you care about is characterized by its density (rms noise amplitude in a 1 Hz band of frequency), §8.2.1. Noise voltage density is called $e_{\mathrm{n}}$, and has units like $\mathrm{nV} / \sqrt{\mathrm{Hz}}$. Likewise, the symbol for noise current density is $i_{\mathrm{n}}$, with units like $\mathrm{fA} / \sqrt{\mathrm{Hz}}$. A noise current at an amplifier's input flows through the signal's source resistance, creating its own noise voltage density $e_{\mathrm{n}}=i_{\mathrm{n}} R_{\mathrm{s}}$. Independent noise sources combine as the square root of the sum of their squares: $e_{\mathrm{n}(\text { total })}=\sqrt{e_{\mathrm{n} 1}^{2}+e_{\mathrm{n} 2}^{2}+\cdots}$. If a noise source is uniform over frequency, it's called "white noise," and the rms noise voltage (as contrasted with noise voltage density) contained within a bandwidth $B$ is just $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{B}$. Knowing that, you can go to Table $8.3 \mathrm{a}-\mathrm{c}$ on page 522, which lists $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ for a wide selection of op-amps, to figure out how much noise is added in an op-amp amplifier stage. Compare this with the input signal's noise level; or multiply by the amplifier's voltage gain and, voilà, you've got the output noise voltage density.

#### I|B. Noise Spectra.

Whatever its source, noise density can vary with frequency, see $\S 8.1$. White noise ( $e_{\mathrm{n}}$ constant over frequency, up to some cutoff) is common, for example a resistor's Johnson noise (IEE, below) or the shot noise fluctuations of a steady current ( $\mathbb{I F}$, below). Also prevalent is " $1 / f$ noise," sometimes called flicker noise, or pink noise; it is characterized by a $1 / f$ power spectrum (equal power per octave, or per decade), thus a voltage noise density $e_{\mathrm{n}}(f)$ proportional to $1 / \sqrt{f}$. Most electronic circuits (and many other physical phenomena) exhibit $1 / f$ noise, often characterized by the " $1 / f$ corner frequency" at which the $1 / f$ noise component is equal to the white noise component. Finally, the term red noise refers to a noise density $e_{\mathrm{n}}$ proportional to $1 / f$ (thus a $1 / f^{2}$ power spectrum); see for example Figure 8.95. The rms noise voltage $v_{\mathrm{n}}$ in some bandwidth $B$ (extending from $f_{1}$ to $f_{2}$ ) is gotten by integrating $e_{\mathrm{n}}^{2}(f)$ over frequency, then taking the square root: $v_{\mathrm{n}}=\sqrt{v_{\mathrm{n}}^{2}}$, where $v_{\mathrm{n}}^{2}=\int_{f_{1}}^{f_{2}} e_{\mathrm{n}}(f)^{2} d f$. For a white spectrum this reduces to the simple $v_{\mathrm{n}}=e_{\mathrm{n}} \sqrt{B}$.

Actual circuit noise need not conform to these idealized spectra, which, however, are useful in characterizing the noise of real devices over chosen regions of frequency; see
for example Figure 8.107. In real life, spectra may show a noise "shelf" (e.g., curve Z in Figure 8.52), or a noise peak (e.g., Figures 5.52 or 8.72).

#### IIC. Noise Amplitude Distribution.

Quite apart from its spectrum, one can characterize the amplitude distribution of noise; that is, the distribution of instantaneous amplitudes sampled in time. Most noise sources obey a Gaussian distribution (Figure 8.2), a fact that is of lesser concern than the important properties of noise spectrum and amplitude. A notable exception is burst noise (also called popcorn noise, bistable noise, or telegraph noise), which jumps randomly between several voltage levels (Figure 8.5). Burst noise was prominent in the early decades of semiconductor technology, but it has been largely banished in contemporary products. One suspects some low-level remnants remain, though, as evidenced for example in a comparison of the measured burst-noise spectrum of Figure 8.6 with the measured JFET noise spectra of Figure 8.51.

#### qD. Sources of Noise.

The dominant sources of noise in electronic circuits (detailed in paragraphs $\mathbb{I E}-\mathrm{H}$ below) are:

Johnson noise. Thermal fluctuations generate a noise voltage in a resistor.
Shot Noise. The discrete nature of electric charge creates fluctuations in a "steady" current.
Excess Noise. Various semiconductor phenomena contribute additional noise (often $\sim 1 / f$ in power density) at low frequencies.
Amplifier Noise. Transistors (both BJTs and FETs) add noise, traceable to the above sources (e.g., Johnson noise of the base resistance $r_{\mathrm{bb}}{ }^{\prime}$, shot noise of the collector current, and excess noise terms).

#### ๆE. Johnson Noise.

Thermal fluctuations cause a self-generated noise voltage across the terminals of an unloaded resistor; this is Johnson noise, of (white-) noise voltage density $e_{\mathrm{n}}=\sqrt{4 k_{\mathrm{B}} T R}$, where $k_{\mathrm{B}}$ is Boltzmann's constant. Don't bother remembering the latter; just remember the value of $e_{\mathrm{n}}$ for a roundnumber resistance (we like $1.28 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for $R=100 \Omega$, or $4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for $R=1 \mathrm{k} \Omega$ ), and scale by the square root of $R$. If short-circuited, a resistor generates a Johnson noise current $i_{\mathrm{n}}=e_{\mathrm{n}} / R$; that is, $i_{\mathrm{n}}=\sqrt{4 k_{\mathrm{B}} T / R}$. See the graph in Figure 8.1 and the mini-table in §8.1.1.

Johnson noise is a fundamental physical phenomenon, and does not depend on the particular construction of the
resistor (or resistance). However, when a steady current flows through a resistance, you may get some additional noise current (which you can think of as due to resistance fluctuations), generally with something approximating a $1 / f$ power spectrum. This excess noise varies with resistor construction, being worst in a granular "carbon composition" type, but insignificant in a wirewound resistor.

#### IF. Shot Noise.

The finiteness of the charge quantum (electron charge) causes statistical fluctuations even in a steady current. If the charges act independently, the (white-) noise current density is $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{dc}}}$, where $q$ is the electron charge $\left(1.6 \times 10^{-19}\right.$ coulombs). As with Johnson noise, it's handy to simply remember the value of $i_{\mathrm{n}}$ for a round-number dc current (e.g., $18 \mathrm{pA} / \sqrt{\mathrm{Hz}}$ for $I_{\mathrm{dc}}=1 \mathrm{~mA}$ ), and scale by the square root of current. ${ }^{150}$ See the mini-table in §8.1.2. Important: the shot-noise formula assumes that the charge carriers act independently; the current noise is greatly reduced if there are long-range correlations, as for example in a metallic conductor.

#### IG. BJT Noise.

See §8.3. The primary noise terms of a BJT are an input noise voltage $e_{\mathrm{n}}$ in series with the base, combined with an input noise current $i_{\mathrm{n}}$ injected at the base (Figure 8.9). The amplifier's input-referred noise (i.e., ignoring the Johnson noise of the signal source's $R_{\mathrm{S}}$ ) is then $e_{\mathrm{a}(\mathrm{rms})}=\left[e_{\mathrm{n}}^{2}+\left(R_{\mathrm{s}} i_{\mathrm{n}}\right)^{2}\right]^{\frac{1}{2}}$. As you increase the collector current, $e_{\mathrm{n}}$ decreases and $i_{\mathrm{n}}$ increases, so there's an operatingcurrent tradeoff. The ratio $e_{\mathrm{n}} / i_{\mathrm{n}}$ has units of resistance; it's called the noise resistance, and it's a useful quantity in circuit design; see 9 II below. Table 8.1a lists measured values of $e_{\mathrm{n}}$ for many low-noise BJT candidates.

Voltage noise, $e_{\mathbf{n}}$. In the simplest model, the noise voltage term arises from two sources: collector shot-noise current flowing through the transistor's emitter resistance $r_{\mathrm{e}}$, and Johnson noise in the transistor's internal base resistance $r_{\mathrm{bb}}$. Combining these independent noise terms (eq'n 8.20), we get the total input-referred squared noise voltage, $e_{\mathrm{n}}^{2}=2 q I_{\mathrm{C}} r_{\mathrm{e}}^{2}+4 k T r_{\mathrm{bb}^{\prime}}=4 k T\left(r_{\mathrm{e}} / 2+r_{\mathrm{bb}^{\prime}}\right)$. Put another way, the input noise voltage is equal to the combined Johnson noise of the transistor's base resistance ( $r_{\mathrm{bb}}$ ) and a fictional resistance equal to half its

[^461]intrinsic emitter resistance ( $r_{e} / 2$ ). The latter is inversely proportional to collector current, so a BJT's noise voltage decreases with increasing $I_{C}$, ultimately limited by its internal base resistance; see for example Figure 8.12. Thus to minimize BJT voltage noise, choose a part with a low $r_{\mathrm{b} \mathrm{b}^{\prime}}$, and operate at relatively high collector current. A more refined model includes the effects of base current shot noise, important at low frequencies and high collector currents; see Figure 8.11 and eq'n 8.24.
Current noise, $\boldsymbol{i}_{\mathbf{n}}$. The primary noise current term is shot noise in the dc base current, $i_{\mathrm{n}}=\sqrt{2 q I_{B}}$ (eq'n 8.21). Taking this term alone, you minimize BJT current noise by operating at low collector current. A more refined model includes a rising $\propto 1 / \sqrt{f}$ noise current term at low frequencies, and a rising $\propto f$ noise current term at high frequencies caused by falling beta; see eq'n 8.22 and Figure 8.13.

#### IH. JFET Noise.

See §8.6. The low-noise choice for signals of high source impedance are FETs, owing to their very low input current noise; JFETs are quieter than MOSFETs, and, unlike the latter, they are available as discrete small-signal parts (see Table 8.2).

Voltage noise, $\boldsymbol{e}_{\mathbf{n}}$. The dominant noise voltage term is Johnson noise in the channel resistance (eq'n 8.34), $e_{\mathrm{n}}^{2} \approx 4 k T\left(\frac{2}{3} \frac{1}{g_{m}}\right)$. Put another way, the noise voltage is equivalent to Johnson noise in a resistor of value $R=\frac{2}{3} \frac{1}{g_{m}}$; see Figure 8.46. To minimize JFET voltage noise, choose a JFET of high transconductance, and operate it at a relatively high drain current (note, however, that $e_{\mathrm{n}}$ falls slowly, only as the fourth root of $I_{\mathrm{D}}$ ). As with BJTs, JFETs exhibit a rising $1 / f$-like noise tail at low frequencies (Figure 8.52), with enormous variation among types, and manufacturers.
Current noise, $\boldsymbol{i}_{\mathbf{n}}$. At low frequencies the current noise is low, just shot noise of the gate (leakage) current: $i_{\mathrm{n}}=\sqrt{2 q I_{\mathrm{G}}}$, see Figure 8.48. To frame this in numbers, a typical gate leakage current of 10 pA has a noise current density $i_{\mathrm{n}}$ of just $1.8 \mathrm{fA} / \sqrt{\mathrm{Hz}}$, generating only $1.8 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of noise voltage through a $1 \mathrm{M} \Omega$ source resistance. That's down at the low end of transistor noise voltage, and it's completely dwarfed by the $128 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ of Johnson noise produced by the source resistance itself. At rising frequencies there are some additional sources of input noise current. For example, in a transimpedance amplifier the gate input is a summing junction, at which the FET's voltage noise generates a noise current through
the input capacitance, of magnitude $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}$, see $\mathbb{I N}$ (below) and §8.11.

#### TII. Noise Figure, Noise Temperature, and Noise Resistance.

See $\S 8.2$. Noise figure (NF) is a popular measure of added amplifier noise. It is the ratio (in dB ) of the amplifier's output noise to the output of a noiseless amplifier of the same gain, each driven with a source resistance $R_{\mathrm{S}}$ : $\mathrm{NF}=10 \log _{10}\left(1+v_{\mathrm{n}}^{2} / 4 k T R_{\mathrm{S}}\right)$, where $v_{\mathrm{n}}^{2}$ is the mean squared noise voltage per hertz contributed by the amplifier when a noiseless (cold) resistor of value $R_{\mathrm{S}}$ connected across its input (see eq'n 8.13 and Figure 8.7). Another (and equivalent) way to quantify the excess noise contributed by an amplifier when driven by a signal of source resistance $R_{\mathrm{S}}$ is to state its noise temperature ( $T_{\mathrm{n}}$, see Figure 8.8 and eq'n 8.16).

An amplifier's noise figure (and its noise temperature) is minimum when driven by a signal of source resistance equal to its noise resistance, i.e., when $R_{\mathrm{s}}=R_{\mathrm{n}}=e_{\mathrm{n}} / i_{\mathrm{n}}$. Transistor datasheets sometimes provide contours of NF versus operating current and source resistance at a given frequency (e.g., Figure 8.22); for amplifiers where you have no control over operating current you'll find instead contours of NF versus frequency and source resistance (e.g., Figure 8.27). Caution: do not make the mistake of adding a series resistor to a signal of low source resistance to improve the noise figure (§8.4.6). Instead choose an amplifier that provides the noise figure you need with that input source resistance; in some situations (e.g., very low source resistance) you can use a signal transformer to make a lossless match to the amplifier's optimum source resistance.

#### ||J. Noise Sources and Measurements.

See $\S 8.12$. At low to moderate frequencies you can determine the noise properties of a transistor amplifier of known voltage gain by making two measurements of its rms output noise voltage in a known bandwidth, first with shorted input (to get $e_{\mathrm{n}}$ ) and then with an appropriately chosen resistor across its input (to get $i_{\mathrm{n}}$ ); see $\S 8.12 .1$. Because you're measuring the integrated noise voltage, you need to know the equivalent noise bandwidth; see §8.13. A more general technique, applicable to amplifiers that require a matched source impedance (e.g., $50 \Omega \mathrm{RF}$ amplifiers) and insensitive to actual measurement bandwidth, is to drive the input with a calibrated noise source while observing the rms noise output; see $\S 8.12 .3$. For frequencies up to a few tens of megahertz you can make your own "pseudorandom" noise source with a feedback shift register (§8.12.4A), or you can use an off-the-shelf noise source (a function gen-
erator, or noise diode; see §8.12.4) for frequencies well up into the gigahertz range. Resistor Johnson noise itself is the noise source for the "hot-load/cold-load" method, useful for low-noise microwave amplifiers; see eq'n 8.53 in §8.12.3.

#### ПK. Low-noise Design with Op-amps.

See §8.9. Just as with BJTs and FETs, op-amps exhibit input-referred voltage noise $e_{\mathrm{n}}$ and current noise $i_{\mathrm{n}}$, whose magnitudes are characteristic of their input-stage transistor type. What's different, from a circuit designer's point of view, is that you don't have control over the stage's operating current. Instead you choose the op-amp type: FET-input for lowest $i_{\mathrm{n}}$ (for signals of high source impedance), BJTinput for lowest $e_{\mathrm{n}}$ (for signals of low source impedance). Among the FET-input types, the CMOS parts exhibit lower $i_{\mathrm{n}}$ but considerably higher $e_{\mathrm{n}}$, compared with JFET types; the latter thus combine the best (nearly) of both worlds, see $\S 8.9$ the extensive Table 8.3 on page 522ff, and the noise plots in Figures 8.60, 8.61, and 8.63. A helpful graphical tool is the plot of effective noise density $\left(v_{\mathrm{n}}\right)$ versus source resistance, in which the op-amp's noise contributions ( $e_{\mathrm{n}}$, $i_{\mathrm{n}} R_{\mathrm{s}}$ ) are combined and plotted along with the source's Johnson noise, the latter setting a lower noise bound; i.e., $v_{\mathrm{n}}^{2}=4 k T R_{\mathrm{s}}+e_{\mathrm{n}}^{2}+\left(i_{\mathrm{n}} R_{\mathrm{S}}\right)^{2}$, see Figure 8.58. Op-amp noise (with the exception of auto-zero op-amps) exhibits a typical rising $1 / f$ low-frequency tail, characterized by a corner frequency, $f_{\mathrm{c}}$. Auto-zero op-amps have no $1 / f$ tail, but they have considerably higher broadband noise (both $e_{\mathrm{n}}$ and $i_{\mathrm{n}}$ ), along with spectral noise peaks and chopping artifacts. Be sure to evaluate all noise sources in an opamp design: a poor choice of component values may compromise the noise performance (e.g., Johnson noise from high-value resistors).

When choosing an op-amp for a low-noise application, begin by restricting your attention to op-amps that meet your other needs, such as accuracy, speed, power dissipation, supply voltage, input and output swing, and the like. Then choose among this subset, based upon their noise parameters.

#### IL. Low-noise Design with BJTs.

See §8.5. Compared with op-amps, circuit design with discrete transistors gives you more control over noise parameters, but the price you pay is the additional labor associated with details of biasing and the like. A nice compromise is a hybrid approach, with a discrete front-end prepended to an op-amp, see §8.9.5. As with op-amps, a plot of total input noise versus source resistance is a useful graphical tool, see Figure 8.32 in $\S 8.5 .2$, and Figure 8.41. The flexibility you
get from control of operating current is illustrated nicely in Figure 8.33, where the curves shift downward with increasing collector current (lower $e_{\mathrm{n}}$, higher $i_{\mathrm{n}}$ ). Table 8.1a on page 501 lists datasheet and measured noise parameters for an extensive selection of low-noise BJTs; see also measured curves of current gain in Figure 8.39.

#### IM. Low-noise Design with FETs.

See §8.6. You can’t beat FETs for lowest input current noise, and for discrete amplifier circuits (or hybrid frontends) you are limited to JFETs. In terms of device parameters, JFETs with large geometry have lowest $e_{\mathrm{n}}$ and highest $g_{m}$, but the large geometry means higher capacitance and leakage current (thus higher $i_{n}$ ), see Table 8.2 on page 516. If the JFET's input is a summing junction, the product of noise voltage and input capacitance creates a rising noise current $i_{\mathrm{n}}=e_{\mathrm{n}} \omega C_{\mathrm{in}}(\llbracket \mathrm{H}, \mathbb{I N})$. As with BJTs, raising the operating current reduces a JFET's noise voltage, though not dramatically ( $e_{\mathrm{n}} \propto I_{\mathrm{D}}^{-0.25}$ ). Watch out for some chronic problems with many JFETs: loose $I_{\mathrm{DSS}}$ and $V_{\mathrm{GS}(\text { th })}$ specs (a 5:1 range is typical), low transconductance, low output resistance, sharply rising gate current (thus $i_{\mathrm{n}}$ ) at high temperatures and at elevated drain voltages (see §3.2.8), and poor low-frequency noise performance (see Figure 8.52).

#### IN. Noise in Transimpedance Amplifiers.

See §8.11. Transimpedance amplifiers (TIA) convert an input current to an output voltage, with current feedback through a resistor $R_{\mathrm{f}}$ to the input summing junction, as introduced in §4.3.1, and elaborated in $\S 4 x$.3. The noise sources are the amplifier's input $i_{\mathrm{n}}$ and $e_{\mathrm{n}}$, and Johnson noise in $R_{\mathrm{f}}$. Taking these in reverse order, the feedback resistor generates a Johnson noise current of $i_{\mathrm{n}}=\sqrt{4 k T / R_{\mathrm{f}}}$; the amplifier's voltage noise $e_{\mathrm{n}}$ generates through the capacitance at the input a noise current of magnitude $e_{\mathrm{n}} \omega C_{\mathrm{in}}$, and through the feedback resistor a noise current of magnitude $e_{\mathrm{n}} / R_{\mathrm{f}}$; to these must be added the amplifier's own input noise current $i_{\mathrm{n}}$. The choice of $R_{\mathrm{f}}$ is a compromise: the noise terms are minimized by choosing a high resistance, but, because of feedback stability requirements, the bandwidth suffers; see §§8.11.1, 8.11.4-8.11.6, and $4 x .3$. These competing constraints can be mitigated with more complex configurations, used singly or in combination: a composite (2-stage) TIA (\$8.11.8); or the use of a discrete first stage (i.e., a hybrid, §8.11.8A); or reduced capacitance by use of bootstrapping ( 88.11 .9 ) or a cascode connection (\$8.11.10). The noise contribution of the feedback resistor can be eliminated entirely by replacing it with a capacitor (\$8.11.11), forming an integrator; differentiating the output then recovers an output proportional to input current.

Capacitor feedback is used in low-level detectors, and in the technique known as correlated double-sampling.

#### ๆO. Lock-in Amplifiers.

See §8.14. For the detection of slowly-varying signals it is desirable to minimize added noise by narrowing the measurement bandwidth; and because of typical $1 / f$ rising noise at low frequencies, amplification of signals should take place at frequencies above the $1 / f$ corner frequency. In the elegant technique of lock-in detection, the slowlyvarying signal is modulated (typically at a few hundred hertz), amplified, then demodulated with a phase detector, and finally lowpass filtered with a bandwidth appropriate to the original signal; see Figure 8.117.

#### IP. Power-supply Noise.

See $\S 8.15$. All power supplies are not created equal, as stunningly illustrated by the measured spectra of Figure 8.123 . When designing a dc supply, be sure to use a quiet voltage reference, and adhere to good low-noise design practice. Switchmode power supplies are inherently noisy, but attention to current paths and the use of filters can reduce conducted and radiated noise levels. With power supplies of any design, the addition of an outboard capacitance multiplier can reduce noise by 40 dB or more (Figure 8.122). See also the extensive treatment of dc power regulation in Chapter 9.

#### IQ. Shielding and Grounding.

See §8.16. To paraphrase a cliché, ${ }^{151}$ "One man's signal is another man's noise." In the real world, unintentionally coupled signals can easily overwhelm the subtle forms of noise that dominate this chapter. Mitigation techniques include wiring and trace layout (to minimize both capacitive and inductive coupling), raised signal levels, careful attention to grounding (both within and between instruments), shielding, filtering, balanced lines, common-mode chokes, guarding, signal transformers, and isolation amplifiers.

[^462]
# 9. VOLTAGE REGULATION AND POWER CONVERSION

The control and conversion of power - power engineering - is a rich and exciting subfield of electrical engineering and electronic design. It encompasses applications ranging from high-voltage (kilovolts and upward) and highcurrent (kiloamperes and upward) dc transmission, transportation, and pulsing, all the way down to low-power fixed and portable (battery-operated) and micropower (energyharvesting) applications. Perhaps of most interest to us in the context of circuit design; it includes the production of the voltages and currents needed in electronic circuit design.

Nearly all electronic circuits, from simple transistor and op-amp circuits up to elaborate digital and microprocessor systems, require one or more sources of stable dc voltage. The simple transformer-bridge-capacitor unregulated power supplies we discussed in Chapter 1 are not generally adequate because their output voltages change with load current and line voltage, and because they have significant amounts of powerline ripple $(120 \mathrm{~Hz}$ or 100 Hz$)$. Fortunately, it is easy to construct highly stable power supplies, by using negative feedback to compare the dc output voltage with a stable voltage reference. Such regulated supplies are in universal use and can be simply constructed with integrated circuit voltage-regulator chips, requiring only a source of unregulated dc input (from a transformer-rectifier-capacitor combination, ${ }^{1}$ a battery, or some other source of dc input) and a few other components.

In this chapter we will see how to construct voltage regulators by using special-purpose integrated circuits. The same circuit techniques can be used to make regulators with discrete components (transistors, resistors, etc.), but because of the availability of inexpensive highperformance regulator chips, there is usually no advantage to using discrete components in new designs. Voltage regulators get us into the domain of high power dissipation,

[^463]so we will be talking about heatsinking and techniques like "foldback limiting" to limit transistor operating temperatures and prevent circuit damage. These techniques can be used for all sorts of power circuits, including power amplifiers. With the knowledge of regulators we will have at that point, we will be able to go back and discuss the design of the unregulated supply in some detail. In this chapter we will also look at voltage references and voltage-reference ICs, devices with plenty of uses outside of power-supply design (for example in analog-digital conversion).

We begin with the linear regulator, in which feedback controls conduction in a series voltage-dropping "pass transistor" to hold constant the output voltage. Later we treat the important topic of switching regulators, in which one or more transistors are switched rapidly to transfer energy, via an inductor (or capacitor) to the load, again with voltage-regulating feedback. In a nutshell, linear regulators are simpler and generate "cleaner" (i.e., noise-free) dc output; switchers (the nickname for switching regulators and converters) are more compact and efficient (Figure 9.1), but noisier and usually more complex.

It would be wrong to leave the impression that voltage regulators are used exclusively in ac-powered dc supplies. In addition to their use in creating stable dc voltages from the ac powerline, voltage regulators are used widely also to produce additional dc voltages from an existing regulated $d c$ voltage within a circuit: it's common to see, for example, a regulator that accepts an existing +5 V input and generates $\mathrm{a}+2.5 \mathrm{~V}$ or +3.3 V output; this is easily done with a linear regulator, in which feedback controls the voltage drop to maintain constant (and reduced) output voltage. Perhaps more surprising, you can use a switching regulator to convert a given dc input to a larger output voltage, to an output voltage of opposite polarity, or to a constant current (for example, to drive a string of LEDs). These applications are particularly relevant to battery-powered devices. The more general term power converter is often used in such applications, which include also creating an ac output from a dc input.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0628.jpg?height=1105&width=1325&top_left_y=213&top_left_x=383)

Figure 9.1. Switching power supplies ("switchers") are smaller and more efficient than traditional linear regulated power supplies, but the switching operation generates some unavoidable electrical noise.

## 9.1 Tutorial: from zener to series-pass linear regulator

To get started, let's look at the circuits in Figure 9.2. Recall that a zener diode is a voltage regulator, of sorts: it draws negligible current until the voltage across it is brought close to its zener voltage $V_{\mathrm{Z}}$, at which point the current rises abruptly (look back at Figure 1.15 for a reminder). So a zener (or 2-terminal zener-like reference IC, see §9.10.2) biased through a resistor from a dc voltage greater than $V_{Z}$, as in Figure 9.2A, will have approximately $V_{\mathrm{Z}}$ across it, with the current set by the resistor: ${ }^{2} I_{\text {zener }}=\left(V_{+}-V_{Z}\right) / R$. You can connect a load to this relatively stable output voltage; then, as long as the load draws less than $I_{\text {zener }}$ (as just calculated), there will be some remaining zener current, and the output voltage will change little.

[^464]The simple resistor-plus-zener is occasionally useful as is, but it has numerous drawbacks: (a) you cannot easily change (or even choose precisely) the output voltage; (b) the zener voltage (which is also the output voltage) changes somewhat with zener current; so it will change with variations in $V_{+}$and with variations in load current; ${ }^{3}$ (c) you've got to set the zener current (by choice of $R$ ) large enough so that there's still some zener current at maximum load; this means that the $V_{+}$dc supply is running at full current all the time, generating as much heat as the maximum anticipated load; (d) to accommodate large load currents ${ }^{4}$ you would need a high-power zener; these are hard to find, and rarely used, precisely because there are much better ways to make a regulator, as we'll see.

Exercise 9.1. Try this out, to get a sense of the problems with

[^465]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0629.jpg?height=1287&width=1504&top_left_y=211&top_left_x=192)

Figure 9.2. Evolving the (discrete-component) series-pass linear voltage regulator.
this simple regulator circuit: imagine we want a stable +5 V dc output, to power a load that can draw from zero to 1 A . We've built an unregulated dc supply (using a transformer, diode bridge, and capacitor) that puts out approximately +12 V when unloaded, dropping to +9 V at 1 A load. Those voltages are "nominal" and can vary $\pm 10 \%$.
(a) What is the correct resistor value, $R$, for the circuit of Figure 9.2 A , such that the minimum zener current, under "worstcase" conditions, is 50 mA ?
(b) What is worst-case (maximum) power dissipation in $R$ and in the zener?

Contrasted with this approach - with its requirement for a 10 W zener at the desired output voltage, and nearly 10 W of power dissipation in each component, even at zero loadwe'll see that it is a routine task to make a regulated power supply, with adjustable output voltage, without the need for
a power zener and with $75 \%$ or better efficiency over most of the load-current range.

### 9.1.1 Adding feedback

We could improve the situation somewhat by tacking an emitter follower onto a zener (Figure 9.2B); that lets you run at lower zener current, and low quiescent dissipation when unloaded. But the output regulation is still poor (because $V_{\mathrm{BE}}$ varies with output current), and the circuit still does not allow adjustment of output voltage.

The solution is to use a zener (or other voltage reference device; see $\S 9.10 .2$ ) as a low-current voltage reference, against which we compare the output. Let's take it in a few easy steps.

#### A. Zener plus "amplifier"

First we solve the problem of adjustability by following the zener reference with a simple dc amplifier (Figure 9.2C). Now the zener current can be small, just enough to ensure a stable reference. For typical zeners this might be a few milliamps, whereas for an IC voltage reference, $0.1-1 \mathrm{~mA}$ will usually suffice. This circuit lets you adjust the output voltage: $V_{\text {out }}=V_{\mathrm{Z}}\left(1+R_{2} / R_{3}\right)$. But note that you are limited to having $V_{\text {out }} \geq V_{Z}$; note also that the output voltage comes from an op-amp, so it can at most reach $V_{+}$, with an output current limited by the op-amp's $I_{\text {out }}$ (max), typically 20 mA . We will overcome both these limits.

#### B. Adding outboard pass transistor

More output current is easy - just add an $n p n$ follower, to boost the output current by a factor of $\beta$. You might be tempted to just hang the follower on the op-amp's output, but that would be a mistake: the output voltage would be down by a $V_{\mathrm{BE}}$ drop, roughly 0.6 V . You could, of course, adjust the ratio $R_{2} / R_{3}$ to compensate. But the $V_{\mathrm{BE}}$ drop is imprecise, varying both with temperature and with load current, and so the output voltage would vary accordingly. The better way is to close the feedback loop around the pass transistor, as in Figure 9.2D; that way the error amplifier sees the actual output voltage, holding it stable via the circuit's loop gain. The inclusion of the output emitter follower boosts the op-amp's $I_{\text {out }}(\max )$ by the beta of $Q_{1}$, giving us an available output current of an ampere or so. (We could use a Darlington, instead, for more current; another possibility is an $n$-channel MOSFET.) $Q_{1}$ will be dissipating $5-10 \mathrm{~W}$ at maximum output current, so you'll need a heatsink (more on this in §9.4.1). And, as we'll see next, you'll also need to add a compensation capacitor $C_{\mathrm{C}}$ to ensure stability.

#### C. Some important additions

Our voltage regulator circuit is nearly complete, but lacks a couple of essential features, related to loop stability and overcurrent protection.

#### Feedback loop stability

Regulated power supplies are used to power electronic circuits, typically festooned with many bypass capacitors between the dc rails and ground. (Those bypass capacitors, of course, are needed to maintain a pleasantly low impedance at all signal frequencies.) Thus the dc supply sees a large capacitive load, which, when combined with the finite output resistance of the pass transistor (and overcurrent sense resistor, if present), causes a lagging phase shift and possible oscillation. We've shown the load capacitance in Fig-
ure 9.2D as $C_{\text {bypass }}$, a portion of which might be included explicitly (as a real capacitor) in the power supply itself.

The solution here, as with the op-amp circuits we worried about earlier (\$4.9), is to include some form of frequency compensation. That is most simply done (as it is within op-amps) with a Miller feedback capacitor $C_{\mathrm{C}}$ around the inverting gain stage, as shown. Typical values are $100-1000 \mathrm{pF}$, usually found experimentally ("cut-and-try") by increasing $C_{\mathrm{C}}$ until the output shows a welldamped response to a step change in load (and then doubling that, to provide a good margin of stability). The IC regulators we'll see later will either include internal compensation, or they'll give you suggested values for compensation components.

#### Overcurrent protection

The circuit as drawn in Figure 9.2D does not deal well with a short-circuit load condition. ${ }^{5}$ With the output shorted to ground, feedback will act to force the op-amp's maximum output current into the pass transistor's base; so that $I_{B}$ of $20-40 \mathrm{~mA}$ will be multiplied by $Q_{1}$ 's beta (which might range from 50 to 250 , say), to produce an output current of 1 A to 10 A . Assuming the unregulated $V_{+}$input can supply it, such a current will cause excessive heating in the pass transistor, as well as interesting forms of damage to the misbehaving load.

The solution is to include some form of overcurrent protection, most simply the classic current-limiting circuit consisting of $Q_{2}$ and $R_{\mathrm{CL}}$ in Figure 9.2E. Here $R_{\mathrm{CL}}$ is a low-value sense resistor, chosen to drop approximately 0.6 V (a $V_{\mathrm{BE}}$ diode drop) at a current somewhat larger than the maximum rated current; for example, we might choose $R_{\mathrm{CL}}=5 \Omega$ in a 100 mA supply. The drop across $R_{\mathrm{CL}}$ is applied across $Q_{2}$ 's base-emitter, turning it on at the desired maximum output current; $Q_{2}$ 's conduction robs base current from $Q_{1}$, preventing further increase of output current. Note that the current-limit sense transistor $Q_{2}$ does not handle high voltage, high current, or high power; it sees at most two diode drops from collector to emitter, the op-amp's maximum output current, and the product of those two, respectively. During an overcurrent load condition, then, it typically would have to handle $V_{\mathrm{CE}} \leq 1.5 \mathrm{~V}$ at $I_{\mathrm{C}} \leq 40 \mathrm{~mA}$, or 60 mW ; that's peanuts for any general-purpose smallsignal transistor.

Later we'll see variations on this simple overcurrent protection theme, including methods that limit to an

[^466]adjustable and stable current limit, and the technique known as foldback current limiting (§9.13.3).

#### Zener bias; overvoltage crowbar

We've shown two additional wrinkles in Figure 9.2E. First, we split the zener biasing resistor $R_{1}$ and bypassed the midpoint, to filter out ripple current. By choosing the time constant $\left(\tau=\left(R_{1 \mathrm{a}} \| R_{1 \mathrm{~b}}\right) C_{1}\right)$ to be long compared with the ripple period of 8.3 ms , the zener sees ripple-free bias current. (You wouldn't bother with this if the dc supply $V_{+}$were already free of ripple, for example a regulated dc supply of higher voltage.) Alternatively, you could use a current source to bias the zener.

Second, we've shown an "overvoltage crowbar" protection circuit consisting of $D_{1}, Q_{3}$, and the $100 \Omega$ resistor. Its function is to short the output if some circuit fault causes the output voltage to exceed about 6.2 V (this can happen easily enough, for example if the pass transistor $Q_{1}$ fails by having a collector-to-emitter short, or if a humble component like resistor $R_{2}$ becomes open-circuited.). $Q_{3}$ is an SCR (silicon-controlled rectifier), a device that is normally nonconducting but that goes into saturation when the gatecathode junction is forward-biased. Once turned on, it will not turn off again until anode current is removed externally. In this case, gate current flows when the output exceeds $D_{1}$ 's zener voltage plus a diode drop. When that happens, the regulator will go into a current-limiting condition, with the output held near ground by the SCR. If the failure that produces the abnormally high output also disables the current-limiting circuit (e.g., a collector-to-emitter short in $Q_{1}$ ), then the crowbar will sink a very large current. For this reason it is a good idea to include a fuse somewhere in the power supply, as shown for example in Figure 9.48. We will treat overvoltage crowbar circuits in more detail in §§9.13.1 and 9x.7.

Exercise 9.2. Explain how an open circuit at $R_{2}$ causes the output to soar. What voltage, approximately, would then appear at the output?

## 9.2 Basic linear regulator circuits with the classic 723

In the preceding tutorial we evolved the basic form of the linear series pass regulator: voltage reference, pass transistor, error amplifier, and provisions for loop stability and overvoltage-overcurrent protection. In practice you seldom need to assemble these components from scratch - they are available as complete integrated circuits. One broad class of IC linear regulators might be thought of as flexible kits

- they contain all the pieces, but you've got to hook up a few external components (including the pass transistor) to make them work; an example is the classic 723 regulator. The other class of regulator ICs are complete, with builtin pass transistor and overload protection, and requiring at most one or two external parts; an example is the classic 78L05 "3-terminal" regulator - its three terminals are labeled input, output, and ground (and that's how easy it is to use!).


### 9.2.1 The $\mathbf{7 2 3}$ regulator

The $\mu \mathrm{A} 723$ voltage regulator is a classic. Designed by Bob Widlar and first introduced in 1967, it is a flexible, easy-touse regulator with excellent performance. ${ }^{6}$ Although you might not choose it for a new design nowadays, it is worth looking at in some detail, because more recent regulators work on the same principles. Its block diagram is shown in Figure 9.3. As you can see, it is really a power-supply kit, containing a temperature-compensated voltage reference ( $7.15 \mathrm{~V} \pm 5 \%$ ), differential amplifier, series pass transistor, and current-limiting protective circuit. As it comes, the 723 doesn't regulate anything. You have to hook up an external circuit to make it do what you want.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0631.jpg?height=555&width=615&top_left_y=1238&top_left_x=1065)

Figure 9.3. The classic $\mu \mathrm{A} 723$ voltage regulator.
The 723's internal npn pass transistor is limited to
${ }^{6}$ Building on the 723's success, other manufacturers introduced "improved" versions, such as the LAS1000, LAS1100, SG3532, and MC1469. However, while the 723 lives on, the improved versions are all gone! The 723 is "good enough," very inexpensive (about $\$ 0.15$ in quantity), and is popular in many commercial linear power supplies, where the easily adjusted current limit is especially useful. It also has less noise than most modern replacements. And we like it for its pedagogic value.

150 mA , and it can dissipate about 0.5 W maximum. Unlike newer regulators, the 723 does not incorporate internal shutdown circuitry to protect against excessive load current or chip dissipation.

#### A. 723 regulator example: $\boldsymbol{V}_{\text {out }}>\boldsymbol{V}_{\text {ref }}$

Figure 9.4 shows how to make a positive voltage regulator with the 723 for output voltages greater than the reference voltage; it is the same circuit topology as the tutorial's Figure 9.2E. All the components except the three resistors and the two capacitors are contained in the 723. With this circuit, a regulated supply with output voltage ranging from $V_{\text {ref }}$ up to the maximum allowable output voltage ( 37 V ) can be made. Of course, the input voltage must stay a few volts more positive than the output at all times, including the effects of ripple on the unregulated supply. The "dropout voltage" (the amount by which the input voltage must exceed the regulated output voltage) is specified as 3 volts (minimum) for the 723 . This is a bit large by contemporary standards, where the dropout voltage is typically 2 V , and much less for low dropout (LDO) regulators, as we'll see in §9.3.6. Note also that the 723's relatively high reference voltage means that you cannot use it in a power supply whose unregulated dc input is less than +9.5 V , its specified minimum $V_{+}$; this shortcoming is remedied in a large selection of regulators that use a lowervoltage bandgap reference ( 1.25 V or 2.5 V ). And while we're complaining, we note that the reference is not exactly sterling in its initial accuracy - the production spread in $V_{\text {ref }}$ is 6.8 to 7.5 volts - which means that you must provide for output-voltage trimming, by making $R_{1}$ or $R_{2}$ adjustable; we'll soon see regulators with excellent initial accuracy, for which no trim is needed.

It is usually a good idea to put a capacitor of a few microfarads across the output, as shown. This keeps the output impedance low even at high frequencies, where the feedback becomes less effective. It is best to use the output capacitor value recommended on the specification sheet, to ensure stability against oscillations. In general, it is a good idea to bypass power-supply leads to ground liberally throughout a circuit, using a combination of ceramic types $(0.01-0.1 \mu \mathrm{~F}$ ) and electrolytic or tantalum types (1$10 \mu \mathrm{~F}){ }^{7}$

[^467]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0632.jpg?height=718&width=792&top_left_y=220&top_left_x=1045)

Figure 9.4. 723 regulator: configuration for $V_{\text {out }}>V_{\text {ref }}$, with 100 mA current limit.

#### B. $\mathbf{7 2 3}$ regulator example: $\boldsymbol{V}_{\text {out }}<V_{\text {ref }}$

For output voltages less than $V_{\text {ref }}$, you just put the voltage divider on the reference (Figure 9.5). Now the full output voltage is compared with a fraction of the reference. The values shown are for a +5 V output. With this circuit configuration, output voltages from +2 V to $V_{\text {ref }}$ can be produced. The output cannot be adjusted down to zero volts because the differential amplifier will not operate below 2 volts input, as specified on the datasheet. Note again that the unregulated input voltage must never drop below +9.5 V , the voltage necessary to power the reference.

For this example we've added an external pass transistor, in a Darlington configuration with the 723's small internal pass transistor, to get beyond the latter's 150 mA current limit. An external transistor is needed, also, because of power dissipation: the 723 is rated at 1 watt at $25^{\circ} \mathrm{C}$ (less at higher ambient temperatures; the 723 must be "derated" at $8.3 \mathrm{~mW} /{ }^{\circ} \mathrm{C}$ above $25^{\circ} \mathrm{C}$ in order to keep the junction temperature within safe limits). Thus, for instance, a 5 volt regulator with +15 V input cannot deliver more than about 80 mA to the load. Here the external power transistor $Q_{1}$ will dissipate 14 W for $V_{\mathrm{in}}=12 \mathrm{~V}$ and maximum load current ( 2 A ); that requires a heatsink, most often a finned metal plate designed to carry off heat (alternatively, the transistor can be mounted to one wall of the metal chassis housing the power supply). We will deal with thermal problems like these later in the chapter. ${ }^{8}$ A trimmer

[^468]potentiometer has been used so that the output can be set accurately to +5 V ; its range of adjustment should be sufficient to allow for resistor tolerances as well as the maximum specified spread in $V_{\text {ref }}$ (this is an example of worstcase design), and in this case it allows about $\pm 1$ volt adjustment from the nominal output voltage. Note the lowresistance high-power current-limiting resistor necessary for a 2 amp supply.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0633.jpg?height=644&width=782&top_left_y=584&top_left_x=137)

Figure 9.5. 723 regulator: configuration for $V_{\text {out }}<V_{\text {ref }}$, with 2 A current limit.

A third variation of this circuit is necessary if you want a regulator that is continuously adjustable through a range of output voltages around $V_{\text {ref }}$. In such cases, just compare a divided fraction of the output with a fraction of $V_{\text {ref }}$ chosen to be less than the minimum output voltage desired.

Exercise 9.3. Design a regulator to deliver up to 50 mA load current over an output voltage range of +5 V to +10 V using a 723 . Hint: compare a fraction of the output voltage with $0.5 V_{\text {ref }}$.

#### C. Pass-transistor dropout voltage

One problem with this circuit is the high power dissipation in the pass transistor (at least 10 W at full load current). This is unavoidable if the regulator chip is powered by the unregulated input, since it needs a few volts of "headroom" to operate (specified by the dropout voltage). With the use of a separate low-current supply for the 723 (e.g., +12 V ), the minimum unregulated input to the external pass transistor can be as little as 1.5 V or so above the regulated output voltage (i.e., two $\left.V_{\mathrm{BE}}{ }^{\prime} \mathrm{s}\right) .{ }^{9}$

[^469]
### 9.2.2 In defense of the beleaguered 723

Lest we leave the wrong impression, we hasten to remark that rumors of the death of the vintage 723 regulator are greatly exaggerated. ${ }^{10}$ We have been using dozens of linear regulated power supplies manufactured by Power One for more than three decades without a single failure. All of them use the humble 723 regulator chip, as do other OEMs ("original equipment manufacturers"). Here are some reasons not to overlook this remarkable design of the legendary Bob Widlar:

- very low cost, \$0.17 (in qty 1000)
- many, many manufacturers
- fully settable current limit, including foldback
- good for pedagogy (that's why it's here!)
- the power dissipation is not in the control IC
- quiet voltage reference, plus can add filter
- works with npn or pnp pass transistors
- easily configured for negative outputs


## 9.3 Fully integrated linear regulators

The overall regulator circuit of Figure 9.5 has ten components, but only three terminals (IN, OUT, and GROUND), thus suggesting the possibility of an integrated solution, with on-chip voltage-setting resistors and with integrated components for current-limiting and loop compensation a 3 -terminal regulator. The 723 is approaching half-century vintage (though still going strong!), during which the semiconductor industry has not been sleeping: contemporary linear regulator ICs generally integrate all regulator functions on-chip, including overcurrent and thermal protection, loop compensation, high-current pass transistor, and preset voltage divider for commonly used output voltages. Most of these regulators come also in adjustable versions, for which you provide only the voltage-setting resistor pair. And, with an additional terminal or two, you can get a "shutdown" control input and a "power-good" status output. Finally, a large and growing population of low-dropout regulators addresses low voltage applications, of increasing importance in low-power and portable electronic devices. Let's look at the choices favored for contemporary design.

[^470]
### 9.3.1 Taxonomy of linear regulator ICs

As a guide to the following sections, we've organized the universe of integrated linear voltage regulators into a few distinct categories, here simply listed in outline form. For each category we've listed typical example part numbers of devices that we are fond of, and use often. Read on for explanations of when and how to use them, a description of their distinguishing features, and some important cautions.

#### 3-terminal fixed

pos: 78 xx
neg: 79xx

#### 3-terminal adjustable

pos: LM317
neg: LM337

#### 3-term 'lower dropout" (adj \& fixed)

pos: LM1117, LT1083-85

## 3-term fixed \& 4-term adj "true LDO"

pos: LT1764A/LT1963 (BJT); TPS744xx (CMOS) neg: LT1175, LM2991 (BJT); TPS7A3xxx (CMOS)

#### 3-term current reference

pos: LT3080

### 9.3.2 Three-terminal fixed regulators

The original (and often good enough) 3-terminal regulator is the 78 xx series (Figure 9.6), originated by Fairchild in the early 1970s. ${ }^{11}$ It is factory trimmed to provide a fixed output, in which the voltage is specified by the last two digits of the part number, and can be any of the following: $05,06,08,09,10,12,15,18$, or 24 . These regulators can supply up to 1 A of output current, and come in power packages (TO-220, DPAK, ${ }^{2}$ PAK) that you attach to a heatsink or to an area of circuit-board copper. If you don't need much current, use the 78Lxx/LM340Lxx series, which come in small transistor packages, either surface-mount or TO-92 (through-hole). For negative output voltage use the 79xx/79Lxx (or LM320/320L) series. Figures 9.6 and 9.7 show, in simplified form, what's inside these inexpensive ( $\$ 0.30$ ) regulators.

Figure 9.8 shows how easy it is to make a +5 V regulator, for example, with one of these ICs. Here we've added also a 7905 negative regulator to create a -5 V regulated output from a more negative unregulated dc input. The bypass capacitors at the outputs ensure stability; they

[^471]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0634.jpg?height=611&width=776&top_left_y=202&top_left_x=1084)

Figure 9.6. Simplified 78xx fixed 3-terminal positive voltage regulator. All components are internal, so only a pair of bypass capacitors is required (as in Figure 9.8). $R_{\mathrm{CL}}$, the current-sensing resistor, is $0.2 \Omega$, and develops somewhat less than a diode drop at full current; its drop is supplemented by an internal bias $\Delta V_{\mathrm{CL}}$, to turn on current-limiting transistor $Q_{3}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0634.jpg?height=580&width=736&top_left_y=1072&top_left_x=1117)

Figure 9.7. 79xx fixed 3-terminal negative voltage regulator.
also improve transient response, and maintain a low output impedance at high frequencies (where the regulator's loop gain is low). ${ }^{12}$ The input bypass capacitors are also needed

[^472]for stability; the values shown are the minimum suggested in the datasheets. However, if the input supply or output load is bypassed close to the regulator, the corresponding capacitors can be omitted.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0635.jpg?height=588&width=760&top_left_y=420&top_left_x=143)

Figure 9.8. $\pm 5 \mathrm{~V}$ regulated dc from a 7805/7905 regulator pair.

This regulator example includes a pair of reverseprotection Schottky (low-forward-drop) diodes, always a good idea when you have supplies of both polarities powering a circuit. Without the diodes, one of the supplies can bring the other into reverse output voltage, via the load; this reversed supply polarity can cause failure in the load (from transistors or ICs that are subjected to reverse supply voltage), or in the regulator (which may even go into a latchup condition). You often see the diodes omitted; don't get into this lazy habit!

These regulators have on-chip circuitry to prevent damage in the event of overheating or excessive load current; the chip simply shuts down, rather than blowing out. In addition, on-chip circuitry prevents operation outside the transistor safe operating area (see §9.4.2) by reducing available output current for large input-output voltage differentials. These regulators are inexpensive and easy to use, and they make it practical to design a system with many printed circuit boards (PCBs) in which the unregulated dc is brought to each board and regulation is done locally on each circuit card. Table 9.1 lists the characteristics of a representative selection of 3-terminal fixed regulators.

Three-terminal fixed regulators come in some highly useful variants. There are low-power and micropower versions (e.g., the LM2936 and LM2950, with quiescent current in the microampere range), and there are the very popular LDO regulators, which maintain regulation with only a few tenths of a volt input-output differential (e.g., the LT1764A, TPS755xx, and micropower LM2936, with typ-
ical dropout voltages $\approx 0.25 \mathrm{~V}$ ). We'll discuss LDOs after taking a look at the very useful 3-terminal adjustable regulator.

| Table 9.1 7800-Style Fixed Regulators ${ }^{\text {a }}$ |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# ${ }^{\text {C }}$ | $V_{\text {in }}$ max (V) | $V_{\text {out }}^{\mathrm{d}}$ nom <br> (V) | Tol $( \pm \%)$ | $I_{Q}$ typ (mA) | Iout max (A) | Cost qty 25 (\$US) |
| 78L05 | 35 | 5 | 5 | 3 | 0.1 | 0.29 |
| 78L15 | 35 | 15 | 4 | 3 | 0.1 | 0.31 |
| 7805 | 35 | 5 | $4^{\text {b }}$ | $5^{\text {e }}$ | 1.0 | 0.47 |
| 7824 | 40 | 24 | $4^{\text {b }}$ | 5 | 1.0 | 0.49 |
| 79 L05 | -35 | -5 | 5 | 2 | 0.1 | 0.30 |
| 79 L15 | -35 | -15 | 4 | 2 | 0.1 | 0.30 |
| 7905 | -35 | -5 | $4^{\text {b }}$ | 3 | 1.0 | 0.47 |
| 7924 | -40 | -24 | $4^{\text {b }}$ | 4 | 1.0 | 0.56 |

Notes: (a) often called '7800 and '7900 series, e.g., "LM7800-series." L series available in TO-92, SO-8 and SOT-89 packages; regular series available in TO-220, DPAK, D2PAK, and TO-3. Some use buried-zener ref, some use bandgap. (b) A-suffix types are $\pm 2 \%$ tol. (c) prefixes: UA, LM, MC, KA, NCP, L, NJM, etc.
(d) L-series: 2.6 to 24 V , regular: 5 to 24 V .
(e) some lower, 3.3 mA to 4 mA

### 9.3.3 Three-terminal adjustable regulators

Sometimes you want a nonstandard regulated voltage (say +9 V , to emulate a battery) and can't use a 78xx-type fixed regulator. Or perhaps you want a standard voltage, but set more accurately than the $\pm 3 \%$ accuracy typical of fixed regulators. By now you're spoiled by the simplicity of 3terminal fixed regulators, and therefore you can't imagine using a 723-type regulator circuit, with all its required external components. What to do? Get an "adjustable 3terminal regulator"!

These convenient ICs are typified by the classic LM317 originally from National (Figure 9.9). This regulator has no ground terminal; instead, it adjusts $V_{\text {out }}$ to maintain a constant 1.25 V (internal "bandgap" reference, §9.10.2) from the output terminal to the "adjustment" terminal. Figure 9.10 shows the easiest way to use it. The regulator puts 1.25 V across $R_{1}$, so 10 mA flows through it. The adjustment terminal draws very little current (50-100 $\mu \mathrm{A}$ ), so the output voltage is just

$$
V_{\text {out }}=1.25\left(1+R_{2} / R_{1}\right) \text { volts. }
$$

In this case the output voltage is +3.3 V , with an untrimmed accuracy of $\approx 3 \%$ (from the $\pm 2 \%$ internal 1.25 V reference and the $1 \%$ resistors). If you want accurate settability,
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0636.jpg?height=509&width=670&top_left_y=184&top_left_x=285)

Figure 9.9. LM317 three-terminal adjustable positive voltage regulator.
replace the lower resistor with a $25 \Omega$ trimmer in series with a $191 \Omega$ fixed resistor, to narrow the trimmer's adjustment range to $\pm 6 \%$. If you want instead a wide adjustment range, you could replace the lower resistor with a 2.5 k trimmer, for an output range of +1.25 V to +20 V . Whatever the output voltage, the input must be at least 2 V higher (the dropout voltage).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0636.jpg?height=351&width=683&top_left_y=1156&top_left_x=281)

Figure 9.10. +3.3 V positive regulator circuit.
When using this type of regulator, choose your resistive divider values small enough to allow for a $5 \mu \mathrm{~A}$ change in adjustment pin current with temperature: many designers use $124 \Omega$ for the upper resistor, as we've done, so that the divider alone sinks the chip's specified minimum load current of 10 mA . Note also that the current sourced out of the adjustment pin may be as large as $100 \mu \mathrm{~A}$ (the worst-case $\mathrm{spec})$. The output capacitor, though not necessary for stability, greatly improves transient response. It's a good idea to use at least $1 \mu \mathrm{~F}$, and ideally something more like $6.8 \mu \mathrm{~F}$.

The LM317 is available in many package styles, including the plastic power package (TO-220), the surface-mount power package (DPAK and $\mathrm{D}^{2} \mathrm{PAK}$ ), and many small transistor packages (both through-hole TO-92, and a half dozen tiny surface-mount styles). In the power packages it can deliver up to 1.5 amps , with proper heatsinking; the lowpower variant $(317 \mathrm{~L})$ is rated to 100 mA , again limited by
power dissipation. The popular LM1117 variant, also available from multiple manufacturers, improves on the dropout voltage of the classic 317 ( 1.2 V versus 2.5 V ), but you pay a price (literally): in the TO-220 package it costs about $\$ 0.75$ versus the 317 's $\$ 0.20$; it also has a more limited voltage range (see Table 9.2), and, in common with many low-dropout regulators, it requires a larger output capacitor (10 $\mu \mathrm{F}$ minimum).

Exercise 9.4. Design a +5 V regulator with the 317 . Provide $\pm 20 \%$ voltage adjustment range with a trimmer pot.

Three-terminal adjustable regulators are available with higher current ratings, e.g., the LM350 (3A), the LM338 (5A), and the LM396 (10A), and also with higher voltage ratings, e.g., the LM317H (60V) and the TL783 (125V). We've listed their properties in Table 9.2 on page 605 . Read the datasheets carefully before using these parts, noting bypass capacitor requirements and safety diode suggestions. Note also that the rated maximum output currents generally apply at lower values of $V_{\text {in }}-V_{\text {out }}$, and can drop to as little as $20 \%$ of their maximum values as $V_{\text {in }}-V_{\text {out }}$ approaches $V_{\text {in(max) }}$; the maximum output current drops also with increasing temperature. ${ }^{13}$

An alternative for high load currents is to add an outboard transistor (§9.13.4), though a high-current switching regulator (§9.6) is often a better choice. The LM317 family regulators are "conventional" (as opposed to low-dropout) linear regulators; typical dropout voltages are $\approx 2 \mathrm{~V}$.

As with the fixed 3-terminal regulators, you can get lower-dropout versions (e.g., the popular LM1117, with 1.3 V maximum dropout at 0.8 A , or the heftier LT108385 series, with comparable dropout at currents to 7.5 A ), and you can get micropower versions (e.g., the LP2951, the adjustable variant of the fixed 5V LP2950; both have $I_{\mathrm{Q}}=75 \mu \mathrm{~A}$ ); see Figure 9.11. You can also get negative versions, though there's less variety: the LM337 (Figure 9.12) is the negative cousin of the LM317 (1.5 A), and the LM333 is a negative LM350 (3 A). There's more discussion ahead in $\S \S 9.3 .6$ and 9.3.9; see particularly Figure 9.24.
${ }^{13}$ As discussed later in §9.4.1, the junction temperature $T_{\mathrm{J}}=P_{\mathrm{diss}}\left(R_{\Theta \mathrm{JC}}+R_{\Theta \mathrm{CS}}+R_{\Theta \mathrm{SA}}\right)+T_{\mathrm{A}}$, where the $R_{\Theta}$ are the thermal resistances from junction to case, case to heatsink, and heatsink to ambient. In situations with good heatsinking, you may choose to use a regulator of higher current rating and larger package style (e.g., the LM338K in its TO-3 metal can package) in order to take advantage of the much lower thermal resistance $R_{\text {JJC }}\left(1^{\circ} \mathrm{C} / \mathrm{W}\right.$ versus $4^{\circ} \mathrm{C} / \mathrm{W}$ for the LM317T in its TO-220 package). The larger parts also offer more relaxed safe-operating-area (SOA) constraints, e.g., at $V_{\text {in }}-V_{\text {out }}=20 \mathrm{~V}$ the LM338 allows 3.5 A of output current, versus 1.4 A for the LM317.

#### Anatomy of a 317

The classic LM317, designed around 1970 by the legendary team of Widlar and Dobkin ${ }^{14}$ has endured for more than four decades. Indeed, the generic 317 (along with the complementary LM337) has become the go-to part for linear regulators of modest current capability (to $\sim 1 \mathrm{~A}$ ) in situations where you've got a few volts of headroom. And it has spawned a host of imitators and lookalikes, spanning a range of voltages, currents, and package styles, with some variants of lower dropout-voltage; see Table 9.2.

Its design exhibits a nice elegance, for example by combining the functions of error amplifier and zerotempco bandgap reference. It was also one of the first regulators to include thermal overload and safe-area protection. Figure 9.13 is a simplified circuit of its essential innards, with part designations following the schematic diagram in the National Semiconductor (TI) datasheet.

The transistor pair $Q_{17}$ and $Q_{19}$ forms the bandgap voltage reference, operating at equal currents from the $Q_{16} Q_{18}$ mirror. Because $Q_{19}$ has $10 \times$ larger emitter area (or 10 emitters), it operates at $1 / 10$ the current density of $Q_{17}$, thus a $V_{\mathrm{BE}}$ that is smaller by $(k T / q) \log _{e} 10$, about 60 mV ( $\S 2 x .3 .2$ ). That sets its current (via $R_{15}$ ) to be $I_{\mathrm{Q} 19}=\Delta V_{\mathrm{BE}} / R_{15}=25 \mu \mathrm{~A}$, and thus the pair's total current is $50 \mu \mathrm{~A} .{ }^{15}$ Note that the current has a linear dependence on absolute temperature (because the drop across $R_{15}$ is $\propto T_{\text {abs }}$ ) - it is "PTAT" (proportional to absolute temperature).

Now for the classic "bandgap reference" temperature compensation: the positive tempco of current is exploited to cancel $Q_{17}$ 's negative tempco of $V_{\mathrm{BE}}$, which is nomi-
nally about 600 mV and goes as $1 / T_{\mathrm{abs}}$, or $-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ (§2.3.2). Cancellation occurs when $R_{14}$ is chosen to drop a comparable 600 mV at the nominal $50 \mu \mathrm{~A}$, thus a $+2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ tempco - voilà: zero tempco at a reference voltage of $\sim 1.2 \mathrm{~V}$ (the extrapolated bandgap energy of silicon).

The bandgap reference is also the error amplifier: $Q_{17}$ 's collector sees a high-impedance (current-source) load, buffered by three stages of emitter follower (in the full schematic there are five) to the output pin; so even with its relatively low transconductance ( $g_{m} \sim 1 / R_{14}$ ) there's plenty of loop gain in the error amplifier (whose input is the ADJ pin, offset by $V_{\text {ref }}$, relative to $V_{\text {out }}$ ).

Resistor $R_{26}$ senses the output current, for current limiting via $Q_{21}$. A bias that depends on $V_{\text {in }}-V_{\text {out }}$ is added (the battery symbol), for safe-operating-area protection. Additional components add hysteretic overtemperature shutdown ( $Q_{21}$ is paired with a pnp to make a latch). One final note: the Widlar-Dobkin duo also created the LM395 and LP395 protected-transistor ICs; these include the current and thermal limiting from the 317 , but without the bandgap reference. They call it, modestly, the "Ultra-Reliable Power Transistor." The '395 transistor's base is the base of the pnp transistor $Q_{15}$ in Figure 9.13. This yields a roughly 800 mV base-to-emitter voltage, with a $3 \mu \mathrm{~A}$ pullup base current. It's a great idea, but an LM395T costs about \$2.50, whereas an LM317T costs about $\$ 0.50$. So we use the ' 317 as our "pretty reliable power transistor," with its -1.2 V base-to-emitter voltage and $50 \mu \mathrm{~A}$ pullup base current, as for example in Figures 9.16 and 9.18.

### 9.3.4 317-style regulator: application hints

The LM317-style adjustable 3-terminal regulators are delightfully easy to use, and there are some nice tricks you can use to make them do more than simply create a fixed dc output voltage. There are also some basic cautions to keep in mind. In Figure 9.14 we've sketched some helpful circuit ideas.

[^473]Herewith a quick tour (keyed to the figure parts), taking them in order.
A: The regulator requires some minimum load current, because the operating current for the internal circuitry returns through the load. So if you want it to work clear down to zero external load, you should choose the upper feedback resistor $R_{1}$ small enough, i.e., so that $V_{\text {ref }} / R_{1} \geq I_{\text {out(min) }}$ for the worst-case (maximum) value of $I_{\text {out }(\mathrm{min})}$. For $V_{\text {ref }}=1.25 \mathrm{~V}$ and the classic LM317's $I_{\text {out }(\mathrm{min})}=10 \mathrm{~mA}, R_{1}$ should be no larger than $125 \Omega .{ }^{16}$ Of course, you could instead use a larger value of $R_{1}$ and add a load resistor to

[^474]Table 9.2. 3-Terminal Adjustable Voltage Regulators ("LM317-style") ${ }^{a}$

| Part \# | Packages ${ }^{z}$ | $v_{\text {in }}$ max <br> (V) | $I_{\text {out }}^{V}$ max (A) | $v_{\text {DO }}^{\mathrm{h}}$ max <br> (V) | Iout <br> $\min ^{b}$ <br> (mA) | Cout min $(\mu \mathrm{F})$ |  |  | Iadj typ $(\mu A)$ | Temp stab $^{c}$ typ (\%) | Ripple reject <br> 120Hz typ (dB) | Regulation |  | Cost qty 25 <br> (\$US) | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | M |  |  |  |  |  | Vref |  |  |  |  |  |  |  |  |
|  | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0638.jpg?height=112&width=207&top_left_y=404&top_left_x=374) |  |  |  |  |  |  |  | Line typ <br> (\%) |  |  | Load $^{e}$ typ (\%) |  |  |
| Positive |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LM317L | - $\cdot$ - - | 40 | 0.1 | $2.5^{\text {t }}$ | 5 | 0.1 | 1.25 | 4 |  | 50 | 0.5 | $80^{9}$ | 0.15 | 0.1 | 0.34 | TO-92 lo-power '317 |
| LM1117 ${ }^{\text {n }}$ | $\cdot$ - | 20 | 0.8 | 1.2 | 5 | 10 | 1.25 | 1 | 52 | 0.5 | 73 | 0.035 | 0.2 | 0.88 | low VDO '317, popular |
| NCP1117 | - - - - $\cdot$ $\cdot$ | 20 | 1.0 | 1.2 | 5 | 10 | 1.25 | 1 | 52 | 0.5 | 73 | 0.04 | 0.2 | 0.40 | higher current '1117 |
| LMS8117A | d | 20 | 1.0 | 1.2 | 5 | 10 | 1.25 | 1 | 60 | 0.5 | 75 | 0.035 | 0.2 | 0.92 | higher current '1117 |
| LM317 ${ }^{k}$ | - - $\cdot$ $\cdot$ $\cdot$ $\cdot$ | 40 | $1.5^{\text {P }}$ | $2.5^{\text {t }}$ | 10 | 0.1 | 1.25 | 4 | 50 | 0.6 | $80^{9}$ | 0.01 | 0.1 | 0.15 | orig, cheap, popular |
| LT1086CP | - - $\cdot$ $\cdot$ - - | 30 | 1.5 | 1.5 | 10 | $22^{\text {u }}$ | 1.25 | 1 | 55 | 0.5 | 75 | 0.02 | 0.1 | 2.67 | low dropout |
| LM350T | - - $\cdot$ $\cdot$ - - | 35 | 3 | $2.5^{t}$ | 10 | 1 | 1.25 | 4 | 50 | 0.6 | 65 | 0.1 | 0.1 | 0.49 | 3A monolithic |
| LT1085CT | - - $\cdot$ - $\cdot$ - | 30 | 3 | 1.5 | 10 | $22^{\text {u }}$ | 1.25 | 1 | 55 | 0.5 | 75 | 0.02 | 0.1 | 4.50 | 3A low dropout |
| LT1084CP | - - $\cdot$ $\cdot$ - - | 30 | 5 | 1.5 | 10 | $22^{\text {u }}$ | 1.25 | 1 | 55 | 0.5 | 75 | 0.02 | 0.1 | 5.34 | 5A low dropout |
| LM338T | - - $\cdot$ $\cdot$ - - | 40 | 5 | $2.5^{t}$ | 5 | 1 | 1.24 | 4 | 45 | 0.6 | 80 | 0.1 | 0.1 | 1.62 | 5A monolithic |
| LT1083CP | - - - $\cdot$ - - | 30 | 7.5 | 1.5 | 10 | $22^{\text {u }}$ | 1.25 | 1 | 55 | 0.5 | 75 | 0.02 | 0.1 | 9.80 | 7.5A low dropout |
| Positive | , high-voltage |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LM317HV | - - $\cdot$ $\cdot$ - - | 60 | 1.5 | $2.0^{t}$ | 12 | 0.1 | 1.25 | 4 | 50 | 0.6 | $80^{9}$ | 0.01 | 0.1 | 2.17 | high-voltage '317 |
| LR12 | - $\cdot$ | 100 | 0.05 | 12 | 0.5 | 0.1 | 1.20 | 5 | 10 | 1 | 60 | 0.003 | 1.4 | 1.39 | Supertex |
| TL783C | - - $\cdot$ - $\cdot$ - | 125 | 0.7 | 10 | 15 | 1 | 1.27 | 5 | 83 | 0.3 | 76 | 0.02 | 0.15 | 1.62 | TI, MOSFET |
| LR8 | $\cdot$ - - - $\cdot$ $\cdot$ | 450 | 0.01 | 12 | 0.5 | 1 | 1.20 | 5 | 10 | 1 | 60 | 0.003 | 1.4 | 0.72 | Supertex |
| Negativ |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LM337L | - $\cdot$ - - - | 40 | 0.1 | - | 5 | 1 | 1.25 | 4 | 50 | 0.65 | $80^{9}$ | 0.02 | 0.3 | 0.65 | low-power (neg 317L) |
| LM337 | - - $\cdot$ $\cdot$ $\cdot$ $\cdot$ | 40 | $1.5^{\text {P }}$ | $2.0^{t}$ | 10 | 1 | 1.25 | 3 | 65 | 0.6 | $77^{9}$ | 0.02 | 0.3 | 0.28 | negative 317 |

Notes: (a) all have $V_{\text {out }}$ range from $V_{\text {ref }}$ to $V_{\text {in }}(\max )-V_{\text {ref. }}$ (b) minimum current to operate the IC. (c) $\Delta V_{\text {out }}$ (\%) for $\Delta T_{J}=100^{\circ} \mathrm{C}$. (d) D² PAK. (e) for $10 \%$ to $50 \%$ Imax. (f) at 5 V . (g) with Vadj bypass cap. (h) maximum dropout voltage at Imax. (k) JRC's NJM317F has isolated tab. ( n ) also with prefixes like TLV, LD, and REF. (p) for TO-220 and D-PAK packages. (u) 10 $\mu \mathrm{F}$ min if low ESR tantalum; also requires $10 \mu \mathrm{~F}$ input bypass. (v) maximum lout at low $V_{\text {in }}-V_{\text {out }}$, e.g., $\Delta V<10 \mathrm{~V}$; see text. (z) the metal case or tab (for TO-220, TO-3, D-PAK) is connected to $V_{\text {out }}$ for positive regulators, and to $V_{\text {in }}$ for negative regulators.
Beware differing pinouts: positive versus negative, and variants like LR8 and LR12.
make up the difference; but then you incur some additional uncertainty of output voltage, owing to the adjustment pin current of $\sim 50 \mu \mathrm{~A}$; see $\mathbf{E}$ below.
B: The standard 317-style regulator circuit (as in Figure 9.10) can adjust only down to $V_{\text {ref }}$. But you can trick a 317 into going down to zero by returning the lower leg of the output divider $\left(R_{2}\right)$ to a negative reference. Be sure to sink enough current to bias that reference into conduction, as shown.
C: You can use a MOSFET switch (or a low $R_{\mathrm{ON}}$ analog switch) to shunt additional fixed resistors across the voltage-setting lower resistor, allowing selection of output voltage under logic-level control.
where the value of $R_{1}$ is $240 \Omega$. This design error most likely originated with illustrative circuit examples for the more tightly spec'd LM117 on the same datasheet, whose worst-case $I_{\text {out }(\min )}$ is 5 mA (half that of the LM317). It's been 40 years, and no one at the factory seems to have noticed!

D: Alternatively, you can program the output voltage by applying a dc voltage via the ADJ pin; the output voltage will be $V_{\text {ref }}$ greater. The programming voltage could be generated by a pot, as shown, or by a DAC. If programmed as in the circuit fragment shown, you would need to ensure that the external load satisfies the minimum load current specification ( 5 or 10 mA for most devices; see Table 9.2). You also need to take into consideration the effect of ADJ pin bias current through the larger than usual impedance, in this example rising to more than $1 \mathrm{k} \Omega$ at the pot's midposition; see $\mathbf{E}$, next.
E: The ADJ pin sources $\sim 50 \mu \mathrm{~A}$ (see the box titled "Anatomy of a 317"), which causes the output voltage to become

$$
\begin{equation*}
V_{\mathrm{OUT}}=V_{\mathrm{ADJ}}\left(1+\frac{R_{2}}{R_{1}}\right)+I_{\mathrm{ADJ}} R_{2} \tag{9.1}
\end{equation*}
$$

where the last "error" term is caused by the ADJ pin current.
For the worst-case $I_{\mathrm{ADJ}}=100 \mu \mathrm{~A}$ and nominal $R_{1}=125 \Omega$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0639.jpg?height=815&width=791&top_left_y=205&top_left_x=125)

Figure 9.11. Typical dropout voltage ( $V_{\mathrm{IN}}-V_{\text {OUT }}$ ) versus load current for 317-style three-terminal regulators (bold curves). Representative low-dropout and high-voltage regulators are included for comparison. See also Figure 9.24.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0639.jpg?height=517&width=685&top_left_y=1239&top_left_x=201)

Figure 9.12. LM337 three-terminal adjustable negative voltage regulator. The common-emitter output stage requires at least $1 \mu \mathrm{~F}$ bypassing at input and output to ensure stability.
this amounts to a $1 \%$ increase in output voltage, above and beyond the initial $V_{\text {ref }}$ uncertainty (usually $1 \%$ or $4 \%$; see Table 9.2). ${ }^{17}$ The current-induced error increases linearly with divider impedance, as indicated in the plot (which assumes a $V_{\text {ref }}$ tolerance of $4 \%$, a worst-case ADJ pin current

[^475]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0639.jpg?height=840&width=796&top_left_y=182&top_left_x=977)

Figure 9.13. Simplified circuit of the 317-style linear regulator, illustrating its internal temperature-compensated bandgap reference; see the box "Anatomy of a 317."
of $100 \mu \mathrm{~A}$, and no correction for the adjustment current, i.e., ignoring the last term of eq'n 9.1).

F：A linear regulator can be damaged by fault conditions in which bypass capacitors discharge suddenly through the regulator circuit, causing destructive peak currents. Diode $D_{2}$ prevents the output bypass capacitor from discharging through the regulator if the input is shorted; it never hurts to include such a diode, and it is definitely indicated for higher output voltages. Likewise, add diode $D_{1}$ if an optional noise reduction capacitor $C_{1}$ is used, to protect against input or output shorts.
$\mathbf{G}$ and $\mathbf{H}$ : You can extend the output-voltage ramp-up time ${ }^{18}$ by bypassing the ADJ terminal with a large value

18 Why would you do that? Perhaps this short story, from our research lab, will provide some motivation: we built a $\pm 15 \mathrm{kV}$ supply, using a pair of Spellman MP $15 \mathrm{dc}-\mathrm{dc}$ HV converters ( +24 V input, +15 kV and -15 kV maximum outputs, 10 W ), powered from a commercial acpowered +24 Vdc switching supply. We mounted the HV output connectors (type SHV; see Figure 1.125) a safe $2^{\prime \prime}$ apart. Imagine our surprise, then, when we powered it up, and a huge spark jumped between the connectors; must have been at least 50 kV ! Scary. And worrisome - can this thing (and its load) survive repeated startups? Our first attempted cure was to ensure that the MP 15 's $0-10 \mathrm{~V}$ control voltage was set to zero volts at startup. No joy. Finally we added an LT1085 three-terminal regulator with controlled ramp to the +24 V input, and, voilà, no more lightning.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=238&width=521&top_left_y=213&top_left_x=247)
A. choose $R_{1}$ to allow
operation at $/$ load $=0$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=895&width=1618&top_left_y=206&top_left_x=241)
D. alternate control method,
useful for tracking supplies etc.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=314&width=427&top_left_y=741&top_left_x=797)

$$
\begin{aligned}
& V_{\mathrm{O}}=V_{\text {ADJ }}\left(1+\frac{R_{2}}{R_{1}}\right)+I_{\text {ADJ }} R_{2} \\
& =V_{\text {ADJ }}(1+\underbrace{\frac{I_{\text {ADJ }} \cdot R_{1} \| R_{2}}{V_{\text {ADJ }}}}_{\begin{array}{c}
\text { fractional error } \\
\text { from ADJ current }
\end{array}})\left(1+\frac{R_{2}}{R_{1}}\right)
\end{aligned}
$$

E. Vout error from $I_{\mathrm{ADJ}}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=430&width=498&top_left_y=752&top_left_x=1363)
F. protection diodes for $V_{0} \geq 25 \mathrm{~V}$ and large values of $C_{1} \& C_{2}$ to prevent regulator damage from stored capacitor energy if input or output is shorted ( $D_{1}$ for optional $C_{1}, D_{2}$ for $C_{2}$ )
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=437&width=924&top_left_y=1419&top_left_x=890)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0640.jpg?height=304&width=475&top_left_y=1389&top_left_x=250)
G. slow turn-on, with logic-switched disable*
${ }^{*} V_{\text {out }} \rightarrow 1.25 \mathrm{~V}$

Figure 9.14. Application hints for the LM317-style three-terminal adjustable regulator, described in §9.3.4.
capacitor (be sure to add the protection diode; see $\mathbf{F}$ above). In both circuits the capacitor ramps up with a constant current, as indicated. Because $R_{1}$ is small, the capacitor value can become uncomfortably large (e.g., $100 \mu \mathrm{~F}$ for a $10 \mathrm{~ms} / \mathrm{V}$ ramp with $R_{1}=125 \Omega$ ), so you may want to add a follower, as in $\mathbf{H}$. Note that these circuits do not ramp from zero output voltage - in $\mathbf{G}$ it jumps to $V_{\text {ref }}(1.25 \mathrm{~V})$
before ramping, and in $\mathbf{H}$ it jumps initially to $V_{\text {ref }}+V_{\mathrm{BE}}$ (about 1.8 V ). For the same reason the "disable" switch in G brings the output down only to $V_{\text {ref }}$.

Exercise 9.5. Draw a circuit (with component values), following the scheme of Figure 9.14C, to power a 12 V (nominal) dc cooling fan within an instrument: when little cooling is needed the circuit should provide +6 V (at which the fan runs, but quietly), but when
more cooling is needed a logic-level signal (call it HOT) that is provided to your circuit will go HIGH (i.e., to +5 V ) to switch on a MOSFET (as in the figure), at which point your circuit should increase the fan voltage to +12 V .

### 9.3.5 317-style regulator: circuit examples

Before moving on to the subject of low-dropout regulators, let's take a look at a few useful real-world examples that are easily handled with 317-style 3-terminal adjustable regulators: a 0 to $\pm 25 \mathrm{~V}$ dual-tracking adjustable bench supply, a proportional fan speed control, and two ways to create an adjustable high-voltage dc supply.

#### A. Laboratory dual-tracking bench supply

It's nice to have an adjustable dual supply on the bench, for example with matched ("dual tracking") outputs that go from 0 to $\pm 25 \mathrm{~V}$ at currents to 0.5 A . You can buy them for a few hundred dollars or so; but you can make one pretty easily with a pair of 3-terminal adjustable regulators. Figure 9.15 shows how, beginning with the unregulated dc inputs. The positive regulator is an LM317 in a TO-220 package (suffix T), with an appropriately sized heatsink ( $R_{\Theta \mathrm{JC}} \sim 2^{\circ} \mathrm{C} / \mathrm{W}$; see §9.4). To get adjustability down to zero volts we use the trick of Figure 9.14B (output sense divider return to -1.25 V ). For the tracking negative output we negate accurately the voltage at $U_{1}$ 's ADJ pin to program the LM337 negative regulator.

A few details: we added a noise-suppression capacitor $C_{1}$ to $U_{1}$ (along with a protection diode), and we used a precision low-noise op-amp to generate the inverted control voltage (thus no capacitor is needed at $U_{2}$ 's ADJ pin). Resistors $R_{1}$ and $R_{6}$ provide the regulators' 10 mA minimum load current, but note that op-amp $A_{2}$ must be able to source 10 mA , and, likewise, $R_{5}$ must sink enough current to power the op-amp, sink the 10 mA through $R_{2}$, and bias the zener $Z_{1}$. Schottky diodes $D_{1}$ and $D_{2}$ protect against reverse polarity, for example from a load bridging both rails. Finally, if there is some way in which the dc inputs could be shorted abruptly to ground, diodes should be connected between input and output terminals of each regulator (as in Figure 9.14F), to protect them from the fault current flowing back from the output bypass capacitors (including whatever you've got in the powered external circuit); a couple of 1N4004 rectifiers would be fine here.

Exercise 9.6. Zener reference $Z_{1}$ (actually it's a low-current shunt regulator) has a specified current range of $50 \mu \mathrm{~A}$ to 20 mA . Show that this circuit respects those limits, by calculating the zener current at both maximum and minimum negative input voltage (i.e., at -38 V and at -28 V ). Assume the dual op-amp's supply current is in the range of 3 mA to 5.7 mA .
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0641.jpg?height=720&width=804&top_left_y=219&top_left_x=973)

Figure 9.15. Laboratory dual-tracking bench supply, 0 to $\pm 25 \mathrm{~V}$, implemented with 317-style three-terminal linear regulators.

#### B. Proportional fan control

On-off (or high-low) fan control, as in Exercise 9.5, is simple; but you can do better than "bang-bang" control by tailoring the fan's drive voltage (thus fan speed) to hold the heatsink at a given elevated temperature setpoint. Figure 9.16 shows how to use an LM317T as a power driver, exploiting its internal protection (overtemperature, overcurrent) and its simple ADJ-pin control scheme. Here we've used the forever-popular LM358 op-amp as an integrator of the error signal from a bridge, one leg of which is a negative
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0641.jpg?height=527&width=807&top_left_y=1586&top_left_x=977)

Figure 9.16. Controlling fan speed with analog feedback from a thermistor sensor, with $60^{\circ} \mathrm{C}$ setpoint. Fully analog control eliminates switching noise, and variable-speed operation minimizes acoustic noise.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0642.jpg?height=521&width=1314&top_left_y=214&top_left_x=389)

Figure 9.17. High-voltage adjustable supply I, 0 to 400 V , implemented with a low-current LR8 plus outboard MOSFET follower. * See text for $R_{2}$ 's voltage rating.
temperature coefficient (NTC) thermistor. The inputs are balanced at the $60^{\circ} \mathrm{C}$ setpoint, above which the integrator's output, and therefore the fan voltage, is driven positive. The integrator time constant $R_{4} C_{1}$ should be chosen somewhat longer than the thermal time constant from the heat source(s) to the thermistor sensor, to minimize feedbackloop "hunting."

We chose the LM358 for its low cost (as little as $\$ 0.10$ in unit quantity), single-supply operation (input and output to the negative rail), and robust tolerance to supply voltages well beyond +15 V . But its 50 nA worst-case input offset current forced us to use a rather large integrating capacitor. Ideally one would like an inexpensive single-supply opamp with bias-compensated or FET inputs. Happily, there's the unusual single-supply OPA171, whose offset current is down in the tens of picoamps even at elevated temperature, and which operates over the full supply voltage range of 3 V to 36 V ; it costs about a dollar (but you come out ahead, with the less expensive $0.47 \mu \mathrm{~F}$ capacitor that goes with a $10 \mathrm{M} \Omega$ resistor $R_{4}$ ).

#### C. High-voltage supply I: linear regulator

Figure 9.17 shows a simple circuit that extends the output current of the LR8 high-voltage 3-terminal regulator from Supertex. This part operates to 450 V , but it's limited to 10 mA of output current, and further limited by power dissipation ( $\sim 2 \mathrm{~W}$ in the D-PAK power package, depending on circuit-board foil pattern; see Figure 9.45) when operating at nearly its full rated voltage differential.

The regulator's minimum load current is specified as 0.5 mA , so we operate it at slightly less than 1 mA , with its output driving a high voltage power MOSFET follower. Feedback is local to the LR8, so the follower introduces an offset (slightly load dependent) that can be approxi-
mately trimmed to zero by $R_{1 \mathrm{~b}}$. $Q_{2}$ provides current limiting, and diodes $D_{1}-D_{3}$ protect against the many injuries that are possible in a high voltage supply. Add capacitor $C_{2}$ (along with a protection diode) for noise reduction. The output-setting pot $R_{2}$ dissipates 320 mW at maximum output voltage, so it's wise to use a part rated at 1 W or more. Be sure to check the pot's specifications for a voltage rating, as well; for this application you could use a Bourns 95C1C-D24-A23 or a Honeywell 53C3500K.

#### D. High-voltage supply II: dc-dc switching converter

Another approach to generating regulated high-voltage dc is to use a switching dc-dc converter module. These come with a huge range of output voltages (to tens of kilovolts) and with selectable output polarity. You can get a wide variety of these with built-in regulator circuitry, intended to be powered by a low-voltage dc input ( +5 V , or +15 V , etc.), and with the output voltage programmed via a variable resistor or by a low-voltage dc programming input. These are handy for generating the bias for a photomultiplier tube, avalanche photodiode detector, channel plate multiplier, or other devices that need a stable high-voltage low-current bias.

A less-expensive approach is to use a bare-bones dc-dc converter module that lacks internal regulation; for these the output voltage scales with input voltage - they are sometimes called "proportional" dc-dc converters. Typical units take a $0-12 \mathrm{~V}$ dc input, with output ranges going from as little as 100 V to as much as 25 kV , at power ratings from a fraction of a watt to 10 watts or so. Figure 9.18 shows how to do this, using one of EMCO's 3 W proportional converter modules. The output voltage is controlled by $R_{3}$, with the low end of the voltage range set by
the LM317's 1.25 V minimum output. The optional current limit modification protects the converter when the output is overloaded. ${ }^{19}$ The total cost of the external circuit components here adds up to less than $\$ 0.75$ in unit quantity - you can't beat that, for cheap!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0643.jpg?height=733&width=795&top_left_y=447&top_left_x=123)

Figure 9.18. High-voltage adjustable supply II, implemented with a proportional dc-dc converter module powered by an LM317 with feedback control to the ADJ pin.

### 9.3.6 Lower-dropout regulators

There are applications where the $\sim 2 \mathrm{~V}$ dropout voltage (i.e., minimum input-output voltage differential) of these regulators is a serious limitation. For example, in a digital logic circuit you might need to create a +3.3 V supply from an existing +5 V ; or (worse), a +2.5 V supply from an existing +3.3 V supply rail. Another application might be a portable device needing +5 V , and operating from a 9 V alkaline battery; the latter begins life at about 9.4 V , declining at end of life to 6 V or 5.4 V (depending on whether you subscribe to $1.0 \mathrm{~V} /$ cell or $0.9 \mathrm{~V} /$ cell as the definition of a fully exhausted battery). For these situations you need a regulator that can operate with a small input-output differential, ideally down to a few tenths of a volt.

One solution is to abandon linear regulators altogether and use instead a switching regulator (§9.6), which deals differently with voltage differential. Switchers (the nickname for switching, or switchmode, regulators) are popular

[^476]in such applications; but they have problems of their own (particularly in terms of switching noise and transients), and you may prefer the placid calm, and simplicity, of a linear regulator.

Look again at the conventional linear regulators in Figures 9.6 and 9.9; the $\sim 2 \mathrm{~V}$ dropout is caused by the two cascaded $V_{\mathrm{BE}}$ drops of the Darlington output follower, plus another $V_{\mathrm{BE}}$ across the current-limiting sense resistor. The solution (inspired by Sziklai's complementary replacement for a conventional Darlington; see $\S 2.4 .2 \mathrm{~A}$ ) is to use a different output-stage topology, and a different current-limit scheme.

Figure 9.19 shows a partial solution. This design retains an npn output follower, but substitutes a pnp driver transistor; the latter can run close to saturation, eliminating one of the $V_{\mathrm{BE}}$ drops. Further, the current-limit sense resistor has been relocated in the collector ("high-side current sensing"), where it does not contribute to the dropout voltage (as long as its drop is less than a $V_{\mathrm{BE}}$ at current limit, which is easy to manage if a comparator is used to sense maximum current, as shown). With this circuit topology the LT1083-85 regulators (rated at $7.5 \mathrm{~A}, 5 \mathrm{~A}$, and 3 A , respectively) achieve a typical dropout of 1 V at their maximum current.

We've used this series of regulators in many designs, with good success. Electrically they mimic the classic LM317 three-terminal adjustable regulator, with an internal 1.25 V referenced to the output pin. However, as with most low-dropout designs, these regulators are fussy about bypassing: the datasheet recommends $10 \mu \mathrm{~F}$ at the input, and at least $10 \mu \mathrm{~F}$ (tantalum) or $50 \mu \mathrm{~F}$ (aluminum electrolytic) at the output. If the ADJ pin is bypassed for noise reduction (see §9.3.13), the datasheet recommends tripling the output bypass capacitor value.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0643.jpg?height=472&width=677&top_left_y=1713&top_left_x=1034)

Figure 9.19. LT1083-85 series three-terminal positive regulators with reduced dropout voltage.

### 9.3.7 True low-dropout regulators

The dropout voltage can be reduced further, by replacing the $n p n$ (follower) output stage with a pnp (common emitter) stage (Figure 9.20A). That eliminates the $V_{\mathrm{BE}}$ drop, the dropout voltage now being set by transistor saturation. To keep the dropout voltage as low as possible, the currentlimit circuit eliminates the series sense resistor, using instead a fractional output-current sample, derived from a second collector on $Q_{1}$. This is less accurate, but "good enough," given that its job is merely to limit destructive currents: the datasheet for the 3 A LT1764A, for example, specifies a current limit of 3.1 A (minimum) and 4 A (typical). ${ }^{20}$

Many contemporary low-voltage regulators use MOSFETs, rather than bipolar transistors. The analogous LDO circuit is shown in Figure 9.20B. Like the bipolar LDO, these parts tend to be rather fussy about bypassing. For example, the TPS775xx regulators set requirements on both the capacitance and ESR of the output bypass: the capacitance must be at least $10 \mu \mathrm{~F}$ (with an ESR no less than $50 \mathrm{~m} \Omega$ and no greater than $1.5 \Omega$ ), with the datasheet additionally showing regions of stability and instability in graphs plotting combinations of $C_{\text {bypass }}, \mathrm{ESR}$, and $I_{\text {out }}$.

### 9.3.8 Current-reference 3-terminal regulator

All the regulators we've seen so far use an internal voltage reference (usually a 1.25 V "bandgap" reference), against which a voltage-divider fraction of the output is compared. The result is that you cannot have an output voltage less than that reference. In most cases this sets a lower bound of $V_{\text {out }}=1.25 \mathrm{~V}$ (though a few can go down to 0.8 V , or even 0.6 V ; see Table 9.3 on page 614).

Sometimes you want a lower voltage! Or you may want to have an adjustment range that goes clear down to zero volts. This has traditionally required an auxiliary negative supply, as for example in the book's previous edition's "laboratory bench supply" (its Figure 6.16).

A nice solution is the LT3080-style regulator, originated by Linear Technology (Figure 9.21). It is a 3 -terminal adjustable positive regulator (with a fourth pin, in some package styles) in which the ADJ pin (called SET) sources an accurate current ( $I_{\mathrm{SET}}=10 \mu \mathrm{~A}, \pm 2 \%$ ); the error amplifier then forces the output to follow the SET pin. So, if you connect a resistor $R$ from SET to ground, the output voltage will be simply $V_{\text {out }}=I_{\mathrm{SET}} R$. The output-voltage range goes all the way to zero: when $R=0, V_{\text {out }}=0 .{ }^{21}$

[^477]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0644.jpg?height=1218&width=771&top_left_y=197&top_left_x=1084)

Figure 9.20. A. LT1764 (bipolar) and B. TPS75xxx (CMOS) positive LDO regulators.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0644.jpg?height=498&width=697&top_left_y=1562&top_left_x=1121)

Figure 9.21. LT3080 " 3 -terminal" adjustable positive voltage regulator with precision current reference.
example, the output voltage into a $100 \Omega$ load will not go below 0.1 V . To reach 0 V you need to sink a small current toward a negative supply.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0645.jpg?height=330&width=677&top_left_y=223&top_left_x=182)

Figure 9.22. Positive regulator, adjustable down to 0 V .
Figure 9.22 shows the basic connection, here used to make a $0-10 \mathrm{~V}$ adjustable supply. The 3080 -series architecture makes it easy to add an adjustable current limit, itself adjustable down to zero, as shown in Figure 9.23. The upstream regulator $U_{1}$ is by itself a $0-1$ A current source; the cascaded regulators together act as a current-limited voltage source (or a voltage-limited current source, depending on the load).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0645.jpg?height=546&width=794&top_left_y=1005&top_left_x=131)

Figure 9.23. Adjustable "bench supply," with independent voltage and current limit controls.

The 3080 -style regulator includes a $V_{\text {CTRL }}$ pin in the packages with more than three pins (e.g., TO-220-5), which lets you run the internal control circuitry from a higher input voltage. When operated that way, the LT3080 is a true low-dropout voltage regulator, with a typical dropout voltage of 0.1 V at 250 mA load current. Its low impedance (emitter follower) output requires only $2.2 \mu \mathrm{~F}$ output bypassing, with no minimum ESR requirement.

### 9.3.9 Dropout voltages compared

To summarize the business of dropout voltage in these various regulator designs, we plotted in Figure 9.24 the dropout voltages of a representative regulator of each type. The curves are taken from "typical" dropout specifications in
the datasheets, all at $40^{\circ} \mathrm{C}$, and are scaled to the rated maximum current of each device. Three categories are clearly seen: conventional regulators with Darlington npn pass transistor (top three curves); lower-dropout regulators with $p n p$ driver and npn output follower (middle curve); and true low-dropout regulators with $p n p$ or $p$ MOS output stage (bottom four curves). Note particularly the resistive behavior of the CMOS regulators (bottom two curves), where the dropout voltage is linear in output current, and goes to zero at low current.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0645.jpg?height=562&width=796&top_left_y=734&top_left_x=977)

Figure 9.24. Linear regulator dropout voltage versus output current. The bottom pair of curves (TPS prefix) are CMOS; all others are bipolar. See also Figure 9.11.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0645.jpg?height=695&width=809&top_left_y=1553&top_left_x=973)

Figure 9.25. Dual low-voltage regulated supply.

### 9.3.10 Dual-voltage regulator circuit example

As an illustration, imagine we have a small digital circuit requiring +3.3 V and +2.5 V regulated supplies, each capable of supplying up to 500 mA . Figure 9.25 shows how to do this with a small PCB-mounted transformer driving an unregulated bridge rectifier, followed by a pair of linear regulators. The design is straightforward: (a) we began by choosing a transformer to deliver about +8 Vdc (unregulated) from Signal Transformer's nice selection; a unit with 6.3 Vrms is about right (its ac peak amplitude of $6.3 \sqrt{2} \approx 9 \mathrm{~V}$ is reduced by two diode drops); (b) we chose a conservative transformer current rating of 4 Arms, to allow for the extra heating caused by the relatively short current pulses in a bridge rectifier circuit ("small conduction angle," see §1.6.5); (c) the storage capacitor $C_{1}$ was then chosen (using $I=C d V / d t$ ) to allow $\sim 1 \mathrm{Vpp}$ ripple at maximum load current, with a voltage rating adequate to allow for the worst-case combination of high line voltage and zero output load; (d) for the +3.3 V output we used a 3-terminal adjustable regulator (LM317A, in a TO-220 power package), mounted on a small heatsink $\left(10^{\circ} \mathrm{C} / \mathrm{W}\right.$, adequate for the $\sim 5 \mathrm{~W}$ maximum power dissipation; see $\S 9.4$; (e) finally, for the +2.5 V output we used a low-dropout CMOS fixed voltage regulator (the last two digits of the part number designate +2.5 V ), taking its input from the regulated +3.3 V .

Several comments. (a) We have not shown details of the ac line input, including fuse, switch, and noise filter; (b) the bypass capacitor values shown are conservative (larger than the specified minimum), in order to improve transient response and provide robust stability; (c) the TPS72525 regulator includes an internal "supervisor" circuit providing a RESET' output that goes LOW when the regulator falls out of regulation, often used to alert a microprocessor to save its state and shut down.

### 9.3.11 Linear regulator choices

Fixed or adjustable? 3-terminal or 4-terminal? Low dropout or conventional? How do you decide which type of integrated linear regulator to use? Here is some guidance.

- If you don't need low dropout, stick with a conventional regulator, either 3-terminal fixed (78xx/79xx style, Table 9.1) or 3-terminal adjustable (317/337 style, Table 9.2): they are less expensive, and they're stable with small-value bypass capacitors.
- fixed: needs no external resistors; but limited voltage choices, and no trimmability.
- adjustable: settable and trimmable, and fewer types to stock; but require a pair of external resistors.
- If you need adjustability down to zero volts, use a current-reference regulator (LT3080 style).
- If you need low dropout ( $V_{\mathrm{DO}} \leq 1 \mathrm{~V}$ ) you have many LDO choices (Table 9.3):
- For input voltages $\geq 10 \mathrm{~V}$, use bipolar types:
* LT1083-85, LM1117, LM350, LM338 style (fixed or adj) for $\sim 1 \mathrm{~V}$ dropout;
* LT1764A style (fixed or adj) for $\sim 0.3 \mathrm{~V}$ (but see §9.3.12);
- For input voltages $\leq 10 \mathrm{~V}$ there are many MOSFET LDOs (fixed or adj).
- If you need high efficiency, high power density, voltage stepup, or voltage inversion, use a switching regulator/converter (§9.6).
For high-current low-voltage applications, consider the use of a regulator that has separate control and passelement input pins, like that shown in Figure 9.21. These are indicated in the "boost, bias pin" column of Table 9.3.


### 9.3.12 Linear regulator idiosyncrasies

These integrated regulators are genuinely easy to use, and, with their built-in overcurrent and thermal protection circuits, there's not much to worry about. Circuit designers should, however, be aware of the following idiosyncrasies.

#### A. Pinout variations

Our students succumb, with distressing frequency, to this gotcha: complementary polarity regulators, such as our favorite LM317 (positive) and LM337 (negative) 3-terminal adjustables, often have different pinouts (Figure 9.26). In the case of the $78 \mathrm{xx} / 79 \mathrm{xx}$ fixed regulators, for example, this creates real mischief: the mounting tab is ground for the 78 xx positive regulator (so you can screw it to the chassis, or solder it to the circuit board's ground plane), but for the 79 xx negative regulator the tab is connected electrically to the input voltage - ground that and you're in real trouble! ${ }^{22}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0646.jpg?height=266&width=624&top_left_y=1752&top_left_x=1160)

Figure 9.26. Never assume that negative regulators have the same pinouts as their positive twins. In fact, don't assume anything without consulting the datasheet.

[^478]Table 9.3 Low-dropout Linear Regulators ${ }^{a}$

| Part \# ${ }^{\text {n }}$ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=223&width=80&top_left_y=254&top_left_x=292) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=223&width=72&top_left_y=254&top_left_x=359) | ges | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=161&width=48&top_left_y=318&top_left_x=486) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=183&width=72&top_left_y=296&top_left_x=555) | 兑 | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=104&width=44&top_left_y=375&top_left_x=648) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=106&width=41&top_left_y=373&top_left_x=683) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=223&width=61&top_left_y=256&top_left_x=715) | こ | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=238&width=47&top_left_y=241&top_left_x=798) |  | $\begin{gathered} V_{\text {in }} \\ \min -\max \\ (\mathrm{V}) \end{gathered}$ | Vout <br> (V) | Iout <br> (A) | $\begin{aligned} & \text { Acc'y } \\ & 25 \mathrm{C} \\ & \text { (\%) } \\ & \hline \end{aligned}$ | $I_{Q}$ typ <br> lout=0 <br> (mA) | $\begin{gathered} V_{\mathrm{n}}^{\mathrm{b}} @ \\ \operatorname{typ} \\ (\mu \mathrm{Vrms}) \end{gathered}$ | @Vout <br> ) (V) | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0647.jpg?height=215&width=79&top_left_y=264&top_left_x=1467) | Cout <br> min <br> ( $\mu \mathrm{F}$ ) | ESR <br> min,max <br> ( $\Omega$ ) | Price ${ }^{n}$ qty 25 <br> (\$US) |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| LM317-style |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| LT3080 ${ }^{\text {A }}$ | 55 | 8 | 3 | - 8 | $\cdot$ |  |  |  | - X |  |  | - | 2- | 0-35 | 1.1 | 1 | $1^{\text {h }}$ | 40 | all | 50 | 2.2 | 0,0.5 | 2.71 |
| LT1086 | 33 | - - | - |  | - 5 |  | - |  | $\Delta$ |  |  |  | 5-25 | 1.25-25 | 1.5 | 1 | $10^{\text {h }}$ | - | - | 1000 | $22^{\text {f2 }}$ | 2 ? | 2.67 |
| LT3083A A | 55 | - 16 | - - | 12 | $\cdot$ - |  | - |  | - x |  | $\cdot$ | - | .2-23 | 0-22 | 3 | 1 | $1^{\text {h }}$ | 40 | all | 10 | $10^{\text {C }}$ | 0,0.5 | 5.90 |
| LT1083, 84, 85 | 33 | - - | - - |  | $\cdot$ - | - | - |  | - - |  | - | - | 2.7-259 | 1.25-25 | 3,5,7.5 | 1 | $10^{\text {h }}$ | $150^{\text {e2 }}$ | 2 | 300 | $22^{\text {f2 }}$ | 2 0,- | 5.20 |
| LT1580 | 5,7 - | - - | - |  | - 1 | - |  |  | - - |  |  |  | -5.5 | 1.25-6 | 7 | 0.6 | 6 | - |  | 1000 | 22 | 0.1 | 3.74 |
| LT1581 | 7 - | - |  |  | - 1 |  |  |  |  |  |  |  | 3.3-6 | 1.25-5 | 10 | 0.7 | $10^{\text {h }}$ | - | - | 300 | 22 | 0,1 | 8.93 |
| High Voltage ( $\geq 10 \mathrm{~V}$ ) |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| TPS709xx | - - | - - | - 5 | - - | - 11 | $\cdot$ | - | - | $\cdot$ |  | - | - | 2.5-30 | 1.5-6.5 | 0.15 | $2^{t}$ | 0.001 | 300 | 1.8 | 650 | 2.2 | 0,- | 1.16 |
| LT3008 | - - | - - | 8 | 6 | 6 | $\cdot$ | - |  | - 口 |  |  | - | 2-45 ${ }^{\circ}$ | 0.6-45 | 0.02 | 1 | 0.003 | 92 | 0.6 | 250 | 2.2 | 0,3 | 2.66 |
| TLV704xx | - - | - - | 5 |  | 3 | - |  | - | $\Delta$ |  |  |  | 2.5-24 | 3-5 | 0.15 | 2 | 0.003 |  |  | 500 | 1 | 0,- | 0.81 |
| LT3014B ${ }^{\text {B }}$ | - - | - |  |  | - - |  |  | - | - |  | - | - | 3-80 | 1.22-60 | 0.02 | 1.6 | 0.007 | 115 | 1.22 | 125 | 0.47 | 0,3 | 2.14 |
| LT1521 | - - | 8 | 3 | - - | - 3 | $\cdot$ | - | - | ㅁ |  | - | - | 3.5-20 | 3-20 | 0.3 | 1.5 | 0.012 | - | - | 125 | 1.5 | 0 ,? | 2.08 |
| LM2936 | 3 | 8 | 3 | 3 - |  | q | - | - | ■ |  | - | - | 4-26 ${ }^{\circ}$ | 3.0-5 | 0.05 | 2 | 0.015 | 500 | all | 1000 | 22 | 0.3,6 | 1.03 |
| TPS769, 70xx | - - | - - | 5 |  | 9 | $\cdot$ | - | - | $\Delta$ | v | - |  | 2.7-10 | 1.2-5.5 | 0.05, 0.1 | $3^{\text {tt }}$ | 0.017 | $190^{\text {e3 }}$ | all | 400 | 4.7 | 0.2,5 | 0.77 |
| TPS789, 90xx | - - | - - | 5 |  | 5 | $\cdot$ |  |  | $\Delta$ |  |  |  | 2.7-10 | 1.5-3.0 | 0.1, 0.05 | $3^{\text {tt }}$ | 0.017 | $56^{\text {f,e3 }}$ | 3 | 1000 | 4.7 | $0.2,5$ | 0.56 |
| TPS788xx | - - | - - | 5 |  | 2 | $\cdot$ | $\cdot$ | S | $\Delta$ |  | - |  | 2.7-13.5 | 2.5,3.3 | 0.15 | $3^{\text {tt }}$ | 0.017 | $56^{\text {f,e1 }}$ | 1 all | 1000 | 4.7 | 0.2,5 | 1.09 |
| ADP667 | - - 8 | 88 | - - |  | 1 | $\cdot$ | - | - | - x | v | - | - 3 | 3.5-16.5 | 1.3-16 | 0.25 | $4^{\text {tt }}$ | 0.02 | - | - | 500 | 10 | 0,- | 2.98 |
| LT1761 | - - | - - | 5 |  | - 9 | $\cdot$ | v2 | - | 口 | - | - |  | 1.8-20 | 1.22-20 | 0.1 | 1.3 | 0.02 | $20^{f}$ | all | 600 | 1 | 0.3 | 2.13 |
| LM9076 | 5 | - 8 | - - |  | - 2 | q |  | - | - $\square^{y}$ |  | - | r | 3.5-50 | 3.3-5 | 0.15 | 1.5 | 0.025 | - | - | 1500 | $22^{\text {C }}$ | 0.1,3 | 1.31 |
| LT1763 | - - | - 8 | - - | 12 | - 6 | $\cdot$ | $\cdot$ | - | 口 |  | - |  | 1.8-20 | 1.22-20 | 0.5 | 1 | 0.03 | $20^{f}$ | all | 50 | 3.3 | 0,3 | 2.30 |
| ADP3331 | - - | - - | 6 |  | - - |  | - | - | - x |  | - | $\cdot$ | 2.6-12 | 1.5-11.75 | 0.2 | 0.7 | 0.034 | 95 | 3 | 240 | 0.47 | 0,- | 1.25 |
| TPS765, 66xx | - - | 8 | - - | - - | 8 | $\cdot$ | - | - | $\Delta$ | v | - p | p | 2.7-10 | 1.2-5.5 | $0.15,0.25$ | $3^{\text {tt }}$ | 0.035 | $200^{\text {e3 }}$ | all | $100^{t}$ | 4.7 | 0.3,20 | 1.50 |
| TPS760, 61xx | - - | - - | - 5 | - | 5 |  | - | - | $\Delta$ |  | - |  | 3.5-16 | 3-5 | $0.05,0.1$ | 1 | 0.09 | $190^{\text {e3 }}$ | all | 300 | 2.2 | 0.1,20 | 0.90 |
| TPS763, 64xx | - - | - - | 5 |  | z 9 | $\cdot$ | z | - | $\Delta$ | Z |  |  | 3.3-10 | 1.5-6.5 | 0.15 | 2 | 0.09 | $140^{\text {e3 }}$ | all | 700 | 4.7 | 0.3,10 | 0.38 |
| LP2950A ${ }^{C}$ | 3 | - - | - - | 3 | - 3 |  | - | - | - x |  | - |  | 3.1-30 | 3.0-5.0 | 0.1 | 0.5 | 0.075 | 430 | all | 35 | 2.2 | 0,5 | 0.37 |
| LP2951A ${ }^{C}$ |  | 88 | - - | 8 | - 2 |  | v2 | - | - X |  | - | $\cdot$ | 1.5-30 | 1.4-29 | 0.1 | 0.5 | 0.2 m | $100^{f}$ | all | 40 | 2.2 | 0,5 | 0.29 |
| LP2981A ${ }^{\text {C }}$ | - - |  | 5 | - - | - 9 | $\cdot$ | - | - | - $\Delta$ |  | - |  | 2.1-16 | 2.5-5 | 0.1 | 0.75 | 0.095 | $160^{\text {e3 }}$ | all | 140 | $3.3^{\text {C }}$ | 0.01,8 | 0.84 |
| LP2985A | - - | - - | 5 |  | - 9 | $\cdot$ | $\cdot$ | - | - $\Delta$ | - | - | - | 2.2-16 | 1.8-10 | 0.15 | 1 | 0.065 | $30^{f}$ | all | 140 | 2.2 | 0.005-0.5 | 0.82 |
| LM2931 | 33 | - 8 | 3 | 36 | - 2 | - | - | - | - 口 | v | - | - | 3.3-260 | 3.0-24 | 0.1 | 5 | 0.4 | 500 | 5 | 1500 | 47 | 0.03,0.4 | 0.65 |
| LM2930 | 33 | - - | - - | - - | - 2 | - | - | - | - $\square^{y}$ | y. | - | - | 5.3-260 | 5.0-8.0 | 0.15 | 6 | 4 | 140 | 5 | 800 | 10 | 0,1 | 0.65 |
| LP2986A | - - | 8 | - - |  | - 3 |  | v2 |  | - $\Delta$ |  | - | - | 2.5-16 | 1.23-15 | 0.2 | $0.5^{\text {d }}$ | 0.1 | $160^{\text {e3 }}$ | all | 140 | $4.7^{\mathrm{C}}$ | 0.1,10 | 2.32 |
| TPS7A4901 | - - | 8 | - - |  | - - | $\cdot$ | $\cdot$ |  | - x | v |  |  | 3-36 | 1.19-33 | 0.15 | 1.5 | 0.061 | $21^{f}$ | 5 | $32^{t}$ | $2.2^{\mathrm{C}}$ | 0,0.2 | 2.14 |
| TL750Lxx | 33 | $8^{y} 8$ | - - | 3 | - 4 | - |  | - | - $\square^{y}$ |  | - | - | 6-26 ${ }^{\circ}$ | 5,8,10,12 | 0.15 |  | 1.0 | 700 | 10 | 300 | 10 | 0,0.4 | 0.62 |
| TPS72xx | - - | 8 | - - | - - | - 5 | $\cdot$ | - | - | - $\Delta$ | $\cdot$ | - | p | 3-10 | 1.2-10 | 0.25 | $2^{\text {tt }}$ | 0.18 | 300 | 5 | 1400 | 10 | 0.1,1.3 | 2.00 |
| REG101, 102 | - | - 8 | $5^{y} 5$ | - - | - 6 | $\cdot$ | d | - | - x |  | - |  | 1.8-10 | 2.5-5.5 | $0.1,0.25$ | 1.5 | 0.4 | $18^{f}$ | 2.5 | 1000 | 0 | 到 | 2.22 |
| REG103, 04 | 5 | - $8^{y}$ | 5 |  | - 5 |  | d | - | - $x$ |  |  |  | 2.1-15 | 1.3-5 | 0.5, 1 | 2 | 0.5 | $25^{f}$ | 2.5 | 1000 | 0 | - | 3.78 |
| REG113 | - - | - 8 | 5 | - - | 5 | - | $\cdot$ | - | x |  | - |  | 1.8-10 | 2.5-5 | 0.4 | 1.5 | 0.4 | $18^{f}$ | 2.5 | 1000 | 0 | - | 1.41 |
| ADP3303 | - - | 8 | - - | - - | - 5 |  | $\cdot$ | - | X | - | - | $\cdot$ | 3.2-12 | 2.7-5.0 | 0.2 | 0.8 | 0.25 | 100 | 5 | $100^{t}$ | 0.47 | 0,- | 2.50 |
| MIC5205, 07 | - - | - - | 5 | - - | - $13^{y}$ | y | d | - | - ■ | - | - | - | 2.5-16 | 1.24-15 | 0.15 | 1 | 0.08 | $260^{\text {nV }}$ | all | 120 | 2.2 | 0,5 | 0.41 |
| MIC5209 | - 5 | 8 | 3 | 8 | - 7 | a | d | - | ㅁ | - | - | - | 16 | 1.24-15 | 0.5 | 1 | 0.08 | $300^{\text {nV }}$ | all | 500 | 2.2 | 1 rec | 0.70 |
| MIC5219 | \ | - 8 | 5 | 6 | - 11 |  | d | - | - ロ | - | - | - | 2.5-12 | 1.24-12 | 0.5 | 1 | 0.08 | $300^{\text {nV }}$ | all | 500 | 2.2 | 0.1-1 | 1.50 |
| LP38691, 93 | - $3^{y}$ | - - | y | - 6 | - 4 |  |  | - | - $\Delta$ | q | - | - | 2.7-10 | 1.8-5 | 0.5 | 2 | 0.055 | 70 | 3.3 | 1000 | $1^{\text {c }}$ | 0,100 | 0.90 |
| LT3021 | - - | - 8 | - - | - 16 | - 3 | $\cdot$ | - | - | - $\square$ | $\cdot$ | - | - | 0.9-10 | 0.2-9.5 | 0.5 | 2 | 0.11 | 300 | 1.2 | 650 | $3.3^{C}$ | 0,0.2 | 3.13 |
| ADP3334 | 剅 | - 8 | - - | 8 | - - |  | - | - | - x |  | - | - | 2.6-11 | 1.5-10 | 0.5 | 0.9 | 0.09 | 45 | all | 200 | , | 0,- | 1.34 |
| ADP3335, D $^{\text {D }}$ | - - | - 8 | - - | 8 | - 5 |  | v2 | - | - x |  | - | - | .6-12 | 1.5-10 | 0.5 | 0.9 | 0.08 | $47^{f}$ | all | $400^{t}$ | 1 | 0,- | 2.13 |
| ADP7102, 04 | 到 | - 8 | - - | 8 | - 7 |  |  |  | - $\cdot$ |  | - | $\cdot$ | 3.3-20 | 1.22-20 | $0.3,0.5$ | 0.8 | 0.4 | 15 | 3.3 | 150 | 1 | 0,0.2 | 3.22 |
| TPS73xx | - - 8 | 88 | - - |  | - 5 |  | - | - | - | $\cdot$ | - |  | 2.5-10 | 1.2-9.8 | 0.5 | 3 | 0.34 | 89 | 1.2 | 2000 | 10 | 0.1,4 | 2.25 |
| LM2937 | 33 | - - | 3 | - - | 5 |  |  |  | - ロ | - |  |  | 7-26 ${ }^{\circ}$ | 5-15 | 0.5 | 3 | 2.0 | 150 | 5 | 2500 | 10 | 0,3 | 0.76 |
| LP3878 |  | 8P | - - | 8 |  |  | $\cdot$ | - | - $\Delta$ | $\cdot$ | - | - | 2.5-16 | 1.0-5.5 | 0.8 | 1 | 0.18 | $18^{f}$ | all | 140 | $10^{C}$ | 0,0.4 | 1.44 |
| TPS775xx-78xx | - - | 8 | - - |  | 6 |  | - | - | - $\Delta$ |  |  |  | 2.7-10 | 1.2-5.5 | $0.5,0.75$ | $2^{\text {tt }}$ | 0.085 | $53^{\text {e1 }}$ | all | $100^{t}$ | 10 | 0.05,1.5 | 2.44 |
| TPS767, 68xx | - - | - 8 | - - |  | - 8 |  | - | - | - $\Delta$ | v |  |  | 2.7-10 | 1.2-5.5 | 1.0 | $2^{\text {tt }}$ | 0.085 | $55^{\text {e1 }}$ | all | $100^{t}$ | 10 | 0.05,1.5 | 2.77 |
| LM2940 | 33 | 16 - | - | 8 | - 6 | - | - | - | - ロ | - | - | - | 7-26 ${ }^{\circ}$ | 5-15 | 1.0 | 3 | 10 | 150 | 5 | 2000 | 22 | 0.1,1 | 1.71 |
| TPS73801 | - - | - - | 5 | - - | - - | $\cdot$ | - | - | - $\cdot$ | v | - | - | 2.2-20 | 1.2-20 | 1.0 | 1.5 | 1.0 | 45 | 1.2 | 230 | 10 | 0,0.3 | 2.34 |
| LT1965 | 55 | - 8 | - - | - 8 | - 4 |  | - | - | - ロ | $\cdot$ | - | - | 1.8-20 | 1.2-19 | 1.1 | 1.5 | 0.5 | 40 |  | 600 | 10 | 0,3 | 2.77 |
| UCC381 | - - | - 8 | - - |  | - 2 |  | - | v |  |  | - |  | 3-9 | 1.2-8 | 1.0 | 1.5 | 0.4 | - | - | 150 | 0 | - | 4.61 |
| TPS7A45xx | - 5 | - | 5 | - - | 4 | $\cdot$ | - | - | - $\cdot$ |  | - | - | 2.2-20 | 1.2-20 | 1.5 | 1 | 1.0 | 35 | all | 140 | 10 | 0,3 | 3.12 |
| LT1963A ${ }^{\text {E }}$ | 55 | - 8 | 3 | - - | - 4 | $\cdot$ | - | - | - 口 | $\cdot$ | - | - | 1.9-20 | 1.21-20 | 1.5 | 1.5 | 1.0 | 40 | all | 240 | 10 | 0.02,3 | 3.57 |
| LT1764A | 33 | -16P | - | - - | - 4 |  | - | - | - 口 | $\cdot$ | - | - | 2.7-20 | 1.2-20 | 3 | 1.5 | 1.0 | 40 | all | 600 | 10 | 0.005,3 | 4.97 |
| UCC383 | 3,5 5 | - | - |  | - 2 |  | - |  | $\cdot$ $\cdot$ |  |  |  | 3-9 | 1.2-8 | 3 | 1.5 | 0.4 | - | - | 400 | 0 | - | 4.32 |

![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0648.jpg?height=1715&width=1682&top_left_y=201&top_left_x=205)

Notes: (a) "Low Dropout" (LDO) regulators typically drop < 100 mV , except at the highest currents; sorted approximately by ascending /Q and /out capability, with some family grouping; the ADJ versions of some parts have less accuracy than the fixed versions (which can be laser trimmed). (b) $10 \mathrm{~Hz}-100 \mathrm{kHz}$, with no noise reduction cap, unless indicated otherwise. (c) input and other capacitors also required. (d) fixed voltage versions only. (e1) $100 \mathrm{~Hz}-100 \mathrm{kHz}$ or $200 \mathrm{~Hz}-100 \mathrm{kHz}$. (e2) 10 Hz -10kHz. (e3) $300 \mathrm{~Hz}-50 \mathrm{kHz}$. (e4) 10 Hz - 1 MHz . (f) with NR cap. (f2) if the ADJ pin is bypassed, larger output capacitors are required, see datasheet. (g) output-input differential. (h) minimum load current. (k) qty 1 k or more. ( m ) min or max. ( n ) bold italic indicates an inexpensive "jellybean." ( nV ) nV/ VHz , with 10nF filter cap. (o) "load-dump": withstands input voltage transients (or continuous inputs) to 60 V (or 40 V for some parts), and does not pass the spike through to the output; often associated with "automotive" parts. (p) power good. (q) some pkgs only. (r) delayed reset output for $\mu \mathrm{C}$. (rec) recommended. (s) slew control. (t) typical. (ti) some of TI's parts have an internal EEPROM, allowing quick custom factory voltage programming. (tt) over operating temperature range. (u) unit qty. (v) adjustable version only. (v2) filter cap across feedback resistor. (w) ADJ and filter avail in 8 -pin pkg. (x) reversed input voltage with excess current flow may damage part, a Schottky diode is recommended; although not marked " $\Delta$," these parts may have a reverse-diode function. (y) check datasheet. (z) choose between two versions.
$\Delta=$ input-output back diode conducts, limit current; also, reverse supply not allowed, see note $\mathrm{x} . \quad \square=$ protected against reverse polarity input.
Comments: A: current-programmed; $V_{\text {control }}$ dropout 1.6 V max; 1 mA min load. B: 100 V for -HV version. C: -C suffix for looser tolerance and tempco, etc. D: ADP7104 suggested alternative. E: see also TI's TL1963A, \$2.65. F: control and pass-transistor inputs. G: internal charge pump.

#### B. Polarity and bypassing

As we mentioned earlier, the negative versions of common positive regulators have a different output topology (an npn common emitter stage), and require larger bypass capacitors to prevent oscillation. Always "go by the book" (the datasheet, that is) - don't assume you know better. Also, be careful to connect the bypass capacitors with correct polarity (and see next).

#### C. Reverse polarity protection

An additional caution with dual supplies (whether regulated or not): almost any electronic circuit will be damaged extensively if the supply voltages are reversed. The only way that can happen with a single supply is if you connect the wires backward; sometimes you see a highcurrent rectifier connected across the circuit in the reverse direction to protect against this error. With circuits that use several supply voltages (a split supply, for instance), extensive damage can result if there is a component failure that shorts the two supplies together; a common situation is a collector-to-emitter short in one transistor of a push-pull pair operating between the supplies. In that case the two supplies find themselves tied together, and one of the regulators will win out. The opposite supply voltage is then reversed in polarity, and the circuit starts to smoke. Even in the absence of a fault condition like this, asymmetrical loads can cause a polarity reversal when power is turned off. For these reasons it is wise to connect a power rectifier (preferably Schottky) in the reverse direction from each regulated output to ground, as we drew in Figure 9.8.

Some regulator ICs are designed to block any current flow if the input voltage is lower than the output; these are marked with a bullet dot symbol ( $\bullet$ ) in the "reverse block" column in Table 9.3. Other regulator ICs go further and also block current flow for reversed input polarity; these are marked with a square symbol ( $\square$ ).

#### D. Ground-pin current

A particular idiosyncrasy of bipolar low-dropout regulators with pnp output stages (Figure 9.20) is the sharp rise in ground-pin current when the regulator is close to dropout. At that point the output stage is near saturation, with greatly reduced beta, and therefore requires substantial sinking base current. This is particularly noticeable when the regulator is lightly loaded, or unloaded, when it would otherwise have only a small ground-pin or quiescent current. As an example, the bipolar LT1764A-3.3 (fixed 3.3 V LDO), driving a 100 mA load, has a normal ground-pin current of about 5 mA , rising to $\sim 50 \mathrm{~mA}$ at dropout. The no-load quiescent current shows similar be-
havior, spiking to $\sim 30 \mathrm{~mA}$ from its normal $\sim 1 \mathrm{~mA} .{ }^{23}$ Manufacturers rarely advertise this "feature" on the front page of their datasheets, but you can find it inside, if you look. It is of particular importance in battery-operated devices. A caution: the quiescent ground-pin currents listed in the $I_{\mathrm{Q}}$ column of Table 9.3 are for a light load and with the input voltage above dropout.

#### E. Maximum input voltage

Table 9.3 lists the maximum specified input voltage for more than a hundred LDO linear regulators. CMOS regulators are good choices for low-voltage designs, and they come in a dazzling variety of fixed voltages (and, of course, adjustable versions): for example, the TPS7xxxx series from Texas Instruments includes a dozen types, each of which comes in a choice of $1.2,1.5,1.8,2.5,3.0,3.3$, or 5.0 volt outputs. But be careful, because many of these CMOS regulators have a specified maximum input voltage of just $+5.5 \mathrm{~V}{ }^{24}$ Some CMOS regulators, however, accept up to +10 V input; for higher input voltage you've got to use bipolar regulators, for example the LT1764A or LT3012, with input voltage ranges of $+2.7-20 \mathrm{~V}$ and
${ }^{23}$ The load-induced additional ground current would normally be $I_{\text {load }} / \beta$ driving the base of the pnp pass transistor, but during dropout the everzealous feedback loop provides a base drive appropriate for the LDO's maximum load-current rating. Some designs carefully limit this drive current, whereas others detect the saturation condition and limit the current accordingly. You've got to pay close attention to this behavior of candidate LDOs when designing battery operated devices, if you want to maximize remaining operating time after the battery voltage has dropped below the LDO's input criteria. Alternatively you may want to select an LDO that uses a p-channel MOSFET pass transistor and does not exhibit increased ground current at high loads or during dropout. For example, a 5 V regulator like the LT3008-5 runs at $3 \mu \mathrm{~A}$, but this soars to $30 \mu \mathrm{~A}$ if the battery drops below 5 V . However, a TLV70450 (with internal $p$ MOS pass transistor) suffers no increase at all, continuing to draw $3 \mu \mathrm{~A}$ under the same conditions.
${ }^{24}$ Contemporary regulator ICs, with their nanometer-scale features, are more susceptible to overvoltage transients and the like, as compared with robust legacy parts with their relatively large bipolar transistors. We've seen painful experiences, for example when a carefully designed and tested small PCB, filled to the brim with tiny parts, suffers unexplained failures in the field or at the customer's test sites. Sometimes this is due to uncontrolled (and arguably improper) user-supplied input transients. Adding a transient voltage suppressor (see Chapter $9 x$ ) at the input is a wise precaution for regulator ICs powered from an off-card dc source. Low-voltage ICs (such as those with 6 V or 7 V absolutemaximum ratings) are best powered from an on-card regulated 5 V , etc., rather than from external sources of power. (An exception might be made for a 3.7 V Li-ion cell.) Be very careful!
$4-80 \mathrm{~V}$, respectively. See $\S 9.13 .2$ for an interesting way to extend the input-voltage range, to as much as +1 kV !

#### F. LDO Stability

It's worth repeating that low-dropout regulators can be quite fussy about bypassing (see the comments in §9.3.7) and that there are large differences among different types. For example, the LDO Selection Guide from Texas Instruments includes a $C_{\text {out }}$ column, whose entries range from "No Cap" to " $100 \mu \mathrm{~F}$ tantalum." The symptoms of instability may manifest themselves as incorrect, or even zero, output voltage. The latter symptom flummoxed one of our students, who replaced an LP2950 (fixed 5 V LDO) several times before the real culprit was identified: he used a $0.1 \mu \mathrm{~F}$ ceramic bypass capacitor, which is less than the specified $1 \mu \mathrm{~F}$ minimum, and also whose equivalent series resistance (ESR; see $\S 1 x .3$ ) is too low, a hazard discussed in the Application Hints section of the regulator's datasheet. ${ }^{25}$ A more serious symptom of oscillation is output overvoltage: we had a circuit with an LM2940 LDO $(+5 \mathrm{~V}, 1 \mathrm{~A})$ that was bypassed in error with $0.22 \mu \mathrm{~F}$ (instead of $22 \mu \mathrm{~F}$ ); its internal oscillation caused the measured dc output to go to 7.5 V !

Table 9.3 has two columns to assist in selecting a part, $C_{\text {out }}(\min )$ and ESR (min,max). But these numbers should be considered a rough guide, and they do not capture everything you need to know to ensure proper operation. You'll find more guidance (e.g., contours of stable operation versus capacitance, ESR, and load current; see for example Figure 9.27) in the plots and applications section of the datasheet - study it carefully!

#### G. Transient response

Because voltage regulators must be stable into any capacitive load (the sum of all downstream bypass capacitance, often many $\mu \mathrm{F}$ ), their feedback bandwidth is limited (analogous to op-amp "compensation"), with typical loop bandwidths in the range of tens to hundreds of kilohertz. So you rely on the output capacitor(s) to maintain low impedance

[^479]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0650.jpg?height=552&width=797&top_left_y=221&top_left_x=1076)

Figure 9.27. Low-dropout linear regulators can set rather fussy requirements for the ESR of the output capacitor, as seen for the LM2940; often you have to obey both minimum and maximum bounds - beware!
at higher frequencies. Or, to say it another way, the output capacitor(s) are responsible for holding the output voltage constant in the short term, in response to a step change in load current, until the regulator responds in the longer term. It's particularly important to include capacitors of low ESR (and equivalent series inductance, ESL) in the mix when you have low-voltage loads with abrupt current changes, as, for example, with microprocessors (which may generate steps of many amps).

We rigged up a 1 V 6 A LDO regulator, using the Micrel MIC5191 control chip, and measured the output response when we made abrupt load steps between 2 A and 4 A , and between 1 A and 5 A . We compared the transient response with two prototype configurations: (a) on a solderable protoboard, using mostly through-hole components; and (b) on a carefully laid-out ${ }^{26}$ printed circuit board, using mostly surface-mount components, and with plenty of additional capacitance at both input and output. ${ }^{27}$ Figures 9.28-9.31 show the measured step responses. The use of plentiful low-inductance surface-mount technology (SMT) capacitors and low resistance (and low inductance)

[^480]power and ground foils produce a stunning improvement: the peak output transient dip drops by a factor of 10 (from $\sim 40 \mathrm{mV}$ to $\sim 4 \mathrm{mV}$ for the larger step amplitude), and the output recovers to within a fraction of a millivolt (compared with a $\sim 6 \mathrm{mV}$ drop for the larger step amplitude).

A different kind of transient-response issue concerns input-voltage transients, and the amount of spike feedthrough to the regulated output. This is different from the "Regulation, line" column in Table 9.3, which lists dc (or low-frequency) rejection of input variations. Input capacitors are somewhat helpful in reducing input-transient effects, but larger output capacitors, especially with low ESR, are a better defense. A special case is a so-called automotive "load dump," a rapid input spike caused, for example, by accidental disconnection of the car battery (from a loose connection, or corrosion, or human error) while being charged by the alternator. This can cause the normal 13.8 V power rail to spike to amplitudes of 50 V or more, causing a spike at a regulator's output. Worse, it can destroy the IC by exceeding its maximum specified input voltage (the " $V_{\text {in }}$ max" column of Table 9.3). Parts specifically designed to deal with load dumps are marked with an "o" note in the corresponding $V_{\text {in }}$ entry.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0651.jpg?height=476&width=815&top_left_y=1198&top_left_x=113)

Figure 9.28. Output voltage response to a step increase in load current: 1V6A LDO regulator, breadboarded primarily with through-hole components. Horizontal: $4 \mu \mathrm{~s} / \mathrm{div}$.

#### H. Noise

Linear regulators vary considerably in the level of output noise (that is, spectrum of output-voltage fluctuations). In many situations this may be unimportant, for example in a digital system, where the circuit itself is inherently noisy. ${ }^{28}$ But for low-level or precision analog electronics where

[^481]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0651.jpg?height=471&width=830&top_left_y=221&top_left_x=957)

Figure 9.29. Same as Figure 9.28, with 'scope slowed to $400 \mu \mathrm{~s} /$ div to show full load cycle.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0651.jpg?height=476&width=828&top_left_y=831&top_left_x=956)

Figure 9.30. Same as Figure 9.28, but built on a printed circuit board using surface-mount capacitors. Note expanded vertical scale.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0651.jpg?height=475&width=825&top_left_y=1482&top_left_x=960)

Figure 9.31. Same as Figure 9.30, with 'scope slowed to $400 \mu \mathrm{~s} /$ div to show full load cycle.
noise is important, there are regulators with superior noise specifications, for example the LT1764/1963 ( $40 \mu \mathrm{Vrms}$,

[^482]$10 \mathrm{~Hz}-100 \mathrm{kHz}$ ) or the ADP7102/04 (15 $\mu \mathrm{Vrms}$ ). Additionally, some regulators provide access to the internal voltage reference, so that an external filter capacitor can be added to suppress all but the low-frequency end of the noise spectrum, for example the LT1964 negative regulator ( $30 \mu \mathrm{Vrms}$ with 10 nF capacitor); see §9.3.13.

Because manufacturers specify noise characteristics differently (bandwidth, rms versus peak-to-peak, etc.), it can be difficult to compare candidate parts. We've made an attempt in the $V_{\mathrm{n}} @ V_{\text {out }}$ columns of Table 9.3, but be sure to consult the footnotes (and then the datasheets).

#### I. Shutdown protection

Some regulator types can be damaged if they see a large capacitance at their output, and the input voltage is brought abruptly to zero (e.g., by a crowbar, or an accidental shortcircuit). In that situation the charged output capacitance can source a destructive current back into the regulator's output terminal. Figure 9.32 shows how to prevent such damage, in this case with the popular LM317. Although many engineers don't bother with this nicety, it is the mark of a careful circuit designer. A similar hazard exists when an external bypass capacitor is used to filter the voltage noise of the regulator's reference; see $\S 9.3 .13 .{ }^{29}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0652.jpg?height=432&width=675&top_left_y=1238&top_left_x=285)

Figure 9.32. Diode $D_{1}$ protects the regulator if the input is suddenly grounded.

### 9.3.13 Noise and ripple filtering

The output noise from a linear regulator is caused by noise in the reference, multiplied by the ratio of $V_{\text {out }} / V_{\text {ref }}$, combined with noise in the error amplifier, and with noise and

[^483]ripple at the input terminal that is not completely suppressed by feedback. ${ }^{30}$ Some regulators let you add an external capacitor for lowpass filtering of the internal voltage reference and thus the dc output. Figure 9.33 shows several examples. In Figure 9.33A the ADJ pin of the LM317-style 3-terminal adjustable regulator is bypassed to ground; this provides significant noise improvement by preventing multiplication of the reference noise voltage by the factor $1+$ $R_{2} / R_{1}$ (the ratio of output voltage to 1.25 V reference voltage). It also improves the input ripple rejection ratio, from 65 dB to 80 dB (typical), according to the datasheet. Note the additional protection diode $D_{2}$, needed if the noise bypass capacitor $C_{1}$ is greater than $10 \mu \mathrm{~F}$.

This scheme does not eliminate the reference noise, it just prevents it (an ac signal) from being "gained up" by the dc gain factor $V_{\text {out }} / V_{\text {ref }}$. The noise filtering in Figures 9.33B and C is more effective, because it filters the reference voltage directly. In Figure 9.33B the LT3080's SET pin, sourcing a stable $10 \mu \mathrm{~A}$ current, is converted to the output voltage by $R_{\mathrm{SET}}$, filtered by $C_{1}$; the regulator's output is a unitygain replica of this filtered voltage. With $C_{1}=0.1 \mu \mathrm{~F}$, the reference noise is less than that of the error amplifier, producing an output noise of $\sim 40 \mu \mathrm{Vrms}$ ( $10 \mathrm{~Hz}-100 \mathrm{kHz}$ ). Note that the noise-filtering capacitor slows the regulator's startup: a $0.1 \mu \mathrm{~F}$ capacitor in a 10 V regulator circuit ( $R_{\mathrm{SET}}=1 \mathrm{M} \Omega$ ) has a startup time constant $R_{\mathrm{SET}} C_{1}$ of 100 ms .

Finally, Figure 9.33C shows a CMOS low-dropout regulator with a dedicated noise-reduction (NR) pin, for filtering directly the reference voltage presented to the error amplifier. With the recommended $0.1 \mu \mathrm{~F}$ capacitor the output noise voltage is $\sim 40 \mu \mathrm{Vrms}(100 \mathrm{~Hz}-100 \mathrm{kHz})$. Regulators with this feature are marked in the "Filter pin" column of Table 9.3.

Prefiltering An effective way of reducing dramatically the output ripple at the powerline frequency (and its harmonics) is to prefilter the dc input to the regulator. This is also highly effective in attenuating broadband noise that may be present at the dc input; and it's easier than the alternative of increasing the regulator loop's gain and bandwidth. We discuss this in some detail in $\S 8.15 .1$ ("Capacitance multiplier"), where we show the measured effects of prefiltering versus the brute-force approach of piling on lots of output capacitance (Figure 8.122).

See further discussion of noise in $\S 9.10$, in connection with voltage references.

[^484]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0653.jpg?height=1472&width=793&top_left_y=220&top_left_x=130)

Figure 9.33. Reducing output-voltage noise (and improving transient line regulation) in linear regulators.

### 9.3.14 Current sources

#### A. Three-terminal regulators as current sources

A 3-terminal linear regulator can be used to make a simple current source by putting a resistor across the regulated output voltage (hence constant current $I_{\mathrm{R}}=V_{\text {reg }} / R$ ), and floating the whole thing on top of a load returned to ground (Figure 9.34A). The current source is imperfect, however, because the regulator's operating current $I_{\text {reg }}$ (which comes out the ground pin) is combined with the well-controlled resistor current to produce a total output
current $I_{\text {out }}=V_{\text {reg }} / R+I_{\text {reg }}$. It's a reasonable current source, though, for output currents much larger than the regulator's operating current.

Originally this circuit had been implemented with a 7805 , which has an operating current of $\sim 3 \mathrm{~mA}$ and additionally has the disadvantage of squandering a rather large 5 V (the lowest-voltage part in the 78 xx series) to define the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0653.jpg?height=1493&width=653&top_left_y=589&top_left_x=1040)

Figure 9.34. Three-terminal regulators used as current sources. The bypass and compensation capacitors can be eliminated in circuits C and D if the LT3080 is replaced by its internally compensated LT3092 variant (whose output current is limited to a maximum of 200 mA ).
output current. Happily, with regulators like the LM317, this circuit (Figure 9.34B) becomes more attractive: only 1.25 V is used to set the current; and the regulator's operating current ( $\sim 5 \mathrm{~mA}$ ) emerges from the output pin, and thus is accurately accounted for in setting $I_{\text {out }}=V_{\mathrm{ref}} / R$. The only error term is the ADJ pin current of $\sim 50 \mu \mathrm{~A}$, which gets added to the current through $R: I_{\text {out }}=V_{\text {ref }} / R+I_{\mathrm{ADJ}}$. Because the minimum output current of 5 mA is 100 times larger, that is a small error even at the minimum output current, and smaller still at currents up to the regulator's maximum of 1.5 A . For this circuit, then, the output-current range is $5 \mathrm{~mA}-1.5 \mathrm{~A}$. It requires a minimum voltage drop of 1.25 V plus the regulator's dropout voltage, or about 3 V ; the maximum voltage across the two terminals is limited either to 40 V or (at higher currents) to the maximum junction temperature of $125^{\circ} \mathrm{C}$ (as determined by power dissipation and heatsinking), whichever is less. ${ }^{31}$

With the admirable LT3080-style regulator you can do better still, because its $10 \mu \mathrm{~A}$ SET-pin current reference lets you set the voltage across the current-setting resistor to be much less than the 1.25 V of a 317 -style voltage-reference regulator. Its operating current is smaller as well ( $<1 \mathrm{~mA}$ ), and the SET pin current (which gets added to the output current) is a stable and accurate $10.0 \mu \mathrm{~A}$. Figure 9.34C shows how to make a (1-terminal) current source to ground with an LT3080, and Figure 9.34D shows how to make a 2terminal "floating" current source, analogous to the LM317 current-source circuit. As with the latter, the voltage drop is limited to a maximum of 40 V (less at higher currents) at the high end; its lower dropout and low SET-derived reference voltage allows operation down to $\sim 1.5 \mathrm{~V}$ drop. The LT3092-series is a nice variant of the LT3080, designed specifically for use as a 2 -terminal current source. It uses the same $10 \mu \mathrm{~A}$ reference current, and operates from 1.2 V to 40 V drop; its internal compensation is configured to require no external bypass or compensation capacitors. Based on the LT3092's datasheet plot of output impedance, the device's effective parallel capacitance is approximately 100 pF at $1 \mathrm{~mA}, 800 \mathrm{pF}$ at 10 mA , and 6 nF at 100 mA .

Figure 9.35 shows, on a greatly expanded scale, the measured output currents of an LT3092 and an LM317, configured as 10 mA current sources. In our measurements the latter does a better job of maintaining constant cur-

[^485]rent (versus voltage across it), but the LT3092 kicks in at a lower voltage.

Note that the current sources in Figures 9.34B and D are 2 -terminal devices. Thus the load can be connected on either side. For example, you could use such a circuit to sink current from a load returned to ground, by connecting the load between ground and the input, and connecting the "output" to a negative voltage (of course, you could always use the negative-polarity 337, in a configuration analogous to Figure 9.34A.).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0654.jpg?height=501&width=784&top_left_y=660&top_left_x=1077)

Figure 9.35. Measured current versus voltage drop for the current sources of Figures 9.34B and D, configured as 10 mA 2terminal current sources. For the LM317, $R_{1}=124 \Omega$; for the LT3092, $R_{1}=20 \Omega$ and $R_{\mathrm{SET}}=20 \mathrm{k}$.

#### B. Lower currents

The above regulator-derived current sources are best suited for substantial output currents. For lower currents, or for higher voltages, there are some good alternatives.

#### LM334

It's worth knowing about the LM334 (originated by National Semiconductor), optimized for use as a low-power 2terminal current source (Figure 9.36A). It comes in smalloutline IC (SOIC) and TO-92 (transistor) packages and costs about $\$ 1$ in small quantities. You can use it all the way down to $1 \mu \mathrm{~A}$ because the ADJ current is a small fraction of the total current; and it operates over a voltage range of $1-40 \mathrm{~V}$. It has one peculiarity, however: the output current is temperature dependent - in fact, precisely proportional to absolute temperature (PTAT). So although it is not the world's most stable current source, you can use it as a temperature sensor! At room temperature ( $20^{\circ} \mathrm{C}, \sim 293 \mathrm{~K}$ ) its tempco is about $+0.34 \% /{ }^{\circ} \mathrm{C} .{ }^{32}$

[^486]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0655.jpg?height=746&width=809&top_left_y=209&top_left_x=121)

Figure 9.36. 2-terminal current source alternatives.

#### REF200

The REF200 is another current-source IC worth knowing about (Figure 9.36B). It has a pair of floating highquality $100 \mu \mathrm{~A}( \pm 0.5 \%)$ 2-terminal current sources (output impedance $>200 \mathrm{M} \Omega$ over a voltage range of $3.5 \mathrm{~V}-$ 30 V ). It comes in dual in-line packages (DIP) and SOIC packages and costs about $\$ 4$ in small quantities. Unlike the LM334, the REF200's current sources are temperature stable ( $\pm 25 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, typ). It also has an on-chip unitratio current mirror, so you can make a 2 -terminal current source with fixed currents of $50 \mu \mathrm{~A}, 100 \mu \mathrm{~A}, 200 \mu \mathrm{~A}$, $300 \mu \mathrm{~A}$, or $400 \mu \mathrm{~A}$. The datasheet asserts that "applications for the REF200 are limitless," though we are skeptical. Figure 9.37 shows measured current versus voltage for the parallel connection of the $100 \mu \mathrm{~A}$ pair.

#### Discrete-component current sources

When thinking about current sources, don't forget about 2-terminal devices like
(a) the humble JFET "current-regulator diode" (§3.2.2), which makes a simple 2-terminal current source (Figure 9.36C) that operates nicely up to 100 V (we plotted measured current versus voltage in Figure 9.38);
(b) a discrete JFET (see Tables 3.1, 3.7, and 8.2), configured similarly as a 2-terminal current source;
(c) the analogous use of a depletion-mode MOSFET (see Table 3.6 on page 210) like the Supertex LND150 (Figure 9.36D), discussed on this page (§9.3.14C);
(d) the series of 2-terminal "Constant Current Regu-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0655.jpg?height=522&width=769&top_left_y=206&top_left_x=983)

Figure 9.37. Measured current versus voltage for the REF200 twoterminal current source (parallel connection of the $100 \mu \mathrm{~A}$ pair).
lator and LED Driver" devices from ON Semiconductor. These are inexpensive (\$0.10-\$0.20 in qty 100), and are offered with selected currents (e.g., NSI50010YT1G: $10 \mathrm{~mA}, 50 \mathrm{~V}$; NSIC2020BT3G: $20 \mathrm{~mA}, 120 \mathrm{~V}$ ) and in adjustable versions (e.g., NSI45020JZ: $20-40 \mathrm{~mA}, 45 \mathrm{~V}$ ). The datasheets don't say much about what's inside these things, but depletion-mode FETs are the likely culprits.

#### Op-amp current-source configurations

If the application does not require a floating current source, then consider also
(d) the simple BJT current source (§2.2.6), drawn schematically in Figure 9.39A;
(e) the op-amp assisted BJT current source (§4.2.5), Figure 9.39B;
(f) the Howland current source (§4.2.5B), Figure 9.39C.

In these last three figures the bias voltage that programs the current is drawn as a floating battery; in a circuit implementation it would be a voltage relative to ground or to a supply rail, derived from a voltage reference.

#### C. High-voltage discrete current source

As mentioned above in the paragraph on discretecomponent current sources, a simple source-biased depletion-mode MOSFET (Figures 9.36D and E) forms a pretty good 2-terminal current source. These parts come in convenient packages (TO-92, SMT, TO-220, $\mathrm{D}^{2} \mathrm{PAK}$ ), with voltage ratings to 1.7 kV ; familiar examples are the LND150 and DN3545 from Supertex and the IXCP10M45S and IXCP10M90S from IXYS - see Table 3.6 on page 210. Because of the uncertainty in $I_{D}$ versus $V_{\mathrm{GS}}$, this sort of current source is not particularly precise or
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0656.jpg?height=476&width=795&top_left_y=221&top_left_x=220)

Figure 9.38. Measured current versus voltage for two members of the 1N5283 "current-regulator diode" (a JFET, actually) series.
predictable. But it's fine for noncritical applications, such as replacing a pullup resistor, and it has the advantage of operating to rather high voltages ( 500 V and 450 V for the Supertex parts; 450 V and 900 V for the IXYS). The IXYS datasheets call their product a "switchable current regulator." Figures 9.40 and 9.41 show some measured data for this simple circuit. The IXYS depletion-mode MOSFET line currently tops out at 1700 V (IXTH2N170). See $\S 3 x .6$ for a discussion of yet-higher-voltage versions (to 3 kV or more).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0656.jpg?height=769&width=812&top_left_y=1422&top_left_x=214)

Figure 9.39. BJT and op-amp current sources, drawn in abbreviated form with a floating bias battery. For details see the relevant discussions in Chapters 2 (BJTs) and 4 (op-amps).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0656.jpg?height=562&width=771&top_left_y=211&top_left_x=1084)

Figure 9.40. Measured current versus voltage for an IXCP10M45S depletion-mode power MOSFET, wired as a self-biased 2-terminal current source (as in Figure 9.36E).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0656.jpg?height=555&width=787&top_left_y=937&top_left_x=1076)

Figure 9.41. Measured current for the smaller LND150 depletionmode MOSFET, a handy part for low-current applications (compare with Figure 9.40).

## 9.4 Heat and power design

Up to now we've been skirting the issue of thermal management - the business of dealing with the heat generated by transistors (and other power semiconductors) in which the power dissipation (the voltage drop times the current) is greater than a few tenths of a watt. The solution consists of some combination of passive cooling (conducting the heat to a heatsink or to the metal case of an instrument) and active (forced air or pumped liquid) cooling.

This problem is not unique to voltage regulators, of course - it affects linear power amplifiers, power-switching circuits, and other heat-generating components such as power resistors, rectifiers, and high-speed digital ICs. Contemporary computer processors, for example, dissipate
many tens of watts and can be recognized by their attached finned heatsinks and blowers.

Linear voltage regulators get us into the topic "power electronics," because they are intrinsically inefficient: the full load current flows through the pass transistor, with a voltage drop at least adequate to prevent dropout. In the case of an unregulated dc input, as in Figure 9.25, that means a drop of at least a few volts; so with an amp of output current you've got at least a few watts... and you've got a problem. In the following sections we'll see how to solve it.

### 9.4.1 Power transistors and heatsinking

All power devices are packaged in cases that permit contact between a metal surface and an external heatsink. At the low-power end of the spectrum (up to a watt) the device may be cooled via conduction through its leads, soldered to a circuit board; the next step up is the surfacemount power packages with a larger tab (and with names like SOT-223, TO-252, TO-263, DPAK, and D²PAK), or more advanced packages like the "DirectFET" (see Figure 9.46). For power dissipation greater than about 5 watts the packages (with names like TO-3, TO-220, and TO247) will have mounting holes for attachment to a substantial heatsink; and really high power semiconductors come in modules (like the "miniBLOC" or "Powertap" - see Figure 9.47) meant for mounting off-PCB. With adequate heatsinking the latter types can dissipate up to 100 watts or more. With the exception of "isolated" power packages, the metal surface of the device is electrically connected to one terminal (e.g., for bipolar power transistors the case is connected to the collector, and for power MOSFETs to the drain).

The whole point of heatsinking is to keep the transistor junction (or the junction of some other device) below some maximum specified operating temperature. For silicon transistors in metal packages the maximum junction temperature is usually $200^{\circ} \mathrm{C}$, whereas for transistors in plastic packages it is usually $150^{\circ} \mathrm{C} .{ }^{33}$ Heatsink design is then simple: knowing the maximum power the device will dissipate in a given circuit, you calculate the junction temperature, allowing for the effects of heat conductivity

[^487]in the transistor, heatsink, etc., and the maximum ambient temperature in which the circuit is expected to operate. You then choose a heatsink large enough to keep the junction temperature well below the maximum specified by the manufacturer. It is wise to be conservative in heatsink design, because transistor life decreases rapidly at operating temperatures near or above maximum. Figure 9.42 shows a representative sample of heatsinks that we gathered from our lab's supply drawers.

Some people are cavalier about thermal design, and start worrying only if the component sizzles when they touch it with a wet finger. But it's far better to do it right initially! Read on...

#### A. Thermal resistance

To carry out heatsink calculations, you use thermal resistance, $R_{\theta}$, defined as heat rise (in ${ }^{\circ} \mathrm{C}$ ) divided by power transferred. For power transferred entirely by heat conduction, the thermal resistance is a constant, independent of temperature, that depends only on the mechanical properties of the joint. For a succession of thermal joints in "series," the total thermal resistance is the sum of the thermal resistances of the individual joints. Thus, for a transistor mounted on a heatsink, the total thermal resistance from transistor junction to the outside (ambient) world is the sum of the thermal resistance from junction to case $R_{\theta \mathrm{JC}}$, the thermal resistance from case to heatsink $R_{\theta \mathrm{CS}}$, and the thermal resistance from heatsink to ambient $R_{\theta \mathrm{SA}}$. The temperature of the junction is therefore

$$
\begin{equation*}
T_{\mathrm{J}}=T_{\mathrm{A}}+\left(R_{\theta \mathrm{JC}}+R_{\theta \mathrm{CS}}+R_{\theta \mathrm{SA}}\right) P \tag{9.2}
\end{equation*}
$$

where $P$ is the power being dissipated.
Let's take an example. The power-supply circuit of Figure 9.25, with 8 V unregulated dc input and full load (1 A) has a maximum LM317AT regulator dissipation of 4.7 W (4.7 V drop, 1 A ). Let's assume that the power supply is to operate at ambient temperatures up to $50^{\circ} \mathrm{C}$, not unreasonable for electronic equipment packaged together in close quarters. And let's try to keep the junction temperature below $100^{\circ} \mathrm{C}$, well below its specified maximum of $125^{\circ} \mathrm{C}$.

The allowable temperature difference from junction to ambient is thus $50^{\circ} \mathrm{C}$, so the total thermal resistance from junction to ambient must be no more than $R_{\theta \mathrm{JA}}=$ $\left(T_{\mathrm{J}}-T_{\mathrm{A}}\right) / P=10.6^{\circ} \mathrm{C} / \mathrm{W}$. The specified thermal resistance from junction to case, $R_{\theta \mathrm{JC}}$, is $4^{\circ} \mathrm{C} / \mathrm{W}$, and the TO-220 power transistor package mounted with a heat-conducting pad has a thermal resistance from case to heatsink of about $0.5^{\circ} \mathrm{C} / \mathrm{W}$. So we've used up $R_{\theta \mathrm{JC}}+R_{\theta \mathrm{CS}}=$ $4.5^{\circ} \mathrm{C} / \mathrm{W}$ of thermal resistance, leaving $R_{\theta \mathrm{SA}}=6.1^{\circ} \mathrm{C} / \mathrm{W}$ for the heatsink. A quick scan of the ever-helpful DigiKey
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0658.jpg?height=882&width=1621&top_left_y=207&top_left_x=235)

Figure 9.42. Heatsinks come in an impressive diversity, from little clip-on fins (I-L), to mid-sized PCB-mounting types (A-C, N, O, T), to large bolt-down units ( $\mathrm{U}, \mathrm{W}$ ), to forced-air type used with microprocessors $(\mathrm{X})$. The corresponding thermal resistance from sink to ambient, $R_{\Theta S A}$, ranges from about $50^{\circ} \mathrm{C} / \mathrm{W}$ down to about $1.5^{\circ} \mathrm{C} / \mathrm{W}$. A TO-3 insulating cover is shown in (Y), along with shoulder washers and hole plugs; greaseless thermal insulating pads are shown in (Z). We've added alphabetic labels so readers can identify objects of interest when chatting on social media.
catalog finds many candidates, for example the Wakefield 647-15ABP "vertical board mounting" finned heatsink, with the requisite $R_{\theta \mathrm{SA}}=6.1^{\circ} \mathrm{C} / \mathrm{W}$ in still air ("natural convection"). They're priced at about $\$ 2$, with 2000 pieces in stock. With a "forced convection" of 400 LFM (linear feet per minute) we could use instead the smaller (and cheaper, about \$0.35) model 270-AB; DigiKey's got 4000 in stock today.

Here's a "sizzle-test" for checking for adequate heatsinking: touch the power transistor with a dampened finger - if it sizzles, it's too hot! (Be careful when using this "rule-of-finger" test to explore around high voltages.) More generally approved methods for checking component temperatures are (a) a contacting thermocouple or thermistor probe (these often come as standard equipment with handheld or benchtop digital multimeters); (b) special calibrated waxes that melt at designated temperatures (e.g., the Tempilstik ${ }^{\circledR}$ wax pencil kits from Tempil, Inc.); and (c) infrared non-contacting temperature probes, ${ }^{34}$ for example

[^488]the Fluke $80 \mathrm{~T}-\mathrm{IR}$, which generates $1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ or $1 \mathrm{mV} /{ }^{\circ} \mathrm{F}$ (switchable), operates from $-18^{\circ} \mathrm{C}$ to $+260^{\circ} \mathrm{C}$, is accurate to $3 \%$ of reading (or $\pm 3^{\circ} \mathrm{C}$, if greater), and plugs into any handheld or benchtop DMM.

#### B. Comments on heatsinks

1. Where very high power dissipation (several hundred watts, say) is involved, forced air cooling is usually necessary. Large heatsinks designed to be used with a blower are available with thermal resistances (sink to ambient) as small as $0.05^{\circ} \mathrm{C}$ to $0.2^{\circ} \mathrm{C}$ per watt.
2. In cases of such high thermal conductivity (low thermal resistance, $R_{\theta \mathrm{SA}}$ ), you may find that the ultimate limit to power dissipation is in fact the transistor's own internal thermal resistance, combined with its attachment to the heatsink (i.e., $R_{\theta \mathrm{JC}}+R_{\theta \mathrm{CS}}$ ). This problem has been exacerbated in recent years by the evolution of smaller ("shrink") semiconductor chip sizes. The only solution

[^489]here is to spread the heat among several power transistors (in parallel or in series). When paralleling power transistors you have to be careful to make sure they share the current equally - see §2.4.4 and Figure 3.117.

Similarly, when connecting transistors in series, make sure that their off-state voltage drops are evenly distributed.
3. Figure 9.43, adapted from the Wakefield Engineering heatsink literature, gives a rough estimate of the physical volume of heatsink required to achieve a given thermal resistance. Note that curves are given for still air (natural convection) and for two values of forced air flow. Don't take these curves too literally - we just gathered data from a half dozen representative heatsinks, and then drew trend lines through them; they're probably good to a factor of two, but don't rely on it (or, at least, don't complain to us later!).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0659.jpg?height=516&width=786&top_left_y=964&top_left_x=130)

Figure 9.43. Rough guide to heatsink size needed for a given thermal resistance from sink to ambient ( $\left.R_{\theta \mathrm{SA}}\right)$.
4. When the transistor must be insulated from the heatsink, as is usually necessary (especially if several transistors are mounted on the same sink), a thin insulating washer is used between the transistor and sink, and insulating bushings are used around the mounting screws. Washers are available in standard transistor-shape cutouts made from mica, anodized (insulated) aluminum, beryllia (BeO), or polymer films such as Kapton ${ }^{\circledR}$. Used with heat-conducting grease, these add from $0.14^{\circ} \mathrm{C} / \mathrm{W}$ (beryllia) to about $0.5^{\circ} \mathrm{C} / \mathrm{W}$.

An attractive alternative to the classic mica-washer-plus-grease is provided by greaseless silicone-based insulators that are loaded with a dispersion of a thermally conductive compound, usually boron nitride or aluminum oxide (" Z " in Figure 9.42). They're clean and dry and easy to use; you don't get white slimy stuff
all over your hands, your electronic device, and your clothes. You save lots of time. The electrically insulating types have thermal resistances of about $1-4^{\circ} \mathrm{C} / \mathrm{W}$ for a TO-220 package footprint, comparable to values with the messy method; the non-insulating ("grease replacement") varieties do better - down in the $0.1-0.5^{\circ} \mathrm{C} / \mathrm{W}$ for a TO-220 package. Bergquist calls its product line "SilPad," Chomerics calls its "Cho-Therm," and Thermalloy calls its "Thermasil." We've been using these insulators, and we like them.
5. Small heatsinks are available that simply clip over the small transistor packages (like the standard TO-92 and TO-220, "I-L" in Figure 9.42). In situations of relatively low power dissipation (a watt or two) this often suffices, avoiding the nuisance of mounting the transistor remotely on a heatsink with its leads brought back to the circuit. In addition, there are various small heatsinks intended for use with the plastic power packages (many regulators, as well as power transistors, come in this package) that mount right on a PCB underneath the package. These are very handy in situations of a few watts dissipation; a typical unit is illustrated in Figure 2.3. If you've got vertical space over the PCB, it's often preferable to use a PCB-mounting stand-up heatsink (like A-C, N, O, or T in Figure 9.42), because these types take up less area on the PCB.
6. Surface-mount power transistors (such as the SOT-223, DPAK, and $D^{2}$ PAK) carry their heat to the foil layer of a PCB via the soldered tab; here we're talking a few watts, not a hundred. You can see these packages in Figures 2.3 and 9.44 . Figure 9.45 plots approximate values of thermal resistance versus foil area; these should be considered only a rough guide, because the actual heatsinking effectiveness depends on other factors such as the proximity of other heat-producing components, board stacking, and (for natural convection) board orientation.
7. Sometimes it may be convenient to mount power transistors directly to the chassis or case of the instrument. In such cases it is wise to use conservative design (keep it cool), especially because a hot case will subject the other circuit components to high temperatures and thus shorten their lives.
8. If a transistor is mounted to a heatsink without insulating hardware, the heatsink must be insulated from the chassis. The use of insulating washers (e.g., Wakefield model 103) is recommended (unless, of course, the transistor case happens to be at ground). When the transistor is insulated from the sink, the heatsink may be attached directly to the chassis. But if the transistor is accessible from outside the instrument (e.g., if the heatsink is
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0660.jpg?height=486&width=795&top_left_y=206&top_left_x=225)

Figure 9.44. Power transistors come in convenient handsolderable surface-mount packages that can dissipate up to several watts, through their mounting tab and leads, when soldered to a few square centimeters of foil area on a PCB (see Figure 9.45). The top three packages (SOT-223, DPAK, D²PAK) are good for $\sim 3 \mathrm{~W}$ when mounted on $6 \mathrm{~cm}^{2}$ of PCB foil area; the smaller packages in the row below can dissipate $\sim 0.5 \mathrm{~W}$ when similarly mounted. By way of comparison, the rectangular parts at lower right are chip resistors, tapering down from 2512 size to 0201 size (0603 metric).
mounted externally on the rear wall of the box), it is a good idea to use an insulating cover over the transistor (e.g., Thermalloy 8903N, "Y" in Figure 9.42) to prevent someone from accidentally coming in contact with it or shorting it to ground.
9. The thermal resistance from heatsink to ambient is usually specified for the sink mounted with the fins vertical and with unobstructed flow of air. If the sink is mounted differently, or if the air flow is obstructed, the efficiency
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0660.jpg?height=588&width=761&top_left_y=1530&top_left_x=239)

Figure 9.45. Approximate thermal resistance of isolated printedcircuit foil patterns. A soldermask layer (SMOBC means soldermask over bare copper) reduces the effectiveness, particularly when compared with forced air over exposed copper.
will be reduced (higher thermal resistance ${ }^{35}$ ); usually it is best to mount it on the rear of the instrument with fins vertical.
10. In the second edition of this book there is additional information: see Chapter 6 (Figure 6.6, page 315) on heatsinks, and Chapter 12 (Table 12.2 and Figure 12.17, page 858) on cooling fans.

Exercise 9.7. An LM317T (TO-220 case), with a thermal resistance from junction to case of $R_{\Theta \mathrm{JC}}=4^{\circ} \mathrm{C} / \mathrm{W}$, is fitted with an Aavid Thermalloy 507222 bolt-on heatsink, whose thermal resistance is specified as $R_{\Theta \mathrm{SA}} \approx 18^{\circ} \mathrm{C} / \mathrm{W}$ in still air. The thermal pad (Bergquist SP400-0.007) specifies a thermal resistance of $R_{\Theta \mathrm{CS}} \approx 5^{\circ} \mathrm{C} / \mathrm{W}$. The maximum permissible junction temperature is $125^{\circ} \mathrm{C}$. How much power can you dissipate with this combination at $25^{\circ} \mathrm{C}$ ambient temperature? How much must the dissipation be decreased per degree rise in ambient temperature?

### 9.4.2 Safe operating area

The point of heatsinking is to keep junction temperatures within specified limits, given some ambient temperature and some maximum power dissipation, as just described. Of course, you must stay also within the specified voltage and current ratings of the power transistor. This is displayed graphically as a dc safe-operating-area (SOA) plot, on axes of transistor voltage and current, at some specified case temperature (usually an unrealistic $T_{\mathrm{C}}=25^{\circ} \mathrm{C}$ ). For MOSFETs this plot (on logarithmic voltage and current axes) is bounded simply by straight lines representing maximum voltage, maximum current, and maximum power dissipation (at the specified $T_{\mathrm{C}}$, as set by $R_{\theta \mathrm{JC}}$ and $T_{\mathrm{J}(\max )}$ ) - see, for example, Figure 3.95.

There are two amendments to this basic picture.

#### A. Second breakdown

The bad news: in the case of bipolar transistors the SOA is further constrained by a phenomenon known as second breakdown, an important failure mechanism that you must keep in mind when designing power electronics with bipolar transistors. This is discussed in $\S 3.6 .4 \mathrm{C}$, where the effect can be seen in the SOA plots in Figure 3.95 as a further reduction of allowable collector current at high voltages. Because MOSFET power transistors are largely immune to second breakdown, they are often favored over BJTs for power-regulator pass transistors (the exceptions are some newer small-geometry types, see IR App Note IN-1155).

[^490]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0661.jpg?height=985&width=1582&top_left_y=214&top_left_x=158)

Figure 9.46. An extended selection of power packages, shown here and in Figure 9.47. The leadless packages in the bottom row require "reflow" solder techniques (trade in your soldering iron and wire solder for an oven and solder-paste dispenser!).

#### B. Transient thermal resistance

The good news: for pulses of short duration you can exceed the dc power-dissipation limit, sometimes by a large factor. That is because the mass of the semiconductor itself can absorb a short pulse of energy by heating locally ("heat capacity" or "specific heat"), limiting the temperature rise even if the instantaneous power dissipation is more than could be sustained continuously. This can be seen in the SOA plot (Figure 3.95), where the allowable power dissipation, for $100 \mu \mathrm{~s}$ pulses, is some 20 times greater than the dc value: an astonishing 3000 W versus 150 W . This is sometimes characterized on datasheets as a transient thermal resistance - a plot of $R_{\theta}$ versus pulse duration. The ability to dissipate very high peak power during short pulses extends to other electronic devices, for example, diodes, SCRs, and transient voltage suppressors. See §3.6.4C and the discussion in Chapter $9 x$.

## 9.5 From ac line to unregulated supply

A regulated power supply that runs from ac line power
begins ${ }^{36}$ by generating "unregulated" dc, a subject we introduced in $\S 1.6 .2$ in connection with rectifiers and ripple calculations. For the linear voltage regulators we've seen so far, the unregulated dc supply uses a transformer, both

[^491]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0662.jpg?height=850&width=1450&top_left_y=218&top_left_x=321)

Figure 9.47. The larger cousins of the power packages in Figure 9.46, with three specimens from the latter shown for comparison. We're up in the tens to hundreds of watts with these when they are mounted on an appropriate heatsink.
to convert the incoming line voltage ( 120 Vrms in North America and a few other countries, 220 or 240 Vrms most everywhere else) to a (usually) lower voltage closer to the regulated output, and also to isolate the output from any direct connection to the hazardous line potentials ("galvanic isolation"); see Figure 9.48. Perhaps surprisingly, the switching power supplies we'll see shortly omit the transformer, generating line-derived dc at the powerline potential ( $\sim 160 \mathrm{Vdc}$ or $\sim 320 \mathrm{Vdc}$ ), which powers the switching circuit directly. The essential galvanic isolation ${ }^{37}$ is achieved instead with a transformer driven by the highfrequency switching signal. ${ }^{38}$

Transformer-isolated unregulated dc supplies are useful, also, for applications in which the stability and purity of regulated dc is unnecessary, for example high-power audio amplifiers. Let's look at this subject in more detail, beginning with the circuit shown in Figure 9.49. This is an unregulated $\pm 50$ volt (nominal) split supply, capable of 2 A output current, for a 100 watt linear audio amplifier. Let's

[^492]go through it from left to right, pointing out some of the things to keep in mind when you do this sort of design.

### 9.5.1 ac-line components

#### A. Three-wire connection

Always use a 3-wire line cord with ground (green or green/yellow) connected to the instrument case. Instruments with ungrounded cases can become lethal devices in the event of transformer insulation failure or accidental connection of one side of the powerline to the case. With a grounded case, such a failure simply blows a fuse. You often see instruments with the line cord attached to the chassis (permanently) using a plastic "strain relief," made by Heyco or Richco. A better way is to use an IEC (International Electrotechnical Commission) three-prong male chassis-mounted connector, to mate with those popular line cords that have the three-prong IEC female molded onto the end. That way the line cord is conveniently removable. Better yet, you can get a combined "power-entry module," containing IEC connector, fuse holder, line filter, and switch, as we've used here. Note that ac wiring uses a nonintuitive color convention: black = "hot" (or "line"), white $=$ neutral, and green $=$ ground (or "protective earth"). ${ }^{39}$

[^493]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0663.jpg?height=307&width=1491&top_left_y=209&top_left_x=132)
A. Linear
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0663.jpg?height=531&width=1670&top_left_y=566&top_left_x=114)

Figure 9.48. ac-line-powered ("offline") dc-output regulated supplies. A. In the linear supply the powerline transformer both isolates and transforms the input voltage. B. In the switching ("switchmode") converter the ac input is directly rectified to high-voltage dc, which powers the isolating switching converter. The PFC block performs power-factor correction, discussed later in §9.7.1C.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0663.jpg?height=486&width=1610&top_left_y=1272&top_left_x=144)

Figure 9.49. Unregulated $\pm 50 \mathrm{~V}, 2 \mathrm{~A}$ power supply.

#### B. Fuse

A fuse, breaker, or equivalent function should be included in every piece of electronic equipment. A fuse holder, switch, and lowpass filter are often combined in the power entry module, but you can also wire them à la carte. The large wall fuses or circuit breakers (typically 15-20 A) in house or lab won't protect electronic equipment, because they are chosen to blow only when the current rating of the wiring in the wall is exceeded. For instance, a house circuit wired with 14-gauge wire will have a 15 A circuit breaker.

Now, if a storage capacitor in our unregulated supply becomes short-circuited someday (a possible failure mode), the transformer might then draw 10 A primary current (instead of its usual 2-3 A). The house breaker won't open, but your instrument becomes an incendiary device, with its transformer dissipating over a kilowatt.

Some notes on fuses. (a) It is best to use a "slowblow" type in the power-line circuit, because there is invariably a large current transient ("inrush current") at turn-on, caused mostly by rapid charging of the power-supply filter
capacitors. (b) You may think you know how to calculate the fuse current rating, but you're probably wrong. A dc power supply of this design ${ }^{40}$ has a high ratio of rms current to average current, because of the small conduction angle (fraction of the cycle over which the diodes are conducting). The problem is worse if overly large filter capacitors are used. The result is an rms current considerably higher than you would estimate. The best procedure is to use a "true rms" ac current meter to measure the actual rms line current, then choose a fuse of at least $50 \%$ higher current rating (to allow for high line voltage, the effects of fuse "fatigue," etc.). (c) When wiring cartridge-type fuse holders (used with the popular 3AG/AGC/MDL type fuse, which is almost universal in electronic equipment), be sure to connect the leads so that anyone changing the fuse cannot come in contact with the powerline. This means connecting the "hot" lead to the rear terminal of the fuse holder (the authors have learned this the hard way!). Commercial power-entry modules with integral fuse holders are cleverly arranged so that the fuse cannot be reached without removing the line cord.

#### C. Switch

In Figure 9.49 the switch is integral with the power entry, which is fine, but it forces the user to reach around the back to turn the thing on. When using a front-panel power switch, it's a good idea to put a line-rated capacitor (called X1 or X2) across its terminals, to prevent arcing. For similar reasons the transformer primary should have some bridging capacitance, which in this case is taken care of by the lowpass filter in the entry module.

#### D. Lowpass filter

Although they are often omitted, such filters are a good idea, because they serve the purpose of preventing possible radiation of radiofrequency interference (RFI) from the instrument via the powerline, as well as filtering out incoming interference that may be present on the powerline. These filters typically use an $L C$ " $\pi$-section" filter (as in the figure), with the coupled inductor pair acting as a common-mode impedance. Power-line filters with excellent performance characteristics are available from several manufacturers, e.g., Corcom, Cornell-Dubilier, Curtis, Delta, Qualtek, and Schurter. ${ }^{41}$ Studies have shown that spikes as large as 1 kV to 5 kV are occasionally present on

[^494]the powerlines at most locations, and smaller spikes occur quite frequently. Line filters (in combination with transient suppressors, see below) are reasonably effective in reducing such interference (and thereby extending the life of a power supply and the equipment it powers).

#### E. Line-voltage capacitors

For reasons of fire and shock hazard, capacitors intended for line filtering and bypassing are given special ratings. Among other attributes, these capacitors are designed to be self-healing, i.e., to recover from internal breakdown. ${ }^{42}$ There are two classes of line-rated capacitors: " $X$ " capacitors (X1, X2, X3) are rated for use where failure would not create a shock hazard. They are used across the line $\left(C_{\mathrm{X}}\right.$ in Figure 9.49; the common X2 type is rated for 250 Vac , with peak voltage of 1.2 kV ). "Y" capacitors (Y1, Y2, Y3, Y4) are rated for use where failure would present a shock hazard. They are used for bypassing between the ac lines and ground ( $C_{\mathrm{Y}}$ in Figure 9.49; the common Y2 type is rated for 250 Vac , with a peak voltage of 5 kV ). Line-rated capacitors come in disc ceramic and in plastic-film flavors; the latter are usually a box geometry, with a flame retardant case. It's hard to miss these capacitors - they are usually festooned with markings proclaiming the various national certifications whose standards they meet ${ }^{43}$ (Figure 9.50).

A further word about line-voltage capacitors: when the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0664.jpg?height=521&width=698&top_left_y=1321&top_left_x=1146)

Figure 9.50. ac-line-rated capacitors flamboyantly display their safety ratings (right), compared with the minimalist decoration of a plain ol' film capacitor (left).

[^495]instrument is unplugged, the X capacitor may be left holding the peak ac line voltage, up to 325 V , which appears across the exposed power plugs! This can cause electrical shocks, and spark discharges. That's why there's a parallel discharge resistor, sized for a safe time constant of less than a second. ${ }^{44}$ Here the Qualtek RFI filter module uses $1 \mathrm{M} \Omega$, and the Astrodyne switching supply (§9.8) uses $540 \mathrm{k} \Omega$. The latter continuously dissipates 100 mW when powered with 220 Vac line input, which could constitute one of the largest standby power losses in an "Energy Star" design. Power Integrations offers their CAPZero ${ }^{\mathrm{TM}}$ IC to solve this problem. This clever part works by looking for an ac-linevoltage reversal every 20 ms or less, and if it fails to see one it turns on, connecting two discharge resistors across the X capacitor.

Some designs have substantial high-voltage dc storage capacitors that need to be discharged when the power is off. Because of their large capacitance, the ac-sensing CAPZero would not work. Here you could use normallyon relay contacts, and energize the relay when external ac power is present. Or, if you don't like moving parts, a high-voltage depletion-mode MOSFET (see Table 3.6 on page 210) and a photovoltaic stack (see §12.7.5, Figure 12.91 A ) can do the job.

#### F. Transient suppressor

In many situations it is desirable to use a "transient suppressor" (or "metal-oxide varistor," MOV) as shown in Figure 9.49. The transient suppressor is a device that conducts when its terminal voltage exceeds certain limits (it's like a bidirectional high-power zener). These are inexpensive and small and can shunt hundreds of amperes of potentially harmful current in the form of spikes. Note the thermal cutout fuse: that protects in a situation in which the MOV starts to conduct partially (for example if the line voltage becomes highly elevated, or if an aged MOV exhibits lowered breakdown voltage from having absorbed large transients). Transient suppressors are made by a number of companies, e.g., Epcos, Littelfuse, and Panasonic. Effective transient suppression is an interesting challenge, and we discuss it further in Chapter $9 x$.

#### G. Shock hazard

It is a good idea to insulate all exposed line-voltage connections inside any instrument, for example by using polymer heat-shrink tubing (the use of "friction tape" or electrical tape inside electronic instruments is strictly bush-league).

[^496]Because most transistorized circuits operate on relatively low dc voltages ( $\pm 15 \mathrm{~V}$ or less), from which it is not possible to receive a shock, the powerline wiring is the only place where any shock hazard exists in most electronic devices (there are exceptions, of course). The front-panel $\mathrm{ON}-\mathrm{OFF}$ switch is particularly insidious in this respect, being close to other low-voltage wiring. Your test instruments (or, worse, your fingers) can easily come in contact with it when you go to pick up the instrument while testing it.

### 9.5.2 Transformer

Now for the transformer. Never build an instrument to run off the powerline without an isolating transformer! To do so is to flirt with disaster. Transformerless power supplies, which have been popular in some consumer electronics (radios and televisions, particularly) because they're inexpensive, put the circuit at high voltage with respect to external ground (water pipes, etc.). ${ }^{45}$ This has no place in instruments intended to interconnect with any other equipment and should always be avoided. And use extreme caution when servicing any such equipment; just connecting your oscilloscope probe to the chassis can be a shocking experience.

The choice of transformer is more involved than you might at first expect. It may be hard to find a transformer with the voltage and current ratings you need. We have found the Signal Transformer Company unusual, with their nice selection of transformers and quick delivery. And don't overlook the possibility of having transformers custom-made if your application requires more than a few.

Even assuming that you can get the transformer you want, you still have to decide on the voltage and current rating. If the unregulated supply is powering a linear regulator, then you want to keep the unregulated dc voltage low, in order to minimize the power dissipation in the pass transistors. But you must be absolutely certain the input to the regulator will never drop below the minimum necessary for regulation (typically 2 V above the regulated output voltage, for conventional regulators like the LM317; or 0.5-1 V for low-dropout types) or you may encounter 120 Hz dips in the regulated output; in the design you need to allow for low line voltage ( $10 \%$ below nominal, say -105 Vac in the US) or even brownout conditions ( $20 \%$ below nominal). The amount of ripple in the unregulated output is involved

[^497]here, because it is the minimum input to the regulator that must stay above some critical voltage (see Figure 1.61), but it is the average input to the regulator that determines the transistor dissipation.

As an example, for a +5 V regulator you might use an unregulated input of +10 V at the minimum of the ripple, which itself might be 1 to 2 volts peak-to-peak. From the secondary voltage rating you can make a pretty good guess of the dc output from the bridge, because the peak voltage (at the top of the ripple) is approximately 1.4 times the rms secondary voltage, less two diode drops. But it is essential to make actual measurements if you are designing a power supply with near-minimum drop across the regulator, because the actual output voltage of the unregulated supply depends on poorly specified parameters of the transformer, such as winding resistance and magnetic coupling (leakage inductance), both of which contribute to voltage drop under load. Be sure to make measurements under worst-case conditions: full load and low power-line voltage ( 105 V ). Remember that large filter capacitors typically have loose tolerances: $-30 \%$ to $+100 \%$ about the nominal value is not unusual. It is a good idea to use transformers with multiple taps on the primary (the Triad F-90X series, for example), when available, for final adjustment of output voltage.

For the circuit shown in Figure 9.49, we wanted $\pm 50 \mathrm{~V}$ output under full load. Allowing for two diode drops (from the bridge rectifier) we need a transformer with $\sim 52 \mathrm{~V}$ peak amplitude, or about 37 Vrms . Among the available transformer choices, the closest was the 40 Vrms unit shown, probably a good choice because of the effects of winding resistance and leakage inductance, which reduce slightly the loaded dc output voltage.

An important note: transformer current ratings are usually given as $r m s$ secondary current. However, because a rectifier circuit draws current only over a small part of the cycle (during the time the capacitor is actually charging), the secondary's rms current, and therefore the $I^{2} R$ heating, will be significantly larger than the average rectified dc output current. So you have to choose a transformer whose rms current rating is somewhat larger (typically $\sim 2 \times$ ) than the dc load current. Ironically, the situation gets worse as you increase capacitor size to reduce output ripple voltage. Full-wave rectification is better in this respect, because a greater portion of the transformer waveform is used. For the unregulated dc supply of Figure 9.49 we measured an rms current of 3.95 A at the transformer secondary when powering a 2 A dc load. The measured waveforms in Figure 9.51 show the pulsating nature of the current, as the rectified transformer output recharges the storage capacitors each half-cycle.

Naïvely you might expect that the conduction angle (fraction of the cycle during which the current flows) could be estimated simply by (a) calculating the capacitor's discharge between half-cycles, according to $I=C d V / d t$, then (b) calculating the time in the next half-cycle at which the rectified output exceeds the capacitor's voltage. However, this pretty scheme is complicated by the important effects of the transformer's winding resistance and leakage inductance, and the storage capacitor's ESR, all of which extend the conduction angle. ${ }^{46}$ The best approach is to make measurements on the bench, perhaps informed by SPICE simulations using known or measured values of these parameters. In §9.5.4 we show results of such simulations.

### 9.5.3 dc components

#### A. Storage capacitor

The storage capacitors (sometimes called filter capacitors) are chosen large enough to provide acceptably low ripple voltage, with a voltage rating sufficient to handle the worstcase combination of no load and high line voltage (125130 Vrms ).

At this point it may be helpful to look back at $\S 1.7 .16 \mathrm{~B}$, where we first discussed the subject of ripple. In general, you can calculate ripple voltage with sufficient accuracy by assuming a constant-current load equal to the average load current. (In the particular case that the unregulated supply drives a linear regulator, the load in fact is accurately a constant-current sink). This simplifies your arithmetic, since the capacitor discharges with a ramp, and you don't have to worry about time constants or exponentials (the measured waveforms in Figure 9.51, taken with a resistive load, illustrate the validity of this approximation).

For the circuit shown in Figure 9.49, we wanted approximately 1 Vpp output ripple at full 2 A load. From $I=C d V / d t$ we get (with $\Delta t=8.33 \mathrm{~ms}$ ) $C=I \Delta t / \Delta V=$ $16,700 \mu \mathrm{~F}$. The nearest capacitor voltage ratings are 63 V and 80 V ; we chose the latter, in an abundance of caution. The available $16,000 \mu \mathrm{~F} / 80 \mathrm{~V}$ capacitors are somewhat large physically ( 40 mm diameter $\times 80 \mathrm{~mm}$ long), so we decided to put a pair of $8200 \mu \mathrm{~F}$ capacitors ( 35 mm $\times 50 \mathrm{~mm}$ ) in parallel (using smaller capacitors in parallel

[^498]also reduces the overall series inductance of the capacitor). Good design practice calls for the use of storage capacitors whose ripple current rating is conservatively larger than the value estimated from the dc output current and the conduction angle. In the above circuit, for example, we designed for a maximum dc load current of 2 A , from which we estimated an rms current of about 4 A in both the transformer secondary and the storage capacitor. The particular capacitors shown in the figure have a ripple current rating of 5.8 Arms at $85^{\circ} \mathrm{C}$ for each $8200 \mu \mathrm{~F}$ capacitor of the parallel pair, thus 11.6 Arms when combined to make either $C_{1}$ or $C_{2}$. This is definitely conservative! You can also calculate the heating, from the ESR specification of $0.038 \Omega$ (maximum) per capacitor: each parallel pair has an ESR no greater than $19 \mathrm{~m} \Omega$, which produces a heating power of $P=I_{\mathrm{rms}}^{2} R_{\mathrm{ESR}} \approx 0.15 \mathrm{~W}$ in each capacitor.

When choosing filter capacitors, don't get carried away: an oversize capacitor not only wastes space but also increases transformer heating (by reducing the conduction angle, hence increasing the ratio of rms current to average current). It also increases stress on the rectifiers. But watch out for loose capacitance tolerance: although the capacitors we used here have a rated tolerance of $\pm 20 \%$, electrolytic storage capacitors can be as loose as $+100 \% /-30 \%$.

The resistors $R_{2}$ and $R_{3}$ across the output in Figure 9.49 serve two purposes: they provide a minimum load (to keep the unloaded output from "soaring"); and they act as "bleeders" to discharge the capacitors when the unloaded supply is turned off. This is a good feature, because power supplies that stay charged after things have been shut off can easily lead you to damage some circuit components if you mistakenly think that no voltage is present.

#### B. Rectifier

The first point to be made is that the diodes used in power supplies (usually referred to as "rectifiers") are quite different from the small 1N914- or 1N4148-type signal diodes used in circuitry. Signal diodes are generally designed for high speed (a few nanoseconds), low leakage (a few nanoamps), and low capacitance (a few picofarads), and they can generally handle currents up to about 100 mA , with breakdown voltages rarely exceeding 100 volts. By contrast, rectifier diodes and bridges for use in power supplies are hefty objects with current ratings going from 1 A to 25 A or more, and breakdown voltage ratings going from 100 V to 1000 V or more. They have relatively high leakage currents (in the range of microamps to milliamps) and plenty of junction capacitance. General-purpose rectifiers of the sort used in Figure 9.49 are not intended for high speed, unnecessary for operation at the powerline
frequency of 60 Hz . By contrast, in switching power supplies it's necessary to use high-speed rectifiers because of the characteristic switching frequencies of $20 \mathrm{kHz}-1 \mathrm{MHz}$; there the use of "fast recovery" or Schottky-barrier rectifiers (or MOSFETs used as "synchronous rectifiers"47) is universal.

Typical of general-purpose rectifiers are the popular $1 N 4001-1 N 4007$ series, rated at 1 A , and the $1 \mathrm{~N} 5400-$ 1N5408 series, rated at 3 A , with reverse-breakdown voltages ranging from 50 to 1000 volts. The 1N5817-1N5822 series of Schottky rectifiers come in axial lead packages, with current ratings of $1-3 \mathrm{~A}$, and voltage ratings of $20-40 \mathrm{~V}$. Rectifiers with higher current ratings require heatsinking, and come in packages similar to power transistors (TO-220, D² PAK, stud-mount, etc). Examples are the MBR1545 and 30CTQ045 dual Schottky rectifiers (available in TO-220 or $\mathrm{D}^{2} \mathrm{PAK}$ power packages), rated at 15 A and 30 A , respectively, at 45 V , and the MUR805 to MUR1100 6 A rectifiers (in TO-220 packages), with voltage ratings to 1 kV . Plastic-encapsulated bridge rectifiers are quite popular also, with lead-mounted 1 A to 6 A types, and heatsink mountable packages in ratings up to 35 A or more. ${ }^{48}$

#### C. Damping network

The series $R C$ across the transformer secondary in Figure 9.49 is often omitted, but it shouldn't be. This simple linear unregulated dc supply has the surprising ability to generate substantial microsecond-scale voltage spikes, which can create strong 120 Hz interference and other forms of mischief. It turns out that a pair of non-ideal characteristics (transformer leakage inductance, combined with rectifier reverse recovery time) work together to create a train of periodic sharp spikes, whose amplitude can be tens of volts. This nasty effect is easily tamed with a series $R C$ "snubber" network, as shown. There's some interesting stuff going on here; you can read more about it (and see a dramatic example) in $\S 9 x .6$.

### 9.5.4 Unregulated split supply - on the bench!

We built the power supply of Figure 9.49, mostly out of curiosity to see how closely the actual device compared

[^499]with our predictions. Figure 9.51 shows the ac voltage and current at one end of the transformer secondary, and the positive dc output voltage, with the power supply driving $\pm 2 \mathrm{~A}$ resistive loads. The waveforms are pretty much as expected: (a) the ripple voltage is about 0.8 Vpp , somewhat less than our 1 Vpp estimate; our calculation was conservative, though, because we assumed the storage capacitors had to supply output current for a complete half-period $\left(1 / 2 f_{\text {ac }} \approx 8 \mathrm{~ms}\right)$, whereas in reality recharging begins after $\sim 6 \mathrm{~ms}$; (b) the dc output voltage ( 54 V ) is somewhat higher than expected, probably because the transformer voltage rating is for the full-rated load current of 4 A , and also because the powerline voltage in our lab was $3 \%$ above nominal; with no load the output rose to 60 V , typical of unregulated supplies; (c) the transformer current is confined to a fairly narrow conduction angle (about $60^{\circ}$ of each $180^{\circ}$ half-cycle), as expected; during conduction the ac waveform at the transformer secondary is flattened by the heavy load current because of the combined effects of leakage inductance and winding resistance. ${ }^{49}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0668.jpg?height=519&width=789&top_left_y=1077&top_left_x=228)

Figure 9.51. Measured waveforms for the unregulated dc power supply of Figure 9.49 driving $\pm 2 \mathrm{~A}$ loads. Horizontal scale: $4 \mathrm{~ms} / \mathrm{div}$.

With a 2 A dc load on both outputs, the measured rms transformer current was 3.95 Arms. This doubling is caused by the shortened conduction angle: the average transformer current equals the dc output current, but the $r m s$ current is greater. This is sometimes described as a reduced power factor (the ratio of average input power to rms input power), an effect that is important in switching power supplies. With some cleverness it is possible

[^500]to rectify incoming powerline ac to dc while maintaining nearly unity power factor, by means of a "power-factor correction" (PFC) input circuit; we'll explore this cleverness, briefly, in §9.7.1C.

## And on the computer! (SPICE)

To explore the effects of component imperfections (winding resistance and leakage inductance in the transformer, series resistance in the capacitors) we ran a SPICE simulation (see Appendix J) of this circuit, beginning with measured parameters where possible (e.g., transformer resistance and inductances), values found in the SPICE libraries (e.g., rectifier forward voltage versus current) and plausible guesses for series resistance in the storage capacitors. With just a small amount of adjustment we obtained the simulation shown in Figure 9.52 (presented at the same scale factors as in Figure 9.51). The agreement is impressive (although the simulation somewhat underestimates the conduction angle, thus higher-than-measured transformer current). ${ }^{50}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0668.jpg?height=537&width=784&top_left_y=1076&top_left_x=1077)

Figure 9.52. Waveforms from a SPICE simulation of the unregulated dc power supply of Figure 9.49, plotted on the same scales as those of Figure 9.51.

### 9.5.5 Linear versus switcher: ripple and noise

Coming next is the fascinating subject of switching regulators and power supplies. These have become dominant, owing to their combination of excellent efficiency, small
${ }^{50}$ The dominant circuit parameters used are: transformer primary $R=0.467 \Omega, L_{\mathrm{L}}=1.63 \mu \mathrm{H}, L_{\mathrm{M}}=80 \mathrm{mH}$, turns ratio of 0.365 , transformer secondary $R=0.217 \Omega, L_{\mathrm{L}(\mathrm{sec})}=20 \mu \mathrm{H}$, damping network $C_{\mathrm{s}}=0.5 \mu \mathrm{~F}, R_{\mathrm{s}}=30 \Omega$, rectifier "KBPC806" (Vishay 8A, 600V bridge), storage capacitor $C=14,000 \mu \mathrm{~F}, \mathrm{ESR}=0.01 \Omega$, load resistors $27 \Omega$ (each side).
size and weight, and low cost. However, all is not roses: the rapid switching process generates transients at the switching frequency and its harmonics, and these can be extremely difficult to filter effectively. We'll discuss this soon enough...but it's worth taking a look now at Figure 9.53, where the bad stuff on the outputs of two 5 V power supplies are compared.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0669.jpg?height=537&width=810&top_left_y=525&top_left_x=110)

Figure 9.53. Comparing linear and switching power supply noise. All measurements are into a resistive load at $50 \%$ of rated current. A. Linear $5 \mathrm{~V}, 0.3 \mathrm{~A}$ supply, showing $\sim 0.5 \mathrm{mVpp} 120 \mathrm{~Hz}$ ripple. B. Switching $5 \mathrm{~V}, 2.5 \mathrm{~A}$ supply, measured directly across the output pins, showing $\sim 6 \mathrm{mVpp}$ ripple at the 50 kHz switching frequency (note scale change). C. Same switcher, but measured at a connected load 50 cm away (and with another factor of $\times 20$ scale change), showing the large ( $\sim 150 \mathrm{mV}$ ) switching spikes induced by high-frequency ground currents; note the frequency dithering seen in this persistent capture. D. Expanded trace of a single induced pulse, showing ringing at $\sim 15 \mathrm{MHz}$.

## 9.6 Switching regulators and dc-dc converters

### 9.6.1 Linear versus switching

All the voltage-regulator circuits we have discussed so far work the same way: a linear control element (the "pass transistor") in series with the dc input is used, with feedback, to maintain constant output voltage (or perhaps constant current). ${ }^{51}$ The output voltage is always lower in voltage than the input voltage, and significant power is dissipated in the control element, namely $P_{\text {diss }}=I_{\text {out }}\left(V_{\text {in }}-V_{\text {out }}\right)$. As we've seen, the dc input to a linear regulator may be simply another (higher) regulated dc voltage within the system; or it may be unregulated dc that is derived from the

[^501]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0669.jpg?height=639&width=797&top_left_y=221&top_left_x=974)

Figure 9.54. Averaged frequency spectrum of the switching power supply of Figure 9.53, showing the dithered $\sim 50 \mathrm{kHz}$ switching frequency and its harmonics.
powerline, via the by-now familiar transformer-rectifiercapacitor circuit.

Let's look a bit more at the issue of efficiency. Power supplies with linear regulators are necessarily inefficient, because the pass transistor carries the full load current, and it must have enough voltage drop to accommodate a worst-case combination of input ripple and low line voltage. The situation is exacerbated for low-output-voltage supplies: for example, a linear regulator to deliver +3.3 V at 10 A would use an unregulated dc voltage of perhaps +6 V to ensure adequate headroom; so you've got 27 W of pass-transistor dissipation while delivering 33 W to the load - that's 55\% efficiency. You may not care that much about efficiency per se; but the wasted power has to be dissipated, which means a large heatsink area, blowers, etc. If you were to scale up this example to 100 A, say, you would have a serious problem removing the quarter of a kilowatt (!) of pass-transistor heat. You would have to use multiple pass transistors and forced-air cooling. The supply would be heavy, noisy, and hot.

There is another way to generate a regulated dc voltage (shown earlier in Figure 9.48B), which is fundamentally different from what we've seen so far - look at Figure 9.55. In this switching converter a transistor, operated as a saturated switch, periodically applies the full unregulated voltage across an inductor for short intervals. The inductor's current builds up during each pulse, storing $\frac{1}{2} L I^{2}$ of energy in its magnetic field. When the switch is turned off, some
or all ${ }^{52}$ of this stored energy is transferred to a filter capacitor at the output, which also smooths the output (to carry the output load between charging pulses). As with a linear regulator, feedback compares the output with a voltage reference - but in a switching regulator it controls the output by changing the oscillator's pulse width or switching frequency, rather than by linearly controlling the base or gate drive. ${ }^{53}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0670.jpg?height=807&width=774&top_left_y=579&top_left_x=235)

Figure 9.55. Two kinds of regulators: A. linear (series-pass); B. switcher (step-up, or "boost").

#### Advantages of switching converters

Switching regulators have unusual properties that have made them very popular:
(a) Because the control element is either off or saturated, there is very little power dissipation; switching supplies are

[^502]thus very efficient, even when there is a large voltage difference between input and output. High efficiency translates to small size, because little heat needs to be dissipated.
(b) Switchers (slang for "switching power supplies") can generate output voltages higher than the unregulated input, as in Figure 9.55B; and they can just as easily generate outputs opposite in polarity to that of the input!
(c) The output storage capacitor can be small (in capacitance, and therefore in physical size), because the high operating frequency (typically $20 \mathrm{kHz}-1 \mathrm{MHz}$ ) corresponds to a very short time interval (a few microseconds) between recharging.
(d) For a switching supply operated from the ac powerline input, the essential isolation is provided by a transformer operating at the switching frequency; it is much smaller than a low-frequency powerline transformer (see Figure 9.1).

#### The good news

The combination of small capacitor and transformer size, along with little power dissipation, permits compact, lightweight, and efficient ac-powered dc supplies, as well as dc-to-dc converters. ${ }^{54}$ For these reasons, switching supplies (also known as switchmode power supplies, or SMPSs), are used almost universally in electronic devices such as computers, telecommunications, consumer electronics, battery-operated devices, and, well, just about everything electronic.

#### The bad news

Lest we leave too favorable an impression, we note that switching supplies do have their problems. The switching operation introduces "noise" into the dc output, and likewise onto the input powerline and as radiated electromagnetic interference (EMI); see Figures 9.53 and 9.54. Lineoperated switchers (confusingly called "off-line") exhibit a rather large "inrush current" when initially powered on. ${ }^{55}$

[^503]And switchers have suffered from a bad reputation for reliability, with occasional spectacular pyrotechnic displays during episodes of catastrophic failure.

#### The bottom line

Fortunately, switching supplies have largely overcome the drawbacks of their earlier brethren (unreliability, electrical and audible noise, inrush current and component stress). Because they are small, lightweight, efficient, and inexpensive, switchers have largely replaced linear regulators over the full range of load power (from watts to kilowatts) in contemporary electronics, and particularly in large commercial production. Linear supplies and regulators are still alive and well, however, particularly for simple low-power regulation and for applications requiring clean dc power; and this last feature - the absence of pervasive switching noise - can be of major importance in applications that deal with small signals.

### 9.6.2 Switching converter topologies

In the following sections we tell you all about switching regulators and power supplies (collectively called "switching converters"), in several steps.

- First (§9.6.3) we look briefly at inductorless converters, in which the energy is carried from input to output by capacitors, whose connections are switched with MOSFETs. These are sometimes called "charge-pump converters," or "flying-capacitor converters." These simple devices can double or invert a dc input voltage, and they're useful for relatively low current loads (up to $\sim 100 \mathrm{~mA}$ ).
- Next (§9.6.4) we describe converter topologies that use inductors, beginning with the basic dc-dc non-isolated switching converter, of the sort you would use within a circuit, or with battery power. There are three basic circuit topologies, used for (a) step-down (output voltage less than input), (b) step-up (output voltage greater than input), and (c) inverting (output polarity opposite to input). All of these use an inductor for energy storage during the switching cycle.
- Next (§9.6.10) we look at dc-dc converters in which a transformer couples the input and output circuits. In addition to providing galvanic isolation (which may or may not be needed), the transformer is desirable when there's a large ratio between input and output voltages. That is because the transformer's turns ratio provides a helpful voltage conversion factor that is absent in the nonisolated (transformerless) designs. Transformer designs
also let you produce multiple outputs, and of either polarity.
- Finally (§9.7) we describe how the isolated converter permits power-supply designs that run straight from the rectified ac powerline. These "offline" supplies are, of course, the bread and butter of most line-powered electronics. And they have their special problems, related to safety, interference, inrush current, power factor, and the like.

And, characteristically, we give you plenty of advice on the subject: when to use switchers, when to avoid them; when to design your own, when to buy them. With characteristic humility, we won't leave you in any doubt!

### 9.6.3 Inductorless switching converters

The term "switching converter" usually means a power converter that uses inductors (and sometimes transformers), along with high-frequency transistor switches, to carry out voltage conversion. However, there is an interesting class of inductorless converters (also known as chargepump converters, switched capacitor converters, or flyingcapacitor converters) that can do some of the same tricks generating an output voltage of opposite polarity, or an output voltage higher than the input. These converters are simpler and electrically quieter than converters with inductors, and they're handy when you need only a modest current (less than 100 mA or so). For example, you often have a source of +5 V (on a computer board, or a USB device), or perhaps +9 V from a battery, and you need a corresponding negative voltage because you want to run a dual-polarity op-amp. Just drop in a charge-pump inverter chip and two capacitors, and you're ready to go. ${ }^{56}$

Figure 9.56 shows how it goes: these devices have an internal oscillator and some CMOS switches, and they require a pair of external capacitors to do their job. When the input pair of switches is closed (conducting), $C_{1}$ charges to $V_{\text {in }}$; then, during the second half-cycle, $C_{1}$ is disconnected from the input and connected, upside-down, across the output. If $C_{2} \ll C_{1}$, then the output voltage goes nearly to $-V_{\mathrm{IN}}$ in one cycle of operation. In the more typical case of $C_{2} \geq C_{1}$ it takes a number of cycles, from cold start, for the output voltage to equilibrate to $-V_{\mathrm{IN}}$.

Similarly, you can create an output of $2 V_{\mathrm{in}}$, by arranging things so that $C_{1}$ charges as before, but then gets hooked in series with $V_{\text {in }}$ during the second (transfer) half-cycle

[^504]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0672.jpg?height=271&width=645&top_left_y=219&top_left_x=295)

Figure 9.56. Charge-pump voltage inverter. An oscillator operates the switch pairs in alternation: the left-hand switches charge "flying capacitor" $C_{1}$ to a voltage of $V_{\mathrm{IN}}$; the right-hand switches then apply that voltage, with reversed polarity, to the output storage capacitor $C_{2}$ 。
(Figure 9.57). The LT1026 and MAX680 conveniently integrate a positive doubler and an inverting doubler in one package: Figure 9.58 shows the simple circuitry required to generate an unregulated split supply from a single +5 V input.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0672.jpg?height=320&width=643&top_left_y=975&top_left_x=301)

Figure 9.57. Charge-pump voltage doubler. Here the voltage on the flying capacitor, charged to $V_{\mathrm{IN}}$, is added to the input voltage to generate an output voltage of twice $V_{\mathrm{IN}}$.

Figure 9.58. Generating a pair of unregulated $\pm 8 \mathrm{~V}$ outputs from a single +5 V input.

#### A. Limitations of inductorless converters

This charge-pump technique is simple and efficient, and requires few parts and no inductors. However, the output is not regulated, and it drops significantly under load (Figure 9.59). Also, in common with other switching power
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0672.jpg?height=536&width=763&top_left_y=385&top_left_x=1088)

Figure 9.59. The output voltage of a charge-pump converter drops significantly under load, as seen here with measured data for the circuit of Figure 9.58, with either bipolar (LT1026) or CMOS (MAX680) devices. MOSFET switches have no voltage drop at zero current, where $V_{\text {out }}$ is accurately equal to twice $V_{\text {in }}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0672.jpg?height=557&width=784&top_left_y=1186&top_left_x=1077)

Figure 9.60. Reducing ripple with a larger output capacitor: measured peak-to-peak ripple voltage for the LT1026 doubler-inverter.
conversion techniques, the switching operation produces output ripple, which however can be reduced by using larger output capacitors (Figure 9.60), or by appending a low-dropout linear regulator (see below). ${ }^{57}$ Furthermore, like most CMOS devices, charge pumps have a limited

[^505]Table 9.4 Selected Charge-pump Converters ${ }^{a}$

|  | Package |  |  |  |  |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| Part \# | ![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0673.jpg?height=132&width=127&top_left_y=319&top_left_x=280) | Config | $V_{\text {in }}$ <br> (V) | Vout <br> (V) | Rout typ @ ( $\Omega$ ) | @ $V_{\text {in }}$ <br> (V) | $\begin{aligned} & \text { Iout } \\ & (\mathrm{mA}) \end{aligned}$ | $f_{\text {osc }}$ typ <br> (kHz) | $I_{q}$ typ @ (mA) | @ $V_{\text {in }}$ <br> (V) | Comments |
| unregulated |  |  |  |  |  |  |  |  |  |  |  |
| LTC3261 | - - - $\cdot$ | inv | 4.5-32 | track | 35 | 12 | $50^{\text {e }}$ | 50-500 P | 7 | 15 | HV |
| TC962 | $\cdot$ - - - | inv, x2, x0.5 | 3-18 | track | 32 | 15 | 80 | 12 or $24^{p}$ | 0.5 | 15 | improved 7660/2 |
| LTC1144 | $\cdot$ $\cdot$ - - | inv, x0.5 | 2-18 | track | 56 | 15 | 50 | 10 or $100^{p}$ | P $1.1^{\mathrm{m}}$ | 15 | HV ver of 1044/7660/62 |
| ICL7662 ${ }^{\circ}$ | $\cdot$ $\cdot$ - - | inv, x0.5 | 9-20 or 4.5-11 | track | 55 | 15 | 50 | 10 | 0.15 | 12.5 | Maxim, orig Intersil |
| TC1044 ${ }^{\text {k }}$ |  | inv, x0.5 | 3-12 or 1.5-3.5 | track | 55 | 15 | 60 | 10 or $45^{p}$ | 0.15 | 12.5 | improved 7660; see (k) |
| LM2681 | - | x2, x0.5 | 2.5-5.5 ${ }^{\text {or }} 1.8-11^{\mathrm{h}}$ | $1^{\text {h }}$ track | 15 | 5 | 30 | 160 | 0.06 | 5 |  |
| ICL7660 ${ }^{\text {k }}$ | $\cdot$ | inv, x0.5 | 3-10 or 1.5-3.5 | 5 track | 30 | 10 | 40 | 10 or $35^{p}$ | 0.08 | 5 | classic, 5 manuf, see (k) |
| LT1026 | $\cdot$ $\cdot$ - - | inv \& x2 | 4-10 | track | b | - | 20 | - | 15 | 15 |  |
| MAX680 | $\cdot$ - - - | pos \& neg x2 | 2-6 | track | $100^{\text {c }}$ | 5 | 5 | 8 | 1 | 5 | MAX864 for 200kHz |
| MAX864 | - - - $\cdot$ | pos \& neg x2 | 1.8-6 | track | $40^{\mathrm{C}}$ | 5 | $15^{\text {d }}$ | 7-185 ${ }^{p}$ | $0.6-12^{p}$ | 5 |  |
| LM828 | - - $\cdot$ - | inv | 1.8-5.5 | track | 20 | 5 | 25 | 12 | 0.04 | 5 |  |
| LM2767 | - - $\cdot$ - | x2 | 1.8-5.5 | track | 20 | 5 | 25 | 11 | 0.04 | 5 |  |
| TPS6040x | - - $\cdot$ - | inv | 1.6-5.5 | track | 10 | 3 | 60 | 20-250i,q 0 | 0.06-0.49 | q 5 | $f_{\text {osc }}$ variable ('60400) |
| MAX660 | $\cdot$ $\cdot$ - - | inv, x2 | 1.5-5.5 | track | 6.5 | 5 | 100 | 10 or $80^{\text {p }}$ | 0.12 | 5 |  |
| regulated ${ }^{r}$ |  |  |  |  |  |  |  |  |  |  |  |
| LTC3260 | - - - $\cdot$ | dual LDO | 4.5-32 1.2- | 2-32 \& -1.2 to -32 | 0.03 | 12 | 50 | 200 | 4 | 15 | HV dual reg split supply |
| LT1054 | $\cdot$ | inv | 3.5-15 - | $-V_{\text {in }}$, or adj reg | 10 | - | 100 | 25 | 3 | 15 |  |
| ADP3605 | $\cdot$ - $\cdot$ | inv | 3-6 -3.0, | -3.0 , or -3 to -6 | 0.3 | 5 | 120 | 250 | 3 | 5 |  |
| ST662 | - - - | reg 12 V | 4.5-5.5 | 12 | 0.8 | 5 | 50 | $400^{i}$ | 0.1 | 5 | flash mem prog supply |
| MAX889 | $\cdot$ - | reg adj -Vout | 2.7-5.5 | -2.5 to $-V_{\text {in }}$ | 0.05 | 5 | 200 | 500-2000 ${ }^{x}$ | x 6 | 5 |  |
| MAX682 | $\cdot$ - $\cdot$ | reg 5V | 2.7-5.5 | $+5 \mathrm{~V}$ | $<1$ | 3 | 250 | 20-3000 ${ }^{\text {i,p }}$ | p 7.5 | 3.6 |  |
| REG710-vv | - - $\cdot$ - | buck-boost | 1.8-5.5 2.5 | 2.5, 2.7,...5.5 ${ }^{\mathrm{Vv}}$ | 2 | n | 30 | $1000^{\text {i }}$ | 0.07 | 3.3 | auto switch buck/boost |
| MAX1595-vv | - - - $\cdot$ | buck-boost | 1.8-5.5 | 3.3 or $5.0^{\mathrm{Vv}}$ | 1 | 3 | 125 | $1000^{i}$ | 0.23 | 3 | auto switch buck/boost |
| TPS6024x | - - - $\cdot$ | buck-boost | 1.8-5.5 2 | 2.7,3,3.3, $5^{\text {u }}$ | 0.7 | 3.3 | 40 | 160 | 0.25 | 3 | low noise ${ }^{v}$ |
| LTC1517-5 | - - $\cdot$ - | reg 5V | 2.7-5 | 5.0 | 1 | 3 | 50 | 800 | 0.006 | all | micropower reg 5V |
| LTC3200 | - - $\cdot$ $\cdot$ | reg 5V | 2.7-4.5 | +5V | 0.4 | 3.6 | 100 | $2000^{i}$ | 3.5 | 3.6 |  |
| LTC1682 | - $\cdot$ - $\cdot$ | LDO, adj Vout | t $1.8-4.4$ | 2.5-5.5 | 0.2 | 3 | 50 | 550 | 0.15 | 3 | x2 to LDO; low noise ${ }^{\text {w }}$ |
| LTC1502-3.3 | - $\cdot$ - $\cdot$ | reg 3.3V | 0.9-1.8 | 3.3 | $<0.2$ | 1 | $20^{\text {s }}$ | $500^{\text {i }}$ | 0.04 | 1 | single-cell to reg +3.3 V |
| TPS6031x | - - - $\cdot$ | x2 \& reg 3y | 0.9-1.8 | 3.0, 3.3 | $4^{\text {w }}, 0.3$ | 1 | 50 | $700^{i}$ | 0.03 | 1.5 | single-cell to reg $+3 \mathrm{~V}^{y}$ |
| NJU7670 | $\cdot$ - - - | neg x3 \& LDO | -2.6 to -6 | -8 to -18 | 5 | -5 | 20 | 2.5 | 0.08 | -5 | neg $V_{\text {in }}$, tripler plus LDO |

Notes: (a) all are inductorless, and require several external caps; "regulated" types include either internal linear LDO post-regulator, or regulation via control of switching; sorted within categories by decreasing maximum $V_{\text {in. }}$. (b) bipolar, see datasheet for typical $V_{\text {out }}$. (c) with other output unloaded. (d) both outputs loaded. (e) at max $f_{\mathrm{osc}}$. (g) in $x 2$ mode. (h) in $x 0.5$ mode. (i) high $f_{\mathrm{Osc}}$ allows small capacitors. (k) LV pin for low $V_{\text {in }}$ range; many mfgs, prefixes LMC, NJU, TC, TL; see also MAX/LTC/TC1044, 1144, and TC962. (m) maximum. (n) at $V_{\text {in }}=V_{\text {out }} / 2+0.8 \mathrm{~V}$. (o) or Si7661. (p) freq pin selectable or adjustable. (q) last digit of $\mathrm{p} / \mathrm{n}$ sets $f_{\mathrm{osc}}$, except TPS60400, where $f_{\text {osc }}$ varies cleverly with $V_{\text {in }}$ and $/$ out. (r) unreg outputs also available on most; unless marked "LDO," all regulate via control of switching. (s) at $V_{\text {in }}=1.2 \mathrm{~V}$. (u) last digit of $\mathrm{p} / \mathrm{n}$ sets $V_{\text {out. ( }}$ (v) $V_{\mathrm{n}}=170 \mu \mathrm{Vrms}$ in $B W=20 \mathrm{~Hz}-10 \mathrm{MHz}$. (vv) suffix selects $V_{\text {out. }}$ (w) $V_{\mathrm{n}}=60 \mu \mathrm{Vrms}$ in $B W=10 \mathrm{~Hz}-100 \mathrm{KHz}$, $600 \mu \mathrm{Vpp}$ for $10 \mathrm{~Hz}-2.5 \mathrm{MHz}$. (x) suffix sets $f_{\mathrm{osc}}$. (y) or reg +3.3 V ; unreg x 2 output also provided. (z) maximum usable.
supply-voltage range: the original charge-pump IC (the Intersil ICL7660) allows $V_{\text {in }}$ to range from +1.5 V to +12 V ; and although some successor devices (e.g., the LTC1144) extend this range to as much as +18 V , the trend is toward lower-voltage devices with greater output current and with other features. ${ }^{58}$ Finally, unlike inductive switching

[^506]converters (discussed next), which can generate any output voltage you want, the flying-capacitor voltage converter can generate only small discrete multiples of the input voltage. In spite of these drawbacks, flying-capacitor voltage converters can be very useful in some circumstances, for example to power a split-supply op-amp or a serial-port chip (see Chapters 14 and 15) on a circuit board that has only +5 volts available. Table 9.4 lists a selection of charge-pump voltage converters, illustrating a range of capabilities (voltage, regulation, output current, and so on).

#### B. Variations

There are interesting and useful flying-capacitor variations, many of which are listed in Table 9.4, which is organized into unregulated and regulated varieties (each sorted by maximum input voltage). The unregulated types represent variations on the original ICL7660, including its similarly named successors (from TI, NJR, Maxim, Microchip, etc.) and pin-compatible upgrades ('7662, '1044, '1144); such multiply-sourced jellybean parts are widely available and inexpensive. More recent parts, for example the lowvoltage TPS6040x, offer flexibility in switching frequency, and generally lower output resistance. Operation at higher frequency reduces output ripple (e.g., 35 mV at 20 kHz , but 15 mV at 250 kHz for the TPS6040x series), but it increases quiescent current (which goes from $65 \mu \mathrm{~A}$ to $425 \mu \mathrm{~A}$ in this example). ${ }^{59}$

The regulated types, like the LT1054 from LTC (with a maximum output current of 100 mA ), include an internal voltage reference and error amplifier, so you can connect feedback to regulate the output voltage; the internal circuitry accommodates this by adjusting the switching control. Other converters regulate the output by including an internal low-dropout linear regulator, for greatly reduced output ripple (at the expense of some additional voltage drop); examples are the LTC1550 and 1682 series, with less than 1 mV peak-to-peak output ripple. Note that most of the "regulated" types let you use them as unregulated converters, if you wish.

There are also converters that reduce the input voltage by a rational fraction, e.g., by a factor of $1 / 2$ or $2 / 3$ (see if you can figure out how that is done!). At the other end, there are converters that are voltage quadruplers, for example the LTC1502, which generates a regulated +3.3 V at 10 mA from an input of $0.9-1.8 \mathrm{~V}$ (e.g., to power digital logic from a single alkaline cell). ${ }^{60}$ And there are convert-

[^507]ers that can provide up to 500 mA of output current. Some charge-pump converters include internal capacitors, if you want to be especially lazy; but the selection is limited, and the price is high.

Finally, there is the LTC1043 uncommitted flyingcapacitor building block, with which you can do all kinds of magic. For example, you can use a flying capacitor to transfer a voltage drop measured at an inconvenient potential (e.g., a current-sensing resistor at the positive supply voltage) down to ground, where you can easily use it. The LTC1043 datasheet has eight pages of similarly clever applications.

Then there are integrated circuits that include charge pumps to power their primary functions:
(a) Many RS-232/485 driver-receiver chips are available with integral $\pm 10 \mathrm{~V}$ charge-pump supplies, to run from a single +5 V or +3.3 V supply. An example of the latter is the MAX3232E from Maxim (the originator of the MAX232, now widely second sourced), which can run from a single supply between +3 V and +5.5 V .
(b) Some op-amps use integral charge pumps to generate a voltage beyond the supply rail, so their inputs can operate rail-to-rail while maintaining a conventional highperformance architecture (see $\S 4.6 .3 \mathrm{~B}$ ); examples are the OPA369, LTC1152, and MAX1462-4.
(c) Charge pumps are used in many MOSFET "high-side drivers" (like the HIP4080 series from Intersil) and in fully integrated power MOSFETs (like the PROFET series of "smart highside high-current power switches" from Infineon); these generate the necessary above-the-rail gate bias for an $n$-channel MOSFET operating as a follower up at the positive rail. ${ }^{61}$
(d) Some complex digital logic devices (processors, memory) require elevated voltages, which they generate on-chip with charge pumps. The manufacturers are modest, and you don't even hear about these things.

### 9.6.4 Converters with inductors: the basic non-isolated topologies

The term switching converter (or switchmode converter ${ }^{62}$ ) is generally understood to mean a converter that uses some arrangement of inductors and/or transformers, in combination with transistor switches (usually MOSFETs, but also

[^508]IGBTs ${ }^{63}$ for high voltages), to carry out efficient dc-to-dc conversion. A common characteristic of all such converters is this: in the first portion of each switching cycle the source of input power is used to increase the current (and therefore the energy) in an inductor; that energy then flows to the output during the second portion of the switching cycle. Switchmode power conversion is a major and vital area of electronics, and these converters are used in just about every electronic device.

There are literally hundreds of switchmode circuit variations, but they can be pared down to a few fundamental topologies. In this section we describe the three basic nonisolated designs - step-down, step-up, and invert - shown in Figure 9.61. After that we look at isolated converter designs; then we conclude with a look at the use of isolated converters fed from the ac powerline. Tables of selected switchmode converters (Tables $9.5 \mathrm{a}, \mathrm{b}$ on pages 653 and 654) and controllers (Table 9.6 on page 658) appear later.

Along with the basic power-conversion topologies (which describe the circuitry that performs the voltage conversion itself), there is the important topic of regulation. Just as with linear voltage regulators, a sample of the output voltage is compared with a voltage reference in an error amplifier. Here, however, the error signal is used to adjust some parameter of the switching conversion, most often the pulse width; this is known as pulse width modulation (PWM). ${ }^{64}$

As we'll see, the pulse-width modulator circuits themselves fall into two categories (voltage mode and current mode), with important consequences in terms of response time, noise, stability, and other parameters. And, to introduce a bit of further complication, any of these switchmode circuit combinations may operate in a mode with the inductor's current dropping fully to zero by the end of each switching cycle, or in a mode in which the inductor's current never drops to zero. These modes of operation are known as discontinuous-conduction mode (DCM) and continuous-conduction mode (CCM), respectively, and they have major effects on feedback stability, ripple, efficiency, and other operating parameters of a switchmode regulator. We describe the basics of PWM with a few examples; but we will touch only lightly on the more advanced topics of voltage- versus current-mode PWM, and on loop compensation.

[^509]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0675.jpg?height=213&width=718&top_left_y=210&top_left_x=1024)
A. Buck (step-down)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0675.jpg?height=200&width=733&top_left_y=528&top_left_x=1026)
B. Boost (step-up)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0675.jpg?height=208&width=744&top_left_y=850&top_left_x=1031)
C. Invert (or inverting buck-boost)

Figure 9.61. The basic nonisolated switching converters. The switch is usually a MOSFET. Schottky diodes are commonly used for the rectifiers, as shown; however, a MOSFET can be used as an efficient synchronously switched "active rectifier."

### 9.6.5 Step-down (buck) converter

Figure 9.61A shows the basic step-down (or "buck") switching circuit, with feedback omitted for simplicity. When the switch is closed, $V_{\text {out }}-V_{\text {in }}$ is applied across the inductor, causing a linearly increasing current (recall $d I / d t=V / L$ ) to flow through the inductor. (This current flows to the load and capacitor, of course.) When the switch opens, inductor current continues to flow in the same direction (remember that inductors don't like to change their current suddenly, according to the last equation), with the "catch diode" (or "freewheeling diode") now conducting to complete the circuit. The inductor now finds a fixed voltage $V_{\text {out }}-V_{\text {diode }}$ across it, causing its current to decrease linearly. The output capacitor acts as an energy "flywheel," smoothing the inevitable sawtooth ripple (the larger the capacitor, the smaller the ripple voltage). Figure 9.62 shows the corresponding voltage and current waveforms, assuming ideal components. To complete the circuit as a regulator, you would of course add feedback, controlling either the pulse width (at constant pulse repetition rate) or the
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0676.jpg?height=835&width=718&top_left_y=220&top_left_x=258)

Figure 9.62. Buck converter operation. Inductor current ramps up during switch ON, and ramps down during switch OFF. The output voltage equals the input voltage times the duty cycle ( $\left.D \equiv t_{\text {on }} / T\right)$. In the case of continuous inductor current (CCM; as shown here) the output current is equal to the average inductor current.
repetition rate (with constant pulse width) from an error amplifier that compares the output voltage with a reference. ${ }^{65}$

For all three circuits of Figure 9.61 the voltage drop across the catch diode wastes energy, reducing the conversion efficiency. Schottky diodes (as shown) are often used to mitigate this, but the best solution is to add a second switch across or in place of the diode. This is called synchronous switching; see the "synchronous" column in Tables 9.5a,b and 9.6.

Output voltage What is the output voltage? In the steady state the average voltage across an inductor must be zero, because otherwise its current is continually growing (according to $V=L d I / d t) .{ }^{66}$ So, ignoring voltage drops in the diode and switch, this requires that $\left(V_{\text {in }}-V_{\text {out }}\right) t_{\text {on }}=V_{\text {out }} t_{\text {off }}$, or

$$
\begin{equation*}
V_{\text {out }}=D V_{\mathrm{in}} \tag{9.3}
\end{equation*}
$$

where the "duty cycle" (or "duty ratio") $D$ is the fraction of

[^510]the time the switch is $\mathrm{ON}, D=t_{\mathrm{On}} / T$, and $T$ is the switching period ( $T=t_{\text {on }}+t_{\text {off }}$ ).

You can think about this in another way: the $L C$ output network is a lowpass filter, to which is applied a chopped dc input whose average voltage is just $D V_{\text {in }}$. So, after smoothing, you get that average voltage as the filtered output. Note that, assuming ideal components, the output voltage from a buck converter running at fixed duty cycle $D$ from a fixed input voltage is intrinsically regulated: a change in load current does not change the output voltage; it merely causes the inductor's triangular current waveform to shift up or down, such that the average inductor current equals the output current. (This assumes continuous inductor current, or CCM, as we discuss below.)

Input current What is the input current? If we assume ideal components, the converter is lossless ( $100 \%$ efficiency), so the input power must equal the output power. Equating these, the average input current is $I_{\text {in }}=I_{\text {out }}\left(V_{\text {out }} / V_{\text {in }}\right) .{ }^{67}$
Critical output current We've been assuming continuous inductor conduction in the waveforms of Figure 9.62, and also in deducing that the output voltage is simply the input voltage times the switch duty cycle. Look again at the graph of inductor current: its average current must equal the output current, but its peak-to-peak variation (call it $\Delta I_{\mathrm{L}}$ ) is completely determined by other factors (namely $V_{\text {in }}, V_{\text {out }}, T$, and $L$ ); so there is a minimum output current for which the inductor stays in conduction, namely when $I_{\text {out }}=\frac{1}{2} \Delta I_{\mathrm{L}} \cdot{ }^{68}$ For output currents less than this critical load current, the inductor current reaches zero before the end of each cycle; the converter is then operating in discontinuous conduction mode, for which the output voltage would no longer remain stable at fixed duty cycle, but would depend on load current. Of greater importance, operating in DCM has a major effect on loop stability and regulation. For this reason many switching regulators have a minimum output current, in order to operate in CCM. ${ }^{69}$ As the following expressions show, the minimum load current for CCM is reduced by increasing the inductance, increasing the switching frequency, or both.

[^511]
#### A. Buck converter equations

(continuous-conduction mode)
From the preceding discussion and waveforms it is not terribly difficult to figure out that the ideal buck converter (Figure 9.61 A ), operating in continuous conduction mode, obeys these equations:

$$
\begin{align*}
\left\langle I_{\text {in }}\right\rangle & =I_{\text {out }} \frac{V_{\text {out }}}{V_{\text {in }}}=D I_{\text {out }}  \tag{9.3a}\\
\Delta I_{\text {in }} & =I_{\text {out }}  \tag{9.3b}\\
V_{\text {out }} & =V_{\text {in }} \frac{t_{\text {on }}}{T}=D V_{\text {in }}  \tag{9.3c}\\
D & =\frac{V_{\text {out }}}{V_{\text {in }}}  \tag{9.3d}\\
I_{\text {out }(\min )} & =\frac{T}{2 L} V_{\text {out }}\left(1-\frac{V_{\text {out }}}{V_{\text {in }}}\right) \\
& =\frac{T}{2 L} V_{\text {out }}(1-D),  \tag{9.3e}\\
\Delta I_{\mathrm{C}(\mathrm{out})} & =\frac{T}{L} V_{\text {out }}(1-D)  \tag{9.3f}\\
I_{\mathrm{L}(\mathrm{pk})} & =I_{\text {out }}+\frac{T}{2 L} V_{\text {out }}(1-D)  \tag{9.3~g}\\
L_{\min } & =\frac{T}{2} \frac{V_{\text {out }}}{I_{\text {out }}}(1-D) \tag{9.3h}
\end{align*}
$$

where $\left\langle I_{\text {in }}\right\rangle$ represents the time-averaged value of input current, and $\Delta I_{\text {in }}$ and $\Delta I_{\mathrm{C}(\text { out })}$ are the approximate peak-topeak ripple currents at input and output (important for capacitor selection ${ }^{70}$ ). The first equation holds regardless of mode (CCM or DCM). The expressions for minimum inductance and minimum output current represent the critical values to maintain CCM; for these expressions use the minimum output current and the maximum value of $V_{\text {in }}$, respectively.
Exercise 9.8. Take the challenge: derive these equations (and be sure to tell us if we got them wrong). Hint: for $I_{\text {out }}(\min )$ and $L_{\text {min }}$ use the fact that the output current $I_{\text {out }}$ equals half the peak-topeak inductor current variation $\Delta_{\mathrm{L}}$, at the threshold of CCM, as easily seen from the $\mathrm{I}_{\mathrm{L}}$ waveform in Figure 9.62.

#### B. Buck converter example -I

Let's do a buck regulator design, using a very simple (and inexpensive) controller chip, the MC34063 (Figure 9.63).

[^512]This controller dates back to the 1980s and costs about $\$ 0.50$. In spite of its ancient heritage, the MC34063 is quite popular for undemanding applications, because of its low price and simple design criteria; this 8 -pin part is manufactured by a half-dozen companies, and is supplied in the usual package styles (DIP, SOIC, SOP). It includes an oscillator, error amplifier and voltage reference, current-limit comparator, and a Darlington output pair with access to both collector and emitter. Its operation is unsophisticated: it does not use the more usual PWM (in which the switch conduction time during each cycle is varied continuously, as in Figure 9.72). Instead, switch conduction cycles are enabled as long as the voltage at the feedback (FB) input is less than the +1.25 V internal reference; otherwise they are inhibited. You can think of this as a crude form of PWM, in which the modulation consists of turning on the switch for a full cycle, then skipping enough cycles to approximate the needed ratio of switch ON/OFF. ${ }^{71}$ This feedback regulation scheme is known as hysteretic control.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0677.jpg?height=527&width=807&top_left_y=1035&top_left_x=969)

Figure 9.63. A popular $\$ 0.50$ switching converter. The external connections to both collector and emitter of the 1.5 A switch make it easy to implement buck, boost, or inverting converters.

For our design let's assume a +15 V input, and produce a +5 V regulated output for load currents up to 500 mA . Figure 9.64 shows the circuit. The design is straightforward:

1. Choose an operating frequency: we picked 50 kHz , half the chip's recommended maximum. For that frequency the datasheet specifies $C_{\mathrm{T}}=470 \mathrm{pF}$. The oscillator runs with a ratio $t_{\text {on }} / t_{\text {off }}=6$, so the switch conduction time is $t_{\text {on }}=17 \mu \mathrm{~s}$.
2. Calculate the inductor value so the converter operates

[^513]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0678.jpg?height=651&width=838&top_left_y=210&top_left_x=219)

Figure 9.64. Step-down regulator using the MC34063. In contrast to proportional PWM, the chip's simple bang-bang control eliminates the need for feedback compensation components. But performance suffers.
in DCM, ${ }^{72}$ assuming onset of CCM at minimum input voltage and maximum load current: at onset of CCM, the output current is half the peak inductor current, so, using $V=L d I / d t$ (and assuming a 1 V drop in the Darlington switch), we get $L=\left(V_{\text {in }}-V_{\text {sw }}-V_{\text {out }}\right) t_{\text {on }} / 2 I_{\text {out }}=153 \mu \mathrm{H}$. We'll use a standard value of $150 \mu \mathrm{H}$.
3. Calculate the value of sense resistor $R_{\mathrm{S}}$ to limit the peak current $I_{\mathrm{pk}}$ to somewhat greater than the expected 1 A , but no greater than the chip's 1.5 A rating: $R_{\mathrm{S}}=300 \mathrm{mV} / I_{\text {lim }}=$ $0.25 \Omega$ (for a 1.2 A current limit). ${ }^{73}$
4. Choose an output capacitor value to keep the ripple voltage below some acceptable value. You can estimate the ripple by calculating the capacitor's voltage rise during one cycle of switch conduction (during which its current goes from 0 to $I_{\mathrm{pk}}$ ), which gives a value $\Delta V=I_{\mathrm{pk}} t_{\mathrm{on}} / 2 C_{\text {out }}$. So an output capacitor of $220 \mu \mathrm{~F}$ results in a peak-to-peak ripple voltage of $\sim 40 \mathrm{mV}{ }^{74}$

Several comments. (a) This simple design will work, but the performance will be far from ideal. In particular, the crude bang-bang control, combined with discontinuousconduction operation, produces lots of output ripple, and even audible noise, caused by its intermittent pulsing.

[^514](b) The Darlington output connection prevents saturation in the output stage, with some loss of efficiency; this could be remedied by connecting the driver collector line ( $V_{\mathrm{D}}$ ) to the input supply, through a current limiting resistor of the order of $200 \Omega$. (c) The internal switch is limited to 1.5 A peak current, which is inadequate for output currents greater than 0.75 A ; this can be remedied with an external transistor switch, for example a pnp transistor or $p$ channel MOSFET (for this buck configuration). The main attractiveness here is the combination of very low cost, and lack of worries about feedback stability and compensation. You'll see this part used in relaxed applications such as cellphone chargers and the like. ${ }^{75}$

#### C. Buck converter example - II

Fortunately, there are very nice integrated switchers that implement proportional PWM and, furthermore, make it really easy to do a circuit design (many are listed in Tables $9.5 \mathrm{a}, \mathrm{b}$, discussed later). For example, National Semiconductor (part of Texas Instruments) has a series of "Simple Switcher ${ }^{\mathrm{TN}}$ " ICs, individually configured for buck, boost, or invert topologies, that include all the necessary feedback loop compensation components on-chip. ${ }^{76}$ They cover a voltage range up to 40 V or more, with currents to 5 A , and have built-in current limit, thermal limit, voltage reference, fixed-frequency oscillator, and (in some versions) features such as soft-start (see $\S 9.6 .8 \mathrm{G}$ ), frequency synchronization, and shutdown. Best of all, they make it dead simple to design a converter either by following the step-by-step recipes in the datasheets or by using free webbased design tools: you get the component values (including recommended component manufacturers' part numbers) and performance data.

Figure 9.65 shows such a design, in this case converting a 14 V input (from an automobile battery) to a +3.3 V output that can supply up to 5 A (to power digital logic). We followed the datasheet's recipe to get the component values and part numbers shown. With these components the efficiency is $80 \%$ and the output ripple is less than $1 \%$ of $V_{\text {out }}(\sim 30 \mathrm{mV}$ ).

The LM2677 we used (and other "simple switcher" successors) follow on from the original LM2574,75,76 series

[^515]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0679.jpg?height=776&width=1514&top_left_y=219&top_left_x=197)

Figure 9.65. Step-down regulator using the LM2677 "Simple Switcher" (complete with elegant built-in compensation). We followed the datasheet's design recipe to get the component values and recommended part numbers shown.
( $0.5 \mathrm{~A}, 1 \mathrm{~A}$, and 3 A , respectively), which run at 52 kHz and which are widely popular "jellybean" parts - they are inexpensive and available from many manufacturers. ${ }^{77}$ The LM2677 is a member of the improved LM2670 family, running at 260 kHz , with output-current ratings to 5 A ; it requires one additional capacitor ( $C_{\mathrm{B}}$ in the figure) to drive the 5 A low-drop MOSFET.

Several comments:
(a) This converter provides ten times the output current of the previous design (Figure 9.64), and with significantly improved performance in terms of regulation, ripple, and transient response. That comes at a cost (literally), namely an IC that costs ten times as much (about $\$ 5$, versus $\$ 0.50$ ). ${ }^{78}$
(b) The good efficiency is due in part to the use of an $n$-channel MOSFET whose gate is driven from a voltage higher than $V_{\text {in }}$, thanks to an internal charge pump; that's the purpose of the boost capacitor $C_{\mathrm{B}}$.
(c) Note the use of paralleled capacitors at the input and output. You see this often in switchmode converters, where it's important to keep ESR and ESL (equivalent series inductance) low: that reduces the voltage ripple caused by

[^516]ripple current, and also keeps the capacitors within their ripple-current ratings. ${ }^{79}$
(d) For a standard output voltage like the +3.3 V here, you can save two resistors by selecting a fixed-voltage version (LM2677-3.3); but the adjustable version (LM2677-ADJ) lets you choose your output voltage, and you don't have to keep multiple versions in stock in your laboratory.
(e) Note that the input current is a lot less than the output current, representing a power-conversion efficiency of $80 \%$; this is a major advantage over a linear regulator.
(f) Fixed efficiency means that if you increase the input voltage, the input current goes down: that's a negative resistance! This creates some amusing complications - for example you can get oscillation when the input is filtered with an $L C$ network, a problem that applies to ac powerline input converters as well.

Exercise 9.9. What is the maximum theoretical efficiency of a linear (series pass) regulator, when used to generate regulated +3.3 V from $\mathrm{a}+14 \mathrm{~V}$ input?

Exercise 9.10. What does a step-down regulator's high efficiency imply about the ratio of output current to input current? What is the corresponding ratio of currents, for a linear regulator?

[^517]
### 9.6.6 Step-up (boost) converter

Unlike linear regulators, switching converters can produce output voltages higher than their input. The basic nonisolated step-up (or "boost") configuration was shown in Figure 9.61B (repeated here as 9.66, and seen earlier, in Figure 9.55 , in comparison with the linear regulator). During switch conduction (point $Y$ near ground) the inductor current ramps up; when the switch is turned off, the voltage at point $Y$ rises rapidly as the inductor attempts to maintain constant current. The diode turns on, and the inductor dumps current into the capacitor. The output voltage can be much larger than the input voltage.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0680.jpg?height=202&width=725&top_left_y=838&top_left_x=260)

Figure 9.66. Basic boost (or "step-up") topology (non-isolated).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0680.jpg?height=779&width=677&top_left_y=1264&top_left_x=279)

Figure 9.67. Boost converter operation. Inductor current ramps up during switch on, and ramps down during switch OFF. The output voltage equals the input voltage divided by the fraction of the time the switch is OFF. In the case of continuous inductor current (CCM, as shown here) the input current is equal to the average inductor current.

#### A. Boost converter equations (continuous-conduction mode)

Figure 9.67 shows relevant voltage and current waveforms, assuming ideal components. As with the buck converter, it is not terribly difficult to figure out that the boost converter (Figure 9.61B), operating in continuous conduction mode, obeys these equations:

$$
\begin{align*}
\left\langle I_{\text {in }}\right\rangle & =I_{\text {out }} \frac{V_{\text {out }}}{V_{\text {in }}}=\frac{I_{\text {out }}}{1-D},  \tag{9.4a}\\
\Delta I_{\text {in }} & =\frac{T}{L} V_{\text {in }} D,  \tag{9.4b}\\
V_{\text {out }} & =V_{\text {in }} \frac{T}{t_{\text {off }}}=\frac{V_{\text {in }}}{1-D},  \tag{9.4c}\\
D & =1-\frac{V_{\text {in }}}{V_{\text {out }}},  \tag{9.4d}\\
I_{\text {out }(\min )} & =\frac{T}{2 L}\left(\frac{V_{\text {in }}}{V_{\text {out }}}\right)^{2}\left(V_{\text {out }}-V_{\text {in }}\right) \\
& =\frac{T}{2 L} V_{\text {out }} D(1-D)^{2},  \tag{9.4e}\\
\Delta I_{\mathrm{C}(\text { out })} & =\frac{I_{\text {out }}}{1-D},  \tag{9.4f}\\
I_{\mathrm{L}(\mathrm{pk})} & =\frac{I_{\text {out }}}{1-D}+\frac{T}{2 L} V_{\text {in }} D  \tag{9.4~g}\\
L_{\text {min }} & =\frac{T}{2 I_{\text {out }}}\left(\frac{V_{\text {in }}}{V_{\text {out }}}\right)^{2}\left(V_{\text {out }}-V_{\text {in }}\right) . \tag{9.4h}
\end{align*}
$$

The first equation holds regardless of mode (CCM or DCM ). The expressions for minimum inductance and minimum output current represent the critical values to maintain CCM; for these expressions use the maximum value of $V_{\text {in }}$ and (for $L_{\mathrm{min}}$ ) the minimum output current.

Exercise 9.11. Continuing the challenge: derive these equations. Hint: for $I_{\text {out }(\min )}$ and $L_{\min }$ use the fact that, at the threshold of CCM, the input current $I_{\text {in }}$ equals half the peak-to-peak inductor current variation $\Delta I_{\mathrm{L}}$, as easily seen from the $I_{\mathrm{L}}$ waveform in Figure 9.67.

Exercise 9.12. Why can't the step-up circuit be used as a stepdown regulator?

The design procedures for step-up (and inverting) converters are analogous to those for the buck converter, and so we will resist the temptation to display actual circuit examples.

### 9.6.7 Inverting converter

The inverting circuit (also known as an "inverting buckboost," or "negative buck-boost") was shown in Figure 9.61C (repeated here as 9.68). During switch conduction, a linearly increasing current flows from the input into the inductor (point $Z$ ) to ground. To maintain the current when the switch is open, the inductor pulls point $Z$ negative, as much as needed to maintain continuous current flow. Now, however, that current is flowing into the inductor from the filter capacitor (and load). The output is thus negative, and its average value can be larger or smaller in magnitude than the input (as determined by feedback); in other words, the inverting regulator can be either step-up or step-down.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0681.jpg?height=211&width=743&top_left_y=897&top_left_x=154)

Figure 9.68. Basic inverting (or "inverting buck-boost") topology (non-isolated).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0681.jpg?height=784&width=661&top_left_y=1292&top_left_x=190)

Figure 9.69. Inverting converter operation. Inductor current ramps up during switch ON, and ramps down during switch OFF. The output voltage is inverted in polarity, with a magnitude equal to the input voltage times the ratio of switch $t_{\text {on }} / t_{\text {off }}$ (for CCM, as shown here).

#### A. Inverting converter equations (continuous-conduction mode)

Figure 9.69 shows the relevant voltage and current waveforms of the inverting regulator, once again assuming ideal components. With more than a bit of struggle you can figure out that the inverting converter (Figure 9.61C), operating in continuous-conduction mode, obeys these equations:

$$
\begin{align*}
& \left\langle I_{\text {in }}\right\rangle=I_{\text {out }} \frac{V_{\text {out }}}{V_{\text {in }}}=-I_{\text {out }} \frac{D}{1-D},  \tag{9.5a}\\
& \Delta I_{\text {in }}=\frac{\left\langle I_{\text {in }}\right\rangle}{D},  \tag{9.5b}\\
& V_{\text {out }}=-V_{\text {in }} \frac{t_{\text {on }}}{t_{\text {off }}}=-V_{\text {in }} \frac{D}{1-D},  \tag{9.5c}\\
& D=\frac{\left|V_{\text {out }}\right|}{\left|V_{\text {out }}\right|+V_{\text {in }}},  \tag{9.5d}\\
& I_{\text {out }(\min )}=\frac{T}{2 L} V_{\text {out }}\left(\frac{V_{\text {in }}}{V_{\text {in }}+\left|V_{\text {out }}\right|}\right)^{2} \\
& =\frac{T}{2 L} V_{\text {out }}(1-D)^{2} \text {, }  \tag{9.5e}\\
& \Delta I_{\mathrm{C}(\mathrm{out})}=\frac{I_{\text {out }}}{1-D},  \tag{9.5f}\\
& I_{\mathrm{L}(\mathrm{pk})}=\frac{I_{\mathrm{out}}}{1-D}+\frac{T}{2 L} V_{\mathrm{in}} D,  \tag{9.5~g}\\
& L_{\text {min }}=\frac{T}{2} \frac{V_{\text {out }}}{I_{\text {out }}}\left(\frac{V_{\text {in }}}{V_{\text {in }}+\left|V_{\text {out }}\right|}\right)^{2} . \tag{9.5h}
\end{align*}
$$

As with the buck and boost converters, the first equation holds regardless of mode (CCM or DCM). The expressions for minimum inductance and minimum output current represent the critical values to maintain CCM; for these expressions use the maximum value of $V_{\text {in }}$ and (for $L_{\min }$ ) the minimum output current. In these equations we've used the absolute value symbol $\left(\left|V_{\text {out }}\right|\right)$ in the two places where the reader, unmindful of the opposite polarity of input and output voltage, could go seriously off the rails. ${ }^{80}$

Exercise 9.13. The final (and trickiest ${ }^{81}$ ) challenge: derive these equations. Hint: for $I_{\text {out }(\min )}$ and $L_{\min }$ use the fact that, at the threshold of CCM, the average inductor current $\left\langle I_{\mathrm{L}}\right\rangle$ equals half

[^518]the peak-to-peak inductor current variation $\Delta \Delta_{\mathrm{L}}$. Now figure out how $\left\langle I_{\mathrm{L}}\right\rangle$ is related to $I_{\text {in }}$ (or to $I_{\text {out }}$ ), and take it from there.

### 9.6.8 Comments on the non-isolated converters

This is a good place to pause, before moving on to the transformer-isolated switching converters, to discuss and review some issues common to these converters.

#### A. Large-voltage ratios

The ratio of output to input voltage in the basic nonisolated converters depends on the duty cycle ( $\left.D=t_{\text {on }} / T\right)$, as given in the formulas above. For modest ratios that works fine. But to generate a large ratio, for example a buck converter converting a +48 V input to $\mathrm{a}+1.5 \mathrm{~V}$ output, you wind up with undesirably short pulse widths (hence greater transistor stress, in the form of high peak voltages and currents, and lower efficiency). A better solution is to take advantage of a transformer, whose turns ratio provides an additional voltage transformation. We'll see soon how this is done, in the analogous isolated converter topologies (buck converter $\rightarrow$ forward converter; inverting converter $\rightarrow$ flyback converter).

#### B. Current discontinuity and ripple

The three basic converters behave quite differently in terms of input- and output-current pulsation. In particular, assuming the preferred continuous-conduction mode, the buck converter has continuous current being supplied to the output storage capacitor, but pulsed input current from the $+V_{\text {in }}$ supply; the boost converter has pulsed output current, but continuous input current; and the inverting converter has pulsed current at both input and output. Pulsed (discontinuous) currents are generally undesirable at high power levels because they require larger-value storage capacitors, with lower ESR/ESL, for comparable performance. There are some interesting converter topologies (discussed presently, $\S 9.6 .8 \mathrm{H}$ ) that address these problems; in particular, the Ćuk converter (Figure 9.70) boasts continuity of current at both input and output.

#### C. Regulation: voltage mode and current mode

We've talked little about the details of feedback and voltage regulation in switchmode converters, though the examples above illustrate two approaches: the simple bangbang pulse-skipping scheme of the MC34063-style regulator (Figure 9.64); and the more commonly used proportional PWM scheme implemented in Figure 9.65. In fact, PWM control can be done in two ways, known as voltage mode and current mode: in voltage-mode PWM, the error signal is compared with the internal oscillator's sawtooth (or triangular) waveform to set the switch-ON duration. By contrast, in current-mode PWM the switch's current, ramp-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0682.jpg?height=812&width=641&top_left_y=206&top_left_x=1159)

Figure 9.70. Converters allowing overlap of input and output voltage range. Both switches are operated together in the buck-boost (or "non-inverting buck-boost") configuration (A). The SEPIC (B) and Ćuk (C) configurations each use a single switch, but two (optionally coupled) inductors. The Ćuk "boost-buck" is inverting.
ing according to $V=L d I / d t$, replaces the sawtooth, and is compared with the error signal to terminate the switch's ON state, as shown below in Figure 9.71. We'll go into a bit more detail in §9.6.9.

#### D. Low-noise switchers

Switchers are noisy! Figure 9.53, which compared linear and switching 5 V power converters, shows several characteristics of this undesirable "feature": first, there is plenty of noise at the switching frequency, which typically falls in the $20 \mathrm{kHz}-1 \mathrm{MHz}$ range; second, the switching frequency may vary, ${ }^{82}$ causing interference over a range of frequencies; and, third, (and most distressingly) the switching signals can be nearly impossible to eliminate, propagating both as radiated signals and through ground currents.

[^519]Figure 9.53 illustrates this latter point well: the switching noise can be heavily bypassed at one point, as in Figure 9.53B; but just put your 'scope probe a few inches away (Figure 9.53C and D) and they're back!

This problem is widely recognized, and there are various approaches to cleaning up switcher noise. At a simple level, a low-dropout regulator at the output helps considerably, as does a simple $L C$ output filter. A more sophisticated approach is to use converter topologies that avoid current pulsations at the input and output (for example the Ćuk converter, $\S 9.6 .8 \mathrm{H}$ ), or that exploit the resonant properties of inductance and capacitance so that the switches are brought into conduction at moments when the voltage across them is near zero ("zero-voltage switching," ZVS), and are opened when the current is near zero ("zero-current switching," ZCS). Finally, some converters (typified by the LT1533, LT1534, LT1738, and LT3439) incorporate circuitry to limit the switching transistor's voltage and current slew rates, which reduces both radiated and groundconducted switching noise.

When thinking about switching converter noise, keep in mind that it emerges in multiple ways, namely:
(a) ripple impressed across the dc output terminals, at the switching frequency, typically of the order of $10-100 \mathrm{mV}$ peak-to-peak;
(b) common-mode ripple on the dc output (which you can think of as ground-line ripple current), which causes the kind of mischief seen in Figure 9.53C;
(c) ripple, again at the switching frequency, impressed onto the input supply;
(d) radiated noise, at the switching frequency and its harmonics, from switched currents in the inductors and leads.

You can get into plenty of trouble with switching supplies in a circuit that has low-level signals (say $100 \mu \mathrm{~V}$ or less). Although an aggressive job of shielding and filtering may solve such problems, you're probably better off with linear regulators from the outset.

#### E. Inductance tradeoffs

There's some flexibility in the choice of inductance. Usually you want to run PWM converters (but not bangbang converters like the MC34063 in our first example) in continuous-conduction mode, which sets a minimum inductance for a given switching frequency and value of minimum load current. A larger inductor lowers the minimum load current, reduces the ripple current for a given load current, and improves the efficiency; but a larger inductor also reduces the maximum load current, degrades the transient
response, ${ }^{83}$ and adds physical size to the converter. It's a tradeoff.

#### F. Feedback stability

Switching converters require considerably more care in the design of the frequency-compensation network than, say, an op-amp circuit. At least three factors contribute to this: the output $L C$ network produces a "2-pole" lagging phase shift (ultimately reaching $180^{\circ}$ ), which requires a compensating "zero"; the load's characteristics (additional bypass capacitance, nonlinearities, etc.) affect the loop characteristics; and the converter's gain and phase versus frequency characteristics change abruptly if the converter enters discontinuous-conduction mode. And, to add a bit more complexity into an already-complex situation, there are important differences between voltage-mode and current-mode converters: for example, the latter, which are better behaved in terms of $L C$-network phase shifts, exhibit a "subharmonic instability" when operated at switch duty cycles greater than $50 \%$ (this is addressed by a technique called slope compensation).

The easiest approach for the casual user is to choose converters with built-in compensation (for example, the Simple Switcher series, as in Figure 9.65), or converters that provide complete recipes for reliable external compensation. Regardless, the circuit designer (you!) should be sure to test the stuff you've designed. ${ }^{84}$

#### G. Soft start

When input voltage is initially applied to any voltageregulator circuit, feedback will attempt to bring the output to the target voltage. In the case of a switching converter, the effect is to command maximum duty cycle from the switch, cycle after cycle. This generates a large inrush current (from charging the output capacitor), but, worse, it can cause the output voltage to overshoot, with potentially damaging effects on the load. Worse still, the magnetic core of the inductor (or transformer) may saturate (reaching maximum flux density), whereupon the inductance drops precipitously, causing the switch current to spike. Core saturation is a major cause of component failure; you don't want it.

These problems are most severe in converters that run

[^520]from the ac powerline, where the transformerless input stage (diode bridge and storage capacitor) causes additional inrush current, and where that input power source can deliver plenty of peak current. Many switching controller chips therefore incorporate "soft-start" circuitry, which constrains the switch duty cycle to ramp up gradually upon initial startup; these are indicated in the "soft start" column of Tables 9.5a,b and 9.6.

#### H. Buck-boost topologies

For the buck converter, $V_{\text {out }}$ must be less than $V_{\text {in }}$, and for the boost converter $V_{\text {out }}$ must be greater than $V_{\text {in }}$, required in both cases to reset the inductor current. Sometimes you'd like a converter that permits the input voltage to vary around both sides of the output voltage (for example in a battery-operated device with 2.5 V digital logic, powered by two AA cells, which begins life with 3 V input, and ends at about 1.8 V ; or an automotive application, powered from a 12 V car battery, supplying 13.8 V running, but as little as 8 V starting and as much as 40 V in "load dump").

Although the inverting (buck-boost) converter (Figure 9.61 C ) allows the output voltage to be larger or smaller than the input, its polarity is reversed. Figure 9.70 shows three interesting configurations that allow overlap of the input- and output-voltage ranges. The first one is particularly easy to understand: both switches are operated simultaneously for a time $t_{\mathrm{on}}$, applying $V_{\mathrm{in}}$ across the inductor; during $t_{\text {off }}$ the inductor's current flows through the diode pair to the output. The output voltage, from the inductor's required volt-time equality (and ignoring voltage drops in the switch and diodes), is then simply $V_{\text {out }}=\left(t_{\text {on }} / t_{\text {off }}\right) V_{\text {in }}$. Typical examples of buck-boost converter ICs are the LTC3534 (internal MOSFET switches) and the LTC3789 (external MOSFET switches); both use synchronous MOSFET switches in place of Schottky diodes, i.e., four MOSFETs in all. For other converters with synchronous switching see the "synchronous" column in Tables $9.5 \mathrm{a}, \mathrm{b}$ on pages 653 and 654 and 9.6 on page 658.

The SEPIC (single-ended primary-inductance converter) and Ćuk ${ }^{85}$ converters have the advantage of requiring only a single controllable switch. And the Ćuk converter has the remarkable property of producing zero output ripple current when the inductors are coupled (wound on the same core). This latter property was discovered accidentally, but is now part of the vocabulary of switchmode practitioners, who call it "the zero-ripple phenomenon." And while we're praising the Cuk, it's worth noting that both input- and output-current waveforms are continuous, unlike the buck, boost, inverting, SEPIC, or buck-boost.

[^521]
### 9.6.9 Voltage mode and current mode

There are two approaches to implementing pulse-width modulation, as we mentioned earlier in $\S 9.6 .8 \mathrm{C}$; look at Figure 9.71.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0684.jpg?height=1116&width=854&top_left_y=440&top_left_x=1045)

Figure 9.71. Pulse-width modulation in switchmode regulators. (A) Voltage-mode PWM compares the integrated error signal ( $V_{\text {err }}=V_{\text {ref }}-\mathrm{FB}$ ) with the oscillator's sawtooth whereas (B) currentmode PWM substitutes the switch's ramping current waveform.

At the top level, both methods compare the output voltage with an internal voltage reference to generate an error signal. That is, both methods are voltage regulators (don't confuse "current mode" with current regulator). The difference is in the way the error signal is used to adjust the pulse width: in voltage-mode PWM, the error signal is compared with the internal oscillator's sawtooth waveform to control the switch's ON duration. ${ }^{86}$ In current-mode PWM, by

[^522]contrast, the ramping current in the inductor replaces the sawtooth, with the internal oscillator used to initiate each conduction cycle ${ }^{87}$ (Figures 9.71B and 9.72). Tables 9.5a,b and 9.6 indicate whether the SMPS IC employs a voltagemode or current-mode control loop.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0685.jpg?height=784&width=644&top_left_y=450&top_left_x=201)

Figure 9.72. Waveforms in voltage-mode and current-mode PWM.
How to choose? Before comparing their relative merits, we offer this sensible advice: select the switching regulator chip that has the features you want (in terms of voltage and current ratings, ease of design, price and availability, component count, etc.), and don't worry about how the chip designers did their job.

Now for the comparison.

#### A. Voltage mode

This has been the traditional form of PWM. Its advantages include
(a) the simplicity of analyzing a single feedback path,
(b) low output impedance from the power stage, and
(c) good noise margins (because of the internally generated ramp).

Its disadvantages include
(a) the need for careful loop compensation (because of the 2-pole $L C$ output filter), ${ }^{88}$
(b) slow loop response (especially in response to input

[^523]changes), and
(c) the need for separate current-limiting circuitry for the switch transistor(s).

#### B. Current mode

Current-mode control became popular beginning in the 1980s when its benefits became apparent. They include
(a) rapid response to input changes,
(b) inherent pulse-by-pulse current limiting of the switch current,
(c) improved phase margin in the outer voltage-feedback loop (because the power stage's output, being current-like, effectively removes the inductor's phase shift; i.e., one pole instead of two in the feedback loop), and
(d) the ability to parallel the outputs of several identical converters.

The disadvantages of current-mode control include
(a) the greater difficulty of analyzing two nested feedback loops (mitigated by widely separating their characteristic frequencies),
(b) intrinsically higher output impedance of the power stage (the output is more affected by load changes because the fast loop tends toward a constant-current output),
(c) susceptibility to noise, particularly at low load, and to resonances (because the PWM depends on the currentderived ramp),
(d) premature termination of switch's ON-state caused by the leading-edge current spike (from parasitic capacitances and diode recovery effects), and
(e) instabilities and subharmonic resonances at high duty cycle.

Clever fixes Circuit designers are clever, and they've figured out some nice tricks to address the problems of each method. The slow response of voltage-mode controllers to input changes can be fixed by adding an input feedforward signal to the sawtooth ramp, and the slow loop response can be alleviated by running at a higher switching frequency. For current-mode control the bag of tricks includes leading-edge blanking (to ignore the switch-ON current spike), and "slope compensation" (to restore stability at high duty cycle).
Choice of control mode: both are viable In contemporary practice both modes are viable, and plenty of controller ICs are available using either technique. As a general statement, voltage-mode converters are favored
(a) in noisy applications, or in applications with light load

[^524]Table 9.5a Voltage-mode Integrated Switching Regulators ${ }^{a}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0686.jpg?height=970&width=1674&top_left_y=283&top_left_x=209)

Notes: (a) all have integrated power switch(es), current-sensing, and (in some cases) loop compensation; listed in order of increasing switch current. (b) number of fixed voltages available; all except NCP1400A have adjustable versions. (c) H=hysteretic mode; $\mathrm{P}=\mathrm{PWM}$ fixed frequency; $T=\min t_{\text {off, }}$ max ton; $\mathrm{V} 2=O N s e m i{ }^{2}{ }^{2}$ " control. (d) adjustable current limit. (e) $B=B J T ; M=M O S F E T$. (f) see LMZ23608 for $V_{\text {in }}$ to 36 V . (g) typical number of external parts (not counting bypass caps); two numbers indicate fixed/adjustable.
(h) 60V for HV suffix. (m) adjustable current limit. ( n ) no adjustable version. (o) restart threshold. (p) CS51411 for 260 kHz.
(q) reduced freq or pulse skipping at low load. (s) parts with SHDN can have UVLO added with an ext circuit. (t) typical.
(u) plus $I_{\mathrm{Sw}} / 50$, etc., when the switch is ON (a power-dissipation issue if used with high $V_{\text {supply }}$ ). (v) plus BJT switch drive current, on BOOST pin, taken from low-voltage buck output. ( $x$ ) runs down to 0.9 volts. (y) runs down to 0.3 volts. ( $z$ ) runs down to 0.5 volts.
Comments: 1: pin compatible with LTC1375. 2: many second sources. 3: NCP3126 and 3127 for lower current. 4: negative
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0686.jpg?height=45&width=1613&top_left_y=1549&top_left_x=219) 8: single-cell stepup.
conditions, or
(b) where multiple outputs are derived from a common power stage (that is, in converters that use a transformer with multiple secondary windings).

Current-mode controllers are favored
(a) where fast response to input transients and ripple is important,
(b) where it is desirable to parallel multiple power supplies (e.g., for redundancy),
(c) where you want to avoid the complexities in designing a proper pole-zero loop compensation network, and
(d) in applications where fast pulse-by-pulse current limiting is important for reliability. ${ }^{89}$ Tables 9.5 a and 9.5 b list

[^525]selected "integrated" switching regulators, i.e., with internal power switch(es). See also Table 9.6 on page 658 for switching regulators that drive external MOSFETS, Table 3.4 (MOSFETS, page 188), and Table 3.8 (drivers, page 218).

### 9.6.10 Converters with transformers: the basic designs

The non-isolated switching converters of the previous sections can be modified to incorporate a transformer within
larger customers) prefer current-mode control over voltage-mode, as reflected in the shortened length of Table 9.5 a compared with Table 9.5 b, and by the paucity of voltage-mode controllers in the "control mode" column of Table 9.6.

Table 9.5b Selected Current-mode Integrated Switching Regulators ${ }^{a}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0687.jpg?height=1481&width=1582&top_left_y=244&top_left_x=158)

Notes: (a) listed by increasing switch current; all have integrated switch, current-sensing, and in some cases loop compensation; all have shutdown capability except LM2577; all have thermal shutdown. (b) no power shutdown function; also UC2577. (c) H=hysteretic curr mode; $M=$ Fixed peak current, with a minimum off time; $\mathrm{O}=\mathrm{var}$ freq fixed off time; $\mathrm{P}=\mathrm{PWM}$ fixed freq. (d) non-isolated boost higher voltages with a transformer. (e) with external parts. (f) suffix HV for 18 V version. (g) typical number of external parts (not counting bypass caps); two numbers indicates fixed/adjustable. (h) suffix HV for 60V version. (k) 5A for LM2587. (m) maximum. (n) also negative, -2.5 V . (o) restart threshold. (p) reduced freq or pulse skipping at low load. (r) reduced frequency during low $V_{\text {out. }}$ (s) parts with SHDN can have UVLO added with an external circuit. (t) typical. (u) plus $/ \mathrm{sw} / 50$, etc., when the switch is ON (a power-dissipation issue if used with high $V_{\text {supply) }}$ ). (v) plus BJT switch drive current, on BOOST pin, taken from low-voltage buck output. (w) low side. (x) transformer output.

Comments: 1: invert OK, especially +5 V to -5 V converter. 2: 60 V transients OK . 3: 60 V OK for $100 \mathrm{~ms} ; 3.3 \mathrm{~V}, 5 \mathrm{~V}$, and adj versions. 4: ADP2301 for 1.4 MHz . 5: just add external inductor; 11 fixed voltages, from 1.0 V to 3.3 V . 6: 5 V and ADJ, see LT1507 for 3.3V. 7: "simple switcher" nano. 8: buck plus LDO, ext sync to 2.5MHz. 9: power-good output; 500kHz for "A" version. 10: adj OFF time. 11: $100 \mu \mathrm{~A}$ no-load $I_{Q}$. 12: $80 \mu \mathrm{~A}$ no-load $I_{Q}$; transients OK to 60 V . 13: boost single-cell to $1.8 \mathrm{~V}-5.5 \mathrm{~V}$ out; $3.3 \mathrm{~V}, 5 \mathrm{~V}$, and adj versions. 14: good for LED constant current drive. 15 : single-cell boost or flyback. 16: "simple switcher" nano. 17: boost from single Li-ion cell. 18: operates down to 0.5 V input; $40 \mu \mathrm{~A}$ in burst mode. 19: can regulate output using transformer's primary voltage (no feedback resistors required). 20: low-noise, slew-rate control. 21: 12V, 15V, and ADJ versions. 22: $3.3 \mathrm{~V}, 5 \mathrm{~V}, 12 \mathrm{~V}$, and ADJ versions. 23: programmable slew rate, very quiet.
the switching circuitry. This serves three important purposes: (a) it provides galvanic isolation, which is essential for converters that are powered from the ac line; (b) even if isolation is not needed, the transformer's turns ratio gives you an intrinsic voltage conversion, so that you can produce large step-up or step-down ratios while staying in a favorable range of switching duty cycle; and (c) you can wind multiple secondaries, to produce multiple output voltages; that's how those ubiquitous power supplies in computers generate outputs of $+3.3 \mathrm{~V},+5 \mathrm{~V},+12 \mathrm{~V}$, and -12 V , all at the same time.

Note that these are not the heavy and ugly laminatedcore transformers that you use for the 60 Hz ac powerline: because they run at switching frequencies of hundreds to thousands of kilohertz, they do not require a large magnetizing inductance (the inductance of a winding, with all other windings open-circuited), and so they can be wound on small ferrite (or iron powder) cores. Another way to understand the small physical size of the energy-storage devices in switchmode converters - that is, the inductors, transformers, and capacitors - is this: for a given power output, the amount of energy passing through these devices in each transfer can be much less if those transfers are taking place at a much higher rate. And less stored energy $\left(\frac{1}{2} L I^{2}, \frac{1}{2} C V^{2}\right)$ means a smaller physical package. ${ }^{90}$

### 9.6.11 The flyback converter

The flyback converter (Figure 9.73A) is the analog of the inverting non-isolated converter. As with the previous nonisolated converters, the switch is cycled at some switching frequency $f($ period $T=1 / f$ ), with feedback (not shown) controlling the duty cycle $D=t_{\text {on }} / T$ to maintain regulated output voltage. As with the previous converters, the pulsewidth modulation can be arranged as voltage mode or current mode; and the secondary current can be either discontinuous (DCM) or continuous (CCM) from each cycle to the next, depending on load current.

What is new is the transformer, which in the flyback converter topology acts simply as an inductor with a tightly coupled secondary winding. During the switch-ON portion of the cycle, the current in the primary winding ramps up according to $V_{\text {in }}=L_{\mathrm{pri}} d I_{\mathrm{pri}} / d t$, flowing into the "dotted" terminal; during that time the output diode is reverse biased because of the positive voltage on the dotted terminals of both windings.

[^526]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0688.jpg?height=1433&width=749&top_left_y=184&top_left_x=1100)

Figure 9.73. Isolated switching converters. The flyback converter (A) uses an energy-storage inductor with a secondary winding, whereas the forward and bridge converters (B-D) each use a true transformer with no energy storage (and thus require an output energy-storage inductor). The diode $D_{\mathrm{R}}$ and tertiary winding in the forward converter is one of several ways to reset the core in this single-ended design. The dc blocking capacitor $C_{\mathrm{B}}$ in the H-bridge prevents flux imbalance and consequent core saturation; for the half-bridge the series pair of capacitors serves the same function, while acting also as the input storage capacitor.

During this phase the input energy is going entirely into the magnetic field of the transformer's core. It gets its chance to go somewhere else when the switch turns OFF: unlike the situation with a single inductor, with coupled inductors the requirement of continuity of inductor current
is satisfied if the current continues to flow in any of the windings. In this case the switch-ON current, flowing into the dotted terminal, transfers itself to a similarly directed current in the secondary, but multiplied by the turns ratio $N \equiv N_{\text {pri }} / N_{\text {sec }}$. That current flows to the output (and storage capacitor), ramping down according to $V_{\text {out }}=L_{\mathrm{sec}} d I_{\mathrm{sec}} / d t$. From equality of inductor volt-seconds, the output voltage is simply

$$
\begin{equation*}
V_{\mathrm{out}}=V_{\mathrm{in}} \frac{N_{\mathrm{sec}}}{N_{\mathrm{pri}}} \frac{t_{\mathrm{on}}}{t_{\mathrm{off}}}=V_{\mathrm{in}} \frac{N_{\mathrm{sec}}}{N_{\mathrm{pri}}} \frac{D}{1-D} \quad(\text { in } \mathrm{CCM}) \tag{9.6}
\end{equation*}
$$

And, as usual, efficiency is high, so power is (approximately) conserved:

$$
\begin{equation*}
I_{\text {in }}=I_{\text {out }} \frac{V_{\text {out }}}{V_{\text {in }}} \tag{9.7}
\end{equation*}
$$

You can wind additional secondaries, each with its diode and storage capacitor, to create multiple output voltages (as set by the turns ratios). And, because the output windings are isolated, you can as easily generate negative outputs. Having chosen one of the outputs for regulating feedback, however, the others will not be as tightly regulated. The term "cross regulation" is used to specify the output-voltage dependencies.

#### A. Comments on flyback converters

Power level Flyback converters have full pulsations of input and output current. For this reason they are generally used for low- to medium-power applications (up to $\sim 200 \mathrm{~W}$ ). For higher power you usually see designs using the forward converter, or, for really high power, bridge converters.

The transformer is an inductor The input energy each cycle is first stored in the transformer core (during switchON ), then transferred to the output (during the switch-OFF). So the transformer design must provide the correct "magnetizing inductance" (acting as an inductor), as well as the correct turns ratio (acting as a transformer). This is quite different from the situation with the forward converter and the bridge converters, below, where the transformer is "just a transformer." We won't go into further detail about transformer design here, simply noting that the design of the "magnetics" is an important part of switching converter designs in general, and flybacks in particular. You have to worry about issues such as core cross-section, permeability, saturation, and deliberate "gapping" (in general, energy-storage inductors are gapped, whereas pure transformers are not). Extremely helpful resources for design are found in IC datasheets and design software (usually available at no charge from the manufacturer) that provide
specifics about the choice of magnetics. We explore this important topic further in $\S 9 x .4$.
Snubbers With ideal components, the primary current would transfer completely to the secondary when the switch turns OFF, and you wouldn't have to worry about bad things happening on the dangling drain terminal of the switch. In reality the incomplete coupling between primary and secondary creates a series "leakage inductance," whose craving for current continuity generates a positive voltage spike at the switch, even though the secondary is clamped by the load. This is not good. The usual cure is to include a snubber network, consisting of an $R C$ across the winding, or, better, a "DRC" network of a diode in series with a parallel $R C .{ }^{91}$

Regulation Flyback converters can be regulated with conventional PWM, either voltage mode or current mode, with a free-running oscillator calling the shots. Alternatively, you will see inexpensive designs in which the transformer itself becomes part of a blocking oscillator, thereby saving a few components. We cracked open some samples of low-power (5-15 W) "wall warts" and found, well, just about nothing inside! We reverse engineered them to look at the circuit tricks (Figure 9.74). They seem to work just fine.

Off-line converters This final circuit (Figure 9.74) is an example of a power converter that requires galvanic isolation. The transformer provides isolation for the power flow; in addition, the feedback signal from the dc output must be isolated as well on its way back to the primary side. This can be done with an optocoupler, as here, or with an additional small pulse transformer. We discuss these offline converters briefly in §9.7, and in Chapter $9 x$ we discuss high-efficiency ("green") power supplies, including a graph comparing the performance of this 5 W supply (whose standby power is 200 mW ) with others.

### 9.6.12 Forward converters

The single-ended forward converter (Figure 9.73B) is the transformer-isolated version of the buck converter. It is helpful to refer back to the basic buck circuit (Figure 9.61 A ), to see how it goes. The transformer converts

[^527]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0690.jpg?height=749&width=1616&top_left_y=207&top_left_x=238)

Figure 9.74. An inexpensive 5 W flyback converter, powered from 115 Vac line voltage, that uses a self-excited "blocking oscillator." Winding P2 provides positive feedback to sustain oscillation. The output voltage is sensed and compared with the TL431 shunt regulator, fed back via the optocoupler $U_{1}$ to adjust the conduction cycle.
input voltage $V_{\mathrm{in}}$, during primary switch conduction, to a secondary voltage $\left(N_{\text {sec }} / N_{\text {pri }}\right) V_{\text {in }}$. That transformed voltage pulse drives a buck converter circuit, consisting of catch diode $D_{2}$, inductor $L$, and output storage capacitor. The extra diode $D_{1}$ is needed to prevent reverse current into the secondary when the switch is OFF. Note that here, in contrast to the flyback converter, the transformer is "just a transformer": inductor $L$ provides the energy storage, as with the basic buck circuit. The transformer does not need to store energy, because the secondary circuit conducts at the same time as the primary (energy goes "forward"), as you can see from the polarity marking.

Analogous to the buck converter, (eq'ns 9.3a-9.3h), the output voltage is simply

$$
\begin{equation*}
V_{\mathrm{out}}=V_{\mathrm{in}} \frac{N_{\mathrm{sec}}}{N_{\mathrm{pri}}} \frac{t_{\mathrm{on}}}{T}=D \frac{N_{\mathrm{sec}}}{N_{\mathrm{pri}}} V_{\mathrm{in}} \quad(\text { in CCM }) \tag{9.8}
\end{equation*}
$$

Resetting the core In contrast to the flyback circuit, there's an additional winding in Figure 9.73B, which is needed to reset the transformer's core. ${ }^{92}$ That is because the volt-second product ${ }^{93}$ applied to the transformer must average zero (i.e., no average dc input) in order to prevent a continual buildup of magnetic field; but the input switch alone always applies voltage in one direction only. The tertiary winding fixes this by applying voltage in the opposite

[^528]direction during the switch-OFF portion of the cycle (when diode $D_{\mathrm{R}}$ conducts, from continuity of current in the winding as the magnetic field collapses). ${ }^{94}$

Additional comments (a) As with the flyback, and indeed with any transformer-coupled converter, the forward converter allows multiple independent secondaries, each with its inductor, storage capacitor, and pair of diodes. Regulating feedback then holds one output particularly stable. (b) The transformer isolates the output in a forward converter, if you happen to need isolation (as in a powerlineinput converter); in that case you must galvanically isolate the feedback signal as well, typically with an optocoupler (as in the block diagram of Figure 9.48, or the detailed diagrams of Figures 9.74 and 9.83). On the other hand, if you do not need isolation you can have a common ground reference, and bring the error signal back to the PWM control circuit directly.

94 There are clever circuits that reset the core without requiring a tertiary winding: one method uses a pair of primary switches, one at each end of the winding, in collaboration with a pair of diodes, to reverse the voltage across the single primary (see if you can invent the circuit!). Another method uses instead a second switch to connect a small capacitor across the primary during main switch-OFF; this clever method is known as "active clamp reset," and was devised independently by Carsten, Polykarpov, and Vinciarelli. It has the virtue of reversing the magnetic field in the transformer core, providing better performance by allowing double the normal flux excursion.

Table 9.6 External-switch Controllers ${ }^{a}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0691.jpg?height=1659&width=1642&top_left_y=229&top_left_x=128)

Notes: (a) all require external power switches (see listings in Table 3.4); all have undervoltage lockout (UVLO) and internal voltage references; listed within groups in approximate order of increasing drive current. (aa) I - current mode, V - voltage mode, P - fixed peak current, M - multiple modes. (b) uncommitted BJT output, sinks $200 \mathrm{~mA}, 40 \mathrm{~V}$ max. (c) $\mathrm{P}=\mathrm{PWM}$ fixed freq; $\mathrm{Q}=$ quasi-res; R - resonant; $\mathrm{V}=\mathrm{var}$ freq fixed width; (d) peak driver current, for controllers. (e) ext parts. (ex) lower voltage for $x=3$ or 5 , higher voltage for $x=2$ or 4 . (f) fixed only. (f3) three switching-frequency options. (g) unused footnote. (h) $2 V$ for $x=3$ or 5 . (i) adjustable current limit. (j) 25 V zener clamp for $V_{\mathrm{Cc}}$. ( k ) to $V_{\mathrm{CC}}$ or voltage shown, whichever is less. ( m ) maximum. ( n ) nominal. (o) turn-on threshold. (oo) even with LEB (leading-edge blanking) an $R C$ filter or at least a 100pF capacitor is often recommended. (p) ref pin is current-sourcing. (pp) [same note as integrated tables]. (q) reduced freq or pulse skipping at low load. (r) 0.7 V for the '11. (s) helps stabilize the control loop against sub-harmonic oscillations. ( t ) transformer output. (u) a minimum off time ( 450 ns ) limits the duty cycle. ( v ) may not include dynamic gate-charge currents, etc. ( w ) for Vout below 30V, above 30V a current-sense resistor is required. (x) OVP = line over-voltage protection. (y) synchronous possible with low-voltage non-isolated flyback transfomer. (z) finds resonant frequency.

Comments: 1: LTC1772, LTC3801 second-source. 2: fixed 5V version available. 3: automotive. 4: hi-side sense. 5: LTC3832 goes down to 0.6V. 6: single inductor, foldback current limit. 7: jellybean. 8: improved UC384x. 9: UC384x with LEB, SS, low lQ. 10: impressive 52V, LED drive. 11: use with flyback xfmr. 12: to 1.8 V , slope-comp, soft-start, expensive. 13: to 1 MHz , advanced. 14: HV pin, to 100 V for startup. 15: SOT23, low power, cute. 16: can boost inputs as low as 1V. 17: fixed voltage versions only, five choices 1.9 V to 5.0 V . 18: quasi-resonant. 19: inexpensive, ATX power supplies etc. 20: freq dither. 21: 25 V zener clamp for $V_{\text {Cc. }}$ 22: legacy, inexpensive, second sourced. 23: programmable gap/overlap. 24: legacy, inexpensive, flexible. 25: also UC3525 etc. 26: feed-forward ramp. 27: resonant, use with FET driver IC. 28: HV pin, to 500 V for startup. 29: optimized for inverting, $V_{\text {out }}$ from -0.4 V to -150 V or more.
(c) As with all switchmode converters, snubber networks are needed to tame the voltage spikes caused by parasitic inductances (including particularly transformer leakage inductance).
(d) As with other converter types, PWM control can be either voltage mode or current mode. An alternative is to use pulse frequency modulation (PFM), with approximately constant pulse width, to take advantage of resonant behavior (thus avoiding "hard switching" by allowing the resonant ringing to charge and discharge parasitic capacitances, and thereby come closer to the ideal of zero-voltage/zerocurrent switching). (e) Single-ended forward converters are popular in the medium-power range ( $\sim 25-250 \mathrm{~W}$ ).

### 9.6.13 Bridge converters

The last two transformer-isolated converters in Figure 9.73 are the half-bridge and full-bridge (H-bridge) converters. As with the single-ended forward converter, the transformer acts simply to effect voltage transformation and isolation; the secondary circuit's inductor does the energy storage, serving the same purpose as it does in the basic buck converter or single-ended forward converter. In fact, you can think of the bridge converters approximately as "double-ended forward converters." In both bridge circuits the capacitor(s) on the input side allow the voltage at the undotted end of the transformer primary to move up or down as needed to achieve zero average dc current, preventing transformer core saturation.

To understand the half-bridge converter, imagine first that switches $S_{1}$ and $S_{2}$ are operated alternately, with $50 \%$ duty cycle and with no gap or overlap. The voltage at the junction of input capacitors will float to half the dc input voltage, so what you've got is a center-tapped full-wave rectifier circuit, driven by a square wave. Power is transferred forward during both halves of each cycle, and the output voltage (ignoring diode drops) is just

$$
\begin{equation*}
V_{\mathrm{out}}=V_{\mathrm{in}} \frac{N_{\mathrm{sec}}}{4 N_{\mathrm{pri}}} \tag{9.9}
\end{equation*}
$$

where the factor of 4 arises from the factor of $\frac{1}{2}$ for the applied input voltage and the same factor from the output center-tap. The operation of the full-bridge converter is similar, but its four switches enable it to apply the full dc input voltage across the primary during each half-cycle, so the 4 is replaced by 2 in the denominator.

Regulation With the switches operating in opposition, at $50 \%$ duty cycle, the output voltage is fixed by the turns ratio and the input voltage. To provide regulation you need to operate each switch for less than a half-cycle (Fig-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0692.jpg?height=249&width=675&top_left_y=220&top_left_x=1137)

Figure 9.75. Pulse-width modulation in the half-bridge switching converter. The internal oscillator initiates switch conduction on alternate cycles, with feedback providing regulation by ending each switch's conduction according to the error signal.
ure 9.75), with a conduction gap ("dead time") whose length is adjusted according to the error signal. You can think of each half-cycle as a forward converter, of duty cycle $D=t_{\mathrm{on}} /\left(t_{\mathrm{on}}+t_{\mathrm{off}}\right)$, causing the converter to produce an output voltage (assuming CCM) of

$$
\begin{equation*}
V_{\text {out }}=D V_{\text {in }} \frac{N_{\text {sec }}}{4 N_{\mathrm{pri}}} \tag{9.10}
\end{equation*}
$$

Bridge converters are favored for high-power conversion ( $\sim 100 \mathrm{~W}$ and above), because they make efficient use of the magnetics by conducting during both halves of each cycle, and they cycle the magnetic flux symmetrically. They also subject the switches to half the voltage stress of a single-ended converter. By adding another pair of switches, you can convert it to a full-bridge (or H-bridge), in which the full dc input voltage is applied across the primary each half-cycle. (See the comments below, however, about flux balance.) The full-bridge configuration additionally allows another form of regulation, called "phase-shift control," in which a $50 \%$ duty cycle is maintained in each switch pair, but the relative phase of one pair is shifted relative to the other, to effectively produce a variable duty cycle. ${ }^{95}$

Additional comments (a) As with the single-ended forward converter, it is essential to maintain zero average voltage (or volt-time integral) across the transformer's primary. Otherwise the magnetic flux will grow, reaching destructive saturation. The H-bridge in Figure 9.73D includes a blocking capacitor $C_{\mathrm{B}}$ in series with the primary for this purpose; the pair of input capacitors serves the same function for the half-bridge (Figure 9.73C). That capacitor can be quite large, and it has to endure large ripple currents; so it would be nice to eliminate it, for example by connecting the bottom of the winding to a fixed voltage of $V_{\text {in }} / 2$ (which is available automatically in an offline voltage-doubling input bridge). That configuration is known as "push-pull."

[^529]However, without the blocking capacitor it is easy to violate the flux-balance condition. One solution is the use of current-mode control, in which cycle-by-cycle (or, more accurately, half-cycle by half-cycle) current limiting prevents saturation. In any case, be aware that flux imbalance in bridge converters is really bad news.
(b) In bridge converters the power switches are connected in series across the dc input supply. If there is conduction overlap, large currents can flow from rail to rail; this is known as "shoot-through" current. What you need to know is that you don't want it! In fact, turn-off delays in MOSFETs, and more seriously in BJTs, require that the control signals provide a short time gap to avoid shoot-through.
(c) Once again, snubbers are needed to tame inductive spikes.
(d) Full-bridge converters are favored for high-power converters, to 5 kW or more.
(e) At high load currents the output filter inductor has a continuous current flowing through it. During primary conduction cycles this is, of course, supplied either by $D_{1}$ or $D_{2}$, by normal transformer action. But what happens during primary non-conduction (the gaps in Figure 9.75)? Interestingly, the continuing inductor current flows through both $D_{1}$ and $D_{2}$, forcing the transformer secondary to act like a short-circuit (even though its primary is open), because equal diode currents flow in the same direction out of both ends of the center-tapped winding.

## 9.7 Ac-line-powered ("offline") switching converters

With the exception of Figures 9.48B and 9.74, all the switching converters and regulators we've seen so far are $d c-t o-d c$ converters. In many situations that's exactly what you want - for battery-operated equipment, or for creating additional voltages within an instrument that has existing dc power. ${ }^{96}$

Apart from battery-powered devices, however, you need to convert incoming powerline ac to the necessary regulated dc voltages. You could, of course, begin with an unregulated low-voltage dc supply of the sort in Figure 9.49,

[^530]followed by a switching regulator. But the better approach is to eliminate the bulky 60 Hz step-down transformer by running an isolated switching converter directly from the rectified (unregulated) and filtered ac power, as shown earlier in Figure 9.48. ${ }^{97}$

Two immediate comments. (a) The dc input voltage will be approximately 160 volts $^{98}$ (for 115 Vac power) - this is a dangerous circuit to tinker with! (b) The absence of a transformer means that the dc input is not isolated from the powerline, so it's essential to use a switching converter with an isolated power stage (forward, flyback, or bridge), and with isolated feedback (via an optocoupler or transformer).

### 9.7.1 The ac-to-dc input stage

#### A. Dual-voltage configurations

Figure 9.76 shows two common input-stage configurations. The simple bridge rectifier of Figure 9.76A is perfectly OK
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0693.jpg?height=736&width=823&top_left_y=1036&top_left_x=966)

Figure 9.76. Switching power supplies run from the ac powerline (offline converters) use directly rectified dc to power an isolated converter. The jumper in the lower circuit selects bridge or voltage doubler configurations, so that either line voltage produces the same $\sim 300 \mathrm{~V}$ dc output.

[^531]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0694.jpg?height=453&width=1184&top_left_y=207&top_left_x=454)

Figure 9.77. The direct rectifier circuits of Figure 9.76 create undesirable current pulses each half-cycle (low power factor). This is remedied with a power factor correction front end, consisting of a boost converter running from the (unfiltered) full-wave rectified linevoltage waveform, controlled by a special PFC chip that operates the switch to maintain the input current approximately proportional to the input voltage.
for devices intended for either 115 Vac or 230 Vac use, in which the switching converter that follows is designed for either $\sim 150 \mathrm{Vdc}$ or $\sim 300 \mathrm{Vdc}$ input, respectively. If you need a supply that can be switched to run on either input voltage, use the nice trick shown in Figure 9.76B: it's a simple full-wave bridge for 230 Vac input, but with the jumper connected it becomes a voltage doubler for 115 Vac input, thus generating $\sim 300 \mathrm{Vdc}$ on either continent. (The other popular approach is to design the switching converter to accommodate a wide dc input range; most low-power chargers for consumer devices like laptop computers and cameras work this way. Check the label, though, before you plug in to 230 Vac power. And don't expect more powerhungry electronic devices to work automatically on "universal" power; they usually have a recessed slide switch that is the jumper in Figure 9.76B.)

#### B. Inrush current

When you first turn on the power, the ac line sees a large discharged electrolytic filter capacitor across it (through a diode bridge, of course). The resulting "inrush" current can be enormous; even a tiny "wall-wart" can draw 25 A or more of instantaneous current when first plugged in. Commercial switchers use various soft-start tricks to keep the inrush current within civilized bounds. One method is to put a negative-tempco resistor (a low-resistance thermistor) in series with the input; another method is to actively switch out a small $(10 \Omega)$ series resistor a fraction of a second after the supply is turned on. The series inductance provided by an input noise filter helps somewhat, as well. But a very nice solution comes in the form of an input power-factor correction circuit, discussed next.

#### C. Power-factor correction

The pulsed current waveform of rectified ac, as seen for example in Figure 9.51, is undesirable because it produces larger resistive $\left(I^{2} R\right)$ losses compared with the ideal of a sinusoidal current waveform that is in phase with the voltage. (This is why it's easy to make the mistake of choosing too small a fuse rating, as discussed earlier in §9.5.1B.) Another way to say it is that a pulsed current waveform has a low power factor, which is defined as the power delivered divided by the product $V_{\mathrm{rms}} \times I_{\mathrm{rms}}$. Power factor made its first appearance in Chapter 1 in connection with reactive circuits, in which the phase-shifted (but still sinusoidal) current created a power factor equal to the cosine of the phase difference between the ac voltage and current. Here the problem is not phase, it's the high rms/average ratio of the pulsed-current magnitudes.

The solution is to make the power supply's input look like a passive resistor, by devising a circuit that forces the input current waveform to be proportional to the input voltage over the ac cycle. That is known as a powerfactor correction (PFC) circuit, and it is connected between the full-wave rectified ac input (but with the usual storage capacitor omitted) and the actual dc-dc converter, as shown in Figure 9.77. It consists of a non-isolated boost converter, operating at the usual high switching frequency, with the switching duty cycle continually adjusted to keep the sensed input current ( $I_{\mathrm{ac}}$ ) proportional to the instantaneous ac input voltage ( $V_{\mathrm{ac}}$ ) over the ac cycles. At the same time, it regulates its dc output to a voltage somewhat greater than the peak ac input, usually +400 V . This dc output then powers an isolated dc-dc converter to produce the final regulated voltages.

Power-factor correction is becoming standard in most
moderate-to-high-power offline switching power supplies ( $>100 \mathrm{~W}$, say), and is required by various regulatory standards. It is quite effective, as can be seen in Figure 9.78, where we dusted off a vintage desktop computer and compared its input current waveform with that of a contemporary unit running at the same time and from the same wall outlet.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0695.jpg?height=534&width=807&top_left_y=514&top_left_x=117)

Figure 9.78. A tale of two computers. Computer A has a PFC-input power supply, causing its input current to track the input voltage. The power supply in computer B, built ten years earlier, lacks PFC; its input bridge rectifier charges the storage capacitor with shortduration current surges. Horizontal scale: $4 \mathrm{~ms} / \mathrm{div}$.

### 9.7.2 The dc-to-dc converter

There are some extra issues to contend with in the design of offline converters.

#### A. High voltage

Whether power-factor corrected or not, the dc supply to the converter-regulator will be at a substantial voltage, typically 150 V or 300 V , or somewhat higher if PFC is used. The converter itself provides the isolation, typically using one of the transformer configurations of Figure 9.73. The switch must withstand the peak voltages, which can be significantly larger than the dc supply. For example, in the forward converter with 1:1 tertiary reset winding (Figure 9.73B) the MOSFET drain swings to twice $V_{\text {in }}$ during reset; and for the flyback the drain flies up to $V_{\text {in }} \cdot T / t_{\mathrm{off}}$. Note also that these peak voltages assume ideal transformer behavior; leakage inductance and other non-ideal circuit realities further exacerbate the situation.

#### B. Switching losses

High-voltage MOSFETs do not have the extremely low $R_{\text {on }}$ of their lower-voltage brethren. For high-voltage MOS-

FETs of a given die size, $R_{\text {on }}$ increases at least quadratically with voltage rating (see Tables 3.4 and 3.5). So designers have to worry about the conduction loss during the conduction portion of the cycle, namely $I_{\mathrm{D}}^{2} R_{\mathrm{on}}$. You can, of course, reduce conduction losses by choosing a larger MOSFET, with reduced $R_{\text {on }} .{ }^{99}$ But larger transistors have higher capacitances, which contribute to dynamic losses, which become increasingly important when switching high voltages: imagine, for example, a forward converter in continuous-conduction mode; when the switch is turned ON, it must bring its drain (and attached load) from $+2 V_{\text {in }}$ to ground. But there is energy stored in the switch's drain capacitance, as well as the parasitic capacitance of the transformer's winding, to the tune of $E=\frac{1}{2} C V^{2}$, which is squandered as heat each switching cycle. Multiply that by the switching frequency, and you get $P_{\text {diss }}=2 f C V_{\mathrm{in}}^{2}$. It goes up quadratically with operating voltage, and it can be substantial: an offline forward converter, running from +300 V rectified line voltage, switching at 150 kHz , and using a 750 V MOSFET with drain (and load) capacitance of 100 pF would be dissipating 3 W from this dynamic switching loss alone. ${ }^{100}$

There are clever ways to circumvent some of these problems. For example, inductances can be exploited to cause the drain voltage to swing close to ground (ideally, zerovoltage switching) before the switch is activated; this is called "soft switching," and is desirable for reducing both $\frac{1}{2} C V^{2}$ switching losses and the component stress caused by hard switching. And the $V_{\mathrm{D}} I_{\mathrm{D}}$ switching loss during transitions can be minimized by driving the gate hard (to reduce switching time), and by exploiting reactances to bring about zero-current switching. These problems are not insurmountable; but they keep the designer busy, dealing with tradeoffs of switch size, transformer design, switching frequency, and techniques for soft switching. This kind of circuit design is not for the casual electronics tinkerer, nor for the faint of heart.

#### C. Secondary-side feedback

Because the output is deliberately isolated from the hazardous powerline input, the feedback signal has to cross

[^532]back over the same isolation barrier. The configuration in Figure 9.74 is typical: a voltage reference and error amplifier (here implemented with a simple shunt regulator) drives the LED of an optocoupler at the output, with the isolated phototransistor providing guidance to the switch control (usually PWM) on the drive side. A lesser-used alternative is a pulse transformer, driven from a "secondaryside controller" circuit. A third alternative, if a high degree of output regulation is not needed, is to regulate the output of an auxiliary winding that is not on the "output" side (for example, a winding like P2 in Figure 9.74); because it returns to the input-side common, no isolation of its feedback signal is needed. This is called primary-side regulation. Typically you'll get something like $\pm 5 \%$ output regulation (over a load-current variation from $10 \%$ to $100 \%$ of rated current), compared with $\pm 0.5 \%$ or better with secondary-side feedback.

#### D. The isolation barrier

Transformers and optocouplers provide galvanic isolation. Simple enough, it would seem. But, as with life itself, there's usually plenty of nuance lurking below the surface (and, as will become evident, along the surface as well).

There are two mechanisms by which an isolation barrier can be breached:
(a) High voltages can create a spark directly across an air gap (or through an insulating sheet); this kind of breakdown is called "arcing" (or "arc-over"), so you have to ensure a minimum clearance distance, defined as the shortest distance in air between a pair of conductors.
(b) A conductive path can develop on the surface of insulating material that separates a pair of conductors; this kind of breakdown is called "tracking," ${ }^{101}$ best prevented by ensuring a minimum creepage distance, defined as the shortest distance along the surface of insulating material between two conductors; see Figure 9.79. As will become evident, creepage is generally the greater worry (compared with clearance) in high-voltage circuit layouts.

It's bad news when there's breakdown of an isolation barrier; it will likely cause damage or destruction to downstream powered electronics. Worse yet, there's human safety - an electronic device whose isolation from the ac line power is lost can kill you. For these reasons there are guidelines and strict standards that govern the design of isolation barriers (codified by IEC, UL, DIN/VDE, etc.). Publications like IEC 60950 and IEC 60335 include extensive tables of minimum clearance and creepage, and web-

[^533]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0696.jpg?height=274&width=689&top_left_y=210&top_left_x=1125)

Figure 9.79. Two paths for breaching an isolation barrier: rapid arcing across the airgap (defined by the clearance distance), and conductive "tracking" along a path on the surface of the insulating material (defined by the creepage distance).
sites like www.creepage.com have delightful online calculators to keep your designs reliable and safe.

Generally speaking, clearances of 2 mm or so, and creepage distances of $4-8 \mathrm{~mm}$ or so, are appropriate for 120 Vac powered converters. However, there are additional variables that affect the required spacings. An example is "pollution degree" (referring to the presence of conductive dust, water, etc.); and there is the overall category of intended insulation (ranging from the merely "functional" to the strictest safety level of "reinforced"). Another factor is the intended application: for example, there are separate safety standards for products intended for household use (IEC 60335), and there are particularly strict standards for medical devices (IEC 60601). A full discussion of the subject is well beyond the scope of this book. The following treatment aims to alert the reader to the seriousness of highvoltage isolation, and some of the techniques that are used to deal with it.

The variables: insulation type, voltage, material group, pollution degree
These are the parameters you use with the tables or calculators.

Insulation type The overall level of required effectiveness, in five steps (functional, basic, supplementary, double, reinforced).
Voltage Arc-over in air or through an insulating sheet is rapid, so it's the peak voltage (or peak transient) that matters. By contrast, the deterioration or contamination that causes conductive creepage is slower, so you use rms or dc voltages when consulting the tables.
Material group This refers to the susceptibility of the particular insulating material to surface breakdown; the groups are called I, II, and III, going from least to most susceptible. Some standards prefer analogous parameters called "comparative tracking index" (CTI) and "performance level categories" (PLCs).

Pollution degree A curious term, which refers to the quality of air: degree 1 is clean and dry air; degree 2 is the normal home or office environment; degree 3 is nasty, with conductive dust, condensing moisture, and the like - basically it applies to service in heavy industrial or farming environments.

#### Increasing the creepage distance

If you've got a compact design, such that there's insufficient space to provide adequate creepage distances, you can use various measures. You'll frequently see gaps or slots cut through a printed circuit board, as in the offline switcher of Figure 9.80. You can also provide a protruding barrier to lengthen the surface-clinging path, a technique used in high-voltage optocouplers, transformer windings, and the like (see next paragraph). A conformal insulating coating applied over a populated circuit board is a particularly effective technique (but it must not delaminate, or it can be worse than no coating at all). Related techniques for individual components involve potting or molding.

#### Creepage considerations in component packaging and design

Components that bridge the isolation barrier, such as transformers and optocouplers, must be designed and packaged with appropriate clearances and creepage distances, both in the external leads and in the internal insulation. An example is the isolation-straddling Y-capacitor, with one foot on each side. As the photograph of Figure 9.81 shows, the leads of the disc-geometry Y-capacitor are oriented at right
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0697.jpg?height=644&width=802&top_left_y=1510&top_left_x=122)

Figure 9.80. The designers of this switching converter included an L-shaped slot in the circuit board, greatly lengthening the creepage distance from the powerline circuitry to the isolated 5 V output.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0697.jpg?height=654&width=795&top_left_y=204&top_left_x=980)

Figure 9.81. This edgewise view of the same converter reveals that the Y -capacitor's widely spaced leads preserve the 8 mm min imum creepage; by contrast, the converter's minimum clearance is just 1.5 mm .
angles and coated with a continuation of the same conformal insulation that covers the capacitor body. Components housed in DIP-style cases can achieve greater separation of input and output sections by omitting intermediate pins ${ }^{102}$ (thus a "DIP-8" that's missing pins 2,3,6, and 7). An example of a fully specified high-voltage part comes from Avago, whose datasheet for an optocoupler (ACNV260E) includes an abundance of clearance and creepage specifications: both "external" and "internal" clearances ( 13 mm and 2 mm , respectively), and likewise for creepage distances ( 13 mm and 4.6 mm , described as "measured from input terminals to output terminals, shortest distance path along body" and "along internal cavity," respectively).

The leads of the switching transformer must similarly maintain adequate spacing and creepage distance. Equally important, the inter-winding insulation and winding geometry must create both appropriate insulation (by a sufficient number of layers of insulating tape, etc.) and also appropriate creepage standoff. To meet the creepage requirements, the windings may be arranged side-by-side (rather than coaxial), and separated with an insulating sheet that extends outward beyond the windings. This is good for creepage, but bad for the magnetic design, as it increases the leakage inductance. With a magnetically preferable coaxial geometry, the creepage distance can be extended by

[^534]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0698.jpg?height=402&width=797&top_left_y=202&top_left_x=221)

Figure 9.82. These 1500 V MOSFET packages employ shaped and grooved insulation to lengthen the creepage path length. (Adapted with permission of STMicroelectronics)
allowing the inter-winding tape to extend beyond the windings, or to wrap back around the outer winding.

Creepage effects are present whenever you deal with high voltage, whether or not an isolation barrier is involved. An example is shown in Figure 9.82, illustrating the pin configuration of two package styles of a 1500 V MOSFET. For the larger TO-3PF package ( 5.4 mm lead spacing) an extension of the plastic package material around the drain lead provides adequate creepage distance; for the smaller TO-220FH package ( 2.5 mm lead spacing) there's a grooved structure and offset lead geometry.

### 9.8 A real-world switcher example

To convey the additional complexity involved in a product-ion-model line-powered switching power supply, we disassembled a commercial single-output regulated switching supply ${ }^{103}$ (Astrodyne model OFM-1501: 85-265 Vac input, 5 Vdc @ 0-3A output), another in our series of "Designs by the Masters," revealing the circuit of Figure 9.83.

### 9.8.1 Switchers: top-level view

Let's take a walk through the circuit to see how a linepowered switcher copes with real-world problems. The basic topology is precisely that of the switching converter in Figure 9.48, implemented with flyback power conversion (Figure 9.73A); there are, however, a few additional components! Let's take it first at the broad-brush level, circling back later to delight in the refinements.

At this very basic level it goes like this: the line-powered bridge rectifier $D_{1}$ charges the $47 \mu \mathrm{~F}$ storage capacitor ${ }^{104}$ (rated at 400 Vdc , to accommodate the 265 Vac maximum

[^535]input), providing the unregulated high-voltage dc input ( +160 Vdc or +320 Vdc , for 115 Vac or 230 Vac input, respectively) to the high side of the 70-turn primary winding of $T_{1}$. The low side of the winding is switched to input common (the $\perp$ symbol) at fixed frequency (but with variable pulse width) by the PWM switchmode controller chip $U_{1}$, according to feedback current at its FB terminal. On the secondary side the 3 -turn paralleled secondaries are rectified by Schottky diode $D_{5}$, with "flyback" polarity configuration (i.e., nonconducting during the primary on period). The rectified output is filtered by the four lowvoltage storage capacitors (totaling $2260 \mu \mathrm{~F}$ ), creating the isolated 5 Vdc output. This supply uses secondary-side regulation, comparing a fraction ( $50 \%$ nominal) of $V_{\text {out }}$ with $U_{2}$ 's internal +2.50 V reference, turning on the LED emitter of optocoupler $U_{3}$ when the output reaches its nominal 5 Vdc . This couples to phototransistor $U_{3 \mathrm{~b}}$, varying the feedback current into switchmode controller $U_{1}$, thus varying the on pulse width to maintain regulated +5 Vdc output.

At this point we've accounted for perhaps a third of the components in Figure 9.83. The rest are needed to cope with issues such as (a) auxiliary power for the controller chip; (b) powerline filtering, mostly of outgoing switching noise; (c) protection (fusing, reverse polarity); (d) feedback loop compensation; and (e) switching transient snubbing and damping. And, although not obvious from the schematic, but most essential to the design - the choice of transformer parameters: core size and "gapping," turns ratios, and magnetizing inductance ${ }^{105} L_{\mathrm{M}}$.

Before looking into those details, though, let's see how the basic converter works. We'll be able to figure out things like the voltage and current waveforms, peak voltages and currents, and the duty cycle as a function of input voltage and output current.

### 9.8.2 Switchers: basic operation

The control chip operates at a fixed frequency $f_{\text {osc }}$ of 100 kHz , adjusting its primary switch conduction duty cycle ( $\left.D=t_{\text {on }} / T\right)$ according to voltage feedback. We've drawn ideal waveforms for one cycle (duration $T=1 / f_{\text {osc }}$ ) in Figure 9.84. These are what you might expect in the

[^536]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0699.jpg?height=779&width=1629&top_left_y=223&top_left_x=132)

Figure 9.83. "Real-world" line-powered switching power supply. The circuit is relatively uncomplicated, thanks to its low power rating (15 W), and to the elegant 3-terminal switchmode controller $U_{1}$ from Power Integrations (with on-chip high-voltage power MOSFET). This is the open-frame "15W ac/dc switcher" shown in Figure 9.1.
absence of parasitic effects such as leakage inductance and switch capacitance.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0699.jpg?height=843&width=535&top_left_y=1349&top_left_x=258)

Figure 9.84. Ideal waveforms for an isolated flyback switching supply, operating in discontinuous-conduction mode.

#### A. The waveforms

We'll do the calculations shortly, but look first at the waveforms. (We've assumed the converter is operating in discontinuous-conduction mode, which will be borne out when we do the numbers.) During switch conduction the drain voltage is held at ground, putting $+V_{\text {in }}$ across the transformer primary and causing a ramp-up of primary current, according to $V_{\text {in }}=L_{\mathrm{M}} \cdot d I_{\text {pri }} / d t$, where $L_{\mathrm{M}}$ is the primary "magnetizing inductance" (the inductance seen across the primary, with all other windings disconnected). That current ramps up to a peak value $I_{\mathrm{p}}$, at which time there is a stored energy of $E=\frac{1}{2} L_{\mathrm{M}} I_{\mathrm{p}}^{2}$ in the transformer's core. When the switch turns off, the persistent inductive current transfers to the secondary winding, delivering that stored energy $E$ to the output as the secondary current ramps down to zero, according to $V_{\text {out }}=L_{\mathrm{M}(\mathrm{sec})}$. $d I_{\text {sec }} / d t=\left(1 / N^{2}\right) L_{\mathrm{M}} \cdot d I_{\text {sec }} / d t$ (where $L_{\mathrm{M}(\mathrm{sec})}$ is the magnetizing inductance seen at the secondary ${ }^{106}$ ). For the rest of the cycle there is no transformer current flowing.

The voltage waveforms are instructive. When the primary switch is turned off, at time $t_{\mathrm{p}}$, the drain voltage rises

[^537]well beyond the input supply voltage $V_{\text {in }}$ : that is because the inductor tries to continue sourcing current into the drain terminal. The voltage would soar, but the secondary circuit goes into conduction instead (notice the polarity of "dotted" windings in Figure 9.83), clamping its output to $V_{\text {out }}$, which reflects back to the primary via the turns ratio $N$ (shorthand for $N_{\mathrm{p}} / N_{\mathrm{s}}$ ). The brief spike shown in the figure is caused by some primary inductance ${ }^{107}$ that is not coupled to the secondary, and therefore not clamped. This terrifying voltage spike is ultimately clamped by the zener clamp $D_{2}$ seen in the schematic (more on this later). When the secondary current has ramped down to zero, the voltage drop across both windings goes to zero; so the drain terminal sits at $+V_{\mathrm{in}}$, and the voltage across the secondary winding goes to zero. Note that the latter is negative during primary switch conduction; it's a requirement that the "volt-time integral" (or "volt-second product") across any inductor average to zero, otherwise the current would rise without bound. That holds true for the primary also.

#### B. The calculations

Let us assume for simplicity that the converter is running at full load ( $5 \mathrm{~V}, 3 \mathrm{~A}$ ) with nominal input voltage ( 115 Vrms or 160 Vdc$).{ }^{108}$ We will calculate the switch duty cycle $D=t_{\mathrm{p}} / T$, the secondary conduction duty cycle $t_{\mathrm{s}} / T$, and the peak currents $I_{\mathrm{p}(\mathrm{pk})}$ and $I_{\mathrm{s}(\mathrm{pk})}$. It's easiest to take these in reverse order, doing the calculations from a simple energy standpoint.

The parameters We measure the magnetizing inductance seen at the primary to be $L_{\mathrm{M}}=895 \mu \mathrm{H}$, and the number of turns of primary and secondary to be $N_{\mathrm{p}}=70 \mathrm{t}$ and $N_{\mathrm{s}}=3 \mathrm{t}$. From this we get the turns ratio $N=N_{\mathrm{p}} / N_{\mathrm{s}}=23.3$, which sets the voltage and current transformation ratios. Finally, from the turns ratio we get the magnetizing inductance as seen at the secondary side: $L_{\mathrm{M}(\mathrm{sec})}=L_{\mathrm{M}} / N^{2}=1.65 \mu \mathrm{H}$ (impedances scale as $N^{2}$; see Chapter $1 x$ ). A final parameter that we will use later is the measured primary leakage inductance $L_{\mathrm{L}}=42 \mu \mathrm{H}$.

Peak currents The output circuit is delivering 15 W to the load; but, taking account of rectifier drop ( $\sim 0.5 \mathrm{~V}$ ) and

[^538]the combined resistive losses in the secondary winding and filter inductor $L_{2}(10 \mathrm{~m} \Omega)$, the transformer secondary is delivering an average power of approximately $6 \mathrm{~V} \times 3 \mathrm{~A}$, or 18 W . So, at a switching frequency of $f_{\mathrm{s}}=100 \mathrm{kHz}$, the transformer must deliver an energy increment of $E=P / f_{\mathrm{s}}=180 \mu \mathrm{~J}$ during each switch cycle.

The rest is easy: we equate $E$ to the magnetic energy in the core's magnetizing inductance, as seen at the secondary (because that's where it emerges). That is, $E=\frac{1}{2} L_{\mathrm{M}(\mathrm{sec})} I_{\mathrm{s}(\mathrm{pk})}^{2}$, from which we get $I_{\mathrm{s}(\mathrm{pk})}=14.8 \mathrm{~A}$. Dividing by the turns ratio ( $N=23.3$ ), we find that the peak primary current is $I_{\mathrm{p}(\mathrm{pk})}=0.64 \mathrm{~A}$.
Conduction timing The primary switch stays on for a duration that ramps its current up to this peak current. That is, $t_{\mathrm{p}}=L_{\mathrm{M}} I_{\mathrm{p}(\mathrm{pk})} / V_{\mathrm{in}(\mathrm{dc})}=3.6 \mu \mathrm{~s}$. The secondary conduction commences when the primary switch turns off, and continues for the time duration $t_{\mathrm{s}}$ needed to ramp its current down from $I_{\mathrm{s}(\mathrm{pk})}$ to zero: $t_{\mathrm{s}}=L_{\mathrm{M}(\mathrm{sec})} I_{\mathrm{s}(\mathrm{pk})} / V_{\mathrm{sec}}=4.1 \mu \mathrm{~s}$. Note that the successive conduction of primary and secondary totals $7.7 \mu \mathrm{~s}$, which is less than the cycle time of $10 \mu \mathrm{~s}$; that is, the converter is running in discontinuous conduction mode, as we assumed at the outset (and drew in Figure 9.84). There is a "dead time" of about $2.3 \mu \mathrm{~s}$ before the next switch conduction.

#### C. Comparison with reality

How well did we do with this basic model? To find out, we measured voltage and current waveforms of this converter, at nominal input voltage and full output load. They are shown in Figure 9.85. The good news is that the timing and peak currents are in very good agreement with our
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0700.jpg?height=529&width=767&top_left_y=1588&top_left_x=1091)

Figure 9.85. Measured waveforms for the switcher of Figure 9.83, running at full load ( $5 \mathrm{~V}, 3 \mathrm{~A}$ ) and nominal input voltage ( 115 Vrms ; $V_{\text {in }}=160 \mathrm{Vdc}$ ). The arrows mark the location of zero voltage and current for each trace. Horizontal scale: $2 \mu \mathrm{~s} / \mathrm{div}$.
calculations. The bad news is that there are some realworld "features" that are absent from our basic waveforms of Figure 9.84. Most prominent are
(a) a substantial drain voltage spike at turn-off, followed by
(b) some fast ringing on both windings during secondary conduction, and
(c) slower ringing during the dead time at the end of the cycle.

Visible also is
(d) a drain current spike at turn-on.

These are caused by non-ideal behavior of the MOSFET switch and the transformer, as we'll discuss soon; but, to put some names onto them, these effects are due to
(a) primary leakage inductance,
(b) resonance of drain (and other) capacitances with primary leakage inductance,
(c) resonance of drain (and other) capacitances with primary magnetizing inductance, and
(d) "hard switching" of the voltage across the drain and other capacitances.

### 9.8.3 Switchers: looking more closely

Let's go back and fill in the missing pieces. In the real world you cannot ignore important effects such as the voltage and current transients that we saw in Figure 9.85, and numerous other details that account for all the components you see in the circuit diagram.

#### A. Input filtering

Beginning at the input, we find the obligatory fuse, and then an across-the-line "X" capacitor (§9.5.1D and following) and a series-coupled inductor pair, together forming an EMI and transient filter. It's always a good idea, of course, to clean up the ac power entering an instrument; here, however, filtering is additionally needed to keep RF hash generated inside the power supply from radiating out through the powerline. ${ }^{109}$ This is not merely an act of altruism; there

[^539]are regulatory standards governing permissible levels of radiated and conducted EMI. ${ }^{110}$ The pair of 270k resistors discharges the X capacitor's residual voltage when the unit is unplugged.

#### B. Voltage range, inrush current, PFC

Note that this low-power (15 W) supply operates directly from a wide input voltage range (3:1), without a dualvoltage range switch in the manner of Figure 9.76B. Such wide-range operation is particularly convenient in chargers and power bricks for consumer electronics. It does, however, impose constraints on the design, because the converter must operate over a wide range of switch conduction duty cycle, and because the components must be sized for the wider range of peak voltages and currents. Absent, also, are any circuit elements to limit the inrush current during initial charging of the line-side storage capacitor. That's permissible in a small supply like this; but even with the relatively small $47 \mu \mathrm{~F}$ storage capacitor the specified typical inrush current is a hefty 20 A at 100 Vac input (and twice that for 200 Vac ). Note also the absence of a PFC frontend; it's common practice to omit PFC in small supplies, but PFC is usually found in supplies of 50 W or more, at least in part from regulatory pressures. Note, by the way, that a PFC front-end reduces peak inrush current.

#### C. Auxiliary supply

Moving to the right, we see the interesting configuration of the "auxiliary supply," needed to power the internal circuits of the regulator-controller chip with low-voltage, low-power dc. An unattractive possibility would be to use a separate little linear supply, with its own line-powered transformer, etc. However, the temptation is overwhelming to hang another small winding (with half-wave rectifier $D_{4}$ ) on $T_{1}$, thus saving a separate transformer. That's what's been done here, with the 7-turn winding, which generates a nominal +12 V output.

Sharp-eyed readers will have noticed a flaw in this scheme: the circuit cannot start itself, because the auxiliary dc is present only if the supply is already running! This turns out to be an old problem, ${ }^{111}$ solved with a "kick-
more, up to the frequency at which the PCB's wiring inductance and the choke's winding self-capacitance take over.
${ }^{110}$ In the US, electronic equipment must meet FCC Class A (for industrial settings) and Class B (more stringent, for residential settings) limits; in Europe the analogous standards are set by VDE.
111 For example, designers of traditional CRT-based television sets faced the same quandary, when they derived all their low-voltage dc supplies from auxiliary windings on the high-frequency horizontal drive transformer, the latter itself activated by those same supplies.
start" circuit that powers initially from the high-voltage unregulated dc, switching over to its auxiliary dc power after things are running. We'd like to show you how this is implemented in detail, but we are frustrated in that worthy goal because in this supply those functions (and others) are cleverly integrated into the TOP201 controller chip (shown in simplified block diagram form in the dashed box). ${ }^{112}$

#### D. Controller chip: bias and compensation

Moving next to the controller chip itself, we see its internal high-voltage MOSFET (drawn explicitly, for clarity), which switches the low side of the primary to input common. The switch operates at fixed 100 kHz rate, varying the duty cycle according to the feedback, in a voltage-mode regulator. The chip is packaged in a 3-pin TO-220 plastic power package, and requires a small heatsink. Think about that - a 3-pin switching regulator! Impossible, you say: it needs pins at least for common, drain, feedback, and chip power ("bias"). Surprisingly, this clever chip does it with just three, with the feedback terminal doing double duty as a bias pin. Feedback takes the form of a current into the FB pin, with an internal voltage divider to create the voltagefeedback signal that is presented to the PWM (duty-cycle) comparator, and a linear regulator to create the (higher) internal bias voltage. The remaining components on the primary side are for loop compensation (the series $R C$ and $C$ shunting the FB terminal), and for clamping and damping the inductive spike at the end of the conduction cycle (the 200 V zener transient suppressor and ferrite bead).

#### E. Input transient clamp (snubber)

At first you might reason that no clamp is needed, because the secondary circuit clamps the flyback voltage (as transformed to the secondary side by the turns ratio) to the output voltage. That is, after all, how a flyback works: the magnetic energy added to the core during switch conduction is stored in the transformer's magnetizing inductance ( $E_{\mathrm{M}}=\frac{1}{2} L_{\mathrm{M}} I_{\mathrm{p}}^{2}$ ), and released to the secondary circuit when the switch is turned OFF. But there is also "leakage inductance" ( $L_{\mathrm{L}}$, see Chapter $1 x$ ), an effective series inductance caused by incomplete magnetic coupling between the windings. ${ }^{113}$ The magnetic energy stored in $L_{\mathrm{L}}$
${ }^{112}$ Look in our second edition, where we devote six pages (pp. 361-366) to a complex offline switcher, if you want to see the gory implementation details of these and other features.
${ }^{113}$ Referring all inductances to the primary side, the magnetizing inductance $L_{\mathrm{M}}$ is what you measure across the primary terminals with all other windings left open-circuited, and the leakage inductance $L_{\mathrm{L}}$ is what you measure with all other windings short-circuited.
$\left(E_{\mathrm{L}}=\frac{1}{2} L_{\mathrm{L}} I_{\mathrm{p}}^{2}\right)$ is not transferred to, nor clamped at, the secondary, which is why you need the zener clamp on the primary side. (You can think of this unclamped energy as arising from the magnetic field of the primary that is not linked by the secondary.) This energy can be substantial - we'll see just how robust a zener is needed, even for this lowpower switcher, when we do the clamp calculations in the next paragraph. It's worth noting that the effects of leakage inductance loom particularly large in a line-powered supply, because the required high-voltage insulation between primary and secondary mandates that the windings be physically well separated, causing incomplete flux coupling.

Let's take a moment to understand the drain voltage spike waveform in Figure 9.85. The primary-side leakage inductance, here measured to be $42 \mu \mathrm{H}$, though a smallish fraction ( $\sim 5 \%$ ) of the magnetizing inductance of $895 \mu \mathrm{H}$, stores that fraction of the total energy put into the transformer during primary switch conduction, and it is not transferred to the secondary; instead, it comes back out and is dissipated in the zener clamp $D_{2}$. That's about 0.84 W , which accounts for the robust zener that the designers chose. We can estimate the time duration of the primary current ramp to zero (call it $t_{\text {clamp }}$ ), mediated by the zener clamp. Look at Figure 9.86: the leakage inductance sees a clamp voltage equal to the zener voltage minus the reflected secondary voltage, which acts to ramp the primary
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0702.jpg?height=712&width=342&top_left_y=1399&top_left_x=1301)

Figure 9.86. Drain-voltage spike caused by transformer leakage inductance. The zener clamp, whose voltage is higher than the reflected secondary output voltage, ramps the current to zero according to $V_{\mathrm{Z}}-N V_{\text {out }}=L_{\mathrm{L}} d I_{\mathrm{D}} / d t$.
current down to zero from its starting value of $I_{\mathrm{p}(\mathrm{pk})}$. So, from $V=L d I / d t$ we get $V_{\mathrm{Z}}-N V_{\text {out }}=L_{\mathrm{L}} I_{\mathrm{p}(\mathrm{pk})} / t_{\text {clamp }}$, so $t_{\text {clamp }}=0.45 \mu \mathrm{~s}$. This is in good agreement with the measured waveforms of Figure 9.85.

A final note on the clamp network: the zener $D_{2}$ is not a normal zener, but rather a "transient voltage suppressor" type (TVS; see discussion in Chapter 9x), designed and specified to absorb large pulses of energy. The series diode $D_{3}$ is needed to prevent conduction during the switch-ON cycle, when the zener would conduct as a normal diode. There's an interesting problem associated with $D_{3}$, namely the fact that ordinary diodes have a "reverse recovery time" after forward conduction, which is due to charge storage effects, before they become non-conducting (this is the origin of the curious microsecond-scale spikes seen in a simple 60 Hz unregulated power supply; see $\S 9 x .0)$. For this reason $D_{3}$ in this circuit is a "fast soft-recovery" rectifier: the "fast" means that it turns off quickly ( $<30 \mathrm{~ns}$ ), and the "soft" means that it does so smoothly, not abruptly. That's useful, because an abrupt current transition to nonconduction produces large inductive spikes $(V=L d I / d t)$. In addition, the designers added a ferrite bead to damp and suppress such effects.

#### F. The transformer

In a flyback converter the primary and secondary conduction cycles do not overlap (as they do in, say, a forward converter). So all the energy that is being moved from primary to secondary must take up temporary residence in the transformer's core. That is, in a flyback converter the transformer is not "just a transformer": in addition to the usual transformer functions (voltage and current transformation by the turns ratio, and galvanic isolation), it is also an inductor, storing energy from the primary cycle in its magnetizing inductance to the tune of $E=\frac{1}{2} L_{\mathrm{M}} I_{\mathrm{p}(\mathrm{pk})}$. In fact, it's probably more accurate to think of it as "an inductor with a secondary winding." To enhance the energy storage functions, such transformers are usually designed with a deliberate gap in the magnetic material, which has the effect of raising the stored energy for a given applied volt-second product. This particular transformer is evidently gapped, because its value of $A_{\mathrm{L}}$ (the ratio of magnetizing inductance to turns squared) is low: $A_{\mathrm{L}}=L_{\mathrm{M}} / N_{\mathrm{p}}^{2}=183 \mathrm{nH} / \mathrm{t}^{2}$, compared with a value of the order of 1500 for an ungapped ferrite core of this size. (The nonconducting ferrite core is used to eliminate eddy current losses at the high operating frequency.)

As we discovered above, this converter runs in discontinuous conduction mode at nominal input voltage and full load current. In fact, it stays in DCM even at minimum in-
put voltage ( 90 Vrms ) and full load current, which is the combination that brings it closest to CCM. With a bit more transformer inductance it would enter CCM; presumably the design choice was based on the desire to keep it small, and also to avoid some issues associated with CCM. ${ }^{114}$

As we hinted earlier, the transformer's inductances are responsible for the ringing seen in the waveforms of Figure 9.85. Let's do a simple calculation of what frequencies we expect. During secondary conduction (immediately following primary switch turn-off) the primary circuit looks like a parallel $L C$, with leakage inductance $L_{\mathrm{L}}$ in parallel with the parasitic capacitances of the MOSFET and other components (clamp diode, primary winding). A reasonable estimate for the combined capacitances is something like 75 pF , due mostly to the transformer wiring and the clamp zener. So the parallel $L C$ formed with the leakage inductance of $42 \mu \mathrm{H}$ resonates at about 2.8 MHz , in good agreement with the observed ringing $(\sim 2.5 \mathrm{MHz})$. At the completion of secondary conduction, the primary side no longer sees the leakage inductance (because the secondary is no longer clamped by the load); instead it sees the magnetizing inductance $L_{\mathrm{M}}$ of $895 \mu \mathrm{H}$ (because the secondary is now open-circuited). ${ }^{15}$ The new calculated resonant frequency then drops to about 615 kHz . You can see the first half-cycle of this slower resonance in the measured waveforms, centered on the +160 V dc input voltage, and interrupted by the onset of the next conduction cycle. (We later ran the converter at $25 \%$ load, which allowed three cycles of ringing at $\sim 600 \mathrm{kHz}$, in excellent agreement with this estimate.)

While we're on the subject of parasitic capacitances, this is a good time to note the $\sim 0.3 \mathrm{~A}$ current spikes at switch turn-on. This occurs because the switch is abruptly shorting a charged capacitor (the parallel capacitance of

[^540]the switch itself, plus attached components). This is called "hard switching," and is responsible for significant power losses in converters running at high switching frequencies. Here, for instance, we can estimate the power dissipated in the switch by multiplying $\frac{1}{2} C V^{2}$ by the switching frequency, giving $P_{\text {diss }} \approx 0.15 \mathrm{~W}$. That's not too serious at this modest switching frequency of 100 kHz , being just $1 \%$ of the output power; but its relative contribution is greater at low load current, and in any case it contributes to switch dissipation and stress. And it becomes increasingly important as you try to increase the switching frequency (in order to reduce size). The solution is to strive for "soft switching," in which the voltage across the switch is brought close to zero before switch activation (by exploiting reactive currents to discharge parasitic capacitances); this goal is called "zero-voltage switching" (ZVS).

#### G. Secondary power train

Moving to the secondary side, the rectifier is a Schottky type, which has both low forward voltage drop and zero recovery time (absence of charge storage). ${ }^{116}$ Schottky rectifiers (also known as hot carrier rectifiers) are available at voltages up to $\sim 100 \mathrm{~V}$; above that you'd use a "fastrecovery" (or "fast soft-recovery," like $D_{3}$ ) rectifier. Power rectifiers often come packaged as duals for applications that require two; here they've simply connected them in parallel. Note the heatsink: 3 A of average load current flowing through a 0.5 V (Schottky) forward drop dissipates 1.5 W , enough to merit a small heatsink. The series $R C$ provides some damping and attenuation of switching transients, as do the ferrite beads. The series inductor $L_{2}$ filters ripple at the switching frequency: its reactance at the 100 kHz switching frequency is $2.7 \Omega$, compared with an impedance of $\sim 0.1 \Omega$ (dominated by series resistance) for the downstream storage capacitors.

#### H. Secondary regulation

This power supply uses the popular TL431 "shunt regulator," which includes an internal voltage reference and error amplifier, and which goes into heavy conduction when the reference pin reaches 2.5 V above the ground pin. That turns on the optocoupler $U_{3}$ 's LED emitter, for currents above about 2 mA (the threshold set by the $680 \Omega$ resistor). The resistive divider and trimmer allow $\pm 0.4 \mathrm{~V}$ output adjustment, and the series $R C$ around the TL431 is a com-

[^541]pensation network to prevent oscillation. The large shunt capacitor limits the loop bandwidth, and also accomplishes "soft-start" at power-on: this it does by tricking the optoemitter into thinking that the TL431 is conducting, when in fact the LED current is coming from the ramp-up of output voltage. It's easy to verify that an output ramp-up of $1.5 \mathrm{~V} / \mathrm{ms}$ produces a sinking current of 5 mA at the cathode of the optocoupler LED, thus stretching the startup to about 3 ms , and therefore setting the secondary current needed to charge the four output storage capacitors to $\sim 3.4 \mathrm{~A}$, roughly equal to the supply's maximum current rating.

#### I. Other design features

There are just a few additional goodies in this circuit. Capacitor $C_{\mathrm{Y}}$ is used to suppress conducted EMI. Because it bridges the isolation barrier, it must have appropriate " Y capacitor" safety ratings (see $\S 9.5 .1$ ). Rectifier $D_{7}$ protects against reverse polarity, in case some misbehaving load decides to create mayhem. The small output capacitor ensures low output impedance at high frequencies, where the large electrolytic capacitors become less effective (owing to internal inductance and ESR). And, finally, the switchmode controller itself $\left(U_{1}\right)$ includes a host of nice features: internal oscillator requiring no external timing components, internal cycle-by-cycle current limit, overtemperature protection, automatic restart, internal regulator and dc source switching, and on-chip high-voltage power MOSFET, all integrated in an elegant 3 -terminal configuration. Its high level of integration stole our thunder: it robbed us of the opportunity to show these important circuits explicitly!

### 9.8.4 The "reference design"

This is a nice power supply. We've bought a lot of them, and they work reliably and well. The circuit design might seem forbiddingly complicated, certainly for those inexperienced in offline switchmode supply design. In fact, we recommend strongly that the user of such supplies should not try to design and build them - buy them from the expert folks who do this for a living (see below).

But, how did those experts come up with this particular design? As it turns out, the manufacturers of interesting ICs have a great interest in making it painless to use their products. For this noble objective they provide what are known as reference designs, which basically consist of a complete circuit example (usually available from them as a "development board" or "evaluation board"). For the regulator chip used in this particular power supply, for example, Power Integrations (the TOP201 manufacturer) provides four example circuits, with increasing levels of regulation
stability (called "minimum parts count," "enhanced minimum parts count," "simple optocoupler feedback," and "accurate optocoupler feedback"). And in a pair of "Application Notes" ${ }^{117}$ they provide a step-by-step recipe for these designs, complete with flowcharts, formulas, and graphs. You can hardly go wrong. The supply of Figure 9.83 , in fact, closely follows the "accurate optocoupler feedback" design, differing primarily in the inclusion of soft start, ferrite beads, and reverse polarity protection. This is not to say that the design is a trivial exercise - the implementation of the transformer, the packaging and layout, and the process of testing and regulatory approval are all major challenges.

### 9.8.5 Wrapup: general comments on line-powered switching power supplies

- Line-powered switchers are ubiquitous, and for good reasons. Their high efficiency keeps them cool, and the absence of a low-frequency transformer makes them considerably lighter and smaller than the equivalent linear supply. As a result, they are used almost exclusively to power industrial and consumer electronics.
- Switchers are noisy! Their outputs have tens of millivolts of switching ripple; they put garbage onto the powerline; and they can even scream audibly! One cure for output ripple, if that's a problem, is to add an external high-current $L C$ lowpass filter; alternatively, you can add a low-dropout linear post-regulator. ${ }^{118}$ Some commercial converters include this feature, as well as complete shielding and extensive input filtering.
- Switchers with multiple outputs are available and are popular in computer systems. However, the separate outputs are generated from additional windings on a common transformer. Typically, feedback is taken from the highest current output (usually the +3.3 V or +5 V output), which means that the other outputs are not particularly well regulated. There is usually a "cross-regulation" specification, which tells, for example, how much the +12 V output, say, changes when you vary the load on the +5 V output from $75 \%$ of full load to either $50 \%$ or $100 \%$ of full load; a typical cross-regulation specification is $5 \%$. Some multiple-output switchers achieve excellent regulation by using linear post-regulators on the auxiliary outputs, but this is the exception. Check the specs!

[^542]- Line-powered switchers, like other switching converters, may have a minimum load-current requirement. If your load current could drop below the minimum, you'll have to add some resistive loading; otherwise the output may soar or oscillate.
- When working on a line-powered switcher, watch out! This is no empty warning - you can get yourself killed. Many components are at or above line potential and can be lethal. You can't clip the ground of your 'scope probe to the circuit without catastrophic consequences! (Use a 1:1 isolation transformer at the input, if you must go poking around.)
- Switchers usually include overvoltage "shutdown" circuitry, analogous to our SCR crowbar circuits, in case something goes wrong. However, this circuit often is simply a zener sensing circuit at the output that shuts off the oscillator if the dc output exceeds the trip point. There are imaginable failure modes in which such a "crowbar" wouldn't crowbar anything. ${ }^{119}$ For maximum safety you may want to add an autonomous outboard SCR-type crowbar.
- Switchers used to have a bad reputation for reliability, but recent designs seem much better. However, when they decide to blow out, they sometimes do it with great panache! We had one blow its guts out in a "catastrophic deconstruction," spewing black crud all over its innards and innocent electronic bystanders as well.
- Line-powered switchers are definitely complex and tricky to design reliably. Our advice is to avoid the design phase entirely, by buying what you need! After all, why build what you can buy?
- A switching supply, operating at roughly constant efficiency, presents a load that looks like a negative resistance (averaged over the ac wave) to the powerline that drives it. It can cause some crazy effects, including (but not limited to) oscillations, when combined with the input reactance of noise filters.


### 9.8.6 When to use switchers

Luckily for you, we're not bashful about giving advice! Here it is.
119 A personal anecdote: we smelled smoke, and found a dead 'scope in our lab one day. We opened it up, and found that the PFC's output storage capacitor $(470 \mu \mathrm{~F}, 450 \mathrm{~V})$ had failed, exuding lots of gooey stuff. No problem, we thought, we'll just replace it; especially since a new supply costs $\$ 800$ ! Power on, looks good, go to lunch... come back, smoke! Turns out the PFC controller chip failed in a way that prevented both regulation and overvoltage shutdown, so the boost circuit just kept boosting, until the capacitor cried uncle.

- For digital systems, you usually need something like $+2.5 \mathrm{~V},+3.3 \mathrm{~V}$, or +5 V , often at high current (10A or more). Advice: (a) Use a line-powered switcher. (b) Buy it (perhaps adding filtering, if needed).
- For analog circuits with low-level signals (small-signal amplifiers, signals less than $100 \mu \mathrm{~V}$, etc.). Advice: Use a linear regulator; switchers are too noisy - they will ruin your life. ${ }^{120}$ Exception: For some battery-operated circuits it may be better to use a low-power dc-dc switching converter.
- For high-power anything. Advice: Use a line-powered switcher. It's smaller, lighter, and cooler.
- For high-voltage, low-power applications (photomultiplier tubes, flash tubes, image intensifiers, plasma displays). Advice: Use a low-power step-up converter.

In general, low-power dc-dc converters are easy to design and require few components, thanks to handy chips like the Simple Switcher series we saw earlier. Don't hesitate to build your own. By contrast, high-power switchers (generally line-powered) are complex and tricky, and extremely trouble-prone. If you must design your own, be careful, and test your design very thoroughly. Better yet, swallow your pride and buy the best switcher you can find.

### 9.9 Inverters and switching amplifiers

The benefits of switchmode power conversion - high efficiency and small size - can be applied to the generation of a time-varying output voltage. You can think of this as "dc-to-ac" conversion, as contrasted with a dc-to-dc power converter. In essence, you can imagine substituting an input signal for the fixed dc voltage reference of a switchmode dc regulator; the output will follow the input signal as long as the input signal bandwidth is well below the switching frequency.

Switching converters of this sort are used widely, for example to provide multiphase ac power for motor driving, or to generate the individual winding currents for microstepping motors. A variable-frequency motor driver lets you control the motor speed. Powerline-frequency dc-toac converters are often called inverters, such as those used
${ }^{120}$ Really! Here's a pithy quote from James Bryant (from the Analog Devices "Rarely Asked Questions" series), in answer to the question "How can I prevent switching-mode power supply noise from devastating my circuit performance?" Answer: "With great difficulty but it can be done." He continues: "Switching-mode power supplies are inherently the noisiest circuits imaginable. A large current from the supply is being turned on and off at high frequency with very fast $d I / d t$. There are inevitably large fast voltage and current transients."
in uninterruptible power supplies (UPSs) for computers. At higher power levels such inverters are used to generate powerline-frequency ac from the high-voltage dc that is shipped across the countryside (at dc voltages up to a megavolt, would you believe?). And, closer to home, switching audio amplifiers (known as "class-D" amplifiers; see §2.4.1C) are dominant in consumer electronics. In that application a passive $L C$ lowpass filter smooths a rail-to-rail switching waveform (typically at frequencies of $\sim 250 \mathrm{kHz}$ or higher) whose duty cycle is modulated in accordance with the input signal. See Figure 2.73 for waveforms from a low-power class-D audio amplifier.

To get just a taste of this subfield of power electronics, take a look at Figure 9.87, where we've captured waveforms from two styles of uninterruptible 120 Vac power supplies, along with the raw 120 Vac wallplug power in our lab. You might guess that the clean middle waveform is the utility power, but in fact that waveform is the loaded output from a UPS that boasts "low-distortion sine wave." The top waveform is the wallplug power, showing rather typical levels of distortion. The 3-level waveform at the bottom is euphemistically called a "modified sinewave," and is typical of less-expensive inverters and UPSs. It isn't handsome, but it does the job: if switched to $\pm 170 \mathrm{~V}$ rails $25 \%$ of the time, and to zero (or unpowered) in between, it's easy to figure out that it has the same rms voltage ( 120 Vrms ) and peak voltage ( 170 Vpk$)$ as a 120 Vrms sinewave. ${ }^{121}$ So it delivers the same power to resistive loads, etc., and it
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0706.jpg?height=453&width=802&top_left_y=1419&top_left_x=1071)

Figure 9.87. A true sinewave inverter generates a cleaner sinewave than wallplug ac. The 3 -level waveform (sometimes called modified sinewave), though hardly a sinewave, has the same rms and peak voltages, and suffices for most loads. For these measured waveforms we loaded the APC UPSs with a 75 W incandescent lamp. Vertical: $100 \mathrm{~V} / \mathrm{div}$; horizontal: $4 \mathrm{~ms} /$ div.

[^543]charges the input side of dc power supplies or converters to the same voltage as would the 120 Vrms utility line power.

There's more to think about than simply having the same rms and peak voltage, of course. There's distortion: the 3-level waveform has no even harmonics, but it has strong harmonics at all odd multiples of the fundamental frequency (there are various multilevel schemes to address this problem). Then there's the worry about systems that exploit zero crossings of the incoming ac power for timing, for which the 3-level waveform (or any stepped waveform with an odd number of levels) would wreak havoc. ${ }^{122}$ There's plenty more to think about, even limiting ourselves to the subject of multilevel inverters. ${ }^{123}$

This area of power electronics is a rich subject; but, sadly, life is finite, and so (barely) is the size of this book.

### 9.10 Voltage references

Quite apart from their use in integrated voltage regulators, there is frequently the need for good voltage references within a circuit. For instance, you might wish to construct a precision regulated supply with characteristics better than those you can obtain using the best integrated regulators. Or you might want to construct a precision constant-current supply. Other applications requiring precision references (but not a precision power supply) include A/D and D/A converters, precision waveform generators, and accurate voltmeters, ohmmeters, or ammeters.

Integrated voltage references come in two styles: 2terminal (or shunt), and 3-terminal (or series). Twoterminal references act like zener diodes, maintaining a constant voltage drop when current is flowing; the external circuit must provide a reasonably stable operating current. Three-terminal references ( $V_{\text {in }}, V_{\text {out }}$, GND) act like linear voltage regulators, with internal circuitry taking care of biasing the internal reference (whether a zener diode, or something else). In Tables 9.7 and 9.8 (on pages 677 and 678, respectively) we've listed an abundance of currently available references of both types.

There are four different technologies used in currently available voltage references, all of which exploit some physical effect to maintain a well-defined and stable volt-

[^544]age - zener diodes, bandgap references, JFET pinchoff references, and floating gate references. They are all available as stand-alone (2-terminal or 3-terminal) components; they are also commonly incorporated as an internal voltage reference within a larger IC such as an A/D converter. Let's take them in order.

### 9.10.1 Zener diode

The simplest form of voltage reference is the zener diode, a 2-terminal device we introduced in $\S 1.2 .6 \mathrm{~A}$. Basically, it is a diode operated in the reverse-bias region, where current begins to flow at some voltage and increases dramatically with further increases in voltage. To use it as a reference, you simply provide a roughly constant current; this is often done with a resistor from a higher supply voltage, forming the most primitive kind of regulated supply.

Zeners are available in selected voltages from 2 to 200 volts (they come in the same series of values as standard $5 \%$ resistors), with power ratings from a fraction of a watt to 50 watts, and tolerances of $1 \%$ to $20 \%$. As attractive as they might seem for use as general-purpose voltage references (being simple, inexpensive, passive 2-terminal devices), zeners lose their luster when you look a bit more closely: it is necessary to stock a selection of values, the voltage tolerance is poor except in high-priced precision zeners, they are noisy (above 7 V ), and the zener voltage depends on current and temperature. As an example of the last two effects, a 27 V zener in the popular 1N5221 series of 500 mW zeners has a temperature coefficient of $+0.1 \% /{ }^{\circ} \mathrm{C}$, and it will change voltage by $1 \%$ when its current varies from $10 \%$ to $50 \%$ of maximum.

There is an exception to this generally poor performance of zeners. It turns out that in the neighborhood of 6 volts, zener diodes are quiet, become very stiff against changes in current, and simultaneously achieve a nearly zero temperature coefficient. The graphs in Figures 9.88 and 9.89 illustrate the effects. ${ }^{124}$ If you need a zener for use as a stable voltage reference only, and you don't care what voltage it is, one possibility is to use one of the compensated zener references constructed from a 5.6 V zener (approximately) in series with a forward-biased diode - if you can find one! (Read on...) The zener voltage is chosen to give a positive coefficient to cancel the diode's temperature coefficient of $-2.1 \mathrm{mV} /{ }^{\circ} \mathrm{C}$. Temperature compensation can be

[^545]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0708.jpg?height=493&width=713&top_left_y=218&top_left_x=266)

Figure 9.88. Zener diode dynamic impedance for zener diodes of various voltages. (Courtesy of Motorola, Inc.)
accomplished for other zener voltages also, for example in the 1 N4057-85 series, which go from 12 V to 200 V , with tempcos of $20 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$.

Let's follow this thread - which, as we'll see, will lead us to a far better solution in the form of fully integrated voltage references (including those with a temperaturecompensated zener on-chip) with superior characteristics. In fact, temperature-compensated zeners, as discrete devices, have become largely an extinct breed.

#### A. Providing operating current

A compensated zener could be used as stable voltage reference within a circuit, but it must be provided with constant
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0708.jpg?height=498&width=680&top_left_y=1649&top_left_x=280)

Figure 9.89. Temperature coefficient of zener diode breakdown voltage versus the voltage of the zener diode. (Courtesy of Motorola, Inc.)
current. ${ }^{125}$ The tightly specified ${ }^{126} 1 \mathrm{~N} 4895$, for example, is specified as $6.35 \mathrm{~V} \pm 5 \%$ at 7.5 mA , with a tempco of $5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}(\max )$ and incremental resistance of $10 \Omega(\max )$. So a change in bias current of 1 mA can change the reference voltage by 10 mV , three times as much as a change in temperature from $0^{\circ} \mathrm{C}$ to $+100^{\circ} \mathrm{C}$. You can, of course, rig up a separate current source circuit to bias the zener; but you can do better - Figure 9.90 shows a clever way to use the zener voltage itself to provide a constant bias current. The op-amp is here wired as a noninverting amplifier in order to generate an output of +10.0 V . That stable output is itself used to provide a precision 7.5 mA bias current. This circuit is self-starting, but it can turn on with either polarity of output! For the "wrong" polarity, the zener operates as an ordinary forward-biased diode. Running the op-amp from a single supply, as shown, overcomes this nuisance problem. ${ }^{127}$ Be sure to use an op-amp that has commonmode input range to the negative rail ("single-supply" opamps).

There are compensated zeners available that characterize the stability of zener voltage with time, a specification that normally tends to get left out. The 1 N 4895 , for example, specifies stability of better than $10 \mathrm{ppm} / 1000 \mathrm{~h}$. The ultimate example is probably the LTZ1000, a 7.15 V integrated zener whose datasheet specifies an astonishing longterm stability of $0.15 \mathrm{ppm} / \sqrt{\mathrm{kHr}}$ (typ). This puppy includes an on-chip temperature stabilizing heater, and claims to deliver a tempco as low as $0.05 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, if treated with respect. ${ }^{128}$ Such zeners are not cheap: the LTZ1000 will set you back \$50.
${ }^{125}$ Most small zener diodes are specified at an operating current of 20 mA (though you can run them at lower currents). But, happily for those seeking low-current zeners, there's the 1N4678 to 1N4713 family (MMSZ4678-4713 for surface-mount SOD-123 package), specified at $50 \mu \mathrm{~A}$.
126 And individually tested for 1000 hours! It's available only from the manufacturer, Microsemi.
127 With a caveat: the circuit could get stuck at zero output if the op-amp's input offset voltage is greater than the ground-saturated output voltage. This could happen with a rail-to-rail CMOS output stage, which is why we chose a BJT op-amp (whose saturation voltage is at least a few millivolts from ground). If you select a CMOS op-amp (say a precision chopper), or if you're losing sleep over the remote possibility of a stuck circuit, you can force the circuit to start correctly with either of the dotted supplements to the circuit.
128 An example of appropriate respect is the prevention of thermal gradients: a junction of two dissimilar metals (a "thermocouple") generates a thermal EMF, about $35 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ for the connection of the LTZ1000's Kovar-alloy leads to a circuit board. That's about 7 ppm per ${ }^{\circ} \mathrm{C}$ temperature difference in the two leads, which is a hundred times larger than that of the chip's zener itself!
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0709.jpg?height=554&width=1445&top_left_y=218&top_left_x=224)

Figure 9.90. Stable output voltage provides a stable zener bias current over varying supply voltages $V_{+}$. The op-amp must operate to the negative rail. For a jellybean zener like the 1N5232 you can use an inexpensive op-amp like an LM358; but use a precision op-amp (e.g., the LT1077) to preserve the low tempco of a precision reference like the LM329 or LM399. Don't use a split supply here, because the output could happily settle to a negative output.

#### B. IC zeners

We hinted that precision-compensated zeners as discrete devices have largely disappeared; you can check this out for yourself by going to a site like Octopart.com, looking for once-popular parts like the 1 N4895 or 1N821-29 series.

That's the bad news. The good news is that excellent compensated zeners now come in integrated form, as the internal reference within a variety of IC voltage references. Table 9.7 lists several of these, from the inexpensive (less than \$1) LM329 to the spectacular LTZ1000. These include additional circuitry to yield improved performance (most notably, constancy of terminal voltage with applied current), in the form of an integrated circuit; it looks electrically just like a zener, with just two terminals, although internally it includes additional active devices. Being zenerbased, these devices operate around the sweet spot of 7 V , although some (like the LT1236 in the table) include internal amplifier circuitry to create a round-number 10.0 V "zener."129

The jellybean LM329 is worth keeping in mind when you need only a "good-enough" zener reference; it has low noise, a zener voltage of 6.9 V , and in its best version it has a temperature coefficient of $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max), when provided with a constant current of 1 mA . Where better

[^546]performance is needed, consider the LT1236A or the thermally regulated (on-chip heater) LM399A, the latter with an admirable $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ worst-case tempco!

When thinking about 2 -terminal zener references, don't overlook the other voltage reference technologies that are available as 2 -terminal (shunt) devices (see Table 9.7 on the facing page). From the outside they behave just like zener diodes, but they use other tricks (e.g., a $V_{\mathrm{BE}}$ drop) internally to create their stable reference voltage. Among other benefits, such devices come in desirable low voltages ( 1.25 V and 2.5 V are common), and some can operate at currents as low as $1 \mu \mathrm{~A}$. Read on!

And remember always not to limit yourself to 2 terminal references - there are excellent 3 -terminal references, both zener based and otherwise. A fine example is the LT1027B, a zener-based 5.0 V reference with excellent tempco ( $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, max) and low noise ( $3 \mu \mathrm{Vpp}$ typ, $0.1-10 \mathrm{~Hz}$ ). A nice feature of most of the integrated references (both 2 -terminal and 3 -terminal) is the convenient output voltages they provide: instead of having to deal with something like $V_{\text {out }}=6.95 \mathrm{~V} \pm 4 \%$ (the voltage specification of the excellent LM399 temperature stabilized 2terminal zener reference), you get precise round-number output voltages like $1.25 \mathrm{~V}, 2.50 \mathrm{~V}, 5.0 \mathrm{~V}$, and 10.0 V , factory trimmed to an accuracy as good as $\pm 0.02 \%$ (see Tables 9.7 and 9.8). ${ }^{130}$

[^547]Table 9.7 Shunt (2-terminal) Voltage References ${ }^{a}$
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0710.jpg?height=171&width=1567&top_left_y=231&top_left_x=260)
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0710.jpg?height=1284&width=1606&top_left_y=409&top_left_x=243)

Notes: (a) generally listing best accuracy grade.; sorted by type and increasing accuracy. (b) wired as a zener. (c) at 10mA. (CL) load capacitor - R: >10nF required; N : not required but allowed, or recommended for transient-loads; $\mu \mathrm{F}=\mathrm{min}$ required if more than a small cap is added, see datasheet; blank = no comment. The ac output impedance rises with frequency and will resonate with the load capacitor's reactance. A small resistor ( 22 to 100 , etc.) can isolate the capacitor and lower the resonance Q. (d) 5-10mA. (e) at $I_{z}=7.5 \mathrm{~mA}$. (f) $\Delta \mathrm{V}$ ( mV ) over temp. (g) for the 2.5 V version (the 1.2 V version is generally less). ( h ) for the 1.225 version, or $V_{\text {ref }}$ for the adj version. (k) an $R C$ is suggested, e.g. $22 \Omega$. ( m ) min or max. ( n ) nominal. ( na ) not available. (o) of the 1.24 V ref, gained up to $V_{\text {clamp. }}$. (p) also TLVH431A. (q) minimum operating current (maximum, i.e., worst-case); often higher for higher fixed voltages. (r) usually at 1 mA , but not current dependent. (s) see datasheet. (t) typical. (u) spec'd over operating range. (v) 6V for TI's TLV431, 16V for Onsemi TLV431 or TI TLVH431. (w) see datasheet for exact value, chosen for minimum tempco. (x) scaled to 1.0 V output; multiply listed value by Vout.
Comments: 1: two resistors set $V_{\text {clamp. }}$ 2: $I_{\text {ref }}=4 \mu \mathrm{~A}$ max. 3: $I_{\mathrm{ref}}=0.5 \mu \mathrm{~A}$ max; complementary to LM385-adj. 4: $I_{\mathrm{ref}}=0.5 \mu \mathrm{~A}$ max; TLV432 is alternate pinout. 5: LM336 has voltage-trim pin. 6: multiple-source jellybean. 7: -BX version is $30 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$; $I_{r e f}=15 \mathrm{nA}$. 8: dual: bandgap and 7 V zener ( $1.6 \%, 40 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ typ, $90 \Omega$ ), common neg terminal. 9 : lowest $V_{\text {ref }}$ shunt ref. $10: 1.235 \mathrm{~V}$ is $0.3 \%$ tol, 2.45 V is $0.8 \%$ tol. 11: Tl's -CDR suffix costs $\$ 0.25$ (qty 25). 12: nanopower, min $I_{z}=1 \mu \mathrm{~A} ; 40 \mathrm{~ms}$ turn-on settling time with $1.2 \mu \mathrm{~A}$ bias and 10nF cap. 13: MAX6007, 08, 09 for other voltages. 14: LM336 upgrade. 15: non -A version. 16: -B, -C, -D suffix looser tolerance. 17: -A suffix $0.2 \%$ tolerance. 19: -C suffix for looser tolerance. 20: nanopower. 21: -A suffix is $5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ typ, $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ max. 22: series ref used in shunt mode. 23: on-chip heater; lowest guaranteed tempco. 24: factory purchase. 25: low-voltage zeners are poor! 26: optimum zener voltage. 27: tested 1k hours; "reference zener," spec'd at 7.5mA only. 28: temp comp zener reference.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0711.jpg?height=2064&width=1603&top_left_y=172&top_left_x=122)

Well, you say, I could do that with the circuit of Figure 9.90 , which lets me set the dc output voltage via the ratio of $R_{1} / R_{2}$. Sure. But hold on - standard metal-film resistors come in $1 \%$ precision, with tempcos in the range of $\pm 50 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. You can get fixed resistors and arrays with tempcos down in the $\pm 1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ territory (see $\S 5.6$ ), but you'll pay a dear price, and the resistance selection is sparse. And don't forget that you've still got to trim the gain to reach the precise round-number output voltage. Use a trimpot? Not a good idea, because the tempco will suffer, and you will have to worry about resistance stability (wiper resistance, mechanical stability, etc.). You're likely to conclude that an on-chip factory-trimmed resistive divider (matched tempcos, thus very low tempco of gain) is the way to go. And it is.

### 9.10.2 Bandgap ( $V_{\mathrm{BE}}$ ) reference

This method exploits the $\sim 0.6 \mathrm{~V}$ base-emitter voltage drop of a transistor operating at constant collector current (it should properly be called a $V_{\mathrm{BE}}$ reference), as given by the Ebers-Moll equation. Because that voltage has a negative temperature coefficient, the technique involves the generation of a voltage with a positive temperature coefficient the same as $V_{\mathrm{BE}}$ 's negative coefficient; when added to a $V_{\mathrm{BE}}$, the resultant voltage has zero tempco.

Figure 9.91 shows how it works. We start with a current mirror with two transistors operating at different emitter current densities (typically a ratio of 10:1). Using the Ebers-Moll equation, it is easy to show that $I_{\mathrm{Q} 2}$ has a positive temperature coefficient, because the difference in $V_{\mathrm{BE}}$ 's is just $(k T / q) \log _{e} r$, where $r$ is the ratio of current densities (see the graph in Figure 2.62). You may wonder where we get the constant current to program the mirror. Don't worry - you'll see the clever method at the end. Now all you do is convert that current to a voltage with a resistor and add a normal $V_{\mathrm{BE}}$ (here $Q_{3}$ 's $V_{\mathrm{BE}}$ ). $R_{2}$ sets the amount of positive-coefficient voltage you have added to $V_{\mathrm{BE}}$, and by choosing it appropriately, you get zero overall temperature coefficient. ${ }^{131}$ It turns out that zero temperature coefficient occurs when the total voltage equals the silicon bandgap voltage (extrapolated to absolute zero), about 1.22 V . The circuit in the box is the reference. Its own output is used (via $R_{3}$ ) to create the constant mirror programming current we initially assumed.

The classic bandgap reference requires three transistors, two for $\Delta V_{\mathrm{BE}}$ and the third to add a $V_{\mathrm{BE}}$. However, Widlar

[^548]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0712.jpg?height=493&width=730&top_left_y=218&top_left_x=1107)

Figure 9.91. Classic $V_{\mathrm{BE}}$ bandgap voltage reference. The transistor pair $Q_{1} Q_{2}$ is a ratio current mirror, typically $I_{\mathrm{Q} 1}=10 I_{\mathrm{Q} 2}$; that ratio puts 60 mV across $R_{1}$, which sets the PTAT current $I_{\mathrm{Q} 2}$.
and Dobkin cleverly created a two-transistor version, first used in the LM317, see Figure 9.13.

#### IC bandgap references

An example of an IC bandgap reference is the inexpensive (about \$0.50) 2-terminal LM385-1.2, with a nominal operating voltage of $1.235 \mathrm{~V}, \pm 1 \%$ (the companion LM3852.5 uses internal circuitry to generate 2.50 V ), usable down to $10 \mu \mathrm{~A}$. That's much less than you normally run zeners at, making these references excellent for micropower equipment. ${ }^{132}$ The low reference voltage $(1.235 \mathrm{~V})$ is often more convenient than the approximately 5 V minimum usable voltage for zeners (you can get zeners rated at voltages as low as 1.8 V , but they are pretty awful, with very soft knees). The best grade of LM385 guarantees $30 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ maximum tempco and has a typical dynamic impedance of $1 \Omega$ at $100 \mu \mathrm{~A}$. Compare this with the equivalent figures for a 1 N 43702.4 V zener diode: tempco $=800 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (typ), dynamic impedance $\approx 3000 \Omega$ at $100 \mu \mathrm{~A}$, at which the "zener voltage" (specified as 2.4 V at 20 mA ) is down to 1.1 V ! When you need a precision stable voltage reference, these excellent bandgap ICs put conventional zener diodes to shame.

If you're willing to spend a bit more money, you can find bandgap references of excellent stability, for example, the

132 But note that low-current references tend to be noisy: the LM385$2.5(20 \mu \mathrm{~A} \min )$ running at $100 \mu \mathrm{~A}$ has a noise voltage density of $800 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, compared with $120 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ for the analogous LT1009 or LM336-2.5 references ( $400 \mu \mathrm{~A} \mathrm{~min})$ running at 1 mA . And, if you're willing to squander more operating current, the LTC6655 lownoise 3-terminal bandgap reference (with a quiescent current of 5 mA ) has an output noise density of just $50 \mathrm{nV} / \sqrt{\mathrm{Hz}}$, and, impressively, with a $1 / f$ noise corner below 10 Hz .

2-terminal LT1634A (2.5 V or $5 \mathrm{~V}, 10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ max, about \$6), or the 3-terminal AD586 (5 V, $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ max, about \$9).

One other interesting bandgap-based voltage reference is the extremely popular TL431. It is an inexpensive (less than $\$ 0.10$ in large quantities) 2-terminal shunt regulatorreference, but with a third terminal to set the voltage. You hook it up as shown in Figure 9.92. The "zener" turns on when the control voltage reaches 2.50 V ; the device draws only a few microamps from the control terminal, and gives a typical tempco of output voltage of $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. The circuit values shown give a zener voltage of 10.0 V , for example. This versatile device comes in TO-92, miniDIP, and a half-dozen surface-mount packages, and can handle currents to 100 mA and voltages to 36 V . Its lowvoltage and low-power ( $80 \mu \mathrm{~A} \min )$ cousins, the TLV431 and TLVH431, work the same way, but with a 1.25 V internal bandgap reference and limited output voltage and current. ${ }^{133}$ Both types come in accuracy grades of $\pm 2 \%, \pm 1 \%$, and $\pm 0.5 \%$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0713.jpg?height=264&width=743&top_left_y=1067&top_left_x=154)

Figure 9.92. TL431 adjustable shunt regulator-reference. The resistive divider in the application circuit on the right sets the "zener" voltage to 10.0 V .

#### Bandgap temperature sensors

The predictable $V_{\mathrm{BE}}$ variation with temperature can be exploited to make a temperature-measuring IC. In Figure 9.91, for example, the difference in $V_{\mathrm{BE}}$ 's of $(k T / q) \log _{e} r$ implies that the current through $Q_{2}$ (and also $Q_{1}$ ) is proportional to absolute temperature (PTAT). The circuit can be rearranged (the Brokaw circuit) to produce simultaneously both an output voltage proportional to temperature, and a (fixed) bandgap voltage reference of 1.25 V . This is the case with a number of bandgap references, for example the AD680, a 2.50 V reference with an additional TEMP pin whose output voltage is $2.0 \mathrm{mV} / \mathrm{K}$ (thus 596 mV at $25^{\circ} \mathrm{C}$ ). If you want only a temperature sensor, and don't need the bandgap reference, you can get nice stand-alone

[^549]temperature sensors, for example the LM35, a 3-terminal sensor with $10 \mathrm{mV} /{ }^{\circ} \mathrm{C}$ output ( 0 V at $0^{\circ} \mathrm{C}$ ), or the LM61, whose output is offset by +600 mV so it can measure from $-30^{\circ} \mathrm{C}$ to $+100^{\circ} \mathrm{C}$. The LM61 costs a half dollar, compared with $\$ 3$ for the 8-pin multifunction AD680.

### 9.10.3 JFET pinch-off ( $V_{\mathrm{P}}$ ) reference

This recent technique is analogous to the $V_{\mathrm{BE}}$-based bandgap reference, but uses instead the gate-source voltages of a pair of JFETs. A single JFET operating at fixed drain current has a wicked tempco of $V_{\mathrm{GS}}$, but this can be circumvented by cleverly using a JFET pair. Figure 9.93 shows the configuration used in the ADR400series of "XFET" voltage references from Analog Devices. The JFET pair $Q_{1} Q_{2}$ have identical geometry and run at equal drain currents; but their different channel doping produces a gate-voltage difference of $\sim 0.5 \mathrm{~V}$ that is quite stable, with a relatively small tempco of $-120 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. That's much smaller than the tempco of a $V_{\mathrm{BE}}$ drop (roughly $-3000 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ ), and requires only a small dose of positive tempco correction, here applied by the voltage drop across $R_{1}$.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0713.jpg?height=547&width=703&top_left_y=1181&top_left_x=1021)

Figure 9.93. JFET voltage reference. The asymmetrically doped JFET pair, running at the same drain current, generates a difference voltage $\Delta V_{\mathrm{GS}}$ between the gates. The relatively small tempco is compensated by a current derived from a bandgap-type reference (not shown).

The result is a voltage reference with excellent tempco (e.g., $3 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ or $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ for the two grades in the ADR400-series). An important benefit of this technique is its unusually low noise ( $1.2 \mu \mathrm{Vpp}$ for the 2.5 V part $\left.{ }^{134}\right)$.

[^550]Bandgap references cannot match this sort of noise performance, because the process of compensating for their large intrinsic temperature coefficient introduces the lion's share of their output noise.

### 9.10.4 Floating-gate reference

This most recent entry into the voltage reference sweepstakes is, well, bizarre. If you were challenged to come up with an idea that would most likely fail, you might invent the "floating-gate array" (FGA) reference. Intersil did that, but they made it succeed! The idea is to put some charge onto the buried and well-insulated gate of a MOSFET, during manufacturing, which puts it at some voltage (thinking of it as a capacitor); the MOSFET then acts as a voltage follower (or op-amp input) to create a stable output voltage.

The stability over time depends, of course, on the tiny capacitor not losing or gaining any charge. That's a tall order - you'd like it to remain stable to perhaps 100 ppm over several years, over the full operating temperature range. A gate capacitance of 100 pF charged to 1 V , for example, would require that gate leakage be no more than $10^{-22} \mathrm{~A}$; that's about two electrons per hour!

Somehow the folks at Intersil have made it work. They also dealt with stability over temperature, with several tricks: one method uses capacitors of different construction to cancel the already-small tempco of approximately $20 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$; another method uses capacitors of one type only, cancelling the small residual tempco by adding a voltage of known tempco (as in the bandgap and JFET references).

The results are impressive: the ISL21009 series claim long-term stabilities of order 10 ppm per square-rootkilohour; tempcos of $3 \mathrm{ppm} /{ }^{\circ} \mathrm{C}, 5 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, and $10 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max) for the three grades; ${ }^{135}$ noise of $4.5 \mu \mathrm{Vpp}$; and very low supply current of 0.1 mA (typ). They come in preset voltages of $1.250 \mathrm{~V}, 2.500 \mathrm{~V}, 4.096 \mathrm{~V}$, and 5.000 V , each available in several grades of accuracy and tempco.

### 9.10.5 Three-terminal precision references

As we remarked earlier, these clever techniques make possible voltage references of remarkable temperature stability (down to $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ or less). This is particularly impressive when you consider that the venerable Weston cell, the traditional voltage reference through the ages, has a tempera-

[^551]ture coefficient of $40 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. There are two methods used to make references of the highest stability.

#### A. Temperature-stabilized references

A good way of achieving excellent temperature stability in a voltage reference circuit (or any other circuit, for that matter) is to hold the reference, and perhaps its associated electronics, at a constant elevated temperature. In this way the circuit can deliver equivalent performance with a greatly relaxed temperature coefficient, because the actual circuit components are isolated from external temperature fluctuations. Of greater interest for precision circuitry is the ability to deliver significantly improved performance by putting an already well-compensated reference circuit into a constant-temperature environment.

This technique of temperature-stabilized or "ovenized" circuits has been used for many years, particularly for ultrastable oscillator circuits. There are commercially available power supplies and precision voltage references that use ovenized reference circuits. This method works well, but it has the drawbacks of bulkiness, relatively large heater power consumption, and sluggish warm-up (typically 10 min or more). These problems are greatly reduced if the thermal stabilization is done at the chip level by integrating a heater circuit (with sensor) onto the IC itself. This approach was pioneered in the 1960s by Fairchild with the $\mu \mathrm{A} 726$ and $\mu \mathrm{A} 727$ temperature-stabilized differential pair and preamp, respectively.

This technique is used in the LM399 and LTZ1000 references, which claim stabilized tempcos below $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max). Users should be aware that the subsequent opamp circuitry, including gain-setting resistors, may degrade performance considerably unless extreme care is used in design. In particular, low-drift precision op-amps and matched-tempco resistor arrays are essential. These aspects of precision circuit design are discussed in Chapter 5.

#### B. Precision unheated references

Clever chip design has made possible unheated references of nearly comparable stability. For example, the MAX6325 series from Maxim have tempcos of $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max), with no heater power or warm-up delays. Furthermore, they exhibit low noise and long-term drift. Their chief drawback is the difficulty in getting them! These high-stability references (LTZ1000, LM399, and MAX6325) all use buried zeners.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0715.jpg?height=634&width=687&top_left_y=219&top_left_x=315)

Voltage Reference Types

| A ADR5045 | J LM399, Z7 |
| :--- | :--- |
| ADR445 |  |

Figure 9.94. Noise density ( $e_{\mathrm{n}}$ ) versus frequency for a selection of voltage references. All are for 5 V output, except as noted; boldface part numbers are shunt type (2-terminal), the rest are series type (3-terminal). The LTZ1000 is operated at 4 mA . Notes: (5) 2.5 V reference, curve shown is $2 \times$ datasheet's $e_{\mathrm{n}}$ plot; (b) upper resistor bypassed; (c) with $1 \mu \mathrm{~F}$ noise reduction cap; (f) 4.096 V part; ( x ) "XFET" reference; (z5) buried zener, 5 V buffered output; (z7) 7 V buried zener.

### 9.10.6 Voltage reference noise

We mentioned briefly the business of noise, in connection with low-power references on page 679 . You can always add filtering to suppress power supply or reference noise at higher frequencies (see the discussion of the capacitance multiplier in §8.15.1), but there's no substitute for a quiet reference at low frequencies, where the noise properties of the reference set a lower limit on output noise. The listings in Table 9.7 on page 677 and 9.8 on page 678 include datasheet values for integrated low-frequency noise ( $0.1-$ 10 Hz , in units of $\mu \mathrm{Vpp}$ ), as well as rms noise voltage at somewhat higher frequencies (usually $10 \mathrm{~Hz}-10 \mathrm{kHz}$ ). In Figure 9.94 we've plotted noise-density curves ( $e_{\mathrm{n}}$, in units of $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ ) for those references whose datasheets are considerate enough to provide such information. It's often useful to normalize the specified noise voltage values by the reference's voltage, to get a fair comparison among competing devices.

You can add lowpass filtering to reduce the noise from a voltage reference. Some references bring out an internal node on a "filter" pin (or "bypass," or "noise-reduction" pin) that you can bypass to ground; Table 9.3 indicates those in the "filter pin" column. Often the datasheets for such parts include numeric or graphical information to guide you in the choice of filter capacitor. ${ }^{136}$

Another technique you can use is the addition of an

[^552]external lowpass filter, with an op-amp follower. Figure 9.95 shows this simple scheme, with an interesting twist: the basic lowpass filter is $R_{2} C_{2}$, with a time constant of 2.2 seconds ( 3 dB rolloff at 0.07 Hz ). But why on earth is it perched atop $C_{1}$ ?! That's done in order to eliminate $C_{2}$ 's leakage current (which would produce an accuracydamaging voltage drop across $R_{2}$ ) by bootstrapping the low side of $C_{2}$ - cute! The inclusion of $R_{1} C_{1}$ affects the rolloff and settling waveform, putting the 3 dB rolloff at 0.24 Hz and producing an $8 \%$ overshoot with a lengthened settling time ( 30 seconds) to $0.1 \% .{ }^{137}$ For this application you need a pretty good op-amp: input bias current low enough to prevent error from $\Delta V=I_{\mathrm{B}} R_{2}$, and noise voltage low enough to add only insignificantly to the filtered reference's output. The OP-97E or LT1012A are similar and do the job well (or you could use a smaller $R$ and larger $C$, permitting larger op-amp input current).

Generally speaking, a reference that runs at very low current will exhibit more noise, a trend evident in

[^553]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0716.jpg?height=411&width=807&top_left_y=223&top_left_x=219)

Figure 9.95. External lowpass filter with dc bootstrap quiets any voltage reference, while suppressing error from capacitor leakage currents. Use a quiet op-amp follower with low input current.

Table 9.8. This is easy to understand in the case of a bandgap ( $V_{\mathrm{BE}}$ ) reference, because BJT voltage noise decreases as the square root of collector current (see §8.3). You might conclude from this that a given shunt (2-terminal) IC reference would be quieter when biased at higher currents; but you would be wrong - a shunt reference runs its internal bandgap circuit at a current close to the part's "minimum operating current" (with corresponding noise voltage), and so running the reference at a higher current doesn't help.

### 9.10.7 Voltage references: additional Comments

As should be evident from Tables 9.7 and 9.8, there are lots of things to think about when selecting a voltage reference. Here are some bits of advice, to help the bewildered circuit designer (that's you).
Accuracy and drift There's initial accuracy, of course, often with a choice of grades designed by a suffix (-A, -B, etc.), with prices to match. But parts age, and a wellspecified part will include a "long-term drift" figure (usually parts-per-million per thousand hours, or, perhaps more properly, ${ }^{138}$ per $\sqrt{\mathrm{kHr}}$ ), and sometimes a "thermal hysteresis" specification (the voltage offset after thermal cycling

[^554]over the part's operating temperature range). Taking the LTC6655B (best grade) as an example, the initial accuracy is $\pm 0.025 \%$, the tempco is $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (typ) and $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max), the long-term drift is $60 \mathrm{ppm} / \sqrt{\mathrm{kHr}}$ (typ), and the thermal hysteresis is 35 ppm (typ) for thermal cycling between $-40^{\circ} \mathrm{C}$ and $+85^{\circ} \mathrm{C}$. From these figures it's clear that initial accuracy is only a part of the story.

A caution about "temperature coefficient": most often we've used the description in terms of slope, i.e., $\mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (or $\mu \mathrm{V} /{ }^{\circ} \mathrm{C}$, etc.), giving perhaps a typical and a maximum (worst-case) value. But you'll sometimes see the description in terms of maximum deviation over the part's temperature range; an example is the LM385, where the specified worst-case average tempco of $150 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ is described in a footnote: "The average temperature coefficient is defined as the maximum deviation of reference voltage at all measured temperatures from $T_{\mathrm{MIN}}$ to $T_{\mathrm{MAX}}$, divided by $T_{\mathrm{MAX}}-T_{\mathrm{MIN}}$." A maximum tempco so defined is guaranteed to be smaller than the maximum value of "slope" tempco (i.e., the maximum value of $\Delta V / \Delta T$ over the same temperature range), as you can convince yourself by drawing some wiggly curves. Figure 9.96 shows an example, adapted from the datasheet for the ADR4520-50 series of 3-terminal precision references.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0716.jpg?height=565&width=812&top_left_y=1243&top_left_x=1066)

Figure 9.96. Three ways of defining the temperature coefficient of a voltage reference, illustrated with the ADR4550's serpentine datasheet curve. The datasheet's specified tempco is stated as $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (max) over the full temperature range.

Some references include a "trim" terminal, which sounds like a great idea. But, as with op-amp offset trim configurations, it often provides too much trim range! You can try to remedy this by reconfiguring the trim network

1000 to 2000 hours. Better improvement than one gets from aging wine!
to supply less current. But a caution: some parts require that the external trim circuitry exhibit a specified temperature coefficient. Perhaps you're better off, as with op-amps, simply by choosing a reference with a tighter spec; a reference of better initial precision usually provides better tempco as well.

Self-heating Voltage references are happiest when they are only lightly loaded. If a reference IC is used to power a load, on-chip heating produces thermal gradients that can seriously degrade the part's accuracy and drift. For such applications it's best to buffer the output with an op-amp. Most good op-amps have lower noise and offset voltages than the voltage reference itself (you can do the calculation!), so it does not degrade the reference voltage. Quite the opposite, in fact, considering the degrading effect of substantial load current with an unbuffered reference that's the whole point. And even middle-of-the-road opamps have far lower tempcos of offset voltage than most voltage references (but use a precision op-amp for a precision reference, as we did in Figure 9.90).

An op-amp buffer also provides an ideal opportunity to add an $R C$ noise filter; see $\S 9.10 .6$, with its unusual filter configuration (Figure 9.95).

External influences As the footnote on the previous page suggests, you can seriously degrade a precision reference's accuracy by physically stressing the package; the stability is also compromised by the gradual infiltration of humidity through the plastic package. Sometimes you'll see improved specs for hermetically sealed package versions: the LT1236LS8 is packaged in hermetic LCC, and offers an improved drift specification relative to the plastic LT1236 version. And the most stable references are offered exclusively in hermetic metal packages to circumvent these problems: for example the LM399 (thermally stabilized buried zener reference) comes only in a TO-46 metal can; it specifies an excellent long-term drift specification of $8 \mathrm{ppm} / \sqrt{\mathrm{kHr}}$ (typ). Pretty good - but handily outdone by the LTZ1000 "Ultra Precision" shunt reference (also in a metal-hermetic package), with a spectacular $0.3 \mathrm{ppm} / \sqrt{\mathrm{kHr}}$ (typ)!

A recent contribution to the gallery of badnesses is the exposure of floating-gate references (§9.10.4) to ionizing radiation, most seriously in the form of airport luggage inspection x-ray machines or PCB post-assembly x-ray inspection. According to Intersil's Application Note, ${ }^{139}$ by

[^555]actual experiment at US airports the voltage shift for nine samples of a 5.0 V floating-gate reference (ISL21009) after six passes through carry-on x-ray machines averaged 25 ppm (negative); this is small compared with the initial accuracy of $\pm 100 \mathrm{ppm}$, but in the same ballpark as the specified long-term (1000 hour) drift and hysteresis specs (both $50 \mathrm{ppm}, \mathrm{typ}$ ).

Line and load regulation You've got to worry about regulation against input-voltage variations ("line regulation") for a voltage reference that is powered from unregulated dc, for example in a battery-powered application. For such use, a reference isn't suitable that boasts a worst-case tempco of $3 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, but whose output varies 200 ppm per volt of input change (these are the specs of an entry in Table 9.8), though that reference would be fine if powered from a reasonably regulated dc rail. For this reason we've listed the worst-case line regulation for the references in Table 9.8 - these vary over nearly a 1000:1 range!

Load regulation matters also if you are using the reference as a voltage regulator, i.e., to power a load that draws a few milliamps, perhaps with load-current variation. But we discourage such use of a precision reference, because it produces on-chip heating and drifts; for that reason (and lack of space) we've not listed load regulation specifications in the tables.

### 9.11 Commercial power-supply modules

Throughout the chapter we have described how to design your own regulated power supply, implicitly assuming that is the best thing to do. Only in the discussion of lineoperated switching power supplies did we suggest that the better part of valor is to swallow your pride and buy a commercial power supply. ${ }^{140}$

As the economic realities of life would have it, however, the best approach is often to use one of the many commercial power supplies sold by companies such as Artesyn, Astec, Astrodyne, Acopian, Ault, Condor, CUI, Elpac, Globtek, Lambda, Omron, Panasonic, Phihong, PowerOne, V-Infinity, and literally hundreds more. They offer

[^556]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0718.jpg?height=1317&width=1517&top_left_y=209&top_left_x=285)

Figure 9.97. Commercial power supplies come in a variety of shapes and sizes, including potted modules, open-frame units, and fully enclosed boxes. (Courtesy of Computer Products, Inc.)
both switching and linear supplies, and they come in several basic packages (Figure 9.97).
$\cdot$ "Board-mount" supplies: these are relatively small packages, no more than a few inches on a side, with stiff wire leads on the bottom so you can mount them directly on a circuit board. Both ac-dc supplies and dc-dc converters come in this style, and they may be of "potted" or open construction. You can get linear or switchers, and they come with single or multiple output voltages. A typical PC-mounting open-case ac-dc triple-output switching supply provides +5 V at 2 A and $\pm 12 \mathrm{~V}$ at 0.2 A and costs about $\$ 30$ in small quantities. Linear board-mount supplies fall in the 1 W to 10 W range, switchers in the

15 W to 50 W range. In the dc-dc category (which are always switching converters) you can get isolated or nonisolated converters. ${ }^{141}$ These are commonly used to generate additional needed voltages (e.g., $\pm 15 \mathrm{~V}$ from +5 V ), as we've seen in this chapter. But another important use is point-of-load (POL) conversion, for example to create +1.0 V at 75 A right at the chip's pins, to power a high-performance microprocessor. POL converters come

[^557]in regulated and unregulated versions, the latter with a fixed reduction ratio from a regulated dc input. ${ }^{142}$

- "Chassis-mount" supplies: these are larger power supplies, intended to be fastened to the inside of a larger instrument. They come in both "open frame" and "enclosed-case" styles; the former have all the components on display, whereas the latter (for example, the "ATX" power supplies you find in a desktop or server computer) are wrapped in a perforated metal box. They are available in an enormous variety of voltages, both single and multiple outputs. Chassis-mount linear supplies fall in the $10-200 \mathrm{~W}$ range, switchers in the $20-1500 \mathrm{~W}$ range.
- "External adapters": these are the familiar black "wallwart" and desktop ("desk-wart"?) that come with small consumer electronic gadgets, and which are widely available from dozens of manufacturers. They actually come in three varieties, namely (a) step-down ac transformer only, (b) unregulated dc supply, and (c) complete regulated dc supply; the latter can be either linear or switcher. Some of the switching units allow a full 95 to 252 Vac input range, useful for traveling instruments.
- "DIN-rail mount" supplies: a popular way of mounting some kinds of industrial electronics (relays, circuit breakers, surge protectors, connectors, terminal blocks, and the like) is the European-originated DIN rail, which consists of a length of formed metal rail, 35 mm in width. Rail mounting makes it easy to assemble electrical equipment in industrial settings, and you can get a variety of switching supplies in this style.


### 9.12 Energy storage: batteries and capacitors

No chapter dealing with regulators and power conversion would be complete without a discussion of portable power. That usually means batteries (replaceable or rechargeable),

[^558]sometimes assisted by energy-storage capacitors. Contemporary life is awash in portable electronic devices, which have driven the development and availability of improved batteries and capacitors. In this section we provide an introduction to battery choices and properties, and to the use of capacitors for energy storage. Because this chapter is already, well, huge, we defer further discussion of the care and feeding of batteries to Chapter $9 x$ in the advanced volume. ${ }^{143}$

As we remarked in the previous edition, the (now out-of-print) Duracell "Comprehensive Battery Guide" listed 133 off-the-shelf batteries, with descriptions like zinccarbon, alkaline manganese, lithium, mercury, silver, zincair, and nickel-cadmium. There are even subclasses, for example $\mathrm{Li} / \mathrm{FeS}_{2}, \mathrm{Li} / \mathrm{MnO}_{2}, \mathrm{Li} / \mathrm{SO}_{2}, \mathrm{Li} / \mathrm{SOCl}_{2}$, and "lithium solid state." And from other manufacturers you can get sealed lead-acid and gel-type batteries. For the truly exotic application you might even want to consider fuel cells or radioactive thermal generators. What are all these batteries? How do you choose what's best for your portable widget?

The foregoing list divides into so-called primary and secondary batteries. Primary batteries are designed for a single discharge cycle only, i.e., they're nonrechargeable. Secondary cells (lithium-ion, nickel metal-hydride, and sealed lead-acid gel-type), by comparison, are designed to be recharged, typically from 200 to 1000 times. You usually make your choice among battery types based on tradeoffs among price, energy density, shelf life, constancy of voltage during discharge, peak current capability, temperature range, and availability. Once you've picked the right battery chemistry, you figure out which battery (or series combination of batteries) has enough energy content for the job.

Fortunately, it's pretty easy to eliminate most of the batteries in the catalogs, if you follow our first suggestion: Avoid hard-to-get batteries. Besides being hard to find, they're usually not fresh. So it's usually better to stick with the varieties available at the drugstore, or perhaps photography store, even if it results in somewhat less than optimum design. We particularly recommend the use of commonly available batteries in the design of any consumer electronic device; as consumers ourselves, we shun those inexpensive marvels that use exotic and expensive batteries. (Remember those early smoke detectors that used an 11.2 V mercury battery? They're better forgotten...)

[^559]
### 9.12.1 Battery characteristics

If you want a primary (non-rechargeable) battery, your choices are essentially alkaline (" $\mathrm{Zn} / \mathrm{MnO}_{2}$ ") or one of the lithium chemistries (" $\mathrm{Li} / \mathrm{MnO}_{2}$," " $\mathrm{Li} / \mathrm{FeS}_{2}$," or " $\mathrm{Li} / \mathrm{SOCl}_{2}$ "). Lithium batteries have a higher single-cell terminal voltage ( $\sim 3 \mathrm{~V}$ ), higher energy density, flatter discharge curves (i.e., constancy of voltage as their life ebbs, see Figure 9.98), better performance at low temperatures (where alkaline batteries just fade away) and higher price. By contrast, the alkaline types (the basic grocery-store battery) are cheap and plentiful, and you can buy them inexpensively at "big-box" stores (if you don't mind getting them in packages of several dozen); they're fine for undemanding applications.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0720.jpg?height=787&width=736&top_left_y=836&top_left_x=252)

Figure 9.98. Battery discharge curves, as shown on the respective datasheets. In each case 100\% discharge corresponds to the voltages as listed in the notes to Table 9.9.

Your choices for a secondary (rechargeable) battery are lithium-ion ("Li-ion"), nickel metal-hydride ("NiMH"), or lead-acid ("Pb-acid"). Li-ion batteries are lightweight, and provide the highest energy density and charge retention, but there are safety issues with lithium chemistries, and these aren't the kind of thing you buy off-the-shelf; they are the darlings of the manufacturers of smartphones, tablets, and laptop computers. Nickel metal-hydride batteries are the more common "consumer" rechargeables, and they come in standard form factors (AA, 9V sizes); early formulations had discouraging memory effects and self-discharge rates ( $\sim 30 \% /$ month!), but recent versions
("LSD" - low self-discharge) are greatly improved. Leadacid batteries are the heavy lifters, with their very low internal resistance; they are dominant in uninterruptible power supplies (UPSs) and other power-hungry devices (like boats and automobiles!); they don't come in tiny packages, but you can get them in sizes as small as D-cells.

Recharging secondary batteries can be a complicated business, particularly for fussy chemistries like Li-ion. Taking first the example of the humble lead-acid battery, a good charging method is the so-called two-step technique: after a preliminary "trickle" charge, you begin with a high-current "bulk-charge" phase, applying a fixed high current $I_{\max }$ until the battery reaches the "overcharge voltage," $V_{\mathrm{OC}}$. You then hold the voltage constant at $V_{\mathrm{OC}}$, monitoring the (dropping) current until it reaches the "overcharge transition current," $I_{\mathrm{OCT}}$. You then hold a constant "float voltage," $V_{\mathrm{F}}$, which is less than $V_{\mathrm{OC}}$, across the battery. For a 12 V 2.5 Ah lead-acid battery, typical values are $I_{\max }=0.5 \mathrm{~A}, V_{\mathrm{OC}}=14.8 \mathrm{~V}, I_{\mathrm{OCT}}=0.05 \mathrm{~A}$, and $V_{\mathrm{F}}=14.0 \mathrm{~V}$.

Although this all sounds rather complicated, it results in rapid recharge of the battery without damage. TI makes some nice ICs, for example the UC3906 and BQ24450, that have just about everything you need to do the job. They include internal voltage references that track the temperature characteristics of lead-acid cells, and they require only an external $p n p$ pass transistor and four parameter-setting resistors.

Charging Li-ion batteries requires a bit more care, but once again the semiconductor industry has responded with easy-to-use single-chip solutions. Figure 9.99 shows an example of the kind of thing that is commonly seen. Here the power from a USB port ( +5 V nominal, able to supply 100 mA or 500 mA ) is used to charge a single-cell 4.2 V Li-ion battery; the latter's output (which is down to $\sim 3.5 \mathrm{~V}$ when mostly discharged) is reduced to a stable +3.3 V logic-supply level with a linear LDO regulator. In this circuit the charger IC $\left(U_{1}\right)$ takes care of the charging current and voltage profiles, and it includes safety features to sense over-voltage, short-circuit, and both chip and battery over-temperature (the latter uses the optional thermistor, which is found in many battery packs, or can be added externally). The cell temperature is also used to adjust the charging current or voltage when the temperature is outside the normal $10-45^{\circ} \mathrm{C}$ range, according to what's called JEITA standards. The ISET2 pin sets the input current limit as indicated; the USB protocol allows 100 mA drain initially, which can be increased to 500 mA by a negotiation through the USB data pins D- and D+ (this requires a microcontroller or other smart chip, not shown here). The LEDs indicate status (charging, input power good). The
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0721.jpg?height=547&width=1308&top_left_y=209&top_left_x=295)

Figure 9.99. The +5 V provided by a USB port is ideal for charging a single-cell Li-ion battery; LDO regulator $U_{2}$ converts the battery's $3.5-4.2 \mathrm{~V}$ output to stable +3.3 V . See text for discussion of what to do with the USB's $\mathrm{D}+$ and $\mathrm{D}-$ pins.
care and feeding of Li-ion batteries is discussed in more detail in §9x.2.

### 9.12.2 Choosing a battery

Table 9.9 lists characteristics of most of the batteries you might consider, and Figure 9.100 shows an assortment of common battery types. Here is a capsule summary of the most distinguishing characteristics of available batteries intended for use in electronic devices.

#### Primary Batteries (non-rechargeable)

Alkaline ( $\mathbf{Z n} / \mathbf{M n O} \mathbf{2}_{2}$ ) Inexpensive; widely available (1.5V/cell AA, C, \& D, and 9V pkgs); excellent shelf life; good low-temperature performance; sloping discharge.
Lithium ( $\left.\mathbf{L i} / \mathbf{M n O}_{2}\right)$ High energy-density; good highdrain performance; $3 \mathrm{~V} \mathrm{AA}, \mathrm{C}, \& \mathrm{D}$, and 9V pkgs; excellent shelf life; excellent low-temperature performance; flat discharge.
Lithium ( $\mathbf{L i} / \mathbf{F e} \mathbf{S}_{2}$ ) Extraordinary shelf life ( $90 \%$ after 15 yrs ); excellent low-temperature performance; flat discharge.
Lithium ( $\mathbf{L i S O C l}{ }_{2}$ ) Extraordinary low-temperature performance (to $-55^{\circ} \mathrm{C}$ ); excellent shelf life; very flat discharge (but varies with $I_{\text {load }}$ ).
Silver ( $\mathbf{Z n} / \mathbf{A g}_{2} \mathbf{O}$ ) Button cells; very flat discharge.
Zinc-air $\left(\mathbf{Z n O}_{2}\right)$ High energy-density (it breathes); flat discharge; short life after seal is removed.

#### Secondary Batteries (rechargeable)

Lithium-ion (Li-ion) High energy-density; popular; 3.6V/cell; flat discharge; very low self-discharge; safety issues.
Nickel metal-hydride (NiMH) Inexpensive \& popular;
standard packages (AA, 9V); 1.2V/cell; flat discharge; recent formulations have low self-discharge.
Lead-acid (Pb-acid) High current (low $R_{\text {int }}$ ); 2V/cell; flat discharge; moderate self-discharge.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0721.jpg?height=603&width=835&top_left_y=1137&top_left_x=955)

Figure 9.100. A collection of battery specimens. The Li-ion and Pb -acid types are rechargeable ("secondary"); the rest are nonrechargeable ("primary"). Those with unlabeled chemistry are alkaline. Some can opener activity revealed the 9 V innards - six itty-bitty alkaline cells.

### 9.12.3 Energy storage in capacitors

Batteries store energy chemically, either with reversible reactions (rechargeable batteries) or irreversible reactions (non-rechargeable). But batteries aren't the only way to store electrical energy: a charged capacitor stores $C V^{2} / 2$ joules in its electric field, and a current-carrying inductor

Table 9.9 Battery Choices ${ }^{a}$

| Chemistry | Part \# | $V_{\text {nom }}$ <br> (V) | Discharge Capacity |  |  |  | Size <br> (mm) | Weight (gm) | Comments |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  |  |  | (mAh) | at mA | (mAh) | at mA |  |  |  |
| Primary (non-rechargeable) |  |  |  |  |  |  |  |  |  |
| 9V "1604" |  |  |  |  |  |  |  |  |  |
| carbon-zinc | 122 | 9 | $320^{\text {b }}$ | 5 | $150^{\text {b }}$ | 25 | $17.5 \times 12.9 \times 46$ | 37 |  |
| alkaline $\mathrm{MnO}_{2}$ | MN1604 | 9 | $550^{\text {b }}$ | 10 | $320^{\text {b }}$ | 100 | $17.5 \times 12.9 \times 46$ | 45 | popular |
| lithium $\mathrm{MnO}_{2}$ | DL1604 | 9 | $1200^{\text {b }}$ | 20 | $850^{\text {b }}$ | 100 | $17.5 \times 12.9 \times 46$ | 34 |  |
| zinc-air | 146X | 8.4 | $1300^{\text {b }}$ | 10 | - | - | $17.5 \times 12.9 \times 46$ | 34 | pull tab \& it breathes! |
| cylindrical |  |  |  |  |  |  |  |  |  |
| D alkaline | MN1300 | 1.5 | $11500^{f}$ | 250 | $3700^{f}$ | 1000 | 34D x 61L | 139 | D size |
| D LiMnO2 | U10013 | 3 | $11100^{\text {C }}$ | 250 | $10400^{\text {C }}$ | 2000 | 34D x 61L | 115 | D size |
| C alkaline | MN1400 | 1.5 | $5100^{f}$ | 250 | $1300^{f}$ | 1000 | 26D x 50L | 69 | C size |
| AA alkaline | MN1500 | 1.5 | $2800^{f}$ | 10 | $2400^{f}$ | 100 | 14.5D x 50.5L | 24 | AA size; popular |
| AA LiFeS2 | L91 | 1.5 | $3200^{f}$ | 25 | $3000^{f}$ | 500 | 14.5D x 50.5L | 15 | $90 \%$ after $15 y$ at $20^{\circ} \mathrm{C}$ |
| AA LiSOCl2 | ER14505 | 3.6 | $2100^{\text {C }}$ | 1 | $1600^{\text {C }}$ | 16 | 14.5D x 50.5L | 18 | very flat discharge |
| AAA alkaline | MN2400 | 1.5 | $1200^{f}$ | 10 | $1000^{f}$ | 100 | 10D x 44L | 11 | AAA size |
| CR2 $\mathrm{LiMnO}_{2}$ | CR2 | 3 | $850^{\text {C }}$ | 20 | - | - | 15.5D x 27L | 11 | popular |
| 2/3A LiMnO2 | CR123A | 3 | $1550^{\text {C }}$ | 20 | - | - | 17D × 34.2L | 17 | popular |
| 2/3A Li poly | BR-2/3A | 3 | $1200^{\text {C }}$ | 2.5 | - | - | 17D x 33.5L | 13.5 |  |
| button |  |  |  |  |  |  |  |  |  |
| silver | 357 | 1.55 | $195^{\text {d }}$ | 0.2 | - | - | 11.5D x 4.8H | 2.3 |  |
| zinc-air | 675 | 1.45 | $600^{\text {e }}$ | 2 | - | - | $11.6 \mathrm{D} \times 5.4 \mathrm{H}$ | 1.9 | 4yrs unactivated |
| $\mathrm{LiMnO}_{2}$ | CR2032 | 3 | $225^{\text {C }}$ | 0.2 | $175^{\text {C }}$ | 2 | $20 \mathrm{D} \times 3.2 \mathrm{H}$ | 2.9 | 2032 size; popular |
| Li poly | BR2032 | 3 | $190^{\text {C }}$ | 0.2 | $90^{\text {C }}$ | 2 | $20 \mathrm{D} \times 3.2 \mathrm{H}$ | 2.5 | 2032 size |
| Secondary (rechargeable) |  |  |  |  |  |  |  |  |  |
| cylindrical |  |  |  |  |  |  |  |  |  |
| NiMH HHR | 210AA/B | 1.2 | $2000^{f}$ | 2000 | - | - | 14.5D x 50.5L | 29 | AA size; $R_{\mathrm{S}}=25 \mathrm{~m} \Omega ; 80 \% / 6 \mathrm{mo}$ |
| Li-ion NC | NCR18650 | 3.6 | $2900^{\text {h }}$ | 500 | $2500^{\text {h }}$ | 5000 | 18D x 65.2L | 45 | popular |
| Pb-acid 08 | 810-0004 | 2 | 25009 | 250 | $1900{ }^{9}$ | 2000 | 34D x 61L | 178 | D size; $R_{\mathrm{S}}=5 \mathrm{~m} \Omega$ |
| button |  |  |  |  |  |  |  |  |  |
| LiMn | ML2020 | 3 | $45^{\text {C }}$ | 0.12 | $40^{C}$ | 1 | 20D x 2.0H | 2.2 | memory backup |
| LiMnTi | MT621 | 1.5 | $2.5^{f}$ | 0.05 | - | - | 6.8D × 2.1H | 0.25 | memory backup |
| LiNb | NBL414 | 2 | $1^{\text {f }}$ | 0.004 | 4 | - | 4.8D × 1.5H | 0.08 | memory backup |
| $\mathrm{LiV}_{2} \mathrm{O}_{5}$ | VL3032 | 3 | $100^{\text {C }}$ | 0.2 | $95^{\text {C }}$ | 1 | 30D × 3.2H | 6.2 | memory backup |
| rectangular |  |  |  |  |  |  |  |  |  |
| Pb -acid | LC-R061 | 6 | $1200^{k}$ | 100 | $800^{k}$ | 1000 | $96 \times 24 \times 50$ | 300 | $80 \%$ after $6 \mathrm{mo} ; R_{\mathrm{S}}=50 \mathrm{~m} \Omega$ |
| Pb -acid | LC-R127 | 12 | 7200m | 500 | $5000^{\text {m }}$ | 5000 | $151 \times 65 \times 94$ | 2470 | $80 \%$ after $6 \mathrm{mo} ; R_{\mathrm{S}}=40 \mathrm{~m} \Omega$ |

Notes: (a) listed part numbers are representative (there are many manufacturers). (b) to 6V. [c] to 2V. (d) to 1.2 V . (e) to 1.1V. (f) to 1.0V. (g) to 1.7V. (h) to 2.5V. (k) to 4.8V. (m) to 9.6V. (n) also Tadiran TL-2100.
stores $L I^{2} / 2$ joules in its magnetic field. In quantitative terms these stored energies are dwarfed by those stored in batteries; but for some applications capacitors are just what you want. Among their other virtues, they have long lives, infinite endurance (charge/discharge cycles), the ability to be fully charged and discharged in seconds (or fractions of a second), and very high peak current capability (i.e., very low internal resistance, ESR). A storage capacitor, teamed with a conventional battery, can provide the best of both worlds: extraordinary peak power along
with substantial energy storage. Furthermore, the energy density of recent "supercapacitors" is creeping up on the tail end of batteries. These points are seen nicely in a Ragone plot (Figure 9.101). To put numbers on it, we've collected data on some real-world representative capacitors and batteries; these are listed in Table 9.10. Capacitors excel in low ESR and high peak current (and therefore in high power density: $\mathrm{W} / \mathrm{gm}$ or $\mathrm{W} / \mathrm{m}^{3}$ ), but batteries beat the pants off capacitors in energy density (Wh/gm or $\mathrm{Wh} / \mathrm{m}^{3}$ ).

Table 9.10 Energy Storage: Capacitor versus Batterya

| Parameter | Conditions | Ultracap <br> Maxwell K2 <br> 3000F, 2.5V | Aluminum Electrolytic <br> Panasonic T-UP 180,000 F, 25V | Lead-acid gel Yuasa NP7-12 12V, 7Ah | Lithium-ion Saft VL34570 3.7V, 5.4Ah | Alkaline ${ }^{p}$ <br> Duracell MN1500 <br> AA: 1.5V, 2Ah |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| generic ${ }^{\text {a }}$ |  |  |  |  |  |  |
| Wh/kg | 1hr discharge | 6 | 0.05 | 16 | 150 | 40 |
| $\mathrm{Wh} / \mathrm{m}^{3}$ | 1hr discharge | 7800 | 73 | 44000 | 360000 | 120000 |
| W/kg | maximum | 1000 | 1400 | 170 | 500 | 65 |
| kW/m ${ }^{3}$ | maximum | 1300 | 2000 | 500 | 1100 | 180 |
| charge time | fast charge | 30s | 0.25 s | 1 hr | 1 hr | - |
| charge cycles |  | $10^{6}$ | (note b) | 500 | 500 | 0 |
| self discharge | $25^{\circ} \mathrm{C}$ | $7 \times 10^{5} \mathrm{hr}$ | 0.2 hr | $10^{4} \mathrm{hr}$ | $10^{5} \mathrm{hr}{ }^{\mathrm{e}}$ | $10^{5} \mathrm{hr}$ |
| life | float, $25^{\circ} \mathrm{C}$ | 10yr | 25yr | $5 y r$ | ? | 10yr |
| specific to exemplar |  |  |  |  |  |  |
| ESR | maximum | $0.29 \mathrm{~m} \Omega$ | $9 \mathrm{~m} \Omega$ | $25 \mathrm{~m} \Omega$ | $30 \mathrm{~m} \mathrm{~s}^{\mathrm{e}}$ | $120 \mathrm{~m} \Omega$ |
| $I_{\text {max }}$ | cont | 210A | 17A | 40A | 11A | 1A |
| $P_{\text {max }}$ | cont | 525W | 425W | 440W | 35W | 1.2W |
| weight |  | 510 g | 300g | 2650g | 125g | 24g |
| energy (Wh) | 1hr discharge | 3.0 | 0.015 | 45 | 18.9 | 1 |
| volume (cm ${ }^{3}$ ) | with terminals | 390 | 206 | 950 | 53 | 8.4 |

(a) from mfgrs' datasheets for listed parts. (b) no wearout, limited by lifetime only. (e) estimated. (p) primary cell (non-rechargeable).
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0723.jpg?height=529&width=782&top_left_y=1139&top_left_x=137)

Figure 9.101. Energy-storage capacitors excel in delivering peak power, but batteries win out in energy storage, as seen in this "Ragone plot."

### 9.13 Additional topics in power regulation

### 9.13.1 Overvoltage crowbars

As we remarked in §9.1.1C, it is often a good idea to include some sort of overvoltage protection at the output of a regulated supply. Take, for instance, a +3.3 V high-current switching supply used to power a large digital system. Failure of a component in the regulation circuit (even something as simple as a resistor in the output voltage sensing
divider) can cause the output voltage to soar, with devastating results.

Although a fuse probably will blow, what's involved is a race between the fuse and the "silicon fuse" that is constituted by the rest of the circuit; the rest of the circuit will probably respond first! This problem is most serious with low-voltage logic and VLSI, which operate from dc supply voltages as low as +1.0 V , and cannot tolerate an overvoltage of as much as 1 V without damage. ${ }^{144}$ Another situation with considerable disaster potential arises when you operate something from a wide-range "bench" supply, where the unregulated input to the linear regulator may be 40 volts or more, regardless of the output voltage. We've encountered some aberrant bench supplies that soar to their full output voltage, briefly, when you switch them off. But "briefly" is all it takes to ruin your whole day!

#### A. Zener sensing

Figure 9.102 shows three classic crowbar circuits - (A) is simple and robust, but inflexible; (B) uses an IC trigger circuit that lets you set the trigger point more accurately; and

[^560]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0724.jpg?height=1243&width=802&top_left_y=187&top_left_x=221)

Figure 9.102. Overvoltage crowbars.
(C) uses a popular and precise 3-terminal "shunt regulator," with $1 \%$ setpoint accuracy.

In each case you hook the circuit between the regulated output terminal and ground; no additional dc supply is needed - the circuits are "powered" by the dc line they protect. For the simple circuit (Figure 9.102A) the SCR is turned on if the dc voltage exceeds the zener voltage plus a diode drop (about 6.2 V for the zener shown), and it remains in a conducting state until its anode current drops below a few milliamps. An inexpensive SCR like the S2010L can sink 10 amps continuously and withstand 100 amp surge currents; its voltage drop in the conducting state is typically 1.1 V at 10 A . The particular unit here is electrically isolated, so you can attach it directly to the metal chassis (SCRs usually connect their anode to the attachment tab, so normally you'd have to use an insulating spacer, etc.). The $68 \Omega$ resistor is provided to generate a reasonable zener current $(10 \mathrm{~mA})$ at SCR turn-on, and the
capacitor is added to prevent crowbar triggering on harmless short spikes.

There are several problems with this simple crowbar circuit, mostly involving the choice of zener voltage. Zeners are available in discrete values only, with generally poor tolerances and (often) soft knees in the VI characteristic. The desired crowbar trigger voltage may involve rather tight tolerances. Consider a 5V supply for digital logic, whose typical $5 \%$ or $10 \%$ tolerance demands a crowbar voltage at least 5.5 V . But that minimum is raised because of transient overshoot of the regulated supply: the voltage can jump when there's an abrupt load current change, creating a spike followed by some ringing.

This problem is exacerbated by remote sensing via long (inductive) sense leads. The resultant ringing puts glitches on the supply that we don't want to trigger the crowbar. The result is that the crowbar voltage should be set not less than about 6.0 V , but it cannot exceed 7.0 V without risk of damage to the logic circuits. When you fold in zener tolerance, the discrete voltages actually available, and SCR trigger voltage tolerances, you've got a tricky problem. In the example shown earlier, the crowbar threshold could lie between 5.9 and 6.6 V , even using the relatively precise $5 \%$ zener indicated.

#### B. IC overvoltage sensing

The second circuit (Figure 9.102B) addresses these problems ${ }^{145}$ by using a crowbar trigger IC, in this case the venerable MC3423, which has internal voltage reference ( $2.6 \mathrm{~V} \pm 6 \%$ ), comparators, and SCR drivers. Here we've set the external divider $R_{1} R_{2}$ to trigger at 6.0 V , and we've chosen a 25 A (continuous) SCR, also with an isolated mounting tab; it costs about a dollar. The MC3423 belongs to the family of so-called power-supply supervisory chips; the most sophisticated of these not only sense undervoltage and overvoltage, but can switch over to battery backup when ac power fails, generate a power-on reset signal on return of normal power, and continually check for lockup conditions in microprocessor circuitry.

The third circuit (Figure 9.102C) dispenses with a supervisor IC, using instead the wildly popular ${ }^{146}$ TL431 shunt regulator to trigger a triac (a bidirectional SCR) when the voltage presented to the reference input exceeds the internal reference voltage of $2.495 \mathrm{~V} \pm 1 \%$; that causes heavy

[^561]conduction from cathode $(\mathrm{K})$ to ground, triggering the triac in what's known as "third quadrant" operation. ${ }^{147}$ This circuit can be flexibly extended to higher supply voltages (the TL431 operates to 37 V ); and, with the low-voltage TLV431 variant (whose internal reference is 1.240 V ) to very low trigger voltages.

The preceding circuits, like all crowbars, put an unrelenting 1 V "short circuit" across the supply when triggered by an overvoltage condition, and it can be reset only by turning off the supply. Because the SCR maintains a low voltage while conducting, there isn't much problem with the crowbar itself failing from overheating. As a result, these are reliable crowbar circuits. It is essential that the regulated supply have some sort of current limiting, or at least fusing, to handle the short. There may be overheating problems with the supply after the crowbar fires. In particular, if the supply includes internal current limiting, the fuse won't blow, and the supply will sit in the "crowbarred" state with the output at low voltage, until someone notices. Foldback current limiting of the regulated supply would be a good solution here.

#### C. Clamps

Another possible solution to overvoltage protection is to put a power zener, or its equivalent, across the supply terminals. This avoids the problems of false triggering on spikes, because the zener will stop drawing current when the overvoltage condition disappears (unlike an SCR or triac, which have the memory of an elephant). However, a crowbar consisting of a simple power zener itself has its own problems. If the regulator fails, the crowbar has to contend with high power dissipation $\left(V_{\text {zener }} I_{\text {limit }}\right)$ and may itself fail. We witnessed just such a failure in a commercial 15 V 4A magnetic disk supply. When the pass transistor failed, the 16 V 50 W power zener found itself dissipating more than rated power, and it proceeded to fail too.

A better alternative, if you really want a power zener, is an "active zener" constructed from a small zener and a power transistor. Figure 9.103 shows two such circuits, in which a zener pulls the base or gate of a transistor into conduction, with a pull-down resistor to bring the zener current into the knee region at transistor turn-on. The TIP142 (in Figure 9.103A) is a popular Darlington bipolar power transistor, priced around \$1, good for 75 W

[^562]dissipation at $75^{\circ} \mathrm{C}$ case temperature, and with a minimum beta of 1000 at 5 A . For higher voltage and current, and where effective zener voltage accuracy is not critical, the MOSFET circuit (Figure 9.103B) is better: most MOSFETs do not have the second-breakdown-limited safe-operating areas of BJTs, and they are widely available in robust high-power versions. The circuit shown permits 130 W or 300 W dissipation at $75^{\circ} \mathrm{C}$ case temperature, for the IRF1407 or IRFP2907, respectively. These are "automotive" MOSFETs, rated at 75 V , and priced at $\$ 2.50$ and $\$ 10$, respectively. Note particularly the high peak current rating, limited only by transient thermal resistance (discussed in Chapter 9x). One caution: a MOSFET clamp is prone to oscillation, particularly when implemented with a high-voltage (low-capacitance) part.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0725.jpg?height=458&width=819&top_left_y=850&top_left_x=968)

Figure 9.103. Active power zener.

#### D. Low-voltage clamp-crowbar

These techniques - zener crowbars, IC crowbars, and zener clamps - are generally inadequate for the low-voltage, high-current supplies used to power contemporary microprocessor systems; these may require +3.3 V (or lower) at $50-100$ A: low-voltage zeners are imprecise and suffer from a soft knee, and crowbar trigger circuits like the MC3423 require too high a supply voltage (e.g., 4.5 V minimum for the 3423). Also, when an SCR triggers, it crowbars the supply until the power is cycled - not a good thing to do to a computer, particularly if the cause was a momentary (and harmless) transient.

We've wrestled with this problem, and, following the teachings of Billings, ${ }^{148}$ have come up with a nice circuit for a low-voltage clamp-crowbar: it is adjustable, and it will operate down to 1.2 V . And (best of all) it operates in two steps - it clamps the transient, up to a peak current of 5-10 A; but if the transient persists, or rises above that current, it throws in the towel and fires a crowbar SCR that

[^563]can handle 70 A continuous ( 1000 A peak). Because you may be dealing with a high-power system, it also has provision to switch off the ac input. That sure is a belt-andsuspenders solution! Because this is a bit off the beaten path, we've grouped this material with other advanced topics in Chapter 9x.

### 9.13.2 Extending input-voltage range

As mentioned in §§9.3.12 and 3.6.2, linear regulators have a limited range of input voltage, typically +20 V to +30 V for BJT types, or as little as +5.5 V for CMOS types. Figure 9.104 (a completion of the block diagram in Figure 3.114) shows a nice way to extend the permissible range of $V_{\mathrm{IN}}$, to as much as 1000 V . $Q_{1}$ is a high-voltage depletion-mode MOSFET (see Table 3.6), here configured as an input follower to hold $U_{1}$ 's $V_{\text {IN }}$ a few volts above its regulated output. For the parts shown, $V_{\mathrm{GS}}$ is at least -1.5 V , a comfortable margin for any LDO; ${ }^{149}$ and their rated maximum $V_{\mathrm{DS}}$ of 400 V and 500 V provides plenty of input-voltage flexibility (substitute an IXTP08N100 if you want to go to 1 kV ).

A few details. (a) In this circuit we've used a small gate resistor to suppress the oscillation tendency of high voltage MOSFETs. (b) The source resistor $R_{\mathrm{S}}$ sets an output current limit of approximately $V_{\mathrm{GS}} / R_{\mathrm{S}}$, which is essential here because this regulator by itself is capable of output currents to 350 mA , which would cause more than 150 W dissipation in $Q_{1}$ for $V_{\text {IN }}=500 \mathrm{~V}$. Here we've chosen $R_{\mathrm{S}}$ for $I_{\lim } \sim 10 \mathrm{~mA}$, thus 3.5 W maximum dissipation, handled easily with a modest heatsink attached to $Q_{1}$ in its TO-220 power package. (c) A power resistor could be added in $Q_{1}$ 's drain, to offload some of its power dissipation. (d) Lowdropout regulators specify (and require!) a minimum output capacitor $C_{\text {out }}$ for stability (along with a specification of allowable range of its effective series resistance ESR); the value shown meets the specification for the TPS76301. (e) Some alternative choices for a fixed-voltage ( +3.3 V ; omit $R_{1}$ and $R_{2}$ ) low-power LDO are listed, with a few relevant parameters. All but the LM2936 are available also in adjustable versions, set with a resistive divider as we've done with the TPS76301 (but refer to their datasheets for $V_{\text {ref }}$ and divider resistances).

[^564]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0726.jpg?height=968&width=812&top_left_y=220&top_left_x=1061)

Figure 9.104. Extending LDO input-voltage range. The listing includes some other low-power 3.3V fixed-voltage LDO choices.

### 9.13.3 Foldback current limiting

In $\S 9.1$ we showed the basic current-limit circuit, which is often adequate to prevent damage to the regulator or load during a fault condition. However, for a regulator with simple current limiting, transistor dissipation is maximum when the output is shorted to ground (either accidentally or through some circuit malfunction), and it exceeds the maximum value of dissipation that would otherwise occur under normal load conditions. Look, for instance, at the regulator circuit of Figure 9.105, designed to deliver +15 V at currents up to 1 A . If it were equipped with simple current limiting, the pass transistor would dissipate up to 25 watts with the output shorted ( +25 V input, current limit at 1 A ), whereas the worst-case dissipation under normal load conditions is 10 watts ( 10 V drop at 1 A$)$. And the situation is even worse in circuits in which the voltage normally dropped by the pass transistor is a smaller fraction of the output voltage.

You get into a similar problem with push-pull power amplifiers. Under normal conditions you have maximum load current when the voltage across the transistors is minimum (near the extremes of output swing), and you have
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0727.jpg?height=570&width=753&top_left_y=220&top_left_x=144)

Figure 9.105. Linear regulator with foldback current limiting.
maximum voltage across the transistors when the current is nearly zero (zero output voltage). With a short-circuit load, on the other hand, you have maximum load current at the worst possible time, namely, with full supply voltage across the transistor. This results in much higher transistor dissipation than normal.

The brute-force solution to this problem is to use massive heatsinks and transistors of higher power ratings (and safe-operating area; see §9.4.2) than necessary. Even so, it isn't a good idea to have large currents flowing into the powered circuit under fault conditions, because other components in the circuit may then be damaged. A better solution is to use foldback current limiting, a circuit technique that reduces the output current under short-circuit or overload conditions.

Look again at Figure 9.105. The divider at the base of the current-limiting transistor $Q_{2}$ provides the foldback. At +15 V output (the normal value) the circuit will limit at about 1 A , because $Q_{2}$ 's base is then at +15.55 V while its emitter is at +15 ( $V_{\mathrm{BE}}$ is typically somewhat below the usual 0.6 V in the hot environment of power electronics). But the short-circuit current is less; with the output shorted to ground, the output current is about 0.3 A , holding $Q_{1}$ 's dissipation down to less (about 7.5 W ) than in the full-load case ( 10 W ). This is highly desirable, since excessive heatsinking is not now required, and the thermal design need only satisfy the full-load requirements. The choice of the three resistors in the current-limiting circuit sets the short-circuit current, for a given full-load current limit; see Figure 9.106.

An important caution: use care in choosing the shortcircuit current, because it is possible to be overzealous and design a supply that will not "start up" into certain loads. Figure 9.107 shows the situation with two com-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0727.jpg?height=598&width=799&top_left_y=219&top_left_x=973)

Figure 9.106. Foldback current limiting for the circuit of Figure 9.105.
mon nonlinear loads: an incandescent lamp (whose resistance rises with voltage), and a linear regulator's input (which begins as an open circuit, then looks like its load resistance while operating below dropout, and finally forms a constant-current load above dropout). As a rough guide, when designing a foldback circuit, the short-circuit current limit should be set no less than onethird to one-half the maximum load current at full output voltage.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0727.jpg?height=547&width=771&top_left_y=1423&top_left_x=987)

Figure 9.107. Excessive foldback may prevent startup into some loads. We measured VI curves for an automotive lamp ( 12 V , 21 W ) and for a 5 V low-dropout regulator with $3.3 \Omega$ load. The dashed line is normal 2 A current limiting, and the dotted lines show three values of foldback current limiting. A foldback current ratio of $r=$ $I_{\max } / I_{\mathrm{SC}}=6$ would fail to start up either load (it would get stuck at the lower intersection); for $r=2$ the lamp is OK, but the LDO is not. A resistive load is never a problem.

### 9.13.4 Outboard pass transistor

Three-terminal linear regulators are available with 5 A or more of output current, for example the adjustable 10 A LM396. However, such high-current operation may be undesirable, because the maximum chip operating temperature for these regulators is lower than for power transistors, mandating oversized heatsinks. Also, they are expensive. An alternative solution is the use of external pass transistors, which can be added to integrated linear regulators like the 3 -terminal fixed or adjustable regulators, whether of conventional or low-dropout configuration. Figure 9.108 shows the basic (but flawed!) circuit.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0728.jpg?height=305&width=746&top_left_y=771&top_left_x=239)

Figure 9.108. Basic three-terminal regulator with current-boosting outboard transistor. Don't build this - it has no current-limiting circuitry!

The circuit works normally for load currents less than 100 mA . For greater load currents, the drop across $R_{1}$ turns on $Q_{1}$, limiting the actual current through the 3-terminal regulator to about 100 mA . The 3-terminal regulator maintains the output at the correct voltage, as usual, by reducing input current and hence drive to $Q_{1}$ if the output voltage rises, and vice versa. It never even realizes the load is drawing more than 100 mA ! With this circuit the input voltage must exceed the output voltage by the dropout voltage of the regulator (e.g., 2 V for an LM317) plus a $V_{\mathrm{BE}}$ drop.

In practice, the circuit must be modified to provide current limiting for $Q_{1}$, which could otherwise supply an output current equal to $\beta$ times the regulator's internal current limit, i.e., 20 amps or more! That's enough to destroy $Q_{1}$, as well as the unfortunate load that happens to be connected at the time. Figure 9.109 shows two methods of current limiting.

In both circuits, $Q_{1}$ is the high-current pass transistor, and its emitter-to-base resistor $R_{1}$ has been chosen to turn it on at about 100 mA load current. In the first circuit, $Q_{2}$ senses the load current via the drop across $R_{\mathrm{SC}}$, cutting off $Q_{1}$ 's drive when the drop exceeds a diode drop. There are a couple of drawbacks to this circuit: for load currents near the current limit, the input voltage must now exceed the regulated output voltage by the dropout voltage of the 3-
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0728.jpg?height=756&width=743&top_left_y=206&top_left_x=1098)

Figure 9.109. Outboard transistor booster with current limiting.
terminal regulator plus two diode drops. Also, the small resistor values required in $Q_{2}$ 's base makes it difficult to add foldback limiting.

The second circuit helps solve these problems, at the expense of some additional complexity. With high-current linear regulators, a low-dropout voltage is often important to reduce power dissipation to acceptable levels. To add foldback limiting to the latter circuit, just tie $Q_{3}$ 's base to a divider from $Q_{1}$ 's collector to ground, rather than directly to $Q_{1}$ 's collector. Note that in either circuit $Q_{2}$ must be capable of handling the full current limit of the regulator.

A caution: With an external pass transistor you do not get the overtemperature protection that is included in nearly all integrated regulators. So you have to be careful to provide adequate heatsinking for both normal and shortcircuit load conditions.

### 9.13.5 High-voltage regulators

Some special problems arise when you design linear regulators to deliver high voltages, and you often need to resort to some clever circuit trickery. This section presents a few such techniques.

#### A. Brute force: high-voltage components

Power transistors, both bipolar and MOSFET, are available with breakdown voltages to 1200 volts and higher, and they're not even very expensive. And IGBTs are available at even higher voltage ratings, up to 6000 volts.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0729.jpg?height=802&width=1410&top_left_y=216&top_left_x=244)

Figure 9.110. High-voltage regulated supply. The current-source pullup on $Q_{1}$ 's drain is a preferable alternative to the simpler resistive drain load; see §9.3.14C. See also Figure 3.111.

ON Semiconductor's MJE18004, for example, is a 5 A npn power transistor with conventional ( $V_{\text {CEO }}$ ) collector-toemitter breakdown of 450 V , and base back-biased breakdown ( $V_{\text {CEX }}$ ) of 1000 volts; it costs less than a dollar in single quantities. And power MOSFETs are often excellent choices for high-voltage regulators owing to their excellent safe operating area (absence of thermally induced second breakdown); they are widely available with 8001200 V ratings, and currents up to 8 A or more. For example, the FQP9N90 n-channel MOSFET ( $9 \mathrm{~A}, 900 \mathrm{~V}$ ) from Fairchild costs about $\$ 1.75$. See listings in Tables 3.4b and 3.5 .

By running the error amplifier near ground (the output-voltage-sensing divider gives a low-voltage sample of the output), you can build a high-voltage regulator with only the pass transistor and its driver seeing high voltage. Figure 9.110 shows the idea, in this case a +5 V to +750 V regulated supply using an NMOS pass transistor and driver. $Q_{2}$ is the series pass transistor, driven by inverting amplifier $Q_{1}$. The op-amp serves as error amplifier, comparing a fraction of the output with a precision +5 V reference. $Q_{3}$ provides current limiting by shutting off drive to $Q_{2}$ when the drop across the $27 \Omega$ resistor equals a $V_{\mathrm{BE}}$ drop. The remaining components serve more subtle, but necessary, functions: the zener diode protects $Q_{2}$ from reverse gate breakdown if $Q_{1}$ decides to pull its drain down rapidly (while the output capacitor holds up $Q_{2}$ 's source); it also
protects against forward gate breakdown, for example if the output is abruptly shorted. The Schottky diode likewise protects the op-amp's input from a negative current spike, coupled through the 10 pF capacitor.

Note the use of several resistors in series, to withstand the large voltages; the OY-series of 1 W and 2 W ceramic composition resistors from Ohmite are non-inductive, as are the precision metal-film resistors in the output sensing divider. The various small capacitors in the circuit provide compensation, which is needed because $Q_{1}$ is operated as an inverting amplifier with voltage gain, thus making the op-amp loop unstable (especially considering the circuit's capacitive load). Likewise, the $330 \Omega$ series output resistor promotes stability by decoupling capacitive loads (at the cost of degraded regulation). And $Q_{2}$ 's series gate resistor and source-lead ferrite bead suppress oscillations, to which high-voltage MOSFETs are particularly prone. An important caution: Power-supply circuits like this present a real electrical shock hazard - use care!

We can't resist an aside here: in slightly modified form (reference replaced by signal input) this circuit makes a very nice high-voltage amplifier, useful for driving crazy loads such as piezoelectric transducers; see Figure 3.111 for a simple 1 kV amplifier configured this way. For that particular application the circuit must be able both to sink and to source current into the capacitive load. Oddly enough, the circuit (called a "totem pole") acts like a
"pseudo-push-pull" output, with $Q_{2}$ sourcing current and $Q_{1}$ sinking current (via the diode), as needed. See $\S 3 x .8$ for a detailed discussion about capacitive loading of MOSFET source-followers.

If a high-voltage regulator is designed to provide a fixed output only, you can use a pass transistor whose breakdown voltage is less than the output voltage. For example, you could modify this circuit to produce a fixed +500 V output, using a 400 V transistor for $Q_{2}$. But with such a circuit you must ensure that the voltage across the regulator never exceeds its ratings, even during turn-on, turn-off, and output short-circuit conditions. A few strategically placed zeners can do the job, but be sure to think about unusual fault conditions such as an abrupt upstream short-circuit (a spark, or probing fault), as well as "normal" events like an output short. It's remarkably easy to have a pretty-good (and tested) high-voltage circuit fail, abruptly (and usually with a "snap" sound), leaving precious few clues as to the cause. Learn from our hard-earned experience here: use a MOSFET rated beyond the full supply voltage.
Exercise 9.14. Add foldback current limiting to Figure 9.110.

#### B. Transistors in series

Figure 9.111 shows a trick for connecting transistors in series to increase the breakdown voltage. In the circuit on the left-hand side, the equal gate resistors distribute the dc voltage drops across the series-connected MOSFETs, and the paralleled capacitors ensure that the divider action extends to high frequencies. (The capacitors should be chosen large enough to swamp differences in transistor input capacitance, which otherwise cause unequal division, reducing overall breakdown voltage.) The zener diodes protect against gate breakdown. ${ }^{150}$ And the $100 \Omega$ series gate resistors help suppress oscillations, common in high-voltage MOSFETs (use some ferrite beads on the source and gate leads, if there's an oscillation sighting).

For series-connected bipolar transistors you can distribute the voltage drops with resistors alone, as shown, because the rugged base-emitter junctions are not susceptible to damage analogous to the MOSFET's oxide punch-through (in the forward direction they simply conduct a small current; and the small reverse currents from the base divider are generally benign, and they can be prevented entirely with 1N4148-style small-signal diodes connected between base and emitter). Small-signal transistors

[^565]![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0730.jpg?height=761&width=840&top_left_y=219&top_left_x=1075)

Figure 9.111. Connecting transistors in series to raise the breakdown voltage, to distribute the power dissipation, and (in power BJTs) to stay within the SOA.
like the 300 V MPSA42 and MPSA92 ( $n p n$ and $p n p$, respectively) and 400 V MPSA44 (available in TO-92 and surface-mount packages) are usefully extended to higher voltages this way.

Note that the series-connected string has considerably poorer saturation voltage than that of an equivalent highvoltage transistor: for three MOSFETs (as shown) the ONvoltage is $V_{\text {sat }} \approx 3 V_{\mathrm{DSon}}+3 V_{\mathrm{GSon}}$; for the BJT circuit it's $3 V_{\text {CEon }}+3 V_{\mathrm{BE}}$.

Series-connected transistors can, of course, be used in circuits other than power supplies. You'll sometimes see them in high-voltage amplifiers, although the availability of high-voltage MOSFETs often makes it unnecessary to resort to the series connection at all.

In high-voltage circuits like this, it's easy to overlook the fact that you may need to use 1 watt (or larger) resistors, rather than the standard $1 / 4$-watt type. A more subtle trap awaits the unwary, namely the maximum voltage rating of a resistor, regardless of its power-dissipation rating. For example, standard 1/4-watt axial-lead resistors are limited to 250 V , and often less for surface-mount types. ${ }^{151}$ Another underappreciated effect is the astonishing voltage coefficients of carbon composition resistors, when run at

[^566]higher voltages. For example, in an actual measurement (Figure 9.112) a 1000:1 divider (10M, 10k) produced a division ratio of 775:1 (29\% error!) when driven with 1 kV ; note that the power was well within ratings. This nonohmic effect is particularly important in the output-voltagesensing divider of high-voltage supplies and amplifiers beware! Companies like Ohmite (Victoreen division) and Caddock make resistors in many styles designed for highvoltage applications like this. See $\S 1 x .2$ for additional measurements and discussion.

Quite apart from their use in high-voltage applications, another motivation for series connection of multiple transistors is to distribute a large power dissipation. For such power applications, where you're not dealing with high voltages, you can, of course, use a parallel connection. But then you have to ensure that the current is divided approximately equally among the multiple transistors. For BJTs in parallel this is usually done with individual emitterballasting resistors, as we saw in §2.4.4. But that scheme is problematic with MOSFETs, because they have a spread of gate-source voltages, forcing you to allow an uncomfortably large voltage drop across the source resistors. This can be addressed, though, with some cleverness; see Figure 3.117 for a nice solution.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0731.jpg?height=593&width=802&top_left_y=1234&top_left_x=119)

Figure 9.112. Carbon composition resistors exhibit a reduction in resistance as they approach their rated 250 V. Don't use resistors above their voltage rating!

#### C. Floating regulator

Another method sometimes used to extend the voltage range of integrated regulators, including the simple 3terminal type, is to float the entire regulator above ground, for example as shown in Figure 9.113. Here the zener $D_{2}$ limits the drop across the 3-terminal regulator to just a
few volts (the zener voltage minus $Q_{1}$ 's gate-source voltage), with outboard MOSFET $Q_{1}$ taking up the rest of the voltage drop. The LT3080 is a nice choice here, with its simple $10 \mu \mathrm{~A}$ programming current setting the output voltage. We used the trick of a pair of resistors (a "current divider," which you can think of as a current multiplier, viewed from the $10 \mu \mathrm{~A}$ source side) to raise the effective programming current to 1 mA , so we could use a 500 k pot to set the voltage (rather than the awkward - and unobtainable - 50 megohms that otherwise would be needed); the boosted programming current serendipitously provides the LT3080's 0.5 mA minimum load current as well. Zener current is provided by the handy LND150 depletion-mode MOSFET from Supertex, here throttled down to 0.2 mA with a source self-biasing resistor.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0731.jpg?height=782&width=815&top_left_y=872&top_left_x=965)

Figure 9.113. High-voltage floating three-terminal regulator.

The remaining components are easy to understand: $D_{1}$ protects $Q_{1}$ 's gate; the ferrite bead suppresses oscillations (you can use a $150 \Omega$ gate resistor instead); and the LT3080 is outfitted with its minimum required input and output bypass capacitors. If there's an opportunity for the HV input to drop below the output voltage, add a diode across the LT3080 (heck, just do it anyway).

Exercise 9.15. Explore replacing $Q_{1}$ with a high-current depletion-mode MOSFET, like an IXTP3N50; see Table 3.6. Can you think of a way of using it to eliminate $Q_{2}$ and the zener diodes, despite the fact its $-V_{\mathrm{GS}}$ may be less than the LT3080's required $V_{\mathrm{DO}}(\mathrm{max})=1.6 \mathrm{~V}$ at high currents? Hint: an LM385-2.5 may be useful.

## Review of Chapter 9

An A-to-K summary of what we have learned in Chapter 9. This summary reviews basic principles and facts in Chapter 9 , but it does not cover application circuit diagrams and practical engineering advice presented there.

### IA. Voltage Regulator Taxonomy.

Voltage regulators provide the stable dc voltages needed to power all manner of electronic circuits. The simplest (and least noisy) type is the linear regulator (Figure 9.2), in which the output error signal, suitably amplified and compensated, is used to control a linear "pass transistor" (BJT or MOSFET) that is in series with a higher (and perhaps unregulated) dc input voltage. Linear regulators are not power efficient, with dissipation $P_{\text {diss }}=I_{\text {out }}\left(V_{\text {in }}-V_{\text {out }}\right)$, and they are not able to a produce dc output that is larger than the input, nor a dc output of reversed polarity.

The switching regulator (or switching converter, switchmode power supply, SMPS, or just "switcher," §9.6) addresses these shortcomings, at the cost of some induced switching noise and greater complexity. Most switching power supplies use one or more inductors (or transformers), and one or more saturated switches (usually MOSFETs) operating at relatively high switching frequencies $(50 \mathrm{kHz}-5 \mathrm{MHz}$ ), to convert a dc input (which may be unregulated) to one or more stable and regulated output voltages; the latter can be lower or higher than the input voltage, or they can be of opposite polarity. The inductor(s) store and then transfer energy, in discrete switching cycles, from the input to the output, with the switch(es) controlling the conduction paths; with ideal components there would be no dissipation, and the conversion would be $100 \%$ efficient. The output error signal, suitably amplified and compensated, is used to vary either the pulse width ("PWM") or the pulse frequency ("PFM"). Switching converters can be non-isolated (i.e., input and output sharing a common ground, Figure 9.61), or isolated (e.g., when powered from the ac powerline, Figure 9.73); for each class there are dozens of topologies, see IID below.

A minor subclass of switching converter is the inductorless converter (or "charge-pump" converter; see §9.6.3), where a combination of several switches and one or more "flying" capacitors is used to create a dc output that can be a multiple of the dc input, or an output of opposite polarity (or a combination of both). For many of these, the output(s) track the dc input (i.e., unregulated), but there are also variants that regulate the output by controlling the switching cycle. See Table 9.4 and Figures 9.56 and 9.57.

#### IB. The DC Input.

Regardless of the kind of converter or regulator circuit, you need to provide some form of dc input. This may be poorly regulated, as from a battery (portable equipment) or from rectified ac (line-powered equipment, Figures 9.25 and 9.48); or it may be an existing stable dc voltage already present within a circuit (e.g., Figure 9.64). For a line-powered instrument that uses a linear regulator, the "unregulated" dc input (with some ac ripple) consists of a transformer (for both galvanic isolation and voltage transformation) plus rectifier (for conversion to dc) plus bulk storage capacitor(s) (to smooth the ripple from the rectified ac). By contrast, in a line-powered (confusingly called "off-line") switcher the powerline transformer is omitted, because a transformer in the isolated switcher circuit provides galvanic isolation and it is far smaller and lighter since it operates at the much higher switching frequency; see Figure 9.48.

A diode bridge and storage capacitor converts an ac input to full-wave unregulated dc, whether from a powerline transformer or directly from the ac line. Ignoring winding resistance and inductances, the dc output voltage is approximately $V_{\mathrm{dc}}=1.4 V_{\mathrm{rms}}-2 V_{\text {diode }}$, and the peak-to-peak ripple voltage is approximately ${ }^{152} \Delta V_{\text {ripple }(\mathrm{pp})} \approx I_{\text {load }} / 2 f C$, where $C$ is the capacitance of the output dc storage capacitor and $f$ is the ac input frequency $(60 \mathrm{~Hz}$ or 50 Hz , depending on geographic and political boundaries). The ac input current is confined to relatively short pulses during the part of the waveform leading up to the positive and negative peaks (see Figures 9.51 and 9.78). This low "power factor" waveform is undesirable, because it produces excessive $I^{2} R$ heating and more stressful peak currents. For this reason all but the smallest switching converters use a power-factor correction (PFC) input stage (Figure 9.77) to spread out the current waveform and thus create an input current approximately proportional to the instantaneous ac input voltage.

Line-powered instruments need a few additional components, both for safety and convenience. These include a fuse, switch, and optional line filter and transient suppressor; these are often combined in an IEC "power entry module," see Figure 9.49.

#### IC. Linear Voltage Regulators.

The basic linear voltage regulator compares a sample of the dc output voltage with an internal voltage reference (see $\llbracket$ GG, below) in an error amplifier that provides negative

[^567]feedback to a pass transistor; see Figure 9.2. The dc output voltage can be greater or less than the reference (Figures 9.4 and 9.5), but it is always less than the dc input. You can think of this as a feedback power amplifier, which is prone to instability with capacitive loads, thus the compensation capacitor $C_{\mathrm{c}}$ in Figure 9.2D,E. The final circuit in that figure shows a current limiting circuit ( $R_{\mathrm{CL}}$ and $Q_{2}$ ), and also an overvoltage crowbar ( $D_{1}$ and $Q_{3}$, see $\llbracket[\mathrm{J}$ below) to protect the load in the event of a regulator fault.

All the components of the original 723-type linear voltage regulator can be integrated onto a single IC (Figure 9.6), forming a "3-terminal" fixed regulator, e.g., the classic 78 xx -style (where " xx " is its output voltage). These require only external bypass capacitors (Figure 9.8) to make a complete regulator. There are only a few standard voltages available, however (e.g., $+3.3 \mathrm{~V},+5 \mathrm{~V},+15 \mathrm{~V}$ ); so a popular variant is the 3-terminal adjustable regulator (e.g., the classic 317-type, see Figure 9.9), which lets you adjust the output voltage with an external resistive divider (Figure 9.10). Figures 9.14, 9.16, and 9.18 show some application hints for this very flexible regulator. Both fixed and adjustable 3-terminal regulators are also available in negative polarities (79xx and LM337, respectively), as well as in low-current variants (78Lxx and LM317L, respectively).

One drawback of these classic linear regulators is their need for an input voltage that is at least $\sim 2 \mathrm{~V}$ greater than the output (its dropout voltage); that is needed because their pass transistor operates as an emitter follower (thus at least a $V_{\mathrm{BE}}$ drop) and the current-limit circuit can drop up to another $V_{\mathrm{BE}}$. Two volts may not sound like a lot, but it looms large in a low-voltage regulator circuit, e.g., one with a +2.5 V dc output. To circumvent this problem, you can use a low-dropout (LDO) regulator, in which the pass transistor (BJT or MOSFET) is configured as a commonemitter (or common-source) amplifier, see Figure 9.20; the resulting dropout voltages are down in the tenths of a volt (Figure 9.24). LDOs are nice, but they cost more, and they are more prone to instability because their high output impedance (collector or drain) causes a lagging phase shift into the substantial load capacitance. LDOs may require significant minimum output bypass capacitance (as much as $10 \mu \mathrm{~F}$ or $47 \mu \mathrm{~F}$ ), often constrained with both a minimum and maximum equivalent series resistance (ESR), e.g., $0.1 \Omega \min , 1 \Omega \max ;$ see Table 9.3.

#### ๆD. Switching Converter Topologies.

The basic non-isolated switcher topologies are the buck (or "step-down"), the boost (or "step-up"), and the invert (or "inverting buck-boost"); see §9.6.4 and Figure 9.61. The power train of these each uses one inductor, one switch, and
one diode (or a second switch acting as an active rectifier), in addition to input and output storage capacitors. A complete converter requires additional components: an oscillator, comparator, error amplifier, drive circuits, and provisions for compensation and fault protection; see for example Figure 9.65. As with linear regulators, the semiconductor manufacturers have stepped in to provide most of the necessary components as packaged ICs, see Tables 9.5a,b and 9.6.

For the buck converter $V_{\text {out }}<V_{\text {in }}$, and for the boost converter $V_{\text {out }}>V_{\text {in }}$. The inverting converter produces an output of opposite polarity to the input, and whose voltage magnitude can be larger or smaller than the input voltage (this is true also of the remarkable Ćuk converter, $\S 9.6 .8 \mathrm{H})$. The respective dc output voltages are $V_{\text {out }(\text { buck })}=D V_{\text {in }}, V_{\text {out }(\text { boost })}=V_{\text {in }} /(1-D)$, and $V_{\text {out }(\text { invert })}=-$ $V_{\text {in }} D /(1-D)$, where $D$ is the switch-on duty cycle $D=t_{\mathrm{on}} / T$. There are also non-inverting buck-boost topologies that permit the output voltage range to bracket the input (i.e., able to go above or below the input). Examples are the 2 -switch buck-boost (two switches, two diodes, one inductor), and the SEPIC (one switch, one diode, two inductors), see Figure 9.70. Of course, a switching converter with a transformer (whether isolated or not) provides flexibility in output polarity, as well as improved performance for large ratio voltage conversion.

Isolated switching converters use a transformer (for isolation), in addition to one or more inductors (for energy storage), see Figure 9.73. In the flyback converter (Figure 9.73A) the transformer acts also as the energy-storage inductor (thus no additional inductor), whereas in the forward converter and bridge converters (Figures 9.73B-D) the transformer is "just a transformer," and the diodes and inductor complete the energy storage and transfer. The respective dc output voltages are $V_{\text {out(flyback) }}=V_{\text {in }}\left[N_{\text {sec }} / N_{\text {pri }}\right][D /(1-D)]$ and $V_{\text {out }(\text { forward })}=D V_{\text {in }}\left(N_{\text {sec }} / N_{\text {pri }}\right)$. Speaking generally, flyback converters are used in low-power applications ( $\lesssim 200 \mathrm{~W}$ ), forward converters in medium-power applications (to $\sim 500 \mathrm{~W}$ ), and bridge converters for real power applications.

#### ||E. Switcher Regulation: Hysteretic, Voltage Mode, and Current Mode.

There are several ways to regulate a switching converter's dc output voltage. Simplest is hysteretic feedback, in which the error signal simply enables or disables successive switching cycles. It's a form of simple "bang-bang" control, with no stability issues that require a compensation network; see Figure 9.64 for a buck converter design with
the popular MC34063. Proportional PWM control is better, and comes in two flavors: voltage mode and current mode. Both methods compare the output voltage with a fixed reference to regulate the output voltage, but they do it in different ways. In voltage-mode PWM, the output voltage error signal is compared with the internal oscillator's sawtooth waveform to control the primary switch's ON duration, whereas in current-mode PWM the comparison ramp is generated by the rising inductor current, with the internal oscillator used only to initiate each conduction cycle. See §9.6.9, and particularly Figures 9.71 and 9.72. In either case the controller terminates a conduction cycle if the switch exceeds a peak current, the input drops below an "undervoltage lockout" threshold, or the chip exceeds a maximum temperature. Figure 9.65 shows a simple voltage-mode PWM buck converter.

Voltage-mode and current-mode control loops both require compensation for stability, and each has its advantages and disadvantages. Current-mode controllers appear to be winning the popularity contest, owing to their better transient response, inherent switch protection (owing to pulse-by-pulse current limiting), improved outer-loop phase margin, and ability to be paralleled.

#### IF. Switching Converter Miscellany.

Switching conversion is a rich subject, many details of which are well beyond the scope of this chapter (or this book). Some topics - ripple current and inductor design, core saturation and reset, magnetizing inductance and snubbing, soft start, diode recovery, CCM and DCM conduction modes, switching losses, loop compensation, burst mode, inrush current, isolation barriers, PFC, switching amplifiers - are treated lightly here and in Chapter $9 x$. Consider this chapter's treatment of switching converters as a lengthy introduction to a specialty field that can easily consume a professional lifetime.

#### IG. Voltage References.

A stable voltage reference is needed in any voltage regulator, as well as in accurate applications such as precision current sources, A/D and D/A conversion, and voltage- and current-measurement circuits. Often a good voltage reference is included in a regulator or converter IC (see for example Table 13.1), but you may want the improved performance you can get with a high-quality external reference. And, often, you need a stand-alone voltage reference for other uses in a circuit.

The simplest voltage reference is the discrete zener diode ( $\S 9.10 .1$ ), but most voltage references are multicomponent integrated circuits that behave externally either
like an extremely good zener ("2-terminal," or shunt; Table 9.7), or like an extremely good linear regulator ("3terminal," or series; Table 9.8). Shunt references must be biased into conduction (just like a zener) by supplying current from a higher-voltage rail (use a resistor or a current source), while series references are powered by connecting their supply pin directly to the dc supply. References of either type are available in a small set of standard voltages, typically in the range of $1.25-10.0 \mathrm{~V}$.

The discrete 2-terminal zener is fine for non-critical applications, but its typical accuracy of $\pm 5 \%$ is inadequate for precision circuits. Integrated references of either kind are far better, with worst-case accuracies in the range of $0.02 \%$ to $1 \%$, and tempcos ranging from $1 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ to $100 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$, as seen in the tables. Most integrated references are based on a circuit that temperature compensates the $V_{\mathrm{BE}}$ of a BJT (a so-called "bandgap reference"), generating a stable voltage of approximately 1.24 V ; but others use a buried zener diode with $V_{\mathrm{Z}} \approx 7 \mathrm{~V}$. The latter are generally quieter, but bandgap references can operate from low supply voltages and are widely available in voltages of $1.24 \mathrm{~V}, 2.50 \mathrm{~V}$, etc. Two newer technologies with surprisingly good performance are the JFET pinchoff reference from ADI (the ADR400 "XFET" references), and the floating-gate reference from Intersil. Both exhibit very good tempco and low noise. Other important characteristics of voltage references are regulation ( $R_{\text {out }}$ for shunt types, PSRR for series types), minimum load capacitance and stability into capacitive loads, trim and filter pins, and package style.

#### IH. Heat and Power Dissipation.

Along with power electronics comes. . .heat! You remove it with a combination of convection (air flow) and conduction (thermal contact with a heat-dissipating heatsink). Conductive heat flow is proportional to the temperature difference between the hot and cold sides (Newton's law of cooling), $\Delta T=P_{\text {diss }} R_{\Theta}$, where $R_{\Theta}$ is known as the "thermal resistance." For a succession of conductive joints the thermal resistances add; thus, for example, the junction temperature $T_{\mathrm{J}}$ of a power semiconductor dissipating $P_{\text {diss }}$ watts is $T_{\mathrm{J}}=T_{\mathrm{A}}+P_{\mathrm{diss}}\left(R_{\Theta \mathrm{JC}}+R_{\Theta \mathrm{CS}}+R_{\mathrm{\Theta SA}}\right)$, where $T_{\mathrm{A}}$ is the ambient temperature, and the successive $R_{\Theta}$ 's represent the thermal resistances from junction to case, case to heatsink, and heatsink to ambient. Printed circuit foil patterns are often adequate for dissipation of a few watts or less (Figure 9.45); finned heatsinks or metallic chassis surfaces are used for greater heat removal, with forced airflow generally needed when the power dissipation reaches levels of 50 W or more (Figure 9.43). Semiconductor devices can
withstand considerably greater power dissipation during short pulses; this is sometimes specified as a graph of transient thermal resistance (i.e., $R_{\Theta}$ versus pulse duration and duty cycle), or as elevated contours on a plot of Safe Operating Area (see III).

#### III. Safe Operating Area.

A power transistor (whether BJT or MOSFET) has specified maximum values of voltage and current, and also (because of maximum allowed junction temperature) a maximum product $V_{\mathrm{DS}} I_{\mathrm{D}}$ (i.e., power dissipation) for a given case temperature; the latter is just $V_{\mathrm{DS}} I_{\mathrm{D}} \leq\left(T_{\mathrm{J}(\max )}-T_{\mathrm{C}}\right) / R_{\Theta \mathrm{JC}}$. These limits define a safe operating area (SOA, §9.4.2), usually shown as contours on log-log axes of current versus voltage; see for example Figure 3.95. That plot shows two further features: (a) greater dissipation is allowed for short pulses; (b) the SOA of BJTs (but not MOSFETs) is further constrained by a phenomenon known as "second breakdown."

#### १J. Overvoltage Crowbars.

Some failure modes of power converters cause output over-
voltage, for example a shorted pass transistor in a linear regulator, or loss of feedback control in a switcher. This is likely to damage or destroy powered circuitry. An overvoltage crowbar (\$9.13.1) senses overvoltage and triggers an SCR to short the output. A less brute-force technique shuts down conversion when an overvoltage is sensed; these are indicated in the "OVP" column in Table 9.5b.

#### qK. Current Sources.

"Regulator" usually means a stable voltage source; but there are many uses for a controllable current source (§9.3.14). Three-terminal linear regulators are easily coaxed into current-source service (§9.3.14A). There are also dedicated current-source ICs like the LM334 and REF200. JFETs make convenient 2-terminal current sources, and depletion-mode MOSFETs make excellent current sources that can operate up to voltages as high as 1 kV , see $\S 9.3 .14 \mathrm{C}$. And don't forget about the humble discrete BJT current source ( $\S 2.2 .6$ and 2.3.7B), or the opamp current-source circuits ( $\S 4.2 .5$ : Howland; op-amp + transistor).



At the next level there's the dc accuracy and drift to worry about. Once again we've chosen precision BJT opamps, the now-familiar AD8676 for the error amplifier, and the vintage LT1007A for the unity-gain difference amplifier. The latter has the lower noise and offset voltage, at the expense of a higher input current; we circumvent the latter problem by reducing the resistance seen at the inputs, which is possible because of the low $(50 \Omega)$ source impedance. The power op-amp $U_{6}$ need not be accurate, because it is within an overall feedback loop whose gain rises at low frequencies as $1 / f$.

[^738]The sense resistor $R_{\mathrm{S}}$ is a Vishay "bulk metal foil" 4wire (Kelvin connection) precision power resistor in a TO220 package, rated at 8 W dissipation; the best grade is accurate to $\pm 0.01 \%$, with a typical tempco of $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$. The resistor pairs $R_{3}-R_{5}$ are each precision matched duals in convenient SOT23 packages, with $0.05 \%$ matching, and $2 \mathrm{ppm} /{ }^{\circ} \mathrm{C}$ (typ) tracking. The resistor shunting $R_{3 b}$ compensates for the reduction of $R_{\mathrm{s}}$ 's effective resistance that is due to loading by $R_{7}$ and $R_{4 b}$.

Assuming there's plenty of loop gain (and there is, see next paragraph), the ppm-scale dc stability of the DAC output is reasonably well preserved with these op-amps, assisted by resistors of this stability and tracking.

Finally, there's the serious business of stability against oscillations, which is complicated here by the inductive load. The latter alone causes a $6 \mathrm{~dB} /$ octave rolloff beginning at the frequency at which the inductive reactance equals the sense resistance, about 20 Hz for the nominal 400 mH coil pair. We've addressed it by making the error amplifier an integrator at lower frequencies (for plenty of dc gain), flattening to a gain of $\times 10$ at $20 \mathrm{~Hz}^{26}$ That prevents the curve of overall loop gain versus frequency from dropping at more than $6 \mathrm{~dB} /$ octave, at least until well beyond the unity-gain frequency. The output amplifier $U_{6}$

[^739]gets the same treatment. An additional small capacitor across $R_{1}$ (and similarly across $R_{2}$ ) rolls off the local gain at higher frequencies still, to stabilize against high-frequency oscillations. Suitable values are 150 pF and 4.7 nF (rolling off at 20 kHz and 3 kHz , respectively).

Rather than prattle on about this, we present the selfexplanatory Bode plots of Figure 13.20. Readers who are likely to encounter situations like this can benefit from the thinking presented there.
![](https://cdn.mathpix.com/cropped/2024_11_01_d32fbf106fd4c4284b9fg-0932.jpg?height=1225&width=741&top_left_y=612&top_left_x=244)

Figure 13.20. Bode plots for the coil driver amplifier in Figure 13.19, shown with several values of load inductance.




